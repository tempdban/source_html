<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>pps.c source code [linux-4.14.y/drivers/pps/pps.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'linux-4.14.y/drivers/pps/pps.c'; var root_path = '../../..'; var data_path = '../../../../data';</script>
<script src='../../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../..'>linux-4.14.y</a>/<a href='..'>drivers</a>/<a href='./'>pps</a>/<a href='pps.c.html'>pps.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> * PPS core file</i></td></tr>
<tr><th id="3">3</th><td><i> *</i></td></tr>
<tr><th id="4">4</th><td><i> *</i></td></tr>
<tr><th id="5">5</th><td><i> * Copyright (C) 2005-2009   Rodolfo Giometti &lt;giometti@linux.it&gt;</i></td></tr>
<tr><th id="6">6</th><td><i> *</i></td></tr>
<tr><th id="7">7</th><td><i> *   This program is free software; you can redistribute it and/or modify</i></td></tr>
<tr><th id="8">8</th><td><i> *   it under the terms of the GNU General Public License as published by</i></td></tr>
<tr><th id="9">9</th><td><i> *   the Free Software Foundation; either version 2 of the License, or</i></td></tr>
<tr><th id="10">10</th><td><i> *   (at your option) any later version.</i></td></tr>
<tr><th id="11">11</th><td><i> *</i></td></tr>
<tr><th id="12">12</th><td><i> *   This program is distributed in the hope that it will be useful,</i></td></tr>
<tr><th id="13">13</th><td><i> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</i></td></tr>
<tr><th id="14">14</th><td><i> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</i></td></tr>
<tr><th id="15">15</th><td><i> *   GNU General Public License for more details.</i></td></tr>
<tr><th id="16">16</th><td><i> *</i></td></tr>
<tr><th id="17">17</th><td><i> *   You should have received a copy of the GNU General Public License</i></td></tr>
<tr><th id="18">18</th><td><i> *   along with this program; if not, write to the Free Software</i></td></tr>
<tr><th id="19">19</th><td><i> *   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</i></td></tr>
<tr><th id="20">20</th><td><i> */</i></td></tr>
<tr><th id="21">21</th><td></td></tr>
<tr><th id="22">22</th><td><u>#define <dfn class="macro" id="_M/pr_fmt" data-ref="_M/pr_fmt">pr_fmt</dfn>(fmt) KBUILD_MODNAME ": " fmt</u></td></tr>
<tr><th id="23">23</th><td></td></tr>
<tr><th id="24">24</th><td><u>#include <a href="../../include/linux/kernel.h.html">&lt;linux/kernel.h&gt;</a></u></td></tr>
<tr><th id="25">25</th><td><u>#include <a href="../../include/linux/module.h.html">&lt;linux/module.h&gt;</a></u></td></tr>
<tr><th id="26">26</th><td><u>#include <a href="../../include/linux/init.h.html">&lt;linux/init.h&gt;</a></u></td></tr>
<tr><th id="27">27</th><td><u>#include <a href="../../include/linux/sched.h.html">&lt;linux/sched.h&gt;</a></u></td></tr>
<tr><th id="28">28</th><td><u>#include <a href="../../include/linux/uaccess.h.html">&lt;linux/uaccess.h&gt;</a></u></td></tr>
<tr><th id="29">29</th><td><u>#include <a href="../../include/linux/idr.h.html">&lt;linux/idr.h&gt;</a></u></td></tr>
<tr><th id="30">30</th><td><u>#include <a href="../../include/linux/mutex.h.html">&lt;linux/mutex.h&gt;</a></u></td></tr>
<tr><th id="31">31</th><td><u>#include <a href="../../include/linux/cdev.h.html">&lt;linux/cdev.h&gt;</a></u></td></tr>
<tr><th id="32">32</th><td><u>#include <a href="../../include/linux/poll.h.html">&lt;linux/poll.h&gt;</a></u></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="../../include/linux/pps_kernel.h.html">&lt;linux/pps_kernel.h&gt;</a></u></td></tr>
<tr><th id="34">34</th><td><u>#include <a href="../../include/linux/slab.h.html">&lt;linux/slab.h&gt;</a></u></td></tr>
<tr><th id="35">35</th><td></td></tr>
<tr><th id="36">36</th><td><u>#include <a href="kc.h.html">"kc.h"</a></u></td></tr>
<tr><th id="37">37</th><td></td></tr>
<tr><th id="38">38</th><td><i  data-doc="pps_devt">/*</i></td></tr>
<tr><th id="39">39</th><td><i  data-doc="pps_devt"> * Local variables</i></td></tr>
<tr><th id="40">40</th><td><i  data-doc="pps_devt"> */</i></td></tr>
<tr><th id="41">41</th><td></td></tr>
<tr><th id="42">42</th><td><em>static</em> <a class="typedef" href="../../include/linux/types.h.html#dev_t" title='dev_t' data-type='__kernel_dev_t' data-ref="dev_t">dev_t</a> <dfn class="tu decl def" id="pps_devt" title='pps_devt' data-type='dev_t' data-ref="pps_devt">pps_devt</dfn>;</td></tr>
<tr><th id="43">43</th><td><em>static</em> <b>struct</b> <a class="type" href="../../include/linux/device.h.html#class" title='class' data-ref="class">class</a> *<dfn class="tu decl def" id="pps_class" title='pps_class' data-type='struct class *' data-ref="pps_class">pps_class</dfn>;</td></tr>
<tr><th id="44">44</th><td></td></tr>
<tr><th id="45">45</th><td><em>static</em> <a class="macro" href="../../include/linux/mutex.h.html#131" title="struct mutex pps_idr_lock = { .owner = { (0) } , .wait_lock = (spinlock_t ) { { .rlock = { .raw_lock = { { (0) } }, } } } , .wait_list = { &amp;(pps_idr_lock.wait_list), &amp;(pps_idr_lock.wait_list) } }" data-ref="_M/DEFINE_MUTEX">DEFINE_MUTEX</a>(<dfn class="tu decl def" id="pps_idr_lock" title='pps_idr_lock' data-type='struct mutex' data-ref="pps_idr_lock"><a class="tu ref" href="#45" title='pps_idr_lock' data-use='m' data-ref="pps_idr_lock"><a class="tu ref" href="#45" title='pps_idr_lock' data-use='m' data-ref="pps_idr_lock"><a class="tu ref" href="#45" title='pps_idr_lock' data-use='m' data-ref="pps_idr_lock"><a class="tu ref" href="#45" title='pps_idr_lock' data-use='m' data-ref="pps_idr_lock"><a class="tu ref" href="#45" title='pps_idr_lock' data-use='m' data-ref="pps_idr_lock"><a class="tu ref" href="#45" title='pps_idr_lock' data-use='m' data-ref="pps_idr_lock"><a class="tu ref" href="#45" title='pps_idr_lock' data-use='m' data-ref="pps_idr_lock"><a class="tu ref" href="#45" title='pps_idr_lock' data-use='m' data-ref="pps_idr_lock">pps_idr_lock</a></a></a></a></a></a></a></a></dfn>);</td></tr>
<tr><th id="46">46</th><td><em>static</em> <a class="macro" href="../../include/linux/idr.h.html#37" title="struct idr pps_idr = { .idr_rt = { .gfp_mask = ((( gfp_t)(3 &lt;&lt; (25 + 0)))), .rnode = ((void *)0), } }" data-ref="_M/DEFINE_IDR">DEFINE_IDR</a>(<dfn class="tu decl def" id="pps_idr" title='pps_idr' data-type='struct idr' data-ref="pps_idr">pps_idr</dfn>);</td></tr>
<tr><th id="47">47</th><td></td></tr>
<tr><th id="48">48</th><td><i  data-doc="pps_cdev_poll">/*</i></td></tr>
<tr><th id="49">49</th><td><i  data-doc="pps_cdev_poll"> * Char device methods</i></td></tr>
<tr><th id="50">50</th><td><i  data-doc="pps_cdev_poll"> */</i></td></tr>
<tr><th id="51">51</th><td></td></tr>
<tr><th id="52">52</th><td><em>static</em> <em>unsigned</em> <em>int</em> <dfn class="tu decl def fn" id="pps_cdev_poll" title='pps_cdev_poll' data-type='unsigned int pps_cdev_poll(struct file * file, poll_table * wait)' data-ref="pps_cdev_poll">pps_cdev_poll</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col1 decl" id="1file" title='file' data-type='struct file *' data-ref="1file">file</dfn>, <a class="typedef" href="../../include/linux/poll.h.html#poll_table" title='poll_table' data-type='struct poll_table_struct' data-ref="poll_table">poll_table</a> *<dfn class="local col2 decl" id="2wait" title='wait' data-type='poll_table *' data-ref="2wait">wait</dfn>)</td></tr>
<tr><th id="53">53</th><td>{</td></tr>
<tr><th id="54">54</th><td>	<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a> *<dfn class="local col3 decl" id="3pps" title='pps' data-type='struct pps_device *' data-ref="3pps">pps</dfn> = <a class="local col1 ref" href="#1file" title='file' data-ref="1file">file</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="55">55</th><td></td></tr>
<tr><th id="56">56</th><td>	<a class="ref fn" href="../../include/linux/poll.h.html#poll_wait" title='poll_wait' data-ref="poll_wait">poll_wait</a>(<a class="local col1 ref" href="#1file" title='file' data-ref="1file">file</a>, &amp;<a class="local col3 ref" href="#3pps" title='pps' data-ref="3pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::queue" title='pps_device::queue' data-ref="pps_device::queue">queue</a>, <a class="local col2 ref" href="#2wait" title='wait' data-ref="2wait">wait</a>);</td></tr>
<tr><th id="57">57</th><td></td></tr>
<tr><th id="58">58</th><td>	<b>return</b> <a class="macro" href="../../include/uapi/asm-generic/poll.h.html#6" title="0x0001" data-ref="_M/POLLIN">POLLIN</a> | <a class="macro" href="../../include/uapi/asm-generic/poll.h.html#14" title="0x0040" data-ref="_M/POLLRDNORM">POLLRDNORM</a>;</td></tr>
<tr><th id="59">59</th><td>}</td></tr>
<tr><th id="60">60</th><td></td></tr>
<tr><th id="61">61</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="pps_cdev_fasync" title='pps_cdev_fasync' data-type='int pps_cdev_fasync(int fd, struct file * file, int on)' data-ref="pps_cdev_fasync">pps_cdev_fasync</dfn>(<em>int</em> <dfn class="local col4 decl" id="4fd" title='fd' data-type='int' data-ref="4fd">fd</dfn>, <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col5 decl" id="5file" title='file' data-type='struct file *' data-ref="5file">file</dfn>, <em>int</em> <dfn class="local col6 decl" id="6on" title='on' data-type='int' data-ref="6on">on</dfn>)</td></tr>
<tr><th id="62">62</th><td>{</td></tr>
<tr><th id="63">63</th><td>	<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a> *<dfn class="local col7 decl" id="7pps" title='pps' data-type='struct pps_device *' data-ref="7pps">pps</dfn> = <a class="local col5 ref" href="#5file" title='file' data-ref="5file">file</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="64">64</th><td>	<b>return</b> <a class="ref fn" href="../../include/linux/fs.h.html#fasync_helper" title='fasync_helper' data-ref="fasync_helper">fasync_helper</a>(<a class="local col4 ref" href="#4fd" title='fd' data-ref="4fd">fd</a>, <a class="local col5 ref" href="#5file" title='file' data-ref="5file">file</a>, <a class="local col6 ref" href="#6on" title='on' data-ref="6on">on</a>, &amp;<a class="local col7 ref" href="#7pps" title='pps' data-ref="7pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::async_queue" title='pps_device::async_queue' data-ref="pps_device::async_queue">async_queue</a>);</td></tr>
<tr><th id="65">65</th><td>}</td></tr>
<tr><th id="66">66</th><td></td></tr>
<tr><th id="67">67</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="pps_cdev_pps_fetch" title='pps_cdev_pps_fetch' data-type='int pps_cdev_pps_fetch(struct pps_device * pps, struct pps_fdata * fdata)' data-ref="pps_cdev_pps_fetch">pps_cdev_pps_fetch</dfn>(<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a> *<dfn class="local col8 decl" id="8pps" title='pps' data-type='struct pps_device *' data-ref="8pps">pps</dfn>, <b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_fdata" title='pps_fdata' data-ref="pps_fdata">pps_fdata</a> *<dfn class="local col9 decl" id="9fdata" title='fdata' data-type='struct pps_fdata *' data-ref="9fdata">fdata</dfn>)</td></tr>
<tr><th id="68">68</th><td>{</td></tr>
<tr><th id="69">69</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col0 decl" id="10ev" title='ev' data-type='unsigned int' data-ref="10ev">ev</dfn> = <a class="local col8 ref" href="#8pps" title='pps' data-ref="8pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::last_ev" title='pps_device::last_ev' data-ref="pps_device::last_ev">last_ev</a>;</td></tr>
<tr><th id="70">70</th><td>	<em>int</em> <dfn class="local col1 decl" id="11err" title='err' data-type='int' data-ref="11err">err</dfn> = <var>0</var>;</td></tr>
<tr><th id="71">71</th><td></td></tr>
<tr><th id="72">72</th><td>	<i>/* Manage the timeout */</i></td></tr>
<tr><th id="73">73</th><td>	<b>if</b> (<a class="local col9 ref" href="#9fdata" title='fdata' data-ref="9fdata">fdata</a>-&gt;<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata::timeout" title='pps_fdata::timeout' data-ref="pps_fdata::timeout">timeout</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_ktime::flags" title='pps_ktime::flags' data-ref="pps_ktime::flags">flags</a> &amp; <a class="macro" href="../../include/uapi/linux/pps.h.html#65" title="(1&lt;&lt;0)" data-ref="_M/PPS_TIME_INVALID">PPS_TIME_INVALID</a>)</td></tr>
<tr><th id="74">74</th><td>		<a class="local col1 ref" href="#11err" title='err' data-ref="11err">err</a> = <a class="macro" href="../../include/linux/wait.h.html#440" title="({ int __ret = 0; do { do { } while (0); } while (0); if (!(ev != pps-&gt;last_ev)) __ret = ({ __label__ __out; struct wait_queue_entry __wq_entry; long __ret = 0; init_wait_entry(&amp;__wq_entry, 0 ? 0x01 : 0); for (;;) { long __int = prepare_to_wait_event(&amp;pps-&gt;queue, &amp;__wq_entry, 0x0001); if (ev != pps-&gt;last_ev) break; if ((!__builtin_constant_p(0x0001) || 0x0001 == 0x0001 || 0x0001 == (0x0100 | 0x0002)) &amp;&amp; __int) { __ret = __int; goto __out; } schedule(); } finish_wait(&amp;pps-&gt;queue, &amp;__wq_entry); __out: __ret; }); __ret; })" data-ref="_M/wait_event_interruptible">wait_event_interruptible</a>(<a class="local col8 ref" href="#8pps" title='pps' data-ref="8pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::queue" title='pps_device::queue' data-ref="pps_device::queue">queue</a>,</td></tr>
<tr><th id="75">75</th><td>				<a class="local col0 ref" href="#10ev" title='ev' data-ref="10ev">ev</a> != <a class="local col8 ref" href="#8pps" title='pps' data-ref="8pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::last_ev" title='pps_device::last_ev' data-ref="pps_device::last_ev">last_ev</a>);</td></tr>
<tr><th id="76">76</th><td>	<b>else</b> {</td></tr>
<tr><th id="77">77</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col2 decl" id="12ticks" title='ticks' data-type='unsigned long' data-ref="12ticks">ticks</dfn>;</td></tr>
<tr><th id="78">78</th><td></td></tr>
<tr><th id="79">79</th><td>		<a class="macro" href="../../include/linux/device.h.html#1357" title="({ if (0) dev_printk(&quot;\001&quot; &quot;7&quot;, pps-&gt;dev, &quot;timeout %lld.%09d\n&quot;, (long long) fdata-&gt;timeout.sec, fdata-&gt;timeout.nsec); })" data-ref="_M/dev_dbg">dev_dbg</a>(<a class="local col8 ref" href="#8pps" title='pps' data-ref="8pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"timeout %lld.%09d\n"</q>,</td></tr>
<tr><th id="80">80</th><td>				(<em>long</em> <em>long</em>) <a class="local col9 ref" href="#9fdata" title='fdata' data-ref="9fdata">fdata</a>-&gt;<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata::timeout" title='pps_fdata::timeout' data-ref="pps_fdata::timeout">timeout</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_ktime::sec" title='pps_ktime::sec' data-ref="pps_ktime::sec">sec</a>,</td></tr>
<tr><th id="81">81</th><td>				<a class="local col9 ref" href="#9fdata" title='fdata' data-ref="9fdata">fdata</a>-&gt;<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata::timeout" title='pps_fdata::timeout' data-ref="pps_fdata::timeout">timeout</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_ktime::nsec" title='pps_ktime::nsec' data-ref="pps_ktime::nsec">nsec</a>);</td></tr>
<tr><th id="82">82</th><td>		<a class="local col2 ref" href="#12ticks" title='ticks' data-ref="12ticks">ticks</a> = <a class="local col9 ref" href="#9fdata" title='fdata' data-ref="9fdata">fdata</a>-&gt;<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata::timeout" title='pps_fdata::timeout' data-ref="pps_fdata::timeout">timeout</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_ktime::sec" title='pps_ktime::sec' data-ref="pps_ktime::sec">sec</a> * <a class="macro" href="../../include/asm-generic/param.h.html#8" title="100" data-ref="_M/HZ">HZ</a>;</td></tr>
<tr><th id="83">83</th><td>		<a class="local col2 ref" href="#12ticks" title='ticks' data-ref="12ticks">ticks</a> += <a class="local col9 ref" href="#9fdata" title='fdata' data-ref="9fdata">fdata</a>-&gt;<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata::timeout" title='pps_fdata::timeout' data-ref="pps_fdata::timeout">timeout</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_ktime::nsec" title='pps_ktime::nsec' data-ref="pps_ktime::nsec">nsec</a> / (<a class="macro" href="../../include/linux/time64.h.html#37" title="1000000000L" data-ref="_M/NSEC_PER_SEC">NSEC_PER_SEC</a> / <a class="macro" href="../../include/asm-generic/param.h.html#8" title="100" data-ref="_M/HZ">HZ</a>);</td></tr>
<tr><th id="84">84</th><td></td></tr>
<tr><th id="85">85</th><td>		<b>if</b> (<a class="local col2 ref" href="#12ticks" title='ticks' data-ref="12ticks">ticks</a> != <var>0</var>) {</td></tr>
<tr><th id="86">86</th><td>			<a class="local col1 ref" href="#11err" title='err' data-ref="11err">err</a> = <a class="macro" href="../../include/linux/wait.h.html#474" title="({ long __ret = ticks; do { do { } while (0); } while (0); if (!({ bool __cond = (ev != pps-&gt;last_ev); if (__cond &amp;&amp; !__ret) __ret = 1; __cond || !__ret; })) __ret = ({ __label__ __out; struct wait_queue_entry __wq_entry; long __ret = ticks; init_wait_entry(&amp;__wq_entry, 0 ? 0x01 : 0); for (;;) { long __int = prepare_to_wait_event(&amp;pps-&gt;queue, &amp;__wq_entry, 0x0001); if (({ bool __cond = (ev != pps-&gt;last_ev); if (__cond &amp;&amp; !__ret) __ret = 1; __cond || !__ret; })) break; if ((!__builtin_constant_p(0x0001) || 0x0001 == 0x0001 || 0x0001 == (0x0100 | 0x0002)) &amp;&amp; __int) { __ret = __int; goto __out; } __ret = schedule_timeout(__ret); } finish_wait(&amp;pps-&gt;queue, &amp;__wq_entry); __out: __ret; }); __ret; })" data-ref="_M/wait_event_interruptible_timeout">wait_event_interruptible_timeout</a>(</td></tr>
<tr><th id="87">87</th><td>					<a class="local col8 ref" href="#8pps" title='pps' data-ref="8pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::queue" title='pps_device::queue' data-ref="pps_device::queue">queue</a>,</td></tr>
<tr><th id="88">88</th><td>					<a class="local col0 ref" href="#10ev" title='ev' data-ref="10ev">ev</a> != <a class="local col8 ref" href="#8pps" title='pps' data-ref="8pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::last_ev" title='pps_device::last_ev' data-ref="pps_device::last_ev">last_ev</a>,</td></tr>
<tr><th id="89">89</th><td>					<a class="local col2 ref" href="#12ticks" title='ticks' data-ref="12ticks">ticks</a>);</td></tr>
<tr><th id="90">90</th><td>			<b>if</b> (<a class="local col1 ref" href="#11err" title='err' data-ref="11err">err</a> == <var>0</var>)</td></tr>
<tr><th id="91">91</th><td>				<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno.h.html#93" title="110" data-ref="_M/ETIMEDOUT">ETIMEDOUT</a>;</td></tr>
<tr><th id="92">92</th><td>		}</td></tr>
<tr><th id="93">93</th><td>	}</td></tr>
<tr><th id="94">94</th><td></td></tr>
<tr><th id="95">95</th><td>	<i>/* Check for pending signals */</i></td></tr>
<tr><th id="96">96</th><td>	<b>if</b> (<a class="local col1 ref" href="#11err" title='err' data-ref="11err">err</a> == -<a class="macro" href="../../include/linux/errno.h.html#14" title="512" data-ref="_M/ERESTARTSYS">ERESTARTSYS</a>) {</td></tr>
<tr><th id="97">97</th><td>		<a class="macro" href="../../include/linux/device.h.html#1357" title="({ if (0) dev_printk(&quot;\001&quot; &quot;7&quot;, pps-&gt;dev, &quot;pending signal caught\n&quot;); })" data-ref="_M/dev_dbg">dev_dbg</a>(<a class="local col8 ref" href="#8pps" title='pps' data-ref="8pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"pending signal caught\n"</q>);</td></tr>
<tr><th id="98">98</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#8" title="4" data-ref="_M/EINTR">EINTR</a>;</td></tr>
<tr><th id="99">99</th><td>	}</td></tr>
<tr><th id="100">100</th><td></td></tr>
<tr><th id="101">101</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="102">102</th><td>}</td></tr>
<tr><th id="103">103</th><td></td></tr>
<tr><th id="104">104</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="pps_cdev_ioctl" title='pps_cdev_ioctl' data-type='long pps_cdev_ioctl(struct file * file, unsigned int cmd, unsigned long arg)' data-ref="pps_cdev_ioctl">pps_cdev_ioctl</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col3 decl" id="13file" title='file' data-type='struct file *' data-ref="13file">file</dfn>,</td></tr>
<tr><th id="105">105</th><td>		<em>unsigned</em> <em>int</em> <dfn class="local col4 decl" id="14cmd" title='cmd' data-type='unsigned int' data-ref="14cmd">cmd</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="15arg" title='arg' data-type='unsigned long' data-ref="15arg">arg</dfn>)</td></tr>
<tr><th id="106">106</th><td>{</td></tr>
<tr><th id="107">107</th><td>	<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a> *<dfn class="local col6 decl" id="16pps" title='pps' data-type='struct pps_device *' data-ref="16pps">pps</dfn> = <a class="local col3 ref" href="#13file" title='file' data-ref="13file">file</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="108">108</th><td>	<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_kparams" title='pps_kparams' data-ref="pps_kparams">pps_kparams</a> <dfn class="local col7 decl" id="17params" title='params' data-type='struct pps_kparams' data-ref="17params">params</dfn>;</td></tr>
<tr><th id="109">109</th><td>	<em>void</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *<dfn class="local col8 decl" id="18uarg" title='uarg' data-type='void *' data-ref="18uarg">uarg</dfn> = (<em>void</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *) <a class="local col5 ref" href="#15arg" title='arg' data-ref="15arg">arg</a>;</td></tr>
<tr><th id="110">110</th><td>	<em>int</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *<dfn class="local col9 decl" id="19iuarg" title='iuarg' data-type='int *' data-ref="19iuarg">iuarg</dfn> = (<em>int</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *) <a class="local col5 ref" href="#15arg" title='arg' data-ref="15arg">arg</a>;</td></tr>
<tr><th id="111">111</th><td>	<em>int</em> <dfn class="local col0 decl" id="20err" title='err' data-type='int' data-ref="20err">err</dfn>;</td></tr>
<tr><th id="112">112</th><td></td></tr>
<tr><th id="113">113</th><td>	<b>switch</b> (<a class="local col4 ref" href="#14cmd" title='cmd' data-ref="14cmd">cmd</a>) {</td></tr>
<tr><th id="114">114</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/pps.h.html#145" title="(((2U) &lt;&lt; (((0+8)+8)+14)) | (((&apos;p&apos;)) &lt;&lt; (0+8)) | (((0xa1)) &lt;&lt; 0) | (((((sizeof(struct pps_kparams *) == sizeof(struct pps_kparams *[1]) &amp;&amp; sizeof(struct pps_kparams *) &lt; (1 &lt;&lt; 14)) ? sizeof(struct pps_kparams *) : __invalid_size_argument_for_IOC))) &lt;&lt; ((0+8)+8)))" data-ref="_M/PPS_GETPARAMS">PPS_GETPARAMS</a>:</td></tr>
<tr><th id="115">115</th><td>		<a class="macro" href="../../include/linux/device.h.html#1357" title="({ if (0) dev_printk(&quot;\001&quot; &quot;7&quot;, pps-&gt;dev, &quot;PPS_GETPARAMS\n&quot;); })" data-ref="_M/dev_dbg">dev_dbg</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"PPS_GETPARAMS\n"</q>);</td></tr>
<tr><th id="116">116</th><td></td></tr>
<tr><th id="117">117</th><td>		<a class="ref fn" href="../../include/linux/spinlock.h.html#spin_lock_irq" title='spin_lock_irq' data-ref="spin_lock_irq">spin_lock_irq</a>(&amp;<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::lock" title='pps_device::lock' data-ref="pps_device::lock">lock</a>);</td></tr>
<tr><th id="118">118</th><td></td></tr>
<tr><th id="119">119</th><td>		<i>/* Get the current parameters */</i></td></tr>
<tr><th id="120">120</th><td>		<a class="local col7 ref" href="#17params" title='params' data-ref="17params">params</a> = <a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::params" title='pps_device::params' data-ref="pps_device::params">params</a>;</td></tr>
<tr><th id="121">121</th><td></td></tr>
<tr><th id="122">122</th><td>		<a class="ref fn" href="../../include/linux/spinlock.h.html#spin_unlock_irq" title='spin_unlock_irq' data-ref="spin_unlock_irq">spin_unlock_irq</a>(&amp;<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::lock" title='pps_device::lock' data-ref="pps_device::lock">lock</a>);</td></tr>
<tr><th id="123">123</th><td></td></tr>
<tr><th id="124">124</th><td>		<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a> = <a class="ref fn" href="../../include/linux/uaccess.h.html#copy_to_user" title='copy_to_user' data-ref="copy_to_user">copy_to_user</a>(<a class="local col8 ref" href="#18uarg" title='uarg' data-ref="18uarg">uarg</a>, &amp;<a class="local col7 ref" href="#17params" title='params' data-ref="17params">params</a>, <b>sizeof</b>(<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_kparams" title='pps_kparams' data-ref="pps_kparams">pps_kparams</a>));</td></tr>
<tr><th id="125">125</th><td>		<b>if</b> (<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a>)</td></tr>
<tr><th id="126">126</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="127">127</th><td></td></tr>
<tr><th id="128">128</th><td>		<b>break</b>;</td></tr>
<tr><th id="129">129</th><td></td></tr>
<tr><th id="130">130</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/pps.h.html#146" title="(((1U) &lt;&lt; (((0+8)+8)+14)) | (((&apos;p&apos;)) &lt;&lt; (0+8)) | (((0xa2)) &lt;&lt; 0) | (((((sizeof(struct pps_kparams *) == sizeof(struct pps_kparams *[1]) &amp;&amp; sizeof(struct pps_kparams *) &lt; (1 &lt;&lt; 14)) ? sizeof(struct pps_kparams *) : __invalid_size_argument_for_IOC))) &lt;&lt; ((0+8)+8)))" data-ref="_M/PPS_SETPARAMS">PPS_SETPARAMS</a>:</td></tr>
<tr><th id="131">131</th><td>		<a class="macro" href="../../include/linux/device.h.html#1357" title="({ if (0) dev_printk(&quot;\001&quot; &quot;7&quot;, pps-&gt;dev, &quot;PPS_SETPARAMS\n&quot;); })" data-ref="_M/dev_dbg">dev_dbg</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"PPS_SETPARAMS\n"</q>);</td></tr>
<tr><th id="132">132</th><td></td></tr>
<tr><th id="133">133</th><td>		<i>/* Check the capabilities */</i></td></tr>
<tr><th id="134">134</th><td>		<b>if</b> (!<a class="ref fn" href="../../include/linux/capability.h.html#capable" title='capable' data-ref="capable">capable</a>(<a class="macro" href="../../include/uapi/linux/capability.h.html#311" title="25" data-ref="_M/CAP_SYS_TIME">CAP_SYS_TIME</a>))</td></tr>
<tr><th id="135">135</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="136">136</th><td></td></tr>
<tr><th id="137">137</th><td>		<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a> = <a class="ref fn" href="../../include/linux/uaccess.h.html#copy_from_user" title='copy_from_user' data-ref="copy_from_user">copy_from_user</a>(&amp;<a class="local col7 ref" href="#17params" title='params' data-ref="17params">params</a>, <a class="local col8 ref" href="#18uarg" title='uarg' data-ref="18uarg">uarg</a>, <b>sizeof</b>(<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_kparams" title='pps_kparams' data-ref="pps_kparams">pps_kparams</a>));</td></tr>
<tr><th id="138">138</th><td>		<b>if</b> (<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a>)</td></tr>
<tr><th id="139">139</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="140">140</th><td>		<b>if</b> (!(<a class="local col7 ref" href="#17params" title='params' data-ref="17params">params</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kparams::mode" title='pps_kparams::mode' data-ref="pps_kparams::mode">mode</a> &amp; (<a class="macro" href="../../include/uapi/linux/pps.h.html#95" title="0x01" data-ref="_M/PPS_CAPTUREASSERT">PPS_CAPTUREASSERT</a> | <a class="macro" href="../../include/uapi/linux/pps.h.html#96" title="0x02" data-ref="_M/PPS_CAPTURECLEAR">PPS_CAPTURECLEAR</a>))) {</td></tr>
<tr><th id="141">141</th><td>			<a class="macro" href="../../include/linux/device.h.html#1357" title="({ if (0) dev_printk(&quot;\001&quot; &quot;7&quot;, pps-&gt;dev, &quot;capture mode unspecified (%x)\n&quot;, params.mode); })" data-ref="_M/dev_dbg">dev_dbg</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"capture mode unspecified (%x)\n"</q>,</td></tr>
<tr><th id="142">142</th><td>								<a class="local col7 ref" href="#17params" title='params' data-ref="17params">params</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kparams::mode" title='pps_kparams::mode' data-ref="pps_kparams::mode">mode</a>);</td></tr>
<tr><th id="143">143</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="144">144</th><td>		}</td></tr>
<tr><th id="145">145</th><td></td></tr>
<tr><th id="146">146</th><td>		<i>/* Check for supported capabilities */</i></td></tr>
<tr><th id="147">147</th><td>		<b>if</b> ((<a class="local col7 ref" href="#17params" title='params' data-ref="17params">params</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kparams::mode" title='pps_kparams::mode' data-ref="pps_kparams::mode">mode</a> &amp; ~<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::info" title='pps_device::info' data-ref="pps_device::info">info</a>.<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_source_info::mode" title='pps_source_info::mode' data-ref="pps_source_info::mode">mode</a>) != <var>0</var>) {</td></tr>
<tr><th id="148">148</th><td>			<a class="macro" href="../../include/linux/device.h.html#1357" title="({ if (0) dev_printk(&quot;\001&quot; &quot;7&quot;, pps-&gt;dev, &quot;unsupported capabilities (%x)\n&quot;, params.mode); })" data-ref="_M/dev_dbg">dev_dbg</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"unsupported capabilities (%x)\n"</q>,</td></tr>
<tr><th id="149">149</th><td>								<a class="local col7 ref" href="#17params" title='params' data-ref="17params">params</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kparams::mode" title='pps_kparams::mode' data-ref="pps_kparams::mode">mode</a>);</td></tr>
<tr><th id="150">150</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="151">151</th><td>		}</td></tr>
<tr><th id="152">152</th><td></td></tr>
<tr><th id="153">153</th><td>		<a class="ref fn" href="../../include/linux/spinlock.h.html#spin_lock_irq" title='spin_lock_irq' data-ref="spin_lock_irq">spin_lock_irq</a>(&amp;<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::lock" title='pps_device::lock' data-ref="pps_device::lock">lock</a>);</td></tr>
<tr><th id="154">154</th><td></td></tr>
<tr><th id="155">155</th><td>		<i>/* Save the new parameters */</i></td></tr>
<tr><th id="156">156</th><td>		<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::params" title='pps_device::params' data-ref="pps_device::params">params</a> = <a class="local col7 ref" href="#17params" title='params' data-ref="17params">params</a>;</td></tr>
<tr><th id="157">157</th><td></td></tr>
<tr><th id="158">158</th><td>		<i>/* Restore the read only parameters */</i></td></tr>
<tr><th id="159">159</th><td>		<b>if</b> ((<a class="local col7 ref" href="#17params" title='params' data-ref="17params">params</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kparams::mode" title='pps_kparams::mode' data-ref="pps_kparams::mode">mode</a> &amp; (<a class="macro" href="../../include/uapi/linux/pps.h.html#110" title="0x1000" data-ref="_M/PPS_TSFMT_TSPEC">PPS_TSFMT_TSPEC</a> | <a class="macro" href="../../include/uapi/linux/pps.h.html#111" title="0x2000" data-ref="_M/PPS_TSFMT_NTPFP">PPS_TSFMT_NTPFP</a>)) == <var>0</var>) {</td></tr>
<tr><th id="160">160</th><td>			<i>/* section 3.3 of RFC 2783 interpreted */</i></td></tr>
<tr><th id="161">161</th><td>			<a class="macro" href="../../include/linux/device.h.html#1357" title="({ if (0) dev_printk(&quot;\001&quot; &quot;7&quot;, pps-&gt;dev, &quot;time format unspecified (%x)\n&quot;, params.mode); })" data-ref="_M/dev_dbg">dev_dbg</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"time format unspecified (%x)\n"</q>,</td></tr>
<tr><th id="162">162</th><td>								<a class="local col7 ref" href="#17params" title='params' data-ref="17params">params</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kparams::mode" title='pps_kparams::mode' data-ref="pps_kparams::mode">mode</a>);</td></tr>
<tr><th id="163">163</th><td>			<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::params" title='pps_device::params' data-ref="pps_device::params">params</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kparams::mode" title='pps_kparams::mode' data-ref="pps_kparams::mode">mode</a> |= <a class="macro" href="../../include/uapi/linux/pps.h.html#110" title="0x1000" data-ref="_M/PPS_TSFMT_TSPEC">PPS_TSFMT_TSPEC</a>;</td></tr>
<tr><th id="164">164</th><td>		}</td></tr>
<tr><th id="165">165</th><td>		<b>if</b> (<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::info" title='pps_device::info' data-ref="pps_device::info">info</a>.<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_source_info::mode" title='pps_source_info::mode' data-ref="pps_source_info::mode">mode</a> &amp; <a class="macro" href="../../include/uapi/linux/pps.h.html#102" title="0x100" data-ref="_M/PPS_CANWAIT">PPS_CANWAIT</a>)</td></tr>
<tr><th id="166">166</th><td>			<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::params" title='pps_device::params' data-ref="pps_device::params">params</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kparams::mode" title='pps_kparams::mode' data-ref="pps_kparams::mode">mode</a> |= <a class="macro" href="../../include/uapi/linux/pps.h.html#102" title="0x100" data-ref="_M/PPS_CANWAIT">PPS_CANWAIT</a>;</td></tr>
<tr><th id="167">167</th><td>		<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::params" title='pps_device::params' data-ref="pps_device::params">params</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kparams::api_version" title='pps_kparams::api_version' data-ref="pps_kparams::api_version">api_version</a> = <a class="macro" href="../../include/uapi/linux/pps.h.html#40" title="1" data-ref="_M/PPS_API_VERS">PPS_API_VERS</a>;</td></tr>
<tr><th id="168">168</th><td></td></tr>
<tr><th id="169">169</th><td>		<a class="ref fn" href="../../include/linux/spinlock.h.html#spin_unlock_irq" title='spin_unlock_irq' data-ref="spin_unlock_irq">spin_unlock_irq</a>(&amp;<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::lock" title='pps_device::lock' data-ref="pps_device::lock">lock</a>);</td></tr>
<tr><th id="170">170</th><td></td></tr>
<tr><th id="171">171</th><td>		<b>break</b>;</td></tr>
<tr><th id="172">172</th><td></td></tr>
<tr><th id="173">173</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/pps.h.html#147" title="(((2U) &lt;&lt; (((0+8)+8)+14)) | (((&apos;p&apos;)) &lt;&lt; (0+8)) | (((0xa3)) &lt;&lt; 0) | (((((sizeof(int *) == sizeof(int *[1]) &amp;&amp; sizeof(int *) &lt; (1 &lt;&lt; 14)) ? sizeof(int *) : __invalid_size_argument_for_IOC))) &lt;&lt; ((0+8)+8)))" data-ref="_M/PPS_GETCAP">PPS_GETCAP</a>:</td></tr>
<tr><th id="174">174</th><td>		<a class="macro" href="../../include/linux/device.h.html#1357" title="({ if (0) dev_printk(&quot;\001&quot; &quot;7&quot;, pps-&gt;dev, &quot;PPS_GETCAP\n&quot;); })" data-ref="_M/dev_dbg">dev_dbg</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"PPS_GETCAP\n"</q>);</td></tr>
<tr><th id="175">175</th><td></td></tr>
<tr><th id="176">176</th><td>		<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a> = <a class="macro" href="../../arch/x86/include/asm/uaccess.h.html#254" title="({ int __ret_pu; __typeof__(*(iuarg)) __pu_val; (void)0; might_fault(); __pu_val = pps-&gt;info.mode; switch (sizeof(*(iuarg))) { case 1: asm volatile(&quot;call __put_user_&quot; &quot;1&quot; : &quot;=a&quot; (__ret_pu) : &quot;0&quot; ((typeof(*(iuarg)))(__pu_val)), &quot;c&quot; (iuarg) : &quot;ebx&quot;); break; case 2: asm volatile(&quot;call __put_user_&quot; &quot;2&quot; : &quot;=a&quot; (__ret_pu) : &quot;0&quot; ((typeof(*(iuarg)))(__pu_val)), &quot;c&quot; (iuarg) : &quot;ebx&quot;); break; case 4: asm volatile(&quot;call __put_user_&quot; &quot;4&quot; : &quot;=a&quot; (__ret_pu) : &quot;0&quot; ((typeof(*(iuarg)))(__pu_val)), &quot;c&quot; (iuarg) : &quot;ebx&quot;); break; case 8: asm volatile(&quot;call __put_user_&quot; &quot;8&quot; : &quot;=a&quot; (__ret_pu) : &quot;0&quot; ((typeof(*(iuarg)))(__pu_val)), &quot;c&quot; (iuarg) : &quot;ebx&quot;); break; default: asm volatile(&quot;call __put_user_&quot; &quot;X&quot; : &quot;=a&quot; (__ret_pu) : &quot;0&quot; ((typeof(*(iuarg)))(__pu_val)), &quot;c&quot; (iuarg) : &quot;ebx&quot;); break; } __builtin_expect(__ret_pu, 0); })" data-ref="_M/put_user">put_user</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::info" title='pps_device::info' data-ref="pps_device::info">info</a>.<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_source_info::mode" title='pps_source_info::mode' data-ref="pps_source_info::mode">mode</a>, <a class="local col9 ref" href="#19iuarg" title='iuarg' data-ref="19iuarg">iuarg</a>);</td></tr>
<tr><th id="177">177</th><td>		<b>if</b> (<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a>)</td></tr>
<tr><th id="178">178</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="179">179</th><td></td></tr>
<tr><th id="180">180</th><td>		<b>break</b>;</td></tr>
<tr><th id="181">181</th><td></td></tr>
<tr><th id="182">182</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/pps.h.html#148" title="(((2U|1U) &lt;&lt; (((0+8)+8)+14)) | (((&apos;p&apos;)) &lt;&lt; (0+8)) | (((0xa4)) &lt;&lt; 0) | (((((sizeof(struct pps_fdata *) == sizeof(struct pps_fdata *[1]) &amp;&amp; sizeof(struct pps_fdata *) &lt; (1 &lt;&lt; 14)) ? sizeof(struct pps_fdata *) : __invalid_size_argument_for_IOC))) &lt;&lt; ((0+8)+8)))" data-ref="_M/PPS_FETCH">PPS_FETCH</a>: {</td></tr>
<tr><th id="183">183</th><td>		<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_fdata" title='pps_fdata' data-ref="pps_fdata">pps_fdata</a> <dfn class="local col1 decl" id="21fdata" title='fdata' data-type='struct pps_fdata' data-ref="21fdata">fdata</dfn>;</td></tr>
<tr><th id="184">184</th><td></td></tr>
<tr><th id="185">185</th><td>		<a class="macro" href="../../include/linux/device.h.html#1357" title="({ if (0) dev_printk(&quot;\001&quot; &quot;7&quot;, pps-&gt;dev, &quot;PPS_FETCH\n&quot;); })" data-ref="_M/dev_dbg">dev_dbg</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"PPS_FETCH\n"</q>);</td></tr>
<tr><th id="186">186</th><td></td></tr>
<tr><th id="187">187</th><td>		<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a> = <a class="ref fn" href="../../include/linux/uaccess.h.html#copy_from_user" title='copy_from_user' data-ref="copy_from_user">copy_from_user</a>(&amp;<a class="local col1 ref" href="#21fdata" title='fdata' data-ref="21fdata">fdata</a>, <a class="local col8 ref" href="#18uarg" title='uarg' data-ref="18uarg">uarg</a>, <b>sizeof</b>(<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_fdata" title='pps_fdata' data-ref="pps_fdata">pps_fdata</a>));</td></tr>
<tr><th id="188">188</th><td>		<b>if</b> (<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a>)</td></tr>
<tr><th id="189">189</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="190">190</th><td></td></tr>
<tr><th id="191">191</th><td>		<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a> = <a class="tu ref fn" href="#pps_cdev_pps_fetch" title='pps_cdev_pps_fetch' data-use='c' data-ref="pps_cdev_pps_fetch">pps_cdev_pps_fetch</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>, &amp;<a class="local col1 ref" href="#21fdata" title='fdata' data-ref="21fdata">fdata</a>);</td></tr>
<tr><th id="192">192</th><td>		<b>if</b> (<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a>)</td></tr>
<tr><th id="193">193</th><td>			<b>return</b> <a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a>;</td></tr>
<tr><th id="194">194</th><td></td></tr>
<tr><th id="195">195</th><td>		<i>/* Return the fetched timestamp */</i></td></tr>
<tr><th id="196">196</th><td>		<a class="ref fn" href="../../include/linux/spinlock.h.html#spin_lock_irq" title='spin_lock_irq' data-ref="spin_lock_irq">spin_lock_irq</a>(&amp;<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::lock" title='pps_device::lock' data-ref="pps_device::lock">lock</a>);</td></tr>
<tr><th id="197">197</th><td></td></tr>
<tr><th id="198">198</th><td>		<a class="local col1 ref" href="#21fdata" title='fdata' data-ref="21fdata">fdata</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata::info" title='pps_fdata::info' data-ref="pps_fdata::info">info</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kinfo::assert_sequence" title='pps_kinfo::assert_sequence' data-ref="pps_kinfo::assert_sequence">assert_sequence</a> = <a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::assert_sequence" title='pps_device::assert_sequence' data-ref="pps_device::assert_sequence">assert_sequence</a>;</td></tr>
<tr><th id="199">199</th><td>		<a class="local col1 ref" href="#21fdata" title='fdata' data-ref="21fdata">fdata</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata::info" title='pps_fdata::info' data-ref="pps_fdata::info">info</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kinfo::clear_sequence" title='pps_kinfo::clear_sequence' data-ref="pps_kinfo::clear_sequence">clear_sequence</a> = <a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::clear_sequence" title='pps_device::clear_sequence' data-ref="pps_device::clear_sequence">clear_sequence</a>;</td></tr>
<tr><th id="200">200</th><td>		<a class="local col1 ref" href="#21fdata" title='fdata' data-ref="21fdata">fdata</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata::info" title='pps_fdata::info' data-ref="pps_fdata::info">info</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kinfo::assert_tu" title='pps_kinfo::assert_tu' data-ref="pps_kinfo::assert_tu">assert_tu</a> = <a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::assert_tu" title='pps_device::assert_tu' data-ref="pps_device::assert_tu">assert_tu</a>;</td></tr>
<tr><th id="201">201</th><td>		<a class="local col1 ref" href="#21fdata" title='fdata' data-ref="21fdata">fdata</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata::info" title='pps_fdata::info' data-ref="pps_fdata::info">info</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kinfo::clear_tu" title='pps_kinfo::clear_tu' data-ref="pps_kinfo::clear_tu">clear_tu</a> = <a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::clear_tu" title='pps_device::clear_tu' data-ref="pps_device::clear_tu">clear_tu</a>;</td></tr>
<tr><th id="202">202</th><td>		<a class="local col1 ref" href="#21fdata" title='fdata' data-ref="21fdata">fdata</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata::info" title='pps_fdata::info' data-ref="pps_fdata::info">info</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kinfo::current_mode" title='pps_kinfo::current_mode' data-ref="pps_kinfo::current_mode">current_mode</a> = <a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::current_mode" title='pps_device::current_mode' data-ref="pps_device::current_mode">current_mode</a>;</td></tr>
<tr><th id="203">203</th><td></td></tr>
<tr><th id="204">204</th><td>		<a class="ref fn" href="../../include/linux/spinlock.h.html#spin_unlock_irq" title='spin_unlock_irq' data-ref="spin_unlock_irq">spin_unlock_irq</a>(&amp;<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::lock" title='pps_device::lock' data-ref="pps_device::lock">lock</a>);</td></tr>
<tr><th id="205">205</th><td></td></tr>
<tr><th id="206">206</th><td>		<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a> = <a class="ref fn" href="../../include/linux/uaccess.h.html#copy_to_user" title='copy_to_user' data-ref="copy_to_user">copy_to_user</a>(<a class="local col8 ref" href="#18uarg" title='uarg' data-ref="18uarg">uarg</a>, &amp;<a class="local col1 ref" href="#21fdata" title='fdata' data-ref="21fdata">fdata</a>, <b>sizeof</b>(<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_fdata" title='pps_fdata' data-ref="pps_fdata">pps_fdata</a>));</td></tr>
<tr><th id="207">207</th><td>		<b>if</b> (<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a>)</td></tr>
<tr><th id="208">208</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="209">209</th><td></td></tr>
<tr><th id="210">210</th><td>		<b>break</b>;</td></tr>
<tr><th id="211">211</th><td>	}</td></tr>
<tr><th id="212">212</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/pps.h.html#149" title="(((1U) &lt;&lt; (((0+8)+8)+14)) | (((&apos;p&apos;)) &lt;&lt; (0+8)) | (((0xa5)) &lt;&lt; 0) | (((((sizeof(struct pps_bind_args *) == sizeof(struct pps_bind_args *[1]) &amp;&amp; sizeof(struct pps_bind_args *) &lt; (1 &lt;&lt; 14)) ? sizeof(struct pps_bind_args *) : __invalid_size_argument_for_IOC))) &lt;&lt; ((0+8)+8)))" data-ref="_M/PPS_KC_BIND">PPS_KC_BIND</a>: {</td></tr>
<tr><th id="213">213</th><td>		<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_bind_args" title='pps_bind_args' data-ref="pps_bind_args">pps_bind_args</a> <dfn class="local col2 decl" id="22bind_args" title='bind_args' data-type='struct pps_bind_args' data-ref="22bind_args">bind_args</dfn>;</td></tr>
<tr><th id="214">214</th><td></td></tr>
<tr><th id="215">215</th><td>		<a class="macro" href="../../include/linux/device.h.html#1357" title="({ if (0) dev_printk(&quot;\001&quot; &quot;7&quot;, pps-&gt;dev, &quot;PPS_KC_BIND\n&quot;); })" data-ref="_M/dev_dbg">dev_dbg</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"PPS_KC_BIND\n"</q>);</td></tr>
<tr><th id="216">216</th><td></td></tr>
<tr><th id="217">217</th><td>		<i>/* Check the capabilities */</i></td></tr>
<tr><th id="218">218</th><td>		<b>if</b> (!<a class="ref fn" href="../../include/linux/capability.h.html#capable" title='capable' data-ref="capable">capable</a>(<a class="macro" href="../../include/uapi/linux/capability.h.html#311" title="25" data-ref="_M/CAP_SYS_TIME">CAP_SYS_TIME</a>))</td></tr>
<tr><th id="219">219</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="220">220</th><td></td></tr>
<tr><th id="221">221</th><td>		<b>if</b> (<a class="ref fn" href="../../include/linux/uaccess.h.html#copy_from_user" title='copy_from_user' data-ref="copy_from_user">copy_from_user</a>(&amp;<a class="local col2 ref" href="#22bind_args" title='bind_args' data-ref="22bind_args">bind_args</a>, <a class="local col8 ref" href="#18uarg" title='uarg' data-ref="18uarg">uarg</a>,</td></tr>
<tr><th id="222">222</th><td>					<b>sizeof</b>(<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_bind_args" title='pps_bind_args' data-ref="pps_bind_args">pps_bind_args</a>)))</td></tr>
<tr><th id="223">223</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="224">224</th><td></td></tr>
<tr><th id="225">225</th><td>		<i>/* Check for supported capabilities */</i></td></tr>
<tr><th id="226">226</th><td>		<b>if</b> ((<a class="local col2 ref" href="#22bind_args" title='bind_args' data-ref="22bind_args">bind_args</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_bind_args::edge" title='pps_bind_args::edge' data-ref="pps_bind_args::edge">edge</a> &amp; ~<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::info" title='pps_device::info' data-ref="pps_device::info">info</a>.<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_source_info::mode" title='pps_source_info::mode' data-ref="pps_source_info::mode">mode</a>) != <var>0</var>) {</td></tr>
<tr><th id="227">227</th><td>			<a class="ref fn" href="../../include/linux/device.h.html#dev_err" title='dev_err' data-ref="dev_err">dev_err</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"unsupported capabilities (%x)\n"</q>,</td></tr>
<tr><th id="228">228</th><td>					<a class="local col2 ref" href="#22bind_args" title='bind_args' data-ref="22bind_args">bind_args</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_bind_args::edge" title='pps_bind_args::edge' data-ref="pps_bind_args::edge">edge</a>);</td></tr>
<tr><th id="229">229</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="230">230</th><td>		}</td></tr>
<tr><th id="231">231</th><td></td></tr>
<tr><th id="232">232</th><td>		<i>/* Validate parameters roughly */</i></td></tr>
<tr><th id="233">233</th><td>		<b>if</b> (<a class="local col2 ref" href="#22bind_args" title='bind_args' data-ref="22bind_args">bind_args</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_bind_args::tsformat" title='pps_bind_args::tsformat' data-ref="pps_bind_args::tsformat">tsformat</a> != <a class="macro" href="../../include/uapi/linux/pps.h.html#110" title="0x1000" data-ref="_M/PPS_TSFMT_TSPEC">PPS_TSFMT_TSPEC</a> ||</td></tr>
<tr><th id="234">234</th><td>				(<a class="local col2 ref" href="#22bind_args" title='bind_args' data-ref="22bind_args">bind_args</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_bind_args::edge" title='pps_bind_args::edge' data-ref="pps_bind_args::edge">edge</a> &amp; ~<a class="macro" href="../../include/uapi/linux/pps.h.html#97" title="0x03" data-ref="_M/PPS_CAPTUREBOTH">PPS_CAPTUREBOTH</a>) != <var>0</var> ||</td></tr>
<tr><th id="235">235</th><td>				<a class="local col2 ref" href="#22bind_args" title='bind_args' data-ref="22bind_args">bind_args</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_bind_args::consumer" title='pps_bind_args::consumer' data-ref="pps_bind_args::consumer">consumer</a> != <a class="macro" href="../../include/uapi/linux/pps.h.html#118" title="0" data-ref="_M/PPS_KC_HARDPPS">PPS_KC_HARDPPS</a>) {</td></tr>
<tr><th id="236">236</th><td>			<a class="ref fn" href="../../include/linux/device.h.html#dev_err" title='dev_err' data-ref="dev_err">dev_err</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"invalid kernel consumer bind"</q></td></tr>
<tr><th id="237">237</th><td>					<q>" parameters (%x)\n"</q>, <a class="local col2 ref" href="#22bind_args" title='bind_args' data-ref="22bind_args">bind_args</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_bind_args::edge" title='pps_bind_args::edge' data-ref="pps_bind_args::edge">edge</a>);</td></tr>
<tr><th id="238">238</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="239">239</th><td>		}</td></tr>
<tr><th id="240">240</th><td></td></tr>
<tr><th id="241">241</th><td>		<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a> = <a class="ref fn" href="kc.h.html#pps_kc_bind" title='pps_kc_bind' data-ref="pps_kc_bind">pps_kc_bind</a>(<a class="local col6 ref" href="#16pps" title='pps' data-ref="16pps">pps</a>, &amp;<a class="local col2 ref" href="#22bind_args" title='bind_args' data-ref="22bind_args">bind_args</a>);</td></tr>
<tr><th id="242">242</th><td>		<b>if</b> (<a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a> &lt; <var>0</var>)</td></tr>
<tr><th id="243">243</th><td>			<b>return</b> <a class="local col0 ref" href="#20err" title='err' data-ref="20err">err</a>;</td></tr>
<tr><th id="244">244</th><td></td></tr>
<tr><th id="245">245</th><td>		<b>break</b>;</td></tr>
<tr><th id="246">246</th><td>	}</td></tr>
<tr><th id="247">247</th><td>	<b>default</b>:</td></tr>
<tr><th id="248">248</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#29" title="25" data-ref="_M/ENOTTY">ENOTTY</a>;</td></tr>
<tr><th id="249">249</th><td>	}</td></tr>
<tr><th id="250">250</th><td></td></tr>
<tr><th id="251">251</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="252">252</th><td>}</td></tr>
<tr><th id="253">253</th><td></td></tr>
<tr><th id="254">254</th><td><u>#<span data-ppcond="254">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#93" data-ref="_M/CONFIG_COMPAT">CONFIG_COMPAT</a></u></td></tr>
<tr><th id="255">255</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="pps_cdev_compat_ioctl" title='pps_cdev_compat_ioctl' data-type='long pps_cdev_compat_ioctl(struct file * file, unsigned int cmd, unsigned long arg)' data-ref="pps_cdev_compat_ioctl">pps_cdev_compat_ioctl</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col3 decl" id="23file" title='file' data-type='struct file *' data-ref="23file">file</dfn>,</td></tr>
<tr><th id="256">256</th><td>		<em>unsigned</em> <em>int</em> <dfn class="local col4 decl" id="24cmd" title='cmd' data-type='unsigned int' data-ref="24cmd">cmd</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="25arg" title='arg' data-type='unsigned long' data-ref="25arg">arg</dfn>)</td></tr>
<tr><th id="257">257</th><td>{</td></tr>
<tr><th id="258">258</th><td>	<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a> *<dfn class="local col6 decl" id="26pps" title='pps' data-type='struct pps_device *' data-ref="26pps">pps</dfn> = <a class="local col3 ref" href="#23file" title='file' data-ref="23file">file</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="259">259</th><td>	<em>void</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *<dfn class="local col7 decl" id="27uarg" title='uarg' data-type='void *' data-ref="27uarg">uarg</dfn> = (<em>void</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *) <a class="local col5 ref" href="#25arg" title='arg' data-ref="25arg">arg</a>;</td></tr>
<tr><th id="260">260</th><td></td></tr>
<tr><th id="261">261</th><td>	<a class="local col4 ref" href="#24cmd" title='cmd' data-ref="24cmd">cmd</a> = <a class="macro" href="../../include/uapi/asm-generic/ioctl.h.html#69" title="((((((cmd) &gt;&gt; (((0+8)+8)+14)) &amp; ((1 &lt;&lt; 2)-1))) &lt;&lt; (((0+8)+8)+14)) | (((((cmd) &gt;&gt; (0+8)) &amp; ((1 &lt;&lt; 8)-1))) &lt;&lt; (0+8)) | (((((cmd) &gt;&gt; 0) &amp; ((1 &lt;&lt; 8)-1))) &lt;&lt; 0) | ((sizeof(void *)) &lt;&lt; ((0+8)+8)))" data-ref="_M/_IOC">_IOC</a>(<a class="macro" href="../../include/uapi/asm-generic/ioctl.h.html#94" title="(((cmd) &gt;&gt; (((0+8)+8)+14)) &amp; ((1 &lt;&lt; 2)-1))" data-ref="_M/_IOC_DIR">_IOC_DIR</a>(<a class="local col4 ref" href="#24cmd" title='cmd' data-ref="24cmd">cmd</a>), <a class="macro" href="../../include/uapi/asm-generic/ioctl.h.html#95" title="(((cmd) &gt;&gt; (0+8)) &amp; ((1 &lt;&lt; 8)-1))" data-ref="_M/_IOC_TYPE">_IOC_TYPE</a>(<a class="local col4 ref" href="#24cmd" title='cmd' data-ref="24cmd">cmd</a>), <a class="macro" href="../../include/uapi/asm-generic/ioctl.h.html#96" title="(((cmd) &gt;&gt; 0) &amp; ((1 &lt;&lt; 8)-1))" data-ref="_M/_IOC_NR">_IOC_NR</a>(<a class="local col4 ref" href="#24cmd" title='cmd' data-ref="24cmd">cmd</a>), <b>sizeof</b>(<em>void</em> *));</td></tr>
<tr><th id="262">262</th><td></td></tr>
<tr><th id="263">263</th><td>	<b>if</b> (<a class="local col4 ref" href="#24cmd" title='cmd' data-ref="24cmd">cmd</a> == <a class="macro" href="../../include/uapi/linux/pps.h.html#148" title="(((2U|1U) &lt;&lt; (((0+8)+8)+14)) | (((&apos;p&apos;)) &lt;&lt; (0+8)) | (((0xa4)) &lt;&lt; 0) | (((((sizeof(struct pps_fdata *) == sizeof(struct pps_fdata *[1]) &amp;&amp; sizeof(struct pps_fdata *) &lt; (1 &lt;&lt; 14)) ? sizeof(struct pps_fdata *) : __invalid_size_argument_for_IOC))) &lt;&lt; ((0+8)+8)))" data-ref="_M/PPS_FETCH">PPS_FETCH</a>) {</td></tr>
<tr><th id="264">264</th><td>		<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_fdata_compat" title='pps_fdata_compat' data-ref="pps_fdata_compat">pps_fdata_compat</a> <dfn class="local col8 decl" id="28compat" title='compat' data-type='struct pps_fdata_compat' data-ref="28compat">compat</dfn>;</td></tr>
<tr><th id="265">265</th><td>		<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_fdata" title='pps_fdata' data-ref="pps_fdata">pps_fdata</a> <dfn class="local col9 decl" id="29fdata" title='fdata' data-type='struct pps_fdata' data-ref="29fdata">fdata</dfn>;</td></tr>
<tr><th id="266">266</th><td>		<em>int</em> <dfn class="local col0 decl" id="30err" title='err' data-type='int' data-ref="30err">err</dfn>;</td></tr>
<tr><th id="267">267</th><td></td></tr>
<tr><th id="268">268</th><td>		<a class="macro" href="../../include/linux/device.h.html#1357" title="({ if (0) dev_printk(&quot;\001&quot; &quot;7&quot;, pps-&gt;dev, &quot;PPS_FETCH\n&quot;); })" data-ref="_M/dev_dbg">dev_dbg</a>(<a class="local col6 ref" href="#26pps" title='pps' data-ref="26pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>, <q>"PPS_FETCH\n"</q>);</td></tr>
<tr><th id="269">269</th><td></td></tr>
<tr><th id="270">270</th><td>		<a class="local col0 ref" href="#30err" title='err' data-ref="30err">err</a> = <a class="ref fn" href="../../include/linux/uaccess.h.html#copy_from_user" title='copy_from_user' data-ref="copy_from_user">copy_from_user</a>(&amp;<a class="local col8 ref" href="#28compat" title='compat' data-ref="28compat">compat</a>, <a class="local col7 ref" href="#27uarg" title='uarg' data-ref="27uarg">uarg</a>, <b>sizeof</b>(<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_fdata_compat" title='pps_fdata_compat' data-ref="pps_fdata_compat">pps_fdata_compat</a>));</td></tr>
<tr><th id="271">271</th><td>		<b>if</b> (<a class="local col0 ref" href="#30err" title='err' data-ref="30err">err</a>)</td></tr>
<tr><th id="272">272</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="273">273</th><td></td></tr>
<tr><th id="274">274</th><td>		<a class="macro" href="../../arch/x86/include/asm/string_64.h.html#37" title="({ size_t __len = (sizeof(struct pps_ktime_compat)); void *__ret; if (__builtin_constant_p(sizeof(struct pps_ktime_compat)) &amp;&amp; __len &gt;= 64) __ret = __memcpy((&amp;fdata.timeout), (&amp;compat.timeout), __len); else __ret = __builtin_memcpy((&amp;fdata.timeout), (&amp;compat.timeout), __len); __ret; })" data-ref="_M/memcpy">memcpy</a>(&amp;<a class="local col9 ref" href="#29fdata" title='fdata' data-ref="29fdata">fdata</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata::timeout" title='pps_fdata::timeout' data-ref="pps_fdata::timeout">timeout</a>, &amp;<a class="local col8 ref" href="#28compat" title='compat' data-ref="28compat">compat</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata_compat::timeout" title='pps_fdata_compat::timeout' data-ref="pps_fdata_compat::timeout">timeout</a>,</td></tr>
<tr><th id="275">275</th><td>					<b>sizeof</b>(<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_ktime_compat" title='pps_ktime_compat' data-ref="pps_ktime_compat">pps_ktime_compat</a>));</td></tr>
<tr><th id="276">276</th><td></td></tr>
<tr><th id="277">277</th><td>		<a class="local col0 ref" href="#30err" title='err' data-ref="30err">err</a> = <a class="tu ref fn" href="#pps_cdev_pps_fetch" title='pps_cdev_pps_fetch' data-use='c' data-ref="pps_cdev_pps_fetch">pps_cdev_pps_fetch</a>(<a class="local col6 ref" href="#26pps" title='pps' data-ref="26pps">pps</a>, &amp;<a class="local col9 ref" href="#29fdata" title='fdata' data-ref="29fdata">fdata</a>);</td></tr>
<tr><th id="278">278</th><td>		<b>if</b> (<a class="local col0 ref" href="#30err" title='err' data-ref="30err">err</a>)</td></tr>
<tr><th id="279">279</th><td>			<b>return</b> <a class="local col0 ref" href="#30err" title='err' data-ref="30err">err</a>;</td></tr>
<tr><th id="280">280</th><td></td></tr>
<tr><th id="281">281</th><td>		<i>/* Return the fetched timestamp */</i></td></tr>
<tr><th id="282">282</th><td>		<a class="ref fn" href="../../include/linux/spinlock.h.html#spin_lock_irq" title='spin_lock_irq' data-ref="spin_lock_irq">spin_lock_irq</a>(&amp;<a class="local col6 ref" href="#26pps" title='pps' data-ref="26pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::lock" title='pps_device::lock' data-ref="pps_device::lock">lock</a>);</td></tr>
<tr><th id="283">283</th><td></td></tr>
<tr><th id="284">284</th><td>		<a class="local col8 ref" href="#28compat" title='compat' data-ref="28compat">compat</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata_compat::info" title='pps_fdata_compat::info' data-ref="pps_fdata_compat::info">info</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kinfo_compat::assert_sequence" title='pps_kinfo_compat::assert_sequence' data-ref="pps_kinfo_compat::assert_sequence">assert_sequence</a> = <a class="local col6 ref" href="#26pps" title='pps' data-ref="26pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::assert_sequence" title='pps_device::assert_sequence' data-ref="pps_device::assert_sequence">assert_sequence</a>;</td></tr>
<tr><th id="285">285</th><td>		<a class="local col8 ref" href="#28compat" title='compat' data-ref="28compat">compat</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata_compat::info" title='pps_fdata_compat::info' data-ref="pps_fdata_compat::info">info</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kinfo_compat::clear_sequence" title='pps_kinfo_compat::clear_sequence' data-ref="pps_kinfo_compat::clear_sequence">clear_sequence</a> = <a class="local col6 ref" href="#26pps" title='pps' data-ref="26pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::clear_sequence" title='pps_device::clear_sequence' data-ref="pps_device::clear_sequence">clear_sequence</a>;</td></tr>
<tr><th id="286">286</th><td>		<a class="local col8 ref" href="#28compat" title='compat' data-ref="28compat">compat</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata_compat::info" title='pps_fdata_compat::info' data-ref="pps_fdata_compat::info">info</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kinfo_compat::current_mode" title='pps_kinfo_compat::current_mode' data-ref="pps_kinfo_compat::current_mode">current_mode</a> = <a class="local col6 ref" href="#26pps" title='pps' data-ref="26pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::current_mode" title='pps_device::current_mode' data-ref="pps_device::current_mode">current_mode</a>;</td></tr>
<tr><th id="287">287</th><td></td></tr>
<tr><th id="288">288</th><td>		<a class="macro" href="../../arch/x86/include/asm/string_64.h.html#37" title="({ size_t __len = (sizeof(struct pps_ktime_compat)); void *__ret; if (__builtin_constant_p(sizeof(struct pps_ktime_compat)) &amp;&amp; __len &gt;= 64) __ret = __memcpy((&amp;compat.info.assert_tu), (&amp;pps-&gt;assert_tu), __len); else __ret = __builtin_memcpy((&amp;compat.info.assert_tu), (&amp;pps-&gt;assert_tu), __len); __ret; })" data-ref="_M/memcpy">memcpy</a>(&amp;<a class="local col8 ref" href="#28compat" title='compat' data-ref="28compat">compat</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata_compat::info" title='pps_fdata_compat::info' data-ref="pps_fdata_compat::info">info</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kinfo_compat::assert_tu" title='pps_kinfo_compat::assert_tu' data-ref="pps_kinfo_compat::assert_tu">assert_tu</a>, &amp;<a class="local col6 ref" href="#26pps" title='pps' data-ref="26pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::assert_tu" title='pps_device::assert_tu' data-ref="pps_device::assert_tu">assert_tu</a>,</td></tr>
<tr><th id="289">289</th><td>				<b>sizeof</b>(<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_ktime_compat" title='pps_ktime_compat' data-ref="pps_ktime_compat">pps_ktime_compat</a>));</td></tr>
<tr><th id="290">290</th><td>		<a class="macro" href="../../arch/x86/include/asm/string_64.h.html#37" title="({ size_t __len = (sizeof(struct pps_ktime_compat)); void *__ret; if (__builtin_constant_p(sizeof(struct pps_ktime_compat)) &amp;&amp; __len &gt;= 64) __ret = __memcpy((&amp;compat.info.clear_tu), (&amp;pps-&gt;clear_tu), __len); else __ret = __builtin_memcpy((&amp;compat.info.clear_tu), (&amp;pps-&gt;clear_tu), __len); __ret; })" data-ref="_M/memcpy">memcpy</a>(&amp;<a class="local col8 ref" href="#28compat" title='compat' data-ref="28compat">compat</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_fdata_compat::info" title='pps_fdata_compat::info' data-ref="pps_fdata_compat::info">info</a>.<a class="ref field" href="../../include/uapi/linux/pps.h.html#pps_kinfo_compat::clear_tu" title='pps_kinfo_compat::clear_tu' data-ref="pps_kinfo_compat::clear_tu">clear_tu</a>, &amp;<a class="local col6 ref" href="#26pps" title='pps' data-ref="26pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::clear_tu" title='pps_device::clear_tu' data-ref="pps_device::clear_tu">clear_tu</a>,</td></tr>
<tr><th id="291">291</th><td>				<b>sizeof</b>(<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_ktime_compat" title='pps_ktime_compat' data-ref="pps_ktime_compat">pps_ktime_compat</a>));</td></tr>
<tr><th id="292">292</th><td></td></tr>
<tr><th id="293">293</th><td>		<a class="ref fn" href="../../include/linux/spinlock.h.html#spin_unlock_irq" title='spin_unlock_irq' data-ref="spin_unlock_irq">spin_unlock_irq</a>(&amp;<a class="local col6 ref" href="#26pps" title='pps' data-ref="26pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::lock" title='pps_device::lock' data-ref="pps_device::lock">lock</a>);</td></tr>
<tr><th id="294">294</th><td></td></tr>
<tr><th id="295">295</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/uaccess.h.html#copy_to_user" title='copy_to_user' data-ref="copy_to_user">copy_to_user</a>(<a class="local col7 ref" href="#27uarg" title='uarg' data-ref="27uarg">uarg</a>, &amp;<a class="local col8 ref" href="#28compat" title='compat' data-ref="28compat">compat</a>,</td></tr>
<tr><th id="296">296</th><td>				<b>sizeof</b>(<b>struct</b> <a class="type" href="../../include/uapi/linux/pps.h.html#pps_fdata_compat" title='pps_fdata_compat' data-ref="pps_fdata_compat">pps_fdata_compat</a>)) ? -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a> : <var>0</var>;</td></tr>
<tr><th id="297">297</th><td>	}</td></tr>
<tr><th id="298">298</th><td></td></tr>
<tr><th id="299">299</th><td>	<b>return</b> <a class="tu ref fn" href="#pps_cdev_ioctl" title='pps_cdev_ioctl' data-use='c' data-ref="pps_cdev_ioctl">pps_cdev_ioctl</a>(<a class="local col3 ref" href="#23file" title='file' data-ref="23file">file</a>, <a class="local col4 ref" href="#24cmd" title='cmd' data-ref="24cmd">cmd</a>, <a class="local col5 ref" href="#25arg" title='arg' data-ref="25arg">arg</a>);</td></tr>
<tr><th id="300">300</th><td>}</td></tr>
<tr><th id="301">301</th><td><u>#<span data-ppcond="254">else</span></u></td></tr>
<tr><th id="302">302</th><td><u>#define pps_cdev_compat_ioctl	NULL</u></td></tr>
<tr><th id="303">303</th><td><u>#<span data-ppcond="254">endif</span></u></td></tr>
<tr><th id="304">304</th><td></td></tr>
<tr><th id="305">305</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="pps_cdev_open" title='pps_cdev_open' data-type='int pps_cdev_open(struct inode * inode, struct file * file)' data-ref="pps_cdev_open">pps_cdev_open</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col1 decl" id="31inode" title='inode' data-type='struct inode *' data-ref="31inode">inode</dfn>, <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col2 decl" id="32file" title='file' data-type='struct file *' data-ref="32file">file</dfn>)</td></tr>
<tr><th id="306">306</th><td>{</td></tr>
<tr><th id="307">307</th><td>	<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a> *<dfn class="local col3 decl" id="33pps" title='pps' data-type='struct pps_device *' data-ref="33pps">pps</dfn> = <a class="macro" href="../../include/linux/kernel.h.html#927" title="({ void *__mptr = (void *)(inode-&gt;i_cdev); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(inode-&gt;i_cdev)), typeof(((struct pps_device *)0)-&gt;cdev)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(inode-&gt;i_cdev)), typeof(void)))); extern void __compiletime_assert_308(void) ; if (__cond) __compiletime_assert_308(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct pps_device *)(__mptr - __builtin_offsetof(struct pps_device, cdev))); })" data-ref="_M/container_of">container_of</a>(<a class="local col1 ref" href="#31inode" title='inode' data-ref="31inode">inode</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#inode::(anonymous)::i_cdev" title='inode::(anonymous union)::i_cdev' data-ref="inode::(anonymous)::i_cdev">i_cdev</a>,</td></tr>
<tr><th id="308">308</th><td>						<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a>, <a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::cdev" title='pps_device::cdev' data-ref="pps_device::cdev">cdev</a>);</td></tr>
<tr><th id="309">309</th><td>	<a class="local col2 ref" href="#32file" title='file' data-ref="32file">file</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a> = <a class="local col3 ref" href="#33pps" title='pps' data-ref="33pps">pps</a>;</td></tr>
<tr><th id="310">310</th><td>	<a class="ref fn" href="../../include/linux/kobject.h.html#kobject_get" title='kobject_get' data-ref="kobject_get">kobject_get</a>(&amp;<a class="local col3 ref" href="#33pps" title='pps' data-ref="33pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#device::kobj" title='device::kobj' data-ref="device::kobj">kobj</a>);</td></tr>
<tr><th id="311">311</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="312">312</th><td>}</td></tr>
<tr><th id="313">313</th><td></td></tr>
<tr><th id="314">314</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="pps_cdev_release" title='pps_cdev_release' data-type='int pps_cdev_release(struct inode * inode, struct file * file)' data-ref="pps_cdev_release">pps_cdev_release</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col4 decl" id="34inode" title='inode' data-type='struct inode *' data-ref="34inode">inode</dfn>, <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col5 decl" id="35file" title='file' data-type='struct file *' data-ref="35file">file</dfn>)</td></tr>
<tr><th id="315">315</th><td>{</td></tr>
<tr><th id="316">316</th><td>	<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a> *<dfn class="local col6 decl" id="36pps" title='pps' data-type='struct pps_device *' data-ref="36pps">pps</dfn> = <a class="macro" href="../../include/linux/kernel.h.html#927" title="({ void *__mptr = (void *)(inode-&gt;i_cdev); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(inode-&gt;i_cdev)), typeof(((struct pps_device *)0)-&gt;cdev)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(inode-&gt;i_cdev)), typeof(void)))); extern void __compiletime_assert_317(void) ; if (__cond) __compiletime_assert_317(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct pps_device *)(__mptr - __builtin_offsetof(struct pps_device, cdev))); })" data-ref="_M/container_of">container_of</a>(<a class="local col4 ref" href="#34inode" title='inode' data-ref="34inode">inode</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#inode::(anonymous)::i_cdev" title='inode::(anonymous union)::i_cdev' data-ref="inode::(anonymous)::i_cdev">i_cdev</a>,</td></tr>
<tr><th id="317">317</th><td>						<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a>, <a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::cdev" title='pps_device::cdev' data-ref="pps_device::cdev">cdev</a>);</td></tr>
<tr><th id="318">318</th><td>	<a class="ref fn" href="../../include/linux/kobject.h.html#kobject_put" title='kobject_put' data-ref="kobject_put">kobject_put</a>(&amp;<a class="local col6 ref" href="#36pps" title='pps' data-ref="36pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#device::kobj" title='device::kobj' data-ref="device::kobj">kobj</a>);</td></tr>
<tr><th id="319">319</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="320">320</th><td>}</td></tr>
<tr><th id="321">321</th><td></td></tr>
<tr><th id="322">322</th><td><i  data-doc="pps_cdev_fops">/*</i></td></tr>
<tr><th id="323">323</th><td><i  data-doc="pps_cdev_fops"> * Char device stuff</i></td></tr>
<tr><th id="324">324</th><td><i  data-doc="pps_cdev_fops"> */</i></td></tr>
<tr><th id="325">325</th><td></td></tr>
<tr><th id="326">326</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file_operations" title='file_operations' data-ref="file_operations">file_operations</a> <dfn class="tu decl def" id="pps_cdev_fops" title='pps_cdev_fops' data-type='const struct file_operations' data-ref="pps_cdev_fops">pps_cdev_fops</dfn> = {</td></tr>
<tr><th id="327">327</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::owner" title='file_operations::owner' data-ref="file_operations::owner">owner</a>		= <a class="macro" href="../../include/linux/export.h.html#37" title="((struct module *)0)" data-ref="_M/THIS_MODULE">THIS_MODULE</a>,</td></tr>
<tr><th id="328">328</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::llseek" title='file_operations::llseek' data-ref="file_operations::llseek">llseek</a>		= <a class="ref fn" href="../../include/linux/fs.h.html#no_llseek" title='no_llseek' data-ref="no_llseek">no_llseek</a>,</td></tr>
<tr><th id="329">329</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::poll" title='file_operations::poll' data-ref="file_operations::poll">poll</a>		= <a class="tu ref fn" href="#pps_cdev_poll" title='pps_cdev_poll' data-ref="pps_cdev_poll">pps_cdev_poll</a>,</td></tr>
<tr><th id="330">330</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::fasync" title='file_operations::fasync' data-ref="file_operations::fasync">fasync</a>		= <a class="tu ref fn" href="#pps_cdev_fasync" title='pps_cdev_fasync' data-ref="pps_cdev_fasync">pps_cdev_fasync</a>,</td></tr>
<tr><th id="331">331</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::compat_ioctl" title='file_operations::compat_ioctl' data-ref="file_operations::compat_ioctl">compat_ioctl</a>	= <a class="tu ref fn" href="#pps_cdev_compat_ioctl" title='pps_cdev_compat_ioctl' data-ref="pps_cdev_compat_ioctl">pps_cdev_compat_ioctl</a>,</td></tr>
<tr><th id="332">332</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::unlocked_ioctl" title='file_operations::unlocked_ioctl' data-ref="file_operations::unlocked_ioctl">unlocked_ioctl</a>	= <a class="tu ref fn" href="#pps_cdev_ioctl" title='pps_cdev_ioctl' data-ref="pps_cdev_ioctl">pps_cdev_ioctl</a>,</td></tr>
<tr><th id="333">333</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::open" title='file_operations::open' data-ref="file_operations::open">open</a>		= <a class="tu ref fn" href="#pps_cdev_open" title='pps_cdev_open' data-ref="pps_cdev_open">pps_cdev_open</a>,</td></tr>
<tr><th id="334">334</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::release" title='file_operations::release' data-ref="file_operations::release">release</a>	= <a class="tu ref fn" href="#pps_cdev_release" title='pps_cdev_release' data-ref="pps_cdev_release">pps_cdev_release</a>,</td></tr>
<tr><th id="335">335</th><td>};</td></tr>
<tr><th id="336">336</th><td></td></tr>
<tr><th id="337">337</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="pps_device_destruct" title='pps_device_destruct' data-type='void pps_device_destruct(struct device * dev)' data-ref="pps_device_destruct">pps_device_destruct</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col7 decl" id="37dev" title='dev' data-type='struct device *' data-ref="37dev">dev</dfn>)</td></tr>
<tr><th id="338">338</th><td>{</td></tr>
<tr><th id="339">339</th><td>	<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a> *<dfn class="local col8 decl" id="38pps" title='pps' data-type='struct pps_device *' data-ref="38pps">pps</dfn> = <a class="ref fn" href="../../include/linux/device.h.html#dev_get_drvdata" title='dev_get_drvdata' data-ref="dev_get_drvdata">dev_get_drvdata</a>(<a class="local col7 ref" href="#37dev" title='dev' data-ref="37dev">dev</a>);</td></tr>
<tr><th id="340">340</th><td></td></tr>
<tr><th id="341">341</th><td>	<a class="ref fn" href="../../include/linux/cdev.h.html#cdev_del" title='cdev_del' data-ref="cdev_del">cdev_del</a>(&amp;<a class="local col8 ref" href="#38pps" title='pps' data-ref="38pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::cdev" title='pps_device::cdev' data-ref="pps_device::cdev">cdev</a>);</td></tr>
<tr><th id="342">342</th><td></td></tr>
<tr><th id="343">343</th><td>	<i>/* Now we can release the ID for re-use */</i></td></tr>
<tr><th id="344">344</th><td>	<a class="macro" href="../../include/linux/printk.h.html#339" title="({ do { if (0) printk(&quot;\001&quot; &quot;7&quot; &quot;pps_core&quot; &quot;: &quot; &quot;deallocating pps%d\n&quot;, pps-&gt;id); } while (0); 0; })" data-ref="_M/pr_debug">pr_debug</a>(<q>"deallocating pps%d\n"</q>, <a class="local col8 ref" href="#38pps" title='pps' data-ref="38pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::id" title='pps_device::id' data-ref="pps_device::id">id</a>);</td></tr>
<tr><th id="345">345</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#45" title='pps_idr_lock' data-use='a' data-ref="pps_idr_lock">pps_idr_lock</a>);</td></tr>
<tr><th id="346">346</th><td>	<a class="ref fn" href="../../include/linux/idr.h.html#idr_remove" title='idr_remove' data-ref="idr_remove">idr_remove</a>(&amp;<a class="tu ref" href="#46" title='pps_idr' data-use='a' data-ref="pps_idr">pps_idr</a>, <a class="local col8 ref" href="#38pps" title='pps' data-ref="38pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::id" title='pps_device::id' data-ref="pps_device::id">id</a>);</td></tr>
<tr><th id="347">347</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#45" title='pps_idr_lock' data-use='a' data-ref="pps_idr_lock">pps_idr_lock</a>);</td></tr>
<tr><th id="348">348</th><td></td></tr>
<tr><th id="349">349</th><td>	<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col7 ref" href="#37dev" title='dev' data-ref="37dev">dev</a>);</td></tr>
<tr><th id="350">350</th><td>	<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col8 ref" href="#38pps" title='pps' data-ref="38pps">pps</a>);</td></tr>
<tr><th id="351">351</th><td>}</td></tr>
<tr><th id="352">352</th><td></td></tr>
<tr><th id="353">353</th><td><em>int</em> <dfn class="decl def fn" id="pps_register_cdev" title='pps_register_cdev' data-ref="pps_register_cdev">pps_register_cdev</dfn>(<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a> *<dfn class="local col9 decl" id="39pps" title='pps' data-type='struct pps_device *' data-ref="39pps">pps</dfn>)</td></tr>
<tr><th id="354">354</th><td>{</td></tr>
<tr><th id="355">355</th><td>	<em>int</em> <dfn class="local col0 decl" id="40err" title='err' data-type='int' data-ref="40err">err</dfn>;</td></tr>
<tr><th id="356">356</th><td>	<a class="typedef" href="../../include/linux/types.h.html#dev_t" title='dev_t' data-type='__kernel_dev_t' data-ref="dev_t">dev_t</a> <dfn class="local col1 decl" id="41devt" title='devt' data-type='dev_t' data-ref="41devt">devt</dfn>;</td></tr>
<tr><th id="357">357</th><td></td></tr>
<tr><th id="358">358</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#45" title='pps_idr_lock' data-use='a' data-ref="pps_idr_lock">pps_idr_lock</a>);</td></tr>
<tr><th id="359">359</th><td>	<i>/*</i></td></tr>
<tr><th id="360">360</th><td><i>	 * Get new ID for the new PPS source.  After idr_alloc() calling</i></td></tr>
<tr><th id="361">361</th><td><i>	 * the new source will be freely available into the kernel.</i></td></tr>
<tr><th id="362">362</th><td><i>	 */</i></td></tr>
<tr><th id="363">363</th><td>	<a class="local col0 ref" href="#40err" title='err' data-ref="40err">err</a> = <a class="ref fn" href="../../include/linux/idr.h.html#idr_alloc" title='idr_alloc' data-ref="idr_alloc">idr_alloc</a>(&amp;<a class="tu ref" href="#46" title='pps_idr' data-use='a' data-ref="pps_idr">pps_idr</a>, <a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>, <var>0</var>, <a class="macro" href="../../include/uapi/linux/pps.h.html#29" title="16" data-ref="_M/PPS_MAX_SOURCES">PPS_MAX_SOURCES</a>, <a class="macro" href="../../include/linux/gfp.h.html#278" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="364">364</th><td>	<b>if</b> (<a class="local col0 ref" href="#40err" title='err' data-ref="40err">err</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="365">365</th><td>		<b>if</b> (<a class="local col0 ref" href="#40err" title='err' data-ref="40err">err</a> == -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#32" title="28" data-ref="_M/ENOSPC">ENOSPC</a>) {</td></tr>
<tr><th id="366">366</th><td>			<a class="macro" href="../../include/linux/printk.h.html#301" title="printk(&quot;\001&quot; &quot;3&quot; &quot;pps_core&quot; &quot;: &quot; &quot;%s: too many PPS sources in the system\n&quot;, pps-&gt;info.name)" data-ref="_M/pr_err">pr_err</a>(<q>"%s: too many PPS sources in the system\n"</q>,</td></tr>
<tr><th id="367">367</th><td>			       <a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::info" title='pps_device::info' data-ref="pps_device::info">info</a>.<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_source_info::name" title='pps_source_info::name' data-ref="pps_source_info::name">name</a>);</td></tr>
<tr><th id="368">368</th><td>			<a class="local col0 ref" href="#40err" title='err' data-ref="40err">err</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#20" title="16" data-ref="_M/EBUSY">EBUSY</a>;</td></tr>
<tr><th id="369">369</th><td>		}</td></tr>
<tr><th id="370">370</th><td>		<b>goto</b> <a class="lbl" href="#42out_unlock" data-ref="42out_unlock">out_unlock</a>;</td></tr>
<tr><th id="371">371</th><td>	}</td></tr>
<tr><th id="372">372</th><td>	<a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::id" title='pps_device::id' data-ref="pps_device::id">id</a> = <a class="local col0 ref" href="#40err" title='err' data-ref="40err">err</a>;</td></tr>
<tr><th id="373">373</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#45" title='pps_idr_lock' data-use='a' data-ref="pps_idr_lock">pps_idr_lock</a>);</td></tr>
<tr><th id="374">374</th><td></td></tr>
<tr><th id="375">375</th><td>	<a class="local col1 ref" href="#41devt" title='devt' data-ref="41devt">devt</a> = <a class="macro" href="../../include/linux/kdev_t.h.html#12" title="(((((unsigned int) ((pps_devt) &gt;&gt; 20))) &lt;&lt; 20) | (pps-&gt;id))" data-ref="_M/MKDEV">MKDEV</a>(<a class="macro" href="../../include/linux/kdev_t.h.html#10" title="((unsigned int) ((pps_devt) &gt;&gt; 20))" data-ref="_M/MAJOR">MAJOR</a>(<a class="tu ref" href="#pps_devt" title='pps_devt' data-use='r' data-ref="pps_devt">pps_devt</a>), <a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::id" title='pps_device::id' data-ref="pps_device::id">id</a>);</td></tr>
<tr><th id="376">376</th><td></td></tr>
<tr><th id="377">377</th><td>	<a class="ref fn" href="../../include/linux/cdev.h.html#cdev_init" title='cdev_init' data-ref="cdev_init">cdev_init</a>(&amp;<a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::cdev" title='pps_device::cdev' data-ref="pps_device::cdev">cdev</a>, &amp;<a class="tu ref" href="#pps_cdev_fops" title='pps_cdev_fops' data-use='a' data-ref="pps_cdev_fops">pps_cdev_fops</a>);</td></tr>
<tr><th id="378">378</th><td>	<a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::cdev" title='pps_device::cdev' data-ref="pps_device::cdev">cdev</a>.<a class="ref field" href="../../include/linux/cdev.h.html#cdev::owner" title='cdev::owner' data-ref="cdev::owner">owner</a> = <a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::info" title='pps_device::info' data-ref="pps_device::info">info</a>.<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_source_info::owner" title='pps_source_info::owner' data-ref="pps_source_info::owner">owner</a>;</td></tr>
<tr><th id="379">379</th><td></td></tr>
<tr><th id="380">380</th><td>	<a class="local col0 ref" href="#40err" title='err' data-ref="40err">err</a> = <a class="ref fn" href="../../include/linux/cdev.h.html#cdev_add" title='cdev_add' data-ref="cdev_add">cdev_add</a>(&amp;<a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::cdev" title='pps_device::cdev' data-ref="pps_device::cdev">cdev</a>, <a class="local col1 ref" href="#41devt" title='devt' data-ref="41devt">devt</a>, <var>1</var>);</td></tr>
<tr><th id="381">381</th><td>	<b>if</b> (<a class="local col0 ref" href="#40err" title='err' data-ref="40err">err</a>) {</td></tr>
<tr><th id="382">382</th><td>		<a class="macro" href="../../include/linux/printk.h.html#301" title="printk(&quot;\001&quot; &quot;3&quot; &quot;pps_core&quot; &quot;: &quot; &quot;%s: failed to add char device %d:%d\n&quot;, pps-&gt;info.name, ((unsigned int) ((pps_devt) &gt;&gt; 20)), pps-&gt;id)" data-ref="_M/pr_err">pr_err</a>(<q>"%s: failed to add char device %d:%d\n"</q>,</td></tr>
<tr><th id="383">383</th><td>				<a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::info" title='pps_device::info' data-ref="pps_device::info">info</a>.<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_source_info::name" title='pps_source_info::name' data-ref="pps_source_info::name">name</a>, MAJOR(<a class="tu ref" href="#pps_devt" title='pps_devt' data-use='r' data-ref="pps_devt">pps_devt</a>), <a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::id" title='pps_device::id' data-ref="pps_device::id">id</a>);</td></tr>
<tr><th id="384">384</th><td>		<b>goto</b> <a class="lbl" href="#43free_idr" data-ref="43free_idr">free_idr</a>;</td></tr>
<tr><th id="385">385</th><td>	}</td></tr>
<tr><th id="386">386</th><td>	<a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a> = <a class="ref fn" href="../../include/linux/device.h.html#device_create" title='device_create' data-ref="device_create">device_create</a>(<a class="tu ref" href="#pps_class" title='pps_class' data-use='r' data-ref="pps_class">pps_class</a>, <a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::info" title='pps_device::info' data-ref="pps_device::info">info</a>.<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_source_info::dev" title='pps_source_info::dev' data-ref="pps_source_info::dev">dev</a>, <a class="local col1 ref" href="#41devt" title='devt' data-ref="41devt">devt</a>, <a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>,</td></tr>
<tr><th id="387">387</th><td>							<q>"pps%d"</q>, <a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::id" title='pps_device::id' data-ref="pps_device::id">id</a>);</td></tr>
<tr><th id="388">388</th><td>	<b>if</b> (<a class="ref fn" href="../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>)) {</td></tr>
<tr><th id="389">389</th><td>		<a class="local col0 ref" href="#40err" title='err' data-ref="40err">err</a> = <a class="ref fn" href="../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR">PTR_ERR</a>(<a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>);</td></tr>
<tr><th id="390">390</th><td>		<b>goto</b> <a class="lbl" href="#44del_cdev" data-ref="44del_cdev">del_cdev</a>;</td></tr>
<tr><th id="391">391</th><td>	}</td></tr>
<tr><th id="392">392</th><td></td></tr>
<tr><th id="393">393</th><td>	<i>/* Override the release function with our own */</i></td></tr>
<tr><th id="394">394</th><td>	<a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#device::release" title='device::release' data-ref="device::release">release</a> = <a class="tu ref fn" href="#pps_device_destruct" title='pps_device_destruct' data-use='r' data-ref="pps_device_destruct">pps_device_destruct</a>;</td></tr>
<tr><th id="395">395</th><td></td></tr>
<tr><th id="396">396</th><td>	<a class="macro" href="../../include/linux/printk.h.html#339" title="({ do { if (0) printk(&quot;\001&quot; &quot;7&quot; &quot;pps_core&quot; &quot;: &quot; &quot;source %s got cdev (%d:%d)\n&quot;, pps-&gt;info.name, ((unsigned int) ((pps_devt) &gt;&gt; 20)), pps-&gt;id); } while (0); 0; })" data-ref="_M/pr_debug">pr_debug</a>(<q>"source %s got cdev (%d:%d)\n"</q>, <a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::info" title='pps_device::info' data-ref="pps_device::info">info</a>.<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_source_info::name" title='pps_source_info::name' data-ref="pps_source_info::name">name</a>,</td></tr>
<tr><th id="397">397</th><td>			MAJOR(<a class="tu ref" href="#pps_devt" title='pps_devt' data-use='r' data-ref="pps_devt">pps_devt</a>), <a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::id" title='pps_device::id' data-ref="pps_device::id">id</a>);</td></tr>
<tr><th id="398">398</th><td></td></tr>
<tr><th id="399">399</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="400">400</th><td></td></tr>
<tr><th id="401">401</th><td><dfn class="lbl" id="44del_cdev" data-ref="44del_cdev">del_cdev</dfn>:</td></tr>
<tr><th id="402">402</th><td>	<a class="ref fn" href="../../include/linux/cdev.h.html#cdev_del" title='cdev_del' data-ref="cdev_del">cdev_del</a>(&amp;<a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::cdev" title='pps_device::cdev' data-ref="pps_device::cdev">cdev</a>);</td></tr>
<tr><th id="403">403</th><td></td></tr>
<tr><th id="404">404</th><td><dfn class="lbl" id="43free_idr" data-ref="43free_idr">free_idr</dfn>:</td></tr>
<tr><th id="405">405</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#45" title='pps_idr_lock' data-use='a' data-ref="pps_idr_lock">pps_idr_lock</a>);</td></tr>
<tr><th id="406">406</th><td>	<a class="ref fn" href="../../include/linux/idr.h.html#idr_remove" title='idr_remove' data-ref="idr_remove">idr_remove</a>(&amp;<a class="tu ref" href="#46" title='pps_idr' data-use='a' data-ref="pps_idr">pps_idr</a>, <a class="local col9 ref" href="#39pps" title='pps' data-ref="39pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::id" title='pps_device::id' data-ref="pps_device::id">id</a>);</td></tr>
<tr><th id="407">407</th><td><dfn class="lbl" id="42out_unlock" data-ref="42out_unlock">out_unlock</dfn>:</td></tr>
<tr><th id="408">408</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#45" title='pps_idr_lock' data-use='a' data-ref="pps_idr_lock">pps_idr_lock</a>);</td></tr>
<tr><th id="409">409</th><td>	<b>return</b> <a class="local col0 ref" href="#40err" title='err' data-ref="40err">err</a>;</td></tr>
<tr><th id="410">410</th><td>}</td></tr>
<tr><th id="411">411</th><td></td></tr>
<tr><th id="412">412</th><td><em>void</em> <dfn class="decl def fn" id="pps_unregister_cdev" title='pps_unregister_cdev' data-ref="pps_unregister_cdev">pps_unregister_cdev</dfn>(<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a> *<dfn class="local col5 decl" id="45pps" title='pps' data-type='struct pps_device *' data-ref="45pps">pps</dfn>)</td></tr>
<tr><th id="413">413</th><td>{</td></tr>
<tr><th id="414">414</th><td>	<a class="macro" href="../../include/linux/printk.h.html#339" title="({ do { if (0) printk(&quot;\001&quot; &quot;7&quot; &quot;pps_core&quot; &quot;: &quot; &quot;unregistering pps%d\n&quot;, pps-&gt;id); } while (0); 0; })" data-ref="_M/pr_debug">pr_debug</a>(<q>"unregistering pps%d\n"</q>, <a class="local col5 ref" href="#45pps" title='pps' data-ref="45pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::id" title='pps_device::id' data-ref="pps_device::id">id</a>);</td></tr>
<tr><th id="415">415</th><td>	<a class="local col5 ref" href="#45pps" title='pps' data-ref="45pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::lookup_cookie" title='pps_device::lookup_cookie' data-ref="pps_device::lookup_cookie">lookup_cookie</a> = <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="416">416</th><td>	<a class="ref fn" href="../../include/linux/device.h.html#device_destroy" title='device_destroy' data-ref="device_destroy">device_destroy</a>(<a class="tu ref" href="#pps_class" title='pps_class' data-use='r' data-ref="pps_class">pps_class</a>, <a class="local col5 ref" href="#45pps" title='pps' data-ref="45pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::dev" title='pps_device::dev' data-ref="pps_device::dev">dev</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#device::devt" title='device::devt' data-ref="device::devt">devt</a>);</td></tr>
<tr><th id="417">417</th><td>}</td></tr>
<tr><th id="418">418</th><td></td></tr>
<tr><th id="419">419</th><td><i>/*</i></td></tr>
<tr><th id="420">420</th><td><i> * Look up a pps device by magic cookie.</i></td></tr>
<tr><th id="421">421</th><td><i> * The cookie is usually a pointer to some enclosing device, but this</i></td></tr>
<tr><th id="422">422</th><td><i> * code doesn't care; you should never be dereferencing it.</i></td></tr>
<tr><th id="423">423</th><td><i> *</i></td></tr>
<tr><th id="424">424</th><td><i> * This is a bit of a kludge that is currently used only by the PPS</i></td></tr>
<tr><th id="425">425</th><td><i> * serial line discipline.  It may need to be tweaked when a second user</i></td></tr>
<tr><th id="426">426</th><td><i> * is found.</i></td></tr>
<tr><th id="427">427</th><td><i> *</i></td></tr>
<tr><th id="428">428</th><td><i> * There is no function interface for setting the lookup_cookie field.</i></td></tr>
<tr><th id="429">429</th><td><i> * It's initialized to NULL when the pps device is created, and if a</i></td></tr>
<tr><th id="430">430</th><td><i> * client wants to use it, just fill it in afterward.</i></td></tr>
<tr><th id="431">431</th><td><i> *</i></td></tr>
<tr><th id="432">432</th><td><i> * The cookie is automatically set to NULL in pps_unregister_source()</i></td></tr>
<tr><th id="433">433</th><td><i> * so that it will not be used again, even if the pps device cannot</i></td></tr>
<tr><th id="434">434</th><td><i> * be removed from the idr due to pending references holding the minor</i></td></tr>
<tr><th id="435">435</th><td><i> * number in use.</i></td></tr>
<tr><th id="436">436</th><td><i> */</i></td></tr>
<tr><th id="437">437</th><td><b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a> *<dfn class="decl def fn" id="pps_lookup_dev" title='pps_lookup_dev' data-ref="pps_lookup_dev">pps_lookup_dev</dfn>(<em>void</em> <em>const</em> *<dfn class="local col6 decl" id="46cookie" title='cookie' data-type='const void *' data-ref="46cookie">cookie</dfn>)</td></tr>
<tr><th id="438">438</th><td>{</td></tr>
<tr><th id="439">439</th><td>	<b>struct</b> <a class="type" href="../../include/linux/pps_kernel.h.html#pps_device" title='pps_device' data-ref="pps_device">pps_device</a> *<dfn class="local col7 decl" id="47pps" title='pps' data-type='struct pps_device *' data-ref="47pps">pps</dfn>;</td></tr>
<tr><th id="440">440</th><td>	<em>unsigned</em> <dfn class="local col8 decl" id="48id" title='id' data-type='unsigned int' data-ref="48id">id</dfn>;</td></tr>
<tr><th id="441">441</th><td></td></tr>
<tr><th id="442">442</th><td>	<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_lock" title='rcu_read_lock' data-ref="rcu_read_lock">rcu_read_lock</a>();</td></tr>
<tr><th id="443">443</th><td>	<a class="macro" href="../../include/linux/idr.h.html#207" title="for (id = 0; ((pps) = idr_get_next(&amp;pps_idr, &amp;(id))) != ((void *)0); ++id)" data-ref="_M/idr_for_each_entry">idr_for_each_entry</a>(&amp;<a class="tu ref" href="#46" title='pps_idr' data-use='a' data-ref="pps_idr">pps_idr</a>, <a class="local col7 ref" href="#47pps" title='pps' data-ref="47pps">pps</a>, <a class="local col8 ref" href="#48id" title='id' data-ref="48id">id</a>)</td></tr>
<tr><th id="444">444</th><td>		<b>if</b> (<a class="local col6 ref" href="#46cookie" title='cookie' data-ref="46cookie">cookie</a> == <a class="local col7 ref" href="#47pps" title='pps' data-ref="47pps">pps</a>-&gt;<a class="ref field" href="../../include/linux/pps_kernel.h.html#pps_device::lookup_cookie" title='pps_device::lookup_cookie' data-ref="pps_device::lookup_cookie">lookup_cookie</a>)</td></tr>
<tr><th id="445">445</th><td>			<b>break</b>;</td></tr>
<tr><th id="446">446</th><td>	<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_unlock" title='rcu_read_unlock' data-ref="rcu_read_unlock">rcu_read_unlock</a>();</td></tr>
<tr><th id="447">447</th><td>	<b>return</b> <a class="local col7 ref" href="#47pps" title='pps' data-ref="47pps">pps</a>;</td></tr>
<tr><th id="448">448</th><td>}</td></tr>
<tr><th id="449">449</th><td><a class="macro" href="../../include/linux/export.h.html#103" title="extern typeof(pps_lookup_dev) pps_lookup_dev; static const char __kstrtab_pps_lookup_dev[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;pps_lookup_dev&quot;; static const struct kernel_symbol __ksymtab_pps_lookup_dev __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;pps_lookup_dev&quot;), used)) = { (unsigned long)&amp;pps_lookup_dev, __kstrtab_pps_lookup_dev }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#pps_lookup_dev" title='pps_lookup_dev' data-ref="pps_lookup_dev"><a class="ref fn" href="#pps_lookup_dev" title='pps_lookup_dev' data-ref="pps_lookup_dev"><a class="ref fn" href="#pps_lookup_dev" title='pps_lookup_dev' data-ref="pps_lookup_dev"><a class="ref fn" href="#pps_lookup_dev" title='pps_lookup_dev' data-ref="pps_lookup_dev">pps_lookup_dev</a></a></a></a>);</td></tr>
<tr><th id="450">450</th><td></td></tr>
<tr><th id="451">451</th><td><i  data-doc="pps_exit">/*</i></td></tr>
<tr><th id="452">452</th><td><i  data-doc="pps_exit"> * Module stuff</i></td></tr>
<tr><th id="453">453</th><td><i  data-doc="pps_exit"> */</i></td></tr>
<tr><th id="454">454</th><td></td></tr>
<tr><th id="455">455</th><td><em>static</em> <em>void</em> <a class="macro" href="../../include/linux/init.h.html#85" title="__attribute__ ((__section__(&quot;.exit.text&quot;))) __attribute__((__used__)) __attribute__((no_instrument_function))" data-ref="_M/__exit">__exit</a> <dfn class="tu decl def fn" id="pps_exit" title='pps_exit' data-type='void pps_exit()' data-ref="pps_exit">pps_exit</dfn>(<em>void</em>)</td></tr>
<tr><th id="456">456</th><td>{</td></tr>
<tr><th id="457">457</th><td>	<a class="ref fn" href="../../include/linux/device.h.html#class_destroy" title='class_destroy' data-ref="class_destroy">class_destroy</a>(<a class="tu ref" href="#pps_class" title='pps_class' data-use='r' data-ref="pps_class">pps_class</a>);</td></tr>
<tr><th id="458">458</th><td>	<a class="ref fn" href="../../include/linux/fs.h.html#unregister_chrdev_region" title='unregister_chrdev_region' data-ref="unregister_chrdev_region">unregister_chrdev_region</a>(<a class="tu ref" href="#pps_devt" title='pps_devt' data-use='r' data-ref="pps_devt">pps_devt</a>, <a class="macro" href="../../include/uapi/linux/pps.h.html#29" title="16" data-ref="_M/PPS_MAX_SOURCES">PPS_MAX_SOURCES</a>);</td></tr>
<tr><th id="459">459</th><td>}</td></tr>
<tr><th id="460">460</th><td></td></tr>
<tr><th id="461">461</th><td><em>static</em> <em>int</em> <a class="macro" href="../../include/linux/init.h.html#50" title="__attribute__ ((__section__(&quot;.init.text&quot;)))" data-ref="_M/__init">__init</a> <dfn class="tu decl def fn" id="pps_init" title='pps_init' data-type='int pps_init()' data-ref="pps_init">pps_init</dfn>(<em>void</em>)</td></tr>
<tr><th id="462">462</th><td>{</td></tr>
<tr><th id="463">463</th><td>	<em>int</em> <dfn class="local col9 decl" id="49err" title='err' data-type='int' data-ref="49err">err</dfn>;</td></tr>
<tr><th id="464">464</th><td></td></tr>
<tr><th id="465">465</th><td>	<a class="tu ref" href="#pps_class" title='pps_class' data-use='w' data-ref="pps_class">pps_class</a> = <a class="macro" href="../../include/linux/device.h.html#524" title="({ static struct lock_class_key __key; __class_create(((struct module *)0), &quot;pps&quot;, &amp;__key); })" data-ref="_M/class_create">class_create</a>(<a class="macro" href="../../include/linux/export.h.html#37" title="((struct module *)0)" data-ref="_M/THIS_MODULE">THIS_MODULE</a>, <q>"pps"</q>);</td></tr>
<tr><th id="466">466</th><td>	<b>if</b> (<a class="ref fn" href="../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="tu ref" href="#pps_class" title='pps_class' data-use='r' data-ref="pps_class">pps_class</a>)) {</td></tr>
<tr><th id="467">467</th><td>		<a class="macro" href="../../include/linux/printk.h.html#301" title="printk(&quot;\001&quot; &quot;3&quot; &quot;pps_core&quot; &quot;: &quot; &quot;failed to allocate class\n&quot;)" data-ref="_M/pr_err">pr_err</a>(<q>"failed to allocate class\n"</q>);</td></tr>
<tr><th id="468">468</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR">PTR_ERR</a>(<a class="tu ref" href="#pps_class" title='pps_class' data-use='r' data-ref="pps_class">pps_class</a>);</td></tr>
<tr><th id="469">469</th><td>	}</td></tr>
<tr><th id="470">470</th><td>	<a class="tu ref" href="#pps_class" title='pps_class' data-use='r' data-ref="pps_class">pps_class</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#class::dev_groups" title='class::dev_groups' data-ref="class::dev_groups">dev_groups</a> = <a class="ref" href="../../include/linux/pps_kernel.h.html#pps_groups" title='pps_groups' data-ref="pps_groups">pps_groups</a>;</td></tr>
<tr><th id="471">471</th><td></td></tr>
<tr><th id="472">472</th><td>	<a class="local col9 ref" href="#49err" title='err' data-ref="49err">err</a> = <a class="ref fn" href="../../include/linux/fs.h.html#alloc_chrdev_region" title='alloc_chrdev_region' data-ref="alloc_chrdev_region">alloc_chrdev_region</a>(&amp;<a class="tu ref" href="#pps_devt" title='pps_devt' data-use='a' data-ref="pps_devt">pps_devt</a>, <var>0</var>, <a class="macro" href="../../include/uapi/linux/pps.h.html#29" title="16" data-ref="_M/PPS_MAX_SOURCES">PPS_MAX_SOURCES</a>, <q>"pps"</q>);</td></tr>
<tr><th id="473">473</th><td>	<b>if</b> (<a class="local col9 ref" href="#49err" title='err' data-ref="49err">err</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="474">474</th><td>		<a class="macro" href="../../include/linux/printk.h.html#301" title="printk(&quot;\001&quot; &quot;3&quot; &quot;pps_core&quot; &quot;: &quot; &quot;failed to allocate char device region\n&quot;)" data-ref="_M/pr_err">pr_err</a>(<q>"failed to allocate char device region\n"</q>);</td></tr>
<tr><th id="475">475</th><td>		<b>goto</b> <a class="lbl" href="#50remove_class" data-ref="50remove_class">remove_class</a>;</td></tr>
<tr><th id="476">476</th><td>	}</td></tr>
<tr><th id="477">477</th><td></td></tr>
<tr><th id="478">478</th><td>	<a class="macro" href="../../include/linux/printk.h.html#308" title="printk(&quot;\001&quot; &quot;6&quot; &quot;pps_core&quot; &quot;: &quot; &quot;LinuxPPS API ver. %d registered\n&quot;, 1)" data-ref="_M/pr_info">pr_info</a>(<q>"LinuxPPS API ver. %d registered\n"</q>, PPS_API_VERS);</td></tr>
<tr><th id="479">479</th><td>	<a class="macro" href="../../include/linux/printk.h.html#308" title="printk(&quot;\001&quot; &quot;6&quot; &quot;pps_core&quot; &quot;: &quot; &quot;Software ver. %s - Copyright 2005-2007 Rodolfo Giometti &quot; &quot;&lt;giometti@linux.it&gt;\n&quot;, &quot;5.3.6&quot;)" data-ref="_M/pr_info">pr_info</a>(<q>"Software ver. %s - Copyright 2005-2007 Rodolfo Giometti "</q></td></tr>
<tr><th id="480">480</th><td>		<q>"&lt;giometti@linux.it&gt;\n"</q>, PPS_VERSION);</td></tr>
<tr><th id="481">481</th><td></td></tr>
<tr><th id="482">482</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="483">483</th><td></td></tr>
<tr><th id="484">484</th><td><dfn class="lbl" id="50remove_class" data-ref="50remove_class">remove_class</dfn>:</td></tr>
<tr><th id="485">485</th><td>	<a class="ref fn" href="../../include/linux/device.h.html#class_destroy" title='class_destroy' data-ref="class_destroy">class_destroy</a>(<a class="tu ref" href="#pps_class" title='pps_class' data-use='r' data-ref="pps_class">pps_class</a>);</td></tr>
<tr><th id="486">486</th><td></td></tr>
<tr><th id="487">487</th><td>	<b>return</b> <a class="local col9 ref" href="#49err" title='err' data-ref="49err">err</a>;</td></tr>
<tr><th id="488">488</th><td>}</td></tr>
<tr><th id="489">489</th><td></td></tr>
<tr><th id="490">490</th><td><a class="macro" href="../../include/linux/init.h.html#198" title="static initcall_t __initcall_pps_init4 __attribute__((__used__)) __attribute__((__section__(&quot;.initcall&quot; &quot;4&quot; &quot;.init&quot;))) = pps_init;" data-ref="_M/subsys_initcall">subsys_initcall</a>(<a class="tu ref fn" href="#pps_init" title='pps_init' data-ref="pps_init">pps_init</a>);</td></tr>
<tr><th id="491">491</th><td><a class="macro" href="../../include/linux/module.h.html#97" title="static exitcall_t __exitcall_pps_exit __attribute__((__used__)) __attribute__ ((__section__(&quot;.exitcall.exit&quot;))) = pps_exit;" data-ref="_M/module_exit">module_exit</a>(<a class="tu ref fn" href="#pps_exit" title='pps_exit' data-ref="pps_exit">pps_exit</a>);</td></tr>
<tr><th id="492">492</th><td></td></tr>
<tr><th id="493">493</th><td><a class="macro" href="../../include/linux/module.h.html#204" title="struct __UNIQUE_ID_author27 {}" data-ref="_M/MODULE_AUTHOR">MODULE_AUTHOR</a>(<q>"Rodolfo Giometti &lt;giometti@linux.it&gt;"</q>);</td></tr>
<tr><th id="494">494</th><td><a class="macro" href="../../include/linux/module.h.html#207" title="struct __UNIQUE_ID_description29 {}" data-ref="_M/MODULE_DESCRIPTION">MODULE_DESCRIPTION</a>(<q>"LinuxPPS support (RFC 2783) - ver. "</q> <a class="macro" href="../../include/uapi/linux/pps.h.html#28" title="&quot;5.3.6&quot;" data-ref="_M/PPS_VERSION">PPS_VERSION</a>);</td></tr>
<tr><th id="495">495</th><td><a class="macro" href="../../include/linux/module.h.html#198" title="struct __UNIQUE_ID_license31 {}" data-ref="_M/MODULE_LICENSE">MODULE_LICENSE</a>(<q>"GPL"</q>);</td></tr>
<tr><th id="496">496</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2018-Aug-13</em> from project linux-4.14.y revision <em>linux-4.14.y</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
