<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>yama_lsm.c source code [linux-4.14.y/security/yama/yama_lsm.c] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="access_report_info,ptrace_relation "/>
<link rel="stylesheet" href="../../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'linux-4.14.y/security/yama/yama_lsm.c'; var root_path = '../../..'; var data_path = '../../../../data';</script>
<script src='../../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../..'>linux-4.14.y</a>/<a href='..'>security</a>/<a href='./'>yama</a>/<a href='yama_lsm.c.html'>yama_lsm.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> * Yama Linux Security Module</i></td></tr>
<tr><th id="3">3</th><td><i> *</i></td></tr>
<tr><th id="4">4</th><td><i> * Author: Kees Cook &lt;keescook@chromium.org&gt;</i></td></tr>
<tr><th id="5">5</th><td><i> *</i></td></tr>
<tr><th id="6">6</th><td><i> * Copyright (C) 2010 Canonical, Ltd.</i></td></tr>
<tr><th id="7">7</th><td><i> * Copyright (C) 2011 The Chromium OS Authors.</i></td></tr>
<tr><th id="8">8</th><td><i> *</i></td></tr>
<tr><th id="9">9</th><td><i> * This program is free software; you can redistribute it and/or modify</i></td></tr>
<tr><th id="10">10</th><td><i> * it under the terms of the GNU General Public License version 2, as</i></td></tr>
<tr><th id="11">11</th><td><i> * published by the Free Software Foundation.</i></td></tr>
<tr><th id="12">12</th><td><i> *</i></td></tr>
<tr><th id="13">13</th><td><i> */</i></td></tr>
<tr><th id="14">14</th><td></td></tr>
<tr><th id="15">15</th><td><u>#include <a href="../../include/linux/lsm_hooks.h.html">&lt;linux/lsm_hooks.h&gt;</a></u></td></tr>
<tr><th id="16">16</th><td><u>#include <a href="../../include/linux/sysctl.h.html">&lt;linux/sysctl.h&gt;</a></u></td></tr>
<tr><th id="17">17</th><td><u>#include <a href="../../include/linux/ptrace.h.html">&lt;linux/ptrace.h&gt;</a></u></td></tr>
<tr><th id="18">18</th><td><u>#include <a href="../../include/uapi/linux/prctl.h.html">&lt;linux/prctl.h&gt;</a></u></td></tr>
<tr><th id="19">19</th><td><u>#include <a href="../../include/linux/ratelimit.h.html">&lt;linux/ratelimit.h&gt;</a></u></td></tr>
<tr><th id="20">20</th><td><u>#include <a href="../../include/linux/workqueue.h.html">&lt;linux/workqueue.h&gt;</a></u></td></tr>
<tr><th id="21">21</th><td><u>#include <a href="../../include/linux/string_helpers.h.html">&lt;linux/string_helpers.h&gt;</a></u></td></tr>
<tr><th id="22">22</th><td><u>#include <a href="../../include/linux/task_work.h.html">&lt;linux/task_work.h&gt;</a></u></td></tr>
<tr><th id="23">23</th><td><u>#include <a href="../../include/linux/sched.h.html">&lt;linux/sched.h&gt;</a></u></td></tr>
<tr><th id="24">24</th><td><u>#include <a href="../../include/linux/spinlock.h.html">&lt;linux/spinlock.h&gt;</a></u></td></tr>
<tr><th id="25">25</th><td></td></tr>
<tr><th id="26">26</th><td><u>#define <dfn class="macro" id="_M/YAMA_SCOPE_DISABLED" data-ref="_M/YAMA_SCOPE_DISABLED">YAMA_SCOPE_DISABLED</dfn>	0</u></td></tr>
<tr><th id="27">27</th><td><u>#define <dfn class="macro" id="_M/YAMA_SCOPE_RELATIONAL" data-ref="_M/YAMA_SCOPE_RELATIONAL">YAMA_SCOPE_RELATIONAL</dfn>	1</u></td></tr>
<tr><th id="28">28</th><td><u>#define <dfn class="macro" id="_M/YAMA_SCOPE_CAPABILITY" data-ref="_M/YAMA_SCOPE_CAPABILITY">YAMA_SCOPE_CAPABILITY</dfn>	2</u></td></tr>
<tr><th id="29">29</th><td><u>#define <dfn class="macro" id="_M/YAMA_SCOPE_NO_ATTACH" data-ref="_M/YAMA_SCOPE_NO_ATTACH">YAMA_SCOPE_NO_ATTACH</dfn>	3</u></td></tr>
<tr><th id="30">30</th><td></td></tr>
<tr><th id="31">31</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="ptrace_scope" title='ptrace_scope' data-type='int' data-ref="ptrace_scope">ptrace_scope</dfn> = <a class="macro" href="#27" title="1" data-ref="_M/YAMA_SCOPE_RELATIONAL">YAMA_SCOPE_RELATIONAL</a>;</td></tr>
<tr><th id="32">32</th><td></td></tr>
<tr><th id="33">33</th><td><i>/* describe a ptrace relationship for potential exception */</i></td></tr>
<tr><th id="34">34</th><td><b>struct</b> <dfn class="type def" id="ptrace_relation" title='ptrace_relation' data-ref="ptrace_relation">ptrace_relation</dfn> {</td></tr>
<tr><th id="35">35</th><td>	<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="tu decl field" id="ptrace_relation::tracer" title='ptrace_relation::tracer' data-type='struct task_struct *' data-ref="ptrace_relation::tracer">tracer</dfn>;</td></tr>
<tr><th id="36">36</th><td>	<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="tu decl field" id="ptrace_relation::tracee" title='ptrace_relation::tracee' data-type='struct task_struct *' data-ref="ptrace_relation::tracee">tracee</dfn>;</td></tr>
<tr><th id="37">37</th><td>	<a class="typedef" href="../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="tu decl field" id="ptrace_relation::invalid" title='ptrace_relation::invalid' data-type='bool' data-ref="ptrace_relation::invalid">invalid</dfn>;</td></tr>
<tr><th id="38">38</th><td>	<b>struct</b> <a class="type" href="../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a> <dfn class="tu decl field" id="ptrace_relation::node" title='ptrace_relation::node' data-type='struct list_head' data-ref="ptrace_relation::node">node</dfn>;</td></tr>
<tr><th id="39">39</th><td>	<b>struct</b> <a class="macro" href="../../include/linux/types.h.html#227" title="callback_head" data-ref="_M/rcu_head">rcu_head</a> <dfn class="tu decl field" id="ptrace_relation::rcu" title='ptrace_relation::rcu' data-type='struct callback_head' data-ref="ptrace_relation::rcu">rcu</dfn>;</td></tr>
<tr><th id="40">40</th><td>};</td></tr>
<tr><th id="41">41</th><td></td></tr>
<tr><th id="42">42</th><td><em>static</em> <a class="macro" href="../../include/linux/list.h.html#23" title="struct list_head ptracer_relations = { &amp;(ptracer_relations), &amp;(ptracer_relations) }" data-ref="_M/LIST_HEAD">LIST_HEAD</a>(<dfn class="tu decl def" id="ptracer_relations" title='ptracer_relations' data-type='struct list_head' data-ref="ptracer_relations"><a class="tu ref" href="#42" title='ptracer_relations' data-use='a' data-ref="ptracer_relations"><a class="tu ref" href="#42" title='ptracer_relations' data-use='a' data-ref="ptracer_relations"><a class="tu ref" href="#42" title='ptracer_relations' data-use='a' data-ref="ptracer_relations"><a class="tu ref" href="#42" title='ptracer_relations' data-use='a' data-ref="ptracer_relations">ptracer_relations</a></a></a></a></dfn>);</td></tr>
<tr><th id="43">43</th><td><em>static</em> <a class="macro" href="../../include/linux/spinlock_types.h.html#84" title="spinlock_t ptracer_relations_lock = (spinlock_t ) { { .rlock = { .raw_lock = { { (0) } }, } } }" data-ref="_M/DEFINE_SPINLOCK">DEFINE_SPINLOCK</a>(<dfn class="tu decl def" id="ptracer_relations_lock" title='ptracer_relations_lock' data-type='spinlock_t' data-ref="ptracer_relations_lock">ptracer_relations_lock</dfn>);</td></tr>
<tr><th id="44">44</th><td></td></tr>
<tr><th id="45">45</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#yama_relation_cleanup" title='yama_relation_cleanup' data-type='void yama_relation_cleanup(struct work_struct * work)' data-ref="yama_relation_cleanup">yama_relation_cleanup</a>(<b>struct</b> <a class="type" href="../../include/linux/workqueue.h.html#work_struct" title='work_struct' data-ref="work_struct">work_struct</a> *<dfn class="local col1 decl" id="1work" title='work' data-type='struct work_struct *' data-ref="1work">work</dfn>);</td></tr>
<tr><th id="46">46</th><td><em>static</em> <a class="macro" href="../../include/linux/workqueue.h.html#184" title="struct work_struct yama_relation_work = { .data = { ((unsigned long)(WORK_STRUCT_NO_POOL | WORK_STRUCT_STATIC)) }, .entry = { &amp;(yama_relation_work).entry, &amp;(yama_relation_work).entry }, .func = (yama_relation_cleanup), }" data-ref="_M/DECLARE_WORK">DECLARE_WORK</a>(<dfn class="tu decl def" id="yama_relation_work" title='yama_relation_work' data-type='struct work_struct' data-ref="yama_relation_work"><a class="tu ref" href="#46" title='yama_relation_work' data-use='m' data-ref="yama_relation_work"><a class="tu ref" href="#46" title='yama_relation_work' data-use='m' data-ref="yama_relation_work"><a class="tu ref" href="#46" title='yama_relation_work' data-use='m' data-ref="yama_relation_work"><a class="tu ref" href="#46" title='yama_relation_work' data-use='m' data-ref="yama_relation_work"><a class="tu ref" href="#46" title='yama_relation_work' data-use='m' data-ref="yama_relation_work"><a class="tu ref" href="#46" title='yama_relation_work' data-use='m' data-ref="yama_relation_work"><a class="tu ref" href="#46" title='yama_relation_work' data-use='m' data-ref="yama_relation_work"><a class="tu ref" href="#46" title='yama_relation_work' data-use='m' data-ref="yama_relation_work">yama_relation_work</a></a></a></a></a></a></a></a></dfn>, <a class="tu ref fn" href="#yama_relation_cleanup" title='yama_relation_cleanup' data-ref="yama_relation_cleanup">yama_relation_cleanup</a>);</td></tr>
<tr><th id="47">47</th><td></td></tr>
<tr><th id="48">48</th><td><b>struct</b> <dfn class="type def" id="access_report_info" title='access_report_info' data-ref="access_report_info">access_report_info</dfn> {</td></tr>
<tr><th id="49">49</th><td>	<b>struct</b> <a class="type" href="../../include/linux/types.h.html#callback_head" title='callback_head' data-ref="callback_head">callback_head</a> <dfn class="tu decl field" id="access_report_info::work" title='access_report_info::work' data-type='struct callback_head' data-ref="access_report_info::work">work</dfn>;</td></tr>
<tr><th id="50">50</th><td>	<em>const</em> <em>char</em> *<dfn class="tu decl field" id="access_report_info::access" title='access_report_info::access' data-type='const char *' data-ref="access_report_info::access">access</dfn>;</td></tr>
<tr><th id="51">51</th><td>	<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="tu decl field" id="access_report_info::target" title='access_report_info::target' data-type='struct task_struct *' data-ref="access_report_info::target">target</dfn>;</td></tr>
<tr><th id="52">52</th><td>	<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="tu decl field" id="access_report_info::agent" title='access_report_info::agent' data-type='struct task_struct *' data-ref="access_report_info::agent">agent</dfn>;</td></tr>
<tr><th id="53">53</th><td>};</td></tr>
<tr><th id="54">54</th><td></td></tr>
<tr><th id="55">55</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="__report_access" title='__report_access' data-type='void __report_access(struct callback_head * work)' data-ref="__report_access">__report_access</dfn>(<b>struct</b> <a class="type" href="../../include/linux/types.h.html#callback_head" title='callback_head' data-ref="callback_head">callback_head</a> *<dfn class="local col2 decl" id="2work" title='work' data-type='struct callback_head *' data-ref="2work">work</dfn>)</td></tr>
<tr><th id="56">56</th><td>{</td></tr>
<tr><th id="57">57</th><td>	<b>struct</b> <a class="type" href="#access_report_info" title='access_report_info' data-ref="access_report_info">access_report_info</a> *<dfn class="local col3 decl" id="3info" title='info' data-type='struct access_report_info *' data-ref="3info">info</dfn> =</td></tr>
<tr><th id="58">58</th><td>		<a class="macro" href="../../include/linux/kernel.h.html#927" title="({ void *__mptr = (void *)(work); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(work)), typeof(((struct access_report_info *)0)-&gt;work)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(work)), typeof(void)))); extern void __compiletime_assert_58(void) ; if (__cond) __compiletime_assert_58(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct access_report_info *)(__mptr - __builtin_offsetof(struct access_report_info, work))); })" data-ref="_M/container_of">container_of</a>(<a class="local col2 ref" href="#2work" title='work' data-ref="2work">work</a>, <b>struct</b> <a class="type" href="#access_report_info" title='access_report_info' data-ref="access_report_info">access_report_info</a>, <a class="tu ref field" href="#access_report_info::work" title='access_report_info::work' data-use='r' data-ref="access_report_info::work">work</a>);</td></tr>
<tr><th id="59">59</th><td>	<em>char</em> *<dfn class="local col4 decl" id="4target_cmd" title='target_cmd' data-type='char *' data-ref="4target_cmd">target_cmd</dfn>, *<dfn class="local col5 decl" id="5agent_cmd" title='agent_cmd' data-type='char *' data-ref="5agent_cmd">agent_cmd</dfn>;</td></tr>
<tr><th id="60">60</th><td></td></tr>
<tr><th id="61">61</th><td>	<a class="local col4 ref" href="#4target_cmd" title='target_cmd' data-ref="4target_cmd">target_cmd</a> = <a class="ref fn" href="../../include/linux/string_helpers.h.html#kstrdup_quotable_cmdline" title='kstrdup_quotable_cmdline' data-ref="kstrdup_quotable_cmdline">kstrdup_quotable_cmdline</a>(<a class="local col3 ref" href="#3info" title='info' data-ref="3info">info</a>-&gt;<a class="tu ref field" href="#access_report_info::target" title='access_report_info::target' data-use='r' data-ref="access_report_info::target">target</a>, <a class="macro" href="../../include/linux/gfp.h.html#278" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="62">62</th><td>	<a class="local col5 ref" href="#5agent_cmd" title='agent_cmd' data-ref="5agent_cmd">agent_cmd</a> = <a class="ref fn" href="../../include/linux/string_helpers.h.html#kstrdup_quotable_cmdline" title='kstrdup_quotable_cmdline' data-ref="kstrdup_quotable_cmdline">kstrdup_quotable_cmdline</a>(<a class="local col3 ref" href="#3info" title='info' data-ref="3info">info</a>-&gt;<a class="tu ref field" href="#access_report_info::agent" title='access_report_info::agent' data-use='r' data-ref="access_report_info::agent">agent</a>, <a class="macro" href="../../include/linux/gfp.h.html#278" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="63">63</th><td></td></tr>
<tr><th id="64">64</th><td>	<a class="macro" href="../../include/linux/printk.h.html#440" title="({ static struct ratelimit_state _rs = { .lock = (raw_spinlock_t) { .raw_lock = { { (0) } }, }, .interval = (5 * 100), .burst = 10, }; if (___ratelimit(&amp;_rs, __func__)) printk(&quot;\001&quot; &quot;5&quot; &quot;ptrace %s of \&quot;%s\&quot;[%d] was attempted by \&quot;%s\&quot;[%d]\n&quot;, info-&gt;access, target_cmd, info-&gt;target-&gt;pid, agent_cmd, info-&gt;agent-&gt;pid); })" data-ref="_M/pr_notice_ratelimited">pr_notice_ratelimited</a>(</td></tr>
<tr><th id="65">65</th><td>		<q>"ptrace %s of \"%s\"[%d] was attempted by \"%s\"[%d]\n"</q>,</td></tr>
<tr><th id="66">66</th><td>		<a class="local col3 ref" href="#3info" title='info' data-ref="3info">info</a>-&gt;<a class="tu ref field" href="#access_report_info::access" title='access_report_info::access' data-use='r' data-ref="access_report_info::access">access</a>, <a class="local col4 ref" href="#4target_cmd" title='target_cmd' data-ref="4target_cmd">target_cmd</a>, <a class="local col3 ref" href="#3info" title='info' data-ref="3info">info</a>-&gt;<a class="tu ref field" href="#access_report_info::target" title='access_report_info::target' data-use='r' data-ref="access_report_info::target">target</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::pid" title='task_struct::pid' data-ref="task_struct::pid">pid</a>, <a class="local col5 ref" href="#5agent_cmd" title='agent_cmd' data-ref="5agent_cmd">agent_cmd</a>,</td></tr>
<tr><th id="67">67</th><td>		<a class="local col3 ref" href="#3info" title='info' data-ref="3info">info</a>-&gt;<a class="tu ref field" href="#access_report_info::agent" title='access_report_info::agent' data-use='r' data-ref="access_report_info::agent">agent</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::pid" title='task_struct::pid' data-ref="task_struct::pid">pid</a>);</td></tr>
<tr><th id="68">68</th><td></td></tr>
<tr><th id="69">69</th><td>	<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col5 ref" href="#5agent_cmd" title='agent_cmd' data-ref="5agent_cmd">agent_cmd</a>);</td></tr>
<tr><th id="70">70</th><td>	<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col4 ref" href="#4target_cmd" title='target_cmd' data-ref="4target_cmd">target_cmd</a>);</td></tr>
<tr><th id="71">71</th><td></td></tr>
<tr><th id="72">72</th><td>	<a class="ref fn" href="../../include/linux/sched/task.h.html#put_task_struct" title='put_task_struct' data-ref="put_task_struct">put_task_struct</a>(<a class="local col3 ref" href="#3info" title='info' data-ref="3info">info</a>-&gt;<a class="tu ref field" href="#access_report_info::agent" title='access_report_info::agent' data-use='r' data-ref="access_report_info::agent">agent</a>);</td></tr>
<tr><th id="73">73</th><td>	<a class="ref fn" href="../../include/linux/sched/task.h.html#put_task_struct" title='put_task_struct' data-ref="put_task_struct">put_task_struct</a>(<a class="local col3 ref" href="#3info" title='info' data-ref="3info">info</a>-&gt;<a class="tu ref field" href="#access_report_info::target" title='access_report_info::target' data-use='r' data-ref="access_report_info::target">target</a>);</td></tr>
<tr><th id="74">74</th><td>	<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col3 ref" href="#3info" title='info' data-ref="3info">info</a>);</td></tr>
<tr><th id="75">75</th><td>}</td></tr>
<tr><th id="76">76</th><td></td></tr>
<tr><th id="77">77</th><td><i  data-doc="report_access">/* defers execution because cmdline access can sleep */</i></td></tr>
<tr><th id="78">78</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="report_access" title='report_access' data-type='void report_access(const char * access, struct task_struct * target, struct task_struct * agent)' data-ref="report_access">report_access</dfn>(<em>const</em> <em>char</em> *<dfn class="local col6 decl" id="6access" title='access' data-type='const char *' data-ref="6access">access</dfn>, <b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col7 decl" id="7target" title='target' data-type='struct task_struct *' data-ref="7target">target</dfn>,</td></tr>
<tr><th id="79">79</th><td>				<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col8 decl" id="8agent" title='agent' data-type='struct task_struct *' data-ref="8agent">agent</dfn>)</td></tr>
<tr><th id="80">80</th><td>{</td></tr>
<tr><th id="81">81</th><td>	<b>struct</b> <a class="type" href="#access_report_info" title='access_report_info' data-ref="access_report_info">access_report_info</a> *<dfn class="local col9 decl" id="9info" title='info' data-type='struct access_report_info *' data-ref="9info">info</dfn>;</td></tr>
<tr><th id="82">82</th><td>	<em>char</em> <dfn class="local col0 decl" id="10agent_comm" title='agent_comm' data-type='char [16]' data-ref="10agent_comm">agent_comm</dfn>[<b>sizeof</b>(<a class="local col8 ref" href="#8agent" title='agent' data-ref="8agent">agent</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::comm" title='task_struct::comm' data-ref="task_struct::comm">comm</a>)];</td></tr>
<tr><th id="83">83</th><td></td></tr>
<tr><th id="84">84</th><td>	<a class="macro" href="../../include/linux/spinlock.h.html#405" title="do { if (__builtin_expect(!!(!queued_spin_is_locked(&amp;(&amp;(&amp;target-&gt;alloc_lock)-&gt;rlock)-&gt;raw_lock)), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/security/yama/yama_lsm.c&quot;), &quot;i&quot; (84), &quot;i&quot; (0), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); do { ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (36)); }); do { } while (1); } while (0); } while (0); } while (0)" data-ref="_M/assert_spin_locked">assert_spin_locked</a>(&amp;<a class="local col7 ref" href="#7target" title='target' data-ref="7target">target</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::alloc_lock" title='task_struct::alloc_lock' data-ref="task_struct::alloc_lock">alloc_lock</a>); <i>/* for target-&gt;comm */</i></td></tr>
<tr><th id="85">85</th><td></td></tr>
<tr><th id="86">86</th><td>	<b>if</b> (<a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::flags" title='task_struct::flags' data-ref="task_struct::flags">flags</a> &amp; <a class="macro" href="../../include/linux/sched.h.html#1355" title="0x00200000" data-ref="_M/PF_KTHREAD">PF_KTHREAD</a>) {</td></tr>
<tr><th id="87">87</th><td>		<i>/* I don't think kthreads call task_work_run() before exiting.</i></td></tr>
<tr><th id="88">88</th><td><i>		 * Imagine angry ranting about procfs here.</i></td></tr>
<tr><th id="89">89</th><td><i>		 */</i></td></tr>
<tr><th id="90">90</th><td>		<a class="macro" href="../../include/linux/printk.h.html#440" title="({ static struct ratelimit_state _rs = { .lock = (raw_spinlock_t) { .raw_lock = { { (0) } }, }, .interval = (5 * 100), .burst = 10, }; if (___ratelimit(&amp;_rs, __func__)) printk(&quot;\001&quot; &quot;5&quot; &quot;ptrace %s of \&quot;%s\&quot;[%d] was attempted by \&quot;%s\&quot;[%d]\n&quot;, access, target-&gt;comm, target-&gt;pid, ({ do { bool __cond = !(!(sizeof(agent_comm) != 16)); extern void __compiletime_assert_93(void) ; if (__cond) __compiletime_assert_93(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); __get_task_comm(agent_comm, sizeof(agent_comm), agent); }), agent-&gt;pid); })" data-ref="_M/pr_notice_ratelimited">pr_notice_ratelimited</a>(</td></tr>
<tr><th id="91">91</th><td>		    <q>"ptrace %s of \"%s\"[%d] was attempted by \"%s\"[%d]\n"</q>,</td></tr>
<tr><th id="92">92</th><td>		    <a class="local col6 ref" href="#6access" title='access' data-ref="6access">access</a>, <a class="local col7 ref" href="#7target" title='target' data-ref="7target">target</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::comm" title='task_struct::comm' data-ref="task_struct::comm">comm</a>, <a class="local col7 ref" href="#7target" title='target' data-ref="7target">target</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::pid" title='task_struct::pid' data-ref="task_struct::pid">pid</a>,</td></tr>
<tr><th id="93">93</th><td>		    get_task_comm(<a class="local col0 ref" href="#10agent_comm" title='agent_comm' data-ref="10agent_comm">agent_comm</a>, <a class="local col8 ref" href="#8agent" title='agent' data-ref="8agent">agent</a>), <a class="local col8 ref" href="#8agent" title='agent' data-ref="8agent">agent</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::pid" title='task_struct::pid' data-ref="task_struct::pid">pid</a>);</td></tr>
<tr><th id="94">94</th><td>		<b>return</b>;</td></tr>
<tr><th id="95">95</th><td>	}</td></tr>
<tr><th id="96">96</th><td></td></tr>
<tr><th id="97">97</th><td>	<a class="local col9 ref" href="#9info" title='info' data-ref="9info">info</a> = <a class="ref fn" href="../../include/linux/slab.h.html#kmalloc" title='kmalloc' data-ref="kmalloc">kmalloc</a>(<b>sizeof</b>(*<a class="local col9 ref" href="#9info" title='info' data-ref="9info">info</a>), <a class="macro" href="../../include/linux/gfp.h.html#277" title="((( gfp_t)0x20u)|(( gfp_t)0x80000u)|(( gfp_t)0x1000000u))" data-ref="_M/GFP_ATOMIC">GFP_ATOMIC</a>);</td></tr>
<tr><th id="98">98</th><td>	<b>if</b> (!<a class="local col9 ref" href="#9info" title='info' data-ref="9info">info</a>)</td></tr>
<tr><th id="99">99</th><td>		<b>return</b>;</td></tr>
<tr><th id="100">100</th><td>	<a class="ref fn" href="../../include/linux/task_work.h.html#init_task_work" title='init_task_work' data-ref="init_task_work">init_task_work</a>(&amp;<a class="local col9 ref" href="#9info" title='info' data-ref="9info">info</a>-&gt;<a class="tu ref field" href="#access_report_info::work" title='access_report_info::work' data-use='a' data-ref="access_report_info::work">work</a>, <a class="tu ref fn" href="#__report_access" title='__report_access' data-use='r' data-ref="__report_access">__report_access</a>);</td></tr>
<tr><th id="101">101</th><td>	<a class="macro" href="../../include/linux/sched/task.h.html#89" title="do { atomic_inc(&amp;(target)-&gt;usage); } while(0)" data-ref="_M/get_task_struct">get_task_struct</a>(<a class="local col7 ref" href="#7target" title='target' data-ref="7target">target</a>);</td></tr>
<tr><th id="102">102</th><td>	<a class="macro" href="../../include/linux/sched/task.h.html#89" title="do { atomic_inc(&amp;(agent)-&gt;usage); } while(0)" data-ref="_M/get_task_struct">get_task_struct</a>(<a class="local col8 ref" href="#8agent" title='agent' data-ref="8agent">agent</a>);</td></tr>
<tr><th id="103">103</th><td>	<a class="local col9 ref" href="#9info" title='info' data-ref="9info">info</a>-&gt;<a class="tu ref field" href="#access_report_info::access" title='access_report_info::access' data-use='w' data-ref="access_report_info::access">access</a> = <a class="local col6 ref" href="#6access" title='access' data-ref="6access">access</a>;</td></tr>
<tr><th id="104">104</th><td>	<a class="local col9 ref" href="#9info" title='info' data-ref="9info">info</a>-&gt;<a class="tu ref field" href="#access_report_info::target" title='access_report_info::target' data-use='w' data-ref="access_report_info::target">target</a> = <a class="local col7 ref" href="#7target" title='target' data-ref="7target">target</a>;</td></tr>
<tr><th id="105">105</th><td>	<a class="local col9 ref" href="#9info" title='info' data-ref="9info">info</a>-&gt;<a class="tu ref field" href="#access_report_info::agent" title='access_report_info::agent' data-use='w' data-ref="access_report_info::agent">agent</a> = <a class="local col8 ref" href="#8agent" title='agent' data-ref="8agent">agent</a>;</td></tr>
<tr><th id="106">106</th><td>	<b>if</b> (<a class="ref fn" href="../../include/linux/task_work.h.html#task_work_add" title='task_work_add' data-ref="task_work_add">task_work_add</a>(<a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>, &amp;<a class="local col9 ref" href="#9info" title='info' data-ref="9info">info</a>-&gt;<a class="tu ref field" href="#access_report_info::work" title='access_report_info::work' data-use='a' data-ref="access_report_info::work">work</a>, <a class="enum" href="../../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>) == <var>0</var>)</td></tr>
<tr><th id="107">107</th><td>		<b>return</b>; <i>/* success */</i></td></tr>
<tr><th id="108">108</th><td></td></tr>
<tr><th id="109">109</th><td>	<a class="macro" href="../../include/asm-generic/bug.h.html#117" title="({ int __ret_warn_on = !!(1); if (__builtin_expect(!!(__ret_warn_on), 0)) do { printk(&quot;report_access called from exiting task&quot;); do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/security/yama/yama_lsm.c&quot;), &quot;i&quot; (109), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (38)); }); } while (0); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN">WARN</a>(<var>1</var>, <q>"report_access called from exiting task"</q>);</td></tr>
<tr><th id="110">110</th><td>	<a class="ref fn" href="../../include/linux/sched/task.h.html#put_task_struct" title='put_task_struct' data-ref="put_task_struct">put_task_struct</a>(<a class="local col7 ref" href="#7target" title='target' data-ref="7target">target</a>);</td></tr>
<tr><th id="111">111</th><td>	<a class="ref fn" href="../../include/linux/sched/task.h.html#put_task_struct" title='put_task_struct' data-ref="put_task_struct">put_task_struct</a>(<a class="local col8 ref" href="#8agent" title='agent' data-ref="8agent">agent</a>);</td></tr>
<tr><th id="112">112</th><td>	<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col9 ref" href="#9info" title='info' data-ref="9info">info</a>);</td></tr>
<tr><th id="113">113</th><td>}</td></tr>
<tr><th id="114">114</th><td></td></tr>
<tr><th id="115">115</th><td><i class="doc" data-doc="yama_relation_cleanup">/**</i></td></tr>
<tr><th id="116">116</th><td><i class="doc" data-doc="yama_relation_cleanup"> * yama_relation_cleanup - remove invalid entries from the relation list</i></td></tr>
<tr><th id="117">117</th><td><i class="doc" data-doc="yama_relation_cleanup"> *</i></td></tr>
<tr><th id="118">118</th><td><i class="doc" data-doc="yama_relation_cleanup"> */</i></td></tr>
<tr><th id="119">119</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="yama_relation_cleanup" title='yama_relation_cleanup' data-type='void yama_relation_cleanup(struct work_struct * work)' data-ref="yama_relation_cleanup">yama_relation_cleanup</dfn>(<b>struct</b> <a class="type" href="../../include/linux/workqueue.h.html#work_struct" title='work_struct' data-ref="work_struct">work_struct</a> *<dfn class="local col1 decl" id="11work" title='work' data-type='struct work_struct *' data-ref="11work">work</dfn>)</td></tr>
<tr><th id="120">120</th><td>{</td></tr>
<tr><th id="121">121</th><td>	<b>struct</b> <a class="type" href="#ptrace_relation" title='ptrace_relation' data-ref="ptrace_relation">ptrace_relation</a> *<dfn class="local col2 decl" id="12relation" title='relation' data-type='struct ptrace_relation *' data-ref="12relation">relation</dfn>;</td></tr>
<tr><th id="122">122</th><td></td></tr>
<tr><th id="123">123</th><td>	<a class="ref fn" href="../../include/linux/spinlock.h.html#spin_lock" title='spin_lock' data-ref="spin_lock">spin_lock</a>(&amp;<a class="tu ref" href="#43" title='ptracer_relations_lock' data-use='a' data-ref="ptracer_relations_lock">ptracer_relations_lock</a>);</td></tr>
<tr><th id="124">124</th><td>	<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_lock" title='rcu_read_lock' data-ref="rcu_read_lock">rcu_read_lock</a>();</td></tr>
<tr><th id="125">125</th><td>	<a class="macro" href="../../include/linux/rculist.h.html#351" title="for (relation = ({ void *__mptr = (void *)(({ union { typeof((&amp;ptracer_relations)-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); else __read_once_size_nocheck(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); do { } while (0); __u.__val; })); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(({ union { typeof((&amp;ptracer_relations)-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); else __read_once_size_nocheck(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); do { } while (0); __u.__val; }))), typeof(((typeof(*relation) *)0)-&gt;node)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(({ union { typeof((&amp;ptracer_relations)-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); else __read_once_size_nocheck(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); do { } while (0); __u.__val; }))), typeof(void)))); extern void __compiletime_assert_125(void) ; if (__cond) __compiletime_assert_125(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*relation) *)(__mptr - __builtin_offsetof(typeof(*relation), node))); }); &amp;relation-&gt;node != (&amp;ptracer_relations); relation = ({ void *__mptr = (void *)(({ union { typeof(relation-&gt;node.next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); else __read_once_size_nocheck(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); do { } while (0); __u.__val; })); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(({ union { typeof(relation-&gt;node.next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); else __read_once_size_nocheck(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); do { } while (0); __u.__val; }))), typeof(((typeof(*relation) *)0)-&gt;node)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(({ union { typeof(relation-&gt;node.next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); else __read_once_size_nocheck(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); do { } while (0); __u.__val; }))), typeof(void)))); extern void __compiletime_assert_125(void) ; if (__cond) __compiletime_assert_125(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*relation) *)(__mptr - __builtin_offsetof(typeof(*relation), node))); }))" data-ref="_M/list_for_each_entry_rcu">list_for_each_entry_rcu</a>(<a class="local col2 ref" href="#12relation" title='relation' data-ref="12relation">relation</a>, &amp;<a class="tu ref" href="#42" title='ptracer_relations' data-use='a' data-ref="ptracer_relations">ptracer_relations</a>, <a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='r' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='a' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node">node</a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a>) {</td></tr>
<tr><th id="126">126</th><td>		<b>if</b> (<a class="local col2 ref" href="#12relation" title='relation' data-ref="12relation">relation</a>-&gt;<a class="tu ref field" href="#ptrace_relation::invalid" title='ptrace_relation::invalid' data-use='r' data-ref="ptrace_relation::invalid">invalid</a>) {</td></tr>
<tr><th id="127">127</th><td>			<a class="ref fn" href="../../include/linux/rculist.h.html#list_del_rcu" title='list_del_rcu' data-ref="list_del_rcu">list_del_rcu</a>(&amp;<a class="local col2 ref" href="#12relation" title='relation' data-ref="12relation">relation</a>-&gt;<a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='a' data-ref="ptrace_relation::node">node</a>);</td></tr>
<tr><th id="128">128</th><td>			<a class="macro" href="../../include/linux/rcupdate.h.html#875" title="do { do { bool __cond = !(!(!((__builtin_offsetof(typeof(*(relation)), rcu)) &lt; 4096))); extern void __compiletime_assert_128(void) ; if (__cond) __compiletime_assert_128(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); kfree_call_rcu(&amp;((relation)-&gt;rcu), (rcu_callback_t)(unsigned long)(__builtin_offsetof(typeof(*(relation)), rcu))); } while (0)" data-ref="_M/kfree_rcu">kfree_rcu</a>(<a class="local col2 ref" href="#12relation" title='relation' data-ref="12relation">relation</a>, <a class="tu ref field" href="#ptrace_relation::rcu" title='ptrace_relation::rcu' data-use='a' data-ref="ptrace_relation::rcu">rcu</a>);</td></tr>
<tr><th id="129">129</th><td>		}</td></tr>
<tr><th id="130">130</th><td>	}</td></tr>
<tr><th id="131">131</th><td>	<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_unlock" title='rcu_read_unlock' data-ref="rcu_read_unlock">rcu_read_unlock</a>();</td></tr>
<tr><th id="132">132</th><td>	<a class="ref fn" href="../../include/linux/spinlock.h.html#spin_unlock" title='spin_unlock' data-ref="spin_unlock">spin_unlock</a>(&amp;<a class="tu ref" href="#43" title='ptracer_relations_lock' data-use='a' data-ref="ptracer_relations_lock">ptracer_relations_lock</a>);</td></tr>
<tr><th id="133">133</th><td>}</td></tr>
<tr><th id="134">134</th><td></td></tr>
<tr><th id="135">135</th><td><i class="doc" data-doc="yama_ptracer_add">/**</i></td></tr>
<tr><th id="136">136</th><td><i class="doc" data-doc="yama_ptracer_add"> * yama_ptracer_add - add/replace an exception for this tracer/tracee pair</i></td></tr>
<tr><th id="137">137</th><td><i class="doc" data-doc="yama_ptracer_add"> *<span class="command"> @tracer</span>: the task_struct of the process doing the ptrace</i></td></tr>
<tr><th id="138">138</th><td><i class="doc" data-doc="yama_ptracer_add"> *<span class="command"> @tracee</span>: the task_struct of the process to be ptraced</i></td></tr>
<tr><th id="139">139</th><td><i class="doc" data-doc="yama_ptracer_add"> *</i></td></tr>
<tr><th id="140">140</th><td><i class="doc" data-doc="yama_ptracer_add"> * Each tracee can have, at most, one tracer registered. Each time this</i></td></tr>
<tr><th id="141">141</th><td><i class="doc" data-doc="yama_ptracer_add"> * is called, the prior registered tracer will be replaced for the tracee.</i></td></tr>
<tr><th id="142">142</th><td><i class="doc" data-doc="yama_ptracer_add"> *</i></td></tr>
<tr><th id="143">143</th><td><i class="doc" data-doc="yama_ptracer_add"> * Returns 0 if relationship was added, -ve on error.</i></td></tr>
<tr><th id="144">144</th><td><i class="doc" data-doc="yama_ptracer_add"> */</i></td></tr>
<tr><th id="145">145</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="yama_ptracer_add" title='yama_ptracer_add' data-type='int yama_ptracer_add(struct task_struct * tracer, struct task_struct * tracee)' data-ref="yama_ptracer_add">yama_ptracer_add</dfn>(<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col3 decl" id="13tracer" title='tracer' data-type='struct task_struct *' data-ref="13tracer">tracer</dfn>,</td></tr>
<tr><th id="146">146</th><td>			    <b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col4 decl" id="14tracee" title='tracee' data-type='struct task_struct *' data-ref="14tracee">tracee</dfn>)</td></tr>
<tr><th id="147">147</th><td>{</td></tr>
<tr><th id="148">148</th><td>	<b>struct</b> <a class="type" href="#ptrace_relation" title='ptrace_relation' data-ref="ptrace_relation">ptrace_relation</a> *<dfn class="local col5 decl" id="15relation" title='relation' data-type='struct ptrace_relation *' data-ref="15relation">relation</dfn>, *<dfn class="local col6 decl" id="16added" title='added' data-type='struct ptrace_relation *' data-ref="16added">added</dfn>;</td></tr>
<tr><th id="149">149</th><td></td></tr>
<tr><th id="150">150</th><td>	<a class="local col6 ref" href="#16added" title='added' data-ref="16added">added</a> = <a class="ref fn" href="../../include/linux/slab.h.html#kmalloc" title='kmalloc' data-ref="kmalloc">kmalloc</a>(<b>sizeof</b>(*<a class="local col6 ref" href="#16added" title='added' data-ref="16added">added</a>), <a class="macro" href="../../include/linux/gfp.h.html#278" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="151">151</th><td>	<b>if</b> (!<a class="local col6 ref" href="#16added" title='added' data-ref="16added">added</a>)</td></tr>
<tr><th id="152">152</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="153">153</th><td></td></tr>
<tr><th id="154">154</th><td>	<a class="local col6 ref" href="#16added" title='added' data-ref="16added">added</a>-&gt;<a class="tu ref field" href="#ptrace_relation::tracee" title='ptrace_relation::tracee' data-use='w' data-ref="ptrace_relation::tracee">tracee</a> = <a class="local col4 ref" href="#14tracee" title='tracee' data-ref="14tracee">tracee</a>;</td></tr>
<tr><th id="155">155</th><td>	<a class="local col6 ref" href="#16added" title='added' data-ref="16added">added</a>-&gt;<a class="tu ref field" href="#ptrace_relation::tracer" title='ptrace_relation::tracer' data-use='w' data-ref="ptrace_relation::tracer">tracer</a> = <a class="local col3 ref" href="#13tracer" title='tracer' data-ref="13tracer">tracer</a>;</td></tr>
<tr><th id="156">156</th><td>	<a class="local col6 ref" href="#16added" title='added' data-ref="16added">added</a>-&gt;<a class="tu ref field" href="#ptrace_relation::invalid" title='ptrace_relation::invalid' data-use='w' data-ref="ptrace_relation::invalid">invalid</a> = <a class="enum" href="../../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="157">157</th><td></td></tr>
<tr><th id="158">158</th><td>	<a class="ref fn" href="../../include/linux/spinlock.h.html#spin_lock" title='spin_lock' data-ref="spin_lock">spin_lock</a>(&amp;<a class="tu ref" href="#43" title='ptracer_relations_lock' data-use='a' data-ref="ptracer_relations_lock">ptracer_relations_lock</a>);</td></tr>
<tr><th id="159">159</th><td>	<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_lock" title='rcu_read_lock' data-ref="rcu_read_lock">rcu_read_lock</a>();</td></tr>
<tr><th id="160">160</th><td>	<a class="macro" href="../../include/linux/rculist.h.html#351" title="for (relation = ({ void *__mptr = (void *)(({ union { typeof((&amp;ptracer_relations)-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); else __read_once_size_nocheck(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); do { } while (0); __u.__val; })); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(({ union { typeof((&amp;ptracer_relations)-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); else __read_once_size_nocheck(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); do { } while (0); __u.__val; }))), typeof(((typeof(*relation) *)0)-&gt;node)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(({ union { typeof((&amp;ptracer_relations)-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); else __read_once_size_nocheck(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); do { } while (0); __u.__val; }))), typeof(void)))); extern void __compiletime_assert_160(void) ; if (__cond) __compiletime_assert_160(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*relation) *)(__mptr - __builtin_offsetof(typeof(*relation), node))); }); &amp;relation-&gt;node != (&amp;ptracer_relations); relation = ({ void *__mptr = (void *)(({ union { typeof(relation-&gt;node.next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); else __read_once_size_nocheck(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); do { } while (0); __u.__val; })); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(({ union { typeof(relation-&gt;node.next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); else __read_once_size_nocheck(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); do { } while (0); __u.__val; }))), typeof(((typeof(*relation) *)0)-&gt;node)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(({ union { typeof(relation-&gt;node.next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); else __read_once_size_nocheck(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); do { } while (0); __u.__val; }))), typeof(void)))); extern void __compiletime_assert_160(void) ; if (__cond) __compiletime_assert_160(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*relation) *)(__mptr - __builtin_offsetof(typeof(*relation), node))); }))" data-ref="_M/list_for_each_entry_rcu">list_for_each_entry_rcu</a>(<a class="local col5 ref" href="#15relation" title='relation' data-ref="15relation">relation</a>, &amp;<a class="tu ref" href="#42" title='ptracer_relations' data-use='a' data-ref="ptracer_relations">ptracer_relations</a>, <a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='r' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='a' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node">node</a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a>) {</td></tr>
<tr><th id="161">161</th><td>		<b>if</b> (<a class="local col5 ref" href="#15relation" title='relation' data-ref="15relation">relation</a>-&gt;<a class="tu ref field" href="#ptrace_relation::invalid" title='ptrace_relation::invalid' data-use='r' data-ref="ptrace_relation::invalid">invalid</a>)</td></tr>
<tr><th id="162">162</th><td>			<b>continue</b>;</td></tr>
<tr><th id="163">163</th><td>		<b>if</b> (<a class="local col5 ref" href="#15relation" title='relation' data-ref="15relation">relation</a>-&gt;<a class="tu ref field" href="#ptrace_relation::tracee" title='ptrace_relation::tracee' data-use='r' data-ref="ptrace_relation::tracee">tracee</a> == <a class="local col4 ref" href="#14tracee" title='tracee' data-ref="14tracee">tracee</a>) {</td></tr>
<tr><th id="164">164</th><td>			<a class="ref fn" href="../../include/linux/rculist.h.html#list_replace_rcu" title='list_replace_rcu' data-ref="list_replace_rcu">list_replace_rcu</a>(&amp;<a class="local col5 ref" href="#15relation" title='relation' data-ref="15relation">relation</a>-&gt;<a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='a' data-ref="ptrace_relation::node">node</a>, &amp;<a class="local col6 ref" href="#16added" title='added' data-ref="16added">added</a>-&gt;<a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='a' data-ref="ptrace_relation::node">node</a>);</td></tr>
<tr><th id="165">165</th><td>			<a class="macro" href="../../include/linux/rcupdate.h.html#875" title="do { do { bool __cond = !(!(!((__builtin_offsetof(typeof(*(relation)), rcu)) &lt; 4096))); extern void __compiletime_assert_165(void) ; if (__cond) __compiletime_assert_165(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); kfree_call_rcu(&amp;((relation)-&gt;rcu), (rcu_callback_t)(unsigned long)(__builtin_offsetof(typeof(*(relation)), rcu))); } while (0)" data-ref="_M/kfree_rcu">kfree_rcu</a>(<a class="local col5 ref" href="#15relation" title='relation' data-ref="15relation">relation</a>, <a class="tu ref field" href="#ptrace_relation::rcu" title='ptrace_relation::rcu' data-use='a' data-ref="ptrace_relation::rcu">rcu</a>);</td></tr>
<tr><th id="166">166</th><td>			<b>goto</b> <a class="lbl" href="#17out" data-ref="17out">out</a>;</td></tr>
<tr><th id="167">167</th><td>		}</td></tr>
<tr><th id="168">168</th><td>	}</td></tr>
<tr><th id="169">169</th><td></td></tr>
<tr><th id="170">170</th><td>	<a class="ref fn" href="../../include/linux/rculist.h.html#list_add_rcu" title='list_add_rcu' data-ref="list_add_rcu">list_add_rcu</a>(&amp;<a class="local col6 ref" href="#16added" title='added' data-ref="16added">added</a>-&gt;<a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='a' data-ref="ptrace_relation::node">node</a>, &amp;<a class="tu ref" href="#42" title='ptracer_relations' data-use='a' data-ref="ptracer_relations">ptracer_relations</a>);</td></tr>
<tr><th id="171">171</th><td></td></tr>
<tr><th id="172">172</th><td><dfn class="lbl" id="17out" data-ref="17out">out</dfn>:</td></tr>
<tr><th id="173">173</th><td>	<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_unlock" title='rcu_read_unlock' data-ref="rcu_read_unlock">rcu_read_unlock</a>();</td></tr>
<tr><th id="174">174</th><td>	<a class="ref fn" href="../../include/linux/spinlock.h.html#spin_unlock" title='spin_unlock' data-ref="spin_unlock">spin_unlock</a>(&amp;<a class="tu ref" href="#43" title='ptracer_relations_lock' data-use='a' data-ref="ptracer_relations_lock">ptracer_relations_lock</a>);</td></tr>
<tr><th id="175">175</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="176">176</th><td>}</td></tr>
<tr><th id="177">177</th><td></td></tr>
<tr><th id="178">178</th><td><i class="doc" data-doc="yama_ptracer_del">/**</i></td></tr>
<tr><th id="179">179</th><td><i class="doc" data-doc="yama_ptracer_del"> * yama_ptracer_del - remove exceptions related to the given tasks</i></td></tr>
<tr><th id="180">180</th><td><i class="doc" data-doc="yama_ptracer_del"> *<span class="command"> @tracer</span>: remove any relation where tracer task matches</i></td></tr>
<tr><th id="181">181</th><td><i class="doc" data-doc="yama_ptracer_del"> *<span class="command"> @tracee</span>: remove any relation where tracee task matches</i></td></tr>
<tr><th id="182">182</th><td><i class="doc" data-doc="yama_ptracer_del"> */</i></td></tr>
<tr><th id="183">183</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="yama_ptracer_del" title='yama_ptracer_del' data-type='void yama_ptracer_del(struct task_struct * tracer, struct task_struct * tracee)' data-ref="yama_ptracer_del">yama_ptracer_del</dfn>(<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col8 decl" id="18tracer" title='tracer' data-type='struct task_struct *' data-ref="18tracer">tracer</dfn>,</td></tr>
<tr><th id="184">184</th><td>			     <b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col9 decl" id="19tracee" title='tracee' data-type='struct task_struct *' data-ref="19tracee">tracee</dfn>)</td></tr>
<tr><th id="185">185</th><td>{</td></tr>
<tr><th id="186">186</th><td>	<b>struct</b> <a class="type" href="#ptrace_relation" title='ptrace_relation' data-ref="ptrace_relation">ptrace_relation</a> *<dfn class="local col0 decl" id="20relation" title='relation' data-type='struct ptrace_relation *' data-ref="20relation">relation</dfn>;</td></tr>
<tr><th id="187">187</th><td>	<a class="typedef" href="../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="local col1 decl" id="21marked" title='marked' data-type='bool' data-ref="21marked">marked</dfn> = <a class="enum" href="../../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="188">188</th><td></td></tr>
<tr><th id="189">189</th><td>	<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_lock" title='rcu_read_lock' data-ref="rcu_read_lock">rcu_read_lock</a>();</td></tr>
<tr><th id="190">190</th><td>	<a class="macro" href="../../include/linux/rculist.h.html#351" title="for (relation = ({ void *__mptr = (void *)(({ union { typeof((&amp;ptracer_relations)-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); else __read_once_size_nocheck(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); do { } while (0); __u.__val; })); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(({ union { typeof((&amp;ptracer_relations)-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); else __read_once_size_nocheck(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); do { } while (0); __u.__val; }))), typeof(((typeof(*relation) *)0)-&gt;node)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(({ union { typeof((&amp;ptracer_relations)-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); else __read_once_size_nocheck(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); do { } while (0); __u.__val; }))), typeof(void)))); extern void __compiletime_assert_190(void) ; if (__cond) __compiletime_assert_190(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*relation) *)(__mptr - __builtin_offsetof(typeof(*relation), node))); }); &amp;relation-&gt;node != (&amp;ptracer_relations); relation = ({ void *__mptr = (void *)(({ union { typeof(relation-&gt;node.next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); else __read_once_size_nocheck(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); do { } while (0); __u.__val; })); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(({ union { typeof(relation-&gt;node.next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); else __read_once_size_nocheck(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); do { } while (0); __u.__val; }))), typeof(((typeof(*relation) *)0)-&gt;node)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(({ union { typeof(relation-&gt;node.next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); else __read_once_size_nocheck(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); do { } while (0); __u.__val; }))), typeof(void)))); extern void __compiletime_assert_190(void) ; if (__cond) __compiletime_assert_190(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*relation) *)(__mptr - __builtin_offsetof(typeof(*relation), node))); }))" data-ref="_M/list_for_each_entry_rcu">list_for_each_entry_rcu</a>(<a class="local col0 ref" href="#20relation" title='relation' data-ref="20relation">relation</a>, &amp;<a class="tu ref" href="#42" title='ptracer_relations' data-use='a' data-ref="ptracer_relations">ptracer_relations</a>, <a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='r' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='a' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node">node</a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a>) {</td></tr>
<tr><th id="191">191</th><td>		<b>if</b> (<a class="local col0 ref" href="#20relation" title='relation' data-ref="20relation">relation</a>-&gt;<a class="tu ref field" href="#ptrace_relation::invalid" title='ptrace_relation::invalid' data-use='r' data-ref="ptrace_relation::invalid">invalid</a>)</td></tr>
<tr><th id="192">192</th><td>			<b>continue</b>;</td></tr>
<tr><th id="193">193</th><td>		<b>if</b> (<a class="local col0 ref" href="#20relation" title='relation' data-ref="20relation">relation</a>-&gt;<a class="tu ref field" href="#ptrace_relation::tracee" title='ptrace_relation::tracee' data-use='r' data-ref="ptrace_relation::tracee">tracee</a> == <a class="local col9 ref" href="#19tracee" title='tracee' data-ref="19tracee">tracee</a> ||</td></tr>
<tr><th id="194">194</th><td>		    (<a class="local col8 ref" href="#18tracer" title='tracer' data-ref="18tracer">tracer</a> &amp;&amp; <a class="local col0 ref" href="#20relation" title='relation' data-ref="20relation">relation</a>-&gt;<a class="tu ref field" href="#ptrace_relation::tracer" title='ptrace_relation::tracer' data-use='r' data-ref="ptrace_relation::tracer">tracer</a> == <a class="local col8 ref" href="#18tracer" title='tracer' data-ref="18tracer">tracer</a>)) {</td></tr>
<tr><th id="195">195</th><td>			<a class="local col0 ref" href="#20relation" title='relation' data-ref="20relation">relation</a>-&gt;<a class="tu ref field" href="#ptrace_relation::invalid" title='ptrace_relation::invalid' data-use='w' data-ref="ptrace_relation::invalid">invalid</a> = <a class="enum" href="../../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="196">196</th><td>			<a class="local col1 ref" href="#21marked" title='marked' data-ref="21marked">marked</a> = <a class="enum" href="../../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="197">197</th><td>		}</td></tr>
<tr><th id="198">198</th><td>	}</td></tr>
<tr><th id="199">199</th><td>	<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_unlock" title='rcu_read_unlock' data-ref="rcu_read_unlock">rcu_read_unlock</a>();</td></tr>
<tr><th id="200">200</th><td></td></tr>
<tr><th id="201">201</th><td>	<b>if</b> (<a class="local col1 ref" href="#21marked" title='marked' data-ref="21marked">marked</a>)</td></tr>
<tr><th id="202">202</th><td>		<a class="ref fn" href="../../include/linux/workqueue.h.html#schedule_work" title='schedule_work' data-ref="schedule_work">schedule_work</a>(&amp;<a class="tu ref" href="#46" title='yama_relation_work' data-use='a' data-ref="yama_relation_work">yama_relation_work</a>);</td></tr>
<tr><th id="203">203</th><td>}</td></tr>
<tr><th id="204">204</th><td></td></tr>
<tr><th id="205">205</th><td><i class="doc">/**</i></td></tr>
<tr><th id="206">206</th><td><i class="doc"> * yama_task_free - check for task_pid to remove from exception list</i></td></tr>
<tr><th id="207">207</th><td><i class="doc"> *<span class="command"> @task</span>: task being removed</i></td></tr>
<tr><th id="208">208</th><td><i class="doc"> */</i></td></tr>
<tr><th id="209">209</th><td><em>void</em> <dfn class="decl def fn" id="yama_task_free" title='yama_task_free' data-ref="yama_task_free">yama_task_free</dfn>(<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col2 decl" id="22task" title='task' data-type='struct task_struct *' data-ref="22task">task</dfn>)</td></tr>
<tr><th id="210">210</th><td>{</td></tr>
<tr><th id="211">211</th><td>	<a class="tu ref fn" href="#yama_ptracer_del" title='yama_ptracer_del' data-use='c' data-ref="yama_ptracer_del">yama_ptracer_del</a>(<a class="local col2 ref" href="#22task" title='task' data-ref="22task">task</a>, <a class="local col2 ref" href="#22task" title='task' data-ref="22task">task</a>);</td></tr>
<tr><th id="212">212</th><td>}</td></tr>
<tr><th id="213">213</th><td></td></tr>
<tr><th id="214">214</th><td><i class="doc">/**</i></td></tr>
<tr><th id="215">215</th><td><i class="doc"> * yama_task_prctl - check for Yama-specific prctl operations</i></td></tr>
<tr><th id="216">216</th><td><i class="doc"> *<span class="command"> @option</span>: operation</i></td></tr>
<tr><th id="217">217</th><td><i class="doc"> * <span class="command">@arg</span>2: argument</i></td></tr>
<tr><th id="218">218</th><td><i class="doc"> * <span class="command">@arg</span>3: argument</i></td></tr>
<tr><th id="219">219</th><td><i class="doc"> * <span class="command">@arg</span>4: argument</i></td></tr>
<tr><th id="220">220</th><td><i class="doc"> * <span class="command">@arg</span>5: argument</i></td></tr>
<tr><th id="221">221</th><td><i class="doc"> *</i></td></tr>
<tr><th id="222">222</th><td><i class="doc"> * Return 0 on success, -ve on error.  -ENOSYS is returned when Yama</i></td></tr>
<tr><th id="223">223</th><td><i class="doc"> * does not handle the given option.</i></td></tr>
<tr><th id="224">224</th><td><i class="doc"> */</i></td></tr>
<tr><th id="225">225</th><td><em>int</em> <dfn class="decl def fn" id="yama_task_prctl" title='yama_task_prctl' data-ref="yama_task_prctl">yama_task_prctl</dfn>(<em>int</em> <dfn class="local col3 decl" id="23option" title='option' data-type='int' data-ref="23option">option</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col4 decl" id="24arg2" title='arg2' data-type='unsigned long' data-ref="24arg2">arg2</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="25arg3" title='arg3' data-type='unsigned long' data-ref="25arg3">arg3</dfn>,</td></tr>
<tr><th id="226">226</th><td>			   <em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="26arg4" title='arg4' data-type='unsigned long' data-ref="26arg4">arg4</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="27arg5" title='arg5' data-type='unsigned long' data-ref="27arg5">arg5</dfn>)</td></tr>
<tr><th id="227">227</th><td>{</td></tr>
<tr><th id="228">228</th><td>	<em>int</em> <dfn class="local col8 decl" id="28rc" title='rc' data-type='int' data-ref="28rc">rc</dfn> = -<a class="macro" href="../../include/uapi/asm-generic/errno.h.html#18" title="38" data-ref="_M/ENOSYS">ENOSYS</a>;</td></tr>
<tr><th id="229">229</th><td>	<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col9 decl" id="29myself" title='myself' data-type='struct task_struct *' data-ref="29myself">myself</dfn> = <a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>;</td></tr>
<tr><th id="230">230</th><td></td></tr>
<tr><th id="231">231</th><td>	<b>switch</b> (<a class="local col3 ref" href="#23option" title='option' data-ref="23option">option</a>) {</td></tr>
<tr><th id="232">232</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/prctl.h.html#155" title="0x59616d61" data-ref="_M/PR_SET_PTRACER">PR_SET_PTRACER</a>:</td></tr>
<tr><th id="233">233</th><td>		<i>/* Since a thread can call prctl(), find the group leader</i></td></tr>
<tr><th id="234">234</th><td><i>		 * before calling _add() or _del() on it, since we want</i></td></tr>
<tr><th id="235">235</th><td><i>		 * process-level granularity of control. The tracer group</i></td></tr>
<tr><th id="236">236</th><td><i>		 * leader checking is handled later when walking the ancestry</i></td></tr>
<tr><th id="237">237</th><td><i>		 * at the time of PTRACE_ATTACH check.</i></td></tr>
<tr><th id="238">238</th><td><i>		 */</i></td></tr>
<tr><th id="239">239</th><td>		<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_lock" title='rcu_read_lock' data-ref="rcu_read_lock">rcu_read_lock</a>();</td></tr>
<tr><th id="240">240</th><td>		<b>if</b> (!<a class="ref fn" href="../../include/linux/sched/signal.h.html#thread_group_leader" title='thread_group_leader' data-ref="thread_group_leader">thread_group_leader</a>(<a class="local col9 ref" href="#29myself" title='myself' data-ref="29myself">myself</a>))</td></tr>
<tr><th id="241">241</th><td>			<a class="local col9 ref" href="#29myself" title='myself' data-ref="29myself">myself</a> = <a class="macro" href="../../include/linux/rcupdate.h.html#545" title="({ typeof(*(myself-&gt;group_leader)) *________p1 = (typeof(*(myself-&gt;group_leader)) *)({ union { typeof((myself-&gt;group_leader)) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((myself-&gt;group_leader)), __u.__c, sizeof((myself-&gt;group_leader))); else __read_once_size_nocheck(&amp;((myself-&gt;group_leader)), __u.__c, sizeof((myself-&gt;group_leader))); do { } while (0); __u.__val; }); do { } while (0); ; ((typeof(*(myself-&gt;group_leader)) *)(________p1)); })" data-ref="_M/rcu_dereference">rcu_dereference</a>(<a class="local col9 ref" href="#29myself" title='myself' data-ref="29myself">myself</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::group_leader" title='task_struct::group_leader' data-ref="task_struct::group_leader">group_leader</a>);</td></tr>
<tr><th id="242">242</th><td>		<a class="macro" href="../../include/linux/sched/task.h.html#89" title="do { atomic_inc(&amp;(myself)-&gt;usage); } while(0)" data-ref="_M/get_task_struct">get_task_struct</a>(<a class="local col9 ref" href="#29myself" title='myself' data-ref="29myself">myself</a>);</td></tr>
<tr><th id="243">243</th><td>		<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_unlock" title='rcu_read_unlock' data-ref="rcu_read_unlock">rcu_read_unlock</a>();</td></tr>
<tr><th id="244">244</th><td></td></tr>
<tr><th id="245">245</th><td>		<b>if</b> (<a class="local col4 ref" href="#24arg2" title='arg2' data-ref="24arg2">arg2</a> == <var>0</var>) {</td></tr>
<tr><th id="246">246</th><td>			<a class="tu ref fn" href="#yama_ptracer_del" title='yama_ptracer_del' data-use='c' data-ref="yama_ptracer_del">yama_ptracer_del</a>(<a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="local col9 ref" href="#29myself" title='myself' data-ref="29myself">myself</a>);</td></tr>
<tr><th id="247">247</th><td>			<a class="local col8 ref" href="#28rc" title='rc' data-ref="28rc">rc</a> = <var>0</var>;</td></tr>
<tr><th id="248">248</th><td>		} <b>else</b> <b>if</b> (<a class="local col4 ref" href="#24arg2" title='arg2' data-ref="24arg2">arg2</a> == <a class="macro" href="../../include/uapi/linux/prctl.h.html#156" title="((unsigned long)-1)" data-ref="_M/PR_SET_PTRACER_ANY">PR_SET_PTRACER_ANY</a> || (<em>int</em>)<a class="local col4 ref" href="#24arg2" title='arg2' data-ref="24arg2">arg2</a> == -<var>1</var>) {</td></tr>
<tr><th id="249">249</th><td>			<a class="local col8 ref" href="#28rc" title='rc' data-ref="28rc">rc</a> = <a class="tu ref fn" href="#yama_ptracer_add" title='yama_ptracer_add' data-use='c' data-ref="yama_ptracer_add">yama_ptracer_add</a>(<a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="local col9 ref" href="#29myself" title='myself' data-ref="29myself">myself</a>);</td></tr>
<tr><th id="250">250</th><td>		} <b>else</b> {</td></tr>
<tr><th id="251">251</th><td>			<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col0 decl" id="30tracer" title='tracer' data-type='struct task_struct *' data-ref="30tracer">tracer</dfn>;</td></tr>
<tr><th id="252">252</th><td></td></tr>
<tr><th id="253">253</th><td>			<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_lock" title='rcu_read_lock' data-ref="rcu_read_lock">rcu_read_lock</a>();</td></tr>
<tr><th id="254">254</th><td>			<a class="local col0 ref" href="#30tracer" title='tracer' data-ref="30tracer">tracer</a> = <a class="ref fn" href="../../include/linux/sched.h.html#find_task_by_vpid" title='find_task_by_vpid' data-ref="find_task_by_vpid">find_task_by_vpid</a>(<a class="local col4 ref" href="#24arg2" title='arg2' data-ref="24arg2">arg2</a>);</td></tr>
<tr><th id="255">255</th><td>			<b>if</b> (<a class="local col0 ref" href="#30tracer" title='tracer' data-ref="30tracer">tracer</a>)</td></tr>
<tr><th id="256">256</th><td>				<a class="macro" href="../../include/linux/sched/task.h.html#89" title="do { atomic_inc(&amp;(tracer)-&gt;usage); } while(0)" data-ref="_M/get_task_struct">get_task_struct</a>(<a class="local col0 ref" href="#30tracer" title='tracer' data-ref="30tracer">tracer</a>);</td></tr>
<tr><th id="257">257</th><td>			<b>else</b></td></tr>
<tr><th id="258">258</th><td>				<a class="local col8 ref" href="#28rc" title='rc' data-ref="28rc">rc</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="259">259</th><td>			<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_unlock" title='rcu_read_unlock' data-ref="rcu_read_unlock">rcu_read_unlock</a>();</td></tr>
<tr><th id="260">260</th><td></td></tr>
<tr><th id="261">261</th><td>			<b>if</b> (<a class="local col0 ref" href="#30tracer" title='tracer' data-ref="30tracer">tracer</a>) {</td></tr>
<tr><th id="262">262</th><td>				<a class="local col8 ref" href="#28rc" title='rc' data-ref="28rc">rc</a> = <a class="tu ref fn" href="#yama_ptracer_add" title='yama_ptracer_add' data-use='c' data-ref="yama_ptracer_add">yama_ptracer_add</a>(<a class="local col0 ref" href="#30tracer" title='tracer' data-ref="30tracer">tracer</a>, <a class="local col9 ref" href="#29myself" title='myself' data-ref="29myself">myself</a>);</td></tr>
<tr><th id="263">263</th><td>				<a class="ref fn" href="../../include/linux/sched/task.h.html#put_task_struct" title='put_task_struct' data-ref="put_task_struct">put_task_struct</a>(<a class="local col0 ref" href="#30tracer" title='tracer' data-ref="30tracer">tracer</a>);</td></tr>
<tr><th id="264">264</th><td>			}</td></tr>
<tr><th id="265">265</th><td>		}</td></tr>
<tr><th id="266">266</th><td></td></tr>
<tr><th id="267">267</th><td>		<a class="ref fn" href="../../include/linux/sched/task.h.html#put_task_struct" title='put_task_struct' data-ref="put_task_struct">put_task_struct</a>(<a class="local col9 ref" href="#29myself" title='myself' data-ref="29myself">myself</a>);</td></tr>
<tr><th id="268">268</th><td>		<b>break</b>;</td></tr>
<tr><th id="269">269</th><td>	}</td></tr>
<tr><th id="270">270</th><td></td></tr>
<tr><th id="271">271</th><td>	<b>return</b> <a class="local col8 ref" href="#28rc" title='rc' data-ref="28rc">rc</a>;</td></tr>
<tr><th id="272">272</th><td>}</td></tr>
<tr><th id="273">273</th><td></td></tr>
<tr><th id="274">274</th><td><i class="doc" data-doc="task_is_descendant">/**</i></td></tr>
<tr><th id="275">275</th><td><i class="doc" data-doc="task_is_descendant"> * task_is_descendant - walk up a process family tree looking for a match</i></td></tr>
<tr><th id="276">276</th><td><i class="doc" data-doc="task_is_descendant"> *<span class="command"> @parent</span>: the process to compare against while walking up from child</i></td></tr>
<tr><th id="277">277</th><td><i class="doc" data-doc="task_is_descendant"> *<span class="command"> @child</span>: the process to start from while looking upwards for parent</i></td></tr>
<tr><th id="278">278</th><td><i class="doc" data-doc="task_is_descendant"> *</i></td></tr>
<tr><th id="279">279</th><td><i class="doc" data-doc="task_is_descendant"> * Returns 1 if child is a descendant of parent, 0 if not.</i></td></tr>
<tr><th id="280">280</th><td><i class="doc" data-doc="task_is_descendant"> */</i></td></tr>
<tr><th id="281">281</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="task_is_descendant" title='task_is_descendant' data-type='int task_is_descendant(struct task_struct * parent, struct task_struct * child)' data-ref="task_is_descendant">task_is_descendant</dfn>(<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col1 decl" id="31parent" title='parent' data-type='struct task_struct *' data-ref="31parent">parent</dfn>,</td></tr>
<tr><th id="282">282</th><td>			      <b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col2 decl" id="32child" title='child' data-type='struct task_struct *' data-ref="32child">child</dfn>)</td></tr>
<tr><th id="283">283</th><td>{</td></tr>
<tr><th id="284">284</th><td>	<em>int</em> <dfn class="local col3 decl" id="33rc" title='rc' data-type='int' data-ref="33rc">rc</dfn> = <var>0</var>;</td></tr>
<tr><th id="285">285</th><td>	<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col4 decl" id="34walker" title='walker' data-type='struct task_struct *' data-ref="34walker">walker</dfn> = <a class="local col2 ref" href="#32child" title='child' data-ref="32child">child</a>;</td></tr>
<tr><th id="286">286</th><td></td></tr>
<tr><th id="287">287</th><td>	<b>if</b> (!<a class="local col1 ref" href="#31parent" title='parent' data-ref="31parent">parent</a> || !<a class="local col2 ref" href="#32child" title='child' data-ref="32child">child</a>)</td></tr>
<tr><th id="288">288</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="289">289</th><td></td></tr>
<tr><th id="290">290</th><td>	<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_lock" title='rcu_read_lock' data-ref="rcu_read_lock">rcu_read_lock</a>();</td></tr>
<tr><th id="291">291</th><td>	<b>if</b> (!<a class="ref fn" href="../../include/linux/sched/signal.h.html#thread_group_leader" title='thread_group_leader' data-ref="thread_group_leader">thread_group_leader</a>(<a class="local col1 ref" href="#31parent" title='parent' data-ref="31parent">parent</a>))</td></tr>
<tr><th id="292">292</th><td>		<a class="local col1 ref" href="#31parent" title='parent' data-ref="31parent">parent</a> = <a class="macro" href="../../include/linux/rcupdate.h.html#545" title="({ typeof(*(parent-&gt;group_leader)) *________p1 = (typeof(*(parent-&gt;group_leader)) *)({ union { typeof((parent-&gt;group_leader)) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((parent-&gt;group_leader)), __u.__c, sizeof((parent-&gt;group_leader))); else __read_once_size_nocheck(&amp;((parent-&gt;group_leader)), __u.__c, sizeof((parent-&gt;group_leader))); do { } while (0); __u.__val; }); do { } while (0); ; ((typeof(*(parent-&gt;group_leader)) *)(________p1)); })" data-ref="_M/rcu_dereference">rcu_dereference</a>(<a class="local col1 ref" href="#31parent" title='parent' data-ref="31parent">parent</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::group_leader" title='task_struct::group_leader' data-ref="task_struct::group_leader">group_leader</a>);</td></tr>
<tr><th id="293">293</th><td>	<b>while</b> (<a class="local col4 ref" href="#34walker" title='walker' data-ref="34walker">walker</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::pid" title='task_struct::pid' data-ref="task_struct::pid">pid</a> &gt; <var>0</var>) {</td></tr>
<tr><th id="294">294</th><td>		<b>if</b> (!<a class="ref fn" href="../../include/linux/sched/signal.h.html#thread_group_leader" title='thread_group_leader' data-ref="thread_group_leader">thread_group_leader</a>(<a class="local col4 ref" href="#34walker" title='walker' data-ref="34walker">walker</a>))</td></tr>
<tr><th id="295">295</th><td>			<a class="local col4 ref" href="#34walker" title='walker' data-ref="34walker">walker</a> = <a class="macro" href="../../include/linux/rcupdate.h.html#545" title="({ typeof(*(walker-&gt;group_leader)) *________p1 = (typeof(*(walker-&gt;group_leader)) *)({ union { typeof((walker-&gt;group_leader)) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((walker-&gt;group_leader)), __u.__c, sizeof((walker-&gt;group_leader))); else __read_once_size_nocheck(&amp;((walker-&gt;group_leader)), __u.__c, sizeof((walker-&gt;group_leader))); do { } while (0); __u.__val; }); do { } while (0); ; ((typeof(*(walker-&gt;group_leader)) *)(________p1)); })" data-ref="_M/rcu_dereference">rcu_dereference</a>(<a class="local col4 ref" href="#34walker" title='walker' data-ref="34walker">walker</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::group_leader" title='task_struct::group_leader' data-ref="task_struct::group_leader">group_leader</a>);</td></tr>
<tr><th id="296">296</th><td>		<b>if</b> (<a class="local col4 ref" href="#34walker" title='walker' data-ref="34walker">walker</a> == <a class="local col1 ref" href="#31parent" title='parent' data-ref="31parent">parent</a>) {</td></tr>
<tr><th id="297">297</th><td>			<a class="local col3 ref" href="#33rc" title='rc' data-ref="33rc">rc</a> = <var>1</var>;</td></tr>
<tr><th id="298">298</th><td>			<b>break</b>;</td></tr>
<tr><th id="299">299</th><td>		}</td></tr>
<tr><th id="300">300</th><td>		<a class="local col4 ref" href="#34walker" title='walker' data-ref="34walker">walker</a> = <a class="macro" href="../../include/linux/rcupdate.h.html#545" title="({ typeof(*(walker-&gt;real_parent)) *________p1 = (typeof(*(walker-&gt;real_parent)) *)({ union { typeof((walker-&gt;real_parent)) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((walker-&gt;real_parent)), __u.__c, sizeof((walker-&gt;real_parent))); else __read_once_size_nocheck(&amp;((walker-&gt;real_parent)), __u.__c, sizeof((walker-&gt;real_parent))); do { } while (0); __u.__val; }); do { } while (0); ; ((typeof(*(walker-&gt;real_parent)) *)(________p1)); })" data-ref="_M/rcu_dereference">rcu_dereference</a>(<a class="local col4 ref" href="#34walker" title='walker' data-ref="34walker">walker</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::real_parent" title='task_struct::real_parent' data-ref="task_struct::real_parent">real_parent</a>);</td></tr>
<tr><th id="301">301</th><td>	}</td></tr>
<tr><th id="302">302</th><td>	<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_unlock" title='rcu_read_unlock' data-ref="rcu_read_unlock">rcu_read_unlock</a>();</td></tr>
<tr><th id="303">303</th><td></td></tr>
<tr><th id="304">304</th><td>	<b>return</b> <a class="local col3 ref" href="#33rc" title='rc' data-ref="33rc">rc</a>;</td></tr>
<tr><th id="305">305</th><td>}</td></tr>
<tr><th id="306">306</th><td></td></tr>
<tr><th id="307">307</th><td><i class="doc" data-doc="ptracer_exception_found">/**</i></td></tr>
<tr><th id="308">308</th><td><i class="doc" data-doc="ptracer_exception_found"> * ptracer_exception_found - tracer registered as exception for this tracee</i></td></tr>
<tr><th id="309">309</th><td><i class="doc" data-doc="ptracer_exception_found"> *<span class="command"> @tracer</span>: the task_struct of the process attempting ptrace</i></td></tr>
<tr><th id="310">310</th><td><i class="doc" data-doc="ptracer_exception_found"> *<span class="command"> @tracee</span>: the task_struct of the process to be ptraced</i></td></tr>
<tr><th id="311">311</th><td><i class="doc" data-doc="ptracer_exception_found"> *</i></td></tr>
<tr><th id="312">312</th><td><i class="doc" data-doc="ptracer_exception_found"> * Returns 1 if tracer has a ptracer exception ancestor for tracee.</i></td></tr>
<tr><th id="313">313</th><td><i class="doc" data-doc="ptracer_exception_found"> */</i></td></tr>
<tr><th id="314">314</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="ptracer_exception_found" title='ptracer_exception_found' data-type='int ptracer_exception_found(struct task_struct * tracer, struct task_struct * tracee)' data-ref="ptracer_exception_found">ptracer_exception_found</dfn>(<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col5 decl" id="35tracer" title='tracer' data-type='struct task_struct *' data-ref="35tracer">tracer</dfn>,</td></tr>
<tr><th id="315">315</th><td>				   <b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col6 decl" id="36tracee" title='tracee' data-type='struct task_struct *' data-ref="36tracee">tracee</dfn>)</td></tr>
<tr><th id="316">316</th><td>{</td></tr>
<tr><th id="317">317</th><td>	<em>int</em> <dfn class="local col7 decl" id="37rc" title='rc' data-type='int' data-ref="37rc">rc</dfn> = <var>0</var>;</td></tr>
<tr><th id="318">318</th><td>	<b>struct</b> <a class="type" href="#ptrace_relation" title='ptrace_relation' data-ref="ptrace_relation">ptrace_relation</a> *<dfn class="local col8 decl" id="38relation" title='relation' data-type='struct ptrace_relation *' data-ref="38relation">relation</dfn>;</td></tr>
<tr><th id="319">319</th><td>	<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col9 decl" id="39parent" title='parent' data-type='struct task_struct *' data-ref="39parent">parent</dfn> = <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="320">320</th><td>	<a class="typedef" href="../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="local col0 decl" id="40found" title='found' data-type='bool' data-ref="40found">found</dfn> = <a class="enum" href="../../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="321">321</th><td></td></tr>
<tr><th id="322">322</th><td>	<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_lock" title='rcu_read_lock' data-ref="rcu_read_lock">rcu_read_lock</a>();</td></tr>
<tr><th id="323">323</th><td></td></tr>
<tr><th id="324">324</th><td>	<i>/*</i></td></tr>
<tr><th id="325">325</th><td><i>	 * If there's already an active tracing relationship, then make an</i></td></tr>
<tr><th id="326">326</th><td><i>	 * exception for the sake of other accesses, like process_vm_rw().</i></td></tr>
<tr><th id="327">327</th><td><i>	 */</i></td></tr>
<tr><th id="328">328</th><td>	<a class="local col9 ref" href="#39parent" title='parent' data-ref="39parent">parent</a> = <a class="ref fn" href="../../include/linux/ptrace.h.html#ptrace_parent" title='ptrace_parent' data-ref="ptrace_parent">ptrace_parent</a>(<a class="local col6 ref" href="#36tracee" title='tracee' data-ref="36tracee">tracee</a>);</td></tr>
<tr><th id="329">329</th><td>	<b>if</b> (<a class="local col9 ref" href="#39parent" title='parent' data-ref="39parent">parent</a> != <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a> &amp;&amp; <a class="ref fn" href="../../include/linux/sched/signal.h.html#same_thread_group" title='same_thread_group' data-ref="same_thread_group">same_thread_group</a>(<a class="local col9 ref" href="#39parent" title='parent' data-ref="39parent">parent</a>, <a class="local col5 ref" href="#35tracer" title='tracer' data-ref="35tracer">tracer</a>)) {</td></tr>
<tr><th id="330">330</th><td>		<a class="local col7 ref" href="#37rc" title='rc' data-ref="37rc">rc</a> = <var>1</var>;</td></tr>
<tr><th id="331">331</th><td>		<b>goto</b> <a class="lbl" href="#41unlock" data-ref="41unlock">unlock</a>;</td></tr>
<tr><th id="332">332</th><td>	}</td></tr>
<tr><th id="333">333</th><td></td></tr>
<tr><th id="334">334</th><td>	<i>/* Look for a PR_SET_PTRACER relationship. */</i></td></tr>
<tr><th id="335">335</th><td>	<b>if</b> (!<a class="ref fn" href="../../include/linux/sched/signal.h.html#thread_group_leader" title='thread_group_leader' data-ref="thread_group_leader">thread_group_leader</a>(<a class="local col6 ref" href="#36tracee" title='tracee' data-ref="36tracee">tracee</a>))</td></tr>
<tr><th id="336">336</th><td>		<a class="local col6 ref" href="#36tracee" title='tracee' data-ref="36tracee">tracee</a> = <a class="macro" href="../../include/linux/rcupdate.h.html#545" title="({ typeof(*(tracee-&gt;group_leader)) *________p1 = (typeof(*(tracee-&gt;group_leader)) *)({ union { typeof((tracee-&gt;group_leader)) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((tracee-&gt;group_leader)), __u.__c, sizeof((tracee-&gt;group_leader))); else __read_once_size_nocheck(&amp;((tracee-&gt;group_leader)), __u.__c, sizeof((tracee-&gt;group_leader))); do { } while (0); __u.__val; }); do { } while (0); ; ((typeof(*(tracee-&gt;group_leader)) *)(________p1)); })" data-ref="_M/rcu_dereference">rcu_dereference</a>(<a class="local col6 ref" href="#36tracee" title='tracee' data-ref="36tracee">tracee</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::group_leader" title='task_struct::group_leader' data-ref="task_struct::group_leader">group_leader</a>);</td></tr>
<tr><th id="337">337</th><td>	<a class="macro" href="../../include/linux/rculist.h.html#351" title="for (relation = ({ void *__mptr = (void *)(({ union { typeof((&amp;ptracer_relations)-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); else __read_once_size_nocheck(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); do { } while (0); __u.__val; })); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(({ union { typeof((&amp;ptracer_relations)-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); else __read_once_size_nocheck(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); do { } while (0); __u.__val; }))), typeof(((typeof(*relation) *)0)-&gt;node)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(({ union { typeof((&amp;ptracer_relations)-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); else __read_once_size_nocheck(&amp;((&amp;ptracer_relations)-&gt;next), __u.__c, sizeof((&amp;ptracer_relations)-&gt;next)); do { } while (0); __u.__val; }))), typeof(void)))); extern void __compiletime_assert_337(void) ; if (__cond) __compiletime_assert_337(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*relation) *)(__mptr - __builtin_offsetof(typeof(*relation), node))); }); &amp;relation-&gt;node != (&amp;ptracer_relations); relation = ({ void *__mptr = (void *)(({ union { typeof(relation-&gt;node.next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); else __read_once_size_nocheck(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); do { } while (0); __u.__val; })); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(({ union { typeof(relation-&gt;node.next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); else __read_once_size_nocheck(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); do { } while (0); __u.__val; }))), typeof(((typeof(*relation) *)0)-&gt;node)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(({ union { typeof(relation-&gt;node.next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); else __read_once_size_nocheck(&amp;(relation-&gt;node.next), __u.__c, sizeof(relation-&gt;node.next)); do { } while (0); __u.__val; }))), typeof(void)))); extern void __compiletime_assert_337(void) ; if (__cond) __compiletime_assert_337(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*relation) *)(__mptr - __builtin_offsetof(typeof(*relation), node))); }))" data-ref="_M/list_for_each_entry_rcu">list_for_each_entry_rcu</a>(<a class="local col8 ref" href="#38relation" title='relation' data-ref="38relation">relation</a>, &amp;<a class="tu ref" href="#42" title='ptracer_relations' data-use='a' data-ref="ptracer_relations">ptracer_relations</a>, <a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='r' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='a' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node"><a class="tu ref field" href="#ptrace_relation::node" title='ptrace_relation::node' data-use='m' data-ref="ptrace_relation::node">node</a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a>) {</td></tr>
<tr><th id="338">338</th><td>		<b>if</b> (<a class="local col8 ref" href="#38relation" title='relation' data-ref="38relation">relation</a>-&gt;<a class="tu ref field" href="#ptrace_relation::invalid" title='ptrace_relation::invalid' data-use='r' data-ref="ptrace_relation::invalid">invalid</a>)</td></tr>
<tr><th id="339">339</th><td>			<b>continue</b>;</td></tr>
<tr><th id="340">340</th><td>		<b>if</b> (<a class="local col8 ref" href="#38relation" title='relation' data-ref="38relation">relation</a>-&gt;<a class="tu ref field" href="#ptrace_relation::tracee" title='ptrace_relation::tracee' data-use='r' data-ref="ptrace_relation::tracee">tracee</a> == <a class="local col6 ref" href="#36tracee" title='tracee' data-ref="36tracee">tracee</a>) {</td></tr>
<tr><th id="341">341</th><td>			<a class="local col9 ref" href="#39parent" title='parent' data-ref="39parent">parent</a> = <a class="local col8 ref" href="#38relation" title='relation' data-ref="38relation">relation</a>-&gt;<a class="tu ref field" href="#ptrace_relation::tracer" title='ptrace_relation::tracer' data-use='r' data-ref="ptrace_relation::tracer">tracer</a>;</td></tr>
<tr><th id="342">342</th><td>			<a class="local col0 ref" href="#40found" title='found' data-ref="40found">found</a> = <a class="enum" href="../../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="343">343</th><td>			<b>break</b>;</td></tr>
<tr><th id="344">344</th><td>		}</td></tr>
<tr><th id="345">345</th><td>	}</td></tr>
<tr><th id="346">346</th><td></td></tr>
<tr><th id="347">347</th><td>	<b>if</b> (<a class="local col0 ref" href="#40found" title='found' data-ref="40found">found</a> &amp;&amp; (<a class="local col9 ref" href="#39parent" title='parent' data-ref="39parent">parent</a> == <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a> || <a class="tu ref fn" href="#task_is_descendant" title='task_is_descendant' data-use='c' data-ref="task_is_descendant">task_is_descendant</a>(<a class="local col9 ref" href="#39parent" title='parent' data-ref="39parent">parent</a>, <a class="local col5 ref" href="#35tracer" title='tracer' data-ref="35tracer">tracer</a>)))</td></tr>
<tr><th id="348">348</th><td>		<a class="local col7 ref" href="#37rc" title='rc' data-ref="37rc">rc</a> = <var>1</var>;</td></tr>
<tr><th id="349">349</th><td></td></tr>
<tr><th id="350">350</th><td><dfn class="lbl" id="41unlock" data-ref="41unlock">unlock</dfn>:</td></tr>
<tr><th id="351">351</th><td>	<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_unlock" title='rcu_read_unlock' data-ref="rcu_read_unlock">rcu_read_unlock</a>();</td></tr>
<tr><th id="352">352</th><td></td></tr>
<tr><th id="353">353</th><td>	<b>return</b> <a class="local col7 ref" href="#37rc" title='rc' data-ref="37rc">rc</a>;</td></tr>
<tr><th id="354">354</th><td>}</td></tr>
<tr><th id="355">355</th><td></td></tr>
<tr><th id="356">356</th><td><i class="doc" data-doc="yama_ptrace_access_check">/**</i></td></tr>
<tr><th id="357">357</th><td><i class="doc" data-doc="yama_ptrace_access_check"> * yama_ptrace_access_check - validate PTRACE_ATTACH calls</i></td></tr>
<tr><th id="358">358</th><td><i class="doc" data-doc="yama_ptrace_access_check"> *<span class="command"> @child</span>: task that current task is attempting to ptrace</i></td></tr>
<tr><th id="359">359</th><td><i class="doc" data-doc="yama_ptrace_access_check"> * <span class="command">@mode</span><span class="verb">: ptrace attach mode</span></i></td></tr>
<tr><th id="360">360</th><td><i class="doc" data-doc="yama_ptrace_access_check"><span class="verb"></span> *<span class="verb"></span></i></td></tr>
<tr><th id="361">361</th><td><i class="doc" data-doc="yama_ptrace_access_check"><span class="verb"></span> *<span class="verb"> Returns 0 if following the ptrace is allowed, -ve on error.</span></i></td></tr>
<tr><th id="362">362</th><td><i class="doc" data-doc="yama_ptrace_access_check"><span class="verb"></span><span class="verb"> *</span>/</i><span class="verb"></span></td></tr>
<tr><th id="363">363</th><td><span class="verb"></span><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="yama_ptrace_access_check" title='yama_ptrace_access_check' data-type='int yama_ptrace_access_check(struct task_struct * child, unsigned int mode)' data-ref="yama_ptrace_access_check">yama_ptrace_access_check</dfn>(<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col2 decl" id="42child" title='child' data-type='struct task_struct *' data-ref="42child">child</dfn>,</td></tr>
<tr><th id="364">364</th><td>				    <em>unsigned</em> <em>int</em> <dfn class="local col3 decl" id="43mode" title='mode' data-type='unsigned int' data-ref="43mode">mode</dfn>)</td></tr>
<tr><th id="365">365</th><td>{</td></tr>
<tr><th id="366">366</th><td>	<em>int</em> <dfn class="local col4 decl" id="44rc" title='rc' data-type='int' data-ref="44rc">rc</dfn> = <var>0</var>;</td></tr>
<tr><th id="367">367</th><td></td></tr>
<tr><th id="368">368</th><td>	<i>/* require ptrace target be a child of ptracer on attach */</i></td></tr>
<tr><th id="369">369</th><td>	<b>if</b> (<a class="local col3 ref" href="#43mode" title='mode' data-ref="43mode">mode</a> &amp; <a class="macro" href="../../include/linux/ptrace.h.html#63" title="0x02" data-ref="_M/PTRACE_MODE_ATTACH">PTRACE_MODE_ATTACH</a>) {</td></tr>
<tr><th id="370">370</th><td>		<b>switch</b> (<a class="tu ref" href="#ptrace_scope" title='ptrace_scope' data-use='r' data-ref="ptrace_scope">ptrace_scope</a>) {</td></tr>
<tr><th id="371">371</th><td>		<b>case</b> <a class="macro" href="#26" title="0" data-ref="_M/YAMA_SCOPE_DISABLED">YAMA_SCOPE_DISABLED</a>:</td></tr>
<tr><th id="372">372</th><td>			<i>/* No additional restrictions. */</i></td></tr>
<tr><th id="373">373</th><td>			<b>break</b>;</td></tr>
<tr><th id="374">374</th><td>		<b>case</b> <a class="macro" href="#27" title="1" data-ref="_M/YAMA_SCOPE_RELATIONAL">YAMA_SCOPE_RELATIONAL</a>:</td></tr>
<tr><th id="375">375</th><td>			<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_lock" title='rcu_read_lock' data-ref="rcu_read_lock">rcu_read_lock</a>();</td></tr>
<tr><th id="376">376</th><td>			<b>if</b> (!<a class="tu ref fn" href="#task_is_descendant" title='task_is_descendant' data-use='c' data-ref="task_is_descendant">task_is_descendant</a>(<a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>, <a class="local col2 ref" href="#42child" title='child' data-ref="42child">child</a>) &amp;&amp;</td></tr>
<tr><th id="377">377</th><td>			    !<a class="tu ref fn" href="#ptracer_exception_found" title='ptracer_exception_found' data-use='c' data-ref="ptracer_exception_found">ptracer_exception_found</a>(<a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>, <a class="local col2 ref" href="#42child" title='child' data-ref="42child">child</a>) &amp;&amp;</td></tr>
<tr><th id="378">378</th><td>			    !<a class="ref fn" href="../../include/linux/capability.h.html#ns_capable" title='ns_capable' data-ref="ns_capable">ns_capable</a>(<a class="macro" href="../../include/linux/cred.h.html#297" title="({ typeof(*((child)-&gt;real_cred)) *________p1 = (typeof(*((child)-&gt;real_cred)) *)({ union { typeof(((child)-&gt;real_cred)) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(((child)-&gt;real_cred)), __u.__c, sizeof(((child)-&gt;real_cred))); else __read_once_size_nocheck(&amp;(((child)-&gt;real_cred)), __u.__c, sizeof(((child)-&gt;real_cred))); do { } while (0); __u.__val; }); do { } while (0); ; ((typeof(*((child)-&gt;real_cred)) *)(________p1)); })" data-ref="_M/__task_cred">__task_cred</a>(<a class="local col2 ref" href="#42child" title='child' data-ref="42child">child</a>)-&gt;<a class="ref field" href="../../include/linux/cred.h.html#cred::user_ns" title='cred::user_ns' data-ref="cred::user_ns">user_ns</a>, <a class="macro" href="../../include/uapi/linux/capability.h.html#235" title="19" data-ref="_M/CAP_SYS_PTRACE">CAP_SYS_PTRACE</a>))</td></tr>
<tr><th id="379">379</th><td>				<a class="local col4 ref" href="#44rc" title='rc' data-ref="44rc">rc</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="380">380</th><td>			<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_unlock" title='rcu_read_unlock' data-ref="rcu_read_unlock">rcu_read_unlock</a>();</td></tr>
<tr><th id="381">381</th><td>			<b>break</b>;</td></tr>
<tr><th id="382">382</th><td>		<b>case</b> <a class="macro" href="#28" title="2" data-ref="_M/YAMA_SCOPE_CAPABILITY">YAMA_SCOPE_CAPABILITY</a>:</td></tr>
<tr><th id="383">383</th><td>			<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_lock" title='rcu_read_lock' data-ref="rcu_read_lock">rcu_read_lock</a>();</td></tr>
<tr><th id="384">384</th><td>			<b>if</b> (!<a class="ref fn" href="../../include/linux/capability.h.html#ns_capable" title='ns_capable' data-ref="ns_capable">ns_capable</a>(<a class="macro" href="../../include/linux/cred.h.html#297" title="({ typeof(*((child)-&gt;real_cred)) *________p1 = (typeof(*((child)-&gt;real_cred)) *)({ union { typeof(((child)-&gt;real_cred)) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(((child)-&gt;real_cred)), __u.__c, sizeof(((child)-&gt;real_cred))); else __read_once_size_nocheck(&amp;(((child)-&gt;real_cred)), __u.__c, sizeof(((child)-&gt;real_cred))); do { } while (0); __u.__val; }); do { } while (0); ; ((typeof(*((child)-&gt;real_cred)) *)(________p1)); })" data-ref="_M/__task_cred">__task_cred</a>(<a class="local col2 ref" href="#42child" title='child' data-ref="42child">child</a>)-&gt;<a class="ref field" href="../../include/linux/cred.h.html#cred::user_ns" title='cred::user_ns' data-ref="cred::user_ns">user_ns</a>, <a class="macro" href="../../include/uapi/linux/capability.h.html#235" title="19" data-ref="_M/CAP_SYS_PTRACE">CAP_SYS_PTRACE</a>))</td></tr>
<tr><th id="385">385</th><td>				<a class="local col4 ref" href="#44rc" title='rc' data-ref="44rc">rc</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="386">386</th><td>			<a class="ref fn" href="../../include/linux/rcupdate.h.html#rcu_read_unlock" title='rcu_read_unlock' data-ref="rcu_read_unlock">rcu_read_unlock</a>();</td></tr>
<tr><th id="387">387</th><td>			<b>break</b>;</td></tr>
<tr><th id="388">388</th><td>		<b>case</b> <a class="macro" href="#29" title="3" data-ref="_M/YAMA_SCOPE_NO_ATTACH">YAMA_SCOPE_NO_ATTACH</a>:</td></tr>
<tr><th id="389">389</th><td>		<b>default</b>:</td></tr>
<tr><th id="390">390</th><td>			<a class="local col4 ref" href="#44rc" title='rc' data-ref="44rc">rc</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="391">391</th><td>			<b>break</b>;</td></tr>
<tr><th id="392">392</th><td>		}</td></tr>
<tr><th id="393">393</th><td>	}</td></tr>
<tr><th id="394">394</th><td></td></tr>
<tr><th id="395">395</th><td>	<b>if</b> (<a class="local col4 ref" href="#44rc" title='rc' data-ref="44rc">rc</a> &amp;&amp; (<a class="local col3 ref" href="#43mode" title='mode' data-ref="43mode">mode</a> &amp; <a class="macro" href="../../include/linux/ptrace.h.html#64" title="0x04" data-ref="_M/PTRACE_MODE_NOAUDIT">PTRACE_MODE_NOAUDIT</a>) == <var>0</var>)</td></tr>
<tr><th id="396">396</th><td>		<a class="tu ref fn" href="#report_access" title='report_access' data-use='c' data-ref="report_access">report_access</a>(<q>"attach"</q>, <a class="local col2 ref" href="#42child" title='child' data-ref="42child">child</a>, <a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>);</td></tr>
<tr><th id="397">397</th><td></td></tr>
<tr><th id="398">398</th><td>	<b>return</b> <a class="local col4 ref" href="#44rc" title='rc' data-ref="44rc">rc</a>;</td></tr>
<tr><th id="399">399</th><td>}</td></tr>
<tr><th id="400">400</th><td></td></tr>
<tr><th id="401">401</th><td><i class="doc">/**</i></td></tr>
<tr><th id="402">402</th><td><i class="doc"> * yama_ptrace_traceme - validate PTRACE_TRACEME calls</i></td></tr>
<tr><th id="403">403</th><td><i class="doc"> *<span class="command"> @parent</span>: task that will become the ptracer of the current task</i></td></tr>
<tr><th id="404">404</th><td><i class="doc"> *</i></td></tr>
<tr><th id="405">405</th><td><i class="doc"> * Returns 0 if following the ptrace is allowed, -ve on error.</i></td></tr>
<tr><th id="406">406</th><td><i class="doc"> */</i></td></tr>
<tr><th id="407">407</th><td><em>int</em> <dfn class="decl def fn" id="yama_ptrace_traceme" title='yama_ptrace_traceme' data-ref="yama_ptrace_traceme">yama_ptrace_traceme</dfn>(<b>struct</b> <a class="type" href="../../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct">task_struct</a> *<dfn class="local col5 decl" id="45parent" title='parent' data-type='struct task_struct *' data-ref="45parent">parent</dfn>)</td></tr>
<tr><th id="408">408</th><td>{</td></tr>
<tr><th id="409">409</th><td>	<em>int</em> <dfn class="local col6 decl" id="46rc" title='rc' data-type='int' data-ref="46rc">rc</dfn> = <var>0</var>;</td></tr>
<tr><th id="410">410</th><td></td></tr>
<tr><th id="411">411</th><td>	<i>/* Only disallow PTRACE_TRACEME on more aggressive settings. */</i></td></tr>
<tr><th id="412">412</th><td>	<b>switch</b> (<a class="tu ref" href="#ptrace_scope" title='ptrace_scope' data-use='r' data-ref="ptrace_scope">ptrace_scope</a>) {</td></tr>
<tr><th id="413">413</th><td>	<b>case</b> <a class="macro" href="#28" title="2" data-ref="_M/YAMA_SCOPE_CAPABILITY">YAMA_SCOPE_CAPABILITY</a>:</td></tr>
<tr><th id="414">414</th><td>		<b>if</b> (!<a class="ref fn" href="../../include/linux/capability.h.html#has_ns_capability" title='has_ns_capability' data-ref="has_ns_capability">has_ns_capability</a>(<a class="local col5 ref" href="#45parent" title='parent' data-ref="45parent">parent</a>, <a class="ref fn" href="../../include/linux/cred.h.html#current_user_ns" title='current_user_ns' data-ref="current_user_ns">current_user_ns</a>(), <a class="macro" href="../../include/uapi/linux/capability.h.html#235" title="19" data-ref="_M/CAP_SYS_PTRACE">CAP_SYS_PTRACE</a>))</td></tr>
<tr><th id="415">415</th><td>			<a class="local col6 ref" href="#46rc" title='rc' data-ref="46rc">rc</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="416">416</th><td>		<b>break</b>;</td></tr>
<tr><th id="417">417</th><td>	<b>case</b> <a class="macro" href="#29" title="3" data-ref="_M/YAMA_SCOPE_NO_ATTACH">YAMA_SCOPE_NO_ATTACH</a>:</td></tr>
<tr><th id="418">418</th><td>		<a class="local col6 ref" href="#46rc" title='rc' data-ref="46rc">rc</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="419">419</th><td>		<b>break</b>;</td></tr>
<tr><th id="420">420</th><td>	}</td></tr>
<tr><th id="421">421</th><td></td></tr>
<tr><th id="422">422</th><td>	<b>if</b> (<a class="local col6 ref" href="#46rc" title='rc' data-ref="46rc">rc</a>) {</td></tr>
<tr><th id="423">423</th><td>		<a class="ref fn" href="../../include/linux/sched/task.h.html#task_lock" title='task_lock' data-ref="task_lock">task_lock</a>(<a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>);</td></tr>
<tr><th id="424">424</th><td>		<a class="tu ref fn" href="#report_access" title='report_access' data-use='c' data-ref="report_access">report_access</a>(<q>"traceme"</q>, <a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>, <a class="local col5 ref" href="#45parent" title='parent' data-ref="45parent">parent</a>);</td></tr>
<tr><th id="425">425</th><td>		<a class="ref fn" href="../../include/linux/sched/task.h.html#task_unlock" title='task_unlock' data-ref="task_unlock">task_unlock</a>(<a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>);</td></tr>
<tr><th id="426">426</th><td>	}</td></tr>
<tr><th id="427">427</th><td></td></tr>
<tr><th id="428">428</th><td>	<b>return</b> <a class="local col6 ref" href="#46rc" title='rc' data-ref="46rc">rc</a>;</td></tr>
<tr><th id="429">429</th><td>}</td></tr>
<tr><th id="430">430</th><td></td></tr>
<tr><th id="431">431</th><td><em>static</em> <b>struct</b> <a class="type" href="../../include/linux/lsm_hooks.h.html#security_hook_list" title='security_hook_list' data-ref="security_hook_list">security_hook_list</a> <dfn class="tu decl def" id="yama_hooks" title='yama_hooks' data-type='struct security_hook_list [4]' data-ref="yama_hooks">yama_hooks</dfn>[] <a class="macro" href="../../include/linux/lsm_hooks.h.html#1957" title="" data-ref="_M/__lsm_ro_after_init">__lsm_ro_after_init</a> = {</td></tr>
<tr><th id="432">432</th><td>	<a class="macro" href="../../include/linux/lsm_hooks.h.html#1923" title="{ .head = &amp;security_hook_heads.ptrace_access_check, .hook = { .ptrace_access_check = yama_ptrace_access_check } }" data-ref="_M/LSM_HOOK_INIT">LSM_HOOK_INIT</a>(<a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_hook_heads::ptrace_access_check" title='security_hook_heads::ptrace_access_check' data-ref="security_hook_heads::ptrace_access_check"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::ptrace_access_check" title='security_list_options::ptrace_access_check' data-ref="security_list_options::ptrace_access_check"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::ptrace_access_check" title='security_list_options::ptrace_access_check' data-ref="security_list_options::ptrace_access_check"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::ptrace_access_check" title='security_list_options::ptrace_access_check' data-ref="security_list_options::ptrace_access_check"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::ptrace_access_check" title='security_list_options::ptrace_access_check' data-ref="security_list_options::ptrace_access_check">ptrace_access_check</a></a></a></a></a>, <a class="tu ref fn" href="#yama_ptrace_access_check" title='yama_ptrace_access_check' data-ref="yama_ptrace_access_check">yama_ptrace_access_check</a>),</td></tr>
<tr><th id="433">433</th><td>	<a class="macro" href="../../include/linux/lsm_hooks.h.html#1923" title="{ .head = &amp;security_hook_heads.ptrace_traceme, .hook = { .ptrace_traceme = yama_ptrace_traceme } }" data-ref="_M/LSM_HOOK_INIT">LSM_HOOK_INIT</a>(<a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_hook_heads::ptrace_traceme" title='security_hook_heads::ptrace_traceme' data-ref="security_hook_heads::ptrace_traceme"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::ptrace_traceme" title='security_list_options::ptrace_traceme' data-ref="security_list_options::ptrace_traceme"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::ptrace_traceme" title='security_list_options::ptrace_traceme' data-ref="security_list_options::ptrace_traceme"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::ptrace_traceme" title='security_list_options::ptrace_traceme' data-ref="security_list_options::ptrace_traceme"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::ptrace_traceme" title='security_list_options::ptrace_traceme' data-ref="security_list_options::ptrace_traceme">ptrace_traceme</a></a></a></a></a>, <a class="ref fn" href="#yama_ptrace_traceme" title='yama_ptrace_traceme' data-ref="yama_ptrace_traceme">yama_ptrace_traceme</a>),</td></tr>
<tr><th id="434">434</th><td>	<a class="macro" href="../../include/linux/lsm_hooks.h.html#1923" title="{ .head = &amp;security_hook_heads.task_prctl, .hook = { .task_prctl = yama_task_prctl } }" data-ref="_M/LSM_HOOK_INIT">LSM_HOOK_INIT</a>(<a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_hook_heads::task_prctl" title='security_hook_heads::task_prctl' data-ref="security_hook_heads::task_prctl"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::task_prctl" title='security_list_options::task_prctl' data-ref="security_list_options::task_prctl"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::task_prctl" title='security_list_options::task_prctl' data-ref="security_list_options::task_prctl"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::task_prctl" title='security_list_options::task_prctl' data-ref="security_list_options::task_prctl"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::task_prctl" title='security_list_options::task_prctl' data-ref="security_list_options::task_prctl">task_prctl</a></a></a></a></a>, <a class="ref fn" href="#yama_task_prctl" title='yama_task_prctl' data-ref="yama_task_prctl">yama_task_prctl</a>),</td></tr>
<tr><th id="435">435</th><td>	<a class="macro" href="../../include/linux/lsm_hooks.h.html#1923" title="{ .head = &amp;security_hook_heads.task_free, .hook = { .task_free = yama_task_free } }" data-ref="_M/LSM_HOOK_INIT">LSM_HOOK_INIT</a>(<a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_hook_heads::task_free" title='security_hook_heads::task_free' data-ref="security_hook_heads::task_free"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::task_free" title='security_list_options::task_free' data-ref="security_list_options::task_free"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::task_free" title='security_list_options::task_free' data-ref="security_list_options::task_free"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::task_free" title='security_list_options::task_free' data-ref="security_list_options::task_free"><a class="ref field" href="../../include/linux/lsm_hooks.h.html#security_list_options::task_free" title='security_list_options::task_free' data-ref="security_list_options::task_free">task_free</a></a></a></a></a>, <a class="ref fn" href="#yama_task_free" title='yama_task_free' data-ref="yama_task_free">yama_task_free</a>),</td></tr>
<tr><th id="436">436</th><td>};</td></tr>
<tr><th id="437">437</th><td></td></tr>
<tr><th id="438">438</th><td><u>#<span data-ppcond="438">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#1037" data-ref="_M/CONFIG_SYSCTL">CONFIG_SYSCTL</a></u></td></tr>
<tr><th id="439">439</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="yama_dointvec_minmax" title='yama_dointvec_minmax' data-type='int yama_dointvec_minmax(struct ctl_table * table, int write, void * buffer, size_t * lenp, loff_t * ppos)' data-ref="yama_dointvec_minmax">yama_dointvec_minmax</dfn>(<b>struct</b> <a class="type" href="../../include/linux/sysctl.h.html#ctl_table" title='ctl_table' data-ref="ctl_table">ctl_table</a> *<dfn class="local col7 decl" id="47table" title='table' data-type='struct ctl_table *' data-ref="47table">table</dfn>, <em>int</em> <dfn class="local col8 decl" id="48write" title='write' data-type='int' data-ref="48write">write</dfn>,</td></tr>
<tr><th id="440">440</th><td>				<em>void</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *<dfn class="local col9 decl" id="49buffer" title='buffer' data-type='void *' data-ref="49buffer">buffer</dfn>, <a class="typedef" href="../../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> *<dfn class="local col0 decl" id="50lenp" title='lenp' data-type='size_t *' data-ref="50lenp">lenp</dfn>, <a class="typedef" href="../../include/linux/types.h.html#loff_t" title='loff_t' data-type='__kernel_loff_t' data-ref="loff_t">loff_t</a> *<dfn class="local col1 decl" id="51ppos" title='ppos' data-type='loff_t *' data-ref="51ppos">ppos</dfn>)</td></tr>
<tr><th id="441">441</th><td>{</td></tr>
<tr><th id="442">442</th><td>	<b>struct</b> <a class="type" href="../../include/linux/sysctl.h.html#ctl_table" title='ctl_table' data-ref="ctl_table">ctl_table</a> <dfn class="local col2 decl" id="52table_copy" title='table_copy' data-type='struct ctl_table' data-ref="52table_copy">table_copy</dfn>;</td></tr>
<tr><th id="443">443</th><td></td></tr>
<tr><th id="444">444</th><td>	<b>if</b> (<a class="local col8 ref" href="#48write" title='write' data-ref="48write">write</a> &amp;&amp; !<a class="ref fn" href="../../include/linux/capability.h.html#capable" title='capable' data-ref="capable">capable</a>(<a class="macro" href="../../include/uapi/linux/capability.h.html#235" title="19" data-ref="_M/CAP_SYS_PTRACE">CAP_SYS_PTRACE</a>))</td></tr>
<tr><th id="445">445</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="446">446</th><td></td></tr>
<tr><th id="447">447</th><td>	<i>/* Lock the max value if it ever gets set. */</i></td></tr>
<tr><th id="448">448</th><td>	<a class="local col2 ref" href="#52table_copy" title='table_copy' data-ref="52table_copy">table_copy</a> = *<a class="local col7 ref" href="#47table" title='table' data-ref="47table">table</a>;</td></tr>
<tr><th id="449">449</th><td>	<b>if</b> (*(<em>int</em> *)<a class="local col2 ref" href="#52table_copy" title='table_copy' data-ref="52table_copy">table_copy</a>.<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_table::data" title='ctl_table::data' data-ref="ctl_table::data">data</a> == *(<em>int</em> *)<a class="local col2 ref" href="#52table_copy" title='table_copy' data-ref="52table_copy">table_copy</a>.<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_table::extra2" title='ctl_table::extra2' data-ref="ctl_table::extra2">extra2</a>)</td></tr>
<tr><th id="450">450</th><td>		<a class="local col2 ref" href="#52table_copy" title='table_copy' data-ref="52table_copy">table_copy</a>.<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_table::extra1" title='ctl_table::extra1' data-ref="ctl_table::extra1">extra1</a> = <a class="local col2 ref" href="#52table_copy" title='table_copy' data-ref="52table_copy">table_copy</a>.<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_table::extra2" title='ctl_table::extra2' data-ref="ctl_table::extra2">extra2</a>;</td></tr>
<tr><th id="451">451</th><td></td></tr>
<tr><th id="452">452</th><td>	<b>return</b> <a class="ref fn" href="../../include/linux/sysctl.h.html#proc_dointvec_minmax" title='proc_dointvec_minmax' data-ref="proc_dointvec_minmax">proc_dointvec_minmax</a>(&amp;<a class="local col2 ref" href="#52table_copy" title='table_copy' data-ref="52table_copy">table_copy</a>, <a class="local col8 ref" href="#48write" title='write' data-ref="48write">write</a>, <a class="local col9 ref" href="#49buffer" title='buffer' data-ref="49buffer">buffer</a>, <a class="local col0 ref" href="#50lenp" title='lenp' data-ref="50lenp">lenp</a>, <a class="local col1 ref" href="#51ppos" title='ppos' data-ref="51ppos">ppos</a>);</td></tr>
<tr><th id="453">453</th><td>}</td></tr>
<tr><th id="454">454</th><td></td></tr>
<tr><th id="455">455</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="zero" title='zero' data-type='int' data-ref="zero">zero</dfn>;</td></tr>
<tr><th id="456">456</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="max_scope" title='max_scope' data-type='int' data-ref="max_scope">max_scope</dfn> = <a class="macro" href="#29" title="3" data-ref="_M/YAMA_SCOPE_NO_ATTACH">YAMA_SCOPE_NO_ATTACH</a>;</td></tr>
<tr><th id="457">457</th><td></td></tr>
<tr><th id="458">458</th><td><b>struct</b> <a class="type" href="../../include/linux/sysctl.h.html#ctl_path" title='ctl_path' data-ref="ctl_path">ctl_path</a> <dfn class="decl def" id="yama_sysctl_path" title='yama_sysctl_path' data-ref="yama_sysctl_path">yama_sysctl_path</dfn>[] = {</td></tr>
<tr><th id="459">459</th><td>	{ .<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_path::procname" title='ctl_path::procname' data-ref="ctl_path::procname">procname</a> = <q>"kernel"</q>, },</td></tr>
<tr><th id="460">460</th><td>	{ .<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_path::procname" title='ctl_path::procname' data-ref="ctl_path::procname">procname</a> = <q>"yama"</q>, },</td></tr>
<tr><th id="461">461</th><td>	{ }</td></tr>
<tr><th id="462">462</th><td>};</td></tr>
<tr><th id="463">463</th><td></td></tr>
<tr><th id="464">464</th><td><em>static</em> <b>struct</b> <a class="type" href="../../include/linux/sysctl.h.html#ctl_table" title='ctl_table' data-ref="ctl_table">ctl_table</a> <dfn class="tu decl def" id="yama_sysctl_table" title='yama_sysctl_table' data-type='struct ctl_table [2]' data-ref="yama_sysctl_table">yama_sysctl_table</dfn>[] = {</td></tr>
<tr><th id="465">465</th><td>	{</td></tr>
<tr><th id="466">466</th><td>		.<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_table::procname" title='ctl_table::procname' data-ref="ctl_table::procname">procname</a>       = <q>"ptrace_scope"</q>,</td></tr>
<tr><th id="467">467</th><td>		.<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_table::data" title='ctl_table::data' data-ref="ctl_table::data">data</a>           = &amp;<a class="tu ref" href="#ptrace_scope" title='ptrace_scope' data-use='a' data-ref="ptrace_scope">ptrace_scope</a>,</td></tr>
<tr><th id="468">468</th><td>		.<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_table::maxlen" title='ctl_table::maxlen' data-ref="ctl_table::maxlen">maxlen</a>         = <b>sizeof</b>(<em>int</em>),</td></tr>
<tr><th id="469">469</th><td>		.<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_table::mode" title='ctl_table::mode' data-ref="ctl_table::mode">mode</a>           = <var>0644</var>,</td></tr>
<tr><th id="470">470</th><td>		.<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_table::proc_handler" title='ctl_table::proc_handler' data-ref="ctl_table::proc_handler">proc_handler</a>   = <a class="tu ref fn" href="#yama_dointvec_minmax" title='yama_dointvec_minmax' data-ref="yama_dointvec_minmax">yama_dointvec_minmax</a>,</td></tr>
<tr><th id="471">471</th><td>		.<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_table::extra1" title='ctl_table::extra1' data-ref="ctl_table::extra1">extra1</a>         = &amp;<a class="tu ref" href="#zero" title='zero' data-use='a' data-ref="zero">zero</a>,</td></tr>
<tr><th id="472">472</th><td>		.<a class="ref field" href="../../include/linux/sysctl.h.html#ctl_table::extra2" title='ctl_table::extra2' data-ref="ctl_table::extra2">extra2</a>         = &amp;<a class="tu ref" href="#max_scope" title='max_scope' data-use='a' data-ref="max_scope">max_scope</a>,</td></tr>
<tr><th id="473">473</th><td>	},</td></tr>
<tr><th id="474">474</th><td>	{ }</td></tr>
<tr><th id="475">475</th><td>};</td></tr>
<tr><th id="476">476</th><td><em>static</em> <em>void</em> <a class="macro" href="../../include/linux/init.h.html#50" title="__attribute__ ((__section__(&quot;.init.text&quot;)))" data-ref="_M/__init">__init</a> <dfn class="tu decl def fn" id="yama_init_sysctl" title='yama_init_sysctl' data-type='void yama_init_sysctl()' data-ref="yama_init_sysctl">yama_init_sysctl</dfn>(<em>void</em>)</td></tr>
<tr><th id="477">477</th><td>{</td></tr>
<tr><th id="478">478</th><td>	<b>if</b> (!<a class="ref fn" href="../../include/linux/sysctl.h.html#register_sysctl_paths" title='register_sysctl_paths' data-ref="register_sysctl_paths">register_sysctl_paths</a>(<a class="ref" href="#yama_sysctl_path" title='yama_sysctl_path' data-ref="yama_sysctl_path">yama_sysctl_path</a>, <a class="tu ref" href="#yama_sysctl_table" title='yama_sysctl_table' data-use='r' data-ref="yama_sysctl_table">yama_sysctl_table</a>))</td></tr>
<tr><th id="479">479</th><td>		<a class="ref fn" href="../../include/linux/kernel.h.html#panic" title='panic' data-ref="panic">panic</a>(<q>"Yama: sysctl registration failed.\n"</q>);</td></tr>
<tr><th id="480">480</th><td>}</td></tr>
<tr><th id="481">481</th><td><u>#<span data-ppcond="438">else</span></u></td></tr>
<tr><th id="482">482</th><td><em>static</em> <b>inline</b> <em>void</em> yama_init_sysctl(<em>void</em>) { }</td></tr>
<tr><th id="483">483</th><td><u>#<span data-ppcond="438">endif</span> /* CONFIG_SYSCTL */</u></td></tr>
<tr><th id="484">484</th><td></td></tr>
<tr><th id="485">485</th><td><em>void</em> <a class="macro" href="../../include/linux/init.h.html#50" title="__attribute__ ((__section__(&quot;.init.text&quot;)))" data-ref="_M/__init">__init</a> <dfn class="decl def fn" id="yama_add_hooks" title='yama_add_hooks' data-ref="yama_add_hooks">yama_add_hooks</dfn>(<em>void</em>)</td></tr>
<tr><th id="486">486</th><td>{</td></tr>
<tr><th id="487">487</th><td>	<a class="macro" href="../../include/linux/printk.h.html#308" title="printk(&quot;\001&quot; &quot;6&quot; &quot;Yama: becoming mindful.\n&quot;)" data-ref="_M/pr_info">pr_info</a>(<q>"Yama: becoming mindful.\n"</q>);</td></tr>
<tr><th id="488">488</th><td>	<a class="ref fn" href="../../include/linux/lsm_hooks.h.html#security_add_hooks" title='security_add_hooks' data-ref="security_add_hooks">security_add_hooks</a>(<a class="tu ref" href="#yama_hooks" title='yama_hooks' data-use='r' data-ref="yama_hooks">yama_hooks</a>, <a class="macro" href="../../include/linux/kernel.h.html#71" title="(sizeof(yama_hooks) / sizeof((yama_hooks)[0]) + (sizeof(struct { int:(-!!(__builtin_types_compatible_p(typeof((yama_hooks)), typeof(&amp;(yama_hooks)[0])))); })))" data-ref="_M/ARRAY_SIZE">ARRAY_SIZE</a>(<a class="tu ref" href="#yama_hooks" title='yama_hooks' data-use='r' data-ref="yama_hooks">yama_hooks</a>), <q>"yama"</q>);</td></tr>
<tr><th id="489">489</th><td>	<a class="tu ref fn" href="#yama_init_sysctl" title='yama_init_sysctl' data-use='c' data-ref="yama_init_sysctl">yama_init_sysctl</a>();</td></tr>
<tr><th id="490">490</th><td>}</td></tr>
<tr><th id="491">491</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2018-Jul-31</em> from project linux-4.14.y revision <em>linux-4.14.y</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
