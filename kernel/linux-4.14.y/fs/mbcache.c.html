<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>mbcache.c source code [linux-4.14.y/fs/mbcache.c] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="mb_cache "/>
<link rel="stylesheet" href="../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'linux-4.14.y/fs/mbcache.c'; var root_path = '../..'; var data_path = '../../../data';</script>
<script src='../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='..'>linux-4.14.y</a>/<a href='./'>fs</a>/<a href='mbcache.c.html'>mbcache.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><u>#include <a href="../include/linux/spinlock.h.html">&lt;linux/spinlock.h&gt;</a></u></td></tr>
<tr><th id="2">2</th><td><u>#include <a href="../include/linux/slab.h.html">&lt;linux/slab.h&gt;</a></u></td></tr>
<tr><th id="3">3</th><td><u>#include <a href="../include/linux/list.h.html">&lt;linux/list.h&gt;</a></u></td></tr>
<tr><th id="4">4</th><td><u>#include <a href="../include/linux/list_bl.h.html">&lt;linux/list_bl.h&gt;</a></u></td></tr>
<tr><th id="5">5</th><td><u>#include <a href="../include/linux/module.h.html">&lt;linux/module.h&gt;</a></u></td></tr>
<tr><th id="6">6</th><td><u>#include <a href="../include/linux/sched.h.html">&lt;linux/sched.h&gt;</a></u></td></tr>
<tr><th id="7">7</th><td><u>#include <a href="../include/linux/workqueue.h.html">&lt;linux/workqueue.h&gt;</a></u></td></tr>
<tr><th id="8">8</th><td><u>#include <a href="../include/linux/mbcache.h.html">&lt;linux/mbcache.h&gt;</a></u></td></tr>
<tr><th id="9">9</th><td></td></tr>
<tr><th id="10">10</th><td><i>/*</i></td></tr>
<tr><th id="11">11</th><td><i> * Mbcache is a simple key-value store. Keys need not be unique, however</i></td></tr>
<tr><th id="12">12</th><td><i> * key-value pairs are expected to be unique (we use this fact in</i></td></tr>
<tr><th id="13">13</th><td><i> * mb_cache_entry_delete()).</i></td></tr>
<tr><th id="14">14</th><td><i> *</i></td></tr>
<tr><th id="15">15</th><td><i> * Ext2 and ext4 use this cache for deduplication of extended attribute blocks.</i></td></tr>
<tr><th id="16">16</th><td><i> * Ext4 also uses it for deduplication of xattr values stored in inodes.</i></td></tr>
<tr><th id="17">17</th><td><i> * They use hash of data as a key and provide a value that may represent a</i></td></tr>
<tr><th id="18">18</th><td><i> * block or inode number. That's why keys need not be unique (hash of different</i></td></tr>
<tr><th id="19">19</th><td><i> * data may be the same). However user provided value always uniquely</i></td></tr>
<tr><th id="20">20</th><td><i> * identifies a cache entry.</i></td></tr>
<tr><th id="21">21</th><td><i> *</i></td></tr>
<tr><th id="22">22</th><td><i> * We provide functions for creation and removal of entries, search by key,</i></td></tr>
<tr><th id="23">23</th><td><i> * and a special "delete entry with given key-value pair" operation. Fixed</i></td></tr>
<tr><th id="24">24</th><td><i> * size hash table is used for fast key lookups.</i></td></tr>
<tr><th id="25">25</th><td><i> */</i></td></tr>
<tr><th id="26">26</th><td></td></tr>
<tr><th id="27">27</th><td><b>struct</b> <dfn class="type def" id="mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</dfn> {</td></tr>
<tr><th id="28">28</th><td>	<i>/* Hash table of entries */</i></td></tr>
<tr><th id="29">29</th><td>	<b>struct</b> <a class="type" href="../include/linux/list_bl.h.html#hlist_bl_head" title='hlist_bl_head' data-ref="hlist_bl_head">hlist_bl_head</a>	*<dfn class="decl field" id="mb_cache::c_hash" title='mb_cache::c_hash' data-ref="mb_cache::c_hash">c_hash</dfn>;</td></tr>
<tr><th id="30">30</th><td>	<i>/* log2 of hash table size */</i></td></tr>
<tr><th id="31">31</th><td>	<em>int</em>			<dfn class="decl field" id="mb_cache::c_bucket_bits" title='mb_cache::c_bucket_bits' data-ref="mb_cache::c_bucket_bits">c_bucket_bits</dfn>;</td></tr>
<tr><th id="32">32</th><td>	<i>/* Maximum entries in cache to avoid degrading hash too much */</i></td></tr>
<tr><th id="33">33</th><td>	<em>unsigned</em> <em>long</em>		<dfn class="decl field" id="mb_cache::c_max_entries" title='mb_cache::c_max_entries' data-ref="mb_cache::c_max_entries">c_max_entries</dfn>;</td></tr>
<tr><th id="34">34</th><td>	<i>/* Protects c_list, c_entry_count */</i></td></tr>
<tr><th id="35">35</th><td>	<a class="typedef" href="../include/linux/spinlock_types.h.html#spinlock_t" title='spinlock_t' data-type='struct spinlock' data-ref="spinlock_t">spinlock_t</a>		<dfn class="decl field" id="mb_cache::c_list_lock" title='mb_cache::c_list_lock' data-ref="mb_cache::c_list_lock">c_list_lock</dfn>;</td></tr>
<tr><th id="36">36</th><td>	<b>struct</b> <a class="type" href="../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a>	<dfn class="decl field" id="mb_cache::c_list" title='mb_cache::c_list' data-ref="mb_cache::c_list">c_list</dfn>;</td></tr>
<tr><th id="37">37</th><td>	<i>/* Number of entries in cache */</i></td></tr>
<tr><th id="38">38</th><td>	<em>unsigned</em> <em>long</em>		<dfn class="decl field" id="mb_cache::c_entry_count" title='mb_cache::c_entry_count' data-ref="mb_cache::c_entry_count">c_entry_count</dfn>;</td></tr>
<tr><th id="39">39</th><td>	<b>struct</b> <a class="type" href="../include/linux/shrinker.h.html#shrinker" title='shrinker' data-ref="shrinker">shrinker</a>		<dfn class="decl field" id="mb_cache::c_shrink" title='mb_cache::c_shrink' data-ref="mb_cache::c_shrink">c_shrink</dfn>;</td></tr>
<tr><th id="40">40</th><td>	<i>/* Work for shrinking when the cache has too many entries */</i></td></tr>
<tr><th id="41">41</th><td>	<b>struct</b> <a class="type" href="../include/linux/workqueue.h.html#work_struct" title='work_struct' data-ref="work_struct">work_struct</a>	<dfn class="decl field" id="mb_cache::c_shrink_work" title='mb_cache::c_shrink_work' data-ref="mb_cache::c_shrink_work">c_shrink_work</dfn>;</td></tr>
<tr><th id="42">42</th><td>};</td></tr>
<tr><th id="43">43</th><td></td></tr>
<tr><th id="44">44</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/kasan.h.html#kmem_cache" title='kmem_cache' data-ref="kmem_cache">kmem_cache</a> *<dfn class="tu decl def" id="mb_entry_cache" title='mb_entry_cache' data-type='struct kmem_cache *' data-ref="mb_entry_cache">mb_entry_cache</dfn>;</td></tr>
<tr><th id="45">45</th><td></td></tr>
<tr><th id="46">46</th><td><em>static</em> <em>unsigned</em> <em>long</em> <a class="tu decl fn" href="#mb_cache_shrink" title='mb_cache_shrink' data-type='unsigned long mb_cache_shrink(struct mb_cache * cache, unsigned long nr_to_scan)' data-ref="mb_cache_shrink">mb_cache_shrink</a>(<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col1 decl" id="1cache" title='cache' data-type='struct mb_cache *' data-ref="1cache">cache</dfn>,</td></tr>
<tr><th id="47">47</th><td>				     <em>unsigned</em> <em>long</em> <dfn class="local col2 decl" id="2nr_to_scan" title='nr_to_scan' data-type='unsigned long' data-ref="2nr_to_scan">nr_to_scan</dfn>);</td></tr>
<tr><th id="48">48</th><td></td></tr>
<tr><th id="49">49</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <b>struct</b> <a class="type" href="../include/linux/list_bl.h.html#hlist_bl_head" title='hlist_bl_head' data-ref="hlist_bl_head">hlist_bl_head</a> *<dfn class="tu decl def fn" id="mb_cache_entry_head" title='mb_cache_entry_head' data-type='struct hlist_bl_head * mb_cache_entry_head(struct mb_cache * cache, u32 key)' data-ref="mb_cache_entry_head">mb_cache_entry_head</dfn>(<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col3 decl" id="3cache" title='cache' data-type='struct mb_cache *' data-ref="3cache">cache</dfn>,</td></tr>
<tr><th id="50">50</th><td>							<a class="typedef" href="../include/asm-generic/int-ll64.h.html#u32" title='u32' data-type='unsigned int' data-ref="u32">u32</a> <dfn class="local col4 decl" id="4key" title='key' data-type='u32' data-ref="4key">key</dfn>)</td></tr>
<tr><th id="51">51</th><td>{</td></tr>
<tr><th id="52">52</th><td>	<b>return</b> &amp;<a class="local col3 ref" href="#3cache" title='cache' data-ref="3cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_hash" title='mb_cache::c_hash' data-ref="mb_cache::c_hash">c_hash</a>[<a class="macro" href="../include/linux/hash.h.html#66" title="hash_32_generic" data-ref="_M/hash_32">hash_32</a>(<a class="local col4 ref" href="#4key" title='key' data-ref="4key">key</a>, <a class="local col3 ref" href="#3cache" title='cache' data-ref="3cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_bucket_bits" title='mb_cache::c_bucket_bits' data-ref="mb_cache::c_bucket_bits">c_bucket_bits</a>)];</td></tr>
<tr><th id="53">53</th><td>}</td></tr>
<tr><th id="54">54</th><td></td></tr>
<tr><th id="55">55</th><td><i>/*</i></td></tr>
<tr><th id="56">56</th><td><i> * Number of entries to reclaim synchronously when there are too many entries</i></td></tr>
<tr><th id="57">57</th><td><i> * in cache</i></td></tr>
<tr><th id="58">58</th><td><i> */</i></td></tr>
<tr><th id="59">59</th><td><u>#define <dfn class="macro" id="_M/SYNC_SHRINK_BATCH" data-ref="_M/SYNC_SHRINK_BATCH">SYNC_SHRINK_BATCH</dfn> 64</u></td></tr>
<tr><th id="60">60</th><td></td></tr>
<tr><th id="61">61</th><td><i>/*</i></td></tr>
<tr><th id="62">62</th><td><i> * mb_cache_entry_create - create entry in cache</i></td></tr>
<tr><th id="63">63</th><td><i> * @cache - cache where the entry should be created</i></td></tr>
<tr><th id="64">64</th><td><i> * @mask - gfp mask with which the entry should be allocated</i></td></tr>
<tr><th id="65">65</th><td><i> * @key - key of the entry</i></td></tr>
<tr><th id="66">66</th><td><i> * @value - value of the entry</i></td></tr>
<tr><th id="67">67</th><td><i> * @reusable - is the entry reusable by others?</i></td></tr>
<tr><th id="68">68</th><td><i> *</i></td></tr>
<tr><th id="69">69</th><td><i> * Creates entry in @cache with key @key and value @value. The function returns</i></td></tr>
<tr><th id="70">70</th><td><i> * -EBUSY if entry with the same key and value already exists in cache.</i></td></tr>
<tr><th id="71">71</th><td><i> * Otherwise 0 is returned.</i></td></tr>
<tr><th id="72">72</th><td><i> */</i></td></tr>
<tr><th id="73">73</th><td><em>int</em> <dfn class="decl def fn" id="mb_cache_entry_create" title='mb_cache_entry_create' data-ref="mb_cache_entry_create">mb_cache_entry_create</dfn>(<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col5 decl" id="5cache" title='cache' data-type='struct mb_cache *' data-ref="5cache">cache</dfn>, <a class="typedef" href="../include/linux/types.h.html#gfp_t" title='gfp_t' data-type='unsigned int' data-ref="gfp_t">gfp_t</a> <dfn class="local col6 decl" id="6mask" title='mask' data-type='gfp_t' data-ref="6mask">mask</dfn>, <a class="typedef" href="../include/asm-generic/int-ll64.h.html#u32" title='u32' data-type='unsigned int' data-ref="u32">u32</a> <dfn class="local col7 decl" id="7key" title='key' data-type='u32' data-ref="7key">key</dfn>,</td></tr>
<tr><th id="74">74</th><td>			  <a class="typedef" href="../include/asm-generic/int-ll64.h.html#u64" title='u64' data-type='unsigned long long' data-ref="u64">u64</a> <dfn class="local col8 decl" id="8value" title='value' data-type='u64' data-ref="8value">value</dfn>, <a class="typedef" href="../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="local col9 decl" id="9reusable" title='reusable' data-type='bool' data-ref="9reusable">reusable</dfn>)</td></tr>
<tr><th id="75">75</th><td>{</td></tr>
<tr><th id="76">76</th><td>	<b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="local col0 decl" id="10entry" title='entry' data-type='struct mb_cache_entry *' data-ref="10entry">entry</dfn>, *<dfn class="local col1 decl" id="11dup" title='dup' data-type='struct mb_cache_entry *' data-ref="11dup">dup</dfn>;</td></tr>
<tr><th id="77">77</th><td>	<b>struct</b> <a class="type" href="../include/linux/list_bl.h.html#hlist_bl_node" title='hlist_bl_node' data-ref="hlist_bl_node">hlist_bl_node</a> *<dfn class="local col2 decl" id="12dup_node" title='dup_node' data-type='struct hlist_bl_node *' data-ref="12dup_node">dup_node</dfn>;</td></tr>
<tr><th id="78">78</th><td>	<b>struct</b> <a class="type" href="../include/linux/list_bl.h.html#hlist_bl_head" title='hlist_bl_head' data-ref="hlist_bl_head">hlist_bl_head</a> *<dfn class="local col3 decl" id="13head" title='head' data-type='struct hlist_bl_head *' data-ref="13head">head</dfn>;</td></tr>
<tr><th id="79">79</th><td></td></tr>
<tr><th id="80">80</th><td>	<i>/* Schedule background reclaim if there are too many entries */</i></td></tr>
<tr><th id="81">81</th><td>	<b>if</b> (<a class="local col5 ref" href="#5cache" title='cache' data-ref="5cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_entry_count" title='mb_cache::c_entry_count' data-ref="mb_cache::c_entry_count">c_entry_count</a> &gt;= <a class="local col5 ref" href="#5cache" title='cache' data-ref="5cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_max_entries" title='mb_cache::c_max_entries' data-ref="mb_cache::c_max_entries">c_max_entries</a>)</td></tr>
<tr><th id="82">82</th><td>		<a class="ref fn" href="../include/linux/workqueue.h.html#schedule_work" title='schedule_work' data-ref="schedule_work">schedule_work</a>(&amp;<a class="local col5 ref" href="#5cache" title='cache' data-ref="5cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_shrink_work" title='mb_cache::c_shrink_work' data-ref="mb_cache::c_shrink_work">c_shrink_work</a>);</td></tr>
<tr><th id="83">83</th><td>	<i>/* Do some sync reclaim if background reclaim cannot keep up */</i></td></tr>
<tr><th id="84">84</th><td>	<b>if</b> (<a class="local col5 ref" href="#5cache" title='cache' data-ref="5cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_entry_count" title='mb_cache::c_entry_count' data-ref="mb_cache::c_entry_count">c_entry_count</a> &gt;= <var>2</var>*<a class="local col5 ref" href="#5cache" title='cache' data-ref="5cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_max_entries" title='mb_cache::c_max_entries' data-ref="mb_cache::c_max_entries">c_max_entries</a>)</td></tr>
<tr><th id="85">85</th><td>		<a class="tu ref fn" href="#mb_cache_shrink" title='mb_cache_shrink' data-use='c' data-ref="mb_cache_shrink">mb_cache_shrink</a>(<a class="local col5 ref" href="#5cache" title='cache' data-ref="5cache">cache</a>, <a class="macro" href="#59" title="64" data-ref="_M/SYNC_SHRINK_BATCH">SYNC_SHRINK_BATCH</a>);</td></tr>
<tr><th id="86">86</th><td></td></tr>
<tr><th id="87">87</th><td>	<a class="local col0 ref" href="#10entry" title='entry' data-ref="10entry">entry</a> = <a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_alloc" title='kmem_cache_alloc' data-ref="kmem_cache_alloc">kmem_cache_alloc</a>(<a class="tu ref" href="#mb_entry_cache" title='mb_entry_cache' data-use='r' data-ref="mb_entry_cache">mb_entry_cache</a>, <a class="local col6 ref" href="#6mask" title='mask' data-ref="6mask">mask</a>);</td></tr>
<tr><th id="88">88</th><td>	<b>if</b> (!<a class="local col0 ref" href="#10entry" title='entry' data-ref="10entry">entry</a>)</td></tr>
<tr><th id="89">89</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="90">90</th><td></td></tr>
<tr><th id="91">91</th><td>	<a class="ref fn" href="../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col0 ref" href="#10entry" title='entry' data-ref="10entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_list" title='mb_cache_entry::e_list' data-ref="mb_cache_entry::e_list">e_list</a>);</td></tr>
<tr><th id="92">92</th><td>	<i>/* One ref for hash, one ref returned */</i></td></tr>
<tr><th id="93">93</th><td>	<a class="ref fn" href="../arch/x86/include/asm/atomic.h.html#atomic_set" title='atomic_set' data-ref="atomic_set">atomic_set</a>(&amp;<a class="local col0 ref" href="#10entry" title='entry' data-ref="10entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_refcnt" title='mb_cache_entry::e_refcnt' data-ref="mb_cache_entry::e_refcnt">e_refcnt</a>, <var>1</var>);</td></tr>
<tr><th id="94">94</th><td>	<a class="local col0 ref" href="#10entry" title='entry' data-ref="10entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_key" title='mb_cache_entry::e_key' data-ref="mb_cache_entry::e_key">e_key</a> = <a class="local col7 ref" href="#7key" title='key' data-ref="7key">key</a>;</td></tr>
<tr><th id="95">95</th><td>	<a class="local col0 ref" href="#10entry" title='entry' data-ref="10entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_value" title='mb_cache_entry::e_value' data-ref="mb_cache_entry::e_value">e_value</a> = <a class="local col8 ref" href="#8value" title='value' data-ref="8value">value</a>;</td></tr>
<tr><th id="96">96</th><td>	<a class="local col0 ref" href="#10entry" title='entry' data-ref="10entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_reusable" title='mb_cache_entry::e_reusable' data-ref="mb_cache_entry::e_reusable">e_reusable</a> = <a class="local col9 ref" href="#9reusable" title='reusable' data-ref="9reusable">reusable</a>;</td></tr>
<tr><th id="97">97</th><td>	<a class="local col0 ref" href="#10entry" title='entry' data-ref="10entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_referenced" title='mb_cache_entry::e_referenced' data-ref="mb_cache_entry::e_referenced">e_referenced</a> = <var>0</var>;</td></tr>
<tr><th id="98">98</th><td>	<a class="local col3 ref" href="#13head" title='head' data-ref="13head">head</a> = <a class="tu ref fn" href="#mb_cache_entry_head" title='mb_cache_entry_head' data-use='c' data-ref="mb_cache_entry_head">mb_cache_entry_head</a>(<a class="local col5 ref" href="#5cache" title='cache' data-ref="5cache">cache</a>, <a class="local col7 ref" href="#7key" title='key' data-ref="7key">key</a>);</td></tr>
<tr><th id="99">99</th><td>	<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_lock" title='hlist_bl_lock' data-ref="hlist_bl_lock">hlist_bl_lock</a>(<a class="local col3 ref" href="#13head" title='head' data-ref="13head">head</a>);</td></tr>
<tr><th id="100">100</th><td>	<a class="macro" href="../include/linux/list_bl.h.html#143" title="for (dup_node = hlist_bl_first(head); dup_node &amp;&amp; ({ dup = ({ void *__mptr = (void *)(dup_node); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(dup_node)), typeof(((typeof(*dup) *)0)-&gt;e_hash_list)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(dup_node)), typeof(void)))); extern void __compiletime_assert_100(void) ; if (__cond) __compiletime_assert_100(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*dup) *)(__mptr - __builtin_offsetof(typeof(*dup), e_hash_list))); }); 1;}); dup_node = dup_node-&gt;next)" data-ref="_M/hlist_bl_for_each_entry">hlist_bl_for_each_entry</a>(<a class="local col1 ref" href="#11dup" title='dup' data-ref="11dup">dup</a>, <a class="local col2 ref" href="#12dup_node" title='dup_node' data-ref="12dup_node">dup_node</a>, <a class="local col3 ref" href="#13head" title='head' data-ref="13head">head</a>, <a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_hash_list" title='mb_cache_entry::e_hash_list' data-ref="mb_cache_entry::e_hash_list">e_hash_list</a>) {</td></tr>
<tr><th id="101">101</th><td>		<b>if</b> (<a class="local col1 ref" href="#11dup" title='dup' data-ref="11dup">dup</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_key" title='mb_cache_entry::e_key' data-ref="mb_cache_entry::e_key">e_key</a> == <a class="local col7 ref" href="#7key" title='key' data-ref="7key">key</a> &amp;&amp; <a class="local col1 ref" href="#11dup" title='dup' data-ref="11dup">dup</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_value" title='mb_cache_entry::e_value' data-ref="mb_cache_entry::e_value">e_value</a> == <a class="local col8 ref" href="#8value" title='value' data-ref="8value">value</a>) {</td></tr>
<tr><th id="102">102</th><td>			<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_unlock" title='hlist_bl_unlock' data-ref="hlist_bl_unlock">hlist_bl_unlock</a>(<a class="local col3 ref" href="#13head" title='head' data-ref="13head">head</a>);</td></tr>
<tr><th id="103">103</th><td>			<a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_free" title='kmem_cache_free' data-ref="kmem_cache_free">kmem_cache_free</a>(<a class="tu ref" href="#mb_entry_cache" title='mb_entry_cache' data-use='r' data-ref="mb_entry_cache">mb_entry_cache</a>, <a class="local col0 ref" href="#10entry" title='entry' data-ref="10entry">entry</a>);</td></tr>
<tr><th id="104">104</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#20" title="16" data-ref="_M/EBUSY">EBUSY</a>;</td></tr>
<tr><th id="105">105</th><td>		}</td></tr>
<tr><th id="106">106</th><td>	}</td></tr>
<tr><th id="107">107</th><td>	<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_add_head" title='hlist_bl_add_head' data-ref="hlist_bl_add_head">hlist_bl_add_head</a>(&amp;<a class="local col0 ref" href="#10entry" title='entry' data-ref="10entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_hash_list" title='mb_cache_entry::e_hash_list' data-ref="mb_cache_entry::e_hash_list">e_hash_list</a>, <a class="local col3 ref" href="#13head" title='head' data-ref="13head">head</a>);</td></tr>
<tr><th id="108">108</th><td>	<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_unlock" title='hlist_bl_unlock' data-ref="hlist_bl_unlock">hlist_bl_unlock</a>(<a class="local col3 ref" href="#13head" title='head' data-ref="13head">head</a>);</td></tr>
<tr><th id="109">109</th><td></td></tr>
<tr><th id="110">110</th><td>	<a class="ref fn" href="../include/linux/spinlock.h.html#spin_lock" title='spin_lock' data-ref="spin_lock">spin_lock</a>(&amp;<a class="local col5 ref" href="#5cache" title='cache' data-ref="5cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list_lock" title='mb_cache::c_list_lock' data-ref="mb_cache::c_list_lock">c_list_lock</a>);</td></tr>
<tr><th id="111">111</th><td>	<a class="ref fn" href="../include/linux/list.h.html#list_add_tail" title='list_add_tail' data-ref="list_add_tail">list_add_tail</a>(&amp;<a class="local col0 ref" href="#10entry" title='entry' data-ref="10entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_list" title='mb_cache_entry::e_list' data-ref="mb_cache_entry::e_list">e_list</a>, &amp;<a class="local col5 ref" href="#5cache" title='cache' data-ref="5cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list" title='mb_cache::c_list' data-ref="mb_cache::c_list">c_list</a>);</td></tr>
<tr><th id="112">112</th><td>	<i>/* Grab ref for LRU list */</i></td></tr>
<tr><th id="113">113</th><td>	<a class="ref fn" href="../arch/x86/include/asm/atomic.h.html#atomic_inc" title='atomic_inc' data-ref="atomic_inc">atomic_inc</a>(&amp;<a class="local col0 ref" href="#10entry" title='entry' data-ref="10entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_refcnt" title='mb_cache_entry::e_refcnt' data-ref="mb_cache_entry::e_refcnt">e_refcnt</a>);</td></tr>
<tr><th id="114">114</th><td>	<a class="local col5 ref" href="#5cache" title='cache' data-ref="5cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_entry_count" title='mb_cache::c_entry_count' data-ref="mb_cache::c_entry_count">c_entry_count</a>++;</td></tr>
<tr><th id="115">115</th><td>	<a class="ref fn" href="../include/linux/spinlock.h.html#spin_unlock" title='spin_unlock' data-ref="spin_unlock">spin_unlock</a>(&amp;<a class="local col5 ref" href="#5cache" title='cache' data-ref="5cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list_lock" title='mb_cache::c_list_lock' data-ref="mb_cache::c_list_lock">c_list_lock</a>);</td></tr>
<tr><th id="116">116</th><td></td></tr>
<tr><th id="117">117</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="118">118</th><td>}</td></tr>
<tr><th id="119">119</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(mb_cache_entry_create) mb_cache_entry_create; static const char __kstrtab_mb_cache_entry_create[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;mb_cache_entry_create&quot;; static const struct kernel_symbol __ksymtab_mb_cache_entry_create __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;mb_cache_entry_create&quot;), used)) = { (unsigned long)&amp;mb_cache_entry_create, __kstrtab_mb_cache_entry_create }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#mb_cache_entry_create" title='mb_cache_entry_create' data-ref="mb_cache_entry_create"><a class="ref fn" href="#mb_cache_entry_create" title='mb_cache_entry_create' data-ref="mb_cache_entry_create"><a class="ref fn" href="#mb_cache_entry_create" title='mb_cache_entry_create' data-ref="mb_cache_entry_create"><a class="ref fn" href="#mb_cache_entry_create" title='mb_cache_entry_create' data-ref="mb_cache_entry_create">mb_cache_entry_create</a></a></a></a>);</td></tr>
<tr><th id="120">120</th><td></td></tr>
<tr><th id="121">121</th><td><em>void</em> <dfn class="decl def fn" id="__mb_cache_entry_free" title='__mb_cache_entry_free' data-ref="__mb_cache_entry_free">__mb_cache_entry_free</dfn>(<b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="local col4 decl" id="14entry" title='entry' data-type='struct mb_cache_entry *' data-ref="14entry">entry</dfn>)</td></tr>
<tr><th id="122">122</th><td>{</td></tr>
<tr><th id="123">123</th><td>	<a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_free" title='kmem_cache_free' data-ref="kmem_cache_free">kmem_cache_free</a>(<a class="tu ref" href="#mb_entry_cache" title='mb_entry_cache' data-use='r' data-ref="mb_entry_cache">mb_entry_cache</a>, <a class="local col4 ref" href="#14entry" title='entry' data-ref="14entry">entry</a>);</td></tr>
<tr><th id="124">124</th><td>}</td></tr>
<tr><th id="125">125</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(__mb_cache_entry_free) __mb_cache_entry_free; static const char __kstrtab___mb_cache_entry_free[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;__mb_cache_entry_free&quot;; static const struct kernel_symbol __ksymtab___mb_cache_entry_free __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;__mb_cache_entry_free&quot;), used)) = { (unsigned long)&amp;__mb_cache_entry_free, __kstrtab___mb_cache_entry_free }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#__mb_cache_entry_free" title='__mb_cache_entry_free' data-ref="__mb_cache_entry_free"><a class="ref fn" href="#__mb_cache_entry_free" title='__mb_cache_entry_free' data-ref="__mb_cache_entry_free"><a class="ref fn" href="#__mb_cache_entry_free" title='__mb_cache_entry_free' data-ref="__mb_cache_entry_free"><a class="ref fn" href="#__mb_cache_entry_free" title='__mb_cache_entry_free' data-ref="__mb_cache_entry_free">__mb_cache_entry_free</a></a></a></a>);</td></tr>
<tr><th id="126">126</th><td></td></tr>
<tr><th id="127">127</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="tu decl def fn" id="__entry_find" title='__entry_find' data-type='struct mb_cache_entry * __entry_find(struct mb_cache * cache, struct mb_cache_entry * entry, u32 key)' data-ref="__entry_find">__entry_find</dfn>(<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col5 decl" id="15cache" title='cache' data-type='struct mb_cache *' data-ref="15cache">cache</dfn>,</td></tr>
<tr><th id="128">128</th><td>					   <b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="local col6 decl" id="16entry" title='entry' data-type='struct mb_cache_entry *' data-ref="16entry">entry</dfn>,</td></tr>
<tr><th id="129">129</th><td>					   <a class="typedef" href="../include/asm-generic/int-ll64.h.html#u32" title='u32' data-type='unsigned int' data-ref="u32">u32</a> <dfn class="local col7 decl" id="17key" title='key' data-type='u32' data-ref="17key">key</dfn>)</td></tr>
<tr><th id="130">130</th><td>{</td></tr>
<tr><th id="131">131</th><td>	<b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="local col8 decl" id="18old_entry" title='old_entry' data-type='struct mb_cache_entry *' data-ref="18old_entry">old_entry</dfn> = <a class="local col6 ref" href="#16entry" title='entry' data-ref="16entry">entry</a>;</td></tr>
<tr><th id="132">132</th><td>	<b>struct</b> <a class="type" href="../include/linux/list_bl.h.html#hlist_bl_node" title='hlist_bl_node' data-ref="hlist_bl_node">hlist_bl_node</a> *<dfn class="local col9 decl" id="19node" title='node' data-type='struct hlist_bl_node *' data-ref="19node">node</dfn>;</td></tr>
<tr><th id="133">133</th><td>	<b>struct</b> <a class="type" href="../include/linux/list_bl.h.html#hlist_bl_head" title='hlist_bl_head' data-ref="hlist_bl_head">hlist_bl_head</a> *<dfn class="local col0 decl" id="20head" title='head' data-type='struct hlist_bl_head *' data-ref="20head">head</dfn>;</td></tr>
<tr><th id="134">134</th><td></td></tr>
<tr><th id="135">135</th><td>	<a class="local col0 ref" href="#20head" title='head' data-ref="20head">head</a> = <a class="tu ref fn" href="#mb_cache_entry_head" title='mb_cache_entry_head' data-use='c' data-ref="mb_cache_entry_head">mb_cache_entry_head</a>(<a class="local col5 ref" href="#15cache" title='cache' data-ref="15cache">cache</a>, <a class="local col7 ref" href="#17key" title='key' data-ref="17key">key</a>);</td></tr>
<tr><th id="136">136</th><td>	<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_lock" title='hlist_bl_lock' data-ref="hlist_bl_lock">hlist_bl_lock</a>(<a class="local col0 ref" href="#20head" title='head' data-ref="20head">head</a>);</td></tr>
<tr><th id="137">137</th><td>	<b>if</b> (<a class="local col6 ref" href="#16entry" title='entry' data-ref="16entry">entry</a> &amp;&amp; !<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_unhashed" title='hlist_bl_unhashed' data-ref="hlist_bl_unhashed">hlist_bl_unhashed</a>(&amp;<a class="local col6 ref" href="#16entry" title='entry' data-ref="16entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_hash_list" title='mb_cache_entry::e_hash_list' data-ref="mb_cache_entry::e_hash_list">e_hash_list</a>))</td></tr>
<tr><th id="138">138</th><td>		<a class="local col9 ref" href="#19node" title='node' data-ref="19node">node</a> = <a class="local col6 ref" href="#16entry" title='entry' data-ref="16entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_hash_list" title='mb_cache_entry::e_hash_list' data-ref="mb_cache_entry::e_hash_list">e_hash_list</a>.<a class="ref field" href="../include/linux/list_bl.h.html#hlist_bl_node::next" title='hlist_bl_node::next' data-ref="hlist_bl_node::next">next</a>;</td></tr>
<tr><th id="139">139</th><td>	<b>else</b></td></tr>
<tr><th id="140">140</th><td>		<a class="local col9 ref" href="#19node" title='node' data-ref="19node">node</a> = <a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_first" title='hlist_bl_first' data-ref="hlist_bl_first">hlist_bl_first</a>(<a class="local col0 ref" href="#20head" title='head' data-ref="20head">head</a>);</td></tr>
<tr><th id="141">141</th><td>	<b>while</b> (<a class="local col9 ref" href="#19node" title='node' data-ref="19node">node</a>) {</td></tr>
<tr><th id="142">142</th><td>		<a class="local col6 ref" href="#16entry" title='entry' data-ref="16entry">entry</a> = <a class="macro" href="../include/linux/list_bl.h.html#50" title="({ void *__mptr = (void *)(node); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(node)), typeof(((struct mb_cache_entry *)0)-&gt;e_hash_list)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(node)), typeof(void)))); extern void __compiletime_assert_143(void) ; if (__cond) __compiletime_assert_143(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct mb_cache_entry *)(__mptr - __builtin_offsetof(struct mb_cache_entry, e_hash_list))); })" data-ref="_M/hlist_bl_entry">hlist_bl_entry</a>(<a class="local col9 ref" href="#19node" title='node' data-ref="19node">node</a>, <b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a>,</td></tr>
<tr><th id="143">143</th><td>				       <a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_hash_list" title='mb_cache_entry::e_hash_list' data-ref="mb_cache_entry::e_hash_list">e_hash_list</a>);</td></tr>
<tr><th id="144">144</th><td>		<b>if</b> (<a class="local col6 ref" href="#16entry" title='entry' data-ref="16entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_key" title='mb_cache_entry::e_key' data-ref="mb_cache_entry::e_key">e_key</a> == <a class="local col7 ref" href="#17key" title='key' data-ref="17key">key</a> &amp;&amp; <a class="local col6 ref" href="#16entry" title='entry' data-ref="16entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_reusable" title='mb_cache_entry::e_reusable' data-ref="mb_cache_entry::e_reusable">e_reusable</a>) {</td></tr>
<tr><th id="145">145</th><td>			<a class="ref fn" href="../arch/x86/include/asm/atomic.h.html#atomic_inc" title='atomic_inc' data-ref="atomic_inc">atomic_inc</a>(&amp;<a class="local col6 ref" href="#16entry" title='entry' data-ref="16entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_refcnt" title='mb_cache_entry::e_refcnt' data-ref="mb_cache_entry::e_refcnt">e_refcnt</a>);</td></tr>
<tr><th id="146">146</th><td>			<b>goto</b> <a class="lbl" href="#21out" data-ref="21out">out</a>;</td></tr>
<tr><th id="147">147</th><td>		}</td></tr>
<tr><th id="148">148</th><td>		<a class="local col9 ref" href="#19node" title='node' data-ref="19node">node</a> = <a class="local col9 ref" href="#19node" title='node' data-ref="19node">node</a>-&gt;<a class="ref field" href="../include/linux/list_bl.h.html#hlist_bl_node::next" title='hlist_bl_node::next' data-ref="hlist_bl_node::next">next</a>;</td></tr>
<tr><th id="149">149</th><td>	}</td></tr>
<tr><th id="150">150</th><td>	<a class="local col6 ref" href="#16entry" title='entry' data-ref="16entry">entry</a> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="151">151</th><td><dfn class="lbl" id="21out" data-ref="21out">out</dfn>:</td></tr>
<tr><th id="152">152</th><td>	<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_unlock" title='hlist_bl_unlock' data-ref="hlist_bl_unlock">hlist_bl_unlock</a>(<a class="local col0 ref" href="#20head" title='head' data-ref="20head">head</a>);</td></tr>
<tr><th id="153">153</th><td>	<b>if</b> (<a class="local col8 ref" href="#18old_entry" title='old_entry' data-ref="18old_entry">old_entry</a>)</td></tr>
<tr><th id="154">154</th><td>		<a class="ref fn" href="../include/linux/mbcache.h.html#mb_cache_entry_put" title='mb_cache_entry_put' data-ref="mb_cache_entry_put">mb_cache_entry_put</a>(<a class="local col5 ref" href="#15cache" title='cache' data-ref="15cache">cache</a>, <a class="local col8 ref" href="#18old_entry" title='old_entry' data-ref="18old_entry">old_entry</a>);</td></tr>
<tr><th id="155">155</th><td></td></tr>
<tr><th id="156">156</th><td>	<b>return</b> <a class="local col6 ref" href="#16entry" title='entry' data-ref="16entry">entry</a>;</td></tr>
<tr><th id="157">157</th><td>}</td></tr>
<tr><th id="158">158</th><td></td></tr>
<tr><th id="159">159</th><td><i>/*</i></td></tr>
<tr><th id="160">160</th><td><i> * mb_cache_entry_find_first - find the first reusable entry with the given key</i></td></tr>
<tr><th id="161">161</th><td><i> * @cache: cache where we should search</i></td></tr>
<tr><th id="162">162</th><td><i> * @key: key to look for</i></td></tr>
<tr><th id="163">163</th><td><i> *</i></td></tr>
<tr><th id="164">164</th><td><i> * Search in @cache for a reusable entry with key @key. Grabs reference to the</i></td></tr>
<tr><th id="165">165</th><td><i> * first reusable entry found and returns the entry.</i></td></tr>
<tr><th id="166">166</th><td><i> */</i></td></tr>
<tr><th id="167">167</th><td><b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="decl def fn" id="mb_cache_entry_find_first" title='mb_cache_entry_find_first' data-ref="mb_cache_entry_find_first">mb_cache_entry_find_first</dfn>(<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col2 decl" id="22cache" title='cache' data-type='struct mb_cache *' data-ref="22cache">cache</dfn>,</td></tr>
<tr><th id="168">168</th><td>						 <a class="typedef" href="../include/asm-generic/int-ll64.h.html#u32" title='u32' data-type='unsigned int' data-ref="u32">u32</a> <dfn class="local col3 decl" id="23key" title='key' data-type='u32' data-ref="23key">key</dfn>)</td></tr>
<tr><th id="169">169</th><td>{</td></tr>
<tr><th id="170">170</th><td>	<b>return</b> <a class="tu ref fn" href="#__entry_find" title='__entry_find' data-use='c' data-ref="__entry_find">__entry_find</a>(<a class="local col2 ref" href="#22cache" title='cache' data-ref="22cache">cache</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="local col3 ref" href="#23key" title='key' data-ref="23key">key</a>);</td></tr>
<tr><th id="171">171</th><td>}</td></tr>
<tr><th id="172">172</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(mb_cache_entry_find_first) mb_cache_entry_find_first; static const char __kstrtab_mb_cache_entry_find_first[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;mb_cache_entry_find_first&quot;; static const struct kernel_symbol __ksymtab_mb_cache_entry_find_first __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;mb_cache_entry_find_first&quot;), used)) = { (unsigned long)&amp;mb_cache_entry_find_first, __kstrtab_mb_cache_entry_find_first }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#mb_cache_entry_find_first" title='mb_cache_entry_find_first' data-ref="mb_cache_entry_find_first"><a class="ref fn" href="#mb_cache_entry_find_first" title='mb_cache_entry_find_first' data-ref="mb_cache_entry_find_first"><a class="ref fn" href="#mb_cache_entry_find_first" title='mb_cache_entry_find_first' data-ref="mb_cache_entry_find_first"><a class="ref fn" href="#mb_cache_entry_find_first" title='mb_cache_entry_find_first' data-ref="mb_cache_entry_find_first">mb_cache_entry_find_first</a></a></a></a>);</td></tr>
<tr><th id="173">173</th><td></td></tr>
<tr><th id="174">174</th><td><i>/*</i></td></tr>
<tr><th id="175">175</th><td><i> * mb_cache_entry_find_next - find next reusable entry with the same key</i></td></tr>
<tr><th id="176">176</th><td><i> * @cache: cache where we should search</i></td></tr>
<tr><th id="177">177</th><td><i> * @entry: entry to start search from</i></td></tr>
<tr><th id="178">178</th><td><i> *</i></td></tr>
<tr><th id="179">179</th><td><i> * Finds next reusable entry in the hash chain which has the same key as @entry.</i></td></tr>
<tr><th id="180">180</th><td><i> * If @entry is unhashed (which can happen when deletion of entry races with the</i></td></tr>
<tr><th id="181">181</th><td><i> * search), finds the first reusable entry in the hash chain. The function drops</i></td></tr>
<tr><th id="182">182</th><td><i> * reference to @entry and returns with a reference to the found entry.</i></td></tr>
<tr><th id="183">183</th><td><i> */</i></td></tr>
<tr><th id="184">184</th><td><b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="decl def fn" id="mb_cache_entry_find_next" title='mb_cache_entry_find_next' data-ref="mb_cache_entry_find_next">mb_cache_entry_find_next</dfn>(<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col4 decl" id="24cache" title='cache' data-type='struct mb_cache *' data-ref="24cache">cache</dfn>,</td></tr>
<tr><th id="185">185</th><td>						<b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="local col5 decl" id="25entry" title='entry' data-type='struct mb_cache_entry *' data-ref="25entry">entry</dfn>)</td></tr>
<tr><th id="186">186</th><td>{</td></tr>
<tr><th id="187">187</th><td>	<b>return</b> <a class="tu ref fn" href="#__entry_find" title='__entry_find' data-use='c' data-ref="__entry_find">__entry_find</a>(<a class="local col4 ref" href="#24cache" title='cache' data-ref="24cache">cache</a>, <a class="local col5 ref" href="#25entry" title='entry' data-ref="25entry">entry</a>, <a class="local col5 ref" href="#25entry" title='entry' data-ref="25entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_key" title='mb_cache_entry::e_key' data-ref="mb_cache_entry::e_key">e_key</a>);</td></tr>
<tr><th id="188">188</th><td>}</td></tr>
<tr><th id="189">189</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(mb_cache_entry_find_next) mb_cache_entry_find_next; static const char __kstrtab_mb_cache_entry_find_next[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;mb_cache_entry_find_next&quot;; static const struct kernel_symbol __ksymtab_mb_cache_entry_find_next __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;mb_cache_entry_find_next&quot;), used)) = { (unsigned long)&amp;mb_cache_entry_find_next, __kstrtab_mb_cache_entry_find_next }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#mb_cache_entry_find_next" title='mb_cache_entry_find_next' data-ref="mb_cache_entry_find_next"><a class="ref fn" href="#mb_cache_entry_find_next" title='mb_cache_entry_find_next' data-ref="mb_cache_entry_find_next"><a class="ref fn" href="#mb_cache_entry_find_next" title='mb_cache_entry_find_next' data-ref="mb_cache_entry_find_next"><a class="ref fn" href="#mb_cache_entry_find_next" title='mb_cache_entry_find_next' data-ref="mb_cache_entry_find_next">mb_cache_entry_find_next</a></a></a></a>);</td></tr>
<tr><th id="190">190</th><td></td></tr>
<tr><th id="191">191</th><td><i>/*</i></td></tr>
<tr><th id="192">192</th><td><i> * mb_cache_entry_get - get a cache entry by value (and key)</i></td></tr>
<tr><th id="193">193</th><td><i> * @cache - cache we work with</i></td></tr>
<tr><th id="194">194</th><td><i> * @key - key</i></td></tr>
<tr><th id="195">195</th><td><i> * @value - value</i></td></tr>
<tr><th id="196">196</th><td><i> */</i></td></tr>
<tr><th id="197">197</th><td><b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="decl def fn" id="mb_cache_entry_get" title='mb_cache_entry_get' data-ref="mb_cache_entry_get">mb_cache_entry_get</dfn>(<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col6 decl" id="26cache" title='cache' data-type='struct mb_cache *' data-ref="26cache">cache</dfn>, <a class="typedef" href="../include/asm-generic/int-ll64.h.html#u32" title='u32' data-type='unsigned int' data-ref="u32">u32</a> <dfn class="local col7 decl" id="27key" title='key' data-type='u32' data-ref="27key">key</dfn>,</td></tr>
<tr><th id="198">198</th><td>					  <a class="typedef" href="../include/asm-generic/int-ll64.h.html#u64" title='u64' data-type='unsigned long long' data-ref="u64">u64</a> <dfn class="local col8 decl" id="28value" title='value' data-type='u64' data-ref="28value">value</dfn>)</td></tr>
<tr><th id="199">199</th><td>{</td></tr>
<tr><th id="200">200</th><td>	<b>struct</b> <a class="type" href="../include/linux/list_bl.h.html#hlist_bl_node" title='hlist_bl_node' data-ref="hlist_bl_node">hlist_bl_node</a> *<dfn class="local col9 decl" id="29node" title='node' data-type='struct hlist_bl_node *' data-ref="29node">node</dfn>;</td></tr>
<tr><th id="201">201</th><td>	<b>struct</b> <a class="type" href="../include/linux/list_bl.h.html#hlist_bl_head" title='hlist_bl_head' data-ref="hlist_bl_head">hlist_bl_head</a> *<dfn class="local col0 decl" id="30head" title='head' data-type='struct hlist_bl_head *' data-ref="30head">head</dfn>;</td></tr>
<tr><th id="202">202</th><td>	<b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="local col1 decl" id="31entry" title='entry' data-type='struct mb_cache_entry *' data-ref="31entry">entry</dfn>;</td></tr>
<tr><th id="203">203</th><td></td></tr>
<tr><th id="204">204</th><td>	<a class="local col0 ref" href="#30head" title='head' data-ref="30head">head</a> = <a class="tu ref fn" href="#mb_cache_entry_head" title='mb_cache_entry_head' data-use='c' data-ref="mb_cache_entry_head">mb_cache_entry_head</a>(<a class="local col6 ref" href="#26cache" title='cache' data-ref="26cache">cache</a>, <a class="local col7 ref" href="#27key" title='key' data-ref="27key">key</a>);</td></tr>
<tr><th id="205">205</th><td>	<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_lock" title='hlist_bl_lock' data-ref="hlist_bl_lock">hlist_bl_lock</a>(<a class="local col0 ref" href="#30head" title='head' data-ref="30head">head</a>);</td></tr>
<tr><th id="206">206</th><td>	<a class="macro" href="../include/linux/list_bl.h.html#143" title="for (node = hlist_bl_first(head); node &amp;&amp; ({ entry = ({ void *__mptr = (void *)(node); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(node)), typeof(((typeof(*entry) *)0)-&gt;e_hash_list)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(node)), typeof(void)))); extern void __compiletime_assert_206(void) ; if (__cond) __compiletime_assert_206(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*entry) *)(__mptr - __builtin_offsetof(typeof(*entry), e_hash_list))); }); 1;}); node = node-&gt;next)" data-ref="_M/hlist_bl_for_each_entry">hlist_bl_for_each_entry</a>(<a class="local col1 ref" href="#31entry" title='entry' data-ref="31entry">entry</a>, <a class="local col9 ref" href="#29node" title='node' data-ref="29node">node</a>, <a class="local col0 ref" href="#30head" title='head' data-ref="30head">head</a>, <a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_hash_list" title='mb_cache_entry::e_hash_list' data-ref="mb_cache_entry::e_hash_list">e_hash_list</a>) {</td></tr>
<tr><th id="207">207</th><td>		<b>if</b> (<a class="local col1 ref" href="#31entry" title='entry' data-ref="31entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_key" title='mb_cache_entry::e_key' data-ref="mb_cache_entry::e_key">e_key</a> == <a class="local col7 ref" href="#27key" title='key' data-ref="27key">key</a> &amp;&amp; <a class="local col1 ref" href="#31entry" title='entry' data-ref="31entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_value" title='mb_cache_entry::e_value' data-ref="mb_cache_entry::e_value">e_value</a> == <a class="local col8 ref" href="#28value" title='value' data-ref="28value">value</a>) {</td></tr>
<tr><th id="208">208</th><td>			<a class="ref fn" href="../arch/x86/include/asm/atomic.h.html#atomic_inc" title='atomic_inc' data-ref="atomic_inc">atomic_inc</a>(&amp;<a class="local col1 ref" href="#31entry" title='entry' data-ref="31entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_refcnt" title='mb_cache_entry::e_refcnt' data-ref="mb_cache_entry::e_refcnt">e_refcnt</a>);</td></tr>
<tr><th id="209">209</th><td>			<b>goto</b> <a class="lbl" href="#32out" data-ref="32out">out</a>;</td></tr>
<tr><th id="210">210</th><td>		}</td></tr>
<tr><th id="211">211</th><td>	}</td></tr>
<tr><th id="212">212</th><td>	<a class="local col1 ref" href="#31entry" title='entry' data-ref="31entry">entry</a> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="213">213</th><td><dfn class="lbl" id="32out" data-ref="32out">out</dfn>:</td></tr>
<tr><th id="214">214</th><td>	<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_unlock" title='hlist_bl_unlock' data-ref="hlist_bl_unlock">hlist_bl_unlock</a>(<a class="local col0 ref" href="#30head" title='head' data-ref="30head">head</a>);</td></tr>
<tr><th id="215">215</th><td>	<b>return</b> <a class="local col1 ref" href="#31entry" title='entry' data-ref="31entry">entry</a>;</td></tr>
<tr><th id="216">216</th><td>}</td></tr>
<tr><th id="217">217</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(mb_cache_entry_get) mb_cache_entry_get; static const char __kstrtab_mb_cache_entry_get[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;mb_cache_entry_get&quot;; static const struct kernel_symbol __ksymtab_mb_cache_entry_get __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;mb_cache_entry_get&quot;), used)) = { (unsigned long)&amp;mb_cache_entry_get, __kstrtab_mb_cache_entry_get }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#mb_cache_entry_get" title='mb_cache_entry_get' data-ref="mb_cache_entry_get"><a class="ref fn" href="#mb_cache_entry_get" title='mb_cache_entry_get' data-ref="mb_cache_entry_get"><a class="ref fn" href="#mb_cache_entry_get" title='mb_cache_entry_get' data-ref="mb_cache_entry_get"><a class="ref fn" href="#mb_cache_entry_get" title='mb_cache_entry_get' data-ref="mb_cache_entry_get">mb_cache_entry_get</a></a></a></a>);</td></tr>
<tr><th id="218">218</th><td></td></tr>
<tr><th id="219">219</th><td><i>/* mb_cache_entry_delete - remove a cache entry</i></td></tr>
<tr><th id="220">220</th><td><i> * @cache - cache we work with</i></td></tr>
<tr><th id="221">221</th><td><i> * @key - key</i></td></tr>
<tr><th id="222">222</th><td><i> * @value - value</i></td></tr>
<tr><th id="223">223</th><td><i> *</i></td></tr>
<tr><th id="224">224</th><td><i> * Remove entry from cache @cache with key @key and value @value.</i></td></tr>
<tr><th id="225">225</th><td><i> */</i></td></tr>
<tr><th id="226">226</th><td><em>void</em> <dfn class="decl def fn" id="mb_cache_entry_delete" title='mb_cache_entry_delete' data-ref="mb_cache_entry_delete">mb_cache_entry_delete</dfn>(<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col3 decl" id="33cache" title='cache' data-type='struct mb_cache *' data-ref="33cache">cache</dfn>, <a class="typedef" href="../include/asm-generic/int-ll64.h.html#u32" title='u32' data-type='unsigned int' data-ref="u32">u32</a> <dfn class="local col4 decl" id="34key" title='key' data-type='u32' data-ref="34key">key</dfn>, <a class="typedef" href="../include/asm-generic/int-ll64.h.html#u64" title='u64' data-type='unsigned long long' data-ref="u64">u64</a> <dfn class="local col5 decl" id="35value" title='value' data-type='u64' data-ref="35value">value</dfn>)</td></tr>
<tr><th id="227">227</th><td>{</td></tr>
<tr><th id="228">228</th><td>	<b>struct</b> <a class="type" href="../include/linux/list_bl.h.html#hlist_bl_node" title='hlist_bl_node' data-ref="hlist_bl_node">hlist_bl_node</a> *<dfn class="local col6 decl" id="36node" title='node' data-type='struct hlist_bl_node *' data-ref="36node">node</dfn>;</td></tr>
<tr><th id="229">229</th><td>	<b>struct</b> <a class="type" href="../include/linux/list_bl.h.html#hlist_bl_head" title='hlist_bl_head' data-ref="hlist_bl_head">hlist_bl_head</a> *<dfn class="local col7 decl" id="37head" title='head' data-type='struct hlist_bl_head *' data-ref="37head">head</dfn>;</td></tr>
<tr><th id="230">230</th><td>	<b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="local col8 decl" id="38entry" title='entry' data-type='struct mb_cache_entry *' data-ref="38entry">entry</dfn>;</td></tr>
<tr><th id="231">231</th><td></td></tr>
<tr><th id="232">232</th><td>	<a class="local col7 ref" href="#37head" title='head' data-ref="37head">head</a> = <a class="tu ref fn" href="#mb_cache_entry_head" title='mb_cache_entry_head' data-use='c' data-ref="mb_cache_entry_head">mb_cache_entry_head</a>(<a class="local col3 ref" href="#33cache" title='cache' data-ref="33cache">cache</a>, <a class="local col4 ref" href="#34key" title='key' data-ref="34key">key</a>);</td></tr>
<tr><th id="233">233</th><td>	<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_lock" title='hlist_bl_lock' data-ref="hlist_bl_lock">hlist_bl_lock</a>(<a class="local col7 ref" href="#37head" title='head' data-ref="37head">head</a>);</td></tr>
<tr><th id="234">234</th><td>	<a class="macro" href="../include/linux/list_bl.h.html#143" title="for (node = hlist_bl_first(head); node &amp;&amp; ({ entry = ({ void *__mptr = (void *)(node); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(node)), typeof(((typeof(*entry) *)0)-&gt;e_hash_list)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(node)), typeof(void)))); extern void __compiletime_assert_234(void) ; if (__cond) __compiletime_assert_234(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*entry) *)(__mptr - __builtin_offsetof(typeof(*entry), e_hash_list))); }); 1;}); node = node-&gt;next)" data-ref="_M/hlist_bl_for_each_entry">hlist_bl_for_each_entry</a>(<a class="local col8 ref" href="#38entry" title='entry' data-ref="38entry">entry</a>, <a class="local col6 ref" href="#36node" title='node' data-ref="36node">node</a>, <a class="local col7 ref" href="#37head" title='head' data-ref="37head">head</a>, <a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_hash_list" title='mb_cache_entry::e_hash_list' data-ref="mb_cache_entry::e_hash_list">e_hash_list</a>) {</td></tr>
<tr><th id="235">235</th><td>		<b>if</b> (<a class="local col8 ref" href="#38entry" title='entry' data-ref="38entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_key" title='mb_cache_entry::e_key' data-ref="mb_cache_entry::e_key">e_key</a> == <a class="local col4 ref" href="#34key" title='key' data-ref="34key">key</a> &amp;&amp; <a class="local col8 ref" href="#38entry" title='entry' data-ref="38entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_value" title='mb_cache_entry::e_value' data-ref="mb_cache_entry::e_value">e_value</a> == <a class="local col5 ref" href="#35value" title='value' data-ref="35value">value</a>) {</td></tr>
<tr><th id="236">236</th><td>			<i>/* We keep hash list reference to keep entry alive */</i></td></tr>
<tr><th id="237">237</th><td>			<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_del_init" title='hlist_bl_del_init' data-ref="hlist_bl_del_init">hlist_bl_del_init</a>(&amp;<a class="local col8 ref" href="#38entry" title='entry' data-ref="38entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_hash_list" title='mb_cache_entry::e_hash_list' data-ref="mb_cache_entry::e_hash_list">e_hash_list</a>);</td></tr>
<tr><th id="238">238</th><td>			<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_unlock" title='hlist_bl_unlock' data-ref="hlist_bl_unlock">hlist_bl_unlock</a>(<a class="local col7 ref" href="#37head" title='head' data-ref="37head">head</a>);</td></tr>
<tr><th id="239">239</th><td>			<a class="ref fn" href="../include/linux/spinlock.h.html#spin_lock" title='spin_lock' data-ref="spin_lock">spin_lock</a>(&amp;<a class="local col3 ref" href="#33cache" title='cache' data-ref="33cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list_lock" title='mb_cache::c_list_lock' data-ref="mb_cache::c_list_lock">c_list_lock</a>);</td></tr>
<tr><th id="240">240</th><td>			<b>if</b> (!<a class="ref fn" href="../include/linux/list.h.html#list_empty" title='list_empty' data-ref="list_empty">list_empty</a>(&amp;<a class="local col8 ref" href="#38entry" title='entry' data-ref="38entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_list" title='mb_cache_entry::e_list' data-ref="mb_cache_entry::e_list">e_list</a>)) {</td></tr>
<tr><th id="241">241</th><td>				<a class="ref fn" href="../include/linux/list.h.html#list_del_init" title='list_del_init' data-ref="list_del_init">list_del_init</a>(&amp;<a class="local col8 ref" href="#38entry" title='entry' data-ref="38entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_list" title='mb_cache_entry::e_list' data-ref="mb_cache_entry::e_list">e_list</a>);</td></tr>
<tr><th id="242">242</th><td>				<a class="local col3 ref" href="#33cache" title='cache' data-ref="33cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_entry_count" title='mb_cache::c_entry_count' data-ref="mb_cache::c_entry_count">c_entry_count</a>--;</td></tr>
<tr><th id="243">243</th><td>				<a class="ref fn" href="../arch/x86/include/asm/atomic.h.html#atomic_dec" title='atomic_dec' data-ref="atomic_dec">atomic_dec</a>(&amp;<a class="local col8 ref" href="#38entry" title='entry' data-ref="38entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_refcnt" title='mb_cache_entry::e_refcnt' data-ref="mb_cache_entry::e_refcnt">e_refcnt</a>);</td></tr>
<tr><th id="244">244</th><td>			}</td></tr>
<tr><th id="245">245</th><td>			<a class="ref fn" href="../include/linux/spinlock.h.html#spin_unlock" title='spin_unlock' data-ref="spin_unlock">spin_unlock</a>(&amp;<a class="local col3 ref" href="#33cache" title='cache' data-ref="33cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list_lock" title='mb_cache::c_list_lock' data-ref="mb_cache::c_list_lock">c_list_lock</a>);</td></tr>
<tr><th id="246">246</th><td>			<a class="ref fn" href="../include/linux/mbcache.h.html#mb_cache_entry_put" title='mb_cache_entry_put' data-ref="mb_cache_entry_put">mb_cache_entry_put</a>(<a class="local col3 ref" href="#33cache" title='cache' data-ref="33cache">cache</a>, <a class="local col8 ref" href="#38entry" title='entry' data-ref="38entry">entry</a>);</td></tr>
<tr><th id="247">247</th><td>			<b>return</b>;</td></tr>
<tr><th id="248">248</th><td>		}</td></tr>
<tr><th id="249">249</th><td>	}</td></tr>
<tr><th id="250">250</th><td>	<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_unlock" title='hlist_bl_unlock' data-ref="hlist_bl_unlock">hlist_bl_unlock</a>(<a class="local col7 ref" href="#37head" title='head' data-ref="37head">head</a>);</td></tr>
<tr><th id="251">251</th><td>}</td></tr>
<tr><th id="252">252</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(mb_cache_entry_delete) mb_cache_entry_delete; static const char __kstrtab_mb_cache_entry_delete[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;mb_cache_entry_delete&quot;; static const struct kernel_symbol __ksymtab_mb_cache_entry_delete __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;mb_cache_entry_delete&quot;), used)) = { (unsigned long)&amp;mb_cache_entry_delete, __kstrtab_mb_cache_entry_delete }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#mb_cache_entry_delete" title='mb_cache_entry_delete' data-ref="mb_cache_entry_delete"><a class="ref fn" href="#mb_cache_entry_delete" title='mb_cache_entry_delete' data-ref="mb_cache_entry_delete"><a class="ref fn" href="#mb_cache_entry_delete" title='mb_cache_entry_delete' data-ref="mb_cache_entry_delete"><a class="ref fn" href="#mb_cache_entry_delete" title='mb_cache_entry_delete' data-ref="mb_cache_entry_delete">mb_cache_entry_delete</a></a></a></a>);</td></tr>
<tr><th id="253">253</th><td></td></tr>
<tr><th id="254">254</th><td><i>/* mb_cache_entry_touch - cache entry got used</i></td></tr>
<tr><th id="255">255</th><td><i> * @cache - cache the entry belongs to</i></td></tr>
<tr><th id="256">256</th><td><i> * @entry - entry that got used</i></td></tr>
<tr><th id="257">257</th><td><i> *</i></td></tr>
<tr><th id="258">258</th><td><i> * Marks entry as used to give hit higher chances of surviving in cache.</i></td></tr>
<tr><th id="259">259</th><td><i> */</i></td></tr>
<tr><th id="260">260</th><td><em>void</em> <dfn class="decl def fn" id="mb_cache_entry_touch" title='mb_cache_entry_touch' data-ref="mb_cache_entry_touch">mb_cache_entry_touch</dfn>(<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col9 decl" id="39cache" title='cache' data-type='struct mb_cache *' data-ref="39cache">cache</dfn>,</td></tr>
<tr><th id="261">261</th><td>			  <b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="local col0 decl" id="40entry" title='entry' data-type='struct mb_cache_entry *' data-ref="40entry">entry</dfn>)</td></tr>
<tr><th id="262">262</th><td>{</td></tr>
<tr><th id="263">263</th><td>	<a class="local col0 ref" href="#40entry" title='entry' data-ref="40entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_referenced" title='mb_cache_entry::e_referenced' data-ref="mb_cache_entry::e_referenced">e_referenced</a> = <var>1</var>;</td></tr>
<tr><th id="264">264</th><td>}</td></tr>
<tr><th id="265">265</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(mb_cache_entry_touch) mb_cache_entry_touch; static const char __kstrtab_mb_cache_entry_touch[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;mb_cache_entry_touch&quot;; static const struct kernel_symbol __ksymtab_mb_cache_entry_touch __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;mb_cache_entry_touch&quot;), used)) = { (unsigned long)&amp;mb_cache_entry_touch, __kstrtab_mb_cache_entry_touch }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#mb_cache_entry_touch" title='mb_cache_entry_touch' data-ref="mb_cache_entry_touch"><a class="ref fn" href="#mb_cache_entry_touch" title='mb_cache_entry_touch' data-ref="mb_cache_entry_touch"><a class="ref fn" href="#mb_cache_entry_touch" title='mb_cache_entry_touch' data-ref="mb_cache_entry_touch"><a class="ref fn" href="#mb_cache_entry_touch" title='mb_cache_entry_touch' data-ref="mb_cache_entry_touch">mb_cache_entry_touch</a></a></a></a>);</td></tr>
<tr><th id="266">266</th><td></td></tr>
<tr><th id="267">267</th><td><em>static</em> <em>unsigned</em> <em>long</em> <dfn class="tu decl def fn" id="mb_cache_count" title='mb_cache_count' data-type='unsigned long mb_cache_count(struct shrinker * shrink, struct shrink_control * sc)' data-ref="mb_cache_count">mb_cache_count</dfn>(<b>struct</b> <a class="type" href="../include/linux/shrinker.h.html#shrinker" title='shrinker' data-ref="shrinker">shrinker</a> *<dfn class="local col1 decl" id="41shrink" title='shrink' data-type='struct shrinker *' data-ref="41shrink">shrink</dfn>,</td></tr>
<tr><th id="268">268</th><td>				    <b>struct</b> <a class="type" href="../include/linux/shrinker.h.html#shrink_control" title='shrink_control' data-ref="shrink_control">shrink_control</a> *<dfn class="local col2 decl" id="42sc" title='sc' data-type='struct shrink_control *' data-ref="42sc">sc</dfn>)</td></tr>
<tr><th id="269">269</th><td>{</td></tr>
<tr><th id="270">270</th><td>	<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col3 decl" id="43cache" title='cache' data-type='struct mb_cache *' data-ref="43cache">cache</dfn> = <a class="macro" href="../include/linux/kernel.h.html#927" title="({ void *__mptr = (void *)(shrink); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(shrink)), typeof(((struct mb_cache *)0)-&gt;c_shrink)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(shrink)), typeof(void)))); extern void __compiletime_assert_271(void) ; if (__cond) __compiletime_assert_271(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct mb_cache *)(__mptr - __builtin_offsetof(struct mb_cache, c_shrink))); })" data-ref="_M/container_of">container_of</a>(<a class="local col1 ref" href="#41shrink" title='shrink' data-ref="41shrink">shrink</a>, <b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a>,</td></tr>
<tr><th id="271">271</th><td>					      <a class="ref field" href="#mb_cache::c_shrink" title='mb_cache::c_shrink' data-ref="mb_cache::c_shrink">c_shrink</a>);</td></tr>
<tr><th id="272">272</th><td></td></tr>
<tr><th id="273">273</th><td>	<b>return</b> <a class="local col3 ref" href="#43cache" title='cache' data-ref="43cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_entry_count" title='mb_cache::c_entry_count' data-ref="mb_cache::c_entry_count">c_entry_count</a>;</td></tr>
<tr><th id="274">274</th><td>}</td></tr>
<tr><th id="275">275</th><td></td></tr>
<tr><th id="276">276</th><td><i  data-doc="mb_cache_shrink">/* Shrink number of entries in cache */</i></td></tr>
<tr><th id="277">277</th><td><em>static</em> <em>unsigned</em> <em>long</em> <dfn class="tu decl def fn" id="mb_cache_shrink" title='mb_cache_shrink' data-type='unsigned long mb_cache_shrink(struct mb_cache * cache, unsigned long nr_to_scan)' data-ref="mb_cache_shrink">mb_cache_shrink</dfn>(<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col4 decl" id="44cache" title='cache' data-type='struct mb_cache *' data-ref="44cache">cache</dfn>,</td></tr>
<tr><th id="278">278</th><td>				     <em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="45nr_to_scan" title='nr_to_scan' data-type='unsigned long' data-ref="45nr_to_scan">nr_to_scan</dfn>)</td></tr>
<tr><th id="279">279</th><td>{</td></tr>
<tr><th id="280">280</th><td>	<b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="local col6 decl" id="46entry" title='entry' data-type='struct mb_cache_entry *' data-ref="46entry">entry</dfn>;</td></tr>
<tr><th id="281">281</th><td>	<b>struct</b> <a class="type" href="../include/linux/list_bl.h.html#hlist_bl_head" title='hlist_bl_head' data-ref="hlist_bl_head">hlist_bl_head</a> *<dfn class="local col7 decl" id="47head" title='head' data-type='struct hlist_bl_head *' data-ref="47head">head</dfn>;</td></tr>
<tr><th id="282">282</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="48shrunk" title='shrunk' data-type='unsigned long' data-ref="48shrunk">shrunk</dfn> = <var>0</var>;</td></tr>
<tr><th id="283">283</th><td></td></tr>
<tr><th id="284">284</th><td>	<a class="ref fn" href="../include/linux/spinlock.h.html#spin_lock" title='spin_lock' data-ref="spin_lock">spin_lock</a>(&amp;<a class="local col4 ref" href="#44cache" title='cache' data-ref="44cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list_lock" title='mb_cache::c_list_lock' data-ref="mb_cache::c_list_lock">c_list_lock</a>);</td></tr>
<tr><th id="285">285</th><td>	<b>while</b> (<a class="local col5 ref" href="#45nr_to_scan" title='nr_to_scan' data-ref="45nr_to_scan">nr_to_scan</a>-- &amp;&amp; !<a class="ref fn" href="../include/linux/list.h.html#list_empty" title='list_empty' data-ref="list_empty">list_empty</a>(&amp;<a class="local col4 ref" href="#44cache" title='cache' data-ref="44cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list" title='mb_cache::c_list' data-ref="mb_cache::c_list">c_list</a>)) {</td></tr>
<tr><th id="286">286</th><td>		<a class="local col6 ref" href="#46entry" title='entry' data-ref="46entry">entry</a> = <a class="macro" href="../include/linux/list.h.html#376" title="({ void *__mptr = (void *)((&amp;cache-&gt;c_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;cache-&gt;c_list)-&gt;next)), typeof(((struct mb_cache_entry *)0)-&gt;e_list)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;cache-&gt;c_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_287(void) ; if (__cond) __compiletime_assert_287(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct mb_cache_entry *)(__mptr - __builtin_offsetof(struct mb_cache_entry, e_list))); })" data-ref="_M/list_first_entry">list_first_entry</a>(&amp;<a class="local col4 ref" href="#44cache" title='cache' data-ref="44cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list" title='mb_cache::c_list' data-ref="mb_cache::c_list">c_list</a>,</td></tr>
<tr><th id="287">287</th><td>					 <b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a>, <a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_list" title='mb_cache_entry::e_list' data-ref="mb_cache_entry::e_list">e_list</a>);</td></tr>
<tr><th id="288">288</th><td>		<b>if</b> (<a class="local col6 ref" href="#46entry" title='entry' data-ref="46entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_referenced" title='mb_cache_entry::e_referenced' data-ref="mb_cache_entry::e_referenced">e_referenced</a>) {</td></tr>
<tr><th id="289">289</th><td>			<a class="local col6 ref" href="#46entry" title='entry' data-ref="46entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_referenced" title='mb_cache_entry::e_referenced' data-ref="mb_cache_entry::e_referenced">e_referenced</a> = <var>0</var>;</td></tr>
<tr><th id="290">290</th><td>			<a class="ref fn" href="../include/linux/list.h.html#list_move_tail" title='list_move_tail' data-ref="list_move_tail">list_move_tail</a>(&amp;<a class="local col6 ref" href="#46entry" title='entry' data-ref="46entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_list" title='mb_cache_entry::e_list' data-ref="mb_cache_entry::e_list">e_list</a>, &amp;<a class="local col4 ref" href="#44cache" title='cache' data-ref="44cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list" title='mb_cache::c_list' data-ref="mb_cache::c_list">c_list</a>);</td></tr>
<tr><th id="291">291</th><td>			<b>continue</b>;</td></tr>
<tr><th id="292">292</th><td>		}</td></tr>
<tr><th id="293">293</th><td>		<a class="ref fn" href="../include/linux/list.h.html#list_del_init" title='list_del_init' data-ref="list_del_init">list_del_init</a>(&amp;<a class="local col6 ref" href="#46entry" title='entry' data-ref="46entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_list" title='mb_cache_entry::e_list' data-ref="mb_cache_entry::e_list">e_list</a>);</td></tr>
<tr><th id="294">294</th><td>		<a class="local col4 ref" href="#44cache" title='cache' data-ref="44cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_entry_count" title='mb_cache::c_entry_count' data-ref="mb_cache::c_entry_count">c_entry_count</a>--;</td></tr>
<tr><th id="295">295</th><td>		<i>/*</i></td></tr>
<tr><th id="296">296</th><td><i>		 * We keep LRU list reference so that entry doesn't go away</i></td></tr>
<tr><th id="297">297</th><td><i>		 * from under us.</i></td></tr>
<tr><th id="298">298</th><td><i>		 */</i></td></tr>
<tr><th id="299">299</th><td>		<a class="ref fn" href="../include/linux/spinlock.h.html#spin_unlock" title='spin_unlock' data-ref="spin_unlock">spin_unlock</a>(&amp;<a class="local col4 ref" href="#44cache" title='cache' data-ref="44cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list_lock" title='mb_cache::c_list_lock' data-ref="mb_cache::c_list_lock">c_list_lock</a>);</td></tr>
<tr><th id="300">300</th><td>		<a class="local col7 ref" href="#47head" title='head' data-ref="47head">head</a> = <a class="tu ref fn" href="#mb_cache_entry_head" title='mb_cache_entry_head' data-use='c' data-ref="mb_cache_entry_head">mb_cache_entry_head</a>(<a class="local col4 ref" href="#44cache" title='cache' data-ref="44cache">cache</a>, <a class="local col6 ref" href="#46entry" title='entry' data-ref="46entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_key" title='mb_cache_entry::e_key' data-ref="mb_cache_entry::e_key">e_key</a>);</td></tr>
<tr><th id="301">301</th><td>		<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_lock" title='hlist_bl_lock' data-ref="hlist_bl_lock">hlist_bl_lock</a>(<a class="local col7 ref" href="#47head" title='head' data-ref="47head">head</a>);</td></tr>
<tr><th id="302">302</th><td>		<b>if</b> (!<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_unhashed" title='hlist_bl_unhashed' data-ref="hlist_bl_unhashed">hlist_bl_unhashed</a>(&amp;<a class="local col6 ref" href="#46entry" title='entry' data-ref="46entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_hash_list" title='mb_cache_entry::e_hash_list' data-ref="mb_cache_entry::e_hash_list">e_hash_list</a>)) {</td></tr>
<tr><th id="303">303</th><td>			<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_del_init" title='hlist_bl_del_init' data-ref="hlist_bl_del_init">hlist_bl_del_init</a>(&amp;<a class="local col6 ref" href="#46entry" title='entry' data-ref="46entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_hash_list" title='mb_cache_entry::e_hash_list' data-ref="mb_cache_entry::e_hash_list">e_hash_list</a>);</td></tr>
<tr><th id="304">304</th><td>			<a class="ref fn" href="../arch/x86/include/asm/atomic.h.html#atomic_dec" title='atomic_dec' data-ref="atomic_dec">atomic_dec</a>(&amp;<a class="local col6 ref" href="#46entry" title='entry' data-ref="46entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_refcnt" title='mb_cache_entry::e_refcnt' data-ref="mb_cache_entry::e_refcnt">e_refcnt</a>);</td></tr>
<tr><th id="305">305</th><td>		}</td></tr>
<tr><th id="306">306</th><td>		<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_unlock" title='hlist_bl_unlock' data-ref="hlist_bl_unlock">hlist_bl_unlock</a>(<a class="local col7 ref" href="#47head" title='head' data-ref="47head">head</a>);</td></tr>
<tr><th id="307">307</th><td>		<b>if</b> (<a class="ref fn" href="../include/linux/mbcache.h.html#mb_cache_entry_put" title='mb_cache_entry_put' data-ref="mb_cache_entry_put">mb_cache_entry_put</a>(<a class="local col4 ref" href="#44cache" title='cache' data-ref="44cache">cache</a>, <a class="local col6 ref" href="#46entry" title='entry' data-ref="46entry">entry</a>))</td></tr>
<tr><th id="308">308</th><td>			<a class="local col8 ref" href="#48shrunk" title='shrunk' data-ref="48shrunk">shrunk</a>++;</td></tr>
<tr><th id="309">309</th><td>		<a class="macro" href="../include/linux/sched.h.html#1627" title="({ ___might_sleep(&quot;/home/tempdban/kernel/stable/fs/mbcache.c&quot;, 309, 0); _cond_resched(); })" data-ref="_M/cond_resched">cond_resched</a>();</td></tr>
<tr><th id="310">310</th><td>		<a class="ref fn" href="../include/linux/spinlock.h.html#spin_lock" title='spin_lock' data-ref="spin_lock">spin_lock</a>(&amp;<a class="local col4 ref" href="#44cache" title='cache' data-ref="44cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list_lock" title='mb_cache::c_list_lock' data-ref="mb_cache::c_list_lock">c_list_lock</a>);</td></tr>
<tr><th id="311">311</th><td>	}</td></tr>
<tr><th id="312">312</th><td>	<a class="ref fn" href="../include/linux/spinlock.h.html#spin_unlock" title='spin_unlock' data-ref="spin_unlock">spin_unlock</a>(&amp;<a class="local col4 ref" href="#44cache" title='cache' data-ref="44cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list_lock" title='mb_cache::c_list_lock' data-ref="mb_cache::c_list_lock">c_list_lock</a>);</td></tr>
<tr><th id="313">313</th><td></td></tr>
<tr><th id="314">314</th><td>	<b>return</b> <a class="local col8 ref" href="#48shrunk" title='shrunk' data-ref="48shrunk">shrunk</a>;</td></tr>
<tr><th id="315">315</th><td>}</td></tr>
<tr><th id="316">316</th><td></td></tr>
<tr><th id="317">317</th><td><em>static</em> <em>unsigned</em> <em>long</em> <dfn class="tu decl def fn" id="mb_cache_scan" title='mb_cache_scan' data-type='unsigned long mb_cache_scan(struct shrinker * shrink, struct shrink_control * sc)' data-ref="mb_cache_scan">mb_cache_scan</dfn>(<b>struct</b> <a class="type" href="../include/linux/shrinker.h.html#shrinker" title='shrinker' data-ref="shrinker">shrinker</a> *<dfn class="local col9 decl" id="49shrink" title='shrink' data-type='struct shrinker *' data-ref="49shrink">shrink</dfn>,</td></tr>
<tr><th id="318">318</th><td>				   <b>struct</b> <a class="type" href="../include/linux/shrinker.h.html#shrink_control" title='shrink_control' data-ref="shrink_control">shrink_control</a> *<dfn class="local col0 decl" id="50sc" title='sc' data-type='struct shrink_control *' data-ref="50sc">sc</dfn>)</td></tr>
<tr><th id="319">319</th><td>{</td></tr>
<tr><th id="320">320</th><td>	<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col1 decl" id="51cache" title='cache' data-type='struct mb_cache *' data-ref="51cache">cache</dfn> = <a class="macro" href="../include/linux/kernel.h.html#927" title="({ void *__mptr = (void *)(shrink); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(shrink)), typeof(((struct mb_cache *)0)-&gt;c_shrink)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(shrink)), typeof(void)))); extern void __compiletime_assert_321(void) ; if (__cond) __compiletime_assert_321(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct mb_cache *)(__mptr - __builtin_offsetof(struct mb_cache, c_shrink))); })" data-ref="_M/container_of">container_of</a>(<a class="local col9 ref" href="#49shrink" title='shrink' data-ref="49shrink">shrink</a>, <b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a>,</td></tr>
<tr><th id="321">321</th><td>					      <a class="ref field" href="#mb_cache::c_shrink" title='mb_cache::c_shrink' data-ref="mb_cache::c_shrink">c_shrink</a>);</td></tr>
<tr><th id="322">322</th><td>	<b>return</b> <a class="tu ref fn" href="#mb_cache_shrink" title='mb_cache_shrink' data-use='c' data-ref="mb_cache_shrink">mb_cache_shrink</a>(<a class="local col1 ref" href="#51cache" title='cache' data-ref="51cache">cache</a>, <a class="local col0 ref" href="#50sc" title='sc' data-ref="50sc">sc</a>-&gt;<a class="ref field" href="../include/linux/shrinker.h.html#shrink_control::nr_to_scan" title='shrink_control::nr_to_scan' data-ref="shrink_control::nr_to_scan">nr_to_scan</a>);</td></tr>
<tr><th id="323">323</th><td>}</td></tr>
<tr><th id="324">324</th><td></td></tr>
<tr><th id="325">325</th><td><i>/* We shrink 1/X of the cache when we have too many entries in it */</i></td></tr>
<tr><th id="326">326</th><td><u>#define <dfn class="macro" id="_M/SHRINK_DIVISOR" data-ref="_M/SHRINK_DIVISOR">SHRINK_DIVISOR</dfn> 16</u></td></tr>
<tr><th id="327">327</th><td></td></tr>
<tr><th id="328">328</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="mb_cache_shrink_worker" title='mb_cache_shrink_worker' data-type='void mb_cache_shrink_worker(struct work_struct * work)' data-ref="mb_cache_shrink_worker">mb_cache_shrink_worker</dfn>(<b>struct</b> <a class="type" href="../include/linux/workqueue.h.html#work_struct" title='work_struct' data-ref="work_struct">work_struct</a> *<dfn class="local col2 decl" id="52work" title='work' data-type='struct work_struct *' data-ref="52work">work</dfn>)</td></tr>
<tr><th id="329">329</th><td>{</td></tr>
<tr><th id="330">330</th><td>	<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col3 decl" id="53cache" title='cache' data-type='struct mb_cache *' data-ref="53cache">cache</dfn> = <a class="macro" href="../include/linux/kernel.h.html#927" title="({ void *__mptr = (void *)(work); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(work)), typeof(((struct mb_cache *)0)-&gt;c_shrink_work)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(work)), typeof(void)))); extern void __compiletime_assert_331(void) ; if (__cond) __compiletime_assert_331(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct mb_cache *)(__mptr - __builtin_offsetof(struct mb_cache, c_shrink_work))); })" data-ref="_M/container_of">container_of</a>(<a class="local col2 ref" href="#52work" title='work' data-ref="52work">work</a>, <b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a>,</td></tr>
<tr><th id="331">331</th><td>					      <a class="ref field" href="#mb_cache::c_shrink_work" title='mb_cache::c_shrink_work' data-ref="mb_cache::c_shrink_work">c_shrink_work</a>);</td></tr>
<tr><th id="332">332</th><td>	<a class="tu ref fn" href="#mb_cache_shrink" title='mb_cache_shrink' data-use='c' data-ref="mb_cache_shrink">mb_cache_shrink</a>(<a class="local col3 ref" href="#53cache" title='cache' data-ref="53cache">cache</a>, <a class="local col3 ref" href="#53cache" title='cache' data-ref="53cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_max_entries" title='mb_cache::c_max_entries' data-ref="mb_cache::c_max_entries">c_max_entries</a> / <a class="macro" href="#326" title="16" data-ref="_M/SHRINK_DIVISOR">SHRINK_DIVISOR</a>);</td></tr>
<tr><th id="333">333</th><td>}</td></tr>
<tr><th id="334">334</th><td></td></tr>
<tr><th id="335">335</th><td><i>/*</i></td></tr>
<tr><th id="336">336</th><td><i> * mb_cache_create - create cache</i></td></tr>
<tr><th id="337">337</th><td><i> * @bucket_bits: log2 of the hash table size</i></td></tr>
<tr><th id="338">338</th><td><i> *</i></td></tr>
<tr><th id="339">339</th><td><i> * Create cache for keys with 2^bucket_bits hash entries.</i></td></tr>
<tr><th id="340">340</th><td><i> */</i></td></tr>
<tr><th id="341">341</th><td><b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="decl def fn" id="mb_cache_create" title='mb_cache_create' data-ref="mb_cache_create">mb_cache_create</dfn>(<em>int</em> <dfn class="local col4 decl" id="54bucket_bits" title='bucket_bits' data-type='int' data-ref="54bucket_bits">bucket_bits</dfn>)</td></tr>
<tr><th id="342">342</th><td>{</td></tr>
<tr><th id="343">343</th><td>	<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col5 decl" id="55cache" title='cache' data-type='struct mb_cache *' data-ref="55cache">cache</dfn>;</td></tr>
<tr><th id="344">344</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="56bucket_count" title='bucket_count' data-type='unsigned long' data-ref="56bucket_count">bucket_count</dfn> = <var>1UL</var> &lt;&lt; <a class="local col4 ref" href="#54bucket_bits" title='bucket_bits' data-ref="54bucket_bits">bucket_bits</a>;</td></tr>
<tr><th id="345">345</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="57i" title='i' data-type='unsigned long' data-ref="57i">i</dfn>;</td></tr>
<tr><th id="346">346</th><td></td></tr>
<tr><th id="347">347</th><td>	<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a> = <a class="ref fn" href="../include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc">kzalloc</a>(<b>sizeof</b>(<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a>), <a class="macro" href="../include/linux/gfp.h.html#278" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="348">348</th><td>	<b>if</b> (!<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>)</td></tr>
<tr><th id="349">349</th><td>		<b>goto</b> <a class="lbl" href="#58err_out" data-ref="58err_out">err_out</a>;</td></tr>
<tr><th id="350">350</th><td>	<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_bucket_bits" title='mb_cache::c_bucket_bits' data-ref="mb_cache::c_bucket_bits">c_bucket_bits</a> = <a class="local col4 ref" href="#54bucket_bits" title='bucket_bits' data-ref="54bucket_bits">bucket_bits</a>;</td></tr>
<tr><th id="351">351</th><td>	<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_max_entries" title='mb_cache::c_max_entries' data-ref="mb_cache::c_max_entries">c_max_entries</a> = <a class="local col6 ref" href="#56bucket_count" title='bucket_count' data-ref="56bucket_count">bucket_count</a> &lt;&lt; <var>4</var>;</td></tr>
<tr><th id="352">352</th><td>	<a class="ref fn" href="../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list" title='mb_cache::c_list' data-ref="mb_cache::c_list">c_list</a>);</td></tr>
<tr><th id="353">353</th><td>	<a class="macro" href="../include/linux/spinlock.h.html#309" title="do { spinlock_check(&amp;cache-&gt;c_list_lock); do { *(&amp;(&amp;cache-&gt;c_list_lock)-&gt;rlock) = (raw_spinlock_t) { .raw_lock = { { (0) } }, }; } while (0); } while (0)" data-ref="_M/spin_lock_init">spin_lock_init</a>(&amp;<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list_lock" title='mb_cache::c_list_lock' data-ref="mb_cache::c_list_lock">c_list_lock</a>);</td></tr>
<tr><th id="354">354</th><td>	<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_hash" title='mb_cache::c_hash' data-ref="mb_cache::c_hash">c_hash</a> = <a class="ref fn" href="../include/linux/slab.h.html#kmalloc" title='kmalloc' data-ref="kmalloc">kmalloc</a>(<a class="local col6 ref" href="#56bucket_count" title='bucket_count' data-ref="56bucket_count">bucket_count</a> * <b>sizeof</b>(<b>struct</b> <a class="type" href="../include/linux/list_bl.h.html#hlist_bl_head" title='hlist_bl_head' data-ref="hlist_bl_head">hlist_bl_head</a>),</td></tr>
<tr><th id="355">355</th><td>				<a class="macro" href="../include/linux/gfp.h.html#278" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="356">356</th><td>	<b>if</b> (!<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_hash" title='mb_cache::c_hash' data-ref="mb_cache::c_hash">c_hash</a>) {</td></tr>
<tr><th id="357">357</th><td>		<a class="ref fn" href="../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>);</td></tr>
<tr><th id="358">358</th><td>		<b>goto</b> <a class="lbl" href="#58err_out" data-ref="58err_out">err_out</a>;</td></tr>
<tr><th id="359">359</th><td>	}</td></tr>
<tr><th id="360">360</th><td>	<b>for</b> (<a class="local col7 ref" href="#57i" title='i' data-ref="57i">i</a> = <var>0</var>; <a class="local col7 ref" href="#57i" title='i' data-ref="57i">i</a> &lt; <a class="local col6 ref" href="#56bucket_count" title='bucket_count' data-ref="56bucket_count">bucket_count</a>; <a class="local col7 ref" href="#57i" title='i' data-ref="57i">i</a>++)</td></tr>
<tr><th id="361">361</th><td>		<a class="macro" href="../include/linux/list_bl.h.html#41" title="((&amp;cache-&gt;c_hash[i])-&gt;first = ((void *)0))" data-ref="_M/INIT_HLIST_BL_HEAD">INIT_HLIST_BL_HEAD</a>(&amp;<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_hash" title='mb_cache::c_hash' data-ref="mb_cache::c_hash">c_hash</a>[<a class="local col7 ref" href="#57i" title='i' data-ref="57i">i</a>]);</td></tr>
<tr><th id="362">362</th><td></td></tr>
<tr><th id="363">363</th><td>	<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_shrink" title='mb_cache::c_shrink' data-ref="mb_cache::c_shrink">c_shrink</a>.<a class="ref field" href="../include/linux/shrinker.h.html#shrinker::count_objects" title='shrinker::count_objects' data-ref="shrinker::count_objects">count_objects</a> = <a class="tu ref fn" href="#mb_cache_count" title='mb_cache_count' data-use='r' data-ref="mb_cache_count">mb_cache_count</a>;</td></tr>
<tr><th id="364">364</th><td>	<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_shrink" title='mb_cache::c_shrink' data-ref="mb_cache::c_shrink">c_shrink</a>.<a class="ref field" href="../include/linux/shrinker.h.html#shrinker::scan_objects" title='shrinker::scan_objects' data-ref="shrinker::scan_objects">scan_objects</a> = <a class="tu ref fn" href="#mb_cache_scan" title='mb_cache_scan' data-use='r' data-ref="mb_cache_scan">mb_cache_scan</a>;</td></tr>
<tr><th id="365">365</th><td>	<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_shrink" title='mb_cache::c_shrink' data-ref="mb_cache::c_shrink">c_shrink</a>.<a class="ref field" href="../include/linux/shrinker.h.html#shrinker::seeks" title='shrinker::seeks' data-ref="shrinker::seeks">seeks</a> = <a class="macro" href="../include/linux/shrinker.h.html#72" title="2" data-ref="_M/DEFAULT_SEEKS">DEFAULT_SEEKS</a>;</td></tr>
<tr><th id="366">366</th><td>	<b>if</b> (<a class="ref fn" href="../include/linux/shrinker.h.html#register_shrinker" title='register_shrinker' data-ref="register_shrinker">register_shrinker</a>(&amp;<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_shrink" title='mb_cache::c_shrink' data-ref="mb_cache::c_shrink">c_shrink</a>)) {</td></tr>
<tr><th id="367">367</th><td>		<a class="ref fn" href="../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_hash" title='mb_cache::c_hash' data-ref="mb_cache::c_hash">c_hash</a>);</td></tr>
<tr><th id="368">368</th><td>		<a class="ref fn" href="../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>);</td></tr>
<tr><th id="369">369</th><td>		<b>goto</b> <a class="lbl" href="#58err_out" data-ref="58err_out">err_out</a>;</td></tr>
<tr><th id="370">370</th><td>	}</td></tr>
<tr><th id="371">371</th><td></td></tr>
<tr><th id="372">372</th><td>	<a class="macro" href="../include/linux/workqueue.h.html#236" title="do { __init_work(((&amp;cache-&gt;c_shrink_work)), 0); ((&amp;cache-&gt;c_shrink_work))-&gt;data = (atomic_long_t) { ((unsigned long)WORK_STRUCT_NO_POOL) }; INIT_LIST_HEAD(&amp;((&amp;cache-&gt;c_shrink_work))-&gt;entry); ((&amp;cache-&gt;c_shrink_work))-&gt;func = ((mb_cache_shrink_worker)); } while (0)" data-ref="_M/INIT_WORK">INIT_WORK</a>(&amp;<a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_shrink_work" title='mb_cache::c_shrink_work' data-ref="mb_cache::c_shrink_work">c_shrink_work</a>, <a class="tu ref fn" href="#mb_cache_shrink_worker" title='mb_cache_shrink_worker' data-use='r' data-ref="mb_cache_shrink_worker">mb_cache_shrink_worker</a>);</td></tr>
<tr><th id="373">373</th><td></td></tr>
<tr><th id="374">374</th><td>	<b>return</b> <a class="local col5 ref" href="#55cache" title='cache' data-ref="55cache">cache</a>;</td></tr>
<tr><th id="375">375</th><td></td></tr>
<tr><th id="376">376</th><td><dfn class="lbl" id="58err_out" data-ref="58err_out">err_out</dfn>:</td></tr>
<tr><th id="377">377</th><td>	<b>return</b> <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="378">378</th><td>}</td></tr>
<tr><th id="379">379</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(mb_cache_create) mb_cache_create; static const char __kstrtab_mb_cache_create[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;mb_cache_create&quot;; static const struct kernel_symbol __ksymtab_mb_cache_create __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;mb_cache_create&quot;), used)) = { (unsigned long)&amp;mb_cache_create, __kstrtab_mb_cache_create }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#mb_cache_create" title='mb_cache_create' data-ref="mb_cache_create"><a class="ref fn" href="#mb_cache_create" title='mb_cache_create' data-ref="mb_cache_create"><a class="ref fn" href="#mb_cache_create" title='mb_cache_create' data-ref="mb_cache_create"><a class="ref fn" href="#mb_cache_create" title='mb_cache_create' data-ref="mb_cache_create">mb_cache_create</a></a></a></a>);</td></tr>
<tr><th id="380">380</th><td></td></tr>
<tr><th id="381">381</th><td><i>/*</i></td></tr>
<tr><th id="382">382</th><td><i> * mb_cache_destroy - destroy cache</i></td></tr>
<tr><th id="383">383</th><td><i> * @cache: the cache to destroy</i></td></tr>
<tr><th id="384">384</th><td><i> *</i></td></tr>
<tr><th id="385">385</th><td><i> * Free all entries in cache and cache itself. Caller must make sure nobody</i></td></tr>
<tr><th id="386">386</th><td><i> * (except shrinker) can reach @cache when calling this.</i></td></tr>
<tr><th id="387">387</th><td><i> */</i></td></tr>
<tr><th id="388">388</th><td><em>void</em> <dfn class="decl def fn" id="mb_cache_destroy" title='mb_cache_destroy' data-ref="mb_cache_destroy">mb_cache_destroy</dfn>(<b>struct</b> <a class="type" href="#mb_cache" title='mb_cache' data-ref="mb_cache">mb_cache</a> *<dfn class="local col9 decl" id="59cache" title='cache' data-type='struct mb_cache *' data-ref="59cache">cache</dfn>)</td></tr>
<tr><th id="389">389</th><td>{</td></tr>
<tr><th id="390">390</th><td>	<b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a> *<dfn class="local col0 decl" id="60entry" title='entry' data-type='struct mb_cache_entry *' data-ref="60entry">entry</dfn>, *<dfn class="local col1 decl" id="61next" title='next' data-type='struct mb_cache_entry *' data-ref="61next">next</dfn>;</td></tr>
<tr><th id="391">391</th><td></td></tr>
<tr><th id="392">392</th><td>	<a class="ref fn" href="../include/linux/shrinker.h.html#unregister_shrinker" title='unregister_shrinker' data-ref="unregister_shrinker">unregister_shrinker</a>(&amp;<a class="local col9 ref" href="#59cache" title='cache' data-ref="59cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_shrink" title='mb_cache::c_shrink' data-ref="mb_cache::c_shrink">c_shrink</a>);</td></tr>
<tr><th id="393">393</th><td></td></tr>
<tr><th id="394">394</th><td>	<i>/*</i></td></tr>
<tr><th id="395">395</th><td><i>	 * We don't bother with any locking. Cache must not be used at this</i></td></tr>
<tr><th id="396">396</th><td><i>	 * point.</i></td></tr>
<tr><th id="397">397</th><td><i>	 */</i></td></tr>
<tr><th id="398">398</th><td>	<a class="macro" href="../include/linux/list.h.html#550" title="for (entry = ({ void *__mptr = (void *)((&amp;cache-&gt;c_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;cache-&gt;c_list)-&gt;next)), typeof(((typeof(*entry) *)0)-&gt;e_list)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;cache-&gt;c_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_398(void) ; if (__cond) __compiletime_assert_398(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*entry) *)(__mptr - __builtin_offsetof(typeof(*entry), e_list))); }), next = ({ void *__mptr = (void *)((entry)-&gt;e_list.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((entry)-&gt;e_list.next)), typeof(((typeof(*(entry)) *)0)-&gt;e_list)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((entry)-&gt;e_list.next)), typeof(void)))); extern void __compiletime_assert_398(void) ; if (__cond) __compiletime_assert_398(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(entry)) *)(__mptr - __builtin_offsetof(typeof(*(entry)), e_list))); }); &amp;entry-&gt;e_list != (&amp;cache-&gt;c_list); entry = next, next = ({ void *__mptr = (void *)((next)-&gt;e_list.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((next)-&gt;e_list.next)), typeof(((typeof(*(next)) *)0)-&gt;e_list)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((next)-&gt;e_list.next)), typeof(void)))); extern void __compiletime_assert_398(void) ; if (__cond) __compiletime_assert_398(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(next)) *)(__mptr - __builtin_offsetof(typeof(*(next)), e_list))); }))" data-ref="_M/list_for_each_entry_safe">list_for_each_entry_safe</a>(<a class="local col0 ref" href="#60entry" title='entry' data-ref="60entry">entry</a>, <a class="local col1 ref" href="#61next" title='next' data-ref="61next">next</a>, &amp;<a class="local col9 ref" href="#59cache" title='cache' data-ref="59cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_list" title='mb_cache::c_list' data-ref="mb_cache::c_list">c_list</a>, <a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_list" title='mb_cache_entry::e_list' data-ref="mb_cache_entry::e_list">e_list</a>) {</td></tr>
<tr><th id="399">399</th><td>		<b>if</b> (!<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_unhashed" title='hlist_bl_unhashed' data-ref="hlist_bl_unhashed">hlist_bl_unhashed</a>(&amp;<a class="local col0 ref" href="#60entry" title='entry' data-ref="60entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_hash_list" title='mb_cache_entry::e_hash_list' data-ref="mb_cache_entry::e_hash_list">e_hash_list</a>)) {</td></tr>
<tr><th id="400">400</th><td>			<a class="ref fn" href="../include/linux/list_bl.h.html#hlist_bl_del_init" title='hlist_bl_del_init' data-ref="hlist_bl_del_init">hlist_bl_del_init</a>(&amp;<a class="local col0 ref" href="#60entry" title='entry' data-ref="60entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_hash_list" title='mb_cache_entry::e_hash_list' data-ref="mb_cache_entry::e_hash_list">e_hash_list</a>);</td></tr>
<tr><th id="401">401</th><td>			<a class="ref fn" href="../arch/x86/include/asm/atomic.h.html#atomic_dec" title='atomic_dec' data-ref="atomic_dec">atomic_dec</a>(&amp;<a class="local col0 ref" href="#60entry" title='entry' data-ref="60entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_refcnt" title='mb_cache_entry::e_refcnt' data-ref="mb_cache_entry::e_refcnt">e_refcnt</a>);</td></tr>
<tr><th id="402">402</th><td>		} <b>else</b></td></tr>
<tr><th id="403">403</th><td>			<a class="macro" href="../include/asm-generic/bug.h.html#108" title="({ int __ret_warn_on = !!(1); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/fs/mbcache.c&quot;), &quot;i&quot; (403), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (27)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(<var>1</var>);</td></tr>
<tr><th id="404">404</th><td>		<a class="ref fn" href="../include/linux/list.h.html#list_del" title='list_del' data-ref="list_del">list_del</a>(&amp;<a class="local col0 ref" href="#60entry" title='entry' data-ref="60entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_list" title='mb_cache_entry::e_list' data-ref="mb_cache_entry::e_list">e_list</a>);</td></tr>
<tr><th id="405">405</th><td>		<a class="macro" href="../include/asm-generic/bug.h.html#108" title="({ int __ret_warn_on = !!(atomic_read(&amp;entry-&gt;e_refcnt) != 1); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/fs/mbcache.c&quot;), &quot;i&quot; (405), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (29)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="ref fn" href="../arch/x86/include/asm/atomic.h.html#atomic_read" title='atomic_read' data-ref="atomic_read">atomic_read</a>(&amp;<a class="local col0 ref" href="#60entry" title='entry' data-ref="60entry">entry</a>-&gt;<a class="ref field" href="../include/linux/mbcache.h.html#mb_cache_entry::e_refcnt" title='mb_cache_entry::e_refcnt' data-ref="mb_cache_entry::e_refcnt">e_refcnt</a>) != <var>1</var>);</td></tr>
<tr><th id="406">406</th><td>		<a class="ref fn" href="../include/linux/mbcache.h.html#mb_cache_entry_put" title='mb_cache_entry_put' data-ref="mb_cache_entry_put">mb_cache_entry_put</a>(<a class="local col9 ref" href="#59cache" title='cache' data-ref="59cache">cache</a>, <a class="local col0 ref" href="#60entry" title='entry' data-ref="60entry">entry</a>);</td></tr>
<tr><th id="407">407</th><td>	}</td></tr>
<tr><th id="408">408</th><td>	<a class="ref fn" href="../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col9 ref" href="#59cache" title='cache' data-ref="59cache">cache</a>-&gt;<a class="ref field" href="#mb_cache::c_hash" title='mb_cache::c_hash' data-ref="mb_cache::c_hash">c_hash</a>);</td></tr>
<tr><th id="409">409</th><td>	<a class="ref fn" href="../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col9 ref" href="#59cache" title='cache' data-ref="59cache">cache</a>);</td></tr>
<tr><th id="410">410</th><td>}</td></tr>
<tr><th id="411">411</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(mb_cache_destroy) mb_cache_destroy; static const char __kstrtab_mb_cache_destroy[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;mb_cache_destroy&quot;; static const struct kernel_symbol __ksymtab_mb_cache_destroy __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;mb_cache_destroy&quot;), used)) = { (unsigned long)&amp;mb_cache_destroy, __kstrtab_mb_cache_destroy }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#mb_cache_destroy" title='mb_cache_destroy' data-ref="mb_cache_destroy"><a class="ref fn" href="#mb_cache_destroy" title='mb_cache_destroy' data-ref="mb_cache_destroy"><a class="ref fn" href="#mb_cache_destroy" title='mb_cache_destroy' data-ref="mb_cache_destroy"><a class="ref fn" href="#mb_cache_destroy" title='mb_cache_destroy' data-ref="mb_cache_destroy">mb_cache_destroy</a></a></a></a>);</td></tr>
<tr><th id="412">412</th><td></td></tr>
<tr><th id="413">413</th><td><em>static</em> <em>int</em> <a class="macro" href="../include/linux/init.h.html#50" title="__attribute__ ((__section__(&quot;.init.text&quot;)))" data-ref="_M/__init">__init</a> <dfn class="tu decl def fn" id="mbcache_init" title='mbcache_init' data-type='int mbcache_init()' data-ref="mbcache_init">mbcache_init</dfn>(<em>void</em>)</td></tr>
<tr><th id="414">414</th><td>{</td></tr>
<tr><th id="415">415</th><td>	<a class="tu ref" href="#mb_entry_cache" title='mb_entry_cache' data-use='w' data-ref="mb_entry_cache">mb_entry_cache</a> = <a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_create" title='kmem_cache_create' data-ref="kmem_cache_create">kmem_cache_create</a>(<q>"mbcache"</q>,</td></tr>
<tr><th id="416">416</th><td>				<b>sizeof</b>(<b>struct</b> <a class="type" href="../include/linux/mbcache.h.html#mb_cache_entry" title='mb_cache_entry' data-ref="mb_cache_entry">mb_cache_entry</a>), <var>0</var>,</td></tr>
<tr><th id="417">417</th><td>				<a class="macro" href="../include/linux/slab.h.html#99" title="0x00020000UL" data-ref="_M/SLAB_RECLAIM_ACCOUNT">SLAB_RECLAIM_ACCOUNT</a>|<a class="macro" href="../include/linux/slab.h.html#69" title="0x00100000UL" data-ref="_M/SLAB_MEM_SPREAD">SLAB_MEM_SPREAD</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="418">418</th><td>	<b>if</b> (!<a class="tu ref" href="#mb_entry_cache" title='mb_entry_cache' data-use='r' data-ref="mb_entry_cache">mb_entry_cache</a>)</td></tr>
<tr><th id="419">419</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="420">420</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="421">421</th><td>}</td></tr>
<tr><th id="422">422</th><td></td></tr>
<tr><th id="423">423</th><td><em>static</em> <em>void</em> <a class="macro" href="../include/linux/init.h.html#85" title="__attribute__ ((__section__(&quot;.exit.text&quot;))) __attribute__((__used__)) __attribute__((no_instrument_function))" data-ref="_M/__exit">__exit</a> <dfn class="tu decl def fn" id="mbcache_exit" title='mbcache_exit' data-type='void mbcache_exit()' data-ref="mbcache_exit">mbcache_exit</dfn>(<em>void</em>)</td></tr>
<tr><th id="424">424</th><td>{</td></tr>
<tr><th id="425">425</th><td>	<a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_destroy" title='kmem_cache_destroy' data-ref="kmem_cache_destroy">kmem_cache_destroy</a>(<a class="tu ref" href="#mb_entry_cache" title='mb_entry_cache' data-use='r' data-ref="mb_entry_cache">mb_entry_cache</a>);</td></tr>
<tr><th id="426">426</th><td>}</td></tr>
<tr><th id="427">427</th><td></td></tr>
<tr><th id="428">428</th><td><a class="macro" href="../include/linux/module.h.html#85" title="static initcall_t __initcall_mbcache_init6 __attribute__((__used__)) __attribute__((__section__(&quot;.initcall&quot; &quot;6&quot; &quot;.init&quot;))) = mbcache_init;;" data-ref="_M/module_init">module_init</a>(<a class="tu ref fn" href="#mbcache_init" title='mbcache_init' data-ref="mbcache_init">mbcache_init</a>)</td></tr>
<tr><th id="429">429</th><td><a class="macro" href="../include/linux/module.h.html#97" title="static exitcall_t __exitcall_mbcache_exit __attribute__((__used__)) __attribute__ ((__section__(&quot;.exitcall.exit&quot;))) = mbcache_exit;" data-ref="_M/module_exit">module_exit</a>(<a class="tu ref fn" href="#mbcache_exit" title='mbcache_exit' data-ref="mbcache_exit">mbcache_exit</a>)</td></tr>
<tr><th id="430">430</th><td></td></tr>
<tr><th id="431">431</th><td><a class="macro" href="../include/linux/module.h.html#204" title="struct __UNIQUE_ID_author31 {}" data-ref="_M/MODULE_AUTHOR">MODULE_AUTHOR</a>(<q>"Jan Kara &lt;jack@suse.cz&gt;"</q>);</td></tr>
<tr><th id="432">432</th><td><a class="macro" href="../include/linux/module.h.html#207" title="struct __UNIQUE_ID_description33 {}" data-ref="_M/MODULE_DESCRIPTION">MODULE_DESCRIPTION</a>(<q>"Meta block cache (for extended attributes)"</q>);</td></tr>
<tr><th id="433">433</th><td><a class="macro" href="../include/linux/module.h.html#198" title="struct __UNIQUE_ID_license35 {}" data-ref="_M/MODULE_LICENSE">MODULE_LICENSE</a>(<q>"GPL"</q>);</td></tr>
<tr><th id="434">434</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2018-Aug-02</em> from project linux-4.14.y revision <em>linux-4.14.y</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
