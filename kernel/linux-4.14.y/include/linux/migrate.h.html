<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>migrate.h source code [linux-4.14.y/include/linux/migrate.h] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="migrate_reason "/>
<link rel="stylesheet" href="../../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'linux-4.14.y/include/linux/migrate.h'; var root_path = '../../..'; var data_path = '../../../../data';</script>
<script src='../../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../..'>linux-4.14.y</a>/<a href='..'>include</a>/<a href='./'>linux</a>/<a href='migrate.h.html'>migrate.h</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/* SPDX-License-Identifier: GPL-2.0 */</i></td></tr>
<tr><th id="2">2</th><td><u>#<span data-ppcond="2">ifndef</span> <span class="macro" data-ref="_M/_LINUX_MIGRATE_H">_LINUX_MIGRATE_H</span></u></td></tr>
<tr><th id="3">3</th><td><u>#define <dfn class="macro" id="_M/_LINUX_MIGRATE_H" data-ref="_M/_LINUX_MIGRATE_H">_LINUX_MIGRATE_H</dfn></u></td></tr>
<tr><th id="4">4</th><td></td></tr>
<tr><th id="5">5</th><td><u>#include <a href="mm.h.html">&lt;linux/mm.h&gt;</a></u></td></tr>
<tr><th id="6">6</th><td><u>#include <a href="mempolicy.h.html">&lt;linux/mempolicy.h&gt;</a></u></td></tr>
<tr><th id="7">7</th><td><u>#include <a href="migrate_mode.h.html">&lt;linux/migrate_mode.h&gt;</a></u></td></tr>
<tr><th id="8">8</th><td><u>#include <a href="hugetlb.h.html">&lt;linux/hugetlb.h&gt;</a></u></td></tr>
<tr><th id="9">9</th><td></td></tr>
<tr><th id="10">10</th><td><b>typedef</b> <b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="typedef" id="new_page_t" title='new_page_t' data-type='struct page *(struct page *, unsigned long, int **)' data-ref="new_page_t">new_page_t</dfn>(<b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col1 decl" id="1page" title='page' data-type='struct page *' data-ref="1page">page</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col2 decl" id="2private" title='private' data-type='unsigned long' data-ref="2private">private</dfn>,</td></tr>
<tr><th id="11">11</th><td>				<em>int</em> **<dfn class="local col3 decl" id="3reason" title='reason' data-type='int **' data-ref="3reason">reason</dfn>);</td></tr>
<tr><th id="12">12</th><td><b>typedef</b> <em>void</em> <dfn class="typedef" id="free_page_t" title='free_page_t' data-type='void (struct page *, unsigned long)' data-ref="free_page_t">free_page_t</dfn>(<b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col4 decl" id="4page" title='page' data-type='struct page *' data-ref="4page">page</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="5private" title='private' data-type='unsigned long' data-ref="5private">private</dfn>);</td></tr>
<tr><th id="13">13</th><td></td></tr>
<tr><th id="14">14</th><td><i>/*</i></td></tr>
<tr><th id="15">15</th><td><i> * Return values from addresss_space_operations.migratepage():</i></td></tr>
<tr><th id="16">16</th><td><i> * - negative errno on page migration failure;</i></td></tr>
<tr><th id="17">17</th><td><i> * - zero on page migration success;</i></td></tr>
<tr><th id="18">18</th><td><i> */</i></td></tr>
<tr><th id="19">19</th><td><u>#define <dfn class="macro" id="_M/MIGRATEPAGE_SUCCESS" data-ref="_M/MIGRATEPAGE_SUCCESS">MIGRATEPAGE_SUCCESS</dfn>		0</u></td></tr>
<tr><th id="20">20</th><td></td></tr>
<tr><th id="21">21</th><td><b>enum</b> <dfn class="type def" id="migrate_reason" title='migrate_reason' data-ref="migrate_reason">migrate_reason</dfn> {</td></tr>
<tr><th id="22">22</th><td>	<dfn class="enum" id="MR_COMPACTION" title='MR_COMPACTION' data-ref="MR_COMPACTION">MR_COMPACTION</dfn>,</td></tr>
<tr><th id="23">23</th><td>	<dfn class="enum" id="MR_MEMORY_FAILURE" title='MR_MEMORY_FAILURE' data-ref="MR_MEMORY_FAILURE">MR_MEMORY_FAILURE</dfn>,</td></tr>
<tr><th id="24">24</th><td>	<dfn class="enum" id="MR_MEMORY_HOTPLUG" title='MR_MEMORY_HOTPLUG' data-ref="MR_MEMORY_HOTPLUG">MR_MEMORY_HOTPLUG</dfn>,</td></tr>
<tr><th id="25">25</th><td>	<dfn class="enum" id="MR_SYSCALL" title='MR_SYSCALL' data-ref="MR_SYSCALL">MR_SYSCALL</dfn>,		<i>/* also applies to cpusets */</i></td></tr>
<tr><th id="26">26</th><td>	<dfn class="enum" id="MR_MEMPOLICY_MBIND" title='MR_MEMPOLICY_MBIND' data-ref="MR_MEMPOLICY_MBIND">MR_MEMPOLICY_MBIND</dfn>,</td></tr>
<tr><th id="27">27</th><td>	<dfn class="enum" id="MR_NUMA_MISPLACED" title='MR_NUMA_MISPLACED' data-ref="MR_NUMA_MISPLACED">MR_NUMA_MISPLACED</dfn>,</td></tr>
<tr><th id="28">28</th><td>	<dfn class="enum" id="MR_CMA" title='MR_CMA' data-ref="MR_CMA">MR_CMA</dfn>,</td></tr>
<tr><th id="29">29</th><td>	<dfn class="enum" id="MR_TYPES" title='MR_TYPES' data-ref="MR_TYPES">MR_TYPES</dfn></td></tr>
<tr><th id="30">30</th><td>};</td></tr>
<tr><th id="31">31</th><td></td></tr>
<tr><th id="32">32</th><td><i>/* In mm/debug.c; also keep sync with include/trace/events/migrate.h */</i></td></tr>
<tr><th id="33">33</th><td><b>extern</b> <em>char</em> *<dfn class="decl" id="migrate_reason_names" title='migrate_reason_names' data-ref="migrate_reason_names">migrate_reason_names</dfn>[<a class="enum" href="#MR_TYPES" title='MR_TYPES' data-ref="MR_TYPES">MR_TYPES</a>];</td></tr>
<tr><th id="34">34</th><td></td></tr>
<tr><th id="35">35</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="decl def fn" id="new_page_nodemask" title='new_page_nodemask' data-ref="new_page_nodemask">new_page_nodemask</dfn>(<b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col6 decl" id="6page" title='page' data-type='struct page *' data-ref="6page">page</dfn>,</td></tr>
<tr><th id="36">36</th><td>				<em>int</em> <dfn class="local col7 decl" id="7preferred_nid" title='preferred_nid' data-type='int' data-ref="7preferred_nid">preferred_nid</dfn>, <a class="typedef" href="nodemask.h.html#nodemask_t" title='nodemask_t' data-type='struct nodemask_t' data-ref="nodemask_t">nodemask_t</a> *<dfn class="local col8 decl" id="8nodemask" title='nodemask' data-type='nodemask_t *' data-ref="8nodemask">nodemask</dfn>)</td></tr>
<tr><th id="37">37</th><td>{</td></tr>
<tr><th id="38">38</th><td>	<a class="typedef" href="types.h.html#gfp_t" title='gfp_t' data-type='unsigned int' data-ref="gfp_t">gfp_t</a> <dfn class="local col9 decl" id="9gfp_mask" title='gfp_mask' data-type='gfp_t' data-ref="9gfp_mask">gfp_mask</dfn> = <a class="macro" href="gfp.h.html#283" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u) | (( gfp_t)0x20000u))" data-ref="_M/GFP_USER">GFP_USER</a> | <a class="macro" href="gfp.h.html#60" title="(( gfp_t)0x08u)" data-ref="_M/__GFP_MOVABLE">__GFP_MOVABLE</a> | <a class="macro" href="gfp.h.html#188" title="(( gfp_t)0x400u)" data-ref="_M/__GFP_RETRY_MAYFAIL">__GFP_RETRY_MAYFAIL</a>;</td></tr>
<tr><th id="39">39</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col0 decl" id="10order" title='order' data-type='unsigned int' data-ref="10order">order</dfn> = <var>0</var>;</td></tr>
<tr><th id="40">40</th><td>	<b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col1 decl" id="11new_page" title='new_page' data-type='struct page *' data-ref="11new_page">new_page</dfn> = <a class="macro" href="stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="41">41</th><td></td></tr>
<tr><th id="42">42</th><td>	<b>if</b> (<a class="ref fn" href="page-flags.h.html#PageHuge" title='PageHuge' data-ref="PageHuge">PageHuge</a>(<a class="local col6 ref" href="#6page" title='page' data-ref="6page">page</a>))</td></tr>
<tr><th id="43">43</th><td>		<b>return</b> <a class="ref fn" href="hugetlb.h.html#alloc_huge_page_nodemask" title='alloc_huge_page_nodemask' data-ref="alloc_huge_page_nodemask">alloc_huge_page_nodemask</a>(<a class="ref fn" href="hugetlb.h.html#page_hstate" title='page_hstate' data-ref="page_hstate">page_hstate</a>(<a class="ref fn" href="page-flags.h.html#compound_head" title='compound_head' data-ref="compound_head">compound_head</a>(<a class="local col6 ref" href="#6page" title='page' data-ref="6page">page</a>)),</td></tr>
<tr><th id="44">44</th><td>				<a class="local col7 ref" href="#7preferred_nid" title='preferred_nid' data-ref="7preferred_nid">preferred_nid</a>, <a class="local col8 ref" href="#8nodemask" title='nodemask' data-ref="8nodemask">nodemask</a>);</td></tr>
<tr><th id="45">45</th><td></td></tr>
<tr><th id="46">46</th><td>	<b>if</b> (<a class="ref fn" href="huge_mm.h.html#thp_migration_supported" title='thp_migration_supported' data-ref="thp_migration_supported">thp_migration_supported</a>() &amp;&amp; <a class="ref fn" href="page-flags.h.html#628" title='PageTransHuge' data-ref="PageTransHuge">PageTransHuge</a>(<a class="local col6 ref" href="#6page" title='page' data-ref="6page">page</a>)) {</td></tr>
<tr><th id="47">47</th><td>		<a class="local col0 ref" href="#10order" title='order' data-ref="10order">order</a> = <a class="macro" href="huge_mm.h.html#79" title="(({ do { bool __cond = !(!(1)); extern void __compiletime_assert_47(void) ; if (__cond) __compiletime_assert_47(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); 0; })-12)" data-ref="_M/HPAGE_PMD_ORDER">HPAGE_PMD_ORDER</a>;</td></tr>
<tr><th id="48">48</th><td>		<a class="local col9 ref" href="#9gfp_mask" title='gfp_mask' data-ref="9gfp_mask">gfp_mask</a> |= <a class="macro" href="gfp.h.html#290" title="(((((((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u) | (( gfp_t)0x20000u)) | (( gfp_t)0x02u)) | (( gfp_t)0x08u)) | (( gfp_t)0x4000u) | (( gfp_t)0x10000u) | (( gfp_t)0x200u)) &amp; ~(( gfp_t)(0x400000u|0x1000000u))) | (( gfp_t)0x400000u))" data-ref="_M/GFP_TRANSHUGE">GFP_TRANSHUGE</a>;</td></tr>
<tr><th id="49">49</th><td>	}</td></tr>
<tr><th id="50">50</th><td></td></tr>
<tr><th id="51">51</th><td>	<b>if</b> (<a class="ref fn" href="page-flags.h.html#324" title='PageHighMem' data-ref="PageHighMem">PageHighMem</a>(<a class="local col6 ref" href="#6page" title='page' data-ref="6page">page</a>) || (<a class="macro" href="mmzone.h.html#832" title="((page_zone(page)) - (page_zone(page))-&gt;zone_pgdat-&gt;node_zones)" data-ref="_M/zone_idx">zone_idx</a>(<a class="ref fn" href="mm.h.html#page_zone" title='page_zone' data-ref="page_zone">page_zone</a>(<a class="local col6 ref" href="#6page" title='page' data-ref="6page">page</a>)) == <a class="enum" href="mmzone.h.html#ZONE_MOVABLE" title='ZONE_MOVABLE' data-ref="ZONE_MOVABLE">ZONE_MOVABLE</a>))</td></tr>
<tr><th id="52">52</th><td>		<a class="local col9 ref" href="#9gfp_mask" title='gfp_mask' data-ref="9gfp_mask">gfp_mask</a> |= <a class="macro" href="gfp.h.html#58" title="(( gfp_t)0x02u)" data-ref="_M/__GFP_HIGHMEM">__GFP_HIGHMEM</a>;</td></tr>
<tr><th id="53">53</th><td></td></tr>
<tr><th id="54">54</th><td>	<a class="local col1 ref" href="#11new_page" title='new_page' data-ref="11new_page">new_page</a> = <a class="ref fn" href="gfp.h.html#__alloc_pages_nodemask" title='__alloc_pages_nodemask' data-ref="__alloc_pages_nodemask">__alloc_pages_nodemask</a>(<a class="local col9 ref" href="#9gfp_mask" title='gfp_mask' data-ref="9gfp_mask">gfp_mask</a>, <a class="local col0 ref" href="#10order" title='order' data-ref="10order">order</a>,</td></tr>
<tr><th id="55">55</th><td>				<a class="local col7 ref" href="#7preferred_nid" title='preferred_nid' data-ref="7preferred_nid">preferred_nid</a>, <a class="local col8 ref" href="#8nodemask" title='nodemask' data-ref="8nodemask">nodemask</a>);</td></tr>
<tr><th id="56">56</th><td></td></tr>
<tr><th id="57">57</th><td>	<b>if</b> (<a class="local col1 ref" href="#11new_page" title='new_page' data-ref="11new_page">new_page</a> &amp;&amp; <a class="ref fn" href="page-flags.h.html#628" title='PageTransHuge' data-ref="PageTransHuge">PageTransHuge</a>(<a class="local col1 ref" href="#11new_page" title='new_page' data-ref="11new_page">new_page</a>))</td></tr>
<tr><th id="58">58</th><td>		<a class="ref fn" href="huge_mm.h.html#prep_transhuge_page" title='prep_transhuge_page' data-ref="prep_transhuge_page">prep_transhuge_page</a>(<a class="local col1 ref" href="#11new_page" title='new_page' data-ref="11new_page">new_page</a>);</td></tr>
<tr><th id="59">59</th><td></td></tr>
<tr><th id="60">60</th><td>	<b>return</b> <a class="local col1 ref" href="#11new_page" title='new_page' data-ref="11new_page">new_page</a>;</td></tr>
<tr><th id="61">61</th><td>}</td></tr>
<tr><th id="62">62</th><td></td></tr>
<tr><th id="63">63</th><td><u>#<span data-ppcond="63">ifdef</span> <span class="macro" data-ref="_M/CONFIG_MIGRATION">CONFIG_MIGRATION</span></u></td></tr>
<tr><th id="64">64</th><td></td></tr>
<tr><th id="65">65</th><td><b>extern</b> <em>void</em> putback_movable_pages(<b>struct</b> list_head *l);</td></tr>
<tr><th id="66">66</th><td><b>extern</b> <em>int</em> migrate_page(<b>struct</b> address_space *mapping,</td></tr>
<tr><th id="67">67</th><td>			<b>struct</b> page *newpage, <b>struct</b> page *page,</td></tr>
<tr><th id="68">68</th><td>			<b>enum</b> migrate_mode mode);</td></tr>
<tr><th id="69">69</th><td><b>extern</b> <em>int</em> migrate_pages(<b>struct</b> list_head *l, new_page_t new, free_page_t free,</td></tr>
<tr><th id="70">70</th><td>		<em>unsigned</em> <em>long</em> private, <b>enum</b> migrate_mode mode, <em>int</em> reason);</td></tr>
<tr><th id="71">71</th><td><b>extern</b> <em>int</em> isolate_movable_page(<b>struct</b> page *page, isolate_mode_t mode);</td></tr>
<tr><th id="72">72</th><td><b>extern</b> <em>void</em> putback_movable_page(<b>struct</b> page *page);</td></tr>
<tr><th id="73">73</th><td></td></tr>
<tr><th id="74">74</th><td><b>extern</b> <em>int</em> migrate_prep(<em>void</em>);</td></tr>
<tr><th id="75">75</th><td><b>extern</b> <em>int</em> migrate_prep_local(<em>void</em>);</td></tr>
<tr><th id="76">76</th><td><b>extern</b> <em>void</em> migrate_page_states(<b>struct</b> page *newpage, <b>struct</b> page *page);</td></tr>
<tr><th id="77">77</th><td><b>extern</b> <em>void</em> migrate_page_copy(<b>struct</b> page *newpage, <b>struct</b> page *page);</td></tr>
<tr><th id="78">78</th><td><b>extern</b> <em>int</em> migrate_huge_page_move_mapping(<b>struct</b> address_space *mapping,</td></tr>
<tr><th id="79">79</th><td>				  <b>struct</b> page *newpage, <b>struct</b> page *page);</td></tr>
<tr><th id="80">80</th><td><b>extern</b> <em>int</em> migrate_page_move_mapping(<b>struct</b> address_space *mapping,</td></tr>
<tr><th id="81">81</th><td>		<b>struct</b> page *newpage, <b>struct</b> page *page,</td></tr>
<tr><th id="82">82</th><td>		<b>struct</b> buffer_head *head, <b>enum</b> migrate_mode mode,</td></tr>
<tr><th id="83">83</th><td>		<em>int</em> extra_count);</td></tr>
<tr><th id="84">84</th><td><u>#<span data-ppcond="63">else</span></u></td></tr>
<tr><th id="85">85</th><td></td></tr>
<tr><th id="86">86</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>void</em> <dfn class="decl def fn" id="putback_movable_pages" title='putback_movable_pages' data-ref="putback_movable_pages">putback_movable_pages</dfn>(<b>struct</b> <a class="type" href="types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a> *<dfn class="local col2 decl" id="12l" title='l' data-type='struct list_head *' data-ref="12l">l</dfn>) {}</td></tr>
<tr><th id="87">87</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>int</em> <dfn class="decl def fn" id="migrate_pages" title='migrate_pages' data-ref="migrate_pages">migrate_pages</dfn>(<b>struct</b> <a class="type" href="types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a> *<dfn class="local col3 decl" id="13l" title='l' data-type='struct list_head *' data-ref="13l">l</dfn>, <a class="typedef" href="#new_page_t" title='new_page_t' data-type='struct page *(struct page *, unsigned long, int **)' data-ref="new_page_t">new_page_t</a> <dfn class="local col4 decl" id="14new" title='new' data-type='new_page_t *' data-ref="14new">new</dfn>,</td></tr>
<tr><th id="88">88</th><td>		<a class="typedef" href="#free_page_t" title='free_page_t' data-type='void (struct page *, unsigned long)' data-ref="free_page_t">free_page_t</a> <dfn class="local col5 decl" id="15free" title='free' data-type='free_page_t *' data-ref="15free">free</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="16private" title='private' data-type='unsigned long' data-ref="16private">private</dfn>, <b>enum</b> <a class="type" href="migrate_mode.h.html#migrate_mode" title='migrate_mode' data-ref="migrate_mode">migrate_mode</a> <dfn class="local col7 decl" id="17mode" title='mode' data-type='enum migrate_mode' data-ref="17mode">mode</dfn>,</td></tr>
<tr><th id="89">89</th><td>		<em>int</em> <dfn class="local col8 decl" id="18reason" title='reason' data-type='int' data-ref="18reason">reason</dfn>)</td></tr>
<tr><th id="90">90</th><td>	{ <b>return</b> -<a class="macro" href="../uapi/asm-generic/errno.h.html#18" title="38" data-ref="_M/ENOSYS">ENOSYS</a>; }</td></tr>
<tr><th id="91">91</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>int</em> <dfn class="decl def fn" id="isolate_movable_page" title='isolate_movable_page' data-ref="isolate_movable_page">isolate_movable_page</dfn>(<b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col9 decl" id="19page" title='page' data-type='struct page *' data-ref="19page">page</dfn>, <a class="typedef" href="mmzone.h.html#isolate_mode_t" title='isolate_mode_t' data-type='unsigned int' data-ref="isolate_mode_t">isolate_mode_t</a> <dfn class="local col0 decl" id="20mode" title='mode' data-type='isolate_mode_t' data-ref="20mode">mode</dfn>)</td></tr>
<tr><th id="92">92</th><td>	{ <b>return</b> -<a class="macro" href="../uapi/asm-generic/errno-base.h.html#20" title="16" data-ref="_M/EBUSY">EBUSY</a>; }</td></tr>
<tr><th id="93">93</th><td></td></tr>
<tr><th id="94">94</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>int</em> <dfn class="decl def fn" id="migrate_prep" title='migrate_prep' data-ref="migrate_prep">migrate_prep</dfn>(<em>void</em>) { <b>return</b> -<a class="macro" href="../uapi/asm-generic/errno.h.html#18" title="38" data-ref="_M/ENOSYS">ENOSYS</a>; }</td></tr>
<tr><th id="95">95</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>int</em> <dfn class="decl def fn" id="migrate_prep_local" title='migrate_prep_local' data-ref="migrate_prep_local">migrate_prep_local</dfn>(<em>void</em>) { <b>return</b> -<a class="macro" href="../uapi/asm-generic/errno.h.html#18" title="38" data-ref="_M/ENOSYS">ENOSYS</a>; }</td></tr>
<tr><th id="96">96</th><td></td></tr>
<tr><th id="97">97</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>void</em> <dfn class="decl def fn" id="migrate_page_states" title='migrate_page_states' data-ref="migrate_page_states">migrate_page_states</dfn>(<b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col1 decl" id="21newpage" title='newpage' data-type='struct page *' data-ref="21newpage">newpage</dfn>, <b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col2 decl" id="22page" title='page' data-type='struct page *' data-ref="22page">page</dfn>)</td></tr>
<tr><th id="98">98</th><td>{</td></tr>
<tr><th id="99">99</th><td>}</td></tr>
<tr><th id="100">100</th><td></td></tr>
<tr><th id="101">101</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>void</em> <dfn class="decl def fn" id="migrate_page_copy" title='migrate_page_copy' data-ref="migrate_page_copy">migrate_page_copy</dfn>(<b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col3 decl" id="23newpage" title='newpage' data-type='struct page *' data-ref="23newpage">newpage</dfn>,</td></tr>
<tr><th id="102">102</th><td>				     <b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col4 decl" id="24page" title='page' data-type='struct page *' data-ref="24page">page</dfn>) {}</td></tr>
<tr><th id="103">103</th><td></td></tr>
<tr><th id="104">104</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>int</em> <dfn class="decl def fn" id="migrate_huge_page_move_mapping" title='migrate_huge_page_move_mapping' data-ref="migrate_huge_page_move_mapping">migrate_huge_page_move_mapping</dfn>(<b>struct</b> <a class="type" href="fs.h.html#address_space" title='address_space' data-ref="address_space">address_space</a> *<dfn class="local col5 decl" id="25mapping" title='mapping' data-type='struct address_space *' data-ref="25mapping">mapping</dfn>,</td></tr>
<tr><th id="105">105</th><td>				  <b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col6 decl" id="26newpage" title='newpage' data-type='struct page *' data-ref="26newpage">newpage</dfn>, <b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col7 decl" id="27page" title='page' data-type='struct page *' data-ref="27page">page</dfn>)</td></tr>
<tr><th id="106">106</th><td>{</td></tr>
<tr><th id="107">107</th><td>	<b>return</b> -<a class="macro" href="../uapi/asm-generic/errno.h.html#18" title="38" data-ref="_M/ENOSYS">ENOSYS</a>;</td></tr>
<tr><th id="108">108</th><td>}</td></tr>
<tr><th id="109">109</th><td></td></tr>
<tr><th id="110">110</th><td><u>#<span data-ppcond="63">endif</span> /* CONFIG_MIGRATION */</u></td></tr>
<tr><th id="111">111</th><td></td></tr>
<tr><th id="112">112</th><td><u>#<span data-ppcond="112">ifdef</span> <span class="macro" data-ref="_M/CONFIG_COMPACTION">CONFIG_COMPACTION</span></u></td></tr>
<tr><th id="113">113</th><td><b>extern</b> <em>int</em> PageMovable(<b>struct</b> page *page);</td></tr>
<tr><th id="114">114</th><td><b>extern</b> <em>void</em> __SetPageMovable(<b>struct</b> page *page, <b>struct</b> address_space *mapping);</td></tr>
<tr><th id="115">115</th><td><b>extern</b> <em>void</em> __ClearPageMovable(<b>struct</b> page *page);</td></tr>
<tr><th id="116">116</th><td><u>#<span data-ppcond="112">else</span></u></td></tr>
<tr><th id="117">117</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>int</em> <dfn class="decl def fn" id="PageMovable" title='PageMovable' data-ref="PageMovable">PageMovable</dfn>(<b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col8 decl" id="28page" title='page' data-type='struct page *' data-ref="28page">page</dfn>) { <b>return</b> <var>0</var>; };</td></tr>
<tr><th id="118">118</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>void</em> <dfn class="decl def fn" id="__SetPageMovable" title='__SetPageMovable' data-ref="__SetPageMovable">__SetPageMovable</dfn>(<b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col9 decl" id="29page" title='page' data-type='struct page *' data-ref="29page">page</dfn>,</td></tr>
<tr><th id="119">119</th><td>				<b>struct</b> <a class="type" href="fs.h.html#address_space" title='address_space' data-ref="address_space">address_space</a> *<dfn class="local col0 decl" id="30mapping" title='mapping' data-type='struct address_space *' data-ref="30mapping">mapping</dfn>)</td></tr>
<tr><th id="120">120</th><td>{</td></tr>
<tr><th id="121">121</th><td>}</td></tr>
<tr><th id="122">122</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>void</em> <dfn class="decl def fn" id="__ClearPageMovable" title='__ClearPageMovable' data-ref="__ClearPageMovable">__ClearPageMovable</dfn>(<b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col1 decl" id="31page" title='page' data-type='struct page *' data-ref="31page">page</dfn>)</td></tr>
<tr><th id="123">123</th><td>{</td></tr>
<tr><th id="124">124</th><td>}</td></tr>
<tr><th id="125">125</th><td><u>#<span data-ppcond="112">endif</span></u></td></tr>
<tr><th id="126">126</th><td></td></tr>
<tr><th id="127">127</th><td><u>#<span data-ppcond="127">ifdef</span> <span class="macro" data-ref="_M/CONFIG_NUMA_BALANCING">CONFIG_NUMA_BALANCING</span></u></td></tr>
<tr><th id="128">128</th><td><b>extern</b> bool pmd_trans_migrating(pmd_t pmd);</td></tr>
<tr><th id="129">129</th><td><b>extern</b> <em>int</em> migrate_misplaced_page(<b>struct</b> page *page,</td></tr>
<tr><th id="130">130</th><td>				  <b>struct</b> vm_area_struct *vma, <em>int</em> node);</td></tr>
<tr><th id="131">131</th><td><u>#<span data-ppcond="127">else</span></u></td></tr>
<tr><th id="132">132</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <a class="typedef" href="types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="decl def fn" id="pmd_trans_migrating" title='pmd_trans_migrating' data-ref="pmd_trans_migrating">pmd_trans_migrating</dfn>(<a class="typedef" href="../../arch/x86/include/asm/pgtable_types.h.html#pmd_t" title='pmd_t' data-type='struct pmd_t' data-ref="pmd_t">pmd_t</a> <dfn class="local col2 decl" id="32pmd" title='pmd' data-type='pmd_t' data-ref="32pmd">pmd</dfn>)</td></tr>
<tr><th id="133">133</th><td>{</td></tr>
<tr><th id="134">134</th><td>	<b>return</b> <a class="enum" href="stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="135">135</th><td>}</td></tr>
<tr><th id="136">136</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>int</em> <dfn class="decl def fn" id="migrate_misplaced_page" title='migrate_misplaced_page' data-ref="migrate_misplaced_page">migrate_misplaced_page</dfn>(<b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col3 decl" id="33page" title='page' data-type='struct page *' data-ref="33page">page</dfn>,</td></tr>
<tr><th id="137">137</th><td>					 <b>struct</b> <a class="type" href="mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col4 decl" id="34vma" title='vma' data-type='struct vm_area_struct *' data-ref="34vma">vma</dfn>, <em>int</em> <dfn class="local col5 decl" id="35node" title='node' data-type='int' data-ref="35node">node</dfn>)</td></tr>
<tr><th id="138">138</th><td>{</td></tr>
<tr><th id="139">139</th><td>	<b>return</b> -<a class="macro" href="../uapi/asm-generic/errno-base.h.html#15" title="11" data-ref="_M/EAGAIN">EAGAIN</a>; <i>/* can't migrate now */</i></td></tr>
<tr><th id="140">140</th><td>}</td></tr>
<tr><th id="141">141</th><td><u>#<span data-ppcond="127">endif</span> /* CONFIG_NUMA_BALANCING */</u></td></tr>
<tr><th id="142">142</th><td></td></tr>
<tr><th id="143">143</th><td><u>#<span data-ppcond="143">if</span> defined(<span class="macro" data-ref="_M/CONFIG_NUMA_BALANCING">CONFIG_NUMA_BALANCING</span>) &amp;&amp; defined(<span class="macro" data-ref="_M/CONFIG_TRANSPARENT_HUGEPAGE">CONFIG_TRANSPARENT_HUGEPAGE</span>)</u></td></tr>
<tr><th id="144">144</th><td><b>extern</b> <em>int</em> migrate_misplaced_transhuge_page(<b>struct</b> mm_struct *mm,</td></tr>
<tr><th id="145">145</th><td>			<b>struct</b> vm_area_struct *vma,</td></tr>
<tr><th id="146">146</th><td>			pmd_t *pmd, pmd_t entry,</td></tr>
<tr><th id="147">147</th><td>			<em>unsigned</em> <em>long</em> address,</td></tr>
<tr><th id="148">148</th><td>			<b>struct</b> page *page, <em>int</em> node);</td></tr>
<tr><th id="149">149</th><td><u>#<span data-ppcond="143">else</span></u></td></tr>
<tr><th id="150">150</th><td><em>static</em> <a class="macro" href="compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>int</em> <dfn class="decl def fn" id="migrate_misplaced_transhuge_page" title='migrate_misplaced_transhuge_page' data-ref="migrate_misplaced_transhuge_page">migrate_misplaced_transhuge_page</dfn>(<b>struct</b> <a class="type" href="mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col6 decl" id="36mm" title='mm' data-type='struct mm_struct *' data-ref="36mm">mm</dfn>,</td></tr>
<tr><th id="151">151</th><td>			<b>struct</b> <a class="type" href="mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col7 decl" id="37vma" title='vma' data-type='struct vm_area_struct *' data-ref="37vma">vma</dfn>,</td></tr>
<tr><th id="152">152</th><td>			<a class="typedef" href="../../arch/x86/include/asm/pgtable_types.h.html#pmd_t" title='pmd_t' data-type='struct pmd_t' data-ref="pmd_t">pmd_t</a> *<dfn class="local col8 decl" id="38pmd" title='pmd' data-type='pmd_t *' data-ref="38pmd">pmd</dfn>, <a class="typedef" href="../../arch/x86/include/asm/pgtable_types.h.html#pmd_t" title='pmd_t' data-type='struct pmd_t' data-ref="pmd_t">pmd_t</a> <dfn class="local col9 decl" id="39entry" title='entry' data-type='pmd_t' data-ref="39entry">entry</dfn>,</td></tr>
<tr><th id="153">153</th><td>			<em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="40address" title='address' data-type='unsigned long' data-ref="40address">address</dfn>,</td></tr>
<tr><th id="154">154</th><td>			<b>struct</b> <a class="type" href="mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col1 decl" id="41page" title='page' data-type='struct page *' data-ref="41page">page</dfn>, <em>int</em> <dfn class="local col2 decl" id="42node" title='node' data-type='int' data-ref="42node">node</dfn>)</td></tr>
<tr><th id="155">155</th><td>{</td></tr>
<tr><th id="156">156</th><td>	<b>return</b> -<a class="macro" href="../uapi/asm-generic/errno-base.h.html#15" title="11" data-ref="_M/EAGAIN">EAGAIN</a>;</td></tr>
<tr><th id="157">157</th><td>}</td></tr>
<tr><th id="158">158</th><td><u>#<span data-ppcond="143">endif</span> /* CONFIG_NUMA_BALANCING &amp;&amp; CONFIG_TRANSPARENT_HUGEPAGE*/</u></td></tr>
<tr><th id="159">159</th><td></td></tr>
<tr><th id="160">160</th><td></td></tr>
<tr><th id="161">161</th><td><u>#<span data-ppcond="161">ifdef</span> <span class="macro" data-ref="_M/CONFIG_MIGRATION">CONFIG_MIGRATION</span></u></td></tr>
<tr><th id="162">162</th><td></td></tr>
<tr><th id="163">163</th><td><i>/*</i></td></tr>
<tr><th id="164">164</th><td><i> * Watch out for PAE architecture, which has an unsigned long, and might not</i></td></tr>
<tr><th id="165">165</th><td><i> * have enough bits to store all physical address and flags. So far we have</i></td></tr>
<tr><th id="166">166</th><td><i> * enough room for all our flags.</i></td></tr>
<tr><th id="167">167</th><td><i> */</i></td></tr>
<tr><th id="168">168</th><td><u>#define MIGRATE_PFN_VALID	(1UL &lt;&lt; 0)</u></td></tr>
<tr><th id="169">169</th><td><u>#define MIGRATE_PFN_MIGRATE	(1UL &lt;&lt; 1)</u></td></tr>
<tr><th id="170">170</th><td><u>#define MIGRATE_PFN_LOCKED	(1UL &lt;&lt; 2)</u></td></tr>
<tr><th id="171">171</th><td><u>#define MIGRATE_PFN_WRITE	(1UL &lt;&lt; 3)</u></td></tr>
<tr><th id="172">172</th><td><u>#define MIGRATE_PFN_DEVICE	(1UL &lt;&lt; 4)</u></td></tr>
<tr><th id="173">173</th><td><u>#define MIGRATE_PFN_ERROR	(1UL &lt;&lt; 5)</u></td></tr>
<tr><th id="174">174</th><td><u>#define MIGRATE_PFN_SHIFT	6</u></td></tr>
<tr><th id="175">175</th><td></td></tr>
<tr><th id="176">176</th><td><em>static</em> <b>inline</b> <b>struct</b> page *migrate_pfn_to_page(<em>unsigned</em> <em>long</em> mpfn)</td></tr>
<tr><th id="177">177</th><td>{</td></tr>
<tr><th id="178">178</th><td>	<b>if</b> (!(mpfn &amp; MIGRATE_PFN_VALID))</td></tr>
<tr><th id="179">179</th><td>		<b>return</b> NULL;</td></tr>
<tr><th id="180">180</th><td>	<b>return</b> pfn_to_page(mpfn &gt;&gt; MIGRATE_PFN_SHIFT);</td></tr>
<tr><th id="181">181</th><td>}</td></tr>
<tr><th id="182">182</th><td></td></tr>
<tr><th id="183">183</th><td><em>static</em> <b>inline</b> <em>unsigned</em> <em>long</em> migrate_pfn(<em>unsigned</em> <em>long</em> pfn)</td></tr>
<tr><th id="184">184</th><td>{</td></tr>
<tr><th id="185">185</th><td>	<b>return</b> (pfn &lt;&lt; MIGRATE_PFN_SHIFT) | MIGRATE_PFN_VALID;</td></tr>
<tr><th id="186">186</th><td>}</td></tr>
<tr><th id="187">187</th><td></td></tr>
<tr><th id="188">188</th><td><i>/*</i></td></tr>
<tr><th id="189">189</th><td><i> * struct migrate_vma_ops - migrate operation callback</i></td></tr>
<tr><th id="190">190</th><td><i> *</i></td></tr>
<tr><th id="191">191</th><td><i> * @alloc_and_copy: alloc destination memory and copy source memory to it</i></td></tr>
<tr><th id="192">192</th><td><i> * @finalize_and_map: allow caller to map the successfully migrated pages</i></td></tr>
<tr><th id="193">193</th><td><i> *</i></td></tr>
<tr><th id="194">194</th><td><i> *</i></td></tr>
<tr><th id="195">195</th><td><i> * The alloc_and_copy() callback happens once all source pages have been locked,</i></td></tr>
<tr><th id="196">196</th><td><i> * unmapped and checked (checked whether pinned or not). All pages that can be</i></td></tr>
<tr><th id="197">197</th><td><i> * migrated will have an entry in the src array set with the pfn value of the</i></td></tr>
<tr><th id="198">198</th><td><i> * page and with the MIGRATE_PFN_VALID and MIGRATE_PFN_MIGRATE flag set (other</i></td></tr>
<tr><th id="199">199</th><td><i> * flags might be set but should be ignored by the callback).</i></td></tr>
<tr><th id="200">200</th><td><i> *</i></td></tr>
<tr><th id="201">201</th><td><i> * The alloc_and_copy() callback can then allocate destination memory and copy</i></td></tr>
<tr><th id="202">202</th><td><i> * source memory to it for all those entries (ie with MIGRATE_PFN_VALID and</i></td></tr>
<tr><th id="203">203</th><td><i> * MIGRATE_PFN_MIGRATE flag set). Once these are allocated and copied, the</i></td></tr>
<tr><th id="204">204</th><td><i> * callback must update each corresponding entry in the dst array with the pfn</i></td></tr>
<tr><th id="205">205</th><td><i> * value of the destination page and with the MIGRATE_PFN_VALID and</i></td></tr>
<tr><th id="206">206</th><td><i> * MIGRATE_PFN_LOCKED flags set (destination pages must have their struct pages</i></td></tr>
<tr><th id="207">207</th><td><i> * locked, via lock_page()).</i></td></tr>
<tr><th id="208">208</th><td><i> *</i></td></tr>
<tr><th id="209">209</th><td><i> * At this point the alloc_and_copy() callback is done and returns.</i></td></tr>
<tr><th id="210">210</th><td><i> *</i></td></tr>
<tr><th id="211">211</th><td><i> * Note that the callback does not have to migrate all the pages that are</i></td></tr>
<tr><th id="212">212</th><td><i> * marked with MIGRATE_PFN_MIGRATE flag in src array unless this is a migration</i></td></tr>
<tr><th id="213">213</th><td><i> * from device memory to system memory (ie the MIGRATE_PFN_DEVICE flag is also</i></td></tr>
<tr><th id="214">214</th><td><i> * set in the src array entry). If the device driver cannot migrate a device</i></td></tr>
<tr><th id="215">215</th><td><i> * page back to system memory, then it must set the corresponding dst array</i></td></tr>
<tr><th id="216">216</th><td><i> * entry to MIGRATE_PFN_ERROR. This will trigger a SIGBUS if CPU tries to</i></td></tr>
<tr><th id="217">217</th><td><i> * access any of the virtual addresses originally backed by this page. Because</i></td></tr>
<tr><th id="218">218</th><td><i> * a SIGBUS is such a severe result for the userspace process, the device</i></td></tr>
<tr><th id="219">219</th><td><i> * driver should avoid setting MIGRATE_PFN_ERROR unless it is really in an</i></td></tr>
<tr><th id="220">220</th><td><i> * unrecoverable state.</i></td></tr>
<tr><th id="221">221</th><td><i> *</i></td></tr>
<tr><th id="222">222</th><td><i> * For empty entry inside CPU page table (pte_none() or pmd_none() is true) we</i></td></tr>
<tr><th id="223">223</th><td><i> * do set MIGRATE_PFN_MIGRATE flag inside the corresponding source array thus</i></td></tr>
<tr><th id="224">224</th><td><i> * allowing device driver to allocate device memory for those unback virtual</i></td></tr>
<tr><th id="225">225</th><td><i> * address. For this the device driver simply have to allocate device memory</i></td></tr>
<tr><th id="226">226</th><td><i> * and properly set the destination entry like for regular migration. Note that</i></td></tr>
<tr><th id="227">227</th><td><i> * this can still fails and thus inside the device driver must check if the</i></td></tr>
<tr><th id="228">228</th><td><i> * migration was successful for those entry inside the finalize_and_map()</i></td></tr>
<tr><th id="229">229</th><td><i> * callback just like for regular migration.</i></td></tr>
<tr><th id="230">230</th><td><i> *</i></td></tr>
<tr><th id="231">231</th><td><i> * THE alloc_and_copy() CALLBACK MUST NOT CHANGE ANY OF THE SRC ARRAY ENTRIES</i></td></tr>
<tr><th id="232">232</th><td><i> * OR BAD THINGS WILL HAPPEN !</i></td></tr>
<tr><th id="233">233</th><td><i> *</i></td></tr>
<tr><th id="234">234</th><td><i> *</i></td></tr>
<tr><th id="235">235</th><td><i> * The finalize_and_map() callback happens after struct page migration from</i></td></tr>
<tr><th id="236">236</th><td><i> * source to destination (destination struct pages are the struct pages for the</i></td></tr>
<tr><th id="237">237</th><td><i> * memory allocated by the alloc_and_copy() callback).  Migration can fail, and</i></td></tr>
<tr><th id="238">238</th><td><i> * thus the finalize_and_map() allows the driver to inspect which pages were</i></td></tr>
<tr><th id="239">239</th><td><i> * successfully migrated, and which were not. Successfully migrated pages will</i></td></tr>
<tr><th id="240">240</th><td><i> * have the MIGRATE_PFN_MIGRATE flag set for their src array entry.</i></td></tr>
<tr><th id="241">241</th><td><i> *</i></td></tr>
<tr><th id="242">242</th><td><i> * It is safe to update device page table from within the finalize_and_map()</i></td></tr>
<tr><th id="243">243</th><td><i> * callback because both destination and source page are still locked, and the</i></td></tr>
<tr><th id="244">244</th><td><i> * mmap_sem is held in read mode (hence no one can unmap the range being</i></td></tr>
<tr><th id="245">245</th><td><i> * migrated).</i></td></tr>
<tr><th id="246">246</th><td><i> *</i></td></tr>
<tr><th id="247">247</th><td><i> * Once callback is done cleaning up things and updating its page table (if it</i></td></tr>
<tr><th id="248">248</th><td><i> * chose to do so, this is not an obligation) then it returns. At this point,</i></td></tr>
<tr><th id="249">249</th><td><i> * the HMM core will finish up the final steps, and the migration is complete.</i></td></tr>
<tr><th id="250">250</th><td><i> *</i></td></tr>
<tr><th id="251">251</th><td><i> * THE finalize_and_map() CALLBACK MUST NOT CHANGE ANY OF THE SRC OR DST ARRAY</i></td></tr>
<tr><th id="252">252</th><td><i> * ENTRIES OR BAD THINGS WILL HAPPEN !</i></td></tr>
<tr><th id="253">253</th><td><i> */</i></td></tr>
<tr><th id="254">254</th><td><b>struct</b> migrate_vma_ops {</td></tr>
<tr><th id="255">255</th><td>	<em>void</em> (*alloc_and_copy)(<b>struct</b> vm_area_struct *vma,</td></tr>
<tr><th id="256">256</th><td>			       <em>const</em> <em>unsigned</em> <em>long</em> *src,</td></tr>
<tr><th id="257">257</th><td>			       <em>unsigned</em> <em>long</em> *dst,</td></tr>
<tr><th id="258">258</th><td>			       <em>unsigned</em> <em>long</em> start,</td></tr>
<tr><th id="259">259</th><td>			       <em>unsigned</em> <em>long</em> end,</td></tr>
<tr><th id="260">260</th><td>			       <em>void</em> *private);</td></tr>
<tr><th id="261">261</th><td>	<em>void</em> (*finalize_and_map)(<b>struct</b> vm_area_struct *vma,</td></tr>
<tr><th id="262">262</th><td>				 <em>const</em> <em>unsigned</em> <em>long</em> *src,</td></tr>
<tr><th id="263">263</th><td>				 <em>const</em> <em>unsigned</em> <em>long</em> *dst,</td></tr>
<tr><th id="264">264</th><td>				 <em>unsigned</em> <em>long</em> start,</td></tr>
<tr><th id="265">265</th><td>				 <em>unsigned</em> <em>long</em> end,</td></tr>
<tr><th id="266">266</th><td>				 <em>void</em> *private);</td></tr>
<tr><th id="267">267</th><td>};</td></tr>
<tr><th id="268">268</th><td></td></tr>
<tr><th id="269">269</th><td><u>#if defined(CONFIG_MIGRATE_VMA_HELPER)</u></td></tr>
<tr><th id="270">270</th><td><em>int</em> migrate_vma(<em>const</em> <b>struct</b> migrate_vma_ops *ops,</td></tr>
<tr><th id="271">271</th><td>		<b>struct</b> vm_area_struct *vma,</td></tr>
<tr><th id="272">272</th><td>		<em>unsigned</em> <em>long</em> start,</td></tr>
<tr><th id="273">273</th><td>		<em>unsigned</em> <em>long</em> end,</td></tr>
<tr><th id="274">274</th><td>		<em>unsigned</em> <em>long</em> *src,</td></tr>
<tr><th id="275">275</th><td>		<em>unsigned</em> <em>long</em> *dst,</td></tr>
<tr><th id="276">276</th><td>		<em>void</em> *private);</td></tr>
<tr><th id="277">277</th><td><u>#else</u></td></tr>
<tr><th id="278">278</th><td><em>static</em> <b>inline</b> <em>int</em> migrate_vma(<em>const</em> <b>struct</b> migrate_vma_ops *ops,</td></tr>
<tr><th id="279">279</th><td>			      <b>struct</b> vm_area_struct *vma,</td></tr>
<tr><th id="280">280</th><td>			      <em>unsigned</em> <em>long</em> start,</td></tr>
<tr><th id="281">281</th><td>			      <em>unsigned</em> <em>long</em> end,</td></tr>
<tr><th id="282">282</th><td>			      <em>unsigned</em> <em>long</em> *src,</td></tr>
<tr><th id="283">283</th><td>			      <em>unsigned</em> <em>long</em> *dst,</td></tr>
<tr><th id="284">284</th><td>			      <em>void</em> *private)</td></tr>
<tr><th id="285">285</th><td>{</td></tr>
<tr><th id="286">286</th><td>	<b>return</b> -EINVAL;</td></tr>
<tr><th id="287">287</th><td>}</td></tr>
<tr><th id="288">288</th><td><u>#endif /* IS_ENABLED(CONFIG_MIGRATE_VMA_HELPER) */</u></td></tr>
<tr><th id="289">289</th><td></td></tr>
<tr><th id="290">290</th><td><u>#<span data-ppcond="161">endif</span> /* CONFIG_MIGRATION */</u></td></tr>
<tr><th id="291">291</th><td></td></tr>
<tr><th id="292">292</th><td><u>#<span data-ppcond="2">endif</span> /* _LINUX_MIGRATE_H */</u></td></tr>
<tr><th id="293">293</th><td></td></tr>
</table><hr/><p id='footer'>
Generated while processing <a href='../../drivers/virtio/virtio_balloon.c.html'>linux-4.14.y/drivers/virtio/virtio_balloon.c</a><br/>Generated on <em>2018-Aug-02</em> from project linux-4.14.y revision <em>linux-4.14.y</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
