<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>mmap.c source code [linux-4.14.y/mm/mmap.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'linux-4.14.y/mm/mmap.c'; var root_path = '../..'; var data_path = '../../../data';</script>
<script src='../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='..'>linux-4.14.y</a>/<a href='./'>mm</a>/<a href='mmap.c.html'>mmap.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> * mm/mmap.c</i></td></tr>
<tr><th id="3">3</th><td><i> *</i></td></tr>
<tr><th id="4">4</th><td><i> * Written by obz.</i></td></tr>
<tr><th id="5">5</th><td><i> *</i></td></tr>
<tr><th id="6">6</th><td><i> * Address space accounting code	&lt;alan@lxorguk.ukuu.org.uk&gt;</i></td></tr>
<tr><th id="7">7</th><td><i> */</i></td></tr>
<tr><th id="8">8</th><td></td></tr>
<tr><th id="9">9</th><td><u>#define <dfn class="macro" id="_M/pr_fmt" data-ref="_M/pr_fmt">pr_fmt</dfn>(fmt) KBUILD_MODNAME ": " fmt</u></td></tr>
<tr><th id="10">10</th><td></td></tr>
<tr><th id="11">11</th><td><u>#include <a href="../include/linux/kernel.h.html">&lt;linux/kernel.h&gt;</a></u></td></tr>
<tr><th id="12">12</th><td><u>#include <a href="../include/linux/slab.h.html">&lt;linux/slab.h&gt;</a></u></td></tr>
<tr><th id="13">13</th><td><u>#include <a href="../include/linux/backing-dev.h.html">&lt;linux/backing-dev.h&gt;</a></u></td></tr>
<tr><th id="14">14</th><td><u>#include <a href="../include/linux/mm.h.html">&lt;linux/mm.h&gt;</a></u></td></tr>
<tr><th id="15">15</th><td><u>#include <a href="../include/linux/vmacache.h.html">&lt;linux/vmacache.h&gt;</a></u></td></tr>
<tr><th id="16">16</th><td><u>#include <a href="../include/linux/shm.h.html">&lt;linux/shm.h&gt;</a></u></td></tr>
<tr><th id="17">17</th><td><u>#include <a href="../include/linux/mman.h.html">&lt;linux/mman.h&gt;</a></u></td></tr>
<tr><th id="18">18</th><td><u>#include <a href="../include/linux/pagemap.h.html">&lt;linux/pagemap.h&gt;</a></u></td></tr>
<tr><th id="19">19</th><td><u>#include <a href="../include/linux/swap.h.html">&lt;linux/swap.h&gt;</a></u></td></tr>
<tr><th id="20">20</th><td><u>#include <a href="../include/linux/syscalls.h.html">&lt;linux/syscalls.h&gt;</a></u></td></tr>
<tr><th id="21">21</th><td><u>#include <a href="../include/linux/capability.h.html">&lt;linux/capability.h&gt;</a></u></td></tr>
<tr><th id="22">22</th><td><u>#include <a href="../include/linux/init.h.html">&lt;linux/init.h&gt;</a></u></td></tr>
<tr><th id="23">23</th><td><u>#include <a href="../include/linux/file.h.html">&lt;linux/file.h&gt;</a></u></td></tr>
<tr><th id="24">24</th><td><u>#include <a href="../include/linux/fs.h.html">&lt;linux/fs.h&gt;</a></u></td></tr>
<tr><th id="25">25</th><td><u>#include <a href="../include/linux/personality.h.html">&lt;linux/personality.h&gt;</a></u></td></tr>
<tr><th id="26">26</th><td><u>#include <a href="../include/linux/security.h.html">&lt;linux/security.h&gt;</a></u></td></tr>
<tr><th id="27">27</th><td><u>#include <a href="../include/linux/hugetlb.h.html">&lt;linux/hugetlb.h&gt;</a></u></td></tr>
<tr><th id="28">28</th><td><u>#include <a href="../include/linux/shmem_fs.h.html">&lt;linux/shmem_fs.h&gt;</a></u></td></tr>
<tr><th id="29">29</th><td><u>#include <a href="../include/linux/profile.h.html">&lt;linux/profile.h&gt;</a></u></td></tr>
<tr><th id="30">30</th><td><u>#include <a href="../include/linux/export.h.html">&lt;linux/export.h&gt;</a></u></td></tr>
<tr><th id="31">31</th><td><u>#include <a href="../include/linux/mount.h.html">&lt;linux/mount.h&gt;</a></u></td></tr>
<tr><th id="32">32</th><td><u>#include <a href="../include/linux/mempolicy.h.html">&lt;linux/mempolicy.h&gt;</a></u></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="../include/linux/rmap.h.html">&lt;linux/rmap.h&gt;</a></u></td></tr>
<tr><th id="34">34</th><td><u>#include <a href="../include/linux/mmu_notifier.h.html">&lt;linux/mmu_notifier.h&gt;</a></u></td></tr>
<tr><th id="35">35</th><td><u>#include <a href="../include/linux/mmdebug.h.html">&lt;linux/mmdebug.h&gt;</a></u></td></tr>
<tr><th id="36">36</th><td><u>#include <a href="../include/linux/perf_event.h.html">&lt;linux/perf_event.h&gt;</a></u></td></tr>
<tr><th id="37">37</th><td><u>#include <a href="../include/linux/audit.h.html">&lt;linux/audit.h&gt;</a></u></td></tr>
<tr><th id="38">38</th><td><u>#include <a href="../include/linux/khugepaged.h.html">&lt;linux/khugepaged.h&gt;</a></u></td></tr>
<tr><th id="39">39</th><td><u>#include <a href="../include/linux/uprobes.h.html">&lt;linux/uprobes.h&gt;</a></u></td></tr>
<tr><th id="40">40</th><td><u>#include <a href="../include/linux/rbtree_augmented.h.html">&lt;linux/rbtree_augmented.h&gt;</a></u></td></tr>
<tr><th id="41">41</th><td><u>#include <a href="../include/linux/notifier.h.html">&lt;linux/notifier.h&gt;</a></u></td></tr>
<tr><th id="42">42</th><td><u>#include <a href="../include/linux/memory.h.html">&lt;linux/memory.h&gt;</a></u></td></tr>
<tr><th id="43">43</th><td><u>#include <a href="../include/linux/printk.h.html">&lt;linux/printk.h&gt;</a></u></td></tr>
<tr><th id="44">44</th><td><u>#include <a href="../include/linux/userfaultfd_k.h.html">&lt;linux/userfaultfd_k.h&gt;</a></u></td></tr>
<tr><th id="45">45</th><td><u>#include <a href="../include/linux/moduleparam.h.html">&lt;linux/moduleparam.h&gt;</a></u></td></tr>
<tr><th id="46">46</th><td><u>#include <a href="../include/linux/pkeys.h.html">&lt;linux/pkeys.h&gt;</a></u></td></tr>
<tr><th id="47">47</th><td><u>#include <a href="../include/linux/oom.h.html">&lt;linux/oom.h&gt;</a></u></td></tr>
<tr><th id="48">48</th><td></td></tr>
<tr><th id="49">49</th><td><u>#include <a href="../include/linux/uaccess.h.html">&lt;linux/uaccess.h&gt;</a></u></td></tr>
<tr><th id="50">50</th><td><u>#include <a href="../arch/x86/include/asm/cacheflush.h.html">&lt;asm/cacheflush.h&gt;</a></u></td></tr>
<tr><th id="51">51</th><td><u>#include <a href="../arch/x86/include/asm/tlb.h.html">&lt;asm/tlb.h&gt;</a></u></td></tr>
<tr><th id="52">52</th><td><u>#include <a href="../arch/x86/include/asm/mmu_context.h.html">&lt;asm/mmu_context.h&gt;</a></u></td></tr>
<tr><th id="53">53</th><td></td></tr>
<tr><th id="54">54</th><td><u>#include <a href="internal.h.html">"internal.h"</a></u></td></tr>
<tr><th id="55">55</th><td></td></tr>
<tr><th id="56">56</th><td><u>#<span data-ppcond="56">ifndef</span> <span class="macro" data-ref="_M/arch_mmap_check">arch_mmap_check</span></u></td></tr>
<tr><th id="57">57</th><td><u>#define <dfn class="macro" id="_M/arch_mmap_check" data-ref="_M/arch_mmap_check">arch_mmap_check</dfn>(addr, len, flags)	(0)</u></td></tr>
<tr><th id="58">58</th><td><u>#<span data-ppcond="56">endif</span></u></td></tr>
<tr><th id="59">59</th><td></td></tr>
<tr><th id="60">60</th><td><u>#<span data-ppcond="60">ifdef</span> <a class="macro" href="../include/generated/autoconf.h.html#54" data-ref="_M/CONFIG_HAVE_ARCH_MMAP_RND_BITS">CONFIG_HAVE_ARCH_MMAP_RND_BITS</a></u></td></tr>
<tr><th id="61">61</th><td><em>const</em> <em>int</em> <dfn class="decl def" id="mmap_rnd_bits_min" title='mmap_rnd_bits_min' data-ref="mmap_rnd_bits_min">mmap_rnd_bits_min</dfn> = <a class="macro" href="../include/generated/autoconf.h.html#975" title="28" data-ref="_M/CONFIG_ARCH_MMAP_RND_BITS_MIN">CONFIG_ARCH_MMAP_RND_BITS_MIN</a>;</td></tr>
<tr><th id="62">62</th><td><em>const</em> <em>int</em> <dfn class="decl def" id="mmap_rnd_bits_max" title='mmap_rnd_bits_max' data-ref="mmap_rnd_bits_max">mmap_rnd_bits_max</dfn> = <a class="macro" href="../include/generated/autoconf.h.html#438" title="32" data-ref="_M/CONFIG_ARCH_MMAP_RND_BITS_MAX">CONFIG_ARCH_MMAP_RND_BITS_MAX</a>;</td></tr>
<tr><th id="63">63</th><td><em>int</em> <dfn class="decl def" id="mmap_rnd_bits" title='mmap_rnd_bits' data-ref="mmap_rnd_bits">mmap_rnd_bits</dfn> <a class="macro" href="../arch/x86/include/asm/cache.h.html#11" title="__attribute__((__section__(&quot;.data..read_mostly&quot;)))" data-ref="_M/__read_mostly">__read_mostly</a> = <a class="macro" href="../include/generated/autoconf.h.html#1040" title="28" data-ref="_M/CONFIG_ARCH_MMAP_RND_BITS">CONFIG_ARCH_MMAP_RND_BITS</a>;</td></tr>
<tr><th id="64">64</th><td><u>#<span data-ppcond="60">endif</span></u></td></tr>
<tr><th id="65">65</th><td><u>#<span data-ppcond="65">ifdef</span> <a class="macro" href="../include/generated/autoconf.h.html#1049" data-ref="_M/CONFIG_HAVE_ARCH_MMAP_RND_COMPAT_BITS">CONFIG_HAVE_ARCH_MMAP_RND_COMPAT_BITS</a></u></td></tr>
<tr><th id="66">66</th><td><em>const</em> <em>int</em> <dfn class="decl def" id="mmap_rnd_compat_bits_min" title='mmap_rnd_compat_bits_min' data-ref="mmap_rnd_compat_bits_min">mmap_rnd_compat_bits_min</dfn> = <a class="macro" href="../include/generated/autoconf.h.html#451" title="8" data-ref="_M/CONFIG_ARCH_MMAP_RND_COMPAT_BITS_MIN">CONFIG_ARCH_MMAP_RND_COMPAT_BITS_MIN</a>;</td></tr>
<tr><th id="67">67</th><td><em>const</em> <em>int</em> <dfn class="decl def" id="mmap_rnd_compat_bits_max" title='mmap_rnd_compat_bits_max' data-ref="mmap_rnd_compat_bits_max">mmap_rnd_compat_bits_max</dfn> = <a class="macro" href="../include/generated/autoconf.h.html#105" title="16" data-ref="_M/CONFIG_ARCH_MMAP_RND_COMPAT_BITS_MAX">CONFIG_ARCH_MMAP_RND_COMPAT_BITS_MAX</a>;</td></tr>
<tr><th id="68">68</th><td><em>int</em> <dfn class="decl def" id="mmap_rnd_compat_bits" title='mmap_rnd_compat_bits' data-ref="mmap_rnd_compat_bits">mmap_rnd_compat_bits</dfn> <a class="macro" href="../arch/x86/include/asm/cache.h.html#11" title="__attribute__((__section__(&quot;.data..read_mostly&quot;)))" data-ref="_M/__read_mostly">__read_mostly</a> = <a class="macro" href="../include/generated/autoconf.h.html#1273" title="8" data-ref="_M/CONFIG_ARCH_MMAP_RND_COMPAT_BITS">CONFIG_ARCH_MMAP_RND_COMPAT_BITS</a>;</td></tr>
<tr><th id="69">69</th><td><u>#<span data-ppcond="65">endif</span></u></td></tr>
<tr><th id="70">70</th><td></td></tr>
<tr><th id="71">71</th><td><em>static</em> <a class="typedef" href="../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="tu decl def" id="ignore_rlimit_data" title='ignore_rlimit_data' data-type='bool' data-ref="ignore_rlimit_data">ignore_rlimit_data</dfn>;</td></tr>
<tr><th id="72">72</th><td><a class="macro" href="../include/linux/moduleparam.h.html#270" title="static inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) bool __attribute__((unused)) *__check_ignore_rlimit_data(void) { return(&amp;(ignore_rlimit_data)); }; static const char __param_str_ignore_rlimit_data[] = &quot;&quot; &quot;ignore_rlimit_data&quot;; static struct kernel_param const __param_ignore_rlimit_data __attribute__((__used__)) __attribute__ ((unused,__section__ (&quot;__param&quot;),aligned(sizeof(void *)))) = { __param_str_ignore_rlimit_data, ((struct module *)0), &amp;param_ops_bool, ((sizeof(struct { int:(-!!((0644) &lt; 0)); })) + (sizeof(struct { int:(-!!((0644) &gt; 0777)); })) + (sizeof(struct { int:(-!!((((0644) &gt;&gt; 6) &amp; 4) &lt; (((0644) &gt;&gt; 3) &amp; 4))); })) + (sizeof(struct { int:(-!!((((0644) &gt;&gt; 3) &amp; 4) &lt; ((0644) &amp; 4))); })) + (sizeof(struct { int:(-!!((((0644) &gt;&gt; 6) &amp; 2) &lt; (((0644) &gt;&gt; 3) &amp; 2))); })) + (sizeof(struct { int:(-!!((0644) &amp; 2)); })) + (0644)), -1, 0, { &amp;ignore_rlimit_data } }" data-ref="_M/core_param">core_param</a>(ignore_rlimit_data, <a class="tu ref" href="#ignore_rlimit_data" title='ignore_rlimit_data' data-use='a' data-ref="ignore_rlimit_data">ignore_rlimit_data</a>, bool, <var>0644</var>);</td></tr>
<tr><th id="73">73</th><td></td></tr>
<tr><th id="74">74</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#unmap_region" title='unmap_region' data-type='void unmap_region(struct mm_struct * mm, struct vm_area_struct * vma, struct vm_area_struct * prev, unsigned long start, unsigned long end)' data-ref="unmap_region">unmap_region</a>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col1 decl" id="1mm" title='mm' data-type='struct mm_struct *' data-ref="1mm">mm</dfn>,</td></tr>
<tr><th id="75">75</th><td>		<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="2vma" title='vma' data-type='struct vm_area_struct *' data-ref="2vma">vma</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col3 decl" id="3prev" title='prev' data-type='struct vm_area_struct *' data-ref="3prev">prev</dfn>,</td></tr>
<tr><th id="76">76</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col4 decl" id="4start" title='start' data-type='unsigned long' data-ref="4start">start</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="5end" title='end' data-type='unsigned long' data-ref="5end">end</dfn>);</td></tr>
<tr><th id="77">77</th><td></td></tr>
<tr><th id="78">78</th><td><i>/* description of effects of mapping type and prot in current implementation.</i></td></tr>
<tr><th id="79">79</th><td><i> * this is due to the limited x86 page protection hardware.  The expected</i></td></tr>
<tr><th id="80">80</th><td><i> * behavior is in parens:</i></td></tr>
<tr><th id="81">81</th><td><i> *</i></td></tr>
<tr><th id="82">82</th><td><i> * map_type	prot</i></td></tr>
<tr><th id="83">83</th><td><i> *		PROT_NONE	PROT_READ	PROT_WRITE	PROT_EXEC</i></td></tr>
<tr><th id="84">84</th><td><i> * MAP_SHARED	r: (no) no	r: (yes) yes	r: (no) yes	r: (no) yes</i></td></tr>
<tr><th id="85">85</th><td><i> *		w: (no) no	w: (no) no	w: (yes) yes	w: (no) no</i></td></tr>
<tr><th id="86">86</th><td><i> *		x: (no) no	x: (no) yes	x: (no) yes	x: (yes) yes</i></td></tr>
<tr><th id="87">87</th><td><i> *</i></td></tr>
<tr><th id="88">88</th><td><i> * MAP_PRIVATE	r: (no) no	r: (yes) yes	r: (no) yes	r: (no) yes</i></td></tr>
<tr><th id="89">89</th><td><i> *		w: (no) no	w: (no) no	w: (copy) copy	w: (no) no</i></td></tr>
<tr><th id="90">90</th><td><i> *		x: (no) no	x: (no) yes	x: (no) yes	x: (yes) yes</i></td></tr>
<tr><th id="91">91</th><td><i> *</i></td></tr>
<tr><th id="92">92</th><td><i> * On arm64, PROT_EXEC has the following behaviour for both MAP_SHARED and</i></td></tr>
<tr><th id="93">93</th><td><i> * MAP_PRIVATE:</i></td></tr>
<tr><th id="94">94</th><td><i> *								r: (no) no</i></td></tr>
<tr><th id="95">95</th><td><i> *								w: (no) no</i></td></tr>
<tr><th id="96">96</th><td><i> *								x: (yes) yes</i></td></tr>
<tr><th id="97">97</th><td><i> */</i></td></tr>
<tr><th id="98">98</th><td><a class="typedef" href="../arch/x86/include/asm/pgtable_types.h.html#pgprot_t" title='pgprot_t' data-type='struct pgprot' data-ref="pgprot_t">pgprot_t</a> <dfn class="decl def" id="protection_map" title='protection_map' data-ref="protection_map">protection_map</dfn>[<var>16</var>] <a class="macro" href="../include/linux/cache.h.html#31" title="__attribute__((__section__(&quot;.data..ro_after_init&quot;)))" data-ref="_M/__ro_after_init">__ro_after_init</a> = {</td></tr>
<tr><th id="99">99</th><td>	<a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#218" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 8) | (((pteval_t)(1)) &lt;&lt; 5)) } )" data-ref="_M/__P000">__P000</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#219" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5) | (((pteval_t)(1)) &lt;&lt; 63)) } )" data-ref="_M/__P001">__P001</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#220" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5) | (((pteval_t)(1)) &lt;&lt; 63)) } )" data-ref="_M/__P010">__P010</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#221" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5) | (((pteval_t)(1)) &lt;&lt; 63)) } )" data-ref="_M/__P011">__P011</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#222" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5)) } )" data-ref="_M/__P100">__P100</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#223" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5)) } )" data-ref="_M/__P101">__P101</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#224" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5)) } )" data-ref="_M/__P110">__P110</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#225" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5)) } )" data-ref="_M/__P111">__P111</a>,</td></tr>
<tr><th id="100">100</th><td>	<a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#227" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 8) | (((pteval_t)(1)) &lt;&lt; 5)) } )" data-ref="_M/__S000">__S000</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#228" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5) | (((pteval_t)(1)) &lt;&lt; 63)) } )" data-ref="_M/__S001">__S001</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#229" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 1) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5) | (((pteval_t)(1)) &lt;&lt; 63)) } )" data-ref="_M/__S010">__S010</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#230" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 1) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5) | (((pteval_t)(1)) &lt;&lt; 63)) } )" data-ref="_M/__S011">__S011</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#231" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5)) } )" data-ref="_M/__S100">__S100</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#232" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5)) } )" data-ref="_M/__S101">__S101</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#233" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 1) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5)) } )" data-ref="_M/__S110">__S110</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#234" title="((pgprot_t) { ((((pteval_t)(1)) &lt;&lt; 0) | (((pteval_t)(1)) &lt;&lt; 1) | (((pteval_t)(1)) &lt;&lt; 2) | (((pteval_t)(1)) &lt;&lt; 5)) } )" data-ref="_M/__S111">__S111</a></td></tr>
<tr><th id="101">101</th><td>};</td></tr>
<tr><th id="102">102</th><td></td></tr>
<tr><th id="103">103</th><td><a class="typedef" href="../arch/x86/include/asm/pgtable_types.h.html#pgprot_t" title='pgprot_t' data-type='struct pgprot' data-ref="pgprot_t">pgprot_t</a> <dfn class="decl def fn" id="vm_get_page_prot" title='vm_get_page_prot' data-ref="vm_get_page_prot">vm_get_page_prot</dfn>(<em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="6vm_flags" title='vm_flags' data-type='unsigned long' data-ref="6vm_flags">vm_flags</dfn>)</td></tr>
<tr><th id="104">104</th><td>{</td></tr>
<tr><th id="105">105</th><td>	<b>return</b> <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#431" title="((pgprot_t) { (((protection_map[vm_flags &amp; (0x00000001|0x00000002|0x00000004|0x00000008)]).pgprot) | ((((pgprot_t) { (((vm_flags) &amp; (1UL &lt;&lt; (32)) ? (((pteval_t)(1)) &lt;&lt; 59) : 0) | ((vm_flags) &amp; (1UL &lt;&lt; (33)) ? (((pteval_t)(1)) &lt;&lt; 60) : 0) | ((vm_flags) &amp; (1UL &lt;&lt; (34)) ? (((pteval_t)(1)) &lt;&lt; 61) : 0) | ((vm_flags) &amp; (1UL &lt;&lt; (35)) ? (((pteval_t)(1)) &lt;&lt; 62) : 0)) } )).pgprot)) } )" data-ref="_M/__pgprot">__pgprot</a>(<a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#430" title="((protection_map[vm_flags &amp; (0x00000001|0x00000002|0x00000004|0x00000008)]).pgprot)" data-ref="_M/pgprot_val">pgprot_val</a>(<a class="ref" href="../include/linux/mm.h.html#protection_map" title='protection_map' data-ref="protection_map">protection_map</a>[<a class="local col6 ref" href="#6vm_flags" title='vm_flags' data-ref="6vm_flags">vm_flags</a> &amp;</td></tr>
<tr><th id="106">106</th><td>				(<a class="macro" href="../include/linux/mm.h.html#163" title="0x00000001" data-ref="_M/VM_READ">VM_READ</a>|<a class="macro" href="../include/linux/mm.h.html#164" title="0x00000002" data-ref="_M/VM_WRITE">VM_WRITE</a>|<a class="macro" href="../include/linux/mm.h.html#165" title="0x00000004" data-ref="_M/VM_EXEC">VM_EXEC</a>|<a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a>)]) |</td></tr>
<tr><th id="107">107</th><td>			<a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#430" title="((((pgprot_t) { (((vm_flags) &amp; (1UL &lt;&lt; (32)) ? (((pteval_t)(1)) &lt;&lt; 59) : 0) | ((vm_flags) &amp; (1UL &lt;&lt; (33)) ? (((pteval_t)(1)) &lt;&lt; 60) : 0) | ((vm_flags) &amp; (1UL &lt;&lt; (34)) ? (((pteval_t)(1)) &lt;&lt; 61) : 0) | ((vm_flags) &amp; (1UL &lt;&lt; (35)) ? (((pteval_t)(1)) &lt;&lt; 62) : 0)) } )).pgprot)" data-ref="_M/pgprot_val">pgprot_val</a>(<a class="macro" href="../arch/x86/include/uapi/asm/mman.h.html#16" title="((pgprot_t) { (((vm_flags) &amp; (1UL &lt;&lt; (32)) ? (((pteval_t)(1)) &lt;&lt; 59) : 0) | ((vm_flags) &amp; (1UL &lt;&lt; (33)) ? (((pteval_t)(1)) &lt;&lt; 60) : 0) | ((vm_flags) &amp; (1UL &lt;&lt; (34)) ? (((pteval_t)(1)) &lt;&lt; 61) : 0) | ((vm_flags) &amp; (1UL &lt;&lt; (35)) ? (((pteval_t)(1)) &lt;&lt; 62) : 0)) } )" data-ref="_M/arch_vm_get_page_prot">arch_vm_get_page_prot</a>(<a class="local col6 ref" href="#6vm_flags" title='vm_flags' data-ref="6vm_flags">vm_flags</a>)));</td></tr>
<tr><th id="108">108</th><td>}</td></tr>
<tr><th id="109">109</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(vm_get_page_prot) vm_get_page_prot; static const char __kstrtab_vm_get_page_prot[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vm_get_page_prot&quot;; static const struct kernel_symbol __ksymtab_vm_get_page_prot __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vm_get_page_prot&quot;), used)) = { (unsigned long)&amp;vm_get_page_prot, __kstrtab_vm_get_page_prot }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vm_get_page_prot" title='vm_get_page_prot' data-ref="vm_get_page_prot"><a class="ref fn" href="#vm_get_page_prot" title='vm_get_page_prot' data-ref="vm_get_page_prot"><a class="ref fn" href="#vm_get_page_prot" title='vm_get_page_prot' data-ref="vm_get_page_prot"><a class="ref fn" href="#vm_get_page_prot" title='vm_get_page_prot' data-ref="vm_get_page_prot">vm_get_page_prot</a></a></a></a>);</td></tr>
<tr><th id="110">110</th><td></td></tr>
<tr><th id="111">111</th><td><em>static</em> <a class="typedef" href="../arch/x86/include/asm/pgtable_types.h.html#pgprot_t" title='pgprot_t' data-type='struct pgprot' data-ref="pgprot_t">pgprot_t</a> <dfn class="tu decl def fn" id="vm_pgprot_modify" title='vm_pgprot_modify' data-type='pgprot_t vm_pgprot_modify(pgprot_t oldprot, unsigned long vm_flags)' data-ref="vm_pgprot_modify">vm_pgprot_modify</dfn>(<a class="typedef" href="../arch/x86/include/asm/pgtable_types.h.html#pgprot_t" title='pgprot_t' data-type='struct pgprot' data-ref="pgprot_t">pgprot_t</a> <dfn class="local col7 decl" id="7oldprot" title='oldprot' data-type='pgprot_t' data-ref="7oldprot">oldprot</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="8vm_flags" title='vm_flags' data-type='unsigned long' data-ref="8vm_flags">vm_flags</dfn>)</td></tr>
<tr><th id="112">112</th><td>{</td></tr>
<tr><th id="113">113</th><td>	<b>return</b> <a class="macro" href="../arch/x86/include/asm/pgtable.h.html#572" title="pgprot_modify" data-ref="_M/pgprot_modify">pgprot_modify</a>(<a class="local col7 ref" href="#7oldprot" title='oldprot' data-ref="7oldprot">oldprot</a>, <a class="ref fn" href="#vm_get_page_prot" title='vm_get_page_prot' data-ref="vm_get_page_prot">vm_get_page_prot</a>(<a class="local col8 ref" href="#8vm_flags" title='vm_flags' data-ref="8vm_flags">vm_flags</a>));</td></tr>
<tr><th id="114">114</th><td>}</td></tr>
<tr><th id="115">115</th><td></td></tr>
<tr><th id="116">116</th><td><i>/* Update vma-&gt;vm_page_prot to reflect vma-&gt;vm_flags. */</i></td></tr>
<tr><th id="117">117</th><td><em>void</em> <dfn class="decl def fn" id="vma_set_page_prot" title='vma_set_page_prot' data-ref="vma_set_page_prot">vma_set_page_prot</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col9 decl" id="9vma" title='vma' data-type='struct vm_area_struct *' data-ref="9vma">vma</dfn>)</td></tr>
<tr><th id="118">118</th><td>{</td></tr>
<tr><th id="119">119</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="10vm_flags" title='vm_flags' data-type='unsigned long' data-ref="10vm_flags">vm_flags</dfn> = <a class="local col9 ref" href="#9vma" title='vma' data-ref="9vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a>;</td></tr>
<tr><th id="120">120</th><td>	<a class="typedef" href="../arch/x86/include/asm/pgtable_types.h.html#pgprot_t" title='pgprot_t' data-type='struct pgprot' data-ref="pgprot_t">pgprot_t</a> <dfn class="local col1 decl" id="11vm_page_prot" title='vm_page_prot' data-type='pgprot_t' data-ref="11vm_page_prot">vm_page_prot</dfn>;</td></tr>
<tr><th id="121">121</th><td></td></tr>
<tr><th id="122">122</th><td>	<a class="local col1 ref" href="#11vm_page_prot" title='vm_page_prot' data-ref="11vm_page_prot">vm_page_prot</a> = <a class="tu ref fn" href="#vm_pgprot_modify" title='vm_pgprot_modify' data-use='c' data-ref="vm_pgprot_modify">vm_pgprot_modify</a>(<a class="local col9 ref" href="#9vma" title='vma' data-ref="9vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_page_prot" title='vm_area_struct::vm_page_prot' data-ref="vm_area_struct::vm_page_prot">vm_page_prot</a>, <a class="local col0 ref" href="#10vm_flags" title='vm_flags' data-ref="10vm_flags">vm_flags</a>);</td></tr>
<tr><th id="123">123</th><td>	<b>if</b> (<a class="ref fn" href="#vma_wants_writenotify" title='vma_wants_writenotify' data-ref="vma_wants_writenotify">vma_wants_writenotify</a>(<a class="local col9 ref" href="#9vma" title='vma' data-ref="9vma">vma</a>, <a class="local col1 ref" href="#11vm_page_prot" title='vm_page_prot' data-ref="11vm_page_prot">vm_page_prot</a>)) {</td></tr>
<tr><th id="124">124</th><td>		<a class="local col0 ref" href="#10vm_flags" title='vm_flags' data-ref="10vm_flags">vm_flags</a> &amp;= ~<a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a>;</td></tr>
<tr><th id="125">125</th><td>		<a class="local col1 ref" href="#11vm_page_prot" title='vm_page_prot' data-ref="11vm_page_prot">vm_page_prot</a> = <a class="tu ref fn" href="#vm_pgprot_modify" title='vm_pgprot_modify' data-use='c' data-ref="vm_pgprot_modify">vm_pgprot_modify</a>(<a class="local col1 ref" href="#11vm_page_prot" title='vm_page_prot' data-ref="11vm_page_prot">vm_page_prot</a>, <a class="local col0 ref" href="#10vm_flags" title='vm_flags' data-ref="10vm_flags">vm_flags</a>);</td></tr>
<tr><th id="126">126</th><td>	}</td></tr>
<tr><th id="127">127</th><td>	<i>/* remove_protection_ptes reads vma-&gt;vm_page_prot without mmap_sem */</i></td></tr>
<tr><th id="128">128</th><td>	<a class="macro" href="../include/linux/compiler.h.html#262" title="({ union { typeof(vma-&gt;vm_page_prot) __val; char __c[1]; } __u = { .__val = ( typeof(vma-&gt;vm_page_prot)) (vm_page_prot) }; __write_once_size(&amp;(vma-&gt;vm_page_prot), __u.__c, sizeof(vma-&gt;vm_page_prot)); __u.__val; })" data-ref="_M/WRITE_ONCE">WRITE_ONCE</a>(<a class="local col9 ref" href="#9vma" title='vma' data-ref="9vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_page_prot" title='vm_area_struct::vm_page_prot' data-ref="vm_area_struct::vm_page_prot">vm_page_prot</a>, <a class="local col1 ref" href="#11vm_page_prot" title='vm_page_prot' data-ref="11vm_page_prot">vm_page_prot</a>);</td></tr>
<tr><th id="129">129</th><td>}</td></tr>
<tr><th id="130">130</th><td></td></tr>
<tr><th id="131">131</th><td><i  data-doc="__remove_shared_vm_struct">/*</i></td></tr>
<tr><th id="132">132</th><td><i  data-doc="__remove_shared_vm_struct"> * Requires inode-&gt;i_mapping-&gt;i_mmap_rwsem</i></td></tr>
<tr><th id="133">133</th><td><i  data-doc="__remove_shared_vm_struct"> */</i></td></tr>
<tr><th id="134">134</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="__remove_shared_vm_struct" title='__remove_shared_vm_struct' data-type='void __remove_shared_vm_struct(struct vm_area_struct * vma, struct file * file, struct address_space * mapping)' data-ref="__remove_shared_vm_struct">__remove_shared_vm_struct</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="12vma" title='vma' data-type='struct vm_area_struct *' data-ref="12vma">vma</dfn>,</td></tr>
<tr><th id="135">135</th><td>		<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col3 decl" id="13file" title='file' data-type='struct file *' data-ref="13file">file</dfn>, <b>struct</b> <a class="type" href="../include/linux/fs.h.html#address_space" title='address_space' data-ref="address_space">address_space</a> *<dfn class="local col4 decl" id="14mapping" title='mapping' data-type='struct address_space *' data-ref="14mapping">mapping</dfn>)</td></tr>
<tr><th id="136">136</th><td>{</td></tr>
<tr><th id="137">137</th><td>	<b>if</b> (<a class="local col2 ref" href="#12vma" title='vma' data-ref="12vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#177" title="0x00000800" data-ref="_M/VM_DENYWRITE">VM_DENYWRITE</a>)</td></tr>
<tr><th id="138">138</th><td>		<a class="ref fn" href="../arch/x86/include/asm/atomic.h.html#atomic_inc" title='atomic_inc' data-ref="atomic_inc">atomic_inc</a>(&amp;<a class="ref fn" href="../include/linux/fs.h.html#file_inode" title='file_inode' data-ref="file_inode">file_inode</a>(<a class="local col3 ref" href="#13file" title='file' data-ref="13file">file</a>)-&gt;<a class="ref field" href="../include/linux/fs.h.html#inode::i_writecount" title='inode::i_writecount' data-ref="inode::i_writecount">i_writecount</a>);</td></tr>
<tr><th id="139">139</th><td>	<b>if</b> (<a class="local col2 ref" href="#12vma" title='vma' data-ref="12vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a>)</td></tr>
<tr><th id="140">140</th><td>		<a class="ref fn" href="../include/linux/fs.h.html#mapping_unmap_writable" title='mapping_unmap_writable' data-ref="mapping_unmap_writable">mapping_unmap_writable</a>(<a class="local col4 ref" href="#14mapping" title='mapping' data-ref="14mapping">mapping</a>);</td></tr>
<tr><th id="141">141</th><td></td></tr>
<tr><th id="142">142</th><td>	<a class="macro" href="../include/asm-generic/cacheflush.h.html#19" title="do { } while (0)" data-ref="_M/flush_dcache_mmap_lock">flush_dcache_mmap_lock</a>(mapping);</td></tr>
<tr><th id="143">143</th><td>	<a class="ref fn" href="../include/linux/mm.h.html#vma_interval_tree_remove" title='vma_interval_tree_remove' data-ref="vma_interval_tree_remove">vma_interval_tree_remove</a>(<a class="local col2 ref" href="#12vma" title='vma' data-ref="12vma">vma</a>, &amp;<a class="local col4 ref" href="#14mapping" title='mapping' data-ref="14mapping">mapping</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#address_space::i_mmap" title='address_space::i_mmap' data-ref="address_space::i_mmap">i_mmap</a>);</td></tr>
<tr><th id="144">144</th><td>	<a class="macro" href="../include/asm-generic/cacheflush.h.html#20" title="do { } while (0)" data-ref="_M/flush_dcache_mmap_unlock">flush_dcache_mmap_unlock</a>(mapping);</td></tr>
<tr><th id="145">145</th><td>}</td></tr>
<tr><th id="146">146</th><td></td></tr>
<tr><th id="147">147</th><td><i>/*</i></td></tr>
<tr><th id="148">148</th><td><i> * Unlink a file-based vm structure from its interval tree, to hide</i></td></tr>
<tr><th id="149">149</th><td><i> * vma from rmap and vmtruncate before freeing its page tables.</i></td></tr>
<tr><th id="150">150</th><td><i> */</i></td></tr>
<tr><th id="151">151</th><td><em>void</em> <dfn class="decl def fn" id="unlink_file_vma" title='unlink_file_vma' data-ref="unlink_file_vma">unlink_file_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col5 decl" id="15vma" title='vma' data-type='struct vm_area_struct *' data-ref="15vma">vma</dfn>)</td></tr>
<tr><th id="152">152</th><td>{</td></tr>
<tr><th id="153">153</th><td>	<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col6 decl" id="16file" title='file' data-type='struct file *' data-ref="16file">file</dfn> = <a class="local col5 ref" href="#15vma" title='vma' data-ref="15vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>;</td></tr>
<tr><th id="154">154</th><td></td></tr>
<tr><th id="155">155</th><td>	<b>if</b> (<a class="local col6 ref" href="#16file" title='file' data-ref="16file">file</a>) {</td></tr>
<tr><th id="156">156</th><td>		<b>struct</b> <a class="type" href="../include/linux/fs.h.html#address_space" title='address_space' data-ref="address_space">address_space</a> *<dfn class="local col7 decl" id="17mapping" title='mapping' data-type='struct address_space *' data-ref="17mapping">mapping</dfn> = <a class="local col6 ref" href="#16file" title='file' data-ref="16file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a>;</td></tr>
<tr><th id="157">157</th><td>		<a class="ref fn" href="../include/linux/fs.h.html#i_mmap_lock_write" title='i_mmap_lock_write' data-ref="i_mmap_lock_write">i_mmap_lock_write</a>(<a class="local col7 ref" href="#17mapping" title='mapping' data-ref="17mapping">mapping</a>);</td></tr>
<tr><th id="158">158</th><td>		<a class="tu ref fn" href="#__remove_shared_vm_struct" title='__remove_shared_vm_struct' data-use='c' data-ref="__remove_shared_vm_struct">__remove_shared_vm_struct</a>(<a class="local col5 ref" href="#15vma" title='vma' data-ref="15vma">vma</a>, <a class="local col6 ref" href="#16file" title='file' data-ref="16file">file</a>, <a class="local col7 ref" href="#17mapping" title='mapping' data-ref="17mapping">mapping</a>);</td></tr>
<tr><th id="159">159</th><td>		<a class="ref fn" href="../include/linux/fs.h.html#i_mmap_unlock_write" title='i_mmap_unlock_write' data-ref="i_mmap_unlock_write">i_mmap_unlock_write</a>(<a class="local col7 ref" href="#17mapping" title='mapping' data-ref="17mapping">mapping</a>);</td></tr>
<tr><th id="160">160</th><td>	}</td></tr>
<tr><th id="161">161</th><td>}</td></tr>
<tr><th id="162">162</th><td></td></tr>
<tr><th id="163">163</th><td><i  data-doc="remove_vma">/*</i></td></tr>
<tr><th id="164">164</th><td><i  data-doc="remove_vma"> * Close a vm structure and free it, returning the next.</i></td></tr>
<tr><th id="165">165</th><td><i  data-doc="remove_vma"> */</i></td></tr>
<tr><th id="166">166</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="tu decl def fn" id="remove_vma" title='remove_vma' data-type='struct vm_area_struct * remove_vma(struct vm_area_struct * vma)' data-ref="remove_vma">remove_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col8 decl" id="18vma" title='vma' data-type='struct vm_area_struct *' data-ref="18vma">vma</dfn>)</td></tr>
<tr><th id="167">167</th><td>{</td></tr>
<tr><th id="168">168</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col9 decl" id="19next" title='next' data-type='struct vm_area_struct *' data-ref="19next">next</dfn> = <a class="local col8 ref" href="#18vma" title='vma' data-ref="18vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>;</td></tr>
<tr><th id="169">169</th><td></td></tr>
<tr><th id="170">170</th><td>	<a class="macro" href="../include/linux/kernel.h.html#234" title="do { do { } while (0); } while (0)" data-ref="_M/might_sleep">might_sleep</a>();</td></tr>
<tr><th id="171">171</th><td>	<b>if</b> (<a class="local col8 ref" href="#18vma" title='vma' data-ref="18vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a> &amp;&amp; <a class="local col8 ref" href="#18vma" title='vma' data-ref="18vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::close" title='vm_operations_struct::close' data-ref="vm_operations_struct::close">close</a>)</td></tr>
<tr><th id="172">172</th><td>		<a class="local col8 ref" href="#18vma" title='vma' data-ref="18vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::close" title='vm_operations_struct::close' data-ref="vm_operations_struct::close">close</a>(<a class="local col8 ref" href="#18vma" title='vma' data-ref="18vma">vma</a>);</td></tr>
<tr><th id="173">173</th><td>	<b>if</b> (<a class="local col8 ref" href="#18vma" title='vma' data-ref="18vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>)</td></tr>
<tr><th id="174">174</th><td>		<a class="ref fn" href="../include/linux/file.h.html#fput" title='fput' data-ref="fput">fput</a>(<a class="local col8 ref" href="#18vma" title='vma' data-ref="18vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>);</td></tr>
<tr><th id="175">175</th><td>	<a class="ref fn" href="../include/linux/mempolicy.h.html#mpol_put" title='mpol_put' data-ref="mpol_put">mpol_put</a>(<a class="macro" href="../include/linux/mempolicy.h.html#246" title="((void *)0)" data-ref="_M/vma_policy">vma_policy</a>(vma));</td></tr>
<tr><th id="176">176</th><td>	<a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_free" title='kmem_cache_free' data-ref="kmem_cache_free">kmem_cache_free</a>(<a class="ref" href="../include/linux/mm.h.html#vm_area_cachep" title='vm_area_cachep' data-ref="vm_area_cachep">vm_area_cachep</a>, <a class="local col8 ref" href="#18vma" title='vma' data-ref="18vma">vma</a>);</td></tr>
<tr><th id="177">177</th><td>	<b>return</b> <a class="local col9 ref" href="#19next" title='next' data-ref="19next">next</a>;</td></tr>
<tr><th id="178">178</th><td>}</td></tr>
<tr><th id="179">179</th><td></td></tr>
<tr><th id="180">180</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#do_brk_flags" title='do_brk_flags' data-type='int do_brk_flags(unsigned long addr, unsigned long request, unsigned long flags, struct list_head * uf)' data-ref="do_brk_flags">do_brk_flags</a>(<em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="20addr" title='addr' data-type='unsigned long' data-ref="20addr">addr</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col1 decl" id="21request" title='request' data-type='unsigned long' data-ref="21request">request</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col2 decl" id="22flags" title='flags' data-type='unsigned long' data-ref="22flags">flags</dfn>,</td></tr>
<tr><th id="181">181</th><td>		<b>struct</b> <a class="type" href="../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a> *<dfn class="local col3 decl" id="23uf" title='uf' data-type='struct list_head *' data-ref="23uf">uf</dfn>);</td></tr>
<tr><th id="182">182</th><td><a class="macro" href="../include/linux/syscalls.h.html#196" title="static const char *types__brk[] = { &quot;unsigned long&quot; }; static const char *args__brk[] = { &quot;brk&quot; }; static struct syscall_metadata __syscall_meta__brk; static struct trace_event_call __attribute__((__used__)) event_enter__brk = { .class = &amp;event_class_syscall_enter, { .name = &quot;sys_enter&quot;&quot;_brk&quot;, }, .event.funcs = &amp;enter_syscall_print_funcs, .data = (void *)&amp;__syscall_meta__brk, .flags = TRACE_EVENT_FL_CAP_ANY, }; static struct trace_event_call __attribute__((__used__)) __attribute__((section(&quot;_ftrace_events&quot;))) *__event_enter__brk = &amp;event_enter__brk;; static struct syscall_metadata __syscall_meta__brk; static struct trace_event_call __attribute__((__used__)) event_exit__brk = { .class = &amp;event_class_syscall_exit, { .name = &quot;sys_exit&quot;&quot;_brk&quot;, }, .event.funcs = &amp;exit_syscall_print_funcs, .data = (void *)&amp;__syscall_meta__brk, .flags = TRACE_EVENT_FL_CAP_ANY, }; static struct trace_event_call __attribute__((__used__)) __attribute__((section(&quot;_ftrace_events&quot;))) *__event_exit__brk = &amp;event_exit__brk;; static struct syscall_metadata __attribute__((__used__)) __syscall_meta__brk = { .name = &quot;sys&quot;&quot;_brk&quot;, .syscall_nr = -1, .nb_args = 1, .types = 1 ? types__brk : ((void *)0), .args = 1 ? args__brk : ((void *)0), .enter_event = &amp;event_enter__brk, .exit_event = &amp;event_exit__brk, .enter_fields = { &amp;(__syscall_meta__brk.enter_fields), &amp;(__syscall_meta__brk.enter_fields) }, }; static struct syscall_metadata __attribute__((__used__)) __attribute__((section(&quot;__syscalls_metadata&quot;))) *__p_syscall_meta__brk = &amp;__syscall_meta__brk; long sys_brk(unsigned long brk) __attribute__((alias(&quot;SyS_brk&quot;))); static inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) long SYSC_brk(unsigned long brk); long SyS_brk(__typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) brk); long SyS_brk(__typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) brk) { long ret = SYSC_brk(( unsigned long) brk); (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })); do { } while (0); return ret; } static inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) long SYSC_brk(unsigned long brk)" data-ref="_M/SYSCALL_DEFINE1">SYSCALL_DEFINE1</a>(brk, <em>unsigned</em> <em>long</em>, <dfn class="local col4 decl" id="24brk" title='brk' data-type='unsigned long' data-ref="24brk"><dfn class="local col5 decl" id="25brk" title='brk' data-type='unsigned long' data-ref="25brk"><dfn class="local col6 decl" id="26brk" title='brk' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="26brk"><dfn class="local col7 decl" id="27brk" title='brk' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="27brk"><a class="local col7 ref" href="#182" title='brk' data-ref="27brk"><dfn class="local col8 decl" id="28brk" title='brk' data-type='unsigned long' data-ref="28brk">brk</dfn></a></dfn></dfn></dfn></dfn>)</td></tr>
<tr><th id="183">183</th><td>{</td></tr>
<tr><th id="184">184</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="29retval" title='retval' data-type='unsigned long' data-ref="29retval">retval</dfn>;</td></tr>
<tr><th id="185">185</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="30newbrk" title='newbrk' data-type='unsigned long' data-ref="30newbrk">newbrk</dfn>, <dfn class="local col1 decl" id="31oldbrk" title='oldbrk' data-type='unsigned long' data-ref="31oldbrk">oldbrk</dfn>;</td></tr>
<tr><th id="186">186</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col2 decl" id="32mm" title='mm' data-type='struct mm_struct *' data-ref="32mm">mm</dfn> = <a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::mm" title='task_struct::mm' data-ref="task_struct::mm">mm</a>;</td></tr>
<tr><th id="187">187</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col3 decl" id="33next" title='next' data-type='struct vm_area_struct *' data-ref="33next">next</dfn>;</td></tr>
<tr><th id="188">188</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col4 decl" id="34min_brk" title='min_brk' data-type='unsigned long' data-ref="34min_brk">min_brk</dfn>;</td></tr>
<tr><th id="189">189</th><td>	<a class="typedef" href="../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="local col5 decl" id="35populate" title='populate' data-type='bool' data-ref="35populate">populate</dfn>;</td></tr>
<tr><th id="190">190</th><td>	<a class="macro" href="../include/linux/list.h.html#23" title="struct list_head uf = { &amp;(uf), &amp;(uf) }" data-ref="_M/LIST_HEAD">LIST_HEAD</a>(<dfn class="local col6 decl" id="36uf" title='uf' data-type='struct list_head' data-ref="36uf"><a class="local col6 ref" href="#190" title='uf' data-ref="36uf"><a class="local col6 ref" href="#190" title='uf' data-ref="36uf"><a class="local col6 ref" href="#190" title='uf' data-ref="36uf"><a class="local col6 ref" href="#190" title='uf' data-ref="36uf">uf</a></a></a></a></dfn>);</td></tr>
<tr><th id="191">191</th><td></td></tr>
<tr><th id="192">192</th><td>	<b>if</b> (<a class="ref fn" href="../include/linux/rwsem.h.html#down_write_killable" title='down_write_killable' data-ref="down_write_killable">down_write_killable</a>(&amp;<a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>))</td></tr>
<tr><th id="193">193</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#8" title="4" data-ref="_M/EINTR">EINTR</a>;</td></tr>
<tr><th id="194">194</th><td></td></tr>
<tr><th id="195">195</th><td><u>#<span data-ppcond="195">ifdef</span> <a class="macro" href="../include/generated/autoconf.h.html#893" data-ref="_M/CONFIG_COMPAT_BRK">CONFIG_COMPAT_BRK</a></u></td></tr>
<tr><th id="196">196</th><td>	<i>/*</i></td></tr>
<tr><th id="197">197</th><td><i>	 * CONFIG_COMPAT_BRK can still be overridden by setting</i></td></tr>
<tr><th id="198">198</th><td><i>	 * randomize_va_space to 2, which will still cause mm-&gt;start_brk</i></td></tr>
<tr><th id="199">199</th><td><i>	 * to be arbitrarily shifted</i></td></tr>
<tr><th id="200">200</th><td><i>	 */</i></td></tr>
<tr><th id="201">201</th><td>	<b>if</b> (<a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::brk_randomized" title='task_struct::brk_randomized' data-ref="task_struct::brk_randomized">brk_randomized</a>)</td></tr>
<tr><th id="202">202</th><td>		<a class="local col4 ref" href="#34min_brk" title='min_brk' data-ref="34min_brk">min_brk</a> = <a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::start_brk" title='mm_struct::start_brk' data-ref="mm_struct::start_brk">start_brk</a>;</td></tr>
<tr><th id="203">203</th><td>	<b>else</b></td></tr>
<tr><th id="204">204</th><td>		<a class="local col4 ref" href="#34min_brk" title='min_brk' data-ref="34min_brk">min_brk</a> = <a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::end_data" title='mm_struct::end_data' data-ref="mm_struct::end_data">end_data</a>;</td></tr>
<tr><th id="205">205</th><td><u>#<span data-ppcond="195">else</span></u></td></tr>
<tr><th id="206">206</th><td>	min_brk = mm-&gt;start_brk;</td></tr>
<tr><th id="207">207</th><td><u>#<span data-ppcond="195">endif</span></u></td></tr>
<tr><th id="208">208</th><td>	<b>if</b> (<a class="local col8 ref" href="#182" title='brk' data-ref="28brk">brk</a> &lt; <a class="local col4 ref" href="#34min_brk" title='min_brk' data-ref="34min_brk">min_brk</a>)</td></tr>
<tr><th id="209">209</th><td>		<b>goto</b> <a class="lbl" href="#37out" data-ref="37out">out</a>;</td></tr>
<tr><th id="210">210</th><td></td></tr>
<tr><th id="211">211</th><td>	<i>/*</i></td></tr>
<tr><th id="212">212</th><td><i>	 * Check against rlimit here. If this check is done later after the test</i></td></tr>
<tr><th id="213">213</th><td><i>	 * of oldbrk with newbrk then it can escape the test and let the data</i></td></tr>
<tr><th id="214">214</th><td><i>	 * segment grow beyond its set limit the in case where the limit is</i></td></tr>
<tr><th id="215">215</th><td><i>	 * not page aligned -Ram Gupta</i></td></tr>
<tr><th id="216">216</th><td><i>	 */</i></td></tr>
<tr><th id="217">217</th><td>	<b>if</b> (<a class="ref fn" href="../include/linux/mm.h.html#check_data_rlimit" title='check_data_rlimit' data-ref="check_data_rlimit">check_data_rlimit</a>(<a class="ref fn" href="../include/linux/sched/signal.h.html#rlimit" title='rlimit' data-ref="rlimit">rlimit</a>(<a class="macro" href="../include/uapi/asm-generic/resource.h.html#18" title="2" data-ref="_M/RLIMIT_DATA">RLIMIT_DATA</a>), <a class="local col8 ref" href="#182" title='brk' data-ref="28brk">brk</a>, <a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::start_brk" title='mm_struct::start_brk' data-ref="mm_struct::start_brk">start_brk</a>,</td></tr>
<tr><th id="218">218</th><td>			      <a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::end_data" title='mm_struct::end_data' data-ref="mm_struct::end_data">end_data</a>, <a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::start_data" title='mm_struct::start_data' data-ref="mm_struct::start_data">start_data</a>))</td></tr>
<tr><th id="219">219</th><td>		<b>goto</b> <a class="lbl" href="#37out" data-ref="37out">out</a>;</td></tr>
<tr><th id="220">220</th><td></td></tr>
<tr><th id="221">221</th><td>	<a class="local col0 ref" href="#30newbrk" title='newbrk' data-ref="30newbrk">newbrk</a> = <a class="macro" href="../include/linux/mm.h.html#134" title="((((brk)) + ((typeof((brk)))((((1UL) &lt;&lt; 12))) - 1)) &amp; ~((typeof((brk)))((((1UL) &lt;&lt; 12))) - 1))" data-ref="_M/PAGE_ALIGN">PAGE_ALIGN</a>(<a class="local col8 ref" href="#182" title='brk' data-ref="28brk">brk</a>);</td></tr>
<tr><th id="222">222</th><td>	<a class="local col1 ref" href="#31oldbrk" title='oldbrk' data-ref="31oldbrk">oldbrk</a> = <a class="macro" href="../include/linux/mm.h.html#134" title="((((mm-&gt;brk)) + ((typeof((mm-&gt;brk)))((((1UL) &lt;&lt; 12))) - 1)) &amp; ~((typeof((mm-&gt;brk)))((((1UL) &lt;&lt; 12))) - 1))" data-ref="_M/PAGE_ALIGN">PAGE_ALIGN</a>(<a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::brk" title='mm_struct::brk' data-ref="mm_struct::brk">brk</a>);</td></tr>
<tr><th id="223">223</th><td>	<b>if</b> (<a class="local col1 ref" href="#31oldbrk" title='oldbrk' data-ref="31oldbrk">oldbrk</a> == <a class="local col0 ref" href="#30newbrk" title='newbrk' data-ref="30newbrk">newbrk</a>)</td></tr>
<tr><th id="224">224</th><td>		<b>goto</b> <a class="lbl" href="#38set_brk" data-ref="38set_brk">set_brk</a>;</td></tr>
<tr><th id="225">225</th><td></td></tr>
<tr><th id="226">226</th><td>	<i>/* Always allow shrinking brk. */</i></td></tr>
<tr><th id="227">227</th><td>	<b>if</b> (<a class="local col8 ref" href="#182" title='brk' data-ref="28brk">brk</a> &lt;= <a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::brk" title='mm_struct::brk' data-ref="mm_struct::brk">brk</a>) {</td></tr>
<tr><th id="228">228</th><td>		<b>if</b> (!<a class="ref fn" href="#do_munmap" title='do_munmap' data-ref="do_munmap">do_munmap</a>(<a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>, <a class="local col0 ref" href="#30newbrk" title='newbrk' data-ref="30newbrk">newbrk</a>, <a class="local col1 ref" href="#31oldbrk" title='oldbrk' data-ref="31oldbrk">oldbrk</a>-<a class="local col0 ref" href="#30newbrk" title='newbrk' data-ref="30newbrk">newbrk</a>, &amp;<a class="local col6 ref" href="#190" title='uf' data-ref="36uf">uf</a>))</td></tr>
<tr><th id="229">229</th><td>			<b>goto</b> <a class="lbl" href="#38set_brk" data-ref="38set_brk">set_brk</a>;</td></tr>
<tr><th id="230">230</th><td>		<b>goto</b> <a class="lbl" href="#37out" data-ref="37out">out</a>;</td></tr>
<tr><th id="231">231</th><td>	}</td></tr>
<tr><th id="232">232</th><td></td></tr>
<tr><th id="233">233</th><td>	<i>/* Check against existing mmap mappings. */</i></td></tr>
<tr><th id="234">234</th><td>	<a class="local col3 ref" href="#33next" title='next' data-ref="33next">next</a> = <a class="ref fn" href="#find_vma" title='find_vma' data-ref="find_vma">find_vma</a>(<a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>, <a class="local col1 ref" href="#31oldbrk" title='oldbrk' data-ref="31oldbrk">oldbrk</a>);</td></tr>
<tr><th id="235">235</th><td>	<b>if</b> (<a class="local col3 ref" href="#33next" title='next' data-ref="33next">next</a> &amp;&amp; <a class="local col0 ref" href="#30newbrk" title='newbrk' data-ref="30newbrk">newbrk</a> + <a class="macro" href="../arch/x86/include/asm/page_types.h.html#11" title="((1UL) &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a> &gt; <a class="ref fn" href="../include/linux/mm.h.html#vm_start_gap" title='vm_start_gap' data-ref="vm_start_gap">vm_start_gap</a>(<a class="local col3 ref" href="#33next" title='next' data-ref="33next">next</a>))</td></tr>
<tr><th id="236">236</th><td>		<b>goto</b> <a class="lbl" href="#37out" data-ref="37out">out</a>;</td></tr>
<tr><th id="237">237</th><td></td></tr>
<tr><th id="238">238</th><td>	<i>/* Ok, looks good - let it rip. */</i></td></tr>
<tr><th id="239">239</th><td>	<b>if</b> (<a class="tu ref fn" href="#do_brk_flags" title='do_brk_flags' data-use='c' data-ref="do_brk_flags">do_brk_flags</a>(<a class="local col1 ref" href="#31oldbrk" title='oldbrk' data-ref="31oldbrk">oldbrk</a>, <a class="local col0 ref" href="#30newbrk" title='newbrk' data-ref="30newbrk">newbrk</a>-<a class="local col1 ref" href="#31oldbrk" title='oldbrk' data-ref="31oldbrk">oldbrk</a>, <var>0</var>, &amp;<a class="local col6 ref" href="#190" title='uf' data-ref="36uf">uf</a>) &lt; <var>0</var>)</td></tr>
<tr><th id="240">240</th><td>		<b>goto</b> <a class="lbl" href="#37out" data-ref="37out">out</a>;</td></tr>
<tr><th id="241">241</th><td></td></tr>
<tr><th id="242">242</th><td><dfn class="lbl" id="38set_brk" data-ref="38set_brk">set_brk</dfn>:</td></tr>
<tr><th id="243">243</th><td>	<a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::brk" title='mm_struct::brk' data-ref="mm_struct::brk">brk</a> = <a class="local col8 ref" href="#182" title='brk' data-ref="28brk">brk</a>;</td></tr>
<tr><th id="244">244</th><td>	<a class="local col5 ref" href="#35populate" title='populate' data-ref="35populate">populate</a> = <a class="local col0 ref" href="#30newbrk" title='newbrk' data-ref="30newbrk">newbrk</a> &gt; <a class="local col1 ref" href="#31oldbrk" title='oldbrk' data-ref="31oldbrk">oldbrk</a> &amp;&amp; (<a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::def_flags" title='mm_struct::def_flags' data-ref="mm_struct::def_flags">def_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#180" title="0x00002000" data-ref="_M/VM_LOCKED">VM_LOCKED</a>) != <var>0</var>;</td></tr>
<tr><th id="245">245</th><td>	<a class="ref fn" href="../include/linux/rwsem.h.html#up_write" title='up_write' data-ref="up_write">up_write</a>(&amp;<a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>);</td></tr>
<tr><th id="246">246</th><td>	<a class="ref fn" href="../include/linux/userfaultfd_k.h.html#userfaultfd_unmap_complete" title='userfaultfd_unmap_complete' data-ref="userfaultfd_unmap_complete">userfaultfd_unmap_complete</a>(<a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>, &amp;<a class="local col6 ref" href="#190" title='uf' data-ref="36uf">uf</a>);</td></tr>
<tr><th id="247">247</th><td>	<b>if</b> (<a class="local col5 ref" href="#35populate" title='populate' data-ref="35populate">populate</a>)</td></tr>
<tr><th id="248">248</th><td>		<a class="ref fn" href="../include/linux/mm.h.html#mm_populate" title='mm_populate' data-ref="mm_populate">mm_populate</a>(<a class="local col1 ref" href="#31oldbrk" title='oldbrk' data-ref="31oldbrk">oldbrk</a>, <a class="local col0 ref" href="#30newbrk" title='newbrk' data-ref="30newbrk">newbrk</a> - <a class="local col1 ref" href="#31oldbrk" title='oldbrk' data-ref="31oldbrk">oldbrk</a>);</td></tr>
<tr><th id="249">249</th><td>	<b>return</b> <a class="local col8 ref" href="#182" title='brk' data-ref="28brk">brk</a>;</td></tr>
<tr><th id="250">250</th><td></td></tr>
<tr><th id="251">251</th><td><dfn class="lbl" id="37out" data-ref="37out">out</dfn>:</td></tr>
<tr><th id="252">252</th><td>	<a class="local col9 ref" href="#29retval" title='retval' data-ref="29retval">retval</a> = <a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::brk" title='mm_struct::brk' data-ref="mm_struct::brk">brk</a>;</td></tr>
<tr><th id="253">253</th><td>	<a class="ref fn" href="../include/linux/rwsem.h.html#up_write" title='up_write' data-ref="up_write">up_write</a>(&amp;<a class="local col2 ref" href="#32mm" title='mm' data-ref="32mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>);</td></tr>
<tr><th id="254">254</th><td>	<b>return</b> <a class="local col9 ref" href="#29retval" title='retval' data-ref="29retval">retval</a>;</td></tr>
<tr><th id="255">255</th><td>}</td></tr>
<tr><th id="256">256</th><td></td></tr>
<tr><th id="257">257</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="vma_compute_subtree_gap" title='vma_compute_subtree_gap' data-type='long vma_compute_subtree_gap(struct vm_area_struct * vma)' data-ref="vma_compute_subtree_gap">vma_compute_subtree_gap</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col9 decl" id="39vma" title='vma' data-type='struct vm_area_struct *' data-ref="39vma">vma</dfn>)</td></tr>
<tr><th id="258">258</th><td>{</td></tr>
<tr><th id="259">259</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="40max" title='max' data-type='unsigned long' data-ref="40max">max</dfn>, <dfn class="local col1 decl" id="41prev_end" title='prev_end' data-type='unsigned long' data-ref="41prev_end">prev_end</dfn>, <dfn class="local col2 decl" id="42subtree_gap" title='subtree_gap' data-type='unsigned long' data-ref="42subtree_gap">subtree_gap</dfn>;</td></tr>
<tr><th id="260">260</th><td></td></tr>
<tr><th id="261">261</th><td>	<i>/*</i></td></tr>
<tr><th id="262">262</th><td><i>	 * Note: in the rare case of a VM_GROWSDOWN above a VM_GROWSUP, we</i></td></tr>
<tr><th id="263">263</th><td><i>	 * allow two stack_guard_gaps between them here, and when choosing</i></td></tr>
<tr><th id="264">264</th><td><i>	 * an unmapped area; whereas when expanding we only require one.</i></td></tr>
<tr><th id="265">265</th><td><i>	 * That's a little inconsistent, but keeps the code here simpler.</i></td></tr>
<tr><th id="266">266</th><td><i>	 */</i></td></tr>
<tr><th id="267">267</th><td>	<a class="local col0 ref" href="#40max" title='max' data-ref="40max">max</a> = <a class="ref fn" href="../include/linux/mm.h.html#vm_start_gap" title='vm_start_gap' data-ref="vm_start_gap">vm_start_gap</a>(<a class="local col9 ref" href="#39vma" title='vma' data-ref="39vma">vma</a>);</td></tr>
<tr><th id="268">268</th><td>	<b>if</b> (<a class="local col9 ref" href="#39vma" title='vma' data-ref="39vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a>) {</td></tr>
<tr><th id="269">269</th><td>		<a class="local col1 ref" href="#41prev_end" title='prev_end' data-ref="41prev_end">prev_end</a> = <a class="ref fn" href="../include/linux/mm.h.html#vm_end_gap" title='vm_end_gap' data-ref="vm_end_gap">vm_end_gap</a>(<a class="local col9 ref" href="#39vma" title='vma' data-ref="39vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a>);</td></tr>
<tr><th id="270">270</th><td>		<b>if</b> (<a class="local col0 ref" href="#40max" title='max' data-ref="40max">max</a> &gt; <a class="local col1 ref" href="#41prev_end" title='prev_end' data-ref="41prev_end">prev_end</a>)</td></tr>
<tr><th id="271">271</th><td>			<a class="local col0 ref" href="#40max" title='max' data-ref="40max">max</a> -= <a class="local col1 ref" href="#41prev_end" title='prev_end' data-ref="41prev_end">prev_end</a>;</td></tr>
<tr><th id="272">272</th><td>		<b>else</b></td></tr>
<tr><th id="273">273</th><td>			<a class="local col0 ref" href="#40max" title='max' data-ref="40max">max</a> = <var>0</var>;</td></tr>
<tr><th id="274">274</th><td>	}</td></tr>
<tr><th id="275">275</th><td>	<b>if</b> (<a class="local col9 ref" href="#39vma" title='vma' data-ref="39vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_left" title='rb_node::rb_left' data-ref="rb_node::rb_left">rb_left</a>) {</td></tr>
<tr><th id="276">276</th><td>		<a class="local col2 ref" href="#42subtree_gap" title='subtree_gap' data-ref="42subtree_gap">subtree_gap</a> = <a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(vma-&gt;vm_rb.rb_left); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(vma-&gt;vm_rb.rb_left)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(vma-&gt;vm_rb.rb_left)), typeof(void)))); extern void __compiletime_assert_277(void) ; if (__cond) __compiletime_assert_277(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="local col9 ref" href="#39vma" title='vma' data-ref="39vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_left" title='rb_node::rb_left' data-ref="rb_node::rb_left">rb_left</a>,</td></tr>
<tr><th id="277">277</th><td>				<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>)-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::rb_subtree_gap" title='vm_area_struct::rb_subtree_gap' data-ref="vm_area_struct::rb_subtree_gap">rb_subtree_gap</a>;</td></tr>
<tr><th id="278">278</th><td>		<b>if</b> (<a class="local col2 ref" href="#42subtree_gap" title='subtree_gap' data-ref="42subtree_gap">subtree_gap</a> &gt; <a class="local col0 ref" href="#40max" title='max' data-ref="40max">max</a>)</td></tr>
<tr><th id="279">279</th><td>			<a class="local col0 ref" href="#40max" title='max' data-ref="40max">max</a> = <a class="local col2 ref" href="#42subtree_gap" title='subtree_gap' data-ref="42subtree_gap">subtree_gap</a>;</td></tr>
<tr><th id="280">280</th><td>	}</td></tr>
<tr><th id="281">281</th><td>	<b>if</b> (<a class="local col9 ref" href="#39vma" title='vma' data-ref="39vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_right" title='rb_node::rb_right' data-ref="rb_node::rb_right">rb_right</a>) {</td></tr>
<tr><th id="282">282</th><td>		<a class="local col2 ref" href="#42subtree_gap" title='subtree_gap' data-ref="42subtree_gap">subtree_gap</a> = <a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(vma-&gt;vm_rb.rb_right); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(vma-&gt;vm_rb.rb_right)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(vma-&gt;vm_rb.rb_right)), typeof(void)))); extern void __compiletime_assert_283(void) ; if (__cond) __compiletime_assert_283(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="local col9 ref" href="#39vma" title='vma' data-ref="39vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_right" title='rb_node::rb_right' data-ref="rb_node::rb_right">rb_right</a>,</td></tr>
<tr><th id="283">283</th><td>				<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>)-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::rb_subtree_gap" title='vm_area_struct::rb_subtree_gap' data-ref="vm_area_struct::rb_subtree_gap">rb_subtree_gap</a>;</td></tr>
<tr><th id="284">284</th><td>		<b>if</b> (<a class="local col2 ref" href="#42subtree_gap" title='subtree_gap' data-ref="42subtree_gap">subtree_gap</a> &gt; <a class="local col0 ref" href="#40max" title='max' data-ref="40max">max</a>)</td></tr>
<tr><th id="285">285</th><td>			<a class="local col0 ref" href="#40max" title='max' data-ref="40max">max</a> = <a class="local col2 ref" href="#42subtree_gap" title='subtree_gap' data-ref="42subtree_gap">subtree_gap</a>;</td></tr>
<tr><th id="286">286</th><td>	}</td></tr>
<tr><th id="287">287</th><td>	<b>return</b> <a class="local col0 ref" href="#40max" title='max' data-ref="40max">max</a>;</td></tr>
<tr><th id="288">288</th><td>}</td></tr>
<tr><th id="289">289</th><td></td></tr>
<tr><th id="290">290</th><td><u>#<span data-ppcond="290">ifdef</span> <span class="macro" data-ref="_M/CONFIG_DEBUG_VM_RB">CONFIG_DEBUG_VM_RB</span></u></td></tr>
<tr><th id="291">291</th><td><em>static</em> <em>int</em> browse_rb(<b>struct</b> mm_struct *mm)</td></tr>
<tr><th id="292">292</th><td>{</td></tr>
<tr><th id="293">293</th><td>	<b>struct</b> rb_root *root = &amp;mm-&gt;mm_rb;</td></tr>
<tr><th id="294">294</th><td>	<em>int</em> i = <var>0</var>, j, bug = <var>0</var>;</td></tr>
<tr><th id="295">295</th><td>	<b>struct</b> rb_node *nd, *pn = NULL;</td></tr>
<tr><th id="296">296</th><td>	<em>unsigned</em> <em>long</em> prev = <var>0</var>, pend = <var>0</var>;</td></tr>
<tr><th id="297">297</th><td></td></tr>
<tr><th id="298">298</th><td>	<b>for</b> (nd = rb_first(root); nd; nd = rb_next(nd)) {</td></tr>
<tr><th id="299">299</th><td>		<b>struct</b> vm_area_struct *vma;</td></tr>
<tr><th id="300">300</th><td>		vma = rb_entry(nd, <b>struct</b> vm_area_struct, vm_rb);</td></tr>
<tr><th id="301">301</th><td>		<b>if</b> (vma-&gt;vm_start &lt; prev) {</td></tr>
<tr><th id="302">302</th><td>			pr_emerg(<q>"vm_start %lx &lt; prev %lx\n"</q>,</td></tr>
<tr><th id="303">303</th><td>				  vma-&gt;vm_start, prev);</td></tr>
<tr><th id="304">304</th><td>			bug = <var>1</var>;</td></tr>
<tr><th id="305">305</th><td>		}</td></tr>
<tr><th id="306">306</th><td>		<b>if</b> (vma-&gt;vm_start &lt; pend) {</td></tr>
<tr><th id="307">307</th><td>			pr_emerg(<q>"vm_start %lx &lt; pend %lx\n"</q>,</td></tr>
<tr><th id="308">308</th><td>				  vma-&gt;vm_start, pend);</td></tr>
<tr><th id="309">309</th><td>			bug = <var>1</var>;</td></tr>
<tr><th id="310">310</th><td>		}</td></tr>
<tr><th id="311">311</th><td>		<b>if</b> (vma-&gt;vm_start &gt; vma-&gt;vm_end) {</td></tr>
<tr><th id="312">312</th><td>			pr_emerg(<q>"vm_start %lx &gt; vm_end %lx\n"</q>,</td></tr>
<tr><th id="313">313</th><td>				  vma-&gt;vm_start, vma-&gt;vm_end);</td></tr>
<tr><th id="314">314</th><td>			bug = <var>1</var>;</td></tr>
<tr><th id="315">315</th><td>		}</td></tr>
<tr><th id="316">316</th><td>		spin_lock(&amp;mm-&gt;page_table_lock);</td></tr>
<tr><th id="317">317</th><td>		<b>if</b> (vma-&gt;rb_subtree_gap != vma_compute_subtree_gap(vma)) {</td></tr>
<tr><th id="318">318</th><td>			pr_emerg(<q>"free gap %lx, correct %lx\n"</q>,</td></tr>
<tr><th id="319">319</th><td>			       vma-&gt;rb_subtree_gap,</td></tr>
<tr><th id="320">320</th><td>			       vma_compute_subtree_gap(vma));</td></tr>
<tr><th id="321">321</th><td>			bug = <var>1</var>;</td></tr>
<tr><th id="322">322</th><td>		}</td></tr>
<tr><th id="323">323</th><td>		spin_unlock(&amp;mm-&gt;page_table_lock);</td></tr>
<tr><th id="324">324</th><td>		i++;</td></tr>
<tr><th id="325">325</th><td>		pn = nd;</td></tr>
<tr><th id="326">326</th><td>		prev = vma-&gt;vm_start;</td></tr>
<tr><th id="327">327</th><td>		pend = vma-&gt;vm_end;</td></tr>
<tr><th id="328">328</th><td>	}</td></tr>
<tr><th id="329">329</th><td>	j = <var>0</var>;</td></tr>
<tr><th id="330">330</th><td>	<b>for</b> (nd = pn; nd; nd = rb_prev(nd))</td></tr>
<tr><th id="331">331</th><td>		j++;</td></tr>
<tr><th id="332">332</th><td>	<b>if</b> (i != j) {</td></tr>
<tr><th id="333">333</th><td>		pr_emerg(<q>"backwards %d, forwards %d\n"</q>, j, i);</td></tr>
<tr><th id="334">334</th><td>		bug = <var>1</var>;</td></tr>
<tr><th id="335">335</th><td>	}</td></tr>
<tr><th id="336">336</th><td>	<b>return</b> bug ? -<var>1</var> : i;</td></tr>
<tr><th id="337">337</th><td>}</td></tr>
<tr><th id="338">338</th><td></td></tr>
<tr><th id="339">339</th><td><em>static</em> <em>void</em> validate_mm_rb(<b>struct</b> rb_root *root, <b>struct</b> vm_area_struct *ignore)</td></tr>
<tr><th id="340">340</th><td>{</td></tr>
<tr><th id="341">341</th><td>	<b>struct</b> rb_node *nd;</td></tr>
<tr><th id="342">342</th><td></td></tr>
<tr><th id="343">343</th><td>	<b>for</b> (nd = rb_first(root); nd; nd = rb_next(nd)) {</td></tr>
<tr><th id="344">344</th><td>		<b>struct</b> vm_area_struct *vma;</td></tr>
<tr><th id="345">345</th><td>		vma = rb_entry(nd, <b>struct</b> vm_area_struct, vm_rb);</td></tr>
<tr><th id="346">346</th><td>		VM_BUG_ON_VMA(vma != ignore &amp;&amp;</td></tr>
<tr><th id="347">347</th><td>			vma-&gt;rb_subtree_gap != vma_compute_subtree_gap(vma),</td></tr>
<tr><th id="348">348</th><td>			vma);</td></tr>
<tr><th id="349">349</th><td>	}</td></tr>
<tr><th id="350">350</th><td>}</td></tr>
<tr><th id="351">351</th><td></td></tr>
<tr><th id="352">352</th><td><em>static</em> <em>void</em> validate_mm(<b>struct</b> mm_struct *mm)</td></tr>
<tr><th id="353">353</th><td>{</td></tr>
<tr><th id="354">354</th><td>	<em>int</em> bug = <var>0</var>;</td></tr>
<tr><th id="355">355</th><td>	<em>int</em> i = <var>0</var>;</td></tr>
<tr><th id="356">356</th><td>	<em>unsigned</em> <em>long</em> highest_address = <var>0</var>;</td></tr>
<tr><th id="357">357</th><td>	<b>struct</b> vm_area_struct *vma = mm-&gt;mmap;</td></tr>
<tr><th id="358">358</th><td></td></tr>
<tr><th id="359">359</th><td>	<b>while</b> (vma) {</td></tr>
<tr><th id="360">360</th><td>		<b>struct</b> anon_vma *anon_vma = vma-&gt;anon_vma;</td></tr>
<tr><th id="361">361</th><td>		<b>struct</b> anon_vma_chain *avc;</td></tr>
<tr><th id="362">362</th><td></td></tr>
<tr><th id="363">363</th><td>		<b>if</b> (anon_vma) {</td></tr>
<tr><th id="364">364</th><td>			anon_vma_lock_read(anon_vma);</td></tr>
<tr><th id="365">365</th><td>			list_for_each_entry(avc, &amp;vma-&gt;anon_vma_chain, same_vma)</td></tr>
<tr><th id="366">366</th><td>				anon_vma_interval_tree_verify(avc);</td></tr>
<tr><th id="367">367</th><td>			anon_vma_unlock_read(anon_vma);</td></tr>
<tr><th id="368">368</th><td>		}</td></tr>
<tr><th id="369">369</th><td></td></tr>
<tr><th id="370">370</th><td>		highest_address = vm_end_gap(vma);</td></tr>
<tr><th id="371">371</th><td>		vma = vma-&gt;vm_next;</td></tr>
<tr><th id="372">372</th><td>		i++;</td></tr>
<tr><th id="373">373</th><td>	}</td></tr>
<tr><th id="374">374</th><td>	<b>if</b> (i != mm-&gt;map_count) {</td></tr>
<tr><th id="375">375</th><td>		pr_emerg(<q>"map_count %d vm_next %d\n"</q>, mm-&gt;map_count, i);</td></tr>
<tr><th id="376">376</th><td>		bug = <var>1</var>;</td></tr>
<tr><th id="377">377</th><td>	}</td></tr>
<tr><th id="378">378</th><td>	<b>if</b> (highest_address != mm-&gt;highest_vm_end) {</td></tr>
<tr><th id="379">379</th><td>		pr_emerg(<q>"mm-&gt;highest_vm_end %lx, found %lx\n"</q>,</td></tr>
<tr><th id="380">380</th><td>			  mm-&gt;highest_vm_end, highest_address);</td></tr>
<tr><th id="381">381</th><td>		bug = <var>1</var>;</td></tr>
<tr><th id="382">382</th><td>	}</td></tr>
<tr><th id="383">383</th><td>	i = browse_rb(mm);</td></tr>
<tr><th id="384">384</th><td>	<b>if</b> (i != mm-&gt;map_count) {</td></tr>
<tr><th id="385">385</th><td>		<b>if</b> (i != -<var>1</var>)</td></tr>
<tr><th id="386">386</th><td>			pr_emerg(<q>"map_count %d rb %d\n"</q>, mm-&gt;map_count, i);</td></tr>
<tr><th id="387">387</th><td>		bug = <var>1</var>;</td></tr>
<tr><th id="388">388</th><td>	}</td></tr>
<tr><th id="389">389</th><td>	VM_BUG_ON_MM(bug, mm);</td></tr>
<tr><th id="390">390</th><td>}</td></tr>
<tr><th id="391">391</th><td><u>#<span data-ppcond="290">else</span></u></td></tr>
<tr><th id="392">392</th><td><u>#define <dfn class="macro" id="_M/validate_mm_rb" data-ref="_M/validate_mm_rb">validate_mm_rb</dfn>(root, ignore) do { } while (0)</u></td></tr>
<tr><th id="393">393</th><td><u>#define <dfn class="macro" id="_M/validate_mm" data-ref="_M/validate_mm">validate_mm</dfn>(mm) do { } while (0)</u></td></tr>
<tr><th id="394">394</th><td><u>#<span data-ppcond="290">endif</span></u></td></tr>
<tr><th id="395">395</th><td></td></tr>
<tr><th id="396">396</th><td><a class="macro" href="../include/linux/rbtree_augmented.h.html#74" title="static inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) void vma_gap_callbacks_propagate(struct rb_node *rb, struct rb_node *stop) { while (rb != stop) { struct vm_area_struct *node = ({ void *__mptr = (void *)(rb); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(rb)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(rb)), typeof(void)))); extern void __compiletime_assert_397(void) ; if (__cond) __compiletime_assert_397(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); }); unsigned long augmented = vma_compute_subtree_gap(node); if (node-&gt;rb_subtree_gap == augmented) break; node-&gt;rb_subtree_gap = augmented; rb = ((struct rb_node *)((&amp;node-&gt;vm_rb)-&gt;__rb_parent_color &amp; ~3)); } } static inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) void vma_gap_callbacks_copy(struct rb_node *rb_old, struct rb_node *rb_new) { struct vm_area_struct *old = ({ void *__mptr = (void *)(rb_old); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(rb_old)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(rb_old)), typeof(void)))); extern void __compiletime_assert_397(void) ; if (__cond) __compiletime_assert_397(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); }); struct vm_area_struct *new = ({ void *__mptr = (void *)(rb_new); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(rb_new)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(rb_new)), typeof(void)))); extern void __compiletime_assert_397(void) ; if (__cond) __compiletime_assert_397(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); }); new-&gt;rb_subtree_gap = old-&gt;rb_subtree_gap; } static void vma_gap_callbacks_rotate(struct rb_node *rb_old, struct rb_node *rb_new) { struct vm_area_struct *old = ({ void *__mptr = (void *)(rb_old); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(rb_old)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(rb_old)), typeof(void)))); extern void __compiletime_assert_397(void) ; if (__cond) __compiletime_assert_397(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); }); struct vm_area_struct *new = ({ void *__mptr = (void *)(rb_new); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(rb_new)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(rb_new)), typeof(void)))); extern void __compiletime_assert_397(void) ; if (__cond) __compiletime_assert_397(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); }); new-&gt;rb_subtree_gap = old-&gt;rb_subtree_gap; old-&gt;rb_subtree_gap = vma_compute_subtree_gap(old); } static const struct rb_augment_callbacks vma_gap_callbacks = { .propagate = vma_gap_callbacks_propagate, .copy = vma_gap_callbacks_copy, .rotate = vma_gap_callbacks_rotate };" data-ref="_M/RB_DECLARE_CALLBACKS">RB_DECLARE_CALLBACKS</a>(<em>static</em>, <dfn class="tu decl def" id="vma_gap_callbacks" title='vma_gap_callbacks' data-type='const struct rb_augment_callbacks' data-ref="vma_gap_callbacks">vma_gap_callbacks</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>,</td></tr>
<tr><th id="397">397</th><td>		     <em>unsigned</em> <em>long</em>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::rb_subtree_gap" title='vm_area_struct::rb_subtree_gap' data-ref="vm_area_struct::rb_subtree_gap">rb_subtree_gap</a>, <a class="tu ref fn" href="#vma_compute_subtree_gap" title='vma_compute_subtree_gap' data-use='c' data-ref="vma_compute_subtree_gap">vma_compute_subtree_gap</a>)</td></tr>
<tr><th id="398">398</th><td></td></tr>
<tr><th id="399">399</th><td><i  data-doc="vma_gap_update">/*</i></td></tr>
<tr><th id="400">400</th><td><i  data-doc="vma_gap_update"> * Update augmented rbtree rb_subtree_gap values after vma-&gt;vm_start or</i></td></tr>
<tr><th id="401">401</th><td><i  data-doc="vma_gap_update"> * vma-&gt;vm_prev-&gt;vm_end values changed, without modifying the vma's position</i></td></tr>
<tr><th id="402">402</th><td><i  data-doc="vma_gap_update"> * in the rbtree.</i></td></tr>
<tr><th id="403">403</th><td><i  data-doc="vma_gap_update"> */</i></td></tr>
<tr><th id="404">404</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vma_gap_update" title='vma_gap_update' data-type='void vma_gap_update(struct vm_area_struct * vma)' data-ref="vma_gap_update">vma_gap_update</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col3 decl" id="43vma" title='vma' data-type='struct vm_area_struct *' data-ref="43vma">vma</dfn>)</td></tr>
<tr><th id="405">405</th><td>{</td></tr>
<tr><th id="406">406</th><td>	<i>/*</i></td></tr>
<tr><th id="407">407</th><td><i>	 * As it turns out, RB_DECLARE_CALLBACKS() already created a callback</i></td></tr>
<tr><th id="408">408</th><td><i>	 * function that does exacltly what we want.</i></td></tr>
<tr><th id="409">409</th><td><i>	 */</i></td></tr>
<tr><th id="410">410</th><td>	<a class="ref fn" href="#396" title='vma_gap_callbacks_propagate' data-ref="vma_gap_callbacks_propagate">vma_gap_callbacks_propagate</a>(&amp;<a class="local col3 ref" href="#43vma" title='vma' data-ref="43vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="411">411</th><td>}</td></tr>
<tr><th id="412">412</th><td></td></tr>
<tr><th id="413">413</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>void</em> <dfn class="tu decl def fn" id="vma_rb_insert" title='vma_rb_insert' data-type='void vma_rb_insert(struct vm_area_struct * vma, struct rb_root * root)' data-ref="vma_rb_insert">vma_rb_insert</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col4 decl" id="44vma" title='vma' data-type='struct vm_area_struct *' data-ref="44vma">vma</dfn>,</td></tr>
<tr><th id="414">414</th><td>				 <b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_root" title='rb_root' data-ref="rb_root">rb_root</a> *<dfn class="local col5 decl" id="45root" title='root' data-type='struct rb_root *' data-ref="45root">root</dfn>)</td></tr>
<tr><th id="415">415</th><td>{</td></tr>
<tr><th id="416">416</th><td>	<i>/* All rb_subtree_gap values must be consistent prior to insertion */</i></td></tr>
<tr><th id="417">417</th><td>	<a class="macro" href="#392" title="do { } while (0)" data-ref="_M/validate_mm_rb">validate_mm_rb</a>(root, NULL);</td></tr>
<tr><th id="418">418</th><td></td></tr>
<tr><th id="419">419</th><td>	<a class="ref fn" href="../include/linux/rbtree_augmented.h.html#rb_insert_augmented" title='rb_insert_augmented' data-ref="rb_insert_augmented">rb_insert_augmented</a>(&amp;<a class="local col4 ref" href="#44vma" title='vma' data-ref="44vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>, <a class="local col5 ref" href="#45root" title='root' data-ref="45root">root</a>, &amp;<a class="tu ref" href="#396" title='vma_gap_callbacks' data-use='a' data-ref="vma_gap_callbacks">vma_gap_callbacks</a>);</td></tr>
<tr><th id="420">420</th><td>}</td></tr>
<tr><th id="421">421</th><td></td></tr>
<tr><th id="422">422</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="__vma_rb_erase" title='__vma_rb_erase' data-type='void __vma_rb_erase(struct vm_area_struct * vma, struct rb_root * root)' data-ref="__vma_rb_erase">__vma_rb_erase</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col6 decl" id="46vma" title='vma' data-type='struct vm_area_struct *' data-ref="46vma">vma</dfn>, <b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_root" title='rb_root' data-ref="rb_root">rb_root</a> *<dfn class="local col7 decl" id="47root" title='root' data-type='struct rb_root *' data-ref="47root">root</dfn>)</td></tr>
<tr><th id="423">423</th><td>{</td></tr>
<tr><th id="424">424</th><td>	<i>/*</i></td></tr>
<tr><th id="425">425</th><td><i>	 * Note rb_erase_augmented is a fairly large inline function,</i></td></tr>
<tr><th id="426">426</th><td><i>	 * so make sure we instantiate it only once with our desired</i></td></tr>
<tr><th id="427">427</th><td><i>	 * augmented rbtree callbacks.</i></td></tr>
<tr><th id="428">428</th><td><i>	 */</i></td></tr>
<tr><th id="429">429</th><td>	<a class="ref fn" href="../include/linux/rbtree_augmented.h.html#rb_erase_augmented" title='rb_erase_augmented' data-ref="rb_erase_augmented">rb_erase_augmented</a>(&amp;<a class="local col6 ref" href="#46vma" title='vma' data-ref="46vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>, <a class="local col7 ref" href="#47root" title='root' data-ref="47root">root</a>, &amp;<a class="tu ref" href="#396" title='vma_gap_callbacks' data-use='a' data-ref="vma_gap_callbacks">vma_gap_callbacks</a>);</td></tr>
<tr><th id="430">430</th><td>}</td></tr>
<tr><th id="431">431</th><td></td></tr>
<tr><th id="432">432</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#103" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) __attribute__((always_inline))" data-ref="_M/__always_inline">__always_inline</a> <em>void</em> <dfn class="tu decl def fn" id="vma_rb_erase_ignore" title='vma_rb_erase_ignore' data-type='void vma_rb_erase_ignore(struct vm_area_struct * vma, struct rb_root * root, struct vm_area_struct * ignore)' data-ref="vma_rb_erase_ignore">vma_rb_erase_ignore</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col8 decl" id="48vma" title='vma' data-type='struct vm_area_struct *' data-ref="48vma">vma</dfn>,</td></tr>
<tr><th id="433">433</th><td>						<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_root" title='rb_root' data-ref="rb_root">rb_root</a> *<dfn class="local col9 decl" id="49root" title='root' data-type='struct rb_root *' data-ref="49root">root</dfn>,</td></tr>
<tr><th id="434">434</th><td>						<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col0 decl" id="50ignore" title='ignore' data-type='struct vm_area_struct *' data-ref="50ignore">ignore</dfn>)</td></tr>
<tr><th id="435">435</th><td>{</td></tr>
<tr><th id="436">436</th><td>	<i>/*</i></td></tr>
<tr><th id="437">437</th><td><i>	 * All rb_subtree_gap values must be consistent prior to erase,</i></td></tr>
<tr><th id="438">438</th><td><i>	 * with the possible exception of the "next" vma being erased if</i></td></tr>
<tr><th id="439">439</th><td><i>	 * next-&gt;vm_start was reduced.</i></td></tr>
<tr><th id="440">440</th><td><i>	 */</i></td></tr>
<tr><th id="441">441</th><td>	<a class="macro" href="#392" title="do { } while (0)" data-ref="_M/validate_mm_rb">validate_mm_rb</a>(root, ignore);</td></tr>
<tr><th id="442">442</th><td></td></tr>
<tr><th id="443">443</th><td>	<a class="tu ref fn" href="#__vma_rb_erase" title='__vma_rb_erase' data-use='c' data-ref="__vma_rb_erase">__vma_rb_erase</a>(<a class="local col8 ref" href="#48vma" title='vma' data-ref="48vma">vma</a>, <a class="local col9 ref" href="#49root" title='root' data-ref="49root">root</a>);</td></tr>
<tr><th id="444">444</th><td>}</td></tr>
<tr><th id="445">445</th><td></td></tr>
<tr><th id="446">446</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#103" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) __attribute__((always_inline))" data-ref="_M/__always_inline">__always_inline</a> <em>void</em> <dfn class="tu decl def fn" id="vma_rb_erase" title='vma_rb_erase' data-type='void vma_rb_erase(struct vm_area_struct * vma, struct rb_root * root)' data-ref="vma_rb_erase">vma_rb_erase</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col1 decl" id="51vma" title='vma' data-type='struct vm_area_struct *' data-ref="51vma">vma</dfn>,</td></tr>
<tr><th id="447">447</th><td>					 <b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_root" title='rb_root' data-ref="rb_root">rb_root</a> *<dfn class="local col2 decl" id="52root" title='root' data-type='struct rb_root *' data-ref="52root">root</dfn>)</td></tr>
<tr><th id="448">448</th><td>{</td></tr>
<tr><th id="449">449</th><td>	<i>/*</i></td></tr>
<tr><th id="450">450</th><td><i>	 * All rb_subtree_gap values must be consistent prior to erase,</i></td></tr>
<tr><th id="451">451</th><td><i>	 * with the possible exception of the vma being erased.</i></td></tr>
<tr><th id="452">452</th><td><i>	 */</i></td></tr>
<tr><th id="453">453</th><td>	<a class="macro" href="#392" title="do { } while (0)" data-ref="_M/validate_mm_rb">validate_mm_rb</a>(root, vma);</td></tr>
<tr><th id="454">454</th><td></td></tr>
<tr><th id="455">455</th><td>	<a class="tu ref fn" href="#__vma_rb_erase" title='__vma_rb_erase' data-use='c' data-ref="__vma_rb_erase">__vma_rb_erase</a>(<a class="local col1 ref" href="#51vma" title='vma' data-ref="51vma">vma</a>, <a class="local col2 ref" href="#52root" title='root' data-ref="52root">root</a>);</td></tr>
<tr><th id="456">456</th><td>}</td></tr>
<tr><th id="457">457</th><td></td></tr>
<tr><th id="458">458</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma">/*</i></td></tr>
<tr><th id="459">459</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> * vma has some anon_vma assigned, and is already inserted on that</i></td></tr>
<tr><th id="460">460</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> * anon_vma's interval trees.</i></td></tr>
<tr><th id="461">461</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> *</i></td></tr>
<tr><th id="462">462</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> * Before updating the vma's vm_start / vm_end / vm_pgoff fields, the</i></td></tr>
<tr><th id="463">463</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> * vma must be removed from the anon_vma's interval trees using</i></td></tr>
<tr><th id="464">464</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> * anon_vma_interval_tree_pre_update_vma().</i></td></tr>
<tr><th id="465">465</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> *</i></td></tr>
<tr><th id="466">466</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> * After the update, the vma will be reinserted using</i></td></tr>
<tr><th id="467">467</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> * anon_vma_interval_tree_post_update_vma().</i></td></tr>
<tr><th id="468">468</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> *</i></td></tr>
<tr><th id="469">469</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> * The entire update must be protected by exclusive mmap_sem and by</i></td></tr>
<tr><th id="470">470</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> * the root anon_vma's mutex.</i></td></tr>
<tr><th id="471">471</th><td><i  data-doc="anon_vma_interval_tree_pre_update_vma"> */</i></td></tr>
<tr><th id="472">472</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>void</em></td></tr>
<tr><th id="473">473</th><td><dfn class="tu decl def fn" id="anon_vma_interval_tree_pre_update_vma" title='anon_vma_interval_tree_pre_update_vma' data-type='void anon_vma_interval_tree_pre_update_vma(struct vm_area_struct * vma)' data-ref="anon_vma_interval_tree_pre_update_vma">anon_vma_interval_tree_pre_update_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col3 decl" id="53vma" title='vma' data-type='struct vm_area_struct *' data-ref="53vma">vma</dfn>)</td></tr>
<tr><th id="474">474</th><td>{</td></tr>
<tr><th id="475">475</th><td>	<b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma_chain" title='anon_vma_chain' data-ref="anon_vma_chain">anon_vma_chain</a> *<dfn class="local col4 decl" id="54avc" title='avc' data-type='struct anon_vma_chain *' data-ref="54avc">avc</dfn>;</td></tr>
<tr><th id="476">476</th><td></td></tr>
<tr><th id="477">477</th><td>	<a class="macro" href="../include/linux/list.h.html#463" title="for (avc = ({ void *__mptr = (void *)((&amp;vma-&gt;anon_vma_chain)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;vma-&gt;anon_vma_chain)-&gt;next)), typeof(((typeof(*avc) *)0)-&gt;same_vma)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;vma-&gt;anon_vma_chain)-&gt;next)), typeof(void)))); extern void __compiletime_assert_477(void) ; if (__cond) __compiletime_assert_477(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*avc) *)(__mptr - __builtin_offsetof(typeof(*avc), same_vma))); }); &amp;avc-&gt;same_vma != (&amp;vma-&gt;anon_vma_chain); avc = ({ void *__mptr = (void *)((avc)-&gt;same_vma.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((avc)-&gt;same_vma.next)), typeof(((typeof(*(avc)) *)0)-&gt;same_vma)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((avc)-&gt;same_vma.next)), typeof(void)))); extern void __compiletime_assert_477(void) ; if (__cond) __compiletime_assert_477(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(avc)) *)(__mptr - __builtin_offsetof(typeof(*(avc)), same_vma))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col4 ref" href="#54avc" title='avc' data-ref="54avc">avc</a>, &amp;<a class="local col3 ref" href="#53vma" title='vma' data-ref="53vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma_chain" title='vm_area_struct::anon_vma_chain' data-ref="vm_area_struct::anon_vma_chain">anon_vma_chain</a>, <a class="ref field" href="../include/linux/rmap.h.html#anon_vma_chain::same_vma" title='anon_vma_chain::same_vma' data-ref="anon_vma_chain::same_vma">same_vma</a>)</td></tr>
<tr><th id="478">478</th><td>		<a class="ref fn" href="../include/linux/mm.h.html#anon_vma_interval_tree_remove" title='anon_vma_interval_tree_remove' data-ref="anon_vma_interval_tree_remove">anon_vma_interval_tree_remove</a>(<a class="local col4 ref" href="#54avc" title='avc' data-ref="54avc">avc</a>, &amp;<a class="local col4 ref" href="#54avc" title='avc' data-ref="54avc">avc</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma_chain::anon_vma" title='anon_vma_chain::anon_vma' data-ref="anon_vma_chain::anon_vma">anon_vma</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma::rb_root" title='anon_vma::rb_root' data-ref="anon_vma::rb_root">rb_root</a>);</td></tr>
<tr><th id="479">479</th><td>}</td></tr>
<tr><th id="480">480</th><td></td></tr>
<tr><th id="481">481</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>void</em></td></tr>
<tr><th id="482">482</th><td><dfn class="tu decl def fn" id="anon_vma_interval_tree_post_update_vma" title='anon_vma_interval_tree_post_update_vma' data-type='void anon_vma_interval_tree_post_update_vma(struct vm_area_struct * vma)' data-ref="anon_vma_interval_tree_post_update_vma">anon_vma_interval_tree_post_update_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col5 decl" id="55vma" title='vma' data-type='struct vm_area_struct *' data-ref="55vma">vma</dfn>)</td></tr>
<tr><th id="483">483</th><td>{</td></tr>
<tr><th id="484">484</th><td>	<b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma_chain" title='anon_vma_chain' data-ref="anon_vma_chain">anon_vma_chain</a> *<dfn class="local col6 decl" id="56avc" title='avc' data-type='struct anon_vma_chain *' data-ref="56avc">avc</dfn>;</td></tr>
<tr><th id="485">485</th><td></td></tr>
<tr><th id="486">486</th><td>	<a class="macro" href="../include/linux/list.h.html#463" title="for (avc = ({ void *__mptr = (void *)((&amp;vma-&gt;anon_vma_chain)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;vma-&gt;anon_vma_chain)-&gt;next)), typeof(((typeof(*avc) *)0)-&gt;same_vma)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;vma-&gt;anon_vma_chain)-&gt;next)), typeof(void)))); extern void __compiletime_assert_486(void) ; if (__cond) __compiletime_assert_486(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*avc) *)(__mptr - __builtin_offsetof(typeof(*avc), same_vma))); }); &amp;avc-&gt;same_vma != (&amp;vma-&gt;anon_vma_chain); avc = ({ void *__mptr = (void *)((avc)-&gt;same_vma.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((avc)-&gt;same_vma.next)), typeof(((typeof(*(avc)) *)0)-&gt;same_vma)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((avc)-&gt;same_vma.next)), typeof(void)))); extern void __compiletime_assert_486(void) ; if (__cond) __compiletime_assert_486(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(avc)) *)(__mptr - __builtin_offsetof(typeof(*(avc)), same_vma))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col6 ref" href="#56avc" title='avc' data-ref="56avc">avc</a>, &amp;<a class="local col5 ref" href="#55vma" title='vma' data-ref="55vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma_chain" title='vm_area_struct::anon_vma_chain' data-ref="vm_area_struct::anon_vma_chain">anon_vma_chain</a>, <a class="ref field" href="../include/linux/rmap.h.html#anon_vma_chain::same_vma" title='anon_vma_chain::same_vma' data-ref="anon_vma_chain::same_vma">same_vma</a>)</td></tr>
<tr><th id="487">487</th><td>		<a class="ref fn" href="../include/linux/mm.h.html#anon_vma_interval_tree_insert" title='anon_vma_interval_tree_insert' data-ref="anon_vma_interval_tree_insert">anon_vma_interval_tree_insert</a>(<a class="local col6 ref" href="#56avc" title='avc' data-ref="56avc">avc</a>, &amp;<a class="local col6 ref" href="#56avc" title='avc' data-ref="56avc">avc</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma_chain::anon_vma" title='anon_vma_chain::anon_vma' data-ref="anon_vma_chain::anon_vma">anon_vma</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma::rb_root" title='anon_vma::rb_root' data-ref="anon_vma::rb_root">rb_root</a>);</td></tr>
<tr><th id="488">488</th><td>}</td></tr>
<tr><th id="489">489</th><td></td></tr>
<tr><th id="490">490</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="find_vma_links" title='find_vma_links' data-type='int find_vma_links(struct mm_struct * mm, unsigned long addr, unsigned long end, struct vm_area_struct ** pprev, struct rb_node *** rb_link, struct rb_node ** rb_parent)' data-ref="find_vma_links">find_vma_links</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col7 decl" id="57mm" title='mm' data-type='struct mm_struct *' data-ref="57mm">mm</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="58addr" title='addr' data-type='unsigned long' data-ref="58addr">addr</dfn>,</td></tr>
<tr><th id="491">491</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="59end" title='end' data-type='unsigned long' data-ref="59end">end</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> **<dfn class="local col0 decl" id="60pprev" title='pprev' data-type='struct vm_area_struct **' data-ref="60pprev">pprev</dfn>,</td></tr>
<tr><th id="492">492</th><td>		<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> ***<dfn class="local col1 decl" id="61rb_link" title='rb_link' data-type='struct rb_node ***' data-ref="61rb_link">rb_link</dfn>, <b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> **<dfn class="local col2 decl" id="62rb_parent" title='rb_parent' data-type='struct rb_node **' data-ref="62rb_parent">rb_parent</dfn>)</td></tr>
<tr><th id="493">493</th><td>{</td></tr>
<tr><th id="494">494</th><td>	<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> **<dfn class="local col3 decl" id="63__rb_link" title='__rb_link' data-type='struct rb_node **' data-ref="63__rb_link">__rb_link</dfn>, *<dfn class="local col4 decl" id="64__rb_parent" title='__rb_parent' data-type='struct rb_node *' data-ref="64__rb_parent">__rb_parent</dfn>, *<dfn class="local col5 decl" id="65rb_prev" title='rb_prev' data-type='struct rb_node *' data-ref="65rb_prev">rb_prev</dfn>;</td></tr>
<tr><th id="495">495</th><td></td></tr>
<tr><th id="496">496</th><td>	<a class="local col3 ref" href="#63__rb_link" title='__rb_link' data-ref="63__rb_link">__rb_link</a> = &amp;<a class="local col7 ref" href="#57mm" title='mm' data-ref="57mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mm_rb" title='mm_struct::mm_rb' data-ref="mm_struct::mm_rb">mm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root::rb_node" title='rb_root::rb_node' data-ref="rb_root::rb_node">rb_node</a>;</td></tr>
<tr><th id="497">497</th><td>	<a class="local col5 ref" href="#65rb_prev" title='rb_prev' data-ref="65rb_prev">rb_prev</a> = <a class="local col4 ref" href="#64__rb_parent" title='__rb_parent' data-ref="64__rb_parent">__rb_parent</a> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="498">498</th><td></td></tr>
<tr><th id="499">499</th><td>	<b>while</b> (*<a class="local col3 ref" href="#63__rb_link" title='__rb_link' data-ref="63__rb_link">__rb_link</a>) {</td></tr>
<tr><th id="500">500</th><td>		<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col6 decl" id="66vma_tmp" title='vma_tmp' data-type='struct vm_area_struct *' data-ref="66vma_tmp">vma_tmp</dfn>;</td></tr>
<tr><th id="501">501</th><td></td></tr>
<tr><th id="502">502</th><td>		<a class="local col4 ref" href="#64__rb_parent" title='__rb_parent' data-ref="64__rb_parent">__rb_parent</a> = *<a class="local col3 ref" href="#63__rb_link" title='__rb_link' data-ref="63__rb_link">__rb_link</a>;</td></tr>
<tr><th id="503">503</th><td>		<a class="local col6 ref" href="#66vma_tmp" title='vma_tmp' data-ref="66vma_tmp">vma_tmp</a> = <a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(__rb_parent); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(__rb_parent)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(__rb_parent)), typeof(void)))); extern void __compiletime_assert_503(void) ; if (__cond) __compiletime_assert_503(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="local col4 ref" href="#64__rb_parent" title='__rb_parent' data-ref="64__rb_parent">__rb_parent</a>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>);</td></tr>
<tr><th id="504">504</th><td></td></tr>
<tr><th id="505">505</th><td>		<b>if</b> (<a class="local col6 ref" href="#66vma_tmp" title='vma_tmp' data-ref="66vma_tmp">vma_tmp</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> &gt; <a class="local col8 ref" href="#58addr" title='addr' data-ref="58addr">addr</a>) {</td></tr>
<tr><th id="506">506</th><td>			<i>/* Fail if an existing vma overlaps the area */</i></td></tr>
<tr><th id="507">507</th><td>			<b>if</b> (<a class="local col6 ref" href="#66vma_tmp" title='vma_tmp' data-ref="66vma_tmp">vma_tmp</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &lt; <a class="local col9 ref" href="#59end" title='end' data-ref="59end">end</a>)</td></tr>
<tr><th id="508">508</th><td>				<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="509">509</th><td>			<a class="local col3 ref" href="#63__rb_link" title='__rb_link' data-ref="63__rb_link">__rb_link</a> = &amp;<a class="local col4 ref" href="#64__rb_parent" title='__rb_parent' data-ref="64__rb_parent">__rb_parent</a>-&gt;<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_left" title='rb_node::rb_left' data-ref="rb_node::rb_left">rb_left</a>;</td></tr>
<tr><th id="510">510</th><td>		} <b>else</b> {</td></tr>
<tr><th id="511">511</th><td>			<a class="local col5 ref" href="#65rb_prev" title='rb_prev' data-ref="65rb_prev">rb_prev</a> = <a class="local col4 ref" href="#64__rb_parent" title='__rb_parent' data-ref="64__rb_parent">__rb_parent</a>;</td></tr>
<tr><th id="512">512</th><td>			<a class="local col3 ref" href="#63__rb_link" title='__rb_link' data-ref="63__rb_link">__rb_link</a> = &amp;<a class="local col4 ref" href="#64__rb_parent" title='__rb_parent' data-ref="64__rb_parent">__rb_parent</a>-&gt;<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_right" title='rb_node::rb_right' data-ref="rb_node::rb_right">rb_right</a>;</td></tr>
<tr><th id="513">513</th><td>		}</td></tr>
<tr><th id="514">514</th><td>	}</td></tr>
<tr><th id="515">515</th><td></td></tr>
<tr><th id="516">516</th><td>	*<a class="local col0 ref" href="#60pprev" title='pprev' data-ref="60pprev">pprev</a> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="517">517</th><td>	<b>if</b> (<a class="local col5 ref" href="#65rb_prev" title='rb_prev' data-ref="65rb_prev">rb_prev</a>)</td></tr>
<tr><th id="518">518</th><td>		*<a class="local col0 ref" href="#60pprev" title='pprev' data-ref="60pprev">pprev</a> = <a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(rb_prev); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(rb_prev)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(rb_prev)), typeof(void)))); extern void __compiletime_assert_518(void) ; if (__cond) __compiletime_assert_518(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="local col5 ref" href="#65rb_prev" title='rb_prev' data-ref="65rb_prev">rb_prev</a>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>);</td></tr>
<tr><th id="519">519</th><td>	*<a class="local col1 ref" href="#61rb_link" title='rb_link' data-ref="61rb_link">rb_link</a> = <a class="local col3 ref" href="#63__rb_link" title='__rb_link' data-ref="63__rb_link">__rb_link</a>;</td></tr>
<tr><th id="520">520</th><td>	*<a class="local col2 ref" href="#62rb_parent" title='rb_parent' data-ref="62rb_parent">rb_parent</a> = <a class="local col4 ref" href="#64__rb_parent" title='__rb_parent' data-ref="64__rb_parent">__rb_parent</a>;</td></tr>
<tr><th id="521">521</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="522">522</th><td>}</td></tr>
<tr><th id="523">523</th><td></td></tr>
<tr><th id="524">524</th><td><em>static</em> <em>unsigned</em> <em>long</em> <dfn class="tu decl def fn" id="count_vma_pages_range" title='count_vma_pages_range' data-type='unsigned long count_vma_pages_range(struct mm_struct * mm, unsigned long addr, unsigned long end)' data-ref="count_vma_pages_range">count_vma_pages_range</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col7 decl" id="67mm" title='mm' data-type='struct mm_struct *' data-ref="67mm">mm</dfn>,</td></tr>
<tr><th id="525">525</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="68addr" title='addr' data-type='unsigned long' data-ref="68addr">addr</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="69end" title='end' data-type='unsigned long' data-ref="69end">end</dfn>)</td></tr>
<tr><th id="526">526</th><td>{</td></tr>
<tr><th id="527">527</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="70nr_pages" title='nr_pages' data-type='unsigned long' data-ref="70nr_pages">nr_pages</dfn> = <var>0</var>;</td></tr>
<tr><th id="528">528</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col1 decl" id="71vma" title='vma' data-type='struct vm_area_struct *' data-ref="71vma">vma</dfn>;</td></tr>
<tr><th id="529">529</th><td></td></tr>
<tr><th id="530">530</th><td>	<i>/* Find first overlaping mapping */</i></td></tr>
<tr><th id="531">531</th><td>	<a class="local col1 ref" href="#71vma" title='vma' data-ref="71vma">vma</a> = <a class="ref fn" href="../include/linux/mm.h.html#find_vma_intersection" title='find_vma_intersection' data-ref="find_vma_intersection">find_vma_intersection</a>(<a class="local col7 ref" href="#67mm" title='mm' data-ref="67mm">mm</a>, <a class="local col8 ref" href="#68addr" title='addr' data-ref="68addr">addr</a>, <a class="local col9 ref" href="#69end" title='end' data-ref="69end">end</a>);</td></tr>
<tr><th id="532">532</th><td>	<b>if</b> (!<a class="local col1 ref" href="#71vma" title='vma' data-ref="71vma">vma</a>)</td></tr>
<tr><th id="533">533</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="534">534</th><td></td></tr>
<tr><th id="535">535</th><td>	<a class="local col0 ref" href="#70nr_pages" title='nr_pages' data-ref="70nr_pages">nr_pages</a> = (<a class="macro" href="../include/linux/kernel.h.html#799" title="({ typeof(end) __UNIQUE_ID_min1_113 = (end); typeof(vma-&gt;vm_end) __UNIQUE_ID_min2_114 = (vma-&gt;vm_end); (void) (&amp;__UNIQUE_ID_min1_113 == &amp;__UNIQUE_ID_min2_114); __UNIQUE_ID_min1_113 &lt; __UNIQUE_ID_min2_114 ? __UNIQUE_ID_min1_113 : __UNIQUE_ID_min2_114; })" data-ref="_M/min">min</a>(<a class="local col9 ref" href="#69end" title='end' data-ref="69end">end</a>, <a class="local col1 ref" href="#71vma" title='vma' data-ref="71vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>) -</td></tr>
<tr><th id="536">536</th><td>		<a class="macro" href="../include/linux/kernel.h.html#815" title="({ typeof(addr) __UNIQUE_ID_max1_117 = (addr); typeof(vma-&gt;vm_start) __UNIQUE_ID_max2_118 = (vma-&gt;vm_start); (void) (&amp;__UNIQUE_ID_max1_117 == &amp;__UNIQUE_ID_max2_118); __UNIQUE_ID_max1_117 &gt; __UNIQUE_ID_max2_118 ? __UNIQUE_ID_max1_117 : __UNIQUE_ID_max2_118; })" data-ref="_M/max">max</a>(<a class="local col8 ref" href="#68addr" title='addr' data-ref="68addr">addr</a>, <a class="local col1 ref" href="#71vma" title='vma' data-ref="71vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>)) &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="537">537</th><td></td></tr>
<tr><th id="538">538</th><td>	<i>/* Iterate over the rest of the overlaps */</i></td></tr>
<tr><th id="539">539</th><td>	<b>for</b> (<a class="local col1 ref" href="#71vma" title='vma' data-ref="71vma">vma</a> = <a class="local col1 ref" href="#71vma" title='vma' data-ref="71vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>; <a class="local col1 ref" href="#71vma" title='vma' data-ref="71vma">vma</a>; <a class="local col1 ref" href="#71vma" title='vma' data-ref="71vma">vma</a> = <a class="local col1 ref" href="#71vma" title='vma' data-ref="71vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>) {</td></tr>
<tr><th id="540">540</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col2 decl" id="72overlap_len" title='overlap_len' data-type='unsigned long' data-ref="72overlap_len">overlap_len</dfn>;</td></tr>
<tr><th id="541">541</th><td></td></tr>
<tr><th id="542">542</th><td>		<b>if</b> (<a class="local col1 ref" href="#71vma" title='vma' data-ref="71vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &gt; <a class="local col9 ref" href="#69end" title='end' data-ref="69end">end</a>)</td></tr>
<tr><th id="543">543</th><td>			<b>break</b>;</td></tr>
<tr><th id="544">544</th><td></td></tr>
<tr><th id="545">545</th><td>		<a class="local col2 ref" href="#72overlap_len" title='overlap_len' data-ref="72overlap_len">overlap_len</a> = <a class="macro" href="../include/linux/kernel.h.html#799" title="({ typeof(end) __UNIQUE_ID_min1_121 = (end); typeof(vma-&gt;vm_end) __UNIQUE_ID_min2_122 = (vma-&gt;vm_end); (void) (&amp;__UNIQUE_ID_min1_121 == &amp;__UNIQUE_ID_min2_122); __UNIQUE_ID_min1_121 &lt; __UNIQUE_ID_min2_122 ? __UNIQUE_ID_min1_121 : __UNIQUE_ID_min2_122; })" data-ref="_M/min">min</a>(<a class="local col9 ref" href="#69end" title='end' data-ref="69end">end</a>, <a class="local col1 ref" href="#71vma" title='vma' data-ref="71vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>) - <a class="local col1 ref" href="#71vma" title='vma' data-ref="71vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>;</td></tr>
<tr><th id="546">546</th><td>		<a class="local col0 ref" href="#70nr_pages" title='nr_pages' data-ref="70nr_pages">nr_pages</a> += <a class="local col2 ref" href="#72overlap_len" title='overlap_len' data-ref="72overlap_len">overlap_len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="547">547</th><td>	}</td></tr>
<tr><th id="548">548</th><td></td></tr>
<tr><th id="549">549</th><td>	<b>return</b> <a class="local col0 ref" href="#70nr_pages" title='nr_pages' data-ref="70nr_pages">nr_pages</a>;</td></tr>
<tr><th id="550">550</th><td>}</td></tr>
<tr><th id="551">551</th><td></td></tr>
<tr><th id="552">552</th><td><em>void</em> <dfn class="decl def fn" id="__vma_link_rb" title='__vma_link_rb' data-ref="__vma_link_rb">__vma_link_rb</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col3 decl" id="73mm" title='mm' data-type='struct mm_struct *' data-ref="73mm">mm</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col4 decl" id="74vma" title='vma' data-type='struct vm_area_struct *' data-ref="74vma">vma</dfn>,</td></tr>
<tr><th id="553">553</th><td>		<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> **<dfn class="local col5 decl" id="75rb_link" title='rb_link' data-type='struct rb_node **' data-ref="75rb_link">rb_link</dfn>, <b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> *<dfn class="local col6 decl" id="76rb_parent" title='rb_parent' data-type='struct rb_node *' data-ref="76rb_parent">rb_parent</dfn>)</td></tr>
<tr><th id="554">554</th><td>{</td></tr>
<tr><th id="555">555</th><td>	<i>/* Update tracking information for the gap following the new vma. */</i></td></tr>
<tr><th id="556">556</th><td>	<b>if</b> (<a class="local col4 ref" href="#74vma" title='vma' data-ref="74vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>)</td></tr>
<tr><th id="557">557</th><td>		<a class="tu ref fn" href="#vma_gap_update" title='vma_gap_update' data-use='c' data-ref="vma_gap_update">vma_gap_update</a>(<a class="local col4 ref" href="#74vma" title='vma' data-ref="74vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>);</td></tr>
<tr><th id="558">558</th><td>	<b>else</b></td></tr>
<tr><th id="559">559</th><td>		<a class="local col3 ref" href="#73mm" title='mm' data-ref="73mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::highest_vm_end" title='mm_struct::highest_vm_end' data-ref="mm_struct::highest_vm_end">highest_vm_end</a> = <a class="ref fn" href="../include/linux/mm.h.html#vm_end_gap" title='vm_end_gap' data-ref="vm_end_gap">vm_end_gap</a>(<a class="local col4 ref" href="#74vma" title='vma' data-ref="74vma">vma</a>);</td></tr>
<tr><th id="560">560</th><td></td></tr>
<tr><th id="561">561</th><td>	<i>/*</i></td></tr>
<tr><th id="562">562</th><td><i>	 * vma-&gt;vm_prev wasn't known when we followed the rbtree to find the</i></td></tr>
<tr><th id="563">563</th><td><i>	 * correct insertion point for that vma. As a result, we could not</i></td></tr>
<tr><th id="564">564</th><td><i>	 * update the vma vm_rb parents rb_subtree_gap values on the way down.</i></td></tr>
<tr><th id="565">565</th><td><i>	 * So, we first insert the vma with a zero rb_subtree_gap value</i></td></tr>
<tr><th id="566">566</th><td><i>	 * (to be consistent with what we did on the way down), and then</i></td></tr>
<tr><th id="567">567</th><td><i>	 * immediately update the gap to the correct value. Finally we</i></td></tr>
<tr><th id="568">568</th><td><i>	 * rebalance the rbtree after all augmented values have been set.</i></td></tr>
<tr><th id="569">569</th><td><i>	 */</i></td></tr>
<tr><th id="570">570</th><td>	<a class="ref fn" href="../include/linux/rbtree.h.html#rb_link_node" title='rb_link_node' data-ref="rb_link_node">rb_link_node</a>(&amp;<a class="local col4 ref" href="#74vma" title='vma' data-ref="74vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>, <a class="local col6 ref" href="#76rb_parent" title='rb_parent' data-ref="76rb_parent">rb_parent</a>, <a class="local col5 ref" href="#75rb_link" title='rb_link' data-ref="75rb_link">rb_link</a>);</td></tr>
<tr><th id="571">571</th><td>	<a class="local col4 ref" href="#74vma" title='vma' data-ref="74vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::rb_subtree_gap" title='vm_area_struct::rb_subtree_gap' data-ref="vm_area_struct::rb_subtree_gap">rb_subtree_gap</a> = <var>0</var>;</td></tr>
<tr><th id="572">572</th><td>	<a class="tu ref fn" href="#vma_gap_update" title='vma_gap_update' data-use='c' data-ref="vma_gap_update">vma_gap_update</a>(<a class="local col4 ref" href="#74vma" title='vma' data-ref="74vma">vma</a>);</td></tr>
<tr><th id="573">573</th><td>	<a class="tu ref fn" href="#vma_rb_insert" title='vma_rb_insert' data-use='c' data-ref="vma_rb_insert">vma_rb_insert</a>(<a class="local col4 ref" href="#74vma" title='vma' data-ref="74vma">vma</a>, &amp;<a class="local col3 ref" href="#73mm" title='mm' data-ref="73mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mm_rb" title='mm_struct::mm_rb' data-ref="mm_struct::mm_rb">mm_rb</a>);</td></tr>
<tr><th id="574">574</th><td>}</td></tr>
<tr><th id="575">575</th><td></td></tr>
<tr><th id="576">576</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="__vma_link_file" title='__vma_link_file' data-type='void __vma_link_file(struct vm_area_struct * vma)' data-ref="__vma_link_file">__vma_link_file</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col7 decl" id="77vma" title='vma' data-type='struct vm_area_struct *' data-ref="77vma">vma</dfn>)</td></tr>
<tr><th id="577">577</th><td>{</td></tr>
<tr><th id="578">578</th><td>	<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col8 decl" id="78file" title='file' data-type='struct file *' data-ref="78file">file</dfn>;</td></tr>
<tr><th id="579">579</th><td></td></tr>
<tr><th id="580">580</th><td>	<a class="local col8 ref" href="#78file" title='file' data-ref="78file">file</a> = <a class="local col7 ref" href="#77vma" title='vma' data-ref="77vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>;</td></tr>
<tr><th id="581">581</th><td>	<b>if</b> (<a class="local col8 ref" href="#78file" title='file' data-ref="78file">file</a>) {</td></tr>
<tr><th id="582">582</th><td>		<b>struct</b> <a class="type" href="../include/linux/fs.h.html#address_space" title='address_space' data-ref="address_space">address_space</a> *<dfn class="local col9 decl" id="79mapping" title='mapping' data-type='struct address_space *' data-ref="79mapping">mapping</dfn> = <a class="local col8 ref" href="#78file" title='file' data-ref="78file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a>;</td></tr>
<tr><th id="583">583</th><td></td></tr>
<tr><th id="584">584</th><td>		<b>if</b> (<a class="local col7 ref" href="#77vma" title='vma' data-ref="77vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#177" title="0x00000800" data-ref="_M/VM_DENYWRITE">VM_DENYWRITE</a>)</td></tr>
<tr><th id="585">585</th><td>			<a class="ref fn" href="../arch/x86/include/asm/atomic.h.html#atomic_dec" title='atomic_dec' data-ref="atomic_dec">atomic_dec</a>(&amp;<a class="ref fn" href="../include/linux/fs.h.html#file_inode" title='file_inode' data-ref="file_inode">file_inode</a>(<a class="local col8 ref" href="#78file" title='file' data-ref="78file">file</a>)-&gt;<a class="ref field" href="../include/linux/fs.h.html#inode::i_writecount" title='inode::i_writecount' data-ref="inode::i_writecount">i_writecount</a>);</td></tr>
<tr><th id="586">586</th><td>		<b>if</b> (<a class="local col7 ref" href="#77vma" title='vma' data-ref="77vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a>)</td></tr>
<tr><th id="587">587</th><td>			<a class="ref fn" href="../arch/x86/include/asm/atomic.h.html#atomic_inc" title='atomic_inc' data-ref="atomic_inc">atomic_inc</a>(&amp;<a class="local col9 ref" href="#79mapping" title='mapping' data-ref="79mapping">mapping</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#address_space::i_mmap_writable" title='address_space::i_mmap_writable' data-ref="address_space::i_mmap_writable">i_mmap_writable</a>);</td></tr>
<tr><th id="588">588</th><td></td></tr>
<tr><th id="589">589</th><td>		<a class="macro" href="../include/asm-generic/cacheflush.h.html#19" title="do { } while (0)" data-ref="_M/flush_dcache_mmap_lock">flush_dcache_mmap_lock</a>(mapping);</td></tr>
<tr><th id="590">590</th><td>		<a class="ref fn" href="../include/linux/mm.h.html#vma_interval_tree_insert" title='vma_interval_tree_insert' data-ref="vma_interval_tree_insert">vma_interval_tree_insert</a>(<a class="local col7 ref" href="#77vma" title='vma' data-ref="77vma">vma</a>, &amp;<a class="local col9 ref" href="#79mapping" title='mapping' data-ref="79mapping">mapping</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#address_space::i_mmap" title='address_space::i_mmap' data-ref="address_space::i_mmap">i_mmap</a>);</td></tr>
<tr><th id="591">591</th><td>		<a class="macro" href="../include/asm-generic/cacheflush.h.html#20" title="do { } while (0)" data-ref="_M/flush_dcache_mmap_unlock">flush_dcache_mmap_unlock</a>(mapping);</td></tr>
<tr><th id="592">592</th><td>	}</td></tr>
<tr><th id="593">593</th><td>}</td></tr>
<tr><th id="594">594</th><td></td></tr>
<tr><th id="595">595</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="596">596</th><td><dfn class="tu decl def fn" id="__vma_link" title='__vma_link' data-type='void __vma_link(struct mm_struct * mm, struct vm_area_struct * vma, struct vm_area_struct * prev, struct rb_node ** rb_link, struct rb_node * rb_parent)' data-ref="__vma_link">__vma_link</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col0 decl" id="80mm" title='mm' data-type='struct mm_struct *' data-ref="80mm">mm</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col1 decl" id="81vma" title='vma' data-type='struct vm_area_struct *' data-ref="81vma">vma</dfn>,</td></tr>
<tr><th id="597">597</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="82prev" title='prev' data-type='struct vm_area_struct *' data-ref="82prev">prev</dfn>, <b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> **<dfn class="local col3 decl" id="83rb_link" title='rb_link' data-type='struct rb_node **' data-ref="83rb_link">rb_link</dfn>,</td></tr>
<tr><th id="598">598</th><td>	<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> *<dfn class="local col4 decl" id="84rb_parent" title='rb_parent' data-type='struct rb_node *' data-ref="84rb_parent">rb_parent</dfn>)</td></tr>
<tr><th id="599">599</th><td>{</td></tr>
<tr><th id="600">600</th><td>	<a class="ref fn" href="internal.h.html#__vma_link_list" title='__vma_link_list' data-ref="__vma_link_list">__vma_link_list</a>(<a class="local col0 ref" href="#80mm" title='mm' data-ref="80mm">mm</a>, <a class="local col1 ref" href="#81vma" title='vma' data-ref="81vma">vma</a>, <a class="local col2 ref" href="#82prev" title='prev' data-ref="82prev">prev</a>, <a class="local col4 ref" href="#84rb_parent" title='rb_parent' data-ref="84rb_parent">rb_parent</a>);</td></tr>
<tr><th id="601">601</th><td>	<a class="ref fn" href="#__vma_link_rb" title='__vma_link_rb' data-ref="__vma_link_rb">__vma_link_rb</a>(<a class="local col0 ref" href="#80mm" title='mm' data-ref="80mm">mm</a>, <a class="local col1 ref" href="#81vma" title='vma' data-ref="81vma">vma</a>, <a class="local col3 ref" href="#83rb_link" title='rb_link' data-ref="83rb_link">rb_link</a>, <a class="local col4 ref" href="#84rb_parent" title='rb_parent' data-ref="84rb_parent">rb_parent</a>);</td></tr>
<tr><th id="602">602</th><td>}</td></tr>
<tr><th id="603">603</th><td></td></tr>
<tr><th id="604">604</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vma_link" title='vma_link' data-type='void vma_link(struct mm_struct * mm, struct vm_area_struct * vma, struct vm_area_struct * prev, struct rb_node ** rb_link, struct rb_node * rb_parent)' data-ref="vma_link">vma_link</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col5 decl" id="85mm" title='mm' data-type='struct mm_struct *' data-ref="85mm">mm</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col6 decl" id="86vma" title='vma' data-type='struct vm_area_struct *' data-ref="86vma">vma</dfn>,</td></tr>
<tr><th id="605">605</th><td>			<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col7 decl" id="87prev" title='prev' data-type='struct vm_area_struct *' data-ref="87prev">prev</dfn>, <b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> **<dfn class="local col8 decl" id="88rb_link" title='rb_link' data-type='struct rb_node **' data-ref="88rb_link">rb_link</dfn>,</td></tr>
<tr><th id="606">606</th><td>			<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> *<dfn class="local col9 decl" id="89rb_parent" title='rb_parent' data-type='struct rb_node *' data-ref="89rb_parent">rb_parent</dfn>)</td></tr>
<tr><th id="607">607</th><td>{</td></tr>
<tr><th id="608">608</th><td>	<b>struct</b> <a class="type" href="../include/linux/fs.h.html#address_space" title='address_space' data-ref="address_space">address_space</a> *<dfn class="local col0 decl" id="90mapping" title='mapping' data-type='struct address_space *' data-ref="90mapping">mapping</dfn> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="609">609</th><td></td></tr>
<tr><th id="610">610</th><td>	<b>if</b> (<a class="local col6 ref" href="#86vma" title='vma' data-ref="86vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>) {</td></tr>
<tr><th id="611">611</th><td>		<a class="local col0 ref" href="#90mapping" title='mapping' data-ref="90mapping">mapping</a> = <a class="local col6 ref" href="#86vma" title='vma' data-ref="86vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a>;</td></tr>
<tr><th id="612">612</th><td>		<a class="ref fn" href="../include/linux/fs.h.html#i_mmap_lock_write" title='i_mmap_lock_write' data-ref="i_mmap_lock_write">i_mmap_lock_write</a>(<a class="local col0 ref" href="#90mapping" title='mapping' data-ref="90mapping">mapping</a>);</td></tr>
<tr><th id="613">613</th><td>	}</td></tr>
<tr><th id="614">614</th><td></td></tr>
<tr><th id="615">615</th><td>	<a class="tu ref fn" href="#__vma_link" title='__vma_link' data-use='c' data-ref="__vma_link">__vma_link</a>(<a class="local col5 ref" href="#85mm" title='mm' data-ref="85mm">mm</a>, <a class="local col6 ref" href="#86vma" title='vma' data-ref="86vma">vma</a>, <a class="local col7 ref" href="#87prev" title='prev' data-ref="87prev">prev</a>, <a class="local col8 ref" href="#88rb_link" title='rb_link' data-ref="88rb_link">rb_link</a>, <a class="local col9 ref" href="#89rb_parent" title='rb_parent' data-ref="89rb_parent">rb_parent</a>);</td></tr>
<tr><th id="616">616</th><td>	<a class="tu ref fn" href="#__vma_link_file" title='__vma_link_file' data-use='c' data-ref="__vma_link_file">__vma_link_file</a>(<a class="local col6 ref" href="#86vma" title='vma' data-ref="86vma">vma</a>);</td></tr>
<tr><th id="617">617</th><td></td></tr>
<tr><th id="618">618</th><td>	<b>if</b> (<a class="local col0 ref" href="#90mapping" title='mapping' data-ref="90mapping">mapping</a>)</td></tr>
<tr><th id="619">619</th><td>		<a class="ref fn" href="../include/linux/fs.h.html#i_mmap_unlock_write" title='i_mmap_unlock_write' data-ref="i_mmap_unlock_write">i_mmap_unlock_write</a>(<a class="local col0 ref" href="#90mapping" title='mapping' data-ref="90mapping">mapping</a>);</td></tr>
<tr><th id="620">620</th><td></td></tr>
<tr><th id="621">621</th><td>	<a class="local col5 ref" href="#85mm" title='mm' data-ref="85mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::map_count" title='mm_struct::map_count' data-ref="mm_struct::map_count">map_count</a>++;</td></tr>
<tr><th id="622">622</th><td>	<a class="macro" href="#393" title="do { } while (0)" data-ref="_M/validate_mm">validate_mm</a>(mm);</td></tr>
<tr><th id="623">623</th><td>}</td></tr>
<tr><th id="624">624</th><td></td></tr>
<tr><th id="625">625</th><td><i  data-doc="__insert_vm_struct">/*</i></td></tr>
<tr><th id="626">626</th><td><i  data-doc="__insert_vm_struct"> * Helper for vma_adjust() in the split_vma insert case: insert a vma into the</i></td></tr>
<tr><th id="627">627</th><td><i  data-doc="__insert_vm_struct"> * mm's list and rbtree.  It has already been inserted into the interval tree.</i></td></tr>
<tr><th id="628">628</th><td><i  data-doc="__insert_vm_struct"> */</i></td></tr>
<tr><th id="629">629</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="__insert_vm_struct" title='__insert_vm_struct' data-type='void __insert_vm_struct(struct mm_struct * mm, struct vm_area_struct * vma)' data-ref="__insert_vm_struct">__insert_vm_struct</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col1 decl" id="91mm" title='mm' data-type='struct mm_struct *' data-ref="91mm">mm</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="92vma" title='vma' data-type='struct vm_area_struct *' data-ref="92vma">vma</dfn>)</td></tr>
<tr><th id="630">630</th><td>{</td></tr>
<tr><th id="631">631</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col3 decl" id="93prev" title='prev' data-type='struct vm_area_struct *' data-ref="93prev">prev</dfn>;</td></tr>
<tr><th id="632">632</th><td>	<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> **<dfn class="local col4 decl" id="94rb_link" title='rb_link' data-type='struct rb_node **' data-ref="94rb_link">rb_link</dfn>, *<dfn class="local col5 decl" id="95rb_parent" title='rb_parent' data-type='struct rb_node *' data-ref="95rb_parent">rb_parent</dfn>;</td></tr>
<tr><th id="633">633</th><td></td></tr>
<tr><th id="634">634</th><td>	<b>if</b> (<a class="tu ref fn" href="#find_vma_links" title='find_vma_links' data-use='c' data-ref="find_vma_links">find_vma_links</a>(<a class="local col1 ref" href="#91mm" title='mm' data-ref="91mm">mm</a>, <a class="local col2 ref" href="#92vma" title='vma' data-ref="92vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>, <a class="local col2 ref" href="#92vma" title='vma' data-ref="92vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>,</td></tr>
<tr><th id="635">635</th><td>			   &amp;<a class="local col3 ref" href="#93prev" title='prev' data-ref="93prev">prev</a>, &amp;<a class="local col4 ref" href="#94rb_link" title='rb_link' data-ref="94rb_link">rb_link</a>, &amp;<a class="local col5 ref" href="#95rb_parent" title='rb_parent' data-ref="95rb_parent">rb_parent</a>))</td></tr>
<tr><th id="636">636</th><td>		<a class="macro" href="../arch/x86/include/asm/bug.h.html#71" title="do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/mm/mmap.c&quot;), &quot;i&quot; (636), &quot;i&quot; (0), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); do { ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (125)); }); do { } while (1); } while (0); } while (0)" data-ref="_M/BUG">BUG</a>();</td></tr>
<tr><th id="637">637</th><td>	<a class="tu ref fn" href="#__vma_link" title='__vma_link' data-use='c' data-ref="__vma_link">__vma_link</a>(<a class="local col1 ref" href="#91mm" title='mm' data-ref="91mm">mm</a>, <a class="local col2 ref" href="#92vma" title='vma' data-ref="92vma">vma</a>, <a class="local col3 ref" href="#93prev" title='prev' data-ref="93prev">prev</a>, <a class="local col4 ref" href="#94rb_link" title='rb_link' data-ref="94rb_link">rb_link</a>, <a class="local col5 ref" href="#95rb_parent" title='rb_parent' data-ref="95rb_parent">rb_parent</a>);</td></tr>
<tr><th id="638">638</th><td>	<a class="local col1 ref" href="#91mm" title='mm' data-ref="91mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::map_count" title='mm_struct::map_count' data-ref="mm_struct::map_count">map_count</a>++;</td></tr>
<tr><th id="639">639</th><td>}</td></tr>
<tr><th id="640">640</th><td></td></tr>
<tr><th id="641">641</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#103" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) __attribute__((always_inline))" data-ref="_M/__always_inline">__always_inline</a> <em>void</em> <dfn class="tu decl def fn" id="__vma_unlink_common" title='__vma_unlink_common' data-type='void __vma_unlink_common(struct mm_struct * mm, struct vm_area_struct * vma, struct vm_area_struct * prev, bool has_prev, struct vm_area_struct * ignore)' data-ref="__vma_unlink_common">__vma_unlink_common</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col6 decl" id="96mm" title='mm' data-type='struct mm_struct *' data-ref="96mm">mm</dfn>,</td></tr>
<tr><th id="642">642</th><td>						<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col7 decl" id="97vma" title='vma' data-type='struct vm_area_struct *' data-ref="97vma">vma</dfn>,</td></tr>
<tr><th id="643">643</th><td>						<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col8 decl" id="98prev" title='prev' data-type='struct vm_area_struct *' data-ref="98prev">prev</dfn>,</td></tr>
<tr><th id="644">644</th><td>						<a class="typedef" href="../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="local col9 decl" id="99has_prev" title='has_prev' data-type='bool' data-ref="99has_prev">has_prev</dfn>,</td></tr>
<tr><th id="645">645</th><td>						<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col0 decl" id="100ignore" title='ignore' data-type='struct vm_area_struct *' data-ref="100ignore">ignore</dfn>)</td></tr>
<tr><th id="646">646</th><td>{</td></tr>
<tr><th id="647">647</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col1 decl" id="101next" title='next' data-type='struct vm_area_struct *' data-ref="101next">next</dfn>;</td></tr>
<tr><th id="648">648</th><td></td></tr>
<tr><th id="649">649</th><td>	<a class="tu ref fn" href="#vma_rb_erase_ignore" title='vma_rb_erase_ignore' data-use='c' data-ref="vma_rb_erase_ignore">vma_rb_erase_ignore</a>(<a class="local col7 ref" href="#97vma" title='vma' data-ref="97vma">vma</a>, &amp;<a class="local col6 ref" href="#96mm" title='mm' data-ref="96mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mm_rb" title='mm_struct::mm_rb' data-ref="mm_struct::mm_rb">mm_rb</a>, <a class="local col0 ref" href="#100ignore" title='ignore' data-ref="100ignore">ignore</a>);</td></tr>
<tr><th id="650">650</th><td>	<a class="local col1 ref" href="#101next" title='next' data-ref="101next">next</a> = <a class="local col7 ref" href="#97vma" title='vma' data-ref="97vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>;</td></tr>
<tr><th id="651">651</th><td>	<b>if</b> (<a class="local col9 ref" href="#99has_prev" title='has_prev' data-ref="99has_prev">has_prev</a>)</td></tr>
<tr><th id="652">652</th><td>		<a class="local col8 ref" href="#98prev" title='prev' data-ref="98prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a> = <a class="local col1 ref" href="#101next" title='next' data-ref="101next">next</a>;</td></tr>
<tr><th id="653">653</th><td>	<b>else</b> {</td></tr>
<tr><th id="654">654</th><td>		<a class="local col8 ref" href="#98prev" title='prev' data-ref="98prev">prev</a> = <a class="local col7 ref" href="#97vma" title='vma' data-ref="97vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a>;</td></tr>
<tr><th id="655">655</th><td>		<b>if</b> (<a class="local col8 ref" href="#98prev" title='prev' data-ref="98prev">prev</a>)</td></tr>
<tr><th id="656">656</th><td>			<a class="local col8 ref" href="#98prev" title='prev' data-ref="98prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a> = <a class="local col1 ref" href="#101next" title='next' data-ref="101next">next</a>;</td></tr>
<tr><th id="657">657</th><td>		<b>else</b></td></tr>
<tr><th id="658">658</th><td>			<a class="local col6 ref" href="#96mm" title='mm' data-ref="96mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap" title='mm_struct::mmap' data-ref="mm_struct::mmap">mmap</a> = <a class="local col1 ref" href="#101next" title='next' data-ref="101next">next</a>;</td></tr>
<tr><th id="659">659</th><td>	}</td></tr>
<tr><th id="660">660</th><td>	<b>if</b> (<a class="local col1 ref" href="#101next" title='next' data-ref="101next">next</a>)</td></tr>
<tr><th id="661">661</th><td>		<a class="local col1 ref" href="#101next" title='next' data-ref="101next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a> = <a class="local col8 ref" href="#98prev" title='prev' data-ref="98prev">prev</a>;</td></tr>
<tr><th id="662">662</th><td></td></tr>
<tr><th id="663">663</th><td>	<i>/* Kill the cache */</i></td></tr>
<tr><th id="664">664</th><td>	<a class="ref fn" href="../include/linux/vmacache.h.html#vmacache_invalidate" title='vmacache_invalidate' data-ref="vmacache_invalidate">vmacache_invalidate</a>(<a class="local col6 ref" href="#96mm" title='mm' data-ref="96mm">mm</a>);</td></tr>
<tr><th id="665">665</th><td>}</td></tr>
<tr><th id="666">666</th><td></td></tr>
<tr><th id="667">667</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>void</em> <dfn class="tu decl def fn" id="__vma_unlink_prev" title='__vma_unlink_prev' data-type='void __vma_unlink_prev(struct mm_struct * mm, struct vm_area_struct * vma, struct vm_area_struct * prev)' data-ref="__vma_unlink_prev">__vma_unlink_prev</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col2 decl" id="102mm" title='mm' data-type='struct mm_struct *' data-ref="102mm">mm</dfn>,</td></tr>
<tr><th id="668">668</th><td>				     <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col3 decl" id="103vma" title='vma' data-type='struct vm_area_struct *' data-ref="103vma">vma</dfn>,</td></tr>
<tr><th id="669">669</th><td>				     <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col4 decl" id="104prev" title='prev' data-type='struct vm_area_struct *' data-ref="104prev">prev</dfn>)</td></tr>
<tr><th id="670">670</th><td>{</td></tr>
<tr><th id="671">671</th><td>	<a class="tu ref fn" href="#__vma_unlink_common" title='__vma_unlink_common' data-use='c' data-ref="__vma_unlink_common">__vma_unlink_common</a>(<a class="local col2 ref" href="#102mm" title='mm' data-ref="102mm">mm</a>, <a class="local col3 ref" href="#103vma" title='vma' data-ref="103vma">vma</a>, <a class="local col4 ref" href="#104prev" title='prev' data-ref="104prev">prev</a>, <a class="enum" href="../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>, <a class="local col3 ref" href="#103vma" title='vma' data-ref="103vma">vma</a>);</td></tr>
<tr><th id="672">672</th><td>}</td></tr>
<tr><th id="673">673</th><td></td></tr>
<tr><th id="674">674</th><td><i>/*</i></td></tr>
<tr><th id="675">675</th><td><i> * We cannot adjust vm_start, vm_end, vm_pgoff fields of a vma that</i></td></tr>
<tr><th id="676">676</th><td><i> * is already present in an i_mmap tree without adjusting the tree.</i></td></tr>
<tr><th id="677">677</th><td><i> * The following helper function should be used when such adjustments</i></td></tr>
<tr><th id="678">678</th><td><i> * are necessary.  The "insert" vma (if any) is to be inserted</i></td></tr>
<tr><th id="679">679</th><td><i> * before we drop the necessary locks.</i></td></tr>
<tr><th id="680">680</th><td><i> */</i></td></tr>
<tr><th id="681">681</th><td><em>int</em> <dfn class="decl def fn" id="__vma_adjust" title='__vma_adjust' data-ref="__vma_adjust">__vma_adjust</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col5 decl" id="105vma" title='vma' data-type='struct vm_area_struct *' data-ref="105vma">vma</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="106start" title='start' data-type='unsigned long' data-ref="106start">start</dfn>,</td></tr>
<tr><th id="682">682</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="107end" title='end' data-type='unsigned long' data-ref="107end">end</dfn>, <a class="macro" href="../include/linux/types.h.html#141" title="unsigned long" data-ref="_M/pgoff_t">pgoff_t</a> <dfn class="local col8 decl" id="108pgoff" title='pgoff' data-type='unsigned long' data-ref="108pgoff">pgoff</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col9 decl" id="109insert" title='insert' data-type='struct vm_area_struct *' data-ref="109insert">insert</dfn>,</td></tr>
<tr><th id="683">683</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col0 decl" id="110expand" title='expand' data-type='struct vm_area_struct *' data-ref="110expand">expand</dfn>)</td></tr>
<tr><th id="684">684</th><td>{</td></tr>
<tr><th id="685">685</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col1 decl" id="111mm" title='mm' data-type='struct mm_struct *' data-ref="111mm">mm</dfn> = <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_mm" title='vm_area_struct::vm_mm' data-ref="vm_area_struct::vm_mm">vm_mm</a>;</td></tr>
<tr><th id="686">686</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="112next" title='next' data-type='struct vm_area_struct *' data-ref="112next">next</dfn> = <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>, *<dfn class="local col3 decl" id="113orig_vma" title='orig_vma' data-type='struct vm_area_struct *' data-ref="113orig_vma">orig_vma</dfn> = <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>;</td></tr>
<tr><th id="687">687</th><td>	<b>struct</b> <a class="type" href="../include/linux/fs.h.html#address_space" title='address_space' data-ref="address_space">address_space</a> *<dfn class="local col4 decl" id="114mapping" title='mapping' data-type='struct address_space *' data-ref="114mapping">mapping</dfn> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="688">688</th><td>	<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_root_cached" title='rb_root_cached' data-ref="rb_root_cached">rb_root_cached</a> *<dfn class="local col5 decl" id="115root" title='root' data-type='struct rb_root_cached *' data-ref="115root">root</dfn> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="689">689</th><td>	<b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma" title='anon_vma' data-ref="anon_vma">anon_vma</a> *<dfn class="local col6 decl" id="116anon_vma" title='anon_vma' data-type='struct anon_vma *' data-ref="116anon_vma">anon_vma</dfn> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="690">690</th><td>	<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col7 decl" id="117file" title='file' data-type='struct file *' data-ref="117file">file</dfn> = <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>;</td></tr>
<tr><th id="691">691</th><td>	<a class="typedef" href="../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="local col8 decl" id="118start_changed" title='start_changed' data-type='bool' data-ref="118start_changed">start_changed</dfn> = <a class="enum" href="../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>, <dfn class="local col9 decl" id="119end_changed" title='end_changed' data-type='bool' data-ref="119end_changed">end_changed</dfn> = <a class="enum" href="../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="692">692</th><td>	<em>long</em> <dfn class="local col0 decl" id="120adjust_next" title='adjust_next' data-type='long' data-ref="120adjust_next">adjust_next</dfn> = <var>0</var>;</td></tr>
<tr><th id="693">693</th><td>	<em>int</em> <dfn class="local col1 decl" id="121remove_next" title='remove_next' data-type='int' data-ref="121remove_next">remove_next</dfn> = <var>0</var>;</td></tr>
<tr><th id="694">694</th><td></td></tr>
<tr><th id="695">695</th><td>	<b>if</b> (<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a> &amp;&amp; !<a class="local col9 ref" href="#109insert" title='insert' data-ref="109insert">insert</a>) {</td></tr>
<tr><th id="696">696</th><td>		<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="122exporter" title='exporter' data-type='struct vm_area_struct *' data-ref="122exporter">exporter</dfn> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, *<dfn class="local col3 decl" id="123importer" title='importer' data-type='struct vm_area_struct *' data-ref="123importer">importer</dfn> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="697">697</th><td></td></tr>
<tr><th id="698">698</th><td>		<b>if</b> (<a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a> &gt;= <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>) {</td></tr>
<tr><th id="699">699</th><td>			<i>/*</i></td></tr>
<tr><th id="700">700</th><td><i>			 * vma expands, overlapping all the next, and</i></td></tr>
<tr><th id="701">701</th><td><i>			 * perhaps the one after too (mprotect case 6).</i></td></tr>
<tr><th id="702">702</th><td><i>			 * The only other cases that gets here are</i></td></tr>
<tr><th id="703">703</th><td><i>			 * case 1, case 7 and case 8.</i></td></tr>
<tr><th id="704">704</th><td><i>			 */</i></td></tr>
<tr><th id="705">705</th><td>			<b>if</b> (<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a> == <a class="local col0 ref" href="#110expand" title='expand' data-ref="110expand">expand</a>) {</td></tr>
<tr><th id="706">706</th><td>				<i>/*</i></td></tr>
<tr><th id="707">707</th><td><i>				 * The only case where we don't expand "vma"</i></td></tr>
<tr><th id="708">708</th><td><i>				 * and we expand "next" instead is case 8.</i></td></tr>
<tr><th id="709">709</th><td><i>				 */</i></td></tr>
<tr><th id="710">710</th><td>				<a class="macro" href="../include/linux/mmdebug.h.html#49" title="((void)(sizeof(( long)(end != next-&gt;vm_end))))" data-ref="_M/VM_WARN_ON">VM_WARN_ON</a>(<a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a> != <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>);</td></tr>
<tr><th id="711">711</th><td>				<i>/*</i></td></tr>
<tr><th id="712">712</th><td><i>				 * remove_next == 3 means we're</i></td></tr>
<tr><th id="713">713</th><td><i>				 * removing "vma" and that to do so we</i></td></tr>
<tr><th id="714">714</th><td><i>				 * swapped "vma" and "next".</i></td></tr>
<tr><th id="715">715</th><td><i>				 */</i></td></tr>
<tr><th id="716">716</th><td>				<a class="local col1 ref" href="#121remove_next" title='remove_next' data-ref="121remove_next">remove_next</a> = <var>3</var>;</td></tr>
<tr><th id="717">717</th><td>				<a class="macro" href="../include/linux/mmdebug.h.html#49" title="((void)(sizeof(( long)(file != next-&gt;vm_file))))" data-ref="_M/VM_WARN_ON">VM_WARN_ON</a>(<a class="local col7 ref" href="#117file" title='file' data-ref="117file">file</a> != <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>);</td></tr>
<tr><th id="718">718</th><td>				<a class="macro" href="../include/linux/kernel.h.html#917" title="do { typeof(vma) __tmp = (vma); (vma) = (next); (next) = __tmp; } while (0)" data-ref="_M/swap">swap</a>(<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>, <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>);</td></tr>
<tr><th id="719">719</th><td>			} <b>else</b> {</td></tr>
<tr><th id="720">720</th><td>				<a class="macro" href="../include/linux/mmdebug.h.html#49" title="((void)(sizeof(( long)(expand != vma))))" data-ref="_M/VM_WARN_ON">VM_WARN_ON</a>(<a class="local col0 ref" href="#110expand" title='expand' data-ref="110expand">expand</a> != <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>);</td></tr>
<tr><th id="721">721</th><td>				<i>/*</i></td></tr>
<tr><th id="722">722</th><td><i>				 * case 1, 6, 7, remove_next == 2 is case 6,</i></td></tr>
<tr><th id="723">723</th><td><i>				 * remove_next == 1 is case 1 or 7.</i></td></tr>
<tr><th id="724">724</th><td><i>				 */</i></td></tr>
<tr><th id="725">725</th><td>				<a class="local col1 ref" href="#121remove_next" title='remove_next' data-ref="121remove_next">remove_next</a> = <var>1</var> + (<a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a> &gt; <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>);</td></tr>
<tr><th id="726">726</th><td>				<a class="macro" href="../include/linux/mmdebug.h.html#49" title="((void)(sizeof(( long)(remove_next == 2 &amp;&amp; end != next-&gt;vm_next-&gt;vm_end))))" data-ref="_M/VM_WARN_ON">VM_WARN_ON</a>(<a class="local col1 ref" href="#121remove_next" title='remove_next' data-ref="121remove_next">remove_next</a> == <var>2</var> &amp;&amp;</td></tr>
<tr><th id="727">727</th><td>					   <a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a> != <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>);</td></tr>
<tr><th id="728">728</th><td>				<a class="macro" href="../include/linux/mmdebug.h.html#49" title="((void)(sizeof(( long)(remove_next == 1 &amp;&amp; end != next-&gt;vm_end))))" data-ref="_M/VM_WARN_ON">VM_WARN_ON</a>(<a class="local col1 ref" href="#121remove_next" title='remove_next' data-ref="121remove_next">remove_next</a> == <var>1</var> &amp;&amp;</td></tr>
<tr><th id="729">729</th><td>					   <a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a> != <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>);</td></tr>
<tr><th id="730">730</th><td>				<i>/* trim end to next, for case 6 first pass */</i></td></tr>
<tr><th id="731">731</th><td>				<a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a> = <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>;</td></tr>
<tr><th id="732">732</th><td>			}</td></tr>
<tr><th id="733">733</th><td></td></tr>
<tr><th id="734">734</th><td>			<a class="local col2 ref" href="#122exporter" title='exporter' data-ref="122exporter">exporter</a> = <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>;</td></tr>
<tr><th id="735">735</th><td>			<a class="local col3 ref" href="#123importer" title='importer' data-ref="123importer">importer</a> = <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>;</td></tr>
<tr><th id="736">736</th><td></td></tr>
<tr><th id="737">737</th><td>			<i>/*</i></td></tr>
<tr><th id="738">738</th><td><i>			 * If next doesn't have anon_vma, import from vma after</i></td></tr>
<tr><th id="739">739</th><td><i>			 * next, if the vma overlaps with it.</i></td></tr>
<tr><th id="740">740</th><td><i>			 */</i></td></tr>
<tr><th id="741">741</th><td>			<b>if</b> (<a class="local col1 ref" href="#121remove_next" title='remove_next' data-ref="121remove_next">remove_next</a> == <var>2</var> &amp;&amp; !<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>)</td></tr>
<tr><th id="742">742</th><td>				<a class="local col2 ref" href="#122exporter" title='exporter' data-ref="122exporter">exporter</a> = <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>;</td></tr>
<tr><th id="743">743</th><td></td></tr>
<tr><th id="744">744</th><td>		} <b>else</b> <b>if</b> (<a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a> &gt; <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>) {</td></tr>
<tr><th id="745">745</th><td>			<i>/*</i></td></tr>
<tr><th id="746">746</th><td><i>			 * vma expands, overlapping part of the next:</i></td></tr>
<tr><th id="747">747</th><td><i>			 * mprotect case 5 shifting the boundary up.</i></td></tr>
<tr><th id="748">748</th><td><i>			 */</i></td></tr>
<tr><th id="749">749</th><td>			<a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a> = (<a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a> - <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>) &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="750">750</th><td>			<a class="local col2 ref" href="#122exporter" title='exporter' data-ref="122exporter">exporter</a> = <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>;</td></tr>
<tr><th id="751">751</th><td>			<a class="local col3 ref" href="#123importer" title='importer' data-ref="123importer">importer</a> = <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>;</td></tr>
<tr><th id="752">752</th><td>			<a class="macro" href="../include/linux/mmdebug.h.html#49" title="((void)(sizeof(( long)(expand != importer))))" data-ref="_M/VM_WARN_ON">VM_WARN_ON</a>(<a class="local col0 ref" href="#110expand" title='expand' data-ref="110expand">expand</a> != <a class="local col3 ref" href="#123importer" title='importer' data-ref="123importer">importer</a>);</td></tr>
<tr><th id="753">753</th><td>		} <b>else</b> <b>if</b> (<a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a> &lt; <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>) {</td></tr>
<tr><th id="754">754</th><td>			<i>/*</i></td></tr>
<tr><th id="755">755</th><td><i>			 * vma shrinks, and !insert tells it's not</i></td></tr>
<tr><th id="756">756</th><td><i>			 * split_vma inserting another: so it must be</i></td></tr>
<tr><th id="757">757</th><td><i>			 * mprotect case 4 shifting the boundary down.</i></td></tr>
<tr><th id="758">758</th><td><i>			 */</i></td></tr>
<tr><th id="759">759</th><td>			<a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a> = -((<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> - <a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a>) &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>);</td></tr>
<tr><th id="760">760</th><td>			<a class="local col2 ref" href="#122exporter" title='exporter' data-ref="122exporter">exporter</a> = <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>;</td></tr>
<tr><th id="761">761</th><td>			<a class="local col3 ref" href="#123importer" title='importer' data-ref="123importer">importer</a> = <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>;</td></tr>
<tr><th id="762">762</th><td>			<a class="macro" href="../include/linux/mmdebug.h.html#49" title="((void)(sizeof(( long)(expand != importer))))" data-ref="_M/VM_WARN_ON">VM_WARN_ON</a>(<a class="local col0 ref" href="#110expand" title='expand' data-ref="110expand">expand</a> != <a class="local col3 ref" href="#123importer" title='importer' data-ref="123importer">importer</a>);</td></tr>
<tr><th id="763">763</th><td>		}</td></tr>
<tr><th id="764">764</th><td></td></tr>
<tr><th id="765">765</th><td>		<i>/*</i></td></tr>
<tr><th id="766">766</th><td><i>		 * Easily overlooked: when mprotect shifts the boundary,</i></td></tr>
<tr><th id="767">767</th><td><i>		 * make sure the expanding vma has anon_vma set if the</i></td></tr>
<tr><th id="768">768</th><td><i>		 * shrinking vma had, to cover any anon pages imported.</i></td></tr>
<tr><th id="769">769</th><td><i>		 */</i></td></tr>
<tr><th id="770">770</th><td>		<b>if</b> (<a class="local col2 ref" href="#122exporter" title='exporter' data-ref="122exporter">exporter</a> &amp;&amp; <a class="local col2 ref" href="#122exporter" title='exporter' data-ref="122exporter">exporter</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a> &amp;&amp; !<a class="local col3 ref" href="#123importer" title='importer' data-ref="123importer">importer</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>) {</td></tr>
<tr><th id="771">771</th><td>			<em>int</em> <dfn class="local col4 decl" id="124error" title='error' data-type='int' data-ref="124error">error</dfn>;</td></tr>
<tr><th id="772">772</th><td></td></tr>
<tr><th id="773">773</th><td>			<a class="local col3 ref" href="#123importer" title='importer' data-ref="123importer">importer</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a> = <a class="local col2 ref" href="#122exporter" title='exporter' data-ref="122exporter">exporter</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>;</td></tr>
<tr><th id="774">774</th><td>			<a class="local col4 ref" href="#124error" title='error' data-ref="124error">error</a> = <a class="ref fn" href="../include/linux/rmap.h.html#anon_vma_clone" title='anon_vma_clone' data-ref="anon_vma_clone">anon_vma_clone</a>(<a class="local col3 ref" href="#123importer" title='importer' data-ref="123importer">importer</a>, <a class="local col2 ref" href="#122exporter" title='exporter' data-ref="122exporter">exporter</a>);</td></tr>
<tr><th id="775">775</th><td>			<b>if</b> (<a class="local col4 ref" href="#124error" title='error' data-ref="124error">error</a>)</td></tr>
<tr><th id="776">776</th><td>				<b>return</b> <a class="local col4 ref" href="#124error" title='error' data-ref="124error">error</a>;</td></tr>
<tr><th id="777">777</th><td>		}</td></tr>
<tr><th id="778">778</th><td>	}</td></tr>
<tr><th id="779">779</th><td><dfn class="lbl" id="125again" data-ref="125again">again</dfn>:</td></tr>
<tr><th id="780">780</th><td>	<a class="ref fn" href="../include/linux/huge_mm.h.html#vma_adjust_trans_huge" title='vma_adjust_trans_huge' data-ref="vma_adjust_trans_huge">vma_adjust_trans_huge</a>(<a class="local col3 ref" href="#113orig_vma" title='orig_vma' data-ref="113orig_vma">orig_vma</a>, <a class="local col6 ref" href="#106start" title='start' data-ref="106start">start</a>, <a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a>, <a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a>);</td></tr>
<tr><th id="781">781</th><td></td></tr>
<tr><th id="782">782</th><td>	<b>if</b> (<a class="local col7 ref" href="#117file" title='file' data-ref="117file">file</a>) {</td></tr>
<tr><th id="783">783</th><td>		<a class="local col4 ref" href="#114mapping" title='mapping' data-ref="114mapping">mapping</a> = <a class="local col7 ref" href="#117file" title='file' data-ref="117file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a>;</td></tr>
<tr><th id="784">784</th><td>		<a class="local col5 ref" href="#115root" title='root' data-ref="115root">root</a> = &amp;<a class="local col4 ref" href="#114mapping" title='mapping' data-ref="114mapping">mapping</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#address_space::i_mmap" title='address_space::i_mmap' data-ref="address_space::i_mmap">i_mmap</a>;</td></tr>
<tr><th id="785">785</th><td>		<a class="ref fn" href="../include/linux/uprobes.h.html#uprobe_munmap" title='uprobe_munmap' data-ref="uprobe_munmap">uprobe_munmap</a>(<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>, <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>, <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>);</td></tr>
<tr><th id="786">786</th><td></td></tr>
<tr><th id="787">787</th><td>		<b>if</b> (<a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a>)</td></tr>
<tr><th id="788">788</th><td>			<a class="ref fn" href="../include/linux/uprobes.h.html#uprobe_munmap" title='uprobe_munmap' data-ref="uprobe_munmap">uprobe_munmap</a>(<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>, <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>, <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>);</td></tr>
<tr><th id="789">789</th><td></td></tr>
<tr><th id="790">790</th><td>		<a class="ref fn" href="../include/linux/fs.h.html#i_mmap_lock_write" title='i_mmap_lock_write' data-ref="i_mmap_lock_write">i_mmap_lock_write</a>(<a class="local col4 ref" href="#114mapping" title='mapping' data-ref="114mapping">mapping</a>);</td></tr>
<tr><th id="791">791</th><td>		<b>if</b> (<a class="local col9 ref" href="#109insert" title='insert' data-ref="109insert">insert</a>) {</td></tr>
<tr><th id="792">792</th><td>			<i>/*</i></td></tr>
<tr><th id="793">793</th><td><i>			 * Put into interval tree now, so instantiated pages</i></td></tr>
<tr><th id="794">794</th><td><i>			 * are visible to arm/parisc __flush_dcache_page</i></td></tr>
<tr><th id="795">795</th><td><i>			 * throughout; but we cannot insert into address</i></td></tr>
<tr><th id="796">796</th><td><i>			 * space until vma start or end is updated.</i></td></tr>
<tr><th id="797">797</th><td><i>			 */</i></td></tr>
<tr><th id="798">798</th><td>			<a class="tu ref fn" href="#__vma_link_file" title='__vma_link_file' data-use='c' data-ref="__vma_link_file">__vma_link_file</a>(<a class="local col9 ref" href="#109insert" title='insert' data-ref="109insert">insert</a>);</td></tr>
<tr><th id="799">799</th><td>		}</td></tr>
<tr><th id="800">800</th><td>	}</td></tr>
<tr><th id="801">801</th><td></td></tr>
<tr><th id="802">802</th><td>	<a class="local col6 ref" href="#116anon_vma" title='anon_vma' data-ref="116anon_vma">anon_vma</a> = <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>;</td></tr>
<tr><th id="803">803</th><td>	<b>if</b> (!<a class="local col6 ref" href="#116anon_vma" title='anon_vma' data-ref="116anon_vma">anon_vma</a> &amp;&amp; <a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a>)</td></tr>
<tr><th id="804">804</th><td>		<a class="local col6 ref" href="#116anon_vma" title='anon_vma' data-ref="116anon_vma">anon_vma</a> = <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>;</td></tr>
<tr><th id="805">805</th><td>	<b>if</b> (<a class="local col6 ref" href="#116anon_vma" title='anon_vma' data-ref="116anon_vma">anon_vma</a>) {</td></tr>
<tr><th id="806">806</th><td>		<a class="macro" href="../include/linux/mmdebug.h.html#49" title="((void)(sizeof(( long)(adjust_next &amp;&amp; next-&gt;anon_vma &amp;&amp; anon_vma != next-&gt;anon_vma))))" data-ref="_M/VM_WARN_ON">VM_WARN_ON</a>(<a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a> &amp;&amp; <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a> &amp;&amp;</td></tr>
<tr><th id="807">807</th><td>			   <a class="local col6 ref" href="#116anon_vma" title='anon_vma' data-ref="116anon_vma">anon_vma</a> != <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>);</td></tr>
<tr><th id="808">808</th><td>		<a class="ref fn" href="../include/linux/rmap.h.html#anon_vma_lock_write" title='anon_vma_lock_write' data-ref="anon_vma_lock_write">anon_vma_lock_write</a>(<a class="local col6 ref" href="#116anon_vma" title='anon_vma' data-ref="116anon_vma">anon_vma</a>);</td></tr>
<tr><th id="809">809</th><td>		<a class="tu ref fn" href="#anon_vma_interval_tree_pre_update_vma" title='anon_vma_interval_tree_pre_update_vma' data-use='c' data-ref="anon_vma_interval_tree_pre_update_vma">anon_vma_interval_tree_pre_update_vma</a>(<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>);</td></tr>
<tr><th id="810">810</th><td>		<b>if</b> (<a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a>)</td></tr>
<tr><th id="811">811</th><td>			<a class="tu ref fn" href="#anon_vma_interval_tree_pre_update_vma" title='anon_vma_interval_tree_pre_update_vma' data-use='c' data-ref="anon_vma_interval_tree_pre_update_vma">anon_vma_interval_tree_pre_update_vma</a>(<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>);</td></tr>
<tr><th id="812">812</th><td>	}</td></tr>
<tr><th id="813">813</th><td></td></tr>
<tr><th id="814">814</th><td>	<b>if</b> (<a class="local col5 ref" href="#115root" title='root' data-ref="115root">root</a>) {</td></tr>
<tr><th id="815">815</th><td>		<a class="macro" href="../include/asm-generic/cacheflush.h.html#19" title="do { } while (0)" data-ref="_M/flush_dcache_mmap_lock">flush_dcache_mmap_lock</a>(mapping);</td></tr>
<tr><th id="816">816</th><td>		<a class="ref fn" href="../include/linux/mm.h.html#vma_interval_tree_remove" title='vma_interval_tree_remove' data-ref="vma_interval_tree_remove">vma_interval_tree_remove</a>(<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>, <a class="local col5 ref" href="#115root" title='root' data-ref="115root">root</a>);</td></tr>
<tr><th id="817">817</th><td>		<b>if</b> (<a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a>)</td></tr>
<tr><th id="818">818</th><td>			<a class="ref fn" href="../include/linux/mm.h.html#vma_interval_tree_remove" title='vma_interval_tree_remove' data-ref="vma_interval_tree_remove">vma_interval_tree_remove</a>(<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>, <a class="local col5 ref" href="#115root" title='root' data-ref="115root">root</a>);</td></tr>
<tr><th id="819">819</th><td>	}</td></tr>
<tr><th id="820">820</th><td></td></tr>
<tr><th id="821">821</th><td>	<b>if</b> (<a class="local col6 ref" href="#106start" title='start' data-ref="106start">start</a> != <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>) {</td></tr>
<tr><th id="822">822</th><td>		<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> = <a class="local col6 ref" href="#106start" title='start' data-ref="106start">start</a>;</td></tr>
<tr><th id="823">823</th><td>		<a class="local col8 ref" href="#118start_changed" title='start_changed' data-ref="118start_changed">start_changed</a> = <a class="enum" href="../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="824">824</th><td>	}</td></tr>
<tr><th id="825">825</th><td>	<b>if</b> (<a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a> != <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>) {</td></tr>
<tr><th id="826">826</th><td>		<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> = <a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a>;</td></tr>
<tr><th id="827">827</th><td>		<a class="local col9 ref" href="#119end_changed" title='end_changed' data-ref="119end_changed">end_changed</a> = <a class="enum" href="../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="828">828</th><td>	}</td></tr>
<tr><th id="829">829</th><td>	<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> = <a class="local col8 ref" href="#108pgoff" title='pgoff' data-ref="108pgoff">pgoff</a>;</td></tr>
<tr><th id="830">830</th><td>	<b>if</b> (<a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a>) {</td></tr>
<tr><th id="831">831</th><td>		<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> += <a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a> &lt;&lt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="832">832</th><td>		<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> += <a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a>;</td></tr>
<tr><th id="833">833</th><td>	}</td></tr>
<tr><th id="834">834</th><td></td></tr>
<tr><th id="835">835</th><td>	<b>if</b> (<a class="local col5 ref" href="#115root" title='root' data-ref="115root">root</a>) {</td></tr>
<tr><th id="836">836</th><td>		<b>if</b> (<a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a>)</td></tr>
<tr><th id="837">837</th><td>			<a class="ref fn" href="../include/linux/mm.h.html#vma_interval_tree_insert" title='vma_interval_tree_insert' data-ref="vma_interval_tree_insert">vma_interval_tree_insert</a>(<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>, <a class="local col5 ref" href="#115root" title='root' data-ref="115root">root</a>);</td></tr>
<tr><th id="838">838</th><td>		<a class="ref fn" href="../include/linux/mm.h.html#vma_interval_tree_insert" title='vma_interval_tree_insert' data-ref="vma_interval_tree_insert">vma_interval_tree_insert</a>(<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>, <a class="local col5 ref" href="#115root" title='root' data-ref="115root">root</a>);</td></tr>
<tr><th id="839">839</th><td>		<a class="macro" href="../include/asm-generic/cacheflush.h.html#20" title="do { } while (0)" data-ref="_M/flush_dcache_mmap_unlock">flush_dcache_mmap_unlock</a>(mapping);</td></tr>
<tr><th id="840">840</th><td>	}</td></tr>
<tr><th id="841">841</th><td></td></tr>
<tr><th id="842">842</th><td>	<b>if</b> (<a class="local col1 ref" href="#121remove_next" title='remove_next' data-ref="121remove_next">remove_next</a>) {</td></tr>
<tr><th id="843">843</th><td>		<i>/*</i></td></tr>
<tr><th id="844">844</th><td><i>		 * vma_merge has merged next into vma, and needs</i></td></tr>
<tr><th id="845">845</th><td><i>		 * us to remove next before dropping the locks.</i></td></tr>
<tr><th id="846">846</th><td><i>		 */</i></td></tr>
<tr><th id="847">847</th><td>		<b>if</b> (<a class="local col1 ref" href="#121remove_next" title='remove_next' data-ref="121remove_next">remove_next</a> != <var>3</var>)</td></tr>
<tr><th id="848">848</th><td>			<a class="tu ref fn" href="#__vma_unlink_prev" title='__vma_unlink_prev' data-use='c' data-ref="__vma_unlink_prev">__vma_unlink_prev</a>(<a class="local col1 ref" href="#111mm" title='mm' data-ref="111mm">mm</a>, <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>, <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>);</td></tr>
<tr><th id="849">849</th><td>		<b>else</b></td></tr>
<tr><th id="850">850</th><td>			<i>/*</i></td></tr>
<tr><th id="851">851</th><td><i>			 * vma is not before next if they've been</i></td></tr>
<tr><th id="852">852</th><td><i>			 * swapped.</i></td></tr>
<tr><th id="853">853</th><td><i>			 *</i></td></tr>
<tr><th id="854">854</th><td><i>			 * pre-swap() next-&gt;vm_start was reduced so</i></td></tr>
<tr><th id="855">855</th><td><i>			 * tell validate_mm_rb to ignore pre-swap()</i></td></tr>
<tr><th id="856">856</th><td><i>			 * "next" (which is stored in post-swap()</i></td></tr>
<tr><th id="857">857</th><td><i>			 * "vma").</i></td></tr>
<tr><th id="858">858</th><td><i>			 */</i></td></tr>
<tr><th id="859">859</th><td>			<a class="tu ref fn" href="#__vma_unlink_common" title='__vma_unlink_common' data-use='c' data-ref="__vma_unlink_common">__vma_unlink_common</a>(<a class="local col1 ref" href="#111mm" title='mm' data-ref="111mm">mm</a>, <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="enum" href="../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>, <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>);</td></tr>
<tr><th id="860">860</th><td>		<b>if</b> (<a class="local col7 ref" href="#117file" title='file' data-ref="117file">file</a>)</td></tr>
<tr><th id="861">861</th><td>			<a class="tu ref fn" href="#__remove_shared_vm_struct" title='__remove_shared_vm_struct' data-use='c' data-ref="__remove_shared_vm_struct">__remove_shared_vm_struct</a>(<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>, <a class="local col7 ref" href="#117file" title='file' data-ref="117file">file</a>, <a class="local col4 ref" href="#114mapping" title='mapping' data-ref="114mapping">mapping</a>);</td></tr>
<tr><th id="862">862</th><td>	} <b>else</b> <b>if</b> (<a class="local col9 ref" href="#109insert" title='insert' data-ref="109insert">insert</a>) {</td></tr>
<tr><th id="863">863</th><td>		<i>/*</i></td></tr>
<tr><th id="864">864</th><td><i>		 * split_vma has split insert from vma, and needs</i></td></tr>
<tr><th id="865">865</th><td><i>		 * us to insert it before dropping the locks</i></td></tr>
<tr><th id="866">866</th><td><i>		 * (it may either follow vma or precede it).</i></td></tr>
<tr><th id="867">867</th><td><i>		 */</i></td></tr>
<tr><th id="868">868</th><td>		<a class="tu ref fn" href="#__insert_vm_struct" title='__insert_vm_struct' data-use='c' data-ref="__insert_vm_struct">__insert_vm_struct</a>(<a class="local col1 ref" href="#111mm" title='mm' data-ref="111mm">mm</a>, <a class="local col9 ref" href="#109insert" title='insert' data-ref="109insert">insert</a>);</td></tr>
<tr><th id="869">869</th><td>	} <b>else</b> {</td></tr>
<tr><th id="870">870</th><td>		<b>if</b> (<a class="local col8 ref" href="#118start_changed" title='start_changed' data-ref="118start_changed">start_changed</a>)</td></tr>
<tr><th id="871">871</th><td>			<a class="tu ref fn" href="#vma_gap_update" title='vma_gap_update' data-use='c' data-ref="vma_gap_update">vma_gap_update</a>(<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>);</td></tr>
<tr><th id="872">872</th><td>		<b>if</b> (<a class="local col9 ref" href="#119end_changed" title='end_changed' data-ref="119end_changed">end_changed</a>) {</td></tr>
<tr><th id="873">873</th><td>			<b>if</b> (!<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>)</td></tr>
<tr><th id="874">874</th><td>				<a class="local col1 ref" href="#111mm" title='mm' data-ref="111mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::highest_vm_end" title='mm_struct::highest_vm_end' data-ref="mm_struct::highest_vm_end">highest_vm_end</a> = <a class="ref fn" href="../include/linux/mm.h.html#vm_end_gap" title='vm_end_gap' data-ref="vm_end_gap">vm_end_gap</a>(<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>);</td></tr>
<tr><th id="875">875</th><td>			<b>else</b> <b>if</b> (!<a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a>)</td></tr>
<tr><th id="876">876</th><td>				<a class="tu ref fn" href="#vma_gap_update" title='vma_gap_update' data-use='c' data-ref="vma_gap_update">vma_gap_update</a>(<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>);</td></tr>
<tr><th id="877">877</th><td>		}</td></tr>
<tr><th id="878">878</th><td>	}</td></tr>
<tr><th id="879">879</th><td></td></tr>
<tr><th id="880">880</th><td>	<b>if</b> (<a class="local col6 ref" href="#116anon_vma" title='anon_vma' data-ref="116anon_vma">anon_vma</a>) {</td></tr>
<tr><th id="881">881</th><td>		<a class="tu ref fn" href="#anon_vma_interval_tree_post_update_vma" title='anon_vma_interval_tree_post_update_vma' data-use='c' data-ref="anon_vma_interval_tree_post_update_vma">anon_vma_interval_tree_post_update_vma</a>(<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>);</td></tr>
<tr><th id="882">882</th><td>		<b>if</b> (<a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a>)</td></tr>
<tr><th id="883">883</th><td>			<a class="tu ref fn" href="#anon_vma_interval_tree_post_update_vma" title='anon_vma_interval_tree_post_update_vma' data-use='c' data-ref="anon_vma_interval_tree_post_update_vma">anon_vma_interval_tree_post_update_vma</a>(<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>);</td></tr>
<tr><th id="884">884</th><td>		<a class="ref fn" href="../include/linux/rmap.h.html#anon_vma_unlock_write" title='anon_vma_unlock_write' data-ref="anon_vma_unlock_write">anon_vma_unlock_write</a>(<a class="local col6 ref" href="#116anon_vma" title='anon_vma' data-ref="116anon_vma">anon_vma</a>);</td></tr>
<tr><th id="885">885</th><td>	}</td></tr>
<tr><th id="886">886</th><td>	<b>if</b> (<a class="local col4 ref" href="#114mapping" title='mapping' data-ref="114mapping">mapping</a>)</td></tr>
<tr><th id="887">887</th><td>		<a class="ref fn" href="../include/linux/fs.h.html#i_mmap_unlock_write" title='i_mmap_unlock_write' data-ref="i_mmap_unlock_write">i_mmap_unlock_write</a>(<a class="local col4 ref" href="#114mapping" title='mapping' data-ref="114mapping">mapping</a>);</td></tr>
<tr><th id="888">888</th><td></td></tr>
<tr><th id="889">889</th><td>	<b>if</b> (<a class="local col5 ref" href="#115root" title='root' data-ref="115root">root</a>) {</td></tr>
<tr><th id="890">890</th><td>		<a class="ref fn" href="../include/linux/uprobes.h.html#uprobe_mmap" title='uprobe_mmap' data-ref="uprobe_mmap">uprobe_mmap</a>(<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>);</td></tr>
<tr><th id="891">891</th><td></td></tr>
<tr><th id="892">892</th><td>		<b>if</b> (<a class="local col0 ref" href="#120adjust_next" title='adjust_next' data-ref="120adjust_next">adjust_next</a>)</td></tr>
<tr><th id="893">893</th><td>			<a class="ref fn" href="../include/linux/uprobes.h.html#uprobe_mmap" title='uprobe_mmap' data-ref="uprobe_mmap">uprobe_mmap</a>(<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>);</td></tr>
<tr><th id="894">894</th><td>	}</td></tr>
<tr><th id="895">895</th><td></td></tr>
<tr><th id="896">896</th><td>	<b>if</b> (<a class="local col1 ref" href="#121remove_next" title='remove_next' data-ref="121remove_next">remove_next</a>) {</td></tr>
<tr><th id="897">897</th><td>		<b>if</b> (<a class="local col7 ref" href="#117file" title='file' data-ref="117file">file</a>) {</td></tr>
<tr><th id="898">898</th><td>			<a class="ref fn" href="../include/linux/uprobes.h.html#uprobe_munmap" title='uprobe_munmap' data-ref="uprobe_munmap">uprobe_munmap</a>(<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>, <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>, <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>);</td></tr>
<tr><th id="899">899</th><td>			<a class="ref fn" href="../include/linux/file.h.html#fput" title='fput' data-ref="fput">fput</a>(<a class="local col7 ref" href="#117file" title='file' data-ref="117file">file</a>);</td></tr>
<tr><th id="900">900</th><td>		}</td></tr>
<tr><th id="901">901</th><td>		<b>if</b> (<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>)</td></tr>
<tr><th id="902">902</th><td>			<a class="ref fn" href="../include/linux/rmap.h.html#anon_vma_merge" title='anon_vma_merge' data-ref="anon_vma_merge">anon_vma_merge</a>(<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>, <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>);</td></tr>
<tr><th id="903">903</th><td>		<a class="local col1 ref" href="#111mm" title='mm' data-ref="111mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::map_count" title='mm_struct::map_count' data-ref="mm_struct::map_count">map_count</a>--;</td></tr>
<tr><th id="904">904</th><td>		<a class="ref fn" href="../include/linux/mempolicy.h.html#mpol_put" title='mpol_put' data-ref="mpol_put">mpol_put</a>(<a class="macro" href="../include/linux/mempolicy.h.html#246" title="((void *)0)" data-ref="_M/vma_policy">vma_policy</a>(next));</td></tr>
<tr><th id="905">905</th><td>		<a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_free" title='kmem_cache_free' data-ref="kmem_cache_free">kmem_cache_free</a>(<a class="ref" href="../include/linux/mm.h.html#vm_area_cachep" title='vm_area_cachep' data-ref="vm_area_cachep">vm_area_cachep</a>, <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>);</td></tr>
<tr><th id="906">906</th><td>		<i>/*</i></td></tr>
<tr><th id="907">907</th><td><i>		 * In mprotect's case 6 (see comments on vma_merge),</i></td></tr>
<tr><th id="908">908</th><td><i>		 * we must remove another next too. It would clutter</i></td></tr>
<tr><th id="909">909</th><td><i>		 * up the code too much to do both in one go.</i></td></tr>
<tr><th id="910">910</th><td><i>		 */</i></td></tr>
<tr><th id="911">911</th><td>		<b>if</b> (<a class="local col1 ref" href="#121remove_next" title='remove_next' data-ref="121remove_next">remove_next</a> != <var>3</var>) {</td></tr>
<tr><th id="912">912</th><td>			<i>/*</i></td></tr>
<tr><th id="913">913</th><td><i>			 * If "next" was removed and vma-&gt;vm_end was</i></td></tr>
<tr><th id="914">914</th><td><i>			 * expanded (up) over it, in turn</i></td></tr>
<tr><th id="915">915</th><td><i>			 * "next-&gt;vm_prev-&gt;vm_end" changed and the</i></td></tr>
<tr><th id="916">916</th><td><i>			 * "vma-&gt;vm_next" gap must be updated.</i></td></tr>
<tr><th id="917">917</th><td><i>			 */</i></td></tr>
<tr><th id="918">918</th><td>			<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a> = <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>;</td></tr>
<tr><th id="919">919</th><td>		} <b>else</b> {</td></tr>
<tr><th id="920">920</th><td>			<i>/*</i></td></tr>
<tr><th id="921">921</th><td><i>			 * For the scope of the comment "next" and</i></td></tr>
<tr><th id="922">922</th><td><i>			 * "vma" considered pre-swap(): if "vma" was</i></td></tr>
<tr><th id="923">923</th><td><i>			 * removed, next-&gt;vm_start was expanded (down)</i></td></tr>
<tr><th id="924">924</th><td><i>			 * over it and the "next" gap must be updated.</i></td></tr>
<tr><th id="925">925</th><td><i>			 * Because of the swap() the post-swap() "vma"</i></td></tr>
<tr><th id="926">926</th><td><i>			 * actually points to pre-swap() "next"</i></td></tr>
<tr><th id="927">927</th><td><i>			 * (post-swap() "next" as opposed is now a</i></td></tr>
<tr><th id="928">928</th><td><i>			 * dangling pointer).</i></td></tr>
<tr><th id="929">929</th><td><i>			 */</i></td></tr>
<tr><th id="930">930</th><td>			<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a> = <a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>;</td></tr>
<tr><th id="931">931</th><td>		}</td></tr>
<tr><th id="932">932</th><td>		<b>if</b> (<a class="local col1 ref" href="#121remove_next" title='remove_next' data-ref="121remove_next">remove_next</a> == <var>2</var>) {</td></tr>
<tr><th id="933">933</th><td>			<a class="local col1 ref" href="#121remove_next" title='remove_next' data-ref="121remove_next">remove_next</a> = <var>1</var>;</td></tr>
<tr><th id="934">934</th><td>			<a class="local col7 ref" href="#107end" title='end' data-ref="107end">end</a> = <a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>;</td></tr>
<tr><th id="935">935</th><td>			<b>goto</b> <a class="lbl" href="#125again" data-ref="125again">again</a>;</td></tr>
<tr><th id="936">936</th><td>		}</td></tr>
<tr><th id="937">937</th><td>		<b>else</b> <b>if</b> (<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>)</td></tr>
<tr><th id="938">938</th><td>			<a class="tu ref fn" href="#vma_gap_update" title='vma_gap_update' data-use='c' data-ref="vma_gap_update">vma_gap_update</a>(<a class="local col2 ref" href="#112next" title='next' data-ref="112next">next</a>);</td></tr>
<tr><th id="939">939</th><td>		<b>else</b> {</td></tr>
<tr><th id="940">940</th><td>			<i>/*</i></td></tr>
<tr><th id="941">941</th><td><i>			 * If remove_next == 2 we obviously can't</i></td></tr>
<tr><th id="942">942</th><td><i>			 * reach this path.</i></td></tr>
<tr><th id="943">943</th><td><i>			 *</i></td></tr>
<tr><th id="944">944</th><td><i>			 * If remove_next == 3 we can't reach this</i></td></tr>
<tr><th id="945">945</th><td><i>			 * path because pre-swap() next is always not</i></td></tr>
<tr><th id="946">946</th><td><i>			 * NULL. pre-swap() "next" is not being</i></td></tr>
<tr><th id="947">947</th><td><i>			 * removed and its next-&gt;vm_end is not altered</i></td></tr>
<tr><th id="948">948</th><td><i>			 * (and furthermore "end" already matches</i></td></tr>
<tr><th id="949">949</th><td><i>			 * next-&gt;vm_end in remove_next == 3).</i></td></tr>
<tr><th id="950">950</th><td><i>			 *</i></td></tr>
<tr><th id="951">951</th><td><i>			 * We reach this only in the remove_next == 1</i></td></tr>
<tr><th id="952">952</th><td><i>			 * case if the "next" vma that was removed was</i></td></tr>
<tr><th id="953">953</th><td><i>			 * the highest vma of the mm. However in such</i></td></tr>
<tr><th id="954">954</th><td><i>			 * case next-&gt;vm_end == "end" and the extended</i></td></tr>
<tr><th id="955">955</th><td><i>			 * "vma" has vma-&gt;vm_end == next-&gt;vm_end so</i></td></tr>
<tr><th id="956">956</th><td><i>			 * mm-&gt;highest_vm_end doesn't need any update</i></td></tr>
<tr><th id="957">957</th><td><i>			 * in remove_next == 1 case.</i></td></tr>
<tr><th id="958">958</th><td><i>			 */</i></td></tr>
<tr><th id="959">959</th><td>			<a class="macro" href="../include/linux/mmdebug.h.html#49" title="((void)(sizeof(( long)(mm-&gt;highest_vm_end != vm_end_gap(vma)))))" data-ref="_M/VM_WARN_ON">VM_WARN_ON</a>(<a class="local col1 ref" href="#111mm" title='mm' data-ref="111mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::highest_vm_end" title='mm_struct::highest_vm_end' data-ref="mm_struct::highest_vm_end">highest_vm_end</a> != <a class="ref fn" href="../include/linux/mm.h.html#vm_end_gap" title='vm_end_gap' data-ref="vm_end_gap">vm_end_gap</a>(<a class="local col5 ref" href="#105vma" title='vma' data-ref="105vma">vma</a>));</td></tr>
<tr><th id="960">960</th><td>		}</td></tr>
<tr><th id="961">961</th><td>	}</td></tr>
<tr><th id="962">962</th><td>	<b>if</b> (<a class="local col9 ref" href="#109insert" title='insert' data-ref="109insert">insert</a> &amp;&amp; <a class="local col7 ref" href="#117file" title='file' data-ref="117file">file</a>)</td></tr>
<tr><th id="963">963</th><td>		<a class="ref fn" href="../include/linux/uprobes.h.html#uprobe_mmap" title='uprobe_mmap' data-ref="uprobe_mmap">uprobe_mmap</a>(<a class="local col9 ref" href="#109insert" title='insert' data-ref="109insert">insert</a>);</td></tr>
<tr><th id="964">964</th><td></td></tr>
<tr><th id="965">965</th><td>	<a class="macro" href="#393" title="do { } while (0)" data-ref="_M/validate_mm">validate_mm</a>(mm);</td></tr>
<tr><th id="966">966</th><td></td></tr>
<tr><th id="967">967</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="968">968</th><td>}</td></tr>
<tr><th id="969">969</th><td></td></tr>
<tr><th id="970">970</th><td><i  data-doc="is_mergeable_vma">/*</i></td></tr>
<tr><th id="971">971</th><td><i  data-doc="is_mergeable_vma"> * If the vma has a -&gt;close operation then the driver probably needs to release</i></td></tr>
<tr><th id="972">972</th><td><i  data-doc="is_mergeable_vma"> * per-vma resources, so we don't attempt to merge those.</i></td></tr>
<tr><th id="973">973</th><td><i  data-doc="is_mergeable_vma"> */</i></td></tr>
<tr><th id="974">974</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>int</em> <dfn class="tu decl def fn" id="is_mergeable_vma" title='is_mergeable_vma' data-type='int is_mergeable_vma(struct vm_area_struct * vma, struct file * file, unsigned long vm_flags, struct vm_userfaultfd_ctx vm_userfaultfd_ctx)' data-ref="is_mergeable_vma">is_mergeable_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col6 decl" id="126vma" title='vma' data-type='struct vm_area_struct *' data-ref="126vma">vma</dfn>,</td></tr>
<tr><th id="975">975</th><td>				<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col7 decl" id="127file" title='file' data-type='struct file *' data-ref="127file">file</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="128vm_flags" title='vm_flags' data-type='unsigned long' data-ref="128vm_flags">vm_flags</dfn>,</td></tr>
<tr><th id="976">976</th><td>				<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-ref="vm_userfaultfd_ctx">vm_userfaultfd_ctx</a> <dfn class="local col9 decl" id="129vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-type='struct vm_userfaultfd_ctx' data-ref="129vm_userfaultfd_ctx">vm_userfaultfd_ctx</dfn>)</td></tr>
<tr><th id="977">977</th><td>{</td></tr>
<tr><th id="978">978</th><td>	<i>/*</i></td></tr>
<tr><th id="979">979</th><td><i>	 * VM_SOFTDIRTY should not prevent from VMA merging, if we</i></td></tr>
<tr><th id="980">980</th><td><i>	 * match the flags but dirty bit -- the caller should mark</i></td></tr>
<tr><th id="981">981</th><td><i>	 * merged VMA as dirty. If dirty bit won't be excluded from</i></td></tr>
<tr><th id="982">982</th><td><i>	 * comparison, we increase pressue on the memory system forcing</i></td></tr>
<tr><th id="983">983</th><td><i>	 * the kernel to generate new VMAs when old one could be</i></td></tr>
<tr><th id="984">984</th><td><i>	 * extended instead.</i></td></tr>
<tr><th id="985">985</th><td><i>	 */</i></td></tr>
<tr><th id="986">986</th><td>	<b>if</b> ((<a class="local col6 ref" href="#126vma" title='vma' data-ref="126vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> ^ <a class="local col8 ref" href="#128vm_flags" title='vm_flags' data-ref="128vm_flags">vm_flags</a>) &amp; ~<a class="macro" href="../include/linux/mm.h.html#200" title="0" data-ref="_M/VM_SOFTDIRTY">VM_SOFTDIRTY</a>)</td></tr>
<tr><th id="987">987</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="988">988</th><td>	<b>if</b> (<a class="local col6 ref" href="#126vma" title='vma' data-ref="126vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a> != <a class="local col7 ref" href="#127file" title='file' data-ref="127file">file</a>)</td></tr>
<tr><th id="989">989</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="990">990</th><td>	<b>if</b> (<a class="local col6 ref" href="#126vma" title='vma' data-ref="126vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a> &amp;&amp; <a class="local col6 ref" href="#126vma" title='vma' data-ref="126vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::close" title='vm_operations_struct::close' data-ref="vm_operations_struct::close">close</a>)</td></tr>
<tr><th id="991">991</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="992">992</th><td>	<b>if</b> (!<a class="ref fn" href="../include/linux/userfaultfd_k.h.html#is_mergeable_vm_userfaultfd_ctx" title='is_mergeable_vm_userfaultfd_ctx' data-ref="is_mergeable_vm_userfaultfd_ctx">is_mergeable_vm_userfaultfd_ctx</a>(<a class="local col6 ref" href="#126vma" title='vma' data-ref="126vma">vma</a>, <a class="local col9 ref" href="#129vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-ref="129vm_userfaultfd_ctx">vm_userfaultfd_ctx</a>))</td></tr>
<tr><th id="993">993</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="994">994</th><td>	<b>return</b> <var>1</var>;</td></tr>
<tr><th id="995">995</th><td>}</td></tr>
<tr><th id="996">996</th><td></td></tr>
<tr><th id="997">997</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>int</em> <dfn class="tu decl def fn" id="is_mergeable_anon_vma" title='is_mergeable_anon_vma' data-type='int is_mergeable_anon_vma(struct anon_vma * anon_vma1, struct anon_vma * anon_vma2, struct vm_area_struct * vma)' data-ref="is_mergeable_anon_vma">is_mergeable_anon_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma" title='anon_vma' data-ref="anon_vma">anon_vma</a> *<dfn class="local col0 decl" id="130anon_vma1" title='anon_vma1' data-type='struct anon_vma *' data-ref="130anon_vma1">anon_vma1</dfn>,</td></tr>
<tr><th id="998">998</th><td>					<b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma" title='anon_vma' data-ref="anon_vma">anon_vma</a> *<dfn class="local col1 decl" id="131anon_vma2" title='anon_vma2' data-type='struct anon_vma *' data-ref="131anon_vma2">anon_vma2</dfn>,</td></tr>
<tr><th id="999">999</th><td>					<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="132vma" title='vma' data-type='struct vm_area_struct *' data-ref="132vma">vma</dfn>)</td></tr>
<tr><th id="1000">1000</th><td>{</td></tr>
<tr><th id="1001">1001</th><td>	<i>/*</i></td></tr>
<tr><th id="1002">1002</th><td><i>	 * The list_is_singular() test is to avoid merging VMA cloned from</i></td></tr>
<tr><th id="1003">1003</th><td><i>	 * parents. This can improve scalability caused by anon_vma lock.</i></td></tr>
<tr><th id="1004">1004</th><td><i>	 */</i></td></tr>
<tr><th id="1005">1005</th><td>	<b>if</b> ((!<a class="local col0 ref" href="#130anon_vma1" title='anon_vma1' data-ref="130anon_vma1">anon_vma1</a> || !<a class="local col1 ref" href="#131anon_vma2" title='anon_vma2' data-ref="131anon_vma2">anon_vma2</a>) &amp;&amp; (!<a class="local col2 ref" href="#132vma" title='vma' data-ref="132vma">vma</a> ||</td></tr>
<tr><th id="1006">1006</th><td>		<a class="ref fn" href="../include/linux/list.h.html#list_is_singular" title='list_is_singular' data-ref="list_is_singular">list_is_singular</a>(&amp;<a class="local col2 ref" href="#132vma" title='vma' data-ref="132vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma_chain" title='vm_area_struct::anon_vma_chain' data-ref="vm_area_struct::anon_vma_chain">anon_vma_chain</a>)))</td></tr>
<tr><th id="1007">1007</th><td>		<b>return</b> <var>1</var>;</td></tr>
<tr><th id="1008">1008</th><td>	<b>return</b> <a class="local col0 ref" href="#130anon_vma1" title='anon_vma1' data-ref="130anon_vma1">anon_vma1</a> == <a class="local col1 ref" href="#131anon_vma2" title='anon_vma2' data-ref="131anon_vma2">anon_vma2</a>;</td></tr>
<tr><th id="1009">1009</th><td>}</td></tr>
<tr><th id="1010">1010</th><td></td></tr>
<tr><th id="1011">1011</th><td><i  data-doc="can_vma_merge_before">/*</i></td></tr>
<tr><th id="1012">1012</th><td><i  data-doc="can_vma_merge_before"> * Return true if we can merge this (vm_flags,anon_vma,file,vm_pgoff)</i></td></tr>
<tr><th id="1013">1013</th><td><i  data-doc="can_vma_merge_before"> * in front of (at a lower virtual address and file offset than) the vma.</i></td></tr>
<tr><th id="1014">1014</th><td><i  data-doc="can_vma_merge_before"> *</i></td></tr>
<tr><th id="1015">1015</th><td><i  data-doc="can_vma_merge_before"> * We cannot merge two vmas if they have differently assigned (non-NULL)</i></td></tr>
<tr><th id="1016">1016</th><td><i  data-doc="can_vma_merge_before"> * anon_vmas, nor if same anon_vma is assigned but offsets incompatible.</i></td></tr>
<tr><th id="1017">1017</th><td><i  data-doc="can_vma_merge_before"> *</i></td></tr>
<tr><th id="1018">1018</th><td><i  data-doc="can_vma_merge_before"> * We don't check here for the merged mmap wrapping around the end of pagecache</i></td></tr>
<tr><th id="1019">1019</th><td><i  data-doc="can_vma_merge_before"> * indices (16TB on ia32) because do_mmap_pgoff() does not permit mmap's which</i></td></tr>
<tr><th id="1020">1020</th><td><i  data-doc="can_vma_merge_before"> * wrap, nor mmaps which cover the final page at index -1UL.</i></td></tr>
<tr><th id="1021">1021</th><td><i  data-doc="can_vma_merge_before"> */</i></td></tr>
<tr><th id="1022">1022</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1023">1023</th><td><dfn class="tu decl def fn" id="can_vma_merge_before" title='can_vma_merge_before' data-type='int can_vma_merge_before(struct vm_area_struct * vma, unsigned long vm_flags, struct anon_vma * anon_vma, struct file * file, unsigned long vm_pgoff, struct vm_userfaultfd_ctx vm_userfaultfd_ctx)' data-ref="can_vma_merge_before">can_vma_merge_before</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col3 decl" id="133vma" title='vma' data-type='struct vm_area_struct *' data-ref="133vma">vma</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col4 decl" id="134vm_flags" title='vm_flags' data-type='unsigned long' data-ref="134vm_flags">vm_flags</dfn>,</td></tr>
<tr><th id="1024">1024</th><td>		     <b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma" title='anon_vma' data-ref="anon_vma">anon_vma</a> *<dfn class="local col5 decl" id="135anon_vma" title='anon_vma' data-type='struct anon_vma *' data-ref="135anon_vma">anon_vma</dfn>, <b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col6 decl" id="136file" title='file' data-type='struct file *' data-ref="136file">file</dfn>,</td></tr>
<tr><th id="1025">1025</th><td>		     <a class="macro" href="../include/linux/types.h.html#141" title="unsigned long" data-ref="_M/pgoff_t">pgoff_t</a> <dfn class="local col7 decl" id="137vm_pgoff" title='vm_pgoff' data-type='unsigned long' data-ref="137vm_pgoff">vm_pgoff</dfn>,</td></tr>
<tr><th id="1026">1026</th><td>		     <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-ref="vm_userfaultfd_ctx">vm_userfaultfd_ctx</a> <dfn class="local col8 decl" id="138vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-type='struct vm_userfaultfd_ctx' data-ref="138vm_userfaultfd_ctx">vm_userfaultfd_ctx</dfn>)</td></tr>
<tr><th id="1027">1027</th><td>{</td></tr>
<tr><th id="1028">1028</th><td>	<b>if</b> (<a class="tu ref fn" href="#is_mergeable_vma" title='is_mergeable_vma' data-use='c' data-ref="is_mergeable_vma">is_mergeable_vma</a>(<a class="local col3 ref" href="#133vma" title='vma' data-ref="133vma">vma</a>, <a class="local col6 ref" href="#136file" title='file' data-ref="136file">file</a>, <a class="local col4 ref" href="#134vm_flags" title='vm_flags' data-ref="134vm_flags">vm_flags</a>, <a class="local col8 ref" href="#138vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-ref="138vm_userfaultfd_ctx">vm_userfaultfd_ctx</a>) &amp;&amp;</td></tr>
<tr><th id="1029">1029</th><td>	    <a class="tu ref fn" href="#is_mergeable_anon_vma" title='is_mergeable_anon_vma' data-use='c' data-ref="is_mergeable_anon_vma">is_mergeable_anon_vma</a>(<a class="local col5 ref" href="#135anon_vma" title='anon_vma' data-ref="135anon_vma">anon_vma</a>, <a class="local col3 ref" href="#133vma" title='vma' data-ref="133vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>, <a class="local col3 ref" href="#133vma" title='vma' data-ref="133vma">vma</a>)) {</td></tr>
<tr><th id="1030">1030</th><td>		<b>if</b> (<a class="local col3 ref" href="#133vma" title='vma' data-ref="133vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> == <a class="local col7 ref" href="#137vm_pgoff" title='vm_pgoff' data-ref="137vm_pgoff">vm_pgoff</a>)</td></tr>
<tr><th id="1031">1031</th><td>			<b>return</b> <var>1</var>;</td></tr>
<tr><th id="1032">1032</th><td>	}</td></tr>
<tr><th id="1033">1033</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1034">1034</th><td>}</td></tr>
<tr><th id="1035">1035</th><td></td></tr>
<tr><th id="1036">1036</th><td><i  data-doc="can_vma_merge_after">/*</i></td></tr>
<tr><th id="1037">1037</th><td><i  data-doc="can_vma_merge_after"> * Return true if we can merge this (vm_flags,anon_vma,file,vm_pgoff)</i></td></tr>
<tr><th id="1038">1038</th><td><i  data-doc="can_vma_merge_after"> * beyond (at a higher virtual address and file offset than) the vma.</i></td></tr>
<tr><th id="1039">1039</th><td><i  data-doc="can_vma_merge_after"> *</i></td></tr>
<tr><th id="1040">1040</th><td><i  data-doc="can_vma_merge_after"> * We cannot merge two vmas if they have differently assigned (non-NULL)</i></td></tr>
<tr><th id="1041">1041</th><td><i  data-doc="can_vma_merge_after"> * anon_vmas, nor if same anon_vma is assigned but offsets incompatible.</i></td></tr>
<tr><th id="1042">1042</th><td><i  data-doc="can_vma_merge_after"> */</i></td></tr>
<tr><th id="1043">1043</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1044">1044</th><td><dfn class="tu decl def fn" id="can_vma_merge_after" title='can_vma_merge_after' data-type='int can_vma_merge_after(struct vm_area_struct * vma, unsigned long vm_flags, struct anon_vma * anon_vma, struct file * file, unsigned long vm_pgoff, struct vm_userfaultfd_ctx vm_userfaultfd_ctx)' data-ref="can_vma_merge_after">can_vma_merge_after</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col9 decl" id="139vma" title='vma' data-type='struct vm_area_struct *' data-ref="139vma">vma</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="140vm_flags" title='vm_flags' data-type='unsigned long' data-ref="140vm_flags">vm_flags</dfn>,</td></tr>
<tr><th id="1045">1045</th><td>		    <b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma" title='anon_vma' data-ref="anon_vma">anon_vma</a> *<dfn class="local col1 decl" id="141anon_vma" title='anon_vma' data-type='struct anon_vma *' data-ref="141anon_vma">anon_vma</dfn>, <b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col2 decl" id="142file" title='file' data-type='struct file *' data-ref="142file">file</dfn>,</td></tr>
<tr><th id="1046">1046</th><td>		    <a class="macro" href="../include/linux/types.h.html#141" title="unsigned long" data-ref="_M/pgoff_t">pgoff_t</a> <dfn class="local col3 decl" id="143vm_pgoff" title='vm_pgoff' data-type='unsigned long' data-ref="143vm_pgoff">vm_pgoff</dfn>,</td></tr>
<tr><th id="1047">1047</th><td>		    <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-ref="vm_userfaultfd_ctx">vm_userfaultfd_ctx</a> <dfn class="local col4 decl" id="144vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-type='struct vm_userfaultfd_ctx' data-ref="144vm_userfaultfd_ctx">vm_userfaultfd_ctx</dfn>)</td></tr>
<tr><th id="1048">1048</th><td>{</td></tr>
<tr><th id="1049">1049</th><td>	<b>if</b> (<a class="tu ref fn" href="#is_mergeable_vma" title='is_mergeable_vma' data-use='c' data-ref="is_mergeable_vma">is_mergeable_vma</a>(<a class="local col9 ref" href="#139vma" title='vma' data-ref="139vma">vma</a>, <a class="local col2 ref" href="#142file" title='file' data-ref="142file">file</a>, <a class="local col0 ref" href="#140vm_flags" title='vm_flags' data-ref="140vm_flags">vm_flags</a>, <a class="local col4 ref" href="#144vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-ref="144vm_userfaultfd_ctx">vm_userfaultfd_ctx</a>) &amp;&amp;</td></tr>
<tr><th id="1050">1050</th><td>	    <a class="tu ref fn" href="#is_mergeable_anon_vma" title='is_mergeable_anon_vma' data-use='c' data-ref="is_mergeable_anon_vma">is_mergeable_anon_vma</a>(<a class="local col1 ref" href="#141anon_vma" title='anon_vma' data-ref="141anon_vma">anon_vma</a>, <a class="local col9 ref" href="#139vma" title='vma' data-ref="139vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>, <a class="local col9 ref" href="#139vma" title='vma' data-ref="139vma">vma</a>)) {</td></tr>
<tr><th id="1051">1051</th><td>		<a class="macro" href="../include/linux/types.h.html#141" title="unsigned long" data-ref="_M/pgoff_t">pgoff_t</a> <dfn class="local col5 decl" id="145vm_pglen" title='vm_pglen' data-type='unsigned long' data-ref="145vm_pglen">vm_pglen</dfn>;</td></tr>
<tr><th id="1052">1052</th><td>		<a class="local col5 ref" href="#145vm_pglen" title='vm_pglen' data-ref="145vm_pglen">vm_pglen</a> = <a class="ref fn" href="../include/linux/mm.h.html#vma_pages" title='vma_pages' data-ref="vma_pages">vma_pages</a>(<a class="local col9 ref" href="#139vma" title='vma' data-ref="139vma">vma</a>);</td></tr>
<tr><th id="1053">1053</th><td>		<b>if</b> (<a class="local col9 ref" href="#139vma" title='vma' data-ref="139vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> + <a class="local col5 ref" href="#145vm_pglen" title='vm_pglen' data-ref="145vm_pglen">vm_pglen</a> == <a class="local col3 ref" href="#143vm_pgoff" title='vm_pgoff' data-ref="143vm_pgoff">vm_pgoff</a>)</td></tr>
<tr><th id="1054">1054</th><td>			<b>return</b> <var>1</var>;</td></tr>
<tr><th id="1055">1055</th><td>	}</td></tr>
<tr><th id="1056">1056</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1057">1057</th><td>}</td></tr>
<tr><th id="1058">1058</th><td></td></tr>
<tr><th id="1059">1059</th><td><i>/*</i></td></tr>
<tr><th id="1060">1060</th><td><i> * Given a mapping request (addr,end,vm_flags,file,pgoff), figure out</i></td></tr>
<tr><th id="1061">1061</th><td><i> * whether that can be merged with its predecessor or its successor.</i></td></tr>
<tr><th id="1062">1062</th><td><i> * Or both (it neatly fills a hole).</i></td></tr>
<tr><th id="1063">1063</th><td><i> *</i></td></tr>
<tr><th id="1064">1064</th><td><i> * In most cases - when called for mmap, brk or mremap - [addr,end) is</i></td></tr>
<tr><th id="1065">1065</th><td><i> * certain not to be mapped by the time vma_merge is called; but when</i></td></tr>
<tr><th id="1066">1066</th><td><i> * called for mprotect, it is certain to be already mapped (either at</i></td></tr>
<tr><th id="1067">1067</th><td><i> * an offset within prev, or at the start of next), and the flags of</i></td></tr>
<tr><th id="1068">1068</th><td><i> * this area are about to be changed to vm_flags - and the no-change</i></td></tr>
<tr><th id="1069">1069</th><td><i> * case has already been eliminated.</i></td></tr>
<tr><th id="1070">1070</th><td><i> *</i></td></tr>
<tr><th id="1071">1071</th><td><i> * The following mprotect cases have to be considered, where AAAA is</i></td></tr>
<tr><th id="1072">1072</th><td><i> * the area passed down from mprotect_fixup, never extending beyond one</i></td></tr>
<tr><th id="1073">1073</th><td><i> * vma, PPPPPP is the prev vma specified, and NNNNNN the next vma after:</i></td></tr>
<tr><th id="1074">1074</th><td><i> *</i></td></tr>
<tr><th id="1075">1075</th><td><i> *     AAAA             AAAA                AAAA          AAAA</i></td></tr>
<tr><th id="1076">1076</th><td><i> *    PPPPPPNNNNNN    PPPPPPNNNNNN    PPPPPPNNNNNN    PPPPNNNNXXXX</i></td></tr>
<tr><th id="1077">1077</th><td><i> *    cannot merge    might become    might become    might become</i></td></tr>
<tr><th id="1078">1078</th><td><i> *                    PPNNNNNNNNNN    PPPPPPPPPPNN    PPPPPPPPPPPP 6 or</i></td></tr>
<tr><th id="1079">1079</th><td><i> *    mmap, brk or    case 4 below    case 5 below    PPPPPPPPXXXX 7 or</i></td></tr>
<tr><th id="1080">1080</th><td><i> *    mremap move:                                    PPPPXXXXXXXX 8</i></td></tr>
<tr><th id="1081">1081</th><td><i> *        AAAA</i></td></tr>
<tr><th id="1082">1082</th><td><i> *    PPPP    NNNN    PPPPPPPPPPPP    PPPPPPPPNNNN    PPPPNNNNNNNN</i></td></tr>
<tr><th id="1083">1083</th><td><i> *    might become    case 1 below    case 2 below    case 3 below</i></td></tr>
<tr><th id="1084">1084</th><td><i> *</i></td></tr>
<tr><th id="1085">1085</th><td><i> * It is important for case 8 that the the vma NNNN overlapping the</i></td></tr>
<tr><th id="1086">1086</th><td><i> * region AAAA is never going to extended over XXXX. Instead XXXX must</i></td></tr>
<tr><th id="1087">1087</th><td><i> * be extended in region AAAA and NNNN must be removed. This way in</i></td></tr>
<tr><th id="1088">1088</th><td><i> * all cases where vma_merge succeeds, the moment vma_adjust drops the</i></td></tr>
<tr><th id="1089">1089</th><td><i> * rmap_locks, the properties of the merged vma will be already</i></td></tr>
<tr><th id="1090">1090</th><td><i> * correct for the whole merged range. Some of those properties like</i></td></tr>
<tr><th id="1091">1091</th><td><i> * vm_page_prot/vm_flags may be accessed by rmap_walks and they must</i></td></tr>
<tr><th id="1092">1092</th><td><i> * be correct for the whole merged range immediately after the</i></td></tr>
<tr><th id="1093">1093</th><td><i> * rmap_locks are released. Otherwise if XXXX would be removed and</i></td></tr>
<tr><th id="1094">1094</th><td><i> * NNNN would be extended over the XXXX range, remove_migration_ptes</i></td></tr>
<tr><th id="1095">1095</th><td><i> * or other rmap walkers (if working on addresses beyond the "end"</i></td></tr>
<tr><th id="1096">1096</th><td><i> * parameter) may establish ptes with the wrong permissions of NNNN</i></td></tr>
<tr><th id="1097">1097</th><td><i> * instead of the right permissions of XXXX.</i></td></tr>
<tr><th id="1098">1098</th><td><i> */</i></td></tr>
<tr><th id="1099">1099</th><td><b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="decl def fn" id="vma_merge" title='vma_merge' data-ref="vma_merge">vma_merge</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col6 decl" id="146mm" title='mm' data-type='struct mm_struct *' data-ref="146mm">mm</dfn>,</td></tr>
<tr><th id="1100">1100</th><td>			<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col7 decl" id="147prev" title='prev' data-type='struct vm_area_struct *' data-ref="147prev">prev</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="148addr" title='addr' data-type='unsigned long' data-ref="148addr">addr</dfn>,</td></tr>
<tr><th id="1101">1101</th><td>			<em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="149end" title='end' data-type='unsigned long' data-ref="149end">end</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="150vm_flags" title='vm_flags' data-type='unsigned long' data-ref="150vm_flags">vm_flags</dfn>,</td></tr>
<tr><th id="1102">1102</th><td>			<b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma" title='anon_vma' data-ref="anon_vma">anon_vma</a> *<dfn class="local col1 decl" id="151anon_vma" title='anon_vma' data-type='struct anon_vma *' data-ref="151anon_vma">anon_vma</dfn>, <b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col2 decl" id="152file" title='file' data-type='struct file *' data-ref="152file">file</dfn>,</td></tr>
<tr><th id="1103">1103</th><td>			<a class="macro" href="../include/linux/types.h.html#141" title="unsigned long" data-ref="_M/pgoff_t">pgoff_t</a> <dfn class="local col3 decl" id="153pgoff" title='pgoff' data-type='unsigned long' data-ref="153pgoff">pgoff</dfn>, <b>struct</b> <a class="type" href="../include/linux/mempolicy.h.html#mempolicy" title='mempolicy' data-ref="mempolicy">mempolicy</a> *<dfn class="local col4 decl" id="154policy" title='policy' data-type='struct mempolicy *' data-ref="154policy">policy</dfn>,</td></tr>
<tr><th id="1104">1104</th><td>			<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-ref="vm_userfaultfd_ctx">vm_userfaultfd_ctx</a> <dfn class="local col5 decl" id="155vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-type='struct vm_userfaultfd_ctx' data-ref="155vm_userfaultfd_ctx">vm_userfaultfd_ctx</dfn>)</td></tr>
<tr><th id="1105">1105</th><td>{</td></tr>
<tr><th id="1106">1106</th><td>	<a class="macro" href="../include/linux/types.h.html#141" title="unsigned long" data-ref="_M/pgoff_t">pgoff_t</a> <dfn class="local col6 decl" id="156pglen" title='pglen' data-type='unsigned long' data-ref="156pglen">pglen</dfn> = (<a class="local col9 ref" href="#149end" title='end' data-ref="149end">end</a> - <a class="local col8 ref" href="#148addr" title='addr' data-ref="148addr">addr</a>) &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="1107">1107</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col7 decl" id="157area" title='area' data-type='struct vm_area_struct *' data-ref="157area">area</dfn>, *<dfn class="local col8 decl" id="158next" title='next' data-type='struct vm_area_struct *' data-ref="158next">next</dfn>;</td></tr>
<tr><th id="1108">1108</th><td>	<em>int</em> <dfn class="local col9 decl" id="159err" title='err' data-type='int' data-ref="159err">err</dfn>;</td></tr>
<tr><th id="1109">1109</th><td></td></tr>
<tr><th id="1110">1110</th><td>	<i>/*</i></td></tr>
<tr><th id="1111">1111</th><td><i>	 * We later require that vma-&gt;vm_flags == vm_flags,</i></td></tr>
<tr><th id="1112">1112</th><td><i>	 * so this tests vma-&gt;vm_flags &amp; VM_SPECIAL, too.</i></td></tr>
<tr><th id="1113">1113</th><td><i>	 */</i></td></tr>
<tr><th id="1114">1114</th><td>	<b>if</b> (<a class="local col0 ref" href="#150vm_flags" title='vm_flags' data-ref="150vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#272" title="(0x00004000 | 0x00040000 | 0x00000400 | 0x10000000)" data-ref="_M/VM_SPECIAL">VM_SPECIAL</a>)</td></tr>
<tr><th id="1115">1115</th><td>		<b>return</b> <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1116">1116</th><td></td></tr>
<tr><th id="1117">1117</th><td>	<b>if</b> (<a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>)</td></tr>
<tr><th id="1118">1118</th><td>		<a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a> = <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>;</td></tr>
<tr><th id="1119">1119</th><td>	<b>else</b></td></tr>
<tr><th id="1120">1120</th><td>		<a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a> = <a class="local col6 ref" href="#146mm" title='mm' data-ref="146mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap" title='mm_struct::mmap' data-ref="mm_struct::mmap">mmap</a>;</td></tr>
<tr><th id="1121">1121</th><td>	<a class="local col7 ref" href="#157area" title='area' data-ref="157area">area</a> = <a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>;</td></tr>
<tr><th id="1122">1122</th><td>	<b>if</b> (<a class="local col7 ref" href="#157area" title='area' data-ref="157area">area</a> &amp;&amp; <a class="local col7 ref" href="#157area" title='area' data-ref="157area">area</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> == <a class="local col9 ref" href="#149end" title='end' data-ref="149end">end</a>)		<i>/* cases 6, 7, 8 */</i></td></tr>
<tr><th id="1123">1123</th><td>		<a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a> = <a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>;</td></tr>
<tr><th id="1124">1124</th><td></td></tr>
<tr><th id="1125">1125</th><td>	<i>/* verify some invariant that must be enforced by the caller */</i></td></tr>
<tr><th id="1126">1126</th><td>	<a class="macro" href="../include/linux/mmdebug.h.html#49" title="((void)(sizeof(( long)(prev &amp;&amp; addr &lt;= prev-&gt;vm_start))))" data-ref="_M/VM_WARN_ON">VM_WARN_ON</a>(<a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a> &amp;&amp; <a class="local col8 ref" href="#148addr" title='addr' data-ref="148addr">addr</a> &lt;= <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>);</td></tr>
<tr><th id="1127">1127</th><td>	<a class="macro" href="../include/linux/mmdebug.h.html#49" title="((void)(sizeof(( long)(area &amp;&amp; end &gt; area-&gt;vm_end))))" data-ref="_M/VM_WARN_ON">VM_WARN_ON</a>(<a class="local col7 ref" href="#157area" title='area' data-ref="157area">area</a> &amp;&amp; <a class="local col9 ref" href="#149end" title='end' data-ref="149end">end</a> &gt; <a class="local col7 ref" href="#157area" title='area' data-ref="157area">area</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>);</td></tr>
<tr><th id="1128">1128</th><td>	<a class="macro" href="../include/linux/mmdebug.h.html#49" title="((void)(sizeof(( long)(addr &gt;= end))))" data-ref="_M/VM_WARN_ON">VM_WARN_ON</a>(<a class="local col8 ref" href="#148addr" title='addr' data-ref="148addr">addr</a> &gt;= <a class="local col9 ref" href="#149end" title='end' data-ref="149end">end</a>);</td></tr>
<tr><th id="1129">1129</th><td></td></tr>
<tr><th id="1130">1130</th><td>	<i>/*</i></td></tr>
<tr><th id="1131">1131</th><td><i>	 * Can it merge with the predecessor?</i></td></tr>
<tr><th id="1132">1132</th><td><i>	 */</i></td></tr>
<tr><th id="1133">1133</th><td>	<b>if</b> (<a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a> &amp;&amp; <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> == <a class="local col8 ref" href="#148addr" title='addr' data-ref="148addr">addr</a> &amp;&amp;</td></tr>
<tr><th id="1134">1134</th><td>			<a class="ref fn" href="../include/linux/mempolicy.h.html#mpol_equal" title='mpol_equal' data-ref="mpol_equal">mpol_equal</a>(<a class="macro" href="../include/linux/mempolicy.h.html#246" title="((void *)0)" data-ref="_M/vma_policy">vma_policy</a>(prev), <a class="local col4 ref" href="#154policy" title='policy' data-ref="154policy">policy</a>) &amp;&amp;</td></tr>
<tr><th id="1135">1135</th><td>			<a class="tu ref fn" href="#can_vma_merge_after" title='can_vma_merge_after' data-use='c' data-ref="can_vma_merge_after">can_vma_merge_after</a>(<a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>, <a class="local col0 ref" href="#150vm_flags" title='vm_flags' data-ref="150vm_flags">vm_flags</a>,</td></tr>
<tr><th id="1136">1136</th><td>					    <a class="local col1 ref" href="#151anon_vma" title='anon_vma' data-ref="151anon_vma">anon_vma</a>, <a class="local col2 ref" href="#152file" title='file' data-ref="152file">file</a>, <a class="local col3 ref" href="#153pgoff" title='pgoff' data-ref="153pgoff">pgoff</a>,</td></tr>
<tr><th id="1137">1137</th><td>					    <a class="local col5 ref" href="#155vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-ref="155vm_userfaultfd_ctx">vm_userfaultfd_ctx</a>)) {</td></tr>
<tr><th id="1138">1138</th><td>		<i>/*</i></td></tr>
<tr><th id="1139">1139</th><td><i>		 * OK, it can.  Can we now merge in the successor as well?</i></td></tr>
<tr><th id="1140">1140</th><td><i>		 */</i></td></tr>
<tr><th id="1141">1141</th><td>		<b>if</b> (<a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a> &amp;&amp; <a class="local col9 ref" href="#149end" title='end' data-ref="149end">end</a> == <a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &amp;&amp;</td></tr>
<tr><th id="1142">1142</th><td>				<a class="ref fn" href="../include/linux/mempolicy.h.html#mpol_equal" title='mpol_equal' data-ref="mpol_equal">mpol_equal</a>(<a class="local col4 ref" href="#154policy" title='policy' data-ref="154policy">policy</a>, <a class="macro" href="../include/linux/mempolicy.h.html#246" title="((void *)0)" data-ref="_M/vma_policy">vma_policy</a>(next)) &amp;&amp;</td></tr>
<tr><th id="1143">1143</th><td>				<a class="tu ref fn" href="#can_vma_merge_before" title='can_vma_merge_before' data-use='c' data-ref="can_vma_merge_before">can_vma_merge_before</a>(<a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>, <a class="local col0 ref" href="#150vm_flags" title='vm_flags' data-ref="150vm_flags">vm_flags</a>,</td></tr>
<tr><th id="1144">1144</th><td>						     <a class="local col1 ref" href="#151anon_vma" title='anon_vma' data-ref="151anon_vma">anon_vma</a>, <a class="local col2 ref" href="#152file" title='file' data-ref="152file">file</a>,</td></tr>
<tr><th id="1145">1145</th><td>						     <a class="local col3 ref" href="#153pgoff" title='pgoff' data-ref="153pgoff">pgoff</a>+<a class="local col6 ref" href="#156pglen" title='pglen' data-ref="156pglen">pglen</a>,</td></tr>
<tr><th id="1146">1146</th><td>						     <a class="local col5 ref" href="#155vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-ref="155vm_userfaultfd_ctx">vm_userfaultfd_ctx</a>) &amp;&amp;</td></tr>
<tr><th id="1147">1147</th><td>				<a class="tu ref fn" href="#is_mergeable_anon_vma" title='is_mergeable_anon_vma' data-use='c' data-ref="is_mergeable_anon_vma">is_mergeable_anon_vma</a>(<a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>,</td></tr>
<tr><th id="1148">1148</th><td>						      <a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>)) {</td></tr>
<tr><th id="1149">1149</th><td>							<i>/* cases 1, 6 */</i></td></tr>
<tr><th id="1150">1150</th><td>			<a class="local col9 ref" href="#159err" title='err' data-ref="159err">err</a> = <a class="ref fn" href="#__vma_adjust" title='__vma_adjust' data-ref="__vma_adjust">__vma_adjust</a>(<a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>, <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>,</td></tr>
<tr><th id="1151">1151</th><td>					 <a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>, <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>,</td></tr>
<tr><th id="1152">1152</th><td>					 <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>);</td></tr>
<tr><th id="1153">1153</th><td>		} <b>else</b>					<i>/* cases 2, 5, 7 */</i></td></tr>
<tr><th id="1154">1154</th><td>			<a class="local col9 ref" href="#159err" title='err' data-ref="159err">err</a> = <a class="ref fn" href="#__vma_adjust" title='__vma_adjust' data-ref="__vma_adjust">__vma_adjust</a>(<a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>, <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>,</td></tr>
<tr><th id="1155">1155</th><td>					 <a class="local col9 ref" href="#149end" title='end' data-ref="149end">end</a>, <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>);</td></tr>
<tr><th id="1156">1156</th><td>		<b>if</b> (<a class="local col9 ref" href="#159err" title='err' data-ref="159err">err</a>)</td></tr>
<tr><th id="1157">1157</th><td>			<b>return</b> <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1158">1158</th><td>		<a class="ref fn" href="../include/linux/khugepaged.h.html#khugepaged_enter_vma_merge" title='khugepaged_enter_vma_merge' data-ref="khugepaged_enter_vma_merge">khugepaged_enter_vma_merge</a>(<a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>, <a class="local col0 ref" href="#150vm_flags" title='vm_flags' data-ref="150vm_flags">vm_flags</a>);</td></tr>
<tr><th id="1159">1159</th><td>		<b>return</b> <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>;</td></tr>
<tr><th id="1160">1160</th><td>	}</td></tr>
<tr><th id="1161">1161</th><td></td></tr>
<tr><th id="1162">1162</th><td>	<i>/*</i></td></tr>
<tr><th id="1163">1163</th><td><i>	 * Can this new request be merged in front of next?</i></td></tr>
<tr><th id="1164">1164</th><td><i>	 */</i></td></tr>
<tr><th id="1165">1165</th><td>	<b>if</b> (<a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a> &amp;&amp; <a class="local col9 ref" href="#149end" title='end' data-ref="149end">end</a> == <a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &amp;&amp;</td></tr>
<tr><th id="1166">1166</th><td>			<a class="ref fn" href="../include/linux/mempolicy.h.html#mpol_equal" title='mpol_equal' data-ref="mpol_equal">mpol_equal</a>(<a class="local col4 ref" href="#154policy" title='policy' data-ref="154policy">policy</a>, <a class="macro" href="../include/linux/mempolicy.h.html#246" title="((void *)0)" data-ref="_M/vma_policy">vma_policy</a>(next)) &amp;&amp;</td></tr>
<tr><th id="1167">1167</th><td>			<a class="tu ref fn" href="#can_vma_merge_before" title='can_vma_merge_before' data-use='c' data-ref="can_vma_merge_before">can_vma_merge_before</a>(<a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>, <a class="local col0 ref" href="#150vm_flags" title='vm_flags' data-ref="150vm_flags">vm_flags</a>,</td></tr>
<tr><th id="1168">1168</th><td>					     <a class="local col1 ref" href="#151anon_vma" title='anon_vma' data-ref="151anon_vma">anon_vma</a>, <a class="local col2 ref" href="#152file" title='file' data-ref="152file">file</a>, <a class="local col3 ref" href="#153pgoff" title='pgoff' data-ref="153pgoff">pgoff</a>+<a class="local col6 ref" href="#156pglen" title='pglen' data-ref="156pglen">pglen</a>,</td></tr>
<tr><th id="1169">1169</th><td>					     <a class="local col5 ref" href="#155vm_userfaultfd_ctx" title='vm_userfaultfd_ctx' data-ref="155vm_userfaultfd_ctx">vm_userfaultfd_ctx</a>)) {</td></tr>
<tr><th id="1170">1170</th><td>		<b>if</b> (<a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a> &amp;&amp; <a class="local col8 ref" href="#148addr" title='addr' data-ref="148addr">addr</a> &lt; <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>)	<i>/* case 4 */</i></td></tr>
<tr><th id="1171">1171</th><td>			<a class="local col9 ref" href="#159err" title='err' data-ref="159err">err</a> = <a class="ref fn" href="#__vma_adjust" title='__vma_adjust' data-ref="__vma_adjust">__vma_adjust</a>(<a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>, <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>,</td></tr>
<tr><th id="1172">1172</th><td>					 <a class="local col8 ref" href="#148addr" title='addr' data-ref="148addr">addr</a>, <a class="local col7 ref" href="#147prev" title='prev' data-ref="147prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>);</td></tr>
<tr><th id="1173">1173</th><td>		<b>else</b> {					<i>/* cases 3, 8 */</i></td></tr>
<tr><th id="1174">1174</th><td>			<a class="local col9 ref" href="#159err" title='err' data-ref="159err">err</a> = <a class="ref fn" href="#__vma_adjust" title='__vma_adjust' data-ref="__vma_adjust">__vma_adjust</a>(<a class="local col7 ref" href="#157area" title='area' data-ref="157area">area</a>, <a class="local col8 ref" href="#148addr" title='addr' data-ref="148addr">addr</a>, <a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>,</td></tr>
<tr><th id="1175">1175</th><td>					 <a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> - <a class="local col6 ref" href="#156pglen" title='pglen' data-ref="156pglen">pglen</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>);</td></tr>
<tr><th id="1176">1176</th><td>			<i>/*</i></td></tr>
<tr><th id="1177">1177</th><td><i>			 * In case 3 area is already equal to next and</i></td></tr>
<tr><th id="1178">1178</th><td><i>			 * this is a noop, but in case 8 "area" has</i></td></tr>
<tr><th id="1179">1179</th><td><i>			 * been removed and next was expanded over it.</i></td></tr>
<tr><th id="1180">1180</th><td><i>			 */</i></td></tr>
<tr><th id="1181">1181</th><td>			<a class="local col7 ref" href="#157area" title='area' data-ref="157area">area</a> = <a class="local col8 ref" href="#158next" title='next' data-ref="158next">next</a>;</td></tr>
<tr><th id="1182">1182</th><td>		}</td></tr>
<tr><th id="1183">1183</th><td>		<b>if</b> (<a class="local col9 ref" href="#159err" title='err' data-ref="159err">err</a>)</td></tr>
<tr><th id="1184">1184</th><td>			<b>return</b> <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1185">1185</th><td>		<a class="ref fn" href="../include/linux/khugepaged.h.html#khugepaged_enter_vma_merge" title='khugepaged_enter_vma_merge' data-ref="khugepaged_enter_vma_merge">khugepaged_enter_vma_merge</a>(<a class="local col7 ref" href="#157area" title='area' data-ref="157area">area</a>, <a class="local col0 ref" href="#150vm_flags" title='vm_flags' data-ref="150vm_flags">vm_flags</a>);</td></tr>
<tr><th id="1186">1186</th><td>		<b>return</b> <a class="local col7 ref" href="#157area" title='area' data-ref="157area">area</a>;</td></tr>
<tr><th id="1187">1187</th><td>	}</td></tr>
<tr><th id="1188">1188</th><td></td></tr>
<tr><th id="1189">1189</th><td>	<b>return</b> <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1190">1190</th><td>}</td></tr>
<tr><th id="1191">1191</th><td></td></tr>
<tr><th id="1192">1192</th><td><i  data-doc="anon_vma_compatible">/*</i></td></tr>
<tr><th id="1193">1193</th><td><i  data-doc="anon_vma_compatible"> * Rough compatbility check to quickly see if it's even worth looking</i></td></tr>
<tr><th id="1194">1194</th><td><i  data-doc="anon_vma_compatible"> * at sharing an anon_vma.</i></td></tr>
<tr><th id="1195">1195</th><td><i  data-doc="anon_vma_compatible"> *</i></td></tr>
<tr><th id="1196">1196</th><td><i  data-doc="anon_vma_compatible"> * They need to have the same vm_file, and the flags can only differ</i></td></tr>
<tr><th id="1197">1197</th><td><i  data-doc="anon_vma_compatible"> * in things that mprotect may change.</i></td></tr>
<tr><th id="1198">1198</th><td><i  data-doc="anon_vma_compatible"> *</i></td></tr>
<tr><th id="1199">1199</th><td><i  data-doc="anon_vma_compatible"> * NOTE! The fact that we share an anon_vma doesn't _have_ to mean that</i></td></tr>
<tr><th id="1200">1200</th><td><i  data-doc="anon_vma_compatible"> * we can merge the two vma's. For example, we refuse to merge a vma if</i></td></tr>
<tr><th id="1201">1201</th><td><i  data-doc="anon_vma_compatible"> * there is a vm_ops-&gt;close() function, because that indicates that the</i></td></tr>
<tr><th id="1202">1202</th><td><i  data-doc="anon_vma_compatible"> * driver is doing some kind of reference counting. But that doesn't</i></td></tr>
<tr><th id="1203">1203</th><td><i  data-doc="anon_vma_compatible"> * really matter for the anon_vma sharing case.</i></td></tr>
<tr><th id="1204">1204</th><td><i  data-doc="anon_vma_compatible"> */</i></td></tr>
<tr><th id="1205">1205</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="anon_vma_compatible" title='anon_vma_compatible' data-type='int anon_vma_compatible(struct vm_area_struct * a, struct vm_area_struct * b)' data-ref="anon_vma_compatible">anon_vma_compatible</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col0 decl" id="160a" title='a' data-type='struct vm_area_struct *' data-ref="160a">a</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col1 decl" id="161b" title='b' data-type='struct vm_area_struct *' data-ref="161b">b</dfn>)</td></tr>
<tr><th id="1206">1206</th><td>{</td></tr>
<tr><th id="1207">1207</th><td>	<b>return</b> <a class="local col0 ref" href="#160a" title='a' data-ref="160a">a</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> == <a class="local col1 ref" href="#161b" title='b' data-ref="161b">b</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &amp;&amp;</td></tr>
<tr><th id="1208">1208</th><td>		<a class="ref fn" href="../include/linux/mempolicy.h.html#mpol_equal" title='mpol_equal' data-ref="mpol_equal">mpol_equal</a>(<a class="macro" href="../include/linux/mempolicy.h.html#246" title="((void *)0)" data-ref="_M/vma_policy">vma_policy</a>(a), <a class="macro" href="../include/linux/mempolicy.h.html#246" title="((void *)0)" data-ref="_M/vma_policy">vma_policy</a>(b)) &amp;&amp;</td></tr>
<tr><th id="1209">1209</th><td>		<a class="local col0 ref" href="#160a" title='a' data-ref="160a">a</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a> == <a class="local col1 ref" href="#161b" title='b' data-ref="161b">b</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a> &amp;&amp;</td></tr>
<tr><th id="1210">1210</th><td>		!((<a class="local col0 ref" href="#160a" title='a' data-ref="160a">a</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> ^ <a class="local col1 ref" href="#161b" title='b' data-ref="161b">b</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a>) &amp; ~(<a class="macro" href="../include/linux/mm.h.html#163" title="0x00000001" data-ref="_M/VM_READ">VM_READ</a>|<a class="macro" href="../include/linux/mm.h.html#164" title="0x00000002" data-ref="_M/VM_WRITE">VM_WRITE</a>|<a class="macro" href="../include/linux/mm.h.html#165" title="0x00000004" data-ref="_M/VM_EXEC">VM_EXEC</a>|<a class="macro" href="../include/linux/mm.h.html#200" title="0" data-ref="_M/VM_SOFTDIRTY">VM_SOFTDIRTY</a>)) &amp;&amp;</td></tr>
<tr><th id="1211">1211</th><td>		<a class="local col1 ref" href="#161b" title='b' data-ref="161b">b</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> == <a class="local col0 ref" href="#160a" title='a' data-ref="160a">a</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> + ((<a class="local col1 ref" href="#161b" title='b' data-ref="161b">b</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> - <a class="local col0 ref" href="#160a" title='a' data-ref="160a">a</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>) &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>);</td></tr>
<tr><th id="1212">1212</th><td>}</td></tr>
<tr><th id="1213">1213</th><td></td></tr>
<tr><th id="1214">1214</th><td><i  data-doc="reusable_anon_vma">/*</i></td></tr>
<tr><th id="1215">1215</th><td><i  data-doc="reusable_anon_vma"> * Do some basic sanity checking to see if we can re-use the anon_vma</i></td></tr>
<tr><th id="1216">1216</th><td><i  data-doc="reusable_anon_vma"> * from 'old'. The 'a'/'b' vma's are in VM order - one of them will be</i></td></tr>
<tr><th id="1217">1217</th><td><i  data-doc="reusable_anon_vma"> * the same as 'old', the other will be the new one that is trying</i></td></tr>
<tr><th id="1218">1218</th><td><i  data-doc="reusable_anon_vma"> * to share the anon_vma.</i></td></tr>
<tr><th id="1219">1219</th><td><i  data-doc="reusable_anon_vma"> *</i></td></tr>
<tr><th id="1220">1220</th><td><i  data-doc="reusable_anon_vma"> * NOTE! This runs with mm_sem held for reading, so it is possible that</i></td></tr>
<tr><th id="1221">1221</th><td><i  data-doc="reusable_anon_vma"> * the anon_vma of 'old' is concurrently in the process of being set up</i></td></tr>
<tr><th id="1222">1222</th><td><i  data-doc="reusable_anon_vma"> * by another page fault trying to merge _that_. But that's ok: if it</i></td></tr>
<tr><th id="1223">1223</th><td><i  data-doc="reusable_anon_vma"> * is being set up, that automatically means that it will be a singleton</i></td></tr>
<tr><th id="1224">1224</th><td><i  data-doc="reusable_anon_vma"> * acceptable for merging, so we can do all of this optimistically. But</i></td></tr>
<tr><th id="1225">1225</th><td><i  data-doc="reusable_anon_vma"> * we do that READ_ONCE() to make sure that we never re-load the pointer.</i></td></tr>
<tr><th id="1226">1226</th><td><i  data-doc="reusable_anon_vma"> *</i></td></tr>
<tr><th id="1227">1227</th><td><i  data-doc="reusable_anon_vma"> * IOW: that the "list_is_singular()" test on the anon_vma_chain only</i></td></tr>
<tr><th id="1228">1228</th><td><i  data-doc="reusable_anon_vma"> * matters for the 'stable anon_vma' case (ie the thing we want to avoid</i></td></tr>
<tr><th id="1229">1229</th><td><i  data-doc="reusable_anon_vma"> * is to return an anon_vma that is "complex" due to having gone through</i></td></tr>
<tr><th id="1230">1230</th><td><i  data-doc="reusable_anon_vma"> * a fork).</i></td></tr>
<tr><th id="1231">1231</th><td><i  data-doc="reusable_anon_vma"> *</i></td></tr>
<tr><th id="1232">1232</th><td><i  data-doc="reusable_anon_vma"> * We also make sure that the two vma's are compatible (adjacent,</i></td></tr>
<tr><th id="1233">1233</th><td><i  data-doc="reusable_anon_vma"> * and with the same memory policies). That's all stable, even with just</i></td></tr>
<tr><th id="1234">1234</th><td><i  data-doc="reusable_anon_vma"> * a read lock on the mm_sem.</i></td></tr>
<tr><th id="1235">1235</th><td><i  data-doc="reusable_anon_vma"> */</i></td></tr>
<tr><th id="1236">1236</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma" title='anon_vma' data-ref="anon_vma">anon_vma</a> *<dfn class="tu decl def fn" id="reusable_anon_vma" title='reusable_anon_vma' data-type='struct anon_vma * reusable_anon_vma(struct vm_area_struct * old, struct vm_area_struct * a, struct vm_area_struct * b)' data-ref="reusable_anon_vma">reusable_anon_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="162old" title='old' data-type='struct vm_area_struct *' data-ref="162old">old</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col3 decl" id="163a" title='a' data-type='struct vm_area_struct *' data-ref="163a">a</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col4 decl" id="164b" title='b' data-type='struct vm_area_struct *' data-ref="164b">b</dfn>)</td></tr>
<tr><th id="1237">1237</th><td>{</td></tr>
<tr><th id="1238">1238</th><td>	<b>if</b> (<a class="tu ref fn" href="#anon_vma_compatible" title='anon_vma_compatible' data-use='c' data-ref="anon_vma_compatible">anon_vma_compatible</a>(<a class="local col3 ref" href="#163a" title='a' data-ref="163a">a</a>, <a class="local col4 ref" href="#164b" title='b' data-ref="164b">b</a>)) {</td></tr>
<tr><th id="1239">1239</th><td>		<b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma" title='anon_vma' data-ref="anon_vma">anon_vma</a> *<dfn class="local col5 decl" id="165anon_vma" title='anon_vma' data-type='struct anon_vma *' data-ref="165anon_vma">anon_vma</dfn> = <a class="macro" href="../include/linux/compiler.h.html#254" title="({ union { typeof(old-&gt;anon_vma) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(old-&gt;anon_vma), __u.__c, sizeof(old-&gt;anon_vma)); else __read_once_size_nocheck(&amp;(old-&gt;anon_vma), __u.__c, sizeof(old-&gt;anon_vma)); do { } while (0); __u.__val; })" data-ref="_M/READ_ONCE">READ_ONCE</a>(<a class="local col2 ref" href="#162old" title='old' data-ref="162old">old</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>);</td></tr>
<tr><th id="1240">1240</th><td></td></tr>
<tr><th id="1241">1241</th><td>		<b>if</b> (<a class="local col5 ref" href="#165anon_vma" title='anon_vma' data-ref="165anon_vma">anon_vma</a> &amp;&amp; <a class="ref fn" href="../include/linux/list.h.html#list_is_singular" title='list_is_singular' data-ref="list_is_singular">list_is_singular</a>(&amp;<a class="local col2 ref" href="#162old" title='old' data-ref="162old">old</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma_chain" title='vm_area_struct::anon_vma_chain' data-ref="vm_area_struct::anon_vma_chain">anon_vma_chain</a>))</td></tr>
<tr><th id="1242">1242</th><td>			<b>return</b> <a class="local col5 ref" href="#165anon_vma" title='anon_vma' data-ref="165anon_vma">anon_vma</a>;</td></tr>
<tr><th id="1243">1243</th><td>	}</td></tr>
<tr><th id="1244">1244</th><td>	<b>return</b> <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1245">1245</th><td>}</td></tr>
<tr><th id="1246">1246</th><td></td></tr>
<tr><th id="1247">1247</th><td><i>/*</i></td></tr>
<tr><th id="1248">1248</th><td><i> * find_mergeable_anon_vma is used by anon_vma_prepare, to check</i></td></tr>
<tr><th id="1249">1249</th><td><i> * neighbouring vmas for a suitable anon_vma, before it goes off</i></td></tr>
<tr><th id="1250">1250</th><td><i> * to allocate a new anon_vma.  It checks because a repetitive</i></td></tr>
<tr><th id="1251">1251</th><td><i> * sequence of mprotects and faults may otherwise lead to distinct</i></td></tr>
<tr><th id="1252">1252</th><td><i> * anon_vmas being allocated, preventing vma merge in subsequent</i></td></tr>
<tr><th id="1253">1253</th><td><i> * mprotect.</i></td></tr>
<tr><th id="1254">1254</th><td><i> */</i></td></tr>
<tr><th id="1255">1255</th><td><b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma" title='anon_vma' data-ref="anon_vma">anon_vma</a> *<dfn class="decl def fn" id="find_mergeable_anon_vma" title='find_mergeable_anon_vma' data-ref="find_mergeable_anon_vma">find_mergeable_anon_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col6 decl" id="166vma" title='vma' data-type='struct vm_area_struct *' data-ref="166vma">vma</dfn>)</td></tr>
<tr><th id="1256">1256</th><td>{</td></tr>
<tr><th id="1257">1257</th><td>	<b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma" title='anon_vma' data-ref="anon_vma">anon_vma</a> *<dfn class="local col7 decl" id="167anon_vma" title='anon_vma' data-type='struct anon_vma *' data-ref="167anon_vma">anon_vma</dfn>;</td></tr>
<tr><th id="1258">1258</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col8 decl" id="168near" title='near' data-type='struct vm_area_struct *' data-ref="168near">near</dfn>;</td></tr>
<tr><th id="1259">1259</th><td></td></tr>
<tr><th id="1260">1260</th><td>	<a class="local col8 ref" href="#168near" title='near' data-ref="168near">near</a> = <a class="local col6 ref" href="#166vma" title='vma' data-ref="166vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>;</td></tr>
<tr><th id="1261">1261</th><td>	<b>if</b> (!<a class="local col8 ref" href="#168near" title='near' data-ref="168near">near</a>)</td></tr>
<tr><th id="1262">1262</th><td>		<b>goto</b> <a class="lbl" href="#169try_prev" data-ref="169try_prev">try_prev</a>;</td></tr>
<tr><th id="1263">1263</th><td></td></tr>
<tr><th id="1264">1264</th><td>	<a class="local col7 ref" href="#167anon_vma" title='anon_vma' data-ref="167anon_vma">anon_vma</a> = <a class="tu ref fn" href="#reusable_anon_vma" title='reusable_anon_vma' data-use='c' data-ref="reusable_anon_vma">reusable_anon_vma</a>(<a class="local col8 ref" href="#168near" title='near' data-ref="168near">near</a>, <a class="local col6 ref" href="#166vma" title='vma' data-ref="166vma">vma</a>, <a class="local col8 ref" href="#168near" title='near' data-ref="168near">near</a>);</td></tr>
<tr><th id="1265">1265</th><td>	<b>if</b> (<a class="local col7 ref" href="#167anon_vma" title='anon_vma' data-ref="167anon_vma">anon_vma</a>)</td></tr>
<tr><th id="1266">1266</th><td>		<b>return</b> <a class="local col7 ref" href="#167anon_vma" title='anon_vma' data-ref="167anon_vma">anon_vma</a>;</td></tr>
<tr><th id="1267">1267</th><td><dfn class="lbl" id="169try_prev" data-ref="169try_prev">try_prev</dfn>:</td></tr>
<tr><th id="1268">1268</th><td>	<a class="local col8 ref" href="#168near" title='near' data-ref="168near">near</a> = <a class="local col6 ref" href="#166vma" title='vma' data-ref="166vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a>;</td></tr>
<tr><th id="1269">1269</th><td>	<b>if</b> (!<a class="local col8 ref" href="#168near" title='near' data-ref="168near">near</a>)</td></tr>
<tr><th id="1270">1270</th><td>		<b>goto</b> <a class="lbl" href="#170none" data-ref="170none">none</a>;</td></tr>
<tr><th id="1271">1271</th><td></td></tr>
<tr><th id="1272">1272</th><td>	<a class="local col7 ref" href="#167anon_vma" title='anon_vma' data-ref="167anon_vma">anon_vma</a> = <a class="tu ref fn" href="#reusable_anon_vma" title='reusable_anon_vma' data-use='c' data-ref="reusable_anon_vma">reusable_anon_vma</a>(<a class="local col8 ref" href="#168near" title='near' data-ref="168near">near</a>, <a class="local col8 ref" href="#168near" title='near' data-ref="168near">near</a>, <a class="local col6 ref" href="#166vma" title='vma' data-ref="166vma">vma</a>);</td></tr>
<tr><th id="1273">1273</th><td>	<b>if</b> (<a class="local col7 ref" href="#167anon_vma" title='anon_vma' data-ref="167anon_vma">anon_vma</a>)</td></tr>
<tr><th id="1274">1274</th><td>		<b>return</b> <a class="local col7 ref" href="#167anon_vma" title='anon_vma' data-ref="167anon_vma">anon_vma</a>;</td></tr>
<tr><th id="1275">1275</th><td><dfn class="lbl" id="170none" data-ref="170none">none</dfn>:</td></tr>
<tr><th id="1276">1276</th><td>	<i>/*</i></td></tr>
<tr><th id="1277">1277</th><td><i>	 * There's no absolute need to look only at touching neighbours:</i></td></tr>
<tr><th id="1278">1278</th><td><i>	 * we could search further afield for "compatible" anon_vmas.</i></td></tr>
<tr><th id="1279">1279</th><td><i>	 * But it would probably just be a waste of time searching,</i></td></tr>
<tr><th id="1280">1280</th><td><i>	 * or lead to too many vmas hanging off the same anon_vma.</i></td></tr>
<tr><th id="1281">1281</th><td><i>	 * We're trying to allow mprotect remerging later on,</i></td></tr>
<tr><th id="1282">1282</th><td><i>	 * not trying to minimize memory used for anon_vmas.</i></td></tr>
<tr><th id="1283">1283</th><td><i>	 */</i></td></tr>
<tr><th id="1284">1284</th><td>	<b>return</b> <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1285">1285</th><td>}</td></tr>
<tr><th id="1286">1286</th><td></td></tr>
<tr><th id="1287">1287</th><td><i  data-doc="round_hint_to_min">/*</i></td></tr>
<tr><th id="1288">1288</th><td><i  data-doc="round_hint_to_min"> * If a hint addr is less than mmap_min_addr change hint to be as</i></td></tr>
<tr><th id="1289">1289</th><td><i  data-doc="round_hint_to_min"> * low as possible but still greater than mmap_min_addr</i></td></tr>
<tr><th id="1290">1290</th><td><i  data-doc="round_hint_to_min"> */</i></td></tr>
<tr><th id="1291">1291</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>unsigned</em> <em>long</em> <dfn class="tu decl def fn" id="round_hint_to_min" title='round_hint_to_min' data-type='unsigned long round_hint_to_min(unsigned long hint)' data-ref="round_hint_to_min">round_hint_to_min</dfn>(<em>unsigned</em> <em>long</em> <dfn class="local col1 decl" id="171hint" title='hint' data-type='unsigned long' data-ref="171hint">hint</dfn>)</td></tr>
<tr><th id="1292">1292</th><td>{</td></tr>
<tr><th id="1293">1293</th><td>	<a class="local col1 ref" href="#171hint" title='hint' data-ref="171hint">hint</a> &amp;= <a class="macro" href="../arch/x86/include/asm/page_types.h.html#12" title="(~(((1UL) &lt;&lt; 12)-1))" data-ref="_M/PAGE_MASK">PAGE_MASK</a>;</td></tr>
<tr><th id="1294">1294</th><td>	<b>if</b> (((<em>void</em> *)<a class="local col1 ref" href="#171hint" title='hint' data-ref="171hint">hint</a> != <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>) &amp;&amp;</td></tr>
<tr><th id="1295">1295</th><td>	    (<a class="local col1 ref" href="#171hint" title='hint' data-ref="171hint">hint</a> &lt; <a class="ref" href="../include/linux/security.h.html#mmap_min_addr" title='mmap_min_addr' data-ref="mmap_min_addr">mmap_min_addr</a>))</td></tr>
<tr><th id="1296">1296</th><td>		<b>return</b> <a class="macro" href="../include/linux/mm.h.html#134" title="((((mmap_min_addr)) + ((typeof((mmap_min_addr)))((((1UL) &lt;&lt; 12))) - 1)) &amp; ~((typeof((mmap_min_addr)))((((1UL) &lt;&lt; 12))) - 1))" data-ref="_M/PAGE_ALIGN">PAGE_ALIGN</a>(<a class="ref" href="../include/linux/security.h.html#mmap_min_addr" title='mmap_min_addr' data-ref="mmap_min_addr">mmap_min_addr</a>);</td></tr>
<tr><th id="1297">1297</th><td>	<b>return</b> <a class="local col1 ref" href="#171hint" title='hint' data-ref="171hint">hint</a>;</td></tr>
<tr><th id="1298">1298</th><td>}</td></tr>
<tr><th id="1299">1299</th><td></td></tr>
<tr><th id="1300">1300</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>int</em> <dfn class="tu decl def fn" id="mlock_future_check" title='mlock_future_check' data-type='int mlock_future_check(struct mm_struct * mm, unsigned long flags, unsigned long len)' data-ref="mlock_future_check">mlock_future_check</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col2 decl" id="172mm" title='mm' data-type='struct mm_struct *' data-ref="172mm">mm</dfn>,</td></tr>
<tr><th id="1301">1301</th><td>				     <em>unsigned</em> <em>long</em> <dfn class="local col3 decl" id="173flags" title='flags' data-type='unsigned long' data-ref="173flags">flags</dfn>,</td></tr>
<tr><th id="1302">1302</th><td>				     <em>unsigned</em> <em>long</em> <dfn class="local col4 decl" id="174len" title='len' data-type='unsigned long' data-ref="174len">len</dfn>)</td></tr>
<tr><th id="1303">1303</th><td>{</td></tr>
<tr><th id="1304">1304</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="175locked" title='locked' data-type='unsigned long' data-ref="175locked">locked</dfn>, <dfn class="local col6 decl" id="176lock_limit" title='lock_limit' data-type='unsigned long' data-ref="176lock_limit">lock_limit</dfn>;</td></tr>
<tr><th id="1305">1305</th><td></td></tr>
<tr><th id="1306">1306</th><td>	<i>/*  mlock MCL_FUTURE? */</i></td></tr>
<tr><th id="1307">1307</th><td>	<b>if</b> (<a class="local col3 ref" href="#173flags" title='flags' data-ref="173flags">flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#180" title="0x00002000" data-ref="_M/VM_LOCKED">VM_LOCKED</a>) {</td></tr>
<tr><th id="1308">1308</th><td>		<a class="local col5 ref" href="#175locked" title='locked' data-ref="175locked">locked</a> = <a class="local col4 ref" href="#174len" title='len' data-ref="174len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="1309">1309</th><td>		<a class="local col5 ref" href="#175locked" title='locked' data-ref="175locked">locked</a> += <a class="local col2 ref" href="#172mm" title='mm' data-ref="172mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::locked_vm" title='mm_struct::locked_vm' data-ref="mm_struct::locked_vm">locked_vm</a>;</td></tr>
<tr><th id="1310">1310</th><td>		<a class="local col6 ref" href="#176lock_limit" title='lock_limit' data-ref="176lock_limit">lock_limit</a> = <a class="ref fn" href="../include/linux/sched/signal.h.html#rlimit" title='rlimit' data-ref="rlimit">rlimit</a>(<a class="macro" href="../include/uapi/asm-generic/resource.h.html#35" title="8" data-ref="_M/RLIMIT_MEMLOCK">RLIMIT_MEMLOCK</a>);</td></tr>
<tr><th id="1311">1311</th><td>		<a class="local col6 ref" href="#176lock_limit" title='lock_limit' data-ref="176lock_limit">lock_limit</a> &gt;&gt;= <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="1312">1312</th><td>		<b>if</b> (<a class="local col5 ref" href="#175locked" title='locked' data-ref="175locked">locked</a> &gt; <a class="local col6 ref" href="#176lock_limit" title='lock_limit' data-ref="176lock_limit">lock_limit</a> &amp;&amp; !<a class="ref fn" href="../include/linux/capability.h.html#capable" title='capable' data-ref="capable">capable</a>(<a class="macro" href="../include/uapi/linux/capability.h.html#215" title="14" data-ref="_M/CAP_IPC_LOCK">CAP_IPC_LOCK</a>))</td></tr>
<tr><th id="1313">1313</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#15" title="11" data-ref="_M/EAGAIN">EAGAIN</a>;</td></tr>
<tr><th id="1314">1314</th><td>	}</td></tr>
<tr><th id="1315">1315</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1316">1316</th><td>}</td></tr>
<tr><th id="1317">1317</th><td></td></tr>
<tr><th id="1318">1318</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <a class="typedef" href="../include/asm-generic/int-ll64.h.html#u64" title='u64' data-type='unsigned long long' data-ref="u64">u64</a> <dfn class="tu decl def fn" id="file_mmap_size_max" title='file_mmap_size_max' data-type='u64 file_mmap_size_max(struct file * file, struct inode * inode)' data-ref="file_mmap_size_max">file_mmap_size_max</dfn>(<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col7 decl" id="177file" title='file' data-type='struct file *' data-ref="177file">file</dfn>, <b>struct</b> <a class="type" href="../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col8 decl" id="178inode" title='inode' data-type='struct inode *' data-ref="178inode">inode</dfn>)</td></tr>
<tr><th id="1319">1319</th><td>{</td></tr>
<tr><th id="1320">1320</th><td>	<b>if</b> (<a class="macro" href="../include/uapi/linux/stat.h.html#22" title="(((inode-&gt;i_mode) &amp; 00170000) == 0100000)" data-ref="_M/S_ISREG">S_ISREG</a>(<a class="local col8 ref" href="#178inode" title='inode' data-ref="178inode">inode</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#inode::i_mode" title='inode::i_mode' data-ref="inode::i_mode">i_mode</a>))</td></tr>
<tr><th id="1321">1321</th><td>		<b>return</b> <a class="macro" href="../include/linux/fs.h.html#916" title="((loff_t)((long long)(~0ULL&gt;&gt;1)))" data-ref="_M/MAX_LFS_FILESIZE">MAX_LFS_FILESIZE</a>;</td></tr>
<tr><th id="1322">1322</th><td></td></tr>
<tr><th id="1323">1323</th><td>	<b>if</b> (<a class="macro" href="../include/uapi/linux/stat.h.html#25" title="(((inode-&gt;i_mode) &amp; 00170000) == 0060000)" data-ref="_M/S_ISBLK">S_ISBLK</a>(<a class="local col8 ref" href="#178inode" title='inode' data-ref="178inode">inode</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#inode::i_mode" title='inode::i_mode' data-ref="inode::i_mode">i_mode</a>))</td></tr>
<tr><th id="1324">1324</th><td>		<b>return</b> <a class="macro" href="../include/linux/fs.h.html#916" title="((loff_t)((long long)(~0ULL&gt;&gt;1)))" data-ref="_M/MAX_LFS_FILESIZE">MAX_LFS_FILESIZE</a>;</td></tr>
<tr><th id="1325">1325</th><td></td></tr>
<tr><th id="1326">1326</th><td>	<i>/* Special "we do even unsigned file positions" case */</i></td></tr>
<tr><th id="1327">1327</th><td>	<b>if</b> (<a class="local col7 ref" href="#177file" title='file' data-ref="177file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mode" title='file::f_mode' data-ref="file::f_mode">f_mode</a> &amp; <a class="macro" href="../include/linux/fs.h.html#135" title="(( fmode_t)0x2000)" data-ref="_M/FMODE_UNSIGNED_OFFSET">FMODE_UNSIGNED_OFFSET</a>)</td></tr>
<tr><th id="1328">1328</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1329">1329</th><td></td></tr>
<tr><th id="1330">1330</th><td>	<i>/* Yes, random drivers might want more. But I'm tired of buggy drivers */</i></td></tr>
<tr><th id="1331">1331</th><td>	<b>return</b> <a class="macro" href="../include/linux/kernel.h.html#27" title="(~0UL)" data-ref="_M/ULONG_MAX">ULONG_MAX</a>;</td></tr>
<tr><th id="1332">1332</th><td>}</td></tr>
<tr><th id="1333">1333</th><td></td></tr>
<tr><th id="1334">1334</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <a class="typedef" href="../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="tu decl def fn" id="file_mmap_ok" title='file_mmap_ok' data-type='bool file_mmap_ok(struct file * file, struct inode * inode, unsigned long pgoff, unsigned long len)' data-ref="file_mmap_ok">file_mmap_ok</dfn>(<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col9 decl" id="179file" title='file' data-type='struct file *' data-ref="179file">file</dfn>, <b>struct</b> <a class="type" href="../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col0 decl" id="180inode" title='inode' data-type='struct inode *' data-ref="180inode">inode</dfn>,</td></tr>
<tr><th id="1335">1335</th><td>				<em>unsigned</em> <em>long</em> <dfn class="local col1 decl" id="181pgoff" title='pgoff' data-type='unsigned long' data-ref="181pgoff">pgoff</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col2 decl" id="182len" title='len' data-type='unsigned long' data-ref="182len">len</dfn>)</td></tr>
<tr><th id="1336">1336</th><td>{</td></tr>
<tr><th id="1337">1337</th><td>	<a class="typedef" href="../include/asm-generic/int-ll64.h.html#u64" title='u64' data-type='unsigned long long' data-ref="u64">u64</a> <dfn class="local col3 decl" id="183maxsize" title='maxsize' data-type='u64' data-ref="183maxsize">maxsize</dfn> = <a class="tu ref fn" href="#file_mmap_size_max" title='file_mmap_size_max' data-use='c' data-ref="file_mmap_size_max">file_mmap_size_max</a>(<a class="local col9 ref" href="#179file" title='file' data-ref="179file">file</a>, <a class="local col0 ref" href="#180inode" title='inode' data-ref="180inode">inode</a>);</td></tr>
<tr><th id="1338">1338</th><td></td></tr>
<tr><th id="1339">1339</th><td>	<b>if</b> (<a class="local col3 ref" href="#183maxsize" title='maxsize' data-ref="183maxsize">maxsize</a> &amp;&amp; <a class="local col2 ref" href="#182len" title='len' data-ref="182len">len</a> &gt; <a class="local col3 ref" href="#183maxsize" title='maxsize' data-ref="183maxsize">maxsize</a>)</td></tr>
<tr><th id="1340">1340</th><td>		<b>return</b> <a class="enum" href="../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="1341">1341</th><td>	<a class="local col3 ref" href="#183maxsize" title='maxsize' data-ref="183maxsize">maxsize</a> -= <a class="local col2 ref" href="#182len" title='len' data-ref="182len">len</a>;</td></tr>
<tr><th id="1342">1342</th><td>	<b>if</b> (<a class="local col1 ref" href="#181pgoff" title='pgoff' data-ref="181pgoff">pgoff</a> &gt; <a class="local col3 ref" href="#183maxsize" title='maxsize' data-ref="183maxsize">maxsize</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>)</td></tr>
<tr><th id="1343">1343</th><td>		<b>return</b> <a class="enum" href="../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="1344">1344</th><td>	<b>return</b> <a class="enum" href="../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="1345">1345</th><td>}</td></tr>
<tr><th id="1346">1346</th><td></td></tr>
<tr><th id="1347">1347</th><td><i>/*</i></td></tr>
<tr><th id="1348">1348</th><td><i> * The caller must hold down_write(&amp;current-&gt;mm-&gt;mmap_sem).</i></td></tr>
<tr><th id="1349">1349</th><td><i> */</i></td></tr>
<tr><th id="1350">1350</th><td><em>unsigned</em> <em>long</em> <dfn class="decl def fn" id="do_mmap" title='do_mmap' data-ref="do_mmap">do_mmap</dfn>(<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col4 decl" id="184file" title='file' data-type='struct file *' data-ref="184file">file</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="185addr" title='addr' data-type='unsigned long' data-ref="185addr">addr</dfn>,</td></tr>
<tr><th id="1351">1351</th><td>			<em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="186len" title='len' data-type='unsigned long' data-ref="186len">len</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="187prot" title='prot' data-type='unsigned long' data-ref="187prot">prot</dfn>,</td></tr>
<tr><th id="1352">1352</th><td>			<em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="188flags" title='flags' data-type='unsigned long' data-ref="188flags">flags</dfn>, <a class="typedef" href="../include/linux/mm_types.h.html#vm_flags_t" title='vm_flags_t' data-type='unsigned long' data-ref="vm_flags_t">vm_flags_t</a> <dfn class="local col9 decl" id="189vm_flags" title='vm_flags' data-type='vm_flags_t' data-ref="189vm_flags">vm_flags</dfn>,</td></tr>
<tr><th id="1353">1353</th><td>			<em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="190pgoff" title='pgoff' data-type='unsigned long' data-ref="190pgoff">pgoff</dfn>, <em>unsigned</em> <em>long</em> *<dfn class="local col1 decl" id="191populate" title='populate' data-type='unsigned long *' data-ref="191populate">populate</dfn>,</td></tr>
<tr><th id="1354">1354</th><td>			<b>struct</b> <a class="type" href="../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a> *<dfn class="local col2 decl" id="192uf" title='uf' data-type='struct list_head *' data-ref="192uf">uf</dfn>)</td></tr>
<tr><th id="1355">1355</th><td>{</td></tr>
<tr><th id="1356">1356</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col3 decl" id="193mm" title='mm' data-type='struct mm_struct *' data-ref="193mm">mm</dfn> = <a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::mm" title='task_struct::mm' data-ref="task_struct::mm">mm</a>;</td></tr>
<tr><th id="1357">1357</th><td>	<em>int</em> <dfn class="local col4 decl" id="194pkey" title='pkey' data-type='int' data-ref="194pkey">pkey</dfn> = <var>0</var>;</td></tr>
<tr><th id="1358">1358</th><td></td></tr>
<tr><th id="1359">1359</th><td>	*<a class="local col1 ref" href="#191populate" title='populate' data-ref="191populate">populate</a> = <var>0</var>;</td></tr>
<tr><th id="1360">1360</th><td></td></tr>
<tr><th id="1361">1361</th><td>	<b>if</b> (!<a class="local col6 ref" href="#186len" title='len' data-ref="186len">len</a>)</td></tr>
<tr><th id="1362">1362</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1363">1363</th><td></td></tr>
<tr><th id="1364">1364</th><td>	<i>/*</i></td></tr>
<tr><th id="1365">1365</th><td><i>	 * Does the application expect PROT_READ to imply PROT_EXEC?</i></td></tr>
<tr><th id="1366">1366</th><td><i>	 *</i></td></tr>
<tr><th id="1367">1367</th><td><i>	 * (the exception is when the underlying filesystem is noexec</i></td></tr>
<tr><th id="1368">1368</th><td><i>	 *  mounted, in which case we dont add PROT_EXEC.)</i></td></tr>
<tr><th id="1369">1369</th><td><i>	 */</i></td></tr>
<tr><th id="1370">1370</th><td>	<b>if</b> ((<a class="local col7 ref" href="#187prot" title='prot' data-ref="187prot">prot</a> &amp; <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#10" title="0x1" data-ref="_M/PROT_READ">PROT_READ</a>) &amp;&amp; (<a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::personality" title='task_struct::personality' data-ref="task_struct::personality">personality</a> &amp; <a class="enum" href="../include/uapi/linux/personality.h.html#READ_IMPLIES_EXEC" title='READ_IMPLIES_EXEC' data-ref="READ_IMPLIES_EXEC">READ_IMPLIES_EXEC</a>))</td></tr>
<tr><th id="1371">1371</th><td>		<b>if</b> (!(<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a> &amp;&amp; <a class="ref fn" href="../include/linux/fs.h.html#path_noexec" title='path_noexec' data-ref="path_noexec">path_noexec</a>(&amp;<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_path" title='file::f_path' data-ref="file::f_path">f_path</a>)))</td></tr>
<tr><th id="1372">1372</th><td>			<a class="local col7 ref" href="#187prot" title='prot' data-ref="187prot">prot</a> |= <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#12" title="0x4" data-ref="_M/PROT_EXEC">PROT_EXEC</a>;</td></tr>
<tr><th id="1373">1373</th><td></td></tr>
<tr><th id="1374">1374</th><td>	<b>if</b> (!(<a class="local col8 ref" href="#188flags" title='flags' data-ref="188flags">flags</a> &amp; <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#21" title="0x10" data-ref="_M/MAP_FIXED">MAP_FIXED</a>))</td></tr>
<tr><th id="1375">1375</th><td>		<a class="local col5 ref" href="#185addr" title='addr' data-ref="185addr">addr</a> = <a class="tu ref fn" href="#round_hint_to_min" title='round_hint_to_min' data-use='c' data-ref="round_hint_to_min">round_hint_to_min</a>(<a class="local col5 ref" href="#185addr" title='addr' data-ref="185addr">addr</a>);</td></tr>
<tr><th id="1376">1376</th><td></td></tr>
<tr><th id="1377">1377</th><td>	<i>/* Careful about overflows.. */</i></td></tr>
<tr><th id="1378">1378</th><td>	<a class="local col6 ref" href="#186len" title='len' data-ref="186len">len</a> = <a class="macro" href="../include/linux/mm.h.html#134" title="((((len)) + ((typeof((len)))((((1UL) &lt;&lt; 12))) - 1)) &amp; ~((typeof((len)))((((1UL) &lt;&lt; 12))) - 1))" data-ref="_M/PAGE_ALIGN">PAGE_ALIGN</a>(<a class="local col6 ref" href="#186len" title='len' data-ref="186len">len</a>);</td></tr>
<tr><th id="1379">1379</th><td>	<b>if</b> (!<a class="local col6 ref" href="#186len" title='len' data-ref="186len">len</a>)</td></tr>
<tr><th id="1380">1380</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1381">1381</th><td></td></tr>
<tr><th id="1382">1382</th><td>	<i>/* offset overflow? */</i></td></tr>
<tr><th id="1383">1383</th><td>	<b>if</b> ((<a class="local col0 ref" href="#190pgoff" title='pgoff' data-ref="190pgoff">pgoff</a> + (<a class="local col6 ref" href="#186len" title='len' data-ref="186len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>)) &lt; <a class="local col0 ref" href="#190pgoff" title='pgoff' data-ref="190pgoff">pgoff</a>)</td></tr>
<tr><th id="1384">1384</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno.h.html#58" title="75" data-ref="_M/EOVERFLOW">EOVERFLOW</a>;</td></tr>
<tr><th id="1385">1385</th><td></td></tr>
<tr><th id="1386">1386</th><td>	<i>/* Too many mappings? */</i></td></tr>
<tr><th id="1387">1387</th><td>	<b>if</b> (<a class="local col3 ref" href="#193mm" title='mm' data-ref="193mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::map_count" title='mm_struct::map_count' data-ref="mm_struct::map_count">map_count</a> &gt; <a class="ref" href="../include/linux/mm.h.html#sysctl_max_map_count" title='sysctl_max_map_count' data-ref="sysctl_max_map_count">sysctl_max_map_count</a>)</td></tr>
<tr><th id="1388">1388</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1389">1389</th><td></td></tr>
<tr><th id="1390">1390</th><td>	<i>/* Obtain the address to map to. we verify (or select) it and ensure</i></td></tr>
<tr><th id="1391">1391</th><td><i>	 * that it represents a valid section of the address space.</i></td></tr>
<tr><th id="1392">1392</th><td><i>	 */</i></td></tr>
<tr><th id="1393">1393</th><td>	<a class="local col5 ref" href="#185addr" title='addr' data-ref="185addr">addr</a> = <a class="ref fn" href="#get_unmapped_area" title='get_unmapped_area' data-ref="get_unmapped_area">get_unmapped_area</a>(<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>, <a class="local col5 ref" href="#185addr" title='addr' data-ref="185addr">addr</a>, <a class="local col6 ref" href="#186len" title='len' data-ref="186len">len</a>, <a class="local col0 ref" href="#190pgoff" title='pgoff' data-ref="190pgoff">pgoff</a>, <a class="local col8 ref" href="#188flags" title='flags' data-ref="188flags">flags</a>);</td></tr>
<tr><th id="1394">1394</th><td>	<b>if</b> (<a class="macro" href="../include/linux/mm.h.html#1216" title="((unsigned long)(addr) &amp; ~(~(((1UL) &lt;&lt; 12)-1)))" data-ref="_M/offset_in_page">offset_in_page</a>(<a class="local col5 ref" href="#185addr" title='addr' data-ref="185addr">addr</a>))</td></tr>
<tr><th id="1395">1395</th><td>		<b>return</b> <a class="local col5 ref" href="#185addr" title='addr' data-ref="185addr">addr</a>;</td></tr>
<tr><th id="1396">1396</th><td></td></tr>
<tr><th id="1397">1397</th><td>	<b>if</b> (<a class="local col7 ref" href="#187prot" title='prot' data-ref="187prot">prot</a> == <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#12" title="0x4" data-ref="_M/PROT_EXEC">PROT_EXEC</a>) {</td></tr>
<tr><th id="1398">1398</th><td>		<a class="local col4 ref" href="#194pkey" title='pkey' data-ref="194pkey">pkey</a> = <a class="ref fn" href="../arch/x86/include/asm/pkeys.h.html#execute_only_pkey" title='execute_only_pkey' data-ref="execute_only_pkey">execute_only_pkey</a>(<a class="local col3 ref" href="#193mm" title='mm' data-ref="193mm">mm</a>);</td></tr>
<tr><th id="1399">1399</th><td>		<b>if</b> (<a class="local col4 ref" href="#194pkey" title='pkey' data-ref="194pkey">pkey</a> &lt; <var>0</var>)</td></tr>
<tr><th id="1400">1400</th><td>			<a class="local col4 ref" href="#194pkey" title='pkey' data-ref="194pkey">pkey</a> = <var>0</var>;</td></tr>
<tr><th id="1401">1401</th><td>	}</td></tr>
<tr><th id="1402">1402</th><td></td></tr>
<tr><th id="1403">1403</th><td>	<i>/* Do simple checking here so the lower-level routines won't have</i></td></tr>
<tr><th id="1404">1404</th><td><i>	 * to. we assume access permissions have been handled by the open</i></td></tr>
<tr><th id="1405">1405</th><td><i>	 * of the memory object, so we don't do any here.</i></td></tr>
<tr><th id="1406">1406</th><td><i>	 */</i></td></tr>
<tr><th id="1407">1407</th><td>	<a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a> |= <a class="ref fn" href="../include/linux/mman.h.html#calc_vm_prot_bits" title='calc_vm_prot_bits' data-ref="calc_vm_prot_bits">calc_vm_prot_bits</a>(<a class="local col7 ref" href="#187prot" title='prot' data-ref="187prot">prot</a>, <a class="local col4 ref" href="#194pkey" title='pkey' data-ref="194pkey">pkey</a>) | <a class="ref fn" href="../include/linux/mman.h.html#calc_vm_flag_bits" title='calc_vm_flag_bits' data-ref="calc_vm_flag_bits">calc_vm_flag_bits</a>(<a class="local col8 ref" href="#188flags" title='flags' data-ref="188flags">flags</a>) |</td></tr>
<tr><th id="1408">1408</th><td>			<a class="local col3 ref" href="#193mm" title='mm' data-ref="193mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::def_flags" title='mm_struct::def_flags' data-ref="mm_struct::def_flags">def_flags</a> | <a class="macro" href="../include/linux/mm.h.html#169" title="0x00000010" data-ref="_M/VM_MAYREAD">VM_MAYREAD</a> | <a class="macro" href="../include/linux/mm.h.html#170" title="0x00000020" data-ref="_M/VM_MAYWRITE">VM_MAYWRITE</a> | <a class="macro" href="../include/linux/mm.h.html#171" title="0x00000040" data-ref="_M/VM_MAYEXEC">VM_MAYEXEC</a>;</td></tr>
<tr><th id="1409">1409</th><td></td></tr>
<tr><th id="1410">1410</th><td>	<b>if</b> (<a class="local col8 ref" href="#188flags" title='flags' data-ref="188flags">flags</a> &amp; <a class="macro" href="../include/uapi/asm-generic/mman.h.html#10" title="0x2000" data-ref="_M/MAP_LOCKED">MAP_LOCKED</a>)</td></tr>
<tr><th id="1411">1411</th><td>		<b>if</b> (!<a class="ref fn" href="../include/linux/mm.h.html#can_do_mlock" title='can_do_mlock' data-ref="can_do_mlock">can_do_mlock</a>())</td></tr>
<tr><th id="1412">1412</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="1413">1413</th><td></td></tr>
<tr><th id="1414">1414</th><td>	<b>if</b> (<a class="tu ref fn" href="#mlock_future_check" title='mlock_future_check' data-use='c' data-ref="mlock_future_check">mlock_future_check</a>(<a class="local col3 ref" href="#193mm" title='mm' data-ref="193mm">mm</a>, <a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a>, <a class="local col6 ref" href="#186len" title='len' data-ref="186len">len</a>))</td></tr>
<tr><th id="1415">1415</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#15" title="11" data-ref="_M/EAGAIN">EAGAIN</a>;</td></tr>
<tr><th id="1416">1416</th><td></td></tr>
<tr><th id="1417">1417</th><td>	<b>if</b> (<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>) {</td></tr>
<tr><th id="1418">1418</th><td>		<b>struct</b> <a class="type" href="../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col5 decl" id="195inode" title='inode' data-type='struct inode *' data-ref="195inode">inode</dfn> = <a class="ref fn" href="../include/linux/fs.h.html#file_inode" title='file_inode' data-ref="file_inode">file_inode</a>(<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>);</td></tr>
<tr><th id="1419">1419</th><td></td></tr>
<tr><th id="1420">1420</th><td>		<b>if</b> (!<a class="tu ref fn" href="#file_mmap_ok" title='file_mmap_ok' data-use='c' data-ref="file_mmap_ok">file_mmap_ok</a>(<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>, <a class="local col5 ref" href="#195inode" title='inode' data-ref="195inode">inode</a>, <a class="local col0 ref" href="#190pgoff" title='pgoff' data-ref="190pgoff">pgoff</a>, <a class="local col6 ref" href="#186len" title='len' data-ref="186len">len</a>))</td></tr>
<tr><th id="1421">1421</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno.h.html#58" title="75" data-ref="_M/EOVERFLOW">EOVERFLOW</a>;</td></tr>
<tr><th id="1422">1422</th><td></td></tr>
<tr><th id="1423">1423</th><td>		<b>switch</b> (<a class="local col8 ref" href="#188flags" title='flags' data-ref="188flags">flags</a> &amp; <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#20" title="0x0f" data-ref="_M/MAP_TYPE">MAP_TYPE</a>) {</td></tr>
<tr><th id="1424">1424</th><td>		<b>case</b> <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#18" title="0x01" data-ref="_M/MAP_SHARED">MAP_SHARED</a>:</td></tr>
<tr><th id="1425">1425</th><td>			<b>if</b> ((<a class="local col7 ref" href="#187prot" title='prot' data-ref="187prot">prot</a>&amp;<a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#11" title="0x2" data-ref="_M/PROT_WRITE">PROT_WRITE</a>) &amp;&amp; !(<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mode" title='file::f_mode' data-ref="file::f_mode">f_mode</a>&amp;<a class="macro" href="../include/linux/fs.h.html#102" title="(( fmode_t)0x2)" data-ref="_M/FMODE_WRITE">FMODE_WRITE</a>))</td></tr>
<tr><th id="1426">1426</th><td>				<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#17" title="13" data-ref="_M/EACCES">EACCES</a>;</td></tr>
<tr><th id="1427">1427</th><td></td></tr>
<tr><th id="1428">1428</th><td>			<i>/*</i></td></tr>
<tr><th id="1429">1429</th><td><i>			 * Make sure we don't allow writing to an append-only</i></td></tr>
<tr><th id="1430">1430</th><td><i>			 * file..</i></td></tr>
<tr><th id="1431">1431</th><td><i>			 */</i></td></tr>
<tr><th id="1432">1432</th><td>			<b>if</b> (<a class="macro" href="../include/linux/fs.h.html#1885" title="((inode)-&gt;i_flags &amp; 4)" data-ref="_M/IS_APPEND">IS_APPEND</a>(<a class="local col5 ref" href="#195inode" title='inode' data-ref="195inode">inode</a>) &amp;&amp; (<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mode" title='file::f_mode' data-ref="file::f_mode">f_mode</a> &amp; <a class="macro" href="../include/linux/fs.h.html#102" title="(( fmode_t)0x2)" data-ref="_M/FMODE_WRITE">FMODE_WRITE</a>))</td></tr>
<tr><th id="1433">1433</th><td>				<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#17" title="13" data-ref="_M/EACCES">EACCES</a>;</td></tr>
<tr><th id="1434">1434</th><td></td></tr>
<tr><th id="1435">1435</th><td>			<i>/*</i></td></tr>
<tr><th id="1436">1436</th><td><i>			 * Make sure there are no mandatory locks on the file.</i></td></tr>
<tr><th id="1437">1437</th><td><i>			 */</i></td></tr>
<tr><th id="1438">1438</th><td>			<b>if</b> (<a class="ref fn" href="../include/linux/fs.h.html#locks_verify_locked" title='locks_verify_locked' data-ref="locks_verify_locked">locks_verify_locked</a>(<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>))</td></tr>
<tr><th id="1439">1439</th><td>				<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#15" title="11" data-ref="_M/EAGAIN">EAGAIN</a>;</td></tr>
<tr><th id="1440">1440</th><td></td></tr>
<tr><th id="1441">1441</th><td>			<a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a> |= <a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a> | <a class="macro" href="../include/linux/mm.h.html#172" title="0x00000080" data-ref="_M/VM_MAYSHARE">VM_MAYSHARE</a>;</td></tr>
<tr><th id="1442">1442</th><td>			<b>if</b> (!(<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mode" title='file::f_mode' data-ref="file::f_mode">f_mode</a> &amp; <a class="macro" href="../include/linux/fs.h.html#102" title="(( fmode_t)0x2)" data-ref="_M/FMODE_WRITE">FMODE_WRITE</a>))</td></tr>
<tr><th id="1443">1443</th><td>				<a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a> &amp;= ~(<a class="macro" href="../include/linux/mm.h.html#170" title="0x00000020" data-ref="_M/VM_MAYWRITE">VM_MAYWRITE</a> | <a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a>);</td></tr>
<tr><th id="1444">1444</th><td></td></tr>
<tr><th id="1445">1445</th><td>			<i>/* fall through */</i></td></tr>
<tr><th id="1446">1446</th><td>		<b>case</b> <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#19" title="0x02" data-ref="_M/MAP_PRIVATE">MAP_PRIVATE</a>:</td></tr>
<tr><th id="1447">1447</th><td>			<b>if</b> (!(<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mode" title='file::f_mode' data-ref="file::f_mode">f_mode</a> &amp; <a class="macro" href="../include/linux/fs.h.html#100" title="(( fmode_t)0x1)" data-ref="_M/FMODE_READ">FMODE_READ</a>))</td></tr>
<tr><th id="1448">1448</th><td>				<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#17" title="13" data-ref="_M/EACCES">EACCES</a>;</td></tr>
<tr><th id="1449">1449</th><td>			<b>if</b> (<a class="ref fn" href="../include/linux/fs.h.html#path_noexec" title='path_noexec' data-ref="path_noexec">path_noexec</a>(&amp;<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_path" title='file::f_path' data-ref="file::f_path">f_path</a>)) {</td></tr>
<tr><th id="1450">1450</th><td>				<b>if</b> (<a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#165" title="0x00000004" data-ref="_M/VM_EXEC">VM_EXEC</a>)</td></tr>
<tr><th id="1451">1451</th><td>					<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="1452">1452</th><td>				<a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a> &amp;= ~<a class="macro" href="../include/linux/mm.h.html#171" title="0x00000040" data-ref="_M/VM_MAYEXEC">VM_MAYEXEC</a>;</td></tr>
<tr><th id="1453">1453</th><td>			}</td></tr>
<tr><th id="1454">1454</th><td></td></tr>
<tr><th id="1455">1455</th><td>			<b>if</b> (!<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_op" title='file::f_op' data-ref="file::f_op">f_op</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file_operations::mmap" title='file_operations::mmap' data-ref="file_operations::mmap">mmap</a>)</td></tr>
<tr><th id="1456">1456</th><td>				<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#23" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="1457">1457</th><td>			<b>if</b> (<a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a> &amp; (<a class="macro" href="../include/linux/mm.h.html#174" title="0x00000100" data-ref="_M/VM_GROWSDOWN">VM_GROWSDOWN</a>|<a class="macro" href="../include/linux/mm.h.html#250" title="0x00000000" data-ref="_M/VM_GROWSUP">VM_GROWSUP</a>))</td></tr>
<tr><th id="1458">1458</th><td>				<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1459">1459</th><td>			<b>break</b>;</td></tr>
<tr><th id="1460">1460</th><td></td></tr>
<tr><th id="1461">1461</th><td>		<b>default</b>:</td></tr>
<tr><th id="1462">1462</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1463">1463</th><td>		}</td></tr>
<tr><th id="1464">1464</th><td>	} <b>else</b> {</td></tr>
<tr><th id="1465">1465</th><td>		<b>switch</b> (<a class="local col8 ref" href="#188flags" title='flags' data-ref="188flags">flags</a> &amp; <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#20" title="0x0f" data-ref="_M/MAP_TYPE">MAP_TYPE</a>) {</td></tr>
<tr><th id="1466">1466</th><td>		<b>case</b> <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#18" title="0x01" data-ref="_M/MAP_SHARED">MAP_SHARED</a>:</td></tr>
<tr><th id="1467">1467</th><td>			<b>if</b> (<a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a> &amp; (<a class="macro" href="../include/linux/mm.h.html#174" title="0x00000100" data-ref="_M/VM_GROWSDOWN">VM_GROWSDOWN</a>|<a class="macro" href="../include/linux/mm.h.html#250" title="0x00000000" data-ref="_M/VM_GROWSUP">VM_GROWSUP</a>))</td></tr>
<tr><th id="1468">1468</th><td>				<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1469">1469</th><td>			<i>/*</i></td></tr>
<tr><th id="1470">1470</th><td><i>			 * Ignore pgoff.</i></td></tr>
<tr><th id="1471">1471</th><td><i>			 */</i></td></tr>
<tr><th id="1472">1472</th><td>			<a class="local col0 ref" href="#190pgoff" title='pgoff' data-ref="190pgoff">pgoff</a> = <var>0</var>;</td></tr>
<tr><th id="1473">1473</th><td>			<a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a> |= <a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a> | <a class="macro" href="../include/linux/mm.h.html#172" title="0x00000080" data-ref="_M/VM_MAYSHARE">VM_MAYSHARE</a>;</td></tr>
<tr><th id="1474">1474</th><td>			<b>break</b>;</td></tr>
<tr><th id="1475">1475</th><td>		<b>case</b> <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#19" title="0x02" data-ref="_M/MAP_PRIVATE">MAP_PRIVATE</a>:</td></tr>
<tr><th id="1476">1476</th><td>			<i>/*</i></td></tr>
<tr><th id="1477">1477</th><td><i>			 * Set pgoff according to addr for anon_vma.</i></td></tr>
<tr><th id="1478">1478</th><td><i>			 */</i></td></tr>
<tr><th id="1479">1479</th><td>			<a class="local col0 ref" href="#190pgoff" title='pgoff' data-ref="190pgoff">pgoff</a> = <a class="local col5 ref" href="#185addr" title='addr' data-ref="185addr">addr</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="1480">1480</th><td>			<b>break</b>;</td></tr>
<tr><th id="1481">1481</th><td>		<b>default</b>:</td></tr>
<tr><th id="1482">1482</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1483">1483</th><td>		}</td></tr>
<tr><th id="1484">1484</th><td>	}</td></tr>
<tr><th id="1485">1485</th><td></td></tr>
<tr><th id="1486">1486</th><td>	<i>/*</i></td></tr>
<tr><th id="1487">1487</th><td><i>	 * Set 'VM_NORESERVE' if we should not account for the</i></td></tr>
<tr><th id="1488">1488</th><td><i>	 * memory use of this mapping.</i></td></tr>
<tr><th id="1489">1489</th><td><i>	 */</i></td></tr>
<tr><th id="1490">1490</th><td>	<b>if</b> (<a class="local col8 ref" href="#188flags" title='flags' data-ref="188flags">flags</a> &amp; <a class="macro" href="../include/uapi/asm-generic/mman.h.html#11" title="0x4000" data-ref="_M/MAP_NORESERVE">MAP_NORESERVE</a>) {</td></tr>
<tr><th id="1491">1491</th><td>		<i>/* We honor MAP_NORESERVE if allowed to overcommit */</i></td></tr>
<tr><th id="1492">1492</th><td>		<b>if</b> (<a class="ref" href="../include/linux/mm.h.html#sysctl_overcommit_memory" title='sysctl_overcommit_memory' data-ref="sysctl_overcommit_memory">sysctl_overcommit_memory</a> != <a class="macro" href="../include/uapi/linux/mman.h.html#13" title="2" data-ref="_M/OVERCOMMIT_NEVER">OVERCOMMIT_NEVER</a>)</td></tr>
<tr><th id="1493">1493</th><td>			<a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a> |= <a class="macro" href="../include/linux/mm.h.html#191" title="0x00200000" data-ref="_M/VM_NORESERVE">VM_NORESERVE</a>;</td></tr>
<tr><th id="1494">1494</th><td></td></tr>
<tr><th id="1495">1495</th><td>		<i>/* hugetlb applies strict overcommit unless MAP_NORESERVE */</i></td></tr>
<tr><th id="1496">1496</th><td>		<b>if</b> (<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a> &amp;&amp; <a class="ref fn" href="../include/linux/hugetlb.h.html#is_file_hugepages" title='is_file_hugepages' data-ref="is_file_hugepages">is_file_hugepages</a>(<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>))</td></tr>
<tr><th id="1497">1497</th><td>			<a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a> |= <a class="macro" href="../include/linux/mm.h.html#191" title="0x00200000" data-ref="_M/VM_NORESERVE">VM_NORESERVE</a>;</td></tr>
<tr><th id="1498">1498</th><td>	}</td></tr>
<tr><th id="1499">1499</th><td></td></tr>
<tr><th id="1500">1500</th><td>	<a class="local col5 ref" href="#185addr" title='addr' data-ref="185addr">addr</a> = <a class="ref fn" href="#mmap_region" title='mmap_region' data-ref="mmap_region">mmap_region</a>(<a class="local col4 ref" href="#184file" title='file' data-ref="184file">file</a>, <a class="local col5 ref" href="#185addr" title='addr' data-ref="185addr">addr</a>, <a class="local col6 ref" href="#186len" title='len' data-ref="186len">len</a>, <a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a>, <a class="local col0 ref" href="#190pgoff" title='pgoff' data-ref="190pgoff">pgoff</a>, <a class="local col2 ref" href="#192uf" title='uf' data-ref="192uf">uf</a>);</td></tr>
<tr><th id="1501">1501</th><td>	<b>if</b> (!<a class="macro" href="../include/linux/err.h.html#22" title="__builtin_expect(!!((unsigned long)(void *)(addr) &gt;= (unsigned long)-4095), 0)" data-ref="_M/IS_ERR_VALUE">IS_ERR_VALUE</a>(<a class="local col5 ref" href="#185addr" title='addr' data-ref="185addr">addr</a>) &amp;&amp;</td></tr>
<tr><th id="1502">1502</th><td>	    ((<a class="local col9 ref" href="#189vm_flags" title='vm_flags' data-ref="189vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#180" title="0x00002000" data-ref="_M/VM_LOCKED">VM_LOCKED</a>) ||</td></tr>
<tr><th id="1503">1503</th><td>	     (<a class="local col8 ref" href="#188flags" title='flags' data-ref="188flags">flags</a> &amp; (<a class="macro" href="../include/uapi/asm-generic/mman.h.html#12" title="0x8000" data-ref="_M/MAP_POPULATE">MAP_POPULATE</a> | <a class="macro" href="../include/uapi/asm-generic/mman.h.html#13" title="0x10000" data-ref="_M/MAP_NONBLOCK">MAP_NONBLOCK</a>)) == <a class="macro" href="../include/uapi/asm-generic/mman.h.html#12" title="0x8000" data-ref="_M/MAP_POPULATE">MAP_POPULATE</a>))</td></tr>
<tr><th id="1504">1504</th><td>		*<a class="local col1 ref" href="#191populate" title='populate' data-ref="191populate">populate</a> = <a class="local col6 ref" href="#186len" title='len' data-ref="186len">len</a>;</td></tr>
<tr><th id="1505">1505</th><td>	<b>return</b> <a class="local col5 ref" href="#185addr" title='addr' data-ref="185addr">addr</a>;</td></tr>
<tr><th id="1506">1506</th><td>}</td></tr>
<tr><th id="1507">1507</th><td></td></tr>
<tr><th id="1508">1508</th><td><a class="macro" href="../include/linux/syscalls.h.html#201" title="static const char *types__mmap_pgoff[] = { &quot;unsigned long&quot;, &quot;unsigned long&quot;, &quot;unsigned long&quot;, &quot;unsigned long&quot;, &quot;unsigned long&quot;, &quot;unsigned long&quot; }; static const char *args__mmap_pgoff[] = { &quot;addr&quot;, &quot;len&quot;, &quot;prot&quot;, &quot;flags&quot;, &quot;fd&quot;, &quot;pgoff&quot; }; static struct syscall_metadata __syscall_meta__mmap_pgoff; static struct trace_event_call __attribute__((__used__)) event_enter__mmap_pgoff = { .class = &amp;event_class_syscall_enter, { .name = &quot;sys_enter&quot;&quot;_mmap_pgoff&quot;, }, .event.funcs = &amp;enter_syscall_print_funcs, .data = (void *)&amp;__syscall_meta__mmap_pgoff, .flags = TRACE_EVENT_FL_CAP_ANY, }; static struct trace_event_call __attribute__((__used__)) __attribute__((section(&quot;_ftrace_events&quot;))) *__event_enter__mmap_pgoff = &amp;event_enter__mmap_pgoff;; static struct syscall_metadata __syscall_meta__mmap_pgoff; static struct trace_event_call __attribute__((__used__)) event_exit__mmap_pgoff = { .class = &amp;event_class_syscall_exit, { .name = &quot;sys_exit&quot;&quot;_mmap_pgoff&quot;, }, .event.funcs = &amp;exit_syscall_print_funcs, .data = (void *)&amp;__syscall_meta__mmap_pgoff, .flags = TRACE_EVENT_FL_CAP_ANY, }; static struct trace_event_call __attribute__((__used__)) __attribute__((section(&quot;_ftrace_events&quot;))) *__event_exit__mmap_pgoff = &amp;event_exit__mmap_pgoff;; static struct syscall_metadata __attribute__((__used__)) __syscall_meta__mmap_pgoff = { .name = &quot;sys&quot;&quot;_mmap_pgoff&quot;, .syscall_nr = -1, .nb_args = 6, .types = 6 ? types__mmap_pgoff : ((void *)0), .args = 6 ? args__mmap_pgoff : ((void *)0), .enter_event = &amp;event_enter__mmap_pgoff, .exit_event = &amp;event_exit__mmap_pgoff, .enter_fields = { &amp;(__syscall_meta__mmap_pgoff.enter_fields), &amp;(__syscall_meta__mmap_pgoff.enter_fields) }, }; static struct syscall_metadata __attribute__((__used__)) __attribute__((section(&quot;__syscalls_metadata&quot;))) *__p_syscall_meta__mmap_pgoff = &amp;__syscall_meta__mmap_pgoff; long sys_mmap_pgoff(unsigned long addr, unsigned long len, unsigned long prot, unsigned long flags, unsigned long fd, unsigned long pgoff) __attribute__((alias(&quot;SyS_mmap_pgoff&quot;))); static inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) long SYSC_mmap_pgoff(unsigned long addr, unsigned long len, unsigned long prot, unsigned long flags, unsigned long fd, unsigned long pgoff); long SyS_mmap_pgoff(__typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) addr, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) len, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) prot, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) flags, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) fd, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) pgoff); long SyS_mmap_pgoff(__typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) addr, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) len, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) prot, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) flags, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) fd, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) pgoff) { long ret = SYSC_mmap_pgoff(( unsigned long) addr, ( unsigned long) len, ( unsigned long) prot, ( unsigned long) flags, ( unsigned long) fd, ( unsigned long) pgoff); (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })), (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })), (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })), (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })), (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })), (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })); do { } while (0); return ret; } static inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) long SYSC_mmap_pgoff(unsigned long addr, unsigned long len, unsigned long prot, unsigned long flags, unsigned long fd, unsigned long pgoff)" data-ref="_M/SYSCALL_DEFINE6">SYSCALL_DEFINE6</a>(mmap_pgoff, <em>unsigned</em> <em>long</em>, <dfn class="local col6 decl" id="196addr" title='addr' data-type='unsigned long' data-ref="196addr"><dfn class="local col2 decl" id="202addr" title='addr' data-type='unsigned long' data-ref="202addr"><dfn class="local col8 decl" id="208addr" title='addr' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="208addr"><dfn class="local col4 decl" id="214addr" title='addr' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="214addr"><a class="local col4 ref" href="#1508" title='addr' data-ref="214addr"><dfn class="local col0 decl" id="220addr" title='addr' data-type='unsigned long' data-ref="220addr">addr</dfn></a></dfn></dfn></dfn></dfn>, <em>unsigned</em> <em>long</em>, <dfn class="local col7 decl" id="197len" title='len' data-type='unsigned long' data-ref="197len"><dfn class="local col3 decl" id="203len" title='len' data-type='unsigned long' data-ref="203len"><dfn class="local col9 decl" id="209len" title='len' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="209len"><dfn class="local col5 decl" id="215len" title='len' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="215len"><a class="local col5 ref" href="#1508" title='len' data-ref="215len"><dfn class="local col1 decl" id="221len" title='len' data-type='unsigned long' data-ref="221len">len</dfn></a></dfn></dfn></dfn></dfn>,</td></tr>
<tr><th id="1509">1509</th><td>		<em>unsigned</em> <em>long</em>, <dfn class="local col8 decl" id="198prot" title='prot' data-type='unsigned long' data-ref="198prot"><dfn class="local col4 decl" id="204prot" title='prot' data-type='unsigned long' data-ref="204prot"><dfn class="local col0 decl" id="210prot" title='prot' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="210prot"><dfn class="local col6 decl" id="216prot" title='prot' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="216prot"><a class="local col6 ref" href="#1508" title='prot' data-ref="216prot"><dfn class="local col2 decl" id="222prot" title='prot' data-type='unsigned long' data-ref="222prot">prot</dfn></a></dfn></dfn></dfn></dfn>, <em>unsigned</em> <em>long</em>, <dfn class="local col9 decl" id="199flags" title='flags' data-type='unsigned long' data-ref="199flags"><dfn class="local col5 decl" id="205flags" title='flags' data-type='unsigned long' data-ref="205flags"><dfn class="local col1 decl" id="211flags" title='flags' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="211flags"><dfn class="local col7 decl" id="217flags" title='flags' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="217flags"><a class="local col7 ref" href="#1508" title='flags' data-ref="217flags"><dfn class="local col3 decl" id="223flags" title='flags' data-type='unsigned long' data-ref="223flags">flags</dfn></a></dfn></dfn></dfn></dfn>,</td></tr>
<tr><th id="1510">1510</th><td>		<em>unsigned</em> <em>long</em>, <dfn class="local col0 decl" id="200fd" title='fd' data-type='unsigned long' data-ref="200fd"><dfn class="local col6 decl" id="206fd" title='fd' data-type='unsigned long' data-ref="206fd"><dfn class="local col2 decl" id="212fd" title='fd' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="212fd"><dfn class="local col8 decl" id="218fd" title='fd' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="218fd"><a class="local col8 ref" href="#1508" title='fd' data-ref="218fd"><dfn class="local col4 decl" id="224fd" title='fd' data-type='unsigned long' data-ref="224fd">fd</dfn></a></dfn></dfn></dfn></dfn>, <em>unsigned</em> <em>long</em>, <dfn class="local col1 decl" id="201pgoff" title='pgoff' data-type='unsigned long' data-ref="201pgoff"><dfn class="local col7 decl" id="207pgoff" title='pgoff' data-type='unsigned long' data-ref="207pgoff"><dfn class="local col3 decl" id="213pgoff" title='pgoff' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="213pgoff"><dfn class="local col9 decl" id="219pgoff" title='pgoff' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="219pgoff"><a class="local col9 ref" href="#1508" title='pgoff' data-ref="219pgoff"><dfn class="local col5 decl" id="225pgoff" title='pgoff' data-type='unsigned long' data-ref="225pgoff">pgoff</dfn></a></dfn></dfn></dfn></dfn>)</td></tr>
<tr><th id="1511">1511</th><td>{</td></tr>
<tr><th id="1512">1512</th><td>	<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col6 decl" id="226file" title='file' data-type='struct file *' data-ref="226file">file</dfn> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1513">1513</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="227retval" title='retval' data-type='unsigned long' data-ref="227retval">retval</dfn>;</td></tr>
<tr><th id="1514">1514</th><td></td></tr>
<tr><th id="1515">1515</th><td>	<b>if</b> (!(<a class="local col3 ref" href="#1508" title='flags' data-ref="223flags">flags</a> &amp; <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#22" title="0x20" data-ref="_M/MAP_ANONYMOUS">MAP_ANONYMOUS</a>)) {</td></tr>
<tr><th id="1516">1516</th><td>		<a class="ref fn" href="../include/linux/audit.h.html#audit_mmap_fd" title='audit_mmap_fd' data-ref="audit_mmap_fd">audit_mmap_fd</a>(<a class="local col4 ref" href="#1508" title='fd' data-ref="224fd">fd</a>, <a class="local col3 ref" href="#1508" title='flags' data-ref="223flags">flags</a>);</td></tr>
<tr><th id="1517">1517</th><td>		<a class="local col6 ref" href="#226file" title='file' data-ref="226file">file</a> = <a class="ref fn" href="../include/linux/file.h.html#fget" title='fget' data-ref="fget">fget</a>(<a class="local col4 ref" href="#1508" title='fd' data-ref="224fd">fd</a>);</td></tr>
<tr><th id="1518">1518</th><td>		<b>if</b> (!<a class="local col6 ref" href="#226file" title='file' data-ref="226file">file</a>)</td></tr>
<tr><th id="1519">1519</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#13" title="9" data-ref="_M/EBADF">EBADF</a>;</td></tr>
<tr><th id="1520">1520</th><td>		<b>if</b> (<a class="ref fn" href="../include/linux/hugetlb.h.html#is_file_hugepages" title='is_file_hugepages' data-ref="is_file_hugepages">is_file_hugepages</a>(<a class="local col6 ref" href="#226file" title='file' data-ref="226file">file</a>))</td></tr>
<tr><th id="1521">1521</th><td>			<a class="local col1 ref" href="#1508" title='len' data-ref="221len">len</a> = <a class="macro" href="../include/linux/kernel.h.html#57" title="((((len)) + ((typeof((len)))((huge_page_size(hstate_file(file)))) - 1)) &amp; ~((typeof((len)))((huge_page_size(hstate_file(file)))) - 1))" data-ref="_M/ALIGN">ALIGN</a>(<a class="local col1 ref" href="#1508" title='len' data-ref="221len">len</a>, <a class="ref fn" href="../include/linux/hugetlb.h.html#huge_page_size" title='huge_page_size' data-ref="huge_page_size">huge_page_size</a>(<a class="ref fn" href="../include/linux/hugetlb.h.html#hstate_file" title='hstate_file' data-ref="hstate_file">hstate_file</a>(<a class="local col6 ref" href="#226file" title='file' data-ref="226file">file</a>)));</td></tr>
<tr><th id="1522">1522</th><td>		<a class="local col7 ref" href="#227retval" title='retval' data-ref="227retval">retval</a> = -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1523">1523</th><td>		<b>if</b> (<a class="macro" href="../include/linux/compiler.h.html#77" title="__builtin_expect(!!(flags &amp; 0x40000 &amp;&amp; !is_file_hugepages(file)), 0)" data-ref="_M/unlikely">unlikely</a>(<a class="local col3 ref" href="#1508" title='flags' data-ref="223flags">flags</a> &amp; <a class="macro" href="../include/uapi/asm-generic/mman.h.html#15" title="0x40000" data-ref="_M/MAP_HUGETLB">MAP_HUGETLB</a> &amp;&amp; !<a class="ref fn" href="../include/linux/hugetlb.h.html#is_file_hugepages" title='is_file_hugepages' data-ref="is_file_hugepages">is_file_hugepages</a>(<a class="local col6 ref" href="#226file" title='file' data-ref="226file">file</a>)))</td></tr>
<tr><th id="1524">1524</th><td>			<b>goto</b> <a class="lbl" href="#228out_fput" data-ref="228out_fput">out_fput</a>;</td></tr>
<tr><th id="1525">1525</th><td>	} <b>else</b> <b>if</b> (<a class="local col3 ref" href="#1508" title='flags' data-ref="223flags">flags</a> &amp; <a class="macro" href="../include/uapi/asm-generic/mman.h.html#15" title="0x40000" data-ref="_M/MAP_HUGETLB">MAP_HUGETLB</a>) {</td></tr>
<tr><th id="1526">1526</th><td>		<b>struct</b> <a class="type" href="../include/linux/sched/user.h.html#user_struct" title='user_struct' data-ref="user_struct">user_struct</a> *<dfn class="local col9 decl" id="229user" title='user' data-type='struct user_struct *' data-ref="229user">user</dfn> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1527">1527</th><td>		<b>struct</b> <a class="type" href="../include/linux/hugetlb.h.html#hstate" title='hstate' data-ref="hstate">hstate</a> *<dfn class="local col0 decl" id="230hs" title='hs' data-type='struct hstate *' data-ref="230hs">hs</dfn>;</td></tr>
<tr><th id="1528">1528</th><td></td></tr>
<tr><th id="1529">1529</th><td>		<a class="local col0 ref" href="#230hs" title='hs' data-ref="230hs">hs</a> = <a class="ref fn" href="../include/linux/hugetlb.h.html#hstate_sizelog" title='hstate_sizelog' data-ref="hstate_sizelog">hstate_sizelog</a>((<a class="local col3 ref" href="#1508" title='flags' data-ref="223flags">flags</a> &gt;&gt; <a class="macro" href="../include/uapi/linux/mman.h.html#22" title="26" data-ref="_M/MAP_HUGE_SHIFT">MAP_HUGE_SHIFT</a>) &amp; <a class="macro" href="../include/uapi/linux/mman.h.html#23" title="0x3f" data-ref="_M/MAP_HUGE_MASK">MAP_HUGE_MASK</a>);</td></tr>
<tr><th id="1530">1530</th><td>		<b>if</b> (!<a class="local col0 ref" href="#230hs" title='hs' data-ref="230hs">hs</a>)</td></tr>
<tr><th id="1531">1531</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1532">1532</th><td></td></tr>
<tr><th id="1533">1533</th><td>		<a class="local col1 ref" href="#1508" title='len' data-ref="221len">len</a> = <a class="macro" href="../include/linux/kernel.h.html#57" title="((((len)) + ((typeof((len)))((huge_page_size(hs))) - 1)) &amp; ~((typeof((len)))((huge_page_size(hs))) - 1))" data-ref="_M/ALIGN">ALIGN</a>(<a class="local col1 ref" href="#1508" title='len' data-ref="221len">len</a>, <a class="ref fn" href="../include/linux/hugetlb.h.html#huge_page_size" title='huge_page_size' data-ref="huge_page_size">huge_page_size</a>(<a class="local col0 ref" href="#230hs" title='hs' data-ref="230hs">hs</a>));</td></tr>
<tr><th id="1534">1534</th><td>		<i>/*</i></td></tr>
<tr><th id="1535">1535</th><td><i>		 * VM_NORESERVE is used because the reservations will be</i></td></tr>
<tr><th id="1536">1536</th><td><i>		 * taken when vm_ops-&gt;mmap() is called</i></td></tr>
<tr><th id="1537">1537</th><td><i>		 * A dummy user value is used because we are not locking</i></td></tr>
<tr><th id="1538">1538</th><td><i>		 * memory so no accounting is necessary</i></td></tr>
<tr><th id="1539">1539</th><td><i>		 */</i></td></tr>
<tr><th id="1540">1540</th><td>		<a class="local col6 ref" href="#226file" title='file' data-ref="226file">file</a> = <a class="ref fn" href="../include/linux/hugetlb.h.html#hugetlb_file_setup" title='hugetlb_file_setup' data-ref="hugetlb_file_setup">hugetlb_file_setup</a>(<a class="macro" href="../include/linux/hugetlb.h.html#242" title="&quot;anon_hugepage&quot;" data-ref="_M/HUGETLB_ANON_FILE">HUGETLB_ANON_FILE</a>, <a class="local col1 ref" href="#1508" title='len' data-ref="221len">len</a>,</td></tr>
<tr><th id="1541">1541</th><td>				<a class="macro" href="../include/linux/mm.h.html#191" title="0x00200000" data-ref="_M/VM_NORESERVE">VM_NORESERVE</a>,</td></tr>
<tr><th id="1542">1542</th><td>				&amp;<a class="local col9 ref" href="#229user" title='user' data-ref="229user">user</a>, <a class="enum" href="../include/linux/hugetlb.h.html#HUGETLB_ANONHUGE_INODE" title='HUGETLB_ANONHUGE_INODE' data-ref="HUGETLB_ANONHUGE_INODE">HUGETLB_ANONHUGE_INODE</a>,</td></tr>
<tr><th id="1543">1543</th><td>				(<a class="local col3 ref" href="#1508" title='flags' data-ref="223flags">flags</a> &gt;&gt; <a class="macro" href="../include/uapi/linux/mman.h.html#22" title="26" data-ref="_M/MAP_HUGE_SHIFT">MAP_HUGE_SHIFT</a>) &amp; <a class="macro" href="../include/uapi/linux/mman.h.html#23" title="0x3f" data-ref="_M/MAP_HUGE_MASK">MAP_HUGE_MASK</a>);</td></tr>
<tr><th id="1544">1544</th><td>		<b>if</b> (<a class="ref fn" href="../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="local col6 ref" href="#226file" title='file' data-ref="226file">file</a>))</td></tr>
<tr><th id="1545">1545</th><td>			<b>return</b> <a class="ref fn" href="../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR">PTR_ERR</a>(<a class="local col6 ref" href="#226file" title='file' data-ref="226file">file</a>);</td></tr>
<tr><th id="1546">1546</th><td>	}</td></tr>
<tr><th id="1547">1547</th><td></td></tr>
<tr><th id="1548">1548</th><td>	<a class="local col3 ref" href="#1508" title='flags' data-ref="223flags">flags</a> &amp;= ~(<a class="macro" href="../include/uapi/asm-generic/mman.h.html#9" title="0x1000" data-ref="_M/MAP_EXECUTABLE">MAP_EXECUTABLE</a> | <a class="macro" href="../include/uapi/asm-generic/mman.h.html#8" title="0x0800" data-ref="_M/MAP_DENYWRITE">MAP_DENYWRITE</a>);</td></tr>
<tr><th id="1549">1549</th><td></td></tr>
<tr><th id="1550">1550</th><td>	<a class="local col7 ref" href="#227retval" title='retval' data-ref="227retval">retval</a> = <a class="ref fn" href="internal.h.html#vm_mmap_pgoff" title='vm_mmap_pgoff' data-ref="vm_mmap_pgoff">vm_mmap_pgoff</a>(<a class="local col6 ref" href="#226file" title='file' data-ref="226file">file</a>, <a class="local col0 ref" href="#1508" title='addr' data-ref="220addr">addr</a>, <a class="local col1 ref" href="#1508" title='len' data-ref="221len">len</a>, <a class="local col2 ref" href="#1508" title='prot' data-ref="222prot">prot</a>, <a class="local col3 ref" href="#1508" title='flags' data-ref="223flags">flags</a>, <a class="local col5 ref" href="#1508" title='pgoff' data-ref="225pgoff">pgoff</a>);</td></tr>
<tr><th id="1551">1551</th><td><dfn class="lbl" id="228out_fput" data-ref="228out_fput">out_fput</dfn>:</td></tr>
<tr><th id="1552">1552</th><td>	<b>if</b> (<a class="local col6 ref" href="#226file" title='file' data-ref="226file">file</a>)</td></tr>
<tr><th id="1553">1553</th><td>		<a class="ref fn" href="../include/linux/file.h.html#fput" title='fput' data-ref="fput">fput</a>(<a class="local col6 ref" href="#226file" title='file' data-ref="226file">file</a>);</td></tr>
<tr><th id="1554">1554</th><td>	<b>return</b> <a class="local col7 ref" href="#227retval" title='retval' data-ref="227retval">retval</a>;</td></tr>
<tr><th id="1555">1555</th><td>}</td></tr>
<tr><th id="1556">1556</th><td></td></tr>
<tr><th id="1557">1557</th><td><u>#<span data-ppcond="1557">ifdef</span> <span class="macro" data-ref="_M/__ARCH_WANT_SYS_OLD_MMAP">__ARCH_WANT_SYS_OLD_MMAP</span></u></td></tr>
<tr><th id="1558">1558</th><td><b>struct</b> mmap_arg_struct {</td></tr>
<tr><th id="1559">1559</th><td>	<em>unsigned</em> <em>long</em> addr;</td></tr>
<tr><th id="1560">1560</th><td>	<em>unsigned</em> <em>long</em> len;</td></tr>
<tr><th id="1561">1561</th><td>	<em>unsigned</em> <em>long</em> prot;</td></tr>
<tr><th id="1562">1562</th><td>	<em>unsigned</em> <em>long</em> flags;</td></tr>
<tr><th id="1563">1563</th><td>	<em>unsigned</em> <em>long</em> fd;</td></tr>
<tr><th id="1564">1564</th><td>	<em>unsigned</em> <em>long</em> offset;</td></tr>
<tr><th id="1565">1565</th><td>};</td></tr>
<tr><th id="1566">1566</th><td></td></tr>
<tr><th id="1567">1567</th><td>SYSCALL_DEFINE1(old_mmap, <b>struct</b> mmap_arg_struct __user *, arg)</td></tr>
<tr><th id="1568">1568</th><td>{</td></tr>
<tr><th id="1569">1569</th><td>	<b>struct</b> mmap_arg_struct a;</td></tr>
<tr><th id="1570">1570</th><td></td></tr>
<tr><th id="1571">1571</th><td>	<b>if</b> (copy_from_user(&amp;a, arg, <b>sizeof</b>(a)))</td></tr>
<tr><th id="1572">1572</th><td>		<b>return</b> -EFAULT;</td></tr>
<tr><th id="1573">1573</th><td>	<b>if</b> (offset_in_page(a.offset))</td></tr>
<tr><th id="1574">1574</th><td>		<b>return</b> -EINVAL;</td></tr>
<tr><th id="1575">1575</th><td></td></tr>
<tr><th id="1576">1576</th><td>	<b>return</b> sys_mmap_pgoff(a.addr, a.len, a.prot, a.flags, a.fd,</td></tr>
<tr><th id="1577">1577</th><td>			      a.offset &gt;&gt; PAGE_SHIFT);</td></tr>
<tr><th id="1578">1578</th><td>}</td></tr>
<tr><th id="1579">1579</th><td><u>#<span data-ppcond="1557">endif</span> /* __ARCH_WANT_SYS_OLD_MMAP */</u></td></tr>
<tr><th id="1580">1580</th><td></td></tr>
<tr><th id="1581">1581</th><td><i>/*</i></td></tr>
<tr><th id="1582">1582</th><td><i> * Some shared mappigns will want the pages marked read-only</i></td></tr>
<tr><th id="1583">1583</th><td><i> * to track write events. If so, we'll downgrade vm_page_prot</i></td></tr>
<tr><th id="1584">1584</th><td><i> * to the private version (using protection_map[] without the</i></td></tr>
<tr><th id="1585">1585</th><td><i> * VM_SHARED bit).</i></td></tr>
<tr><th id="1586">1586</th><td><i> */</i></td></tr>
<tr><th id="1587">1587</th><td><em>int</em> <dfn class="decl def fn" id="vma_wants_writenotify" title='vma_wants_writenotify' data-ref="vma_wants_writenotify">vma_wants_writenotify</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col1 decl" id="231vma" title='vma' data-type='struct vm_area_struct *' data-ref="231vma">vma</dfn>, <a class="typedef" href="../arch/x86/include/asm/pgtable_types.h.html#pgprot_t" title='pgprot_t' data-type='struct pgprot' data-ref="pgprot_t">pgprot_t</a> <dfn class="local col2 decl" id="232vm_page_prot" title='vm_page_prot' data-type='pgprot_t' data-ref="232vm_page_prot">vm_page_prot</dfn>)</td></tr>
<tr><th id="1588">1588</th><td>{</td></tr>
<tr><th id="1589">1589</th><td>	<a class="typedef" href="../include/linux/mm_types.h.html#vm_flags_t" title='vm_flags_t' data-type='unsigned long' data-ref="vm_flags_t">vm_flags_t</a> <dfn class="local col3 decl" id="233vm_flags" title='vm_flags' data-type='vm_flags_t' data-ref="233vm_flags">vm_flags</dfn> = <a class="local col1 ref" href="#231vma" title='vma' data-ref="231vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a>;</td></tr>
<tr><th id="1590">1590</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../include/linux/mm.h.html#vm_operations_struct" title='vm_operations_struct' data-ref="vm_operations_struct">vm_operations_struct</a> *<dfn class="local col4 decl" id="234vm_ops" title='vm_ops' data-type='const struct vm_operations_struct *' data-ref="234vm_ops">vm_ops</dfn> = <a class="local col1 ref" href="#231vma" title='vma' data-ref="231vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a>;</td></tr>
<tr><th id="1591">1591</th><td></td></tr>
<tr><th id="1592">1592</th><td>	<i>/* If it was private or non-writable, the write bit is already clear */</i></td></tr>
<tr><th id="1593">1593</th><td>	<b>if</b> ((<a class="local col3 ref" href="#233vm_flags" title='vm_flags' data-ref="233vm_flags">vm_flags</a> &amp; (<a class="macro" href="../include/linux/mm.h.html#164" title="0x00000002" data-ref="_M/VM_WRITE">VM_WRITE</a>|<a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a>)) != ((<a class="macro" href="../include/linux/mm.h.html#164" title="0x00000002" data-ref="_M/VM_WRITE">VM_WRITE</a>|<a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a>)))</td></tr>
<tr><th id="1594">1594</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1595">1595</th><td></td></tr>
<tr><th id="1596">1596</th><td>	<i>/* The backer wishes to know when pages are first written to? */</i></td></tr>
<tr><th id="1597">1597</th><td>	<b>if</b> (<a class="local col4 ref" href="#234vm_ops" title='vm_ops' data-ref="234vm_ops">vm_ops</a> &amp;&amp; (<a class="local col4 ref" href="#234vm_ops" title='vm_ops' data-ref="234vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::page_mkwrite" title='vm_operations_struct::page_mkwrite' data-ref="vm_operations_struct::page_mkwrite">page_mkwrite</a> || <a class="local col4 ref" href="#234vm_ops" title='vm_ops' data-ref="234vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::pfn_mkwrite" title='vm_operations_struct::pfn_mkwrite' data-ref="vm_operations_struct::pfn_mkwrite">pfn_mkwrite</a>))</td></tr>
<tr><th id="1598">1598</th><td>		<b>return</b> <var>1</var>;</td></tr>
<tr><th id="1599">1599</th><td></td></tr>
<tr><th id="1600">1600</th><td>	<i>/* The open routine did something to the protections that pgprot_modify</i></td></tr>
<tr><th id="1601">1601</th><td><i>	 * won't preserve? */</i></td></tr>
<tr><th id="1602">1602</th><td>	<b>if</b> (<a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#430" title="((vm_page_prot).pgprot)" data-ref="_M/pgprot_val">pgprot_val</a>(<a class="local col2 ref" href="#232vm_page_prot" title='vm_page_prot' data-ref="232vm_page_prot">vm_page_prot</a>) !=</td></tr>
<tr><th id="1603">1603</th><td>	    <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#430" title="((vm_pgprot_modify(vm_page_prot, vm_flags)).pgprot)" data-ref="_M/pgprot_val">pgprot_val</a>(<a class="tu ref fn" href="#vm_pgprot_modify" title='vm_pgprot_modify' data-use='c' data-ref="vm_pgprot_modify">vm_pgprot_modify</a>(<a class="local col2 ref" href="#232vm_page_prot" title='vm_page_prot' data-ref="232vm_page_prot">vm_page_prot</a>, <a class="local col3 ref" href="#233vm_flags" title='vm_flags' data-ref="233vm_flags">vm_flags</a>)))</td></tr>
<tr><th id="1604">1604</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1605">1605</th><td></td></tr>
<tr><th id="1606">1606</th><td>	<i>/* Do we need to track softdirty? */</i></td></tr>
<tr><th id="1607">1607</th><td>	<b>if</b> (<a class="macro" href="../include/linux/kconfig.h.html#71" title="0" data-ref="_M/IS_ENABLED">IS_ENABLED</a>(CONFIG_MEM_SOFT_DIRTY) &amp;&amp; !(<a class="local col3 ref" href="#233vm_flags" title='vm_flags' data-ref="233vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#200" title="0" data-ref="_M/VM_SOFTDIRTY">VM_SOFTDIRTY</a>))</td></tr>
<tr><th id="1608">1608</th><td>		<b>return</b> <var>1</var>;</td></tr>
<tr><th id="1609">1609</th><td></td></tr>
<tr><th id="1610">1610</th><td>	<i>/* Specialty mapping? */</i></td></tr>
<tr><th id="1611">1611</th><td>	<b>if</b> (<a class="local col3 ref" href="#233vm_flags" title='vm_flags' data-ref="233vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#176" title="0x00000400" data-ref="_M/VM_PFNMAP">VM_PFNMAP</a>)</td></tr>
<tr><th id="1612">1612</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1613">1613</th><td></td></tr>
<tr><th id="1614">1614</th><td>	<i>/* Can the mapping track the dirty pages? */</i></td></tr>
<tr><th id="1615">1615</th><td>	<b>return</b> <a class="local col1 ref" href="#231vma" title='vma' data-ref="231vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a> &amp;&amp; <a class="local col1 ref" href="#231vma" title='vma' data-ref="231vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a> &amp;&amp;</td></tr>
<tr><th id="1616">1616</th><td>		<a class="ref fn" href="../include/linux/backing-dev.h.html#mapping_cap_account_dirty" title='mapping_cap_account_dirty' data-ref="mapping_cap_account_dirty">mapping_cap_account_dirty</a>(<a class="local col1 ref" href="#231vma" title='vma' data-ref="231vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a>);</td></tr>
<tr><th id="1617">1617</th><td>}</td></tr>
<tr><th id="1618">1618</th><td></td></tr>
<tr><th id="1619">1619</th><td><i  data-doc="accountable_mapping">/*</i></td></tr>
<tr><th id="1620">1620</th><td><i  data-doc="accountable_mapping"> * We account for memory if it's a private writeable mapping,</i></td></tr>
<tr><th id="1621">1621</th><td><i  data-doc="accountable_mapping"> * not hugepages and VM_NORESERVE wasn't set.</i></td></tr>
<tr><th id="1622">1622</th><td><i  data-doc="accountable_mapping"> */</i></td></tr>
<tr><th id="1623">1623</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>int</em> <dfn class="tu decl def fn" id="accountable_mapping" title='accountable_mapping' data-type='int accountable_mapping(struct file * file, vm_flags_t vm_flags)' data-ref="accountable_mapping">accountable_mapping</dfn>(<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col5 decl" id="235file" title='file' data-type='struct file *' data-ref="235file">file</dfn>, <a class="typedef" href="../include/linux/mm_types.h.html#vm_flags_t" title='vm_flags_t' data-type='unsigned long' data-ref="vm_flags_t">vm_flags_t</a> <dfn class="local col6 decl" id="236vm_flags" title='vm_flags' data-type='vm_flags_t' data-ref="236vm_flags">vm_flags</dfn>)</td></tr>
<tr><th id="1624">1624</th><td>{</td></tr>
<tr><th id="1625">1625</th><td>	<i>/*</i></td></tr>
<tr><th id="1626">1626</th><td><i>	 * hugetlb has its own accounting separate from the core VM</i></td></tr>
<tr><th id="1627">1627</th><td><i>	 * VM_HUGETLB may not be set yet so we cannot check for that flag.</i></td></tr>
<tr><th id="1628">1628</th><td><i>	 */</i></td></tr>
<tr><th id="1629">1629</th><td>	<b>if</b> (<a class="local col5 ref" href="#235file" title='file' data-ref="235file">file</a> &amp;&amp; <a class="ref fn" href="../include/linux/hugetlb.h.html#is_file_hugepages" title='is_file_hugepages' data-ref="is_file_hugepages">is_file_hugepages</a>(<a class="local col5 ref" href="#235file" title='file' data-ref="235file">file</a>))</td></tr>
<tr><th id="1630">1630</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1631">1631</th><td></td></tr>
<tr><th id="1632">1632</th><td>	<b>return</b> (<a class="local col6 ref" href="#236vm_flags" title='vm_flags' data-ref="236vm_flags">vm_flags</a> &amp; (<a class="macro" href="../include/linux/mm.h.html#191" title="0x00200000" data-ref="_M/VM_NORESERVE">VM_NORESERVE</a> | <a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a> | <a class="macro" href="../include/linux/mm.h.html#164" title="0x00000002" data-ref="_M/VM_WRITE">VM_WRITE</a>)) == <a class="macro" href="../include/linux/mm.h.html#164" title="0x00000002" data-ref="_M/VM_WRITE">VM_WRITE</a>;</td></tr>
<tr><th id="1633">1633</th><td>}</td></tr>
<tr><th id="1634">1634</th><td></td></tr>
<tr><th id="1635">1635</th><td><em>unsigned</em> <em>long</em> <dfn class="decl def fn" id="mmap_region" title='mmap_region' data-ref="mmap_region">mmap_region</dfn>(<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col7 decl" id="237file" title='file' data-type='struct file *' data-ref="237file">file</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="238addr" title='addr' data-type='unsigned long' data-ref="238addr">addr</dfn>,</td></tr>
<tr><th id="1636">1636</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="239len" title='len' data-type='unsigned long' data-ref="239len">len</dfn>, <a class="typedef" href="../include/linux/mm_types.h.html#vm_flags_t" title='vm_flags_t' data-type='unsigned long' data-ref="vm_flags_t">vm_flags_t</a> <dfn class="local col0 decl" id="240vm_flags" title='vm_flags' data-type='vm_flags_t' data-ref="240vm_flags">vm_flags</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col1 decl" id="241pgoff" title='pgoff' data-type='unsigned long' data-ref="241pgoff">pgoff</dfn>,</td></tr>
<tr><th id="1637">1637</th><td>		<b>struct</b> <a class="type" href="../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a> *<dfn class="local col2 decl" id="242uf" title='uf' data-type='struct list_head *' data-ref="242uf">uf</dfn>)</td></tr>
<tr><th id="1638">1638</th><td>{</td></tr>
<tr><th id="1639">1639</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col3 decl" id="243mm" title='mm' data-type='struct mm_struct *' data-ref="243mm">mm</dfn> = <a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::mm" title='task_struct::mm' data-ref="task_struct::mm">mm</a>;</td></tr>
<tr><th id="1640">1640</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col4 decl" id="244vma" title='vma' data-type='struct vm_area_struct *' data-ref="244vma">vma</dfn>, *<dfn class="local col5 decl" id="245prev" title='prev' data-type='struct vm_area_struct *' data-ref="245prev">prev</dfn>;</td></tr>
<tr><th id="1641">1641</th><td>	<em>int</em> <dfn class="local col6 decl" id="246error" title='error' data-type='int' data-ref="246error">error</dfn>;</td></tr>
<tr><th id="1642">1642</th><td>	<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> **<dfn class="local col7 decl" id="247rb_link" title='rb_link' data-type='struct rb_node **' data-ref="247rb_link">rb_link</dfn>, *<dfn class="local col8 decl" id="248rb_parent" title='rb_parent' data-type='struct rb_node *' data-ref="248rb_parent">rb_parent</dfn>;</td></tr>
<tr><th id="1643">1643</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="249charged" title='charged' data-type='unsigned long' data-ref="249charged">charged</dfn> = <var>0</var>;</td></tr>
<tr><th id="1644">1644</th><td></td></tr>
<tr><th id="1645">1645</th><td>	<i>/* Check against address space limit. */</i></td></tr>
<tr><th id="1646">1646</th><td>	<b>if</b> (!<a class="ref fn" href="#may_expand_vm" title='may_expand_vm' data-ref="may_expand_vm">may_expand_vm</a>(<a class="local col3 ref" href="#243mm" title='mm' data-ref="243mm">mm</a>, <a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a>, <a class="local col9 ref" href="#239len" title='len' data-ref="239len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>)) {</td></tr>
<tr><th id="1647">1647</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="250nr_pages" title='nr_pages' data-type='unsigned long' data-ref="250nr_pages">nr_pages</dfn>;</td></tr>
<tr><th id="1648">1648</th><td></td></tr>
<tr><th id="1649">1649</th><td>		<i>/*</i></td></tr>
<tr><th id="1650">1650</th><td><i>		 * MAP_FIXED may remove pages of mappings that intersects with</i></td></tr>
<tr><th id="1651">1651</th><td><i>		 * requested mapping. Account for the pages it would unmap.</i></td></tr>
<tr><th id="1652">1652</th><td><i>		 */</i></td></tr>
<tr><th id="1653">1653</th><td>		<a class="local col0 ref" href="#250nr_pages" title='nr_pages' data-ref="250nr_pages">nr_pages</a> = <a class="tu ref fn" href="#count_vma_pages_range" title='count_vma_pages_range' data-use='c' data-ref="count_vma_pages_range">count_vma_pages_range</a>(<a class="local col3 ref" href="#243mm" title='mm' data-ref="243mm">mm</a>, <a class="local col8 ref" href="#238addr" title='addr' data-ref="238addr">addr</a>, <a class="local col8 ref" href="#238addr" title='addr' data-ref="238addr">addr</a> + <a class="local col9 ref" href="#239len" title='len' data-ref="239len">len</a>);</td></tr>
<tr><th id="1654">1654</th><td></td></tr>
<tr><th id="1655">1655</th><td>		<b>if</b> (!<a class="ref fn" href="#may_expand_vm" title='may_expand_vm' data-ref="may_expand_vm">may_expand_vm</a>(<a class="local col3 ref" href="#243mm" title='mm' data-ref="243mm">mm</a>, <a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a>,</td></tr>
<tr><th id="1656">1656</th><td>					(<a class="local col9 ref" href="#239len" title='len' data-ref="239len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>) - <a class="local col0 ref" href="#250nr_pages" title='nr_pages' data-ref="250nr_pages">nr_pages</a>))</td></tr>
<tr><th id="1657">1657</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1658">1658</th><td>	}</td></tr>
<tr><th id="1659">1659</th><td></td></tr>
<tr><th id="1660">1660</th><td>	<i>/* Clear old maps */</i></td></tr>
<tr><th id="1661">1661</th><td>	<b>while</b> (<a class="tu ref fn" href="#find_vma_links" title='find_vma_links' data-use='c' data-ref="find_vma_links">find_vma_links</a>(<a class="local col3 ref" href="#243mm" title='mm' data-ref="243mm">mm</a>, <a class="local col8 ref" href="#238addr" title='addr' data-ref="238addr">addr</a>, <a class="local col8 ref" href="#238addr" title='addr' data-ref="238addr">addr</a> + <a class="local col9 ref" href="#239len" title='len' data-ref="239len">len</a>, &amp;<a class="local col5 ref" href="#245prev" title='prev' data-ref="245prev">prev</a>, &amp;<a class="local col7 ref" href="#247rb_link" title='rb_link' data-ref="247rb_link">rb_link</a>,</td></tr>
<tr><th id="1662">1662</th><td>			      &amp;<a class="local col8 ref" href="#248rb_parent" title='rb_parent' data-ref="248rb_parent">rb_parent</a>)) {</td></tr>
<tr><th id="1663">1663</th><td>		<b>if</b> (<a class="ref fn" href="#do_munmap" title='do_munmap' data-ref="do_munmap">do_munmap</a>(<a class="local col3 ref" href="#243mm" title='mm' data-ref="243mm">mm</a>, <a class="local col8 ref" href="#238addr" title='addr' data-ref="238addr">addr</a>, <a class="local col9 ref" href="#239len" title='len' data-ref="239len">len</a>, <a class="local col2 ref" href="#242uf" title='uf' data-ref="242uf">uf</a>))</td></tr>
<tr><th id="1664">1664</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1665">1665</th><td>	}</td></tr>
<tr><th id="1666">1666</th><td></td></tr>
<tr><th id="1667">1667</th><td>	<i>/*</i></td></tr>
<tr><th id="1668">1668</th><td><i>	 * Private writable mapping: check memory availability</i></td></tr>
<tr><th id="1669">1669</th><td><i>	 */</i></td></tr>
<tr><th id="1670">1670</th><td>	<b>if</b> (<a class="tu ref fn" href="#accountable_mapping" title='accountable_mapping' data-use='c' data-ref="accountable_mapping">accountable_mapping</a>(<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>, <a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a>)) {</td></tr>
<tr><th id="1671">1671</th><td>		<a class="local col9 ref" href="#249charged" title='charged' data-ref="249charged">charged</a> = <a class="local col9 ref" href="#239len" title='len' data-ref="239len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="1672">1672</th><td>		<b>if</b> (<a class="ref fn" href="../include/linux/security.h.html#security_vm_enough_memory_mm" title='security_vm_enough_memory_mm' data-ref="security_vm_enough_memory_mm">security_vm_enough_memory_mm</a>(<a class="local col3 ref" href="#243mm" title='mm' data-ref="243mm">mm</a>, <a class="local col9 ref" href="#249charged" title='charged' data-ref="249charged">charged</a>))</td></tr>
<tr><th id="1673">1673</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1674">1674</th><td>		<a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a> |= <a class="macro" href="../include/linux/mm.h.html#190" title="0x00100000" data-ref="_M/VM_ACCOUNT">VM_ACCOUNT</a>;</td></tr>
<tr><th id="1675">1675</th><td>	}</td></tr>
<tr><th id="1676">1676</th><td></td></tr>
<tr><th id="1677">1677</th><td>	<i>/*</i></td></tr>
<tr><th id="1678">1678</th><td><i>	 * Can we just expand an old mapping?</i></td></tr>
<tr><th id="1679">1679</th><td><i>	 */</i></td></tr>
<tr><th id="1680">1680</th><td>	<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a> = <a class="ref fn" href="#vma_merge" title='vma_merge' data-ref="vma_merge">vma_merge</a>(<a class="local col3 ref" href="#243mm" title='mm' data-ref="243mm">mm</a>, <a class="local col5 ref" href="#245prev" title='prev' data-ref="245prev">prev</a>, <a class="local col8 ref" href="#238addr" title='addr' data-ref="238addr">addr</a>, <a class="local col8 ref" href="#238addr" title='addr' data-ref="238addr">addr</a> + <a class="local col9 ref" href="#239len" title='len' data-ref="239len">len</a>, <a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a>,</td></tr>
<tr><th id="1681">1681</th><td>			<a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>, <a class="local col1 ref" href="#241pgoff" title='pgoff' data-ref="241pgoff">pgoff</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../include/linux/mm_types.h.html#268" title="((struct vm_userfaultfd_ctx) {})" data-ref="_M/NULL_VM_UFFD_CTX">NULL_VM_UFFD_CTX</a>);</td></tr>
<tr><th id="1682">1682</th><td>	<b>if</b> (<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>)</td></tr>
<tr><th id="1683">1683</th><td>		<b>goto</b> <a class="lbl" href="#251out" data-ref="251out">out</a>;</td></tr>
<tr><th id="1684">1684</th><td></td></tr>
<tr><th id="1685">1685</th><td>	<i>/*</i></td></tr>
<tr><th id="1686">1686</th><td><i>	 * Determine the object being mapped and call the appropriate</i></td></tr>
<tr><th id="1687">1687</th><td><i>	 * specific mapper. the address has already been validated, but</i></td></tr>
<tr><th id="1688">1688</th><td><i>	 * not unmapped, but the maps are removed from the list.</i></td></tr>
<tr><th id="1689">1689</th><td><i>	 */</i></td></tr>
<tr><th id="1690">1690</th><td>	<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a> = <a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_zalloc" title='kmem_cache_zalloc' data-ref="kmem_cache_zalloc">kmem_cache_zalloc</a>(<a class="ref" href="../include/linux/mm.h.html#vm_area_cachep" title='vm_area_cachep' data-ref="vm_area_cachep">vm_area_cachep</a>, <a class="macro" href="../include/linux/gfp.h.html#278" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="1691">1691</th><td>	<b>if</b> (!<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>) {</td></tr>
<tr><th id="1692">1692</th><td>		<a class="local col6 ref" href="#246error" title='error' data-ref="246error">error</a> = -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1693">1693</th><td>		<b>goto</b> <a class="lbl" href="#252unacct_error" data-ref="252unacct_error">unacct_error</a>;</td></tr>
<tr><th id="1694">1694</th><td>	}</td></tr>
<tr><th id="1695">1695</th><td></td></tr>
<tr><th id="1696">1696</th><td>	<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_mm" title='vm_area_struct::vm_mm' data-ref="vm_area_struct::vm_mm">vm_mm</a> = <a class="local col3 ref" href="#243mm" title='mm' data-ref="243mm">mm</a>;</td></tr>
<tr><th id="1697">1697</th><td>	<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> = <a class="local col8 ref" href="#238addr" title='addr' data-ref="238addr">addr</a>;</td></tr>
<tr><th id="1698">1698</th><td>	<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> = <a class="local col8 ref" href="#238addr" title='addr' data-ref="238addr">addr</a> + <a class="local col9 ref" href="#239len" title='len' data-ref="239len">len</a>;</td></tr>
<tr><th id="1699">1699</th><td>	<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> = <a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a>;</td></tr>
<tr><th id="1700">1700</th><td>	<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_page_prot" title='vm_area_struct::vm_page_prot' data-ref="vm_area_struct::vm_page_prot">vm_page_prot</a> = <a class="ref fn" href="#vm_get_page_prot" title='vm_get_page_prot' data-ref="vm_get_page_prot">vm_get_page_prot</a>(<a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a>);</td></tr>
<tr><th id="1701">1701</th><td>	<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> = <a class="local col1 ref" href="#241pgoff" title='pgoff' data-ref="241pgoff">pgoff</a>;</td></tr>
<tr><th id="1702">1702</th><td>	<a class="ref fn" href="../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma_chain" title='vm_area_struct::anon_vma_chain' data-ref="vm_area_struct::anon_vma_chain">anon_vma_chain</a>);</td></tr>
<tr><th id="1703">1703</th><td></td></tr>
<tr><th id="1704">1704</th><td>	<b>if</b> (<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>) {</td></tr>
<tr><th id="1705">1705</th><td>		<b>if</b> (<a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#177" title="0x00000800" data-ref="_M/VM_DENYWRITE">VM_DENYWRITE</a>) {</td></tr>
<tr><th id="1706">1706</th><td>			<a class="local col6 ref" href="#246error" title='error' data-ref="246error">error</a> = <a class="ref fn" href="../include/linux/fs.h.html#deny_write_access" title='deny_write_access' data-ref="deny_write_access">deny_write_access</a>(<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>);</td></tr>
<tr><th id="1707">1707</th><td>			<b>if</b> (<a class="local col6 ref" href="#246error" title='error' data-ref="246error">error</a>)</td></tr>
<tr><th id="1708">1708</th><td>				<b>goto</b> <a class="lbl" href="#253free_vma" data-ref="253free_vma">free_vma</a>;</td></tr>
<tr><th id="1709">1709</th><td>		}</td></tr>
<tr><th id="1710">1710</th><td>		<b>if</b> (<a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a>) {</td></tr>
<tr><th id="1711">1711</th><td>			<a class="local col6 ref" href="#246error" title='error' data-ref="246error">error</a> = <a class="ref fn" href="../include/linux/fs.h.html#mapping_map_writable" title='mapping_map_writable' data-ref="mapping_map_writable">mapping_map_writable</a>(<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a>);</td></tr>
<tr><th id="1712">1712</th><td>			<b>if</b> (<a class="local col6 ref" href="#246error" title='error' data-ref="246error">error</a>)</td></tr>
<tr><th id="1713">1713</th><td>				<b>goto</b> <a class="lbl" href="#254allow_write_and_free_vma" data-ref="254allow_write_and_free_vma">allow_write_and_free_vma</a>;</td></tr>
<tr><th id="1714">1714</th><td>		}</td></tr>
<tr><th id="1715">1715</th><td></td></tr>
<tr><th id="1716">1716</th><td>		<i>/* -&gt;mmap() can change vma-&gt;vm_file, but must guarantee that</i></td></tr>
<tr><th id="1717">1717</th><td><i>		 * vma_link() below can deny write-access if VM_DENYWRITE is set</i></td></tr>
<tr><th id="1718">1718</th><td><i>		 * and map writably if VM_SHARED is set. This usually means the</i></td></tr>
<tr><th id="1719">1719</th><td><i>		 * new file must not have been exposed to user-space, yet.</i></td></tr>
<tr><th id="1720">1720</th><td><i>		 */</i></td></tr>
<tr><th id="1721">1721</th><td>		<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a> = <a class="ref fn" href="../include/linux/fs.h.html#get_file" title='get_file' data-ref="get_file">get_file</a>(<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>);</td></tr>
<tr><th id="1722">1722</th><td>		<a class="local col6 ref" href="#246error" title='error' data-ref="246error">error</a> = <a class="ref fn" href="../include/linux/fs.h.html#call_mmap" title='call_mmap' data-ref="call_mmap">call_mmap</a>(<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>, <a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>);</td></tr>
<tr><th id="1723">1723</th><td>		<b>if</b> (<a class="local col6 ref" href="#246error" title='error' data-ref="246error">error</a>)</td></tr>
<tr><th id="1724">1724</th><td>			<b>goto</b> <a class="lbl" href="#255unmap_and_free_vma" data-ref="255unmap_and_free_vma">unmap_and_free_vma</a>;</td></tr>
<tr><th id="1725">1725</th><td></td></tr>
<tr><th id="1726">1726</th><td>		<i>/* Can addr have changed??</i></td></tr>
<tr><th id="1727">1727</th><td><i>		 *</i></td></tr>
<tr><th id="1728">1728</th><td><i>		 * Answer: Yes, several device drivers can do it in their</i></td></tr>
<tr><th id="1729">1729</th><td><i>		 *         f_op-&gt;mmap method. -DaveM</i></td></tr>
<tr><th id="1730">1730</th><td><i>		 * Bug: If addr is changed, prev, rb_link, rb_parent should</i></td></tr>
<tr><th id="1731">1731</th><td><i>		 *      be updated for vma_link()</i></td></tr>
<tr><th id="1732">1732</th><td><i>		 */</i></td></tr>
<tr><th id="1733">1733</th><td>		<a class="macro" href="../include/asm-generic/bug.h.html#66" title="({ int __ret_warn_on = !!(addr != vma-&gt;vm_start); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/mm/mmap.c&quot;), &quot;i&quot; (1733), &quot;i&quot; ((1 &lt;&lt; 0)|((1 &lt;&lt; 1)|((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (127)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON_ONCE">WARN_ON_ONCE</a>(<a class="local col8 ref" href="#238addr" title='addr' data-ref="238addr">addr</a> != <a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>);</td></tr>
<tr><th id="1734">1734</th><td></td></tr>
<tr><th id="1735">1735</th><td>		<a class="local col8 ref" href="#238addr" title='addr' data-ref="238addr">addr</a> = <a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>;</td></tr>
<tr><th id="1736">1736</th><td>		<a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a> = <a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a>;</td></tr>
<tr><th id="1737">1737</th><td>	} <b>else</b> <b>if</b> (<a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a>) {</td></tr>
<tr><th id="1738">1738</th><td>		<a class="local col6 ref" href="#246error" title='error' data-ref="246error">error</a> = <a class="ref fn" href="../include/linux/shmem_fs.h.html#shmem_zero_setup" title='shmem_zero_setup' data-ref="shmem_zero_setup">shmem_zero_setup</a>(<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>);</td></tr>
<tr><th id="1739">1739</th><td>		<b>if</b> (<a class="local col6 ref" href="#246error" title='error' data-ref="246error">error</a>)</td></tr>
<tr><th id="1740">1740</th><td>			<b>goto</b> <a class="lbl" href="#253free_vma" data-ref="253free_vma">free_vma</a>;</td></tr>
<tr><th id="1741">1741</th><td>	}</td></tr>
<tr><th id="1742">1742</th><td></td></tr>
<tr><th id="1743">1743</th><td>	<a class="tu ref fn" href="#vma_link" title='vma_link' data-use='c' data-ref="vma_link">vma_link</a>(<a class="local col3 ref" href="#243mm" title='mm' data-ref="243mm">mm</a>, <a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>, <a class="local col5 ref" href="#245prev" title='prev' data-ref="245prev">prev</a>, <a class="local col7 ref" href="#247rb_link" title='rb_link' data-ref="247rb_link">rb_link</a>, <a class="local col8 ref" href="#248rb_parent" title='rb_parent' data-ref="248rb_parent">rb_parent</a>);</td></tr>
<tr><th id="1744">1744</th><td>	<i>/* Once vma denies write, undo our temporary denial count */</i></td></tr>
<tr><th id="1745">1745</th><td>	<b>if</b> (<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>) {</td></tr>
<tr><th id="1746">1746</th><td>		<b>if</b> (<a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a>)</td></tr>
<tr><th id="1747">1747</th><td>			<a class="ref fn" href="../include/linux/fs.h.html#mapping_unmap_writable" title='mapping_unmap_writable' data-ref="mapping_unmap_writable">mapping_unmap_writable</a>(<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a>);</td></tr>
<tr><th id="1748">1748</th><td>		<b>if</b> (<a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#177" title="0x00000800" data-ref="_M/VM_DENYWRITE">VM_DENYWRITE</a>)</td></tr>
<tr><th id="1749">1749</th><td>			<a class="ref fn" href="../include/linux/fs.h.html#allow_write_access" title='allow_write_access' data-ref="allow_write_access">allow_write_access</a>(<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>);</td></tr>
<tr><th id="1750">1750</th><td>	}</td></tr>
<tr><th id="1751">1751</th><td>	<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a> = <a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>;</td></tr>
<tr><th id="1752">1752</th><td><dfn class="lbl" id="251out" data-ref="251out">out</dfn>:</td></tr>
<tr><th id="1753">1753</th><td>	<a class="ref fn" href="../include/linux/perf_event.h.html#perf_event_mmap" title='perf_event_mmap' data-ref="perf_event_mmap">perf_event_mmap</a>(<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>);</td></tr>
<tr><th id="1754">1754</th><td></td></tr>
<tr><th id="1755">1755</th><td>	<a class="ref fn" href="#vm_stat_account" title='vm_stat_account' data-ref="vm_stat_account">vm_stat_account</a>(<a class="local col3 ref" href="#243mm" title='mm' data-ref="243mm">mm</a>, <a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a>, <a class="local col9 ref" href="#239len" title='len' data-ref="239len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>);</td></tr>
<tr><th id="1756">1756</th><td>	<b>if</b> (<a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#180" title="0x00002000" data-ref="_M/VM_LOCKED">VM_LOCKED</a>) {</td></tr>
<tr><th id="1757">1757</th><td>		<b>if</b> (!((<a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#272" title="(0x00004000 | 0x00040000 | 0x00000400 | 0x10000000)" data-ref="_M/VM_SPECIAL">VM_SPECIAL</a>) || <a class="ref fn" href="../include/linux/hugetlb_inline.h.html#is_vm_hugetlb_page" title='is_vm_hugetlb_page' data-ref="is_vm_hugetlb_page">is_vm_hugetlb_page</a>(<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>) ||</td></tr>
<tr><th id="1758">1758</th><td>					<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a> == <a class="ref fn" href="../include/linux/mm.h.html#get_gate_vma" title='get_gate_vma' data-ref="get_gate_vma">get_gate_vma</a>(<a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::mm" title='task_struct::mm' data-ref="task_struct::mm">mm</a>)))</td></tr>
<tr><th id="1759">1759</th><td>			<a class="local col3 ref" href="#243mm" title='mm' data-ref="243mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::locked_vm" title='mm_struct::locked_vm' data-ref="mm_struct::locked_vm">locked_vm</a> += (<a class="local col9 ref" href="#239len" title='len' data-ref="239len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>);</td></tr>
<tr><th id="1760">1760</th><td>		<b>else</b></td></tr>
<tr><th id="1761">1761</th><td>			<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp;= <a class="macro" href="../include/linux/mm.h.html#278" title="(~(0x00002000 | 0x00080000))" data-ref="_M/VM_LOCKED_CLEAR_MASK">VM_LOCKED_CLEAR_MASK</a>;</td></tr>
<tr><th id="1762">1762</th><td>	}</td></tr>
<tr><th id="1763">1763</th><td></td></tr>
<tr><th id="1764">1764</th><td>	<b>if</b> (<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>)</td></tr>
<tr><th id="1765">1765</th><td>		<a class="ref fn" href="../include/linux/uprobes.h.html#uprobe_mmap" title='uprobe_mmap' data-ref="uprobe_mmap">uprobe_mmap</a>(<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>);</td></tr>
<tr><th id="1766">1766</th><td></td></tr>
<tr><th id="1767">1767</th><td>	<i>/*</i></td></tr>
<tr><th id="1768">1768</th><td><i>	 * New (or expanded) vma always get soft dirty status.</i></td></tr>
<tr><th id="1769">1769</th><td><i>	 * Otherwise user-space soft-dirty page tracker won't</i></td></tr>
<tr><th id="1770">1770</th><td><i>	 * be able to distinguish situation when vma area unmapped,</i></td></tr>
<tr><th id="1771">1771</th><td><i>	 * then new mapped in-place (which must be aimed as</i></td></tr>
<tr><th id="1772">1772</th><td><i>	 * a completely new data area).</i></td></tr>
<tr><th id="1773">1773</th><td><i>	 */</i></td></tr>
<tr><th id="1774">1774</th><td>	<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> |= <a class="macro" href="../include/linux/mm.h.html#200" title="0" data-ref="_M/VM_SOFTDIRTY">VM_SOFTDIRTY</a>;</td></tr>
<tr><th id="1775">1775</th><td></td></tr>
<tr><th id="1776">1776</th><td>	<a class="ref fn" href="#vma_set_page_prot" title='vma_set_page_prot' data-ref="vma_set_page_prot">vma_set_page_prot</a>(<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>);</td></tr>
<tr><th id="1777">1777</th><td></td></tr>
<tr><th id="1778">1778</th><td>	<b>return</b> <a class="local col8 ref" href="#238addr" title='addr' data-ref="238addr">addr</a>;</td></tr>
<tr><th id="1779">1779</th><td></td></tr>
<tr><th id="1780">1780</th><td><dfn class="lbl" id="255unmap_and_free_vma" data-ref="255unmap_and_free_vma">unmap_and_free_vma</dfn>:</td></tr>
<tr><th id="1781">1781</th><td>	<a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1782">1782</th><td>	<a class="ref fn" href="../include/linux/file.h.html#fput" title='fput' data-ref="fput">fput</a>(<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>);</td></tr>
<tr><th id="1783">1783</th><td></td></tr>
<tr><th id="1784">1784</th><td>	<i>/* Undo any partial mapping done by a device driver. */</i></td></tr>
<tr><th id="1785">1785</th><td>	<a class="tu ref fn" href="#unmap_region" title='unmap_region' data-use='c' data-ref="unmap_region">unmap_region</a>(<a class="local col3 ref" href="#243mm" title='mm' data-ref="243mm">mm</a>, <a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>, <a class="local col5 ref" href="#245prev" title='prev' data-ref="245prev">prev</a>, <a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>, <a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>);</td></tr>
<tr><th id="1786">1786</th><td>	<a class="local col9 ref" href="#249charged" title='charged' data-ref="249charged">charged</a> = <var>0</var>;</td></tr>
<tr><th id="1787">1787</th><td>	<b>if</b> (<a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a>)</td></tr>
<tr><th id="1788">1788</th><td>		<a class="ref fn" href="../include/linux/fs.h.html#mapping_unmap_writable" title='mapping_unmap_writable' data-ref="mapping_unmap_writable">mapping_unmap_writable</a>(<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a>);</td></tr>
<tr><th id="1789">1789</th><td><dfn class="lbl" id="254allow_write_and_free_vma" data-ref="254allow_write_and_free_vma">allow_write_and_free_vma</dfn>:</td></tr>
<tr><th id="1790">1790</th><td>	<b>if</b> (<a class="local col0 ref" href="#240vm_flags" title='vm_flags' data-ref="240vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#177" title="0x00000800" data-ref="_M/VM_DENYWRITE">VM_DENYWRITE</a>)</td></tr>
<tr><th id="1791">1791</th><td>		<a class="ref fn" href="../include/linux/fs.h.html#allow_write_access" title='allow_write_access' data-ref="allow_write_access">allow_write_access</a>(<a class="local col7 ref" href="#237file" title='file' data-ref="237file">file</a>);</td></tr>
<tr><th id="1792">1792</th><td><dfn class="lbl" id="253free_vma" data-ref="253free_vma">free_vma</dfn>:</td></tr>
<tr><th id="1793">1793</th><td>	<a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_free" title='kmem_cache_free' data-ref="kmem_cache_free">kmem_cache_free</a>(<a class="ref" href="../include/linux/mm.h.html#vm_area_cachep" title='vm_area_cachep' data-ref="vm_area_cachep">vm_area_cachep</a>, <a class="local col4 ref" href="#244vma" title='vma' data-ref="244vma">vma</a>);</td></tr>
<tr><th id="1794">1794</th><td><dfn class="lbl" id="252unacct_error" data-ref="252unacct_error">unacct_error</dfn>:</td></tr>
<tr><th id="1795">1795</th><td>	<b>if</b> (<a class="local col9 ref" href="#249charged" title='charged' data-ref="249charged">charged</a>)</td></tr>
<tr><th id="1796">1796</th><td>		<a class="ref fn" href="../include/linux/mman.h.html#vm_unacct_memory" title='vm_unacct_memory' data-ref="vm_unacct_memory">vm_unacct_memory</a>(<a class="local col9 ref" href="#249charged" title='charged' data-ref="249charged">charged</a>);</td></tr>
<tr><th id="1797">1797</th><td>	<b>return</b> <a class="local col6 ref" href="#246error" title='error' data-ref="246error">error</a>;</td></tr>
<tr><th id="1798">1798</th><td>}</td></tr>
<tr><th id="1799">1799</th><td></td></tr>
<tr><th id="1800">1800</th><td><em>unsigned</em> <em>long</em> <dfn class="decl def fn" id="unmapped_area" title='unmapped_area' data-ref="unmapped_area">unmapped_area</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm.h.html#vm_unmapped_area_info" title='vm_unmapped_area_info' data-ref="vm_unmapped_area_info">vm_unmapped_area_info</a> *<dfn class="local col6 decl" id="256info" title='info' data-type='struct vm_unmapped_area_info *' data-ref="256info">info</dfn>)</td></tr>
<tr><th id="1801">1801</th><td>{</td></tr>
<tr><th id="1802">1802</th><td>	<i>/*</i></td></tr>
<tr><th id="1803">1803</th><td><i>	 * We implement the search by looking for an rbtree node that</i></td></tr>
<tr><th id="1804">1804</th><td><i>	 * immediately follows a suitable gap. That is,</i></td></tr>
<tr><th id="1805">1805</th><td><i>	 * - gap_start = vma-&gt;vm_prev-&gt;vm_end &lt;= info-&gt;high_limit - length;</i></td></tr>
<tr><th id="1806">1806</th><td><i>	 * - gap_end   = vma-&gt;vm_start        &gt;= info-&gt;low_limit  + length;</i></td></tr>
<tr><th id="1807">1807</th><td><i>	 * - gap_end - gap_start &gt;= length</i></td></tr>
<tr><th id="1808">1808</th><td><i>	 */</i></td></tr>
<tr><th id="1809">1809</th><td></td></tr>
<tr><th id="1810">1810</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col7 decl" id="257mm" title='mm' data-type='struct mm_struct *' data-ref="257mm">mm</dfn> = <a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::mm" title='task_struct::mm' data-ref="task_struct::mm">mm</a>;</td></tr>
<tr><th id="1811">1811</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col8 decl" id="258vma" title='vma' data-type='struct vm_area_struct *' data-ref="258vma">vma</dfn>;</td></tr>
<tr><th id="1812">1812</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="259length" title='length' data-type='unsigned long' data-ref="259length">length</dfn>, <dfn class="local col0 decl" id="260low_limit" title='low_limit' data-type='unsigned long' data-ref="260low_limit">low_limit</dfn>, <dfn class="local col1 decl" id="261high_limit" title='high_limit' data-type='unsigned long' data-ref="261high_limit">high_limit</dfn>, <dfn class="local col2 decl" id="262gap_start" title='gap_start' data-type='unsigned long' data-ref="262gap_start">gap_start</dfn>, <dfn class="local col3 decl" id="263gap_end" title='gap_end' data-type='unsigned long' data-ref="263gap_end">gap_end</dfn>;</td></tr>
<tr><th id="1813">1813</th><td></td></tr>
<tr><th id="1814">1814</th><td>	<i>/* Adjust search length to account for worst case alignment overhead */</i></td></tr>
<tr><th id="1815">1815</th><td>	<a class="local col9 ref" href="#259length" title='length' data-ref="259length">length</a> = <a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::length" title='vm_unmapped_area_info::length' data-ref="vm_unmapped_area_info::length">length</a> + <a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::align_mask" title='vm_unmapped_area_info::align_mask' data-ref="vm_unmapped_area_info::align_mask">align_mask</a>;</td></tr>
<tr><th id="1816">1816</th><td>	<b>if</b> (<a class="local col9 ref" href="#259length" title='length' data-ref="259length">length</a> &lt; <a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::length" title='vm_unmapped_area_info::length' data-ref="vm_unmapped_area_info::length">length</a>)</td></tr>
<tr><th id="1817">1817</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1818">1818</th><td></td></tr>
<tr><th id="1819">1819</th><td>	<i>/* Adjust search limits by the desired length */</i></td></tr>
<tr><th id="1820">1820</th><td>	<b>if</b> (<a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::high_limit" title='vm_unmapped_area_info::high_limit' data-ref="vm_unmapped_area_info::high_limit">high_limit</a> &lt; <a class="local col9 ref" href="#259length" title='length' data-ref="259length">length</a>)</td></tr>
<tr><th id="1821">1821</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1822">1822</th><td>	<a class="local col1 ref" href="#261high_limit" title='high_limit' data-ref="261high_limit">high_limit</a> = <a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::high_limit" title='vm_unmapped_area_info::high_limit' data-ref="vm_unmapped_area_info::high_limit">high_limit</a> - <a class="local col9 ref" href="#259length" title='length' data-ref="259length">length</a>;</td></tr>
<tr><th id="1823">1823</th><td></td></tr>
<tr><th id="1824">1824</th><td>	<b>if</b> (<a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::low_limit" title='vm_unmapped_area_info::low_limit' data-ref="vm_unmapped_area_info::low_limit">low_limit</a> &gt; <a class="local col1 ref" href="#261high_limit" title='high_limit' data-ref="261high_limit">high_limit</a>)</td></tr>
<tr><th id="1825">1825</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1826">1826</th><td>	<a class="local col0 ref" href="#260low_limit" title='low_limit' data-ref="260low_limit">low_limit</a> = <a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::low_limit" title='vm_unmapped_area_info::low_limit' data-ref="vm_unmapped_area_info::low_limit">low_limit</a> + <a class="local col9 ref" href="#259length" title='length' data-ref="259length">length</a>;</td></tr>
<tr><th id="1827">1827</th><td></td></tr>
<tr><th id="1828">1828</th><td>	<i>/* Check if rbtree root looks promising */</i></td></tr>
<tr><th id="1829">1829</th><td>	<b>if</b> (<a class="macro" href="../include/linux/rbtree.h.html#68" title="(({ union { typeof((&amp;mm-&gt;mm_rb)-&gt;rb_node) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;mm-&gt;mm_rb)-&gt;rb_node), __u.__c, sizeof((&amp;mm-&gt;mm_rb)-&gt;rb_node)); else __read_once_size_nocheck(&amp;((&amp;mm-&gt;mm_rb)-&gt;rb_node), __u.__c, sizeof((&amp;mm-&gt;mm_rb)-&gt;rb_node)); do { } while (0); __u.__val; }) == ((void *)0))" data-ref="_M/RB_EMPTY_ROOT">RB_EMPTY_ROOT</a>(&amp;<a class="local col7 ref" href="#257mm" title='mm' data-ref="257mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mm_rb" title='mm_struct::mm_rb' data-ref="mm_struct::mm_rb">mm_rb</a>))</td></tr>
<tr><th id="1830">1830</th><td>		<b>goto</b> <a class="lbl" href="#264check_highest" data-ref="264check_highest">check_highest</a>;</td></tr>
<tr><th id="1831">1831</th><td>	<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a> = <a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(mm-&gt;mm_rb.rb_node); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(mm-&gt;mm_rb.rb_node)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(mm-&gt;mm_rb.rb_node)), typeof(void)))); extern void __compiletime_assert_1831(void) ; if (__cond) __compiletime_assert_1831(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="local col7 ref" href="#257mm" title='mm' data-ref="257mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mm_rb" title='mm_struct::mm_rb' data-ref="mm_struct::mm_rb">mm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root::rb_node" title='rb_root::rb_node' data-ref="rb_root::rb_node">rb_node</a>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>);</td></tr>
<tr><th id="1832">1832</th><td>	<b>if</b> (<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::rb_subtree_gap" title='vm_area_struct::rb_subtree_gap' data-ref="vm_area_struct::rb_subtree_gap">rb_subtree_gap</a> &lt; <a class="local col9 ref" href="#259length" title='length' data-ref="259length">length</a>)</td></tr>
<tr><th id="1833">1833</th><td>		<b>goto</b> <a class="lbl" href="#264check_highest" data-ref="264check_highest">check_highest</a>;</td></tr>
<tr><th id="1834">1834</th><td></td></tr>
<tr><th id="1835">1835</th><td>	<b>while</b> (<a class="enum" href="../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>) {</td></tr>
<tr><th id="1836">1836</th><td>		<i>/* Visit left subtree if it looks promising */</i></td></tr>
<tr><th id="1837">1837</th><td>		<a class="local col3 ref" href="#263gap_end" title='gap_end' data-ref="263gap_end">gap_end</a> = <a class="ref fn" href="../include/linux/mm.h.html#vm_start_gap" title='vm_start_gap' data-ref="vm_start_gap">vm_start_gap</a>(<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a>);</td></tr>
<tr><th id="1838">1838</th><td>		<b>if</b> (<a class="local col3 ref" href="#263gap_end" title='gap_end' data-ref="263gap_end">gap_end</a> &gt;= <a class="local col0 ref" href="#260low_limit" title='low_limit' data-ref="260low_limit">low_limit</a> &amp;&amp; <a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_left" title='rb_node::rb_left' data-ref="rb_node::rb_left">rb_left</a>) {</td></tr>
<tr><th id="1839">1839</th><td>			<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col5 decl" id="265left" title='left' data-type='struct vm_area_struct *' data-ref="265left">left</dfn> =</td></tr>
<tr><th id="1840">1840</th><td>				<a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(vma-&gt;vm_rb.rb_left); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(vma-&gt;vm_rb.rb_left)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(vma-&gt;vm_rb.rb_left)), typeof(void)))); extern void __compiletime_assert_1841(void) ; if (__cond) __compiletime_assert_1841(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_left" title='rb_node::rb_left' data-ref="rb_node::rb_left">rb_left</a>,</td></tr>
<tr><th id="1841">1841</th><td>					 <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>);</td></tr>
<tr><th id="1842">1842</th><td>			<b>if</b> (<a class="local col5 ref" href="#265left" title='left' data-ref="265left">left</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::rb_subtree_gap" title='vm_area_struct::rb_subtree_gap' data-ref="vm_area_struct::rb_subtree_gap">rb_subtree_gap</a> &gt;= <a class="local col9 ref" href="#259length" title='length' data-ref="259length">length</a>) {</td></tr>
<tr><th id="1843">1843</th><td>				<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a> = <a class="local col5 ref" href="#265left" title='left' data-ref="265left">left</a>;</td></tr>
<tr><th id="1844">1844</th><td>				<b>continue</b>;</td></tr>
<tr><th id="1845">1845</th><td>			}</td></tr>
<tr><th id="1846">1846</th><td>		}</td></tr>
<tr><th id="1847">1847</th><td></td></tr>
<tr><th id="1848">1848</th><td>		<a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a> = <a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a> ? <a class="ref fn" href="../include/linux/mm.h.html#vm_end_gap" title='vm_end_gap' data-ref="vm_end_gap">vm_end_gap</a>(<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a>) : <var>0</var>;</td></tr>
<tr><th id="1849">1849</th><td><dfn class="lbl" id="266check_current" data-ref="266check_current">check_current</dfn>:</td></tr>
<tr><th id="1850">1850</th><td>		<i>/* Check if current node has a suitable gap */</i></td></tr>
<tr><th id="1851">1851</th><td>		<b>if</b> (<a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a> &gt; <a class="local col1 ref" href="#261high_limit" title='high_limit' data-ref="261high_limit">high_limit</a>)</td></tr>
<tr><th id="1852">1852</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1853">1853</th><td>		<b>if</b> (<a class="local col3 ref" href="#263gap_end" title='gap_end' data-ref="263gap_end">gap_end</a> &gt;= <a class="local col0 ref" href="#260low_limit" title='low_limit' data-ref="260low_limit">low_limit</a> &amp;&amp;</td></tr>
<tr><th id="1854">1854</th><td>		    <a class="local col3 ref" href="#263gap_end" title='gap_end' data-ref="263gap_end">gap_end</a> &gt; <a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a> &amp;&amp; <a class="local col3 ref" href="#263gap_end" title='gap_end' data-ref="263gap_end">gap_end</a> - <a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a> &gt;= <a class="local col9 ref" href="#259length" title='length' data-ref="259length">length</a>)</td></tr>
<tr><th id="1855">1855</th><td>			<b>goto</b> <a class="lbl" href="#267found" data-ref="267found">found</a>;</td></tr>
<tr><th id="1856">1856</th><td></td></tr>
<tr><th id="1857">1857</th><td>		<i>/* Visit right subtree if it looks promising */</i></td></tr>
<tr><th id="1858">1858</th><td>		<b>if</b> (<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_right" title='rb_node::rb_right' data-ref="rb_node::rb_right">rb_right</a>) {</td></tr>
<tr><th id="1859">1859</th><td>			<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col8 decl" id="268right" title='right' data-type='struct vm_area_struct *' data-ref="268right">right</dfn> =</td></tr>
<tr><th id="1860">1860</th><td>				<a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(vma-&gt;vm_rb.rb_right); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(vma-&gt;vm_rb.rb_right)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(vma-&gt;vm_rb.rb_right)), typeof(void)))); extern void __compiletime_assert_1861(void) ; if (__cond) __compiletime_assert_1861(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_right" title='rb_node::rb_right' data-ref="rb_node::rb_right">rb_right</a>,</td></tr>
<tr><th id="1861">1861</th><td>					 <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>);</td></tr>
<tr><th id="1862">1862</th><td>			<b>if</b> (<a class="local col8 ref" href="#268right" title='right' data-ref="268right">right</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::rb_subtree_gap" title='vm_area_struct::rb_subtree_gap' data-ref="vm_area_struct::rb_subtree_gap">rb_subtree_gap</a> &gt;= <a class="local col9 ref" href="#259length" title='length' data-ref="259length">length</a>) {</td></tr>
<tr><th id="1863">1863</th><td>				<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a> = <a class="local col8 ref" href="#268right" title='right' data-ref="268right">right</a>;</td></tr>
<tr><th id="1864">1864</th><td>				<b>continue</b>;</td></tr>
<tr><th id="1865">1865</th><td>			}</td></tr>
<tr><th id="1866">1866</th><td>		}</td></tr>
<tr><th id="1867">1867</th><td></td></tr>
<tr><th id="1868">1868</th><td>		<i>/* Go back up the rbtree to find next candidate node */</i></td></tr>
<tr><th id="1869">1869</th><td>		<b>while</b> (<a class="enum" href="../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>) {</td></tr>
<tr><th id="1870">1870</th><td>			<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> *<dfn class="local col9 decl" id="269prev" title='prev' data-type='struct rb_node *' data-ref="269prev">prev</dfn> = &amp;<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>;</td></tr>
<tr><th id="1871">1871</th><td>			<b>if</b> (!<a class="macro" href="../include/linux/rbtree.h.html#62" title="((struct rb_node *)((prev)-&gt;__rb_parent_color &amp; ~3))" data-ref="_M/rb_parent">rb_parent</a>(<a class="local col9 ref" href="#269prev" title='prev' data-ref="269prev">prev</a>))</td></tr>
<tr><th id="1872">1872</th><td>				<b>goto</b> <a class="lbl" href="#264check_highest" data-ref="264check_highest">check_highest</a>;</td></tr>
<tr><th id="1873">1873</th><td>			<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a> = <a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(((struct rb_node *)((prev)-&gt;__rb_parent_color &amp; ~3))); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(((struct rb_node *)((prev)-&gt;__rb_parent_color &amp; ~3)))), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(((struct rb_node *)((prev)-&gt;__rb_parent_color &amp; ~3)))), typeof(void)))); extern void __compiletime_assert_1874(void) ; if (__cond) __compiletime_assert_1874(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="macro" href="../include/linux/rbtree.h.html#62" title="((struct rb_node *)((prev)-&gt;__rb_parent_color &amp; ~3))" data-ref="_M/rb_parent">rb_parent</a>(<a class="local col9 ref" href="#269prev" title='prev' data-ref="269prev">prev</a>),</td></tr>
<tr><th id="1874">1874</th><td>				       <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>);</td></tr>
<tr><th id="1875">1875</th><td>			<b>if</b> (<a class="local col9 ref" href="#269prev" title='prev' data-ref="269prev">prev</a> == <a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_left" title='rb_node::rb_left' data-ref="rb_node::rb_left">rb_left</a>) {</td></tr>
<tr><th id="1876">1876</th><td>				<a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a> = <a class="ref fn" href="../include/linux/mm.h.html#vm_end_gap" title='vm_end_gap' data-ref="vm_end_gap">vm_end_gap</a>(<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a>);</td></tr>
<tr><th id="1877">1877</th><td>				<a class="local col3 ref" href="#263gap_end" title='gap_end' data-ref="263gap_end">gap_end</a> = <a class="ref fn" href="../include/linux/mm.h.html#vm_start_gap" title='vm_start_gap' data-ref="vm_start_gap">vm_start_gap</a>(<a class="local col8 ref" href="#258vma" title='vma' data-ref="258vma">vma</a>);</td></tr>
<tr><th id="1878">1878</th><td>				<b>goto</b> <a class="lbl" href="#266check_current" data-ref="266check_current">check_current</a>;</td></tr>
<tr><th id="1879">1879</th><td>			}</td></tr>
<tr><th id="1880">1880</th><td>		}</td></tr>
<tr><th id="1881">1881</th><td>	}</td></tr>
<tr><th id="1882">1882</th><td></td></tr>
<tr><th id="1883">1883</th><td><dfn class="lbl" id="264check_highest" data-ref="264check_highest">check_highest</dfn>:</td></tr>
<tr><th id="1884">1884</th><td>	<i>/* Check highest gap, which does not precede any rbtree node */</i></td></tr>
<tr><th id="1885">1885</th><td>	<a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a> = <a class="local col7 ref" href="#257mm" title='mm' data-ref="257mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::highest_vm_end" title='mm_struct::highest_vm_end' data-ref="mm_struct::highest_vm_end">highest_vm_end</a>;</td></tr>
<tr><th id="1886">1886</th><td>	<a class="local col3 ref" href="#263gap_end" title='gap_end' data-ref="263gap_end">gap_end</a> = <a class="macro" href="../include/linux/kernel.h.html#27" title="(~0UL)" data-ref="_M/ULONG_MAX">ULONG_MAX</a>;  <i>/* Only for VM_BUG_ON below */</i></td></tr>
<tr><th id="1887">1887</th><td>	<b>if</b> (<a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a> &gt; <a class="local col1 ref" href="#261high_limit" title='high_limit' data-ref="261high_limit">high_limit</a>)</td></tr>
<tr><th id="1888">1888</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1889">1889</th><td></td></tr>
<tr><th id="1890">1890</th><td><dfn class="lbl" id="267found" data-ref="267found">found</dfn>:</td></tr>
<tr><th id="1891">1891</th><td>	<i>/* We found a suitable gap. Clip it with the original low_limit. */</i></td></tr>
<tr><th id="1892">1892</th><td>	<b>if</b> (<a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a> &lt; <a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::low_limit" title='vm_unmapped_area_info::low_limit' data-ref="vm_unmapped_area_info::low_limit">low_limit</a>)</td></tr>
<tr><th id="1893">1893</th><td>		<a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a> = <a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::low_limit" title='vm_unmapped_area_info::low_limit' data-ref="vm_unmapped_area_info::low_limit">low_limit</a>;</td></tr>
<tr><th id="1894">1894</th><td></td></tr>
<tr><th id="1895">1895</th><td>	<i>/* Adjust gap address to the desired alignment */</i></td></tr>
<tr><th id="1896">1896</th><td>	<a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a> += (<a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::align_offset" title='vm_unmapped_area_info::align_offset' data-ref="vm_unmapped_area_info::align_offset">align_offset</a> - <a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a>) &amp; <a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::align_mask" title='vm_unmapped_area_info::align_mask' data-ref="vm_unmapped_area_info::align_mask">align_mask</a>;</td></tr>
<tr><th id="1897">1897</th><td></td></tr>
<tr><th id="1898">1898</th><td>	<a class="macro" href="../include/linux/mmdebug.h.html#45" title="((void)(sizeof(( long)(gap_start + info-&gt;length &gt; info-&gt;high_limit))))" data-ref="_M/VM_BUG_ON">VM_BUG_ON</a>(<a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a> + <a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::length" title='vm_unmapped_area_info::length' data-ref="vm_unmapped_area_info::length">length</a> &gt; <a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::high_limit" title='vm_unmapped_area_info::high_limit' data-ref="vm_unmapped_area_info::high_limit">high_limit</a>);</td></tr>
<tr><th id="1899">1899</th><td>	<a class="macro" href="../include/linux/mmdebug.h.html#45" title="((void)(sizeof(( long)(gap_start + info-&gt;length &gt; gap_end))))" data-ref="_M/VM_BUG_ON">VM_BUG_ON</a>(<a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a> + <a class="local col6 ref" href="#256info" title='info' data-ref="256info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::length" title='vm_unmapped_area_info::length' data-ref="vm_unmapped_area_info::length">length</a> &gt; <a class="local col3 ref" href="#263gap_end" title='gap_end' data-ref="263gap_end">gap_end</a>);</td></tr>
<tr><th id="1900">1900</th><td>	<b>return</b> <a class="local col2 ref" href="#262gap_start" title='gap_start' data-ref="262gap_start">gap_start</a>;</td></tr>
<tr><th id="1901">1901</th><td>}</td></tr>
<tr><th id="1902">1902</th><td></td></tr>
<tr><th id="1903">1903</th><td><em>unsigned</em> <em>long</em> <dfn class="decl def fn" id="unmapped_area_topdown" title='unmapped_area_topdown' data-ref="unmapped_area_topdown">unmapped_area_topdown</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm.h.html#vm_unmapped_area_info" title='vm_unmapped_area_info' data-ref="vm_unmapped_area_info">vm_unmapped_area_info</a> *<dfn class="local col0 decl" id="270info" title='info' data-type='struct vm_unmapped_area_info *' data-ref="270info">info</dfn>)</td></tr>
<tr><th id="1904">1904</th><td>{</td></tr>
<tr><th id="1905">1905</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col1 decl" id="271mm" title='mm' data-type='struct mm_struct *' data-ref="271mm">mm</dfn> = <a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::mm" title='task_struct::mm' data-ref="task_struct::mm">mm</a>;</td></tr>
<tr><th id="1906">1906</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="272vma" title='vma' data-type='struct vm_area_struct *' data-ref="272vma">vma</dfn>;</td></tr>
<tr><th id="1907">1907</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col3 decl" id="273length" title='length' data-type='unsigned long' data-ref="273length">length</dfn>, <dfn class="local col4 decl" id="274low_limit" title='low_limit' data-type='unsigned long' data-ref="274low_limit">low_limit</dfn>, <dfn class="local col5 decl" id="275high_limit" title='high_limit' data-type='unsigned long' data-ref="275high_limit">high_limit</dfn>, <dfn class="local col6 decl" id="276gap_start" title='gap_start' data-type='unsigned long' data-ref="276gap_start">gap_start</dfn>, <dfn class="local col7 decl" id="277gap_end" title='gap_end' data-type='unsigned long' data-ref="277gap_end">gap_end</dfn>;</td></tr>
<tr><th id="1908">1908</th><td></td></tr>
<tr><th id="1909">1909</th><td>	<i>/* Adjust search length to account for worst case alignment overhead */</i></td></tr>
<tr><th id="1910">1910</th><td>	<a class="local col3 ref" href="#273length" title='length' data-ref="273length">length</a> = <a class="local col0 ref" href="#270info" title='info' data-ref="270info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::length" title='vm_unmapped_area_info::length' data-ref="vm_unmapped_area_info::length">length</a> + <a class="local col0 ref" href="#270info" title='info' data-ref="270info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::align_mask" title='vm_unmapped_area_info::align_mask' data-ref="vm_unmapped_area_info::align_mask">align_mask</a>;</td></tr>
<tr><th id="1911">1911</th><td>	<b>if</b> (<a class="local col3 ref" href="#273length" title='length' data-ref="273length">length</a> &lt; <a class="local col0 ref" href="#270info" title='info' data-ref="270info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::length" title='vm_unmapped_area_info::length' data-ref="vm_unmapped_area_info::length">length</a>)</td></tr>
<tr><th id="1912">1912</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1913">1913</th><td></td></tr>
<tr><th id="1914">1914</th><td>	<i>/*</i></td></tr>
<tr><th id="1915">1915</th><td><i>	 * Adjust search limits by the desired length.</i></td></tr>
<tr><th id="1916">1916</th><td><i>	 * See implementation comment at top of unmapped_area().</i></td></tr>
<tr><th id="1917">1917</th><td><i>	 */</i></td></tr>
<tr><th id="1918">1918</th><td>	<a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> = <a class="local col0 ref" href="#270info" title='info' data-ref="270info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::high_limit" title='vm_unmapped_area_info::high_limit' data-ref="vm_unmapped_area_info::high_limit">high_limit</a>;</td></tr>
<tr><th id="1919">1919</th><td>	<b>if</b> (<a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> &lt; <a class="local col3 ref" href="#273length" title='length' data-ref="273length">length</a>)</td></tr>
<tr><th id="1920">1920</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1921">1921</th><td>	<a class="local col5 ref" href="#275high_limit" title='high_limit' data-ref="275high_limit">high_limit</a> = <a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> - <a class="local col3 ref" href="#273length" title='length' data-ref="273length">length</a>;</td></tr>
<tr><th id="1922">1922</th><td></td></tr>
<tr><th id="1923">1923</th><td>	<b>if</b> (<a class="local col0 ref" href="#270info" title='info' data-ref="270info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::low_limit" title='vm_unmapped_area_info::low_limit' data-ref="vm_unmapped_area_info::low_limit">low_limit</a> &gt; <a class="local col5 ref" href="#275high_limit" title='high_limit' data-ref="275high_limit">high_limit</a>)</td></tr>
<tr><th id="1924">1924</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1925">1925</th><td>	<a class="local col4 ref" href="#274low_limit" title='low_limit' data-ref="274low_limit">low_limit</a> = <a class="local col0 ref" href="#270info" title='info' data-ref="270info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::low_limit" title='vm_unmapped_area_info::low_limit' data-ref="vm_unmapped_area_info::low_limit">low_limit</a> + <a class="local col3 ref" href="#273length" title='length' data-ref="273length">length</a>;</td></tr>
<tr><th id="1926">1926</th><td></td></tr>
<tr><th id="1927">1927</th><td>	<i>/* Check highest gap, which does not precede any rbtree node */</i></td></tr>
<tr><th id="1928">1928</th><td>	<a class="local col6 ref" href="#276gap_start" title='gap_start' data-ref="276gap_start">gap_start</a> = <a class="local col1 ref" href="#271mm" title='mm' data-ref="271mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::highest_vm_end" title='mm_struct::highest_vm_end' data-ref="mm_struct::highest_vm_end">highest_vm_end</a>;</td></tr>
<tr><th id="1929">1929</th><td>	<b>if</b> (<a class="local col6 ref" href="#276gap_start" title='gap_start' data-ref="276gap_start">gap_start</a> &lt;= <a class="local col5 ref" href="#275high_limit" title='high_limit' data-ref="275high_limit">high_limit</a>)</td></tr>
<tr><th id="1930">1930</th><td>		<b>goto</b> <a class="lbl" href="#278found_highest" data-ref="278found_highest">found_highest</a>;</td></tr>
<tr><th id="1931">1931</th><td></td></tr>
<tr><th id="1932">1932</th><td>	<i>/* Check if rbtree root looks promising */</i></td></tr>
<tr><th id="1933">1933</th><td>	<b>if</b> (<a class="macro" href="../include/linux/rbtree.h.html#68" title="(({ union { typeof((&amp;mm-&gt;mm_rb)-&gt;rb_node) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;((&amp;mm-&gt;mm_rb)-&gt;rb_node), __u.__c, sizeof((&amp;mm-&gt;mm_rb)-&gt;rb_node)); else __read_once_size_nocheck(&amp;((&amp;mm-&gt;mm_rb)-&gt;rb_node), __u.__c, sizeof((&amp;mm-&gt;mm_rb)-&gt;rb_node)); do { } while (0); __u.__val; }) == ((void *)0))" data-ref="_M/RB_EMPTY_ROOT">RB_EMPTY_ROOT</a>(&amp;<a class="local col1 ref" href="#271mm" title='mm' data-ref="271mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mm_rb" title='mm_struct::mm_rb' data-ref="mm_struct::mm_rb">mm_rb</a>))</td></tr>
<tr><th id="1934">1934</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1935">1935</th><td>	<a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a> = <a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(mm-&gt;mm_rb.rb_node); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(mm-&gt;mm_rb.rb_node)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(mm-&gt;mm_rb.rb_node)), typeof(void)))); extern void __compiletime_assert_1935(void) ; if (__cond) __compiletime_assert_1935(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="local col1 ref" href="#271mm" title='mm' data-ref="271mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mm_rb" title='mm_struct::mm_rb' data-ref="mm_struct::mm_rb">mm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root::rb_node" title='rb_root::rb_node' data-ref="rb_root::rb_node">rb_node</a>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>);</td></tr>
<tr><th id="1936">1936</th><td>	<b>if</b> (<a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::rb_subtree_gap" title='vm_area_struct::rb_subtree_gap' data-ref="vm_area_struct::rb_subtree_gap">rb_subtree_gap</a> &lt; <a class="local col3 ref" href="#273length" title='length' data-ref="273length">length</a>)</td></tr>
<tr><th id="1937">1937</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1938">1938</th><td></td></tr>
<tr><th id="1939">1939</th><td>	<b>while</b> (<a class="enum" href="../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>) {</td></tr>
<tr><th id="1940">1940</th><td>		<i>/* Visit right subtree if it looks promising */</i></td></tr>
<tr><th id="1941">1941</th><td>		<a class="local col6 ref" href="#276gap_start" title='gap_start' data-ref="276gap_start">gap_start</a> = <a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a> ? <a class="ref fn" href="../include/linux/mm.h.html#vm_end_gap" title='vm_end_gap' data-ref="vm_end_gap">vm_end_gap</a>(<a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a>) : <var>0</var>;</td></tr>
<tr><th id="1942">1942</th><td>		<b>if</b> (<a class="local col6 ref" href="#276gap_start" title='gap_start' data-ref="276gap_start">gap_start</a> &lt;= <a class="local col5 ref" href="#275high_limit" title='high_limit' data-ref="275high_limit">high_limit</a> &amp;&amp; <a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_right" title='rb_node::rb_right' data-ref="rb_node::rb_right">rb_right</a>) {</td></tr>
<tr><th id="1943">1943</th><td>			<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col9 decl" id="279right" title='right' data-type='struct vm_area_struct *' data-ref="279right">right</dfn> =</td></tr>
<tr><th id="1944">1944</th><td>				<a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(vma-&gt;vm_rb.rb_right); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(vma-&gt;vm_rb.rb_right)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(vma-&gt;vm_rb.rb_right)), typeof(void)))); extern void __compiletime_assert_1945(void) ; if (__cond) __compiletime_assert_1945(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_right" title='rb_node::rb_right' data-ref="rb_node::rb_right">rb_right</a>,</td></tr>
<tr><th id="1945">1945</th><td>					 <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>);</td></tr>
<tr><th id="1946">1946</th><td>			<b>if</b> (<a class="local col9 ref" href="#279right" title='right' data-ref="279right">right</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::rb_subtree_gap" title='vm_area_struct::rb_subtree_gap' data-ref="vm_area_struct::rb_subtree_gap">rb_subtree_gap</a> &gt;= <a class="local col3 ref" href="#273length" title='length' data-ref="273length">length</a>) {</td></tr>
<tr><th id="1947">1947</th><td>				<a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a> = <a class="local col9 ref" href="#279right" title='right' data-ref="279right">right</a>;</td></tr>
<tr><th id="1948">1948</th><td>				<b>continue</b>;</td></tr>
<tr><th id="1949">1949</th><td>			}</td></tr>
<tr><th id="1950">1950</th><td>		}</td></tr>
<tr><th id="1951">1951</th><td></td></tr>
<tr><th id="1952">1952</th><td><dfn class="lbl" id="280check_current" data-ref="280check_current">check_current</dfn>:</td></tr>
<tr><th id="1953">1953</th><td>		<i>/* Check if current node has a suitable gap */</i></td></tr>
<tr><th id="1954">1954</th><td>		<a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> = <a class="ref fn" href="../include/linux/mm.h.html#vm_start_gap" title='vm_start_gap' data-ref="vm_start_gap">vm_start_gap</a>(<a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a>);</td></tr>
<tr><th id="1955">1955</th><td>		<b>if</b> (<a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> &lt; <a class="local col4 ref" href="#274low_limit" title='low_limit' data-ref="274low_limit">low_limit</a>)</td></tr>
<tr><th id="1956">1956</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1957">1957</th><td>		<b>if</b> (<a class="local col6 ref" href="#276gap_start" title='gap_start' data-ref="276gap_start">gap_start</a> &lt;= <a class="local col5 ref" href="#275high_limit" title='high_limit' data-ref="275high_limit">high_limit</a> &amp;&amp;</td></tr>
<tr><th id="1958">1958</th><td>		    <a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> &gt; <a class="local col6 ref" href="#276gap_start" title='gap_start' data-ref="276gap_start">gap_start</a> &amp;&amp; <a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> - <a class="local col6 ref" href="#276gap_start" title='gap_start' data-ref="276gap_start">gap_start</a> &gt;= <a class="local col3 ref" href="#273length" title='length' data-ref="273length">length</a>)</td></tr>
<tr><th id="1959">1959</th><td>			<b>goto</b> <a class="lbl" href="#281found" data-ref="281found">found</a>;</td></tr>
<tr><th id="1960">1960</th><td></td></tr>
<tr><th id="1961">1961</th><td>		<i>/* Visit left subtree if it looks promising */</i></td></tr>
<tr><th id="1962">1962</th><td>		<b>if</b> (<a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_left" title='rb_node::rb_left' data-ref="rb_node::rb_left">rb_left</a>) {</td></tr>
<tr><th id="1963">1963</th><td>			<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="282left" title='left' data-type='struct vm_area_struct *' data-ref="282left">left</dfn> =</td></tr>
<tr><th id="1964">1964</th><td>				<a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(vma-&gt;vm_rb.rb_left); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(vma-&gt;vm_rb.rb_left)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(vma-&gt;vm_rb.rb_left)), typeof(void)))); extern void __compiletime_assert_1965(void) ; if (__cond) __compiletime_assert_1965(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_left" title='rb_node::rb_left' data-ref="rb_node::rb_left">rb_left</a>,</td></tr>
<tr><th id="1965">1965</th><td>					 <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>);</td></tr>
<tr><th id="1966">1966</th><td>			<b>if</b> (<a class="local col2 ref" href="#282left" title='left' data-ref="282left">left</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::rb_subtree_gap" title='vm_area_struct::rb_subtree_gap' data-ref="vm_area_struct::rb_subtree_gap">rb_subtree_gap</a> &gt;= <a class="local col3 ref" href="#273length" title='length' data-ref="273length">length</a>) {</td></tr>
<tr><th id="1967">1967</th><td>				<a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a> = <a class="local col2 ref" href="#282left" title='left' data-ref="282left">left</a>;</td></tr>
<tr><th id="1968">1968</th><td>				<b>continue</b>;</td></tr>
<tr><th id="1969">1969</th><td>			}</td></tr>
<tr><th id="1970">1970</th><td>		}</td></tr>
<tr><th id="1971">1971</th><td></td></tr>
<tr><th id="1972">1972</th><td>		<i>/* Go back up the rbtree to find next candidate node */</i></td></tr>
<tr><th id="1973">1973</th><td>		<b>while</b> (<a class="enum" href="../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>) {</td></tr>
<tr><th id="1974">1974</th><td>			<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> *<dfn class="local col3 decl" id="283prev" title='prev' data-type='struct rb_node *' data-ref="283prev">prev</dfn> = &amp;<a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>;</td></tr>
<tr><th id="1975">1975</th><td>			<b>if</b> (!<a class="macro" href="../include/linux/rbtree.h.html#62" title="((struct rb_node *)((prev)-&gt;__rb_parent_color &amp; ~3))" data-ref="_M/rb_parent">rb_parent</a>(<a class="local col3 ref" href="#283prev" title='prev' data-ref="283prev">prev</a>))</td></tr>
<tr><th id="1976">1976</th><td>				<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1977">1977</th><td>			<a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a> = <a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(((struct rb_node *)((prev)-&gt;__rb_parent_color &amp; ~3))); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(((struct rb_node *)((prev)-&gt;__rb_parent_color &amp; ~3)))), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(((struct rb_node *)((prev)-&gt;__rb_parent_color &amp; ~3)))), typeof(void)))); extern void __compiletime_assert_1978(void) ; if (__cond) __compiletime_assert_1978(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="macro" href="../include/linux/rbtree.h.html#62" title="((struct rb_node *)((prev)-&gt;__rb_parent_color &amp; ~3))" data-ref="_M/rb_parent">rb_parent</a>(<a class="local col3 ref" href="#283prev" title='prev' data-ref="283prev">prev</a>),</td></tr>
<tr><th id="1978">1978</th><td>				       <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>);</td></tr>
<tr><th id="1979">1979</th><td>			<b>if</b> (<a class="local col3 ref" href="#283prev" title='prev' data-ref="283prev">prev</a> == <a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_right" title='rb_node::rb_right' data-ref="rb_node::rb_right">rb_right</a>) {</td></tr>
<tr><th id="1980">1980</th><td>				<a class="local col6 ref" href="#276gap_start" title='gap_start' data-ref="276gap_start">gap_start</a> = <a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a> ?</td></tr>
<tr><th id="1981">1981</th><td>					<a class="ref fn" href="../include/linux/mm.h.html#vm_end_gap" title='vm_end_gap' data-ref="vm_end_gap">vm_end_gap</a>(<a class="local col2 ref" href="#272vma" title='vma' data-ref="272vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a>) : <var>0</var>;</td></tr>
<tr><th id="1982">1982</th><td>				<b>goto</b> <a class="lbl" href="#280check_current" data-ref="280check_current">check_current</a>;</td></tr>
<tr><th id="1983">1983</th><td>			}</td></tr>
<tr><th id="1984">1984</th><td>		}</td></tr>
<tr><th id="1985">1985</th><td>	}</td></tr>
<tr><th id="1986">1986</th><td></td></tr>
<tr><th id="1987">1987</th><td><dfn class="lbl" id="281found" data-ref="281found">found</dfn>:</td></tr>
<tr><th id="1988">1988</th><td>	<i>/* We found a suitable gap. Clip it with the original high_limit. */</i></td></tr>
<tr><th id="1989">1989</th><td>	<b>if</b> (<a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> &gt; <a class="local col0 ref" href="#270info" title='info' data-ref="270info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::high_limit" title='vm_unmapped_area_info::high_limit' data-ref="vm_unmapped_area_info::high_limit">high_limit</a>)</td></tr>
<tr><th id="1990">1990</th><td>		<a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> = <a class="local col0 ref" href="#270info" title='info' data-ref="270info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::high_limit" title='vm_unmapped_area_info::high_limit' data-ref="vm_unmapped_area_info::high_limit">high_limit</a>;</td></tr>
<tr><th id="1991">1991</th><td></td></tr>
<tr><th id="1992">1992</th><td><dfn class="lbl" id="278found_highest" data-ref="278found_highest">found_highest</dfn>:</td></tr>
<tr><th id="1993">1993</th><td>	<i>/* Compute highest gap address at the desired alignment */</i></td></tr>
<tr><th id="1994">1994</th><td>	<a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> -= <a class="local col0 ref" href="#270info" title='info' data-ref="270info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::length" title='vm_unmapped_area_info::length' data-ref="vm_unmapped_area_info::length">length</a>;</td></tr>
<tr><th id="1995">1995</th><td>	<a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> -= (<a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> - <a class="local col0 ref" href="#270info" title='info' data-ref="270info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::align_offset" title='vm_unmapped_area_info::align_offset' data-ref="vm_unmapped_area_info::align_offset">align_offset</a>) &amp; <a class="local col0 ref" href="#270info" title='info' data-ref="270info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::align_mask" title='vm_unmapped_area_info::align_mask' data-ref="vm_unmapped_area_info::align_mask">align_mask</a>;</td></tr>
<tr><th id="1996">1996</th><td></td></tr>
<tr><th id="1997">1997</th><td>	<a class="macro" href="../include/linux/mmdebug.h.html#45" title="((void)(sizeof(( long)(gap_end &lt; info-&gt;low_limit))))" data-ref="_M/VM_BUG_ON">VM_BUG_ON</a>(<a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> &lt; <a class="local col0 ref" href="#270info" title='info' data-ref="270info">info</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_unmapped_area_info::low_limit" title='vm_unmapped_area_info::low_limit' data-ref="vm_unmapped_area_info::low_limit">low_limit</a>);</td></tr>
<tr><th id="1998">1998</th><td>	<a class="macro" href="../include/linux/mmdebug.h.html#45" title="((void)(sizeof(( long)(gap_end &lt; gap_start))))" data-ref="_M/VM_BUG_ON">VM_BUG_ON</a>(<a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a> &lt; <a class="local col6 ref" href="#276gap_start" title='gap_start' data-ref="276gap_start">gap_start</a>);</td></tr>
<tr><th id="1999">1999</th><td>	<b>return</b> <a class="local col7 ref" href="#277gap_end" title='gap_end' data-ref="277gap_end">gap_end</a>;</td></tr>
<tr><th id="2000">2000</th><td>}</td></tr>
<tr><th id="2001">2001</th><td></td></tr>
<tr><th id="2002">2002</th><td><i>/* Get an address range which is currently unmapped.</i></td></tr>
<tr><th id="2003">2003</th><td><i> * For shmat() with addr=0.</i></td></tr>
<tr><th id="2004">2004</th><td><i> *</i></td></tr>
<tr><th id="2005">2005</th><td><i> * Ugly calling convention alert:</i></td></tr>
<tr><th id="2006">2006</th><td><i> * Return value with the low bits set means error value,</i></td></tr>
<tr><th id="2007">2007</th><td><i> * ie</i></td></tr>
<tr><th id="2008">2008</th><td><i> *	if (ret &amp; ~PAGE_MASK)</i></td></tr>
<tr><th id="2009">2009</th><td><i> *		error = ret;</i></td></tr>
<tr><th id="2010">2010</th><td><i> *</i></td></tr>
<tr><th id="2011">2011</th><td><i> * This function "knows" that -ENOMEM has the bits set.</i></td></tr>
<tr><th id="2012">2012</th><td><i> */</i></td></tr>
<tr><th id="2013">2013</th><td><u>#<span data-ppcond="2013">ifndef</span> <a class="macro" href="../arch/x86/include/asm/pgtable_64.h.html#314" data-ref="_M/HAVE_ARCH_UNMAPPED_AREA">HAVE_ARCH_UNMAPPED_AREA</a></u></td></tr>
<tr><th id="2014">2014</th><td><em>unsigned</em> <em>long</em></td></tr>
<tr><th id="2015">2015</th><td>arch_get_unmapped_area(<b>struct</b> file *filp, <em>unsigned</em> <em>long</em> addr,</td></tr>
<tr><th id="2016">2016</th><td>		<em>unsigned</em> <em>long</em> len, <em>unsigned</em> <em>long</em> pgoff, <em>unsigned</em> <em>long</em> flags)</td></tr>
<tr><th id="2017">2017</th><td>{</td></tr>
<tr><th id="2018">2018</th><td>	<b>struct</b> mm_struct *mm = current-&gt;mm;</td></tr>
<tr><th id="2019">2019</th><td>	<b>struct</b> vm_area_struct *vma, *prev;</td></tr>
<tr><th id="2020">2020</th><td>	<b>struct</b> vm_unmapped_area_info info;</td></tr>
<tr><th id="2021">2021</th><td></td></tr>
<tr><th id="2022">2022</th><td>	<b>if</b> (len &gt; TASK_SIZE - mmap_min_addr)</td></tr>
<tr><th id="2023">2023</th><td>		<b>return</b> -ENOMEM;</td></tr>
<tr><th id="2024">2024</th><td></td></tr>
<tr><th id="2025">2025</th><td>	<b>if</b> (flags &amp; MAP_FIXED)</td></tr>
<tr><th id="2026">2026</th><td>		<b>return</b> addr;</td></tr>
<tr><th id="2027">2027</th><td></td></tr>
<tr><th id="2028">2028</th><td>	<b>if</b> (addr) {</td></tr>
<tr><th id="2029">2029</th><td>		addr = PAGE_ALIGN(addr);</td></tr>
<tr><th id="2030">2030</th><td>		vma = find_vma_prev(mm, addr, &amp;prev);</td></tr>
<tr><th id="2031">2031</th><td>		<b>if</b> (TASK_SIZE - len &gt;= addr &amp;&amp; addr &gt;= mmap_min_addr &amp;&amp;</td></tr>
<tr><th id="2032">2032</th><td>		    (!vma || addr + len &lt;= vm_start_gap(vma)) &amp;&amp;</td></tr>
<tr><th id="2033">2033</th><td>		    (!prev || addr &gt;= vm_end_gap(prev)))</td></tr>
<tr><th id="2034">2034</th><td>			<b>return</b> addr;</td></tr>
<tr><th id="2035">2035</th><td>	}</td></tr>
<tr><th id="2036">2036</th><td></td></tr>
<tr><th id="2037">2037</th><td>	info.flags = <var>0</var>;</td></tr>
<tr><th id="2038">2038</th><td>	info.length = len;</td></tr>
<tr><th id="2039">2039</th><td>	info.low_limit = mm-&gt;mmap_base;</td></tr>
<tr><th id="2040">2040</th><td>	info.high_limit = TASK_SIZE;</td></tr>
<tr><th id="2041">2041</th><td>	info.align_mask = <var>0</var>;</td></tr>
<tr><th id="2042">2042</th><td>	<b>return</b> vm_unmapped_area(&amp;info);</td></tr>
<tr><th id="2043">2043</th><td>}</td></tr>
<tr><th id="2044">2044</th><td><u>#<span data-ppcond="2013">endif</span></u></td></tr>
<tr><th id="2045">2045</th><td></td></tr>
<tr><th id="2046">2046</th><td><i>/*</i></td></tr>
<tr><th id="2047">2047</th><td><i> * This mmap-allocator allocates new areas top-down from below the</i></td></tr>
<tr><th id="2048">2048</th><td><i> * stack's low limit (the base):</i></td></tr>
<tr><th id="2049">2049</th><td><i> */</i></td></tr>
<tr><th id="2050">2050</th><td><u>#<span data-ppcond="2050">ifndef</span> <a class="macro" href="../arch/x86/include/asm/pgtable_64.h.html#315" data-ref="_M/HAVE_ARCH_UNMAPPED_AREA_TOPDOWN">HAVE_ARCH_UNMAPPED_AREA_TOPDOWN</a></u></td></tr>
<tr><th id="2051">2051</th><td><em>unsigned</em> <em>long</em></td></tr>
<tr><th id="2052">2052</th><td>arch_get_unmapped_area_topdown(<b>struct</b> file *filp, <em>const</em> <em>unsigned</em> <em>long</em> addr0,</td></tr>
<tr><th id="2053">2053</th><td>			  <em>const</em> <em>unsigned</em> <em>long</em> len, <em>const</em> <em>unsigned</em> <em>long</em> pgoff,</td></tr>
<tr><th id="2054">2054</th><td>			  <em>const</em> <em>unsigned</em> <em>long</em> flags)</td></tr>
<tr><th id="2055">2055</th><td>{</td></tr>
<tr><th id="2056">2056</th><td>	<b>struct</b> vm_area_struct *vma, *prev;</td></tr>
<tr><th id="2057">2057</th><td>	<b>struct</b> mm_struct *mm = current-&gt;mm;</td></tr>
<tr><th id="2058">2058</th><td>	<em>unsigned</em> <em>long</em> addr = addr0;</td></tr>
<tr><th id="2059">2059</th><td>	<b>struct</b> vm_unmapped_area_info info;</td></tr>
<tr><th id="2060">2060</th><td></td></tr>
<tr><th id="2061">2061</th><td>	<i>/* requested length too big for entire address space */</i></td></tr>
<tr><th id="2062">2062</th><td>	<b>if</b> (len &gt; TASK_SIZE - mmap_min_addr)</td></tr>
<tr><th id="2063">2063</th><td>		<b>return</b> -ENOMEM;</td></tr>
<tr><th id="2064">2064</th><td></td></tr>
<tr><th id="2065">2065</th><td>	<b>if</b> (flags &amp; MAP_FIXED)</td></tr>
<tr><th id="2066">2066</th><td>		<b>return</b> addr;</td></tr>
<tr><th id="2067">2067</th><td></td></tr>
<tr><th id="2068">2068</th><td>	<i>/* requesting a specific address */</i></td></tr>
<tr><th id="2069">2069</th><td>	<b>if</b> (addr) {</td></tr>
<tr><th id="2070">2070</th><td>		addr = PAGE_ALIGN(addr);</td></tr>
<tr><th id="2071">2071</th><td>		vma = find_vma_prev(mm, addr, &amp;prev);</td></tr>
<tr><th id="2072">2072</th><td>		<b>if</b> (TASK_SIZE - len &gt;= addr &amp;&amp; addr &gt;= mmap_min_addr &amp;&amp;</td></tr>
<tr><th id="2073">2073</th><td>				(!vma || addr + len &lt;= vm_start_gap(vma)) &amp;&amp;</td></tr>
<tr><th id="2074">2074</th><td>				(!prev || addr &gt;= vm_end_gap(prev)))</td></tr>
<tr><th id="2075">2075</th><td>			<b>return</b> addr;</td></tr>
<tr><th id="2076">2076</th><td>	}</td></tr>
<tr><th id="2077">2077</th><td></td></tr>
<tr><th id="2078">2078</th><td>	info.flags = VM_UNMAPPED_AREA_TOPDOWN;</td></tr>
<tr><th id="2079">2079</th><td>	info.length = len;</td></tr>
<tr><th id="2080">2080</th><td>	info.low_limit = max(PAGE_SIZE, mmap_min_addr);</td></tr>
<tr><th id="2081">2081</th><td>	info.high_limit = mm-&gt;mmap_base;</td></tr>
<tr><th id="2082">2082</th><td>	info.align_mask = <var>0</var>;</td></tr>
<tr><th id="2083">2083</th><td>	addr = vm_unmapped_area(&amp;info);</td></tr>
<tr><th id="2084">2084</th><td></td></tr>
<tr><th id="2085">2085</th><td>	<i>/*</i></td></tr>
<tr><th id="2086">2086</th><td><i>	 * A failed mmap() very likely causes application failure,</i></td></tr>
<tr><th id="2087">2087</th><td><i>	 * so fall back to the bottom-up function here. This scenario</i></td></tr>
<tr><th id="2088">2088</th><td><i>	 * can happen with large stack limits and large mmap()</i></td></tr>
<tr><th id="2089">2089</th><td><i>	 * allocations.</i></td></tr>
<tr><th id="2090">2090</th><td><i>	 */</i></td></tr>
<tr><th id="2091">2091</th><td>	<b>if</b> (offset_in_page(addr)) {</td></tr>
<tr><th id="2092">2092</th><td>		VM_BUG_ON(addr != -ENOMEM);</td></tr>
<tr><th id="2093">2093</th><td>		info.flags = <var>0</var>;</td></tr>
<tr><th id="2094">2094</th><td>		info.low_limit = TASK_UNMAPPED_BASE;</td></tr>
<tr><th id="2095">2095</th><td>		info.high_limit = TASK_SIZE;</td></tr>
<tr><th id="2096">2096</th><td>		addr = vm_unmapped_area(&amp;info);</td></tr>
<tr><th id="2097">2097</th><td>	}</td></tr>
<tr><th id="2098">2098</th><td></td></tr>
<tr><th id="2099">2099</th><td>	<b>return</b> addr;</td></tr>
<tr><th id="2100">2100</th><td>}</td></tr>
<tr><th id="2101">2101</th><td><u>#<span data-ppcond="2050">endif</span></u></td></tr>
<tr><th id="2102">2102</th><td></td></tr>
<tr><th id="2103">2103</th><td><em>unsigned</em> <em>long</em></td></tr>
<tr><th id="2104">2104</th><td><dfn class="decl def fn" id="get_unmapped_area" title='get_unmapped_area' data-ref="get_unmapped_area">get_unmapped_area</dfn>(<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col4 decl" id="284file" title='file' data-type='struct file *' data-ref="284file">file</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="285addr" title='addr' data-type='unsigned long' data-ref="285addr">addr</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="286len" title='len' data-type='unsigned long' data-ref="286len">len</dfn>,</td></tr>
<tr><th id="2105">2105</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="287pgoff" title='pgoff' data-type='unsigned long' data-ref="287pgoff">pgoff</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="288flags" title='flags' data-type='unsigned long' data-ref="288flags">flags</dfn>)</td></tr>
<tr><th id="2106">2106</th><td>{</td></tr>
<tr><th id="2107">2107</th><td>	<em>unsigned</em> <em>long</em> (*<dfn class="local col9 decl" id="289get_area" title='get_area' data-type='unsigned long (*)(struct file *, unsigned long, unsigned long, unsigned long, unsigned long)' data-ref="289get_area">get_area</dfn>)(<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *, <em>unsigned</em> <em>long</em>,</td></tr>
<tr><th id="2108">2108</th><td>				  <em>unsigned</em> <em>long</em>, <em>unsigned</em> <em>long</em>, <em>unsigned</em> <em>long</em>);</td></tr>
<tr><th id="2109">2109</th><td></td></tr>
<tr><th id="2110">2110</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="290error" title='error' data-type='unsigned long' data-ref="290error">error</dfn> = <a class="macro" href="#57" title="(0)" data-ref="_M/arch_mmap_check">arch_mmap_check</a>(addr, len, flags);</td></tr>
<tr><th id="2111">2111</th><td>	<b>if</b> (<a class="local col0 ref" href="#290error" title='error' data-ref="290error">error</a>)</td></tr>
<tr><th id="2112">2112</th><td>		<b>return</b> <a class="local col0 ref" href="#290error" title='error' data-ref="290error">error</a>;</td></tr>
<tr><th id="2113">2113</th><td></td></tr>
<tr><th id="2114">2114</th><td>	<i>/* Careful about overflows.. */</i></td></tr>
<tr><th id="2115">2115</th><td>	<b>if</b> (<a class="local col6 ref" href="#286len" title='len' data-ref="286len">len</a> &gt; <a class="macro" href="../arch/x86/include/asm/processor.h.html#881" title="(test_ti_thread_flag(((struct thread_info *)get_current()), 29) ? ((get_current()-&gt;personality &amp; ADDR_LIMIT_3GB) ? 0xc0000000 : 0xFFFFe000) : ((1UL &lt;&lt; 47) - ((1UL) &lt;&lt; 12)))" data-ref="_M/TASK_SIZE">TASK_SIZE</a>)</td></tr>
<tr><th id="2116">2116</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2117">2117</th><td></td></tr>
<tr><th id="2118">2118</th><td>	<a class="local col9 ref" href="#289get_area" title='get_area' data-ref="289get_area">get_area</a> = <a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::mm" title='task_struct::mm' data-ref="task_struct::mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::get_unmapped_area" title='mm_struct::get_unmapped_area' data-ref="mm_struct::get_unmapped_area">get_unmapped_area</a>;</td></tr>
<tr><th id="2119">2119</th><td>	<b>if</b> (<a class="local col4 ref" href="#284file" title='file' data-ref="284file">file</a>) {</td></tr>
<tr><th id="2120">2120</th><td>		<b>if</b> (<a class="local col4 ref" href="#284file" title='file' data-ref="284file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_op" title='file::f_op' data-ref="file::f_op">f_op</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file_operations::get_unmapped_area" title='file_operations::get_unmapped_area' data-ref="file_operations::get_unmapped_area">get_unmapped_area</a>)</td></tr>
<tr><th id="2121">2121</th><td>			<a class="local col9 ref" href="#289get_area" title='get_area' data-ref="289get_area">get_area</a> = <a class="local col4 ref" href="#284file" title='file' data-ref="284file">file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_op" title='file::f_op' data-ref="file::f_op">f_op</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file_operations::get_unmapped_area" title='file_operations::get_unmapped_area' data-ref="file_operations::get_unmapped_area">get_unmapped_area</a>;</td></tr>
<tr><th id="2122">2122</th><td>	} <b>else</b> <b>if</b> (<a class="local col8 ref" href="#288flags" title='flags' data-ref="288flags">flags</a> &amp; <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#18" title="0x01" data-ref="_M/MAP_SHARED">MAP_SHARED</a>) {</td></tr>
<tr><th id="2123">2123</th><td>		<i>/*</i></td></tr>
<tr><th id="2124">2124</th><td><i>		 * mmap_region() will call shmem_zero_setup() to create a file,</i></td></tr>
<tr><th id="2125">2125</th><td><i>		 * so use shmem's get_unmapped_area in case it can be huge.</i></td></tr>
<tr><th id="2126">2126</th><td><i>		 * do_mmap_pgoff() will clear pgoff, so match alignment.</i></td></tr>
<tr><th id="2127">2127</th><td><i>		 */</i></td></tr>
<tr><th id="2128">2128</th><td>		<a class="local col7 ref" href="#287pgoff" title='pgoff' data-ref="287pgoff">pgoff</a> = <var>0</var>;</td></tr>
<tr><th id="2129">2129</th><td>		<a class="local col9 ref" href="#289get_area" title='get_area' data-ref="289get_area">get_area</a> = <a class="ref fn" href="../include/linux/shmem_fs.h.html#shmem_get_unmapped_area" title='shmem_get_unmapped_area' data-ref="shmem_get_unmapped_area">shmem_get_unmapped_area</a>;</td></tr>
<tr><th id="2130">2130</th><td>	}</td></tr>
<tr><th id="2131">2131</th><td></td></tr>
<tr><th id="2132">2132</th><td>	<a class="local col5 ref" href="#285addr" title='addr' data-ref="285addr">addr</a> = <a class="local col9 ref" href="#289get_area" title='get_area' data-ref="289get_area">get_area</a>(<a class="local col4 ref" href="#284file" title='file' data-ref="284file">file</a>, <a class="local col5 ref" href="#285addr" title='addr' data-ref="285addr">addr</a>, <a class="local col6 ref" href="#286len" title='len' data-ref="286len">len</a>, <a class="local col7 ref" href="#287pgoff" title='pgoff' data-ref="287pgoff">pgoff</a>, <a class="local col8 ref" href="#288flags" title='flags' data-ref="288flags">flags</a>);</td></tr>
<tr><th id="2133">2133</th><td>	<b>if</b> (<a class="macro" href="../include/linux/err.h.html#22" title="__builtin_expect(!!((unsigned long)(void *)(addr) &gt;= (unsigned long)-4095), 0)" data-ref="_M/IS_ERR_VALUE">IS_ERR_VALUE</a>(<a class="local col5 ref" href="#285addr" title='addr' data-ref="285addr">addr</a>))</td></tr>
<tr><th id="2134">2134</th><td>		<b>return</b> <a class="local col5 ref" href="#285addr" title='addr' data-ref="285addr">addr</a>;</td></tr>
<tr><th id="2135">2135</th><td></td></tr>
<tr><th id="2136">2136</th><td>	<b>if</b> (<a class="local col5 ref" href="#285addr" title='addr' data-ref="285addr">addr</a> &gt; <a class="macro" href="../arch/x86/include/asm/processor.h.html#881" title="(test_ti_thread_flag(((struct thread_info *)get_current()), 29) ? ((get_current()-&gt;personality &amp; ADDR_LIMIT_3GB) ? 0xc0000000 : 0xFFFFe000) : ((1UL &lt;&lt; 47) - ((1UL) &lt;&lt; 12)))" data-ref="_M/TASK_SIZE">TASK_SIZE</a> - <a class="local col6 ref" href="#286len" title='len' data-ref="286len">len</a>)</td></tr>
<tr><th id="2137">2137</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2138">2138</th><td>	<b>if</b> (<a class="macro" href="../include/linux/mm.h.html#1216" title="((unsigned long)(addr) &amp; ~(~(((1UL) &lt;&lt; 12)-1)))" data-ref="_M/offset_in_page">offset_in_page</a>(<a class="local col5 ref" href="#285addr" title='addr' data-ref="285addr">addr</a>))</td></tr>
<tr><th id="2139">2139</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2140">2140</th><td></td></tr>
<tr><th id="2141">2141</th><td>	<a class="local col0 ref" href="#290error" title='error' data-ref="290error">error</a> = <a class="ref fn" href="../include/linux/security.h.html#security_mmap_addr" title='security_mmap_addr' data-ref="security_mmap_addr">security_mmap_addr</a>(<a class="local col5 ref" href="#285addr" title='addr' data-ref="285addr">addr</a>);</td></tr>
<tr><th id="2142">2142</th><td>	<b>return</b> <a class="local col0 ref" href="#290error" title='error' data-ref="290error">error</a> ? <a class="local col0 ref" href="#290error" title='error' data-ref="290error">error</a> : <a class="local col5 ref" href="#285addr" title='addr' data-ref="285addr">addr</a>;</td></tr>
<tr><th id="2143">2143</th><td>}</td></tr>
<tr><th id="2144">2144</th><td></td></tr>
<tr><th id="2145">2145</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(get_unmapped_area) get_unmapped_area; static const char __kstrtab_get_unmapped_area[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;get_unmapped_area&quot;; static const struct kernel_symbol __ksymtab_get_unmapped_area __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;get_unmapped_area&quot;), used)) = { (unsigned long)&amp;get_unmapped_area, __kstrtab_get_unmapped_area }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#get_unmapped_area" title='get_unmapped_area' data-ref="get_unmapped_area"><a class="ref fn" href="#get_unmapped_area" title='get_unmapped_area' data-ref="get_unmapped_area"><a class="ref fn" href="#get_unmapped_area" title='get_unmapped_area' data-ref="get_unmapped_area"><a class="ref fn" href="#get_unmapped_area" title='get_unmapped_area' data-ref="get_unmapped_area">get_unmapped_area</a></a></a></a>);</td></tr>
<tr><th id="2146">2146</th><td></td></tr>
<tr><th id="2147">2147</th><td><i>/* Look up the first VMA which satisfies  addr &lt; vm_end,  NULL if none. */</i></td></tr>
<tr><th id="2148">2148</th><td><b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="decl def fn" id="find_vma" title='find_vma' data-ref="find_vma">find_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col1 decl" id="291mm" title='mm' data-type='struct mm_struct *' data-ref="291mm">mm</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col2 decl" id="292addr" title='addr' data-type='unsigned long' data-ref="292addr">addr</dfn>)</td></tr>
<tr><th id="2149">2149</th><td>{</td></tr>
<tr><th id="2150">2150</th><td>	<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> *<dfn class="local col3 decl" id="293rb_node" title='rb_node' data-type='struct rb_node *' data-ref="293rb_node">rb_node</dfn>;</td></tr>
<tr><th id="2151">2151</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col4 decl" id="294vma" title='vma' data-type='struct vm_area_struct *' data-ref="294vma">vma</dfn>;</td></tr>
<tr><th id="2152">2152</th><td></td></tr>
<tr><th id="2153">2153</th><td>	<i>/* Check the cache first. */</i></td></tr>
<tr><th id="2154">2154</th><td>	<a class="local col4 ref" href="#294vma" title='vma' data-ref="294vma">vma</a> = <a class="ref fn" href="../include/linux/vmacache.h.html#vmacache_find" title='vmacache_find' data-ref="vmacache_find">vmacache_find</a>(<a class="local col1 ref" href="#291mm" title='mm' data-ref="291mm">mm</a>, <a class="local col2 ref" href="#292addr" title='addr' data-ref="292addr">addr</a>);</td></tr>
<tr><th id="2155">2155</th><td>	<b>if</b> (<a class="macro" href="../include/linux/compiler.h.html#76" title="__builtin_expect(!!(vma), 1)" data-ref="_M/likely">likely</a>(<a class="local col4 ref" href="#294vma" title='vma' data-ref="294vma">vma</a>))</td></tr>
<tr><th id="2156">2156</th><td>		<b>return</b> <a class="local col4 ref" href="#294vma" title='vma' data-ref="294vma">vma</a>;</td></tr>
<tr><th id="2157">2157</th><td></td></tr>
<tr><th id="2158">2158</th><td>	<a class="local col3 ref" href="#293rb_node" title='rb_node' data-ref="293rb_node">rb_node</a> = <a class="local col1 ref" href="#291mm" title='mm' data-ref="291mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mm_rb" title='mm_struct::mm_rb' data-ref="mm_struct::mm_rb">mm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root::rb_node" title='rb_root::rb_node' data-ref="rb_root::rb_node">rb_node</a>;</td></tr>
<tr><th id="2159">2159</th><td></td></tr>
<tr><th id="2160">2160</th><td>	<b>while</b> (<a class="local col3 ref" href="#293rb_node" title='rb_node' data-ref="293rb_node">rb_node</a>) {</td></tr>
<tr><th id="2161">2161</th><td>		<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col5 decl" id="295tmp" title='tmp' data-type='struct vm_area_struct *' data-ref="295tmp">tmp</dfn>;</td></tr>
<tr><th id="2162">2162</th><td></td></tr>
<tr><th id="2163">2163</th><td>		<a class="local col5 ref" href="#295tmp" title='tmp' data-ref="295tmp">tmp</a> = <a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(rb_node); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(rb_node)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(rb_node)), typeof(void)))); extern void __compiletime_assert_2163(void) ; if (__cond) __compiletime_assert_2163(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="local col3 ref" href="#293rb_node" title='rb_node' data-ref="293rb_node">rb_node</a>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>);</td></tr>
<tr><th id="2164">2164</th><td></td></tr>
<tr><th id="2165">2165</th><td>		<b>if</b> (<a class="local col5 ref" href="#295tmp" title='tmp' data-ref="295tmp">tmp</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> &gt; <a class="local col2 ref" href="#292addr" title='addr' data-ref="292addr">addr</a>) {</td></tr>
<tr><th id="2166">2166</th><td>			<a class="local col4 ref" href="#294vma" title='vma' data-ref="294vma">vma</a> = <a class="local col5 ref" href="#295tmp" title='tmp' data-ref="295tmp">tmp</a>;</td></tr>
<tr><th id="2167">2167</th><td>			<b>if</b> (<a class="local col5 ref" href="#295tmp" title='tmp' data-ref="295tmp">tmp</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &lt;= <a class="local col2 ref" href="#292addr" title='addr' data-ref="292addr">addr</a>)</td></tr>
<tr><th id="2168">2168</th><td>				<b>break</b>;</td></tr>
<tr><th id="2169">2169</th><td>			<a class="local col3 ref" href="#293rb_node" title='rb_node' data-ref="293rb_node">rb_node</a> = <a class="local col3 ref" href="#293rb_node" title='rb_node' data-ref="293rb_node">rb_node</a>-&gt;<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_left" title='rb_node::rb_left' data-ref="rb_node::rb_left">rb_left</a>;</td></tr>
<tr><th id="2170">2170</th><td>		} <b>else</b></td></tr>
<tr><th id="2171">2171</th><td>			<a class="local col3 ref" href="#293rb_node" title='rb_node' data-ref="293rb_node">rb_node</a> = <a class="local col3 ref" href="#293rb_node" title='rb_node' data-ref="293rb_node">rb_node</a>-&gt;<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_right" title='rb_node::rb_right' data-ref="rb_node::rb_right">rb_right</a>;</td></tr>
<tr><th id="2172">2172</th><td>	}</td></tr>
<tr><th id="2173">2173</th><td></td></tr>
<tr><th id="2174">2174</th><td>	<b>if</b> (<a class="local col4 ref" href="#294vma" title='vma' data-ref="294vma">vma</a>)</td></tr>
<tr><th id="2175">2175</th><td>		<a class="ref fn" href="../include/linux/vmacache.h.html#vmacache_update" title='vmacache_update' data-ref="vmacache_update">vmacache_update</a>(<a class="local col2 ref" href="#292addr" title='addr' data-ref="292addr">addr</a>, <a class="local col4 ref" href="#294vma" title='vma' data-ref="294vma">vma</a>);</td></tr>
<tr><th id="2176">2176</th><td>	<b>return</b> <a class="local col4 ref" href="#294vma" title='vma' data-ref="294vma">vma</a>;</td></tr>
<tr><th id="2177">2177</th><td>}</td></tr>
<tr><th id="2178">2178</th><td></td></tr>
<tr><th id="2179">2179</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(find_vma) find_vma; static const char __kstrtab_find_vma[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;find_vma&quot;; static const struct kernel_symbol __ksymtab_find_vma __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;find_vma&quot;), used)) = { (unsigned long)&amp;find_vma, __kstrtab_find_vma }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#find_vma" title='find_vma' data-ref="find_vma"><a class="ref fn" href="#find_vma" title='find_vma' data-ref="find_vma"><a class="ref fn" href="#find_vma" title='find_vma' data-ref="find_vma"><a class="ref fn" href="#find_vma" title='find_vma' data-ref="find_vma">find_vma</a></a></a></a>);</td></tr>
<tr><th id="2180">2180</th><td></td></tr>
<tr><th id="2181">2181</th><td><i>/*</i></td></tr>
<tr><th id="2182">2182</th><td><i> * Same as find_vma, but also return a pointer to the previous VMA in *pprev.</i></td></tr>
<tr><th id="2183">2183</th><td><i> */</i></td></tr>
<tr><th id="2184">2184</th><td><b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *</td></tr>
<tr><th id="2185">2185</th><td><dfn class="decl def fn" id="find_vma_prev" title='find_vma_prev' data-ref="find_vma_prev">find_vma_prev</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col6 decl" id="296mm" title='mm' data-type='struct mm_struct *' data-ref="296mm">mm</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="297addr" title='addr' data-type='unsigned long' data-ref="297addr">addr</dfn>,</td></tr>
<tr><th id="2186">2186</th><td>			<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> **<dfn class="local col8 decl" id="298pprev" title='pprev' data-type='struct vm_area_struct **' data-ref="298pprev">pprev</dfn>)</td></tr>
<tr><th id="2187">2187</th><td>{</td></tr>
<tr><th id="2188">2188</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col9 decl" id="299vma" title='vma' data-type='struct vm_area_struct *' data-ref="299vma">vma</dfn>;</td></tr>
<tr><th id="2189">2189</th><td></td></tr>
<tr><th id="2190">2190</th><td>	<a class="local col9 ref" href="#299vma" title='vma' data-ref="299vma">vma</a> = <a class="ref fn" href="#find_vma" title='find_vma' data-ref="find_vma">find_vma</a>(<a class="local col6 ref" href="#296mm" title='mm' data-ref="296mm">mm</a>, <a class="local col7 ref" href="#297addr" title='addr' data-ref="297addr">addr</a>);</td></tr>
<tr><th id="2191">2191</th><td>	<b>if</b> (<a class="local col9 ref" href="#299vma" title='vma' data-ref="299vma">vma</a>) {</td></tr>
<tr><th id="2192">2192</th><td>		*<a class="local col8 ref" href="#298pprev" title='pprev' data-ref="298pprev">pprev</a> = <a class="local col9 ref" href="#299vma" title='vma' data-ref="299vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a>;</td></tr>
<tr><th id="2193">2193</th><td>	} <b>else</b> {</td></tr>
<tr><th id="2194">2194</th><td>		<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> *<dfn class="local col0 decl" id="300rb_node" title='rb_node' data-type='struct rb_node *' data-ref="300rb_node">rb_node</dfn> = <a class="local col6 ref" href="#296mm" title='mm' data-ref="296mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mm_rb" title='mm_struct::mm_rb' data-ref="mm_struct::mm_rb">mm_rb</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root::rb_node" title='rb_root::rb_node' data-ref="rb_root::rb_node">rb_node</a>;</td></tr>
<tr><th id="2195">2195</th><td>		*<a class="local col8 ref" href="#298pprev" title='pprev' data-ref="298pprev">pprev</a> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="2196">2196</th><td>		<b>while</b> (<a class="local col0 ref" href="#300rb_node" title='rb_node' data-ref="300rb_node">rb_node</a>) {</td></tr>
<tr><th id="2197">2197</th><td>			*<a class="local col8 ref" href="#298pprev" title='pprev' data-ref="298pprev">pprev</a> = <a class="macro" href="../include/linux/rbtree.h.html#66" title="({ void *__mptr = (void *)(rb_node); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(rb_node)), typeof(((struct vm_area_struct *)0)-&gt;vm_rb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(rb_node)), typeof(void)))); extern void __compiletime_assert_2197(void) ; if (__cond) __compiletime_assert_2197(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vm_area_struct *)(__mptr - __builtin_offsetof(struct vm_area_struct, vm_rb))); })" data-ref="_M/rb_entry">rb_entry</a>(<a class="local col0 ref" href="#300rb_node" title='rb_node' data-ref="300rb_node">rb_node</a>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a>, <a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_rb" title='vm_area_struct::vm_rb' data-ref="vm_area_struct::vm_rb">vm_rb</a>);</td></tr>
<tr><th id="2198">2198</th><td>			<a class="local col0 ref" href="#300rb_node" title='rb_node' data-ref="300rb_node">rb_node</a> = <a class="local col0 ref" href="#300rb_node" title='rb_node' data-ref="300rb_node">rb_node</a>-&gt;<a class="ref field" href="../include/linux/rbtree.h.html#rb_node::rb_right" title='rb_node::rb_right' data-ref="rb_node::rb_right">rb_right</a>;</td></tr>
<tr><th id="2199">2199</th><td>		}</td></tr>
<tr><th id="2200">2200</th><td>	}</td></tr>
<tr><th id="2201">2201</th><td>	<b>return</b> <a class="local col9 ref" href="#299vma" title='vma' data-ref="299vma">vma</a>;</td></tr>
<tr><th id="2202">2202</th><td>}</td></tr>
<tr><th id="2203">2203</th><td></td></tr>
<tr><th id="2204">2204</th><td><i  data-doc="acct_stack_growth">/*</i></td></tr>
<tr><th id="2205">2205</th><td><i  data-doc="acct_stack_growth"> * Verify that the stack growth is acceptable and</i></td></tr>
<tr><th id="2206">2206</th><td><i  data-doc="acct_stack_growth"> * update accounting. This is shared with both the</i></td></tr>
<tr><th id="2207">2207</th><td><i  data-doc="acct_stack_growth"> * grow-up and grow-down cases.</i></td></tr>
<tr><th id="2208">2208</th><td><i  data-doc="acct_stack_growth"> */</i></td></tr>
<tr><th id="2209">2209</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="acct_stack_growth" title='acct_stack_growth' data-type='int acct_stack_growth(struct vm_area_struct * vma, unsigned long size, unsigned long grow)' data-ref="acct_stack_growth">acct_stack_growth</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col1 decl" id="301vma" title='vma' data-type='struct vm_area_struct *' data-ref="301vma">vma</dfn>,</td></tr>
<tr><th id="2210">2210</th><td>			     <em>unsigned</em> <em>long</em> <dfn class="local col2 decl" id="302size" title='size' data-type='unsigned long' data-ref="302size">size</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col3 decl" id="303grow" title='grow' data-type='unsigned long' data-ref="303grow">grow</dfn>)</td></tr>
<tr><th id="2211">2211</th><td>{</td></tr>
<tr><th id="2212">2212</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col4 decl" id="304mm" title='mm' data-type='struct mm_struct *' data-ref="304mm">mm</dfn> = <a class="local col1 ref" href="#301vma" title='vma' data-ref="301vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_mm" title='vm_area_struct::vm_mm' data-ref="vm_area_struct::vm_mm">vm_mm</a>;</td></tr>
<tr><th id="2213">2213</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="305new_start" title='new_start' data-type='unsigned long' data-ref="305new_start">new_start</dfn>;</td></tr>
<tr><th id="2214">2214</th><td></td></tr>
<tr><th id="2215">2215</th><td>	<i>/* address space limit tests */</i></td></tr>
<tr><th id="2216">2216</th><td>	<b>if</b> (!<a class="ref fn" href="#may_expand_vm" title='may_expand_vm' data-ref="may_expand_vm">may_expand_vm</a>(<a class="local col4 ref" href="#304mm" title='mm' data-ref="304mm">mm</a>, <a class="local col1 ref" href="#301vma" title='vma' data-ref="301vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a>, <a class="local col3 ref" href="#303grow" title='grow' data-ref="303grow">grow</a>))</td></tr>
<tr><th id="2217">2217</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2218">2218</th><td></td></tr>
<tr><th id="2219">2219</th><td>	<i>/* Stack limit test */</i></td></tr>
<tr><th id="2220">2220</th><td>	<b>if</b> (<a class="local col2 ref" href="#302size" title='size' data-ref="302size">size</a> &gt; <a class="ref fn" href="../include/linux/sched/signal.h.html#rlimit" title='rlimit' data-ref="rlimit">rlimit</a>(<a class="macro" href="../include/uapi/asm-generic/resource.h.html#19" title="3" data-ref="_M/RLIMIT_STACK">RLIMIT_STACK</a>))</td></tr>
<tr><th id="2221">2221</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2222">2222</th><td></td></tr>
<tr><th id="2223">2223</th><td>	<i>/* mlock limit tests */</i></td></tr>
<tr><th id="2224">2224</th><td>	<b>if</b> (<a class="local col1 ref" href="#301vma" title='vma' data-ref="301vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#180" title="0x00002000" data-ref="_M/VM_LOCKED">VM_LOCKED</a>) {</td></tr>
<tr><th id="2225">2225</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="306locked" title='locked' data-type='unsigned long' data-ref="306locked">locked</dfn>;</td></tr>
<tr><th id="2226">2226</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="307limit" title='limit' data-type='unsigned long' data-ref="307limit">limit</dfn>;</td></tr>
<tr><th id="2227">2227</th><td>		<a class="local col6 ref" href="#306locked" title='locked' data-ref="306locked">locked</a> = <a class="local col4 ref" href="#304mm" title='mm' data-ref="304mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::locked_vm" title='mm_struct::locked_vm' data-ref="mm_struct::locked_vm">locked_vm</a> + <a class="local col3 ref" href="#303grow" title='grow' data-ref="303grow">grow</a>;</td></tr>
<tr><th id="2228">2228</th><td>		<a class="local col7 ref" href="#307limit" title='limit' data-ref="307limit">limit</a> = <a class="ref fn" href="../include/linux/sched/signal.h.html#rlimit" title='rlimit' data-ref="rlimit">rlimit</a>(<a class="macro" href="../include/uapi/asm-generic/resource.h.html#35" title="8" data-ref="_M/RLIMIT_MEMLOCK">RLIMIT_MEMLOCK</a>);</td></tr>
<tr><th id="2229">2229</th><td>		<a class="local col7 ref" href="#307limit" title='limit' data-ref="307limit">limit</a> &gt;&gt;= <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2230">2230</th><td>		<b>if</b> (<a class="local col6 ref" href="#306locked" title='locked' data-ref="306locked">locked</a> &gt; <a class="local col7 ref" href="#307limit" title='limit' data-ref="307limit">limit</a> &amp;&amp; !<a class="ref fn" href="../include/linux/capability.h.html#capable" title='capable' data-ref="capable">capable</a>(<a class="macro" href="../include/uapi/linux/capability.h.html#215" title="14" data-ref="_M/CAP_IPC_LOCK">CAP_IPC_LOCK</a>))</td></tr>
<tr><th id="2231">2231</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2232">2232</th><td>	}</td></tr>
<tr><th id="2233">2233</th><td></td></tr>
<tr><th id="2234">2234</th><td>	<i>/* Check to ensure the stack will not grow into a hugetlb-only region */</i></td></tr>
<tr><th id="2235">2235</th><td>	<a class="local col5 ref" href="#305new_start" title='new_start' data-ref="305new_start">new_start</a> = (<a class="local col1 ref" href="#301vma" title='vma' data-ref="301vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#250" title="0x00000000" data-ref="_M/VM_GROWSUP">VM_GROWSUP</a>) ? <a class="local col1 ref" href="#301vma" title='vma' data-ref="301vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> :</td></tr>
<tr><th id="2236">2236</th><td>			<a class="local col1 ref" href="#301vma" title='vma' data-ref="301vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> - <a class="local col2 ref" href="#302size" title='size' data-ref="302size">size</a>;</td></tr>
<tr><th id="2237">2237</th><td>	<b>if</b> (<a class="ref fn" href="../arch/x86/include/asm/hugetlb.h.html#is_hugepage_only_range" title='is_hugepage_only_range' data-ref="is_hugepage_only_range">is_hugepage_only_range</a>(<a class="local col1 ref" href="#301vma" title='vma' data-ref="301vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_mm" title='vm_area_struct::vm_mm' data-ref="vm_area_struct::vm_mm">vm_mm</a>, <a class="local col5 ref" href="#305new_start" title='new_start' data-ref="305new_start">new_start</a>, <a class="local col2 ref" href="#302size" title='size' data-ref="302size">size</a>))</td></tr>
<tr><th id="2238">2238</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="2239">2239</th><td></td></tr>
<tr><th id="2240">2240</th><td>	<i>/*</i></td></tr>
<tr><th id="2241">2241</th><td><i>	 * Overcommit..  This must be the final test, as it will</i></td></tr>
<tr><th id="2242">2242</th><td><i>	 * update security statistics.</i></td></tr>
<tr><th id="2243">2243</th><td><i>	 */</i></td></tr>
<tr><th id="2244">2244</th><td>	<b>if</b> (<a class="ref fn" href="../include/linux/security.h.html#security_vm_enough_memory_mm" title='security_vm_enough_memory_mm' data-ref="security_vm_enough_memory_mm">security_vm_enough_memory_mm</a>(<a class="local col4 ref" href="#304mm" title='mm' data-ref="304mm">mm</a>, <a class="local col3 ref" href="#303grow" title='grow' data-ref="303grow">grow</a>))</td></tr>
<tr><th id="2245">2245</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2246">2246</th><td></td></tr>
<tr><th id="2247">2247</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2248">2248</th><td>}</td></tr>
<tr><th id="2249">2249</th><td></td></tr>
<tr><th id="2250">2250</th><td><u>#<span data-ppcond="2250">if</span> defined(<span class="macro" data-ref="_M/CONFIG_STACK_GROWSUP">CONFIG_STACK_GROWSUP</span>) || defined(<span class="macro" data-ref="_M/CONFIG_IA64">CONFIG_IA64</span>)</u></td></tr>
<tr><th id="2251">2251</th><td><i>/*</i></td></tr>
<tr><th id="2252">2252</th><td><i> * PA-RISC uses this for its stack; IA64 for its Register Backing Store.</i></td></tr>
<tr><th id="2253">2253</th><td><i> * vma is the last one with address &gt; vma-&gt;vm_end.  Have to extend vma.</i></td></tr>
<tr><th id="2254">2254</th><td><i> */</i></td></tr>
<tr><th id="2255">2255</th><td><em>int</em> expand_upwards(<b>struct</b> vm_area_struct *vma, <em>unsigned</em> <em>long</em> address)</td></tr>
<tr><th id="2256">2256</th><td>{</td></tr>
<tr><th id="2257">2257</th><td>	<b>struct</b> mm_struct *mm = vma-&gt;vm_mm;</td></tr>
<tr><th id="2258">2258</th><td>	<b>struct</b> vm_area_struct *next;</td></tr>
<tr><th id="2259">2259</th><td>	<em>unsigned</em> <em>long</em> gap_addr;</td></tr>
<tr><th id="2260">2260</th><td>	<em>int</em> error = <var>0</var>;</td></tr>
<tr><th id="2261">2261</th><td></td></tr>
<tr><th id="2262">2262</th><td>	<b>if</b> (!(vma-&gt;vm_flags &amp; VM_GROWSUP))</td></tr>
<tr><th id="2263">2263</th><td>		<b>return</b> -EFAULT;</td></tr>
<tr><th id="2264">2264</th><td></td></tr>
<tr><th id="2265">2265</th><td>	<i>/* Guard against exceeding limits of the address space. */</i></td></tr>
<tr><th id="2266">2266</th><td>	address &amp;= PAGE_MASK;</td></tr>
<tr><th id="2267">2267</th><td>	<b>if</b> (address &gt;= (TASK_SIZE &amp; PAGE_MASK))</td></tr>
<tr><th id="2268">2268</th><td>		<b>return</b> -ENOMEM;</td></tr>
<tr><th id="2269">2269</th><td>	address += PAGE_SIZE;</td></tr>
<tr><th id="2270">2270</th><td></td></tr>
<tr><th id="2271">2271</th><td>	<i>/* Enforce stack_guard_gap */</i></td></tr>
<tr><th id="2272">2272</th><td>	gap_addr = address + stack_guard_gap;</td></tr>
<tr><th id="2273">2273</th><td></td></tr>
<tr><th id="2274">2274</th><td>	<i>/* Guard against overflow */</i></td></tr>
<tr><th id="2275">2275</th><td>	<b>if</b> (gap_addr &lt; address || gap_addr &gt; TASK_SIZE)</td></tr>
<tr><th id="2276">2276</th><td>		gap_addr = TASK_SIZE;</td></tr>
<tr><th id="2277">2277</th><td></td></tr>
<tr><th id="2278">2278</th><td>	next = vma-&gt;vm_next;</td></tr>
<tr><th id="2279">2279</th><td>	<b>if</b> (next &amp;&amp; next-&gt;vm_start &lt; gap_addr &amp;&amp;</td></tr>
<tr><th id="2280">2280</th><td>			(next-&gt;vm_flags &amp; (VM_WRITE|VM_READ|VM_EXEC))) {</td></tr>
<tr><th id="2281">2281</th><td>		<b>if</b> (!(next-&gt;vm_flags &amp; VM_GROWSUP))</td></tr>
<tr><th id="2282">2282</th><td>			<b>return</b> -ENOMEM;</td></tr>
<tr><th id="2283">2283</th><td>		<i>/* Check that both stack segments have the same anon_vma? */</i></td></tr>
<tr><th id="2284">2284</th><td>	}</td></tr>
<tr><th id="2285">2285</th><td></td></tr>
<tr><th id="2286">2286</th><td>	<i>/* We must make sure the anon_vma is allocated. */</i></td></tr>
<tr><th id="2287">2287</th><td>	<b>if</b> (unlikely(anon_vma_prepare(vma)))</td></tr>
<tr><th id="2288">2288</th><td>		<b>return</b> -ENOMEM;</td></tr>
<tr><th id="2289">2289</th><td></td></tr>
<tr><th id="2290">2290</th><td>	<i>/*</i></td></tr>
<tr><th id="2291">2291</th><td><i>	 * vma-&gt;vm_start/vm_end cannot change under us because the caller</i></td></tr>
<tr><th id="2292">2292</th><td><i>	 * is required to hold the mmap_sem in read mode.  We need the</i></td></tr>
<tr><th id="2293">2293</th><td><i>	 * anon_vma lock to serialize against concurrent expand_stacks.</i></td></tr>
<tr><th id="2294">2294</th><td><i>	 */</i></td></tr>
<tr><th id="2295">2295</th><td>	anon_vma_lock_write(vma-&gt;anon_vma);</td></tr>
<tr><th id="2296">2296</th><td></td></tr>
<tr><th id="2297">2297</th><td>	<i>/* Somebody else might have raced and expanded it already */</i></td></tr>
<tr><th id="2298">2298</th><td>	<b>if</b> (address &gt; vma-&gt;vm_end) {</td></tr>
<tr><th id="2299">2299</th><td>		<em>unsigned</em> <em>long</em> size, grow;</td></tr>
<tr><th id="2300">2300</th><td></td></tr>
<tr><th id="2301">2301</th><td>		size = address - vma-&gt;vm_start;</td></tr>
<tr><th id="2302">2302</th><td>		grow = (address - vma-&gt;vm_end) &gt;&gt; PAGE_SHIFT;</td></tr>
<tr><th id="2303">2303</th><td></td></tr>
<tr><th id="2304">2304</th><td>		error = -ENOMEM;</td></tr>
<tr><th id="2305">2305</th><td>		<b>if</b> (vma-&gt;vm_pgoff + (size &gt;&gt; PAGE_SHIFT) &gt;= vma-&gt;vm_pgoff) {</td></tr>
<tr><th id="2306">2306</th><td>			error = acct_stack_growth(vma, size, grow);</td></tr>
<tr><th id="2307">2307</th><td>			<b>if</b> (!error) {</td></tr>
<tr><th id="2308">2308</th><td>				<i>/*</i></td></tr>
<tr><th id="2309">2309</th><td><i>				 * vma_gap_update() doesn't support concurrent</i></td></tr>
<tr><th id="2310">2310</th><td><i>				 * updates, but we only hold a shared mmap_sem</i></td></tr>
<tr><th id="2311">2311</th><td><i>				 * lock here, so we need to protect against</i></td></tr>
<tr><th id="2312">2312</th><td><i>				 * concurrent vma expansions.</i></td></tr>
<tr><th id="2313">2313</th><td><i>				 * anon_vma_lock_write() doesn't help here, as</i></td></tr>
<tr><th id="2314">2314</th><td><i>				 * we don't guarantee that all growable vmas</i></td></tr>
<tr><th id="2315">2315</th><td><i>				 * in a mm share the same root anon vma.</i></td></tr>
<tr><th id="2316">2316</th><td><i>				 * So, we reuse mm-&gt;page_table_lock to guard</i></td></tr>
<tr><th id="2317">2317</th><td><i>				 * against concurrent vma expansions.</i></td></tr>
<tr><th id="2318">2318</th><td><i>				 */</i></td></tr>
<tr><th id="2319">2319</th><td>				spin_lock(&amp;mm-&gt;page_table_lock);</td></tr>
<tr><th id="2320">2320</th><td>				<b>if</b> (vma-&gt;vm_flags &amp; VM_LOCKED)</td></tr>
<tr><th id="2321">2321</th><td>					mm-&gt;locked_vm += grow;</td></tr>
<tr><th id="2322">2322</th><td>				vm_stat_account(mm, vma-&gt;vm_flags, grow);</td></tr>
<tr><th id="2323">2323</th><td>				anon_vma_interval_tree_pre_update_vma(vma);</td></tr>
<tr><th id="2324">2324</th><td>				vma-&gt;vm_end = address;</td></tr>
<tr><th id="2325">2325</th><td>				anon_vma_interval_tree_post_update_vma(vma);</td></tr>
<tr><th id="2326">2326</th><td>				<b>if</b> (vma-&gt;vm_next)</td></tr>
<tr><th id="2327">2327</th><td>					vma_gap_update(vma-&gt;vm_next);</td></tr>
<tr><th id="2328">2328</th><td>				<b>else</b></td></tr>
<tr><th id="2329">2329</th><td>					mm-&gt;highest_vm_end = vm_end_gap(vma);</td></tr>
<tr><th id="2330">2330</th><td>				spin_unlock(&amp;mm-&gt;page_table_lock);</td></tr>
<tr><th id="2331">2331</th><td></td></tr>
<tr><th id="2332">2332</th><td>				perf_event_mmap(vma);</td></tr>
<tr><th id="2333">2333</th><td>			}</td></tr>
<tr><th id="2334">2334</th><td>		}</td></tr>
<tr><th id="2335">2335</th><td>	}</td></tr>
<tr><th id="2336">2336</th><td>	anon_vma_unlock_write(vma-&gt;anon_vma);</td></tr>
<tr><th id="2337">2337</th><td>	khugepaged_enter_vma_merge(vma, vma-&gt;vm_flags);</td></tr>
<tr><th id="2338">2338</th><td>	validate_mm(mm);</td></tr>
<tr><th id="2339">2339</th><td>	<b>return</b> error;</td></tr>
<tr><th id="2340">2340</th><td>}</td></tr>
<tr><th id="2341">2341</th><td><u>#<span data-ppcond="2250">endif</span> /* CONFIG_STACK_GROWSUP || CONFIG_IA64 */</u></td></tr>
<tr><th id="2342">2342</th><td></td></tr>
<tr><th id="2343">2343</th><td><i>/*</i></td></tr>
<tr><th id="2344">2344</th><td><i> * vma is the first one with address &lt; vma-&gt;vm_start.  Have to extend vma.</i></td></tr>
<tr><th id="2345">2345</th><td><i> */</i></td></tr>
<tr><th id="2346">2346</th><td><em>int</em> <dfn class="decl def fn" id="expand_downwards" title='expand_downwards' data-ref="expand_downwards">expand_downwards</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col8 decl" id="308vma" title='vma' data-type='struct vm_area_struct *' data-ref="308vma">vma</dfn>,</td></tr>
<tr><th id="2347">2347</th><td>				   <em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="309address" title='address' data-type='unsigned long' data-ref="309address">address</dfn>)</td></tr>
<tr><th id="2348">2348</th><td>{</td></tr>
<tr><th id="2349">2349</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col0 decl" id="310mm" title='mm' data-type='struct mm_struct *' data-ref="310mm">mm</dfn> = <a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_mm" title='vm_area_struct::vm_mm' data-ref="vm_area_struct::vm_mm">vm_mm</a>;</td></tr>
<tr><th id="2350">2350</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col1 decl" id="311prev" title='prev' data-type='struct vm_area_struct *' data-ref="311prev">prev</dfn>;</td></tr>
<tr><th id="2351">2351</th><td>	<em>int</em> <dfn class="local col2 decl" id="312error" title='error' data-type='int' data-ref="312error">error</dfn>;</td></tr>
<tr><th id="2352">2352</th><td></td></tr>
<tr><th id="2353">2353</th><td>	<a class="local col9 ref" href="#309address" title='address' data-ref="309address">address</a> &amp;= <a class="macro" href="../arch/x86/include/asm/page_types.h.html#12" title="(~(((1UL) &lt;&lt; 12)-1))" data-ref="_M/PAGE_MASK">PAGE_MASK</a>;</td></tr>
<tr><th id="2354">2354</th><td>	<a class="local col2 ref" href="#312error" title='error' data-ref="312error">error</a> = <a class="ref fn" href="../include/linux/security.h.html#security_mmap_addr" title='security_mmap_addr' data-ref="security_mmap_addr">security_mmap_addr</a>(<a class="local col9 ref" href="#309address" title='address' data-ref="309address">address</a>);</td></tr>
<tr><th id="2355">2355</th><td>	<b>if</b> (<a class="local col2 ref" href="#312error" title='error' data-ref="312error">error</a>)</td></tr>
<tr><th id="2356">2356</th><td>		<b>return</b> <a class="local col2 ref" href="#312error" title='error' data-ref="312error">error</a>;</td></tr>
<tr><th id="2357">2357</th><td></td></tr>
<tr><th id="2358">2358</th><td>	<i>/* Enforce stack_guard_gap */</i></td></tr>
<tr><th id="2359">2359</th><td>	<a class="local col1 ref" href="#311prev" title='prev' data-ref="311prev">prev</a> = <a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a>;</td></tr>
<tr><th id="2360">2360</th><td>	<i>/* Check that both stack segments have the same anon_vma? */</i></td></tr>
<tr><th id="2361">2361</th><td>	<b>if</b> (<a class="local col1 ref" href="#311prev" title='prev' data-ref="311prev">prev</a> &amp;&amp; !(<a class="local col1 ref" href="#311prev" title='prev' data-ref="311prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#174" title="0x00000100" data-ref="_M/VM_GROWSDOWN">VM_GROWSDOWN</a>) &amp;&amp;</td></tr>
<tr><th id="2362">2362</th><td>			(<a class="local col1 ref" href="#311prev" title='prev' data-ref="311prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; (<a class="macro" href="../include/linux/mm.h.html#164" title="0x00000002" data-ref="_M/VM_WRITE">VM_WRITE</a>|<a class="macro" href="../include/linux/mm.h.html#163" title="0x00000001" data-ref="_M/VM_READ">VM_READ</a>|<a class="macro" href="../include/linux/mm.h.html#165" title="0x00000004" data-ref="_M/VM_EXEC">VM_EXEC</a>))) {</td></tr>
<tr><th id="2363">2363</th><td>		<b>if</b> (<a class="local col9 ref" href="#309address" title='address' data-ref="309address">address</a> - <a class="local col1 ref" href="#311prev" title='prev' data-ref="311prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> &lt; <a class="ref" href="../include/linux/mm.h.html#stack_guard_gap" title='stack_guard_gap' data-ref="stack_guard_gap">stack_guard_gap</a>)</td></tr>
<tr><th id="2364">2364</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2365">2365</th><td>	}</td></tr>
<tr><th id="2366">2366</th><td></td></tr>
<tr><th id="2367">2367</th><td>	<i>/* We must make sure the anon_vma is allocated. */</i></td></tr>
<tr><th id="2368">2368</th><td>	<b>if</b> (<a class="macro" href="../include/linux/compiler.h.html#77" title="__builtin_expect(!!(anon_vma_prepare(vma)), 0)" data-ref="_M/unlikely">unlikely</a>(<a class="ref fn" href="../include/linux/rmap.h.html#anon_vma_prepare" title='anon_vma_prepare' data-ref="anon_vma_prepare">anon_vma_prepare</a>(<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>)))</td></tr>
<tr><th id="2369">2369</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2370">2370</th><td></td></tr>
<tr><th id="2371">2371</th><td>	<i>/*</i></td></tr>
<tr><th id="2372">2372</th><td><i>	 * vma-&gt;vm_start/vm_end cannot change under us because the caller</i></td></tr>
<tr><th id="2373">2373</th><td><i>	 * is required to hold the mmap_sem in read mode.  We need the</i></td></tr>
<tr><th id="2374">2374</th><td><i>	 * anon_vma lock to serialize against concurrent expand_stacks.</i></td></tr>
<tr><th id="2375">2375</th><td><i>	 */</i></td></tr>
<tr><th id="2376">2376</th><td>	<a class="ref fn" href="../include/linux/rmap.h.html#anon_vma_lock_write" title='anon_vma_lock_write' data-ref="anon_vma_lock_write">anon_vma_lock_write</a>(<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>);</td></tr>
<tr><th id="2377">2377</th><td></td></tr>
<tr><th id="2378">2378</th><td>	<i>/* Somebody else might have raced and expanded it already */</i></td></tr>
<tr><th id="2379">2379</th><td>	<b>if</b> (<a class="local col9 ref" href="#309address" title='address' data-ref="309address">address</a> &lt; <a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>) {</td></tr>
<tr><th id="2380">2380</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col3 decl" id="313size" title='size' data-type='unsigned long' data-ref="313size">size</dfn>, <dfn class="local col4 decl" id="314grow" title='grow' data-type='unsigned long' data-ref="314grow">grow</dfn>;</td></tr>
<tr><th id="2381">2381</th><td></td></tr>
<tr><th id="2382">2382</th><td>		<a class="local col3 ref" href="#313size" title='size' data-ref="313size">size</a> = <a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> - <a class="local col9 ref" href="#309address" title='address' data-ref="309address">address</a>;</td></tr>
<tr><th id="2383">2383</th><td>		<a class="local col4 ref" href="#314grow" title='grow' data-ref="314grow">grow</a> = (<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> - <a class="local col9 ref" href="#309address" title='address' data-ref="309address">address</a>) &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2384">2384</th><td></td></tr>
<tr><th id="2385">2385</th><td>		<a class="local col2 ref" href="#312error" title='error' data-ref="312error">error</a> = -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2386">2386</th><td>		<b>if</b> (<a class="local col4 ref" href="#314grow" title='grow' data-ref="314grow">grow</a> &lt;= <a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a>) {</td></tr>
<tr><th id="2387">2387</th><td>			<a class="local col2 ref" href="#312error" title='error' data-ref="312error">error</a> = <a class="tu ref fn" href="#acct_stack_growth" title='acct_stack_growth' data-use='c' data-ref="acct_stack_growth">acct_stack_growth</a>(<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>, <a class="local col3 ref" href="#313size" title='size' data-ref="313size">size</a>, <a class="local col4 ref" href="#314grow" title='grow' data-ref="314grow">grow</a>);</td></tr>
<tr><th id="2388">2388</th><td>			<b>if</b> (!<a class="local col2 ref" href="#312error" title='error' data-ref="312error">error</a>) {</td></tr>
<tr><th id="2389">2389</th><td>				<i>/*</i></td></tr>
<tr><th id="2390">2390</th><td><i>				 * vma_gap_update() doesn't support concurrent</i></td></tr>
<tr><th id="2391">2391</th><td><i>				 * updates, but we only hold a shared mmap_sem</i></td></tr>
<tr><th id="2392">2392</th><td><i>				 * lock here, so we need to protect against</i></td></tr>
<tr><th id="2393">2393</th><td><i>				 * concurrent vma expansions.</i></td></tr>
<tr><th id="2394">2394</th><td><i>				 * anon_vma_lock_write() doesn't help here, as</i></td></tr>
<tr><th id="2395">2395</th><td><i>				 * we don't guarantee that all growable vmas</i></td></tr>
<tr><th id="2396">2396</th><td><i>				 * in a mm share the same root anon vma.</i></td></tr>
<tr><th id="2397">2397</th><td><i>				 * So, we reuse mm-&gt;page_table_lock to guard</i></td></tr>
<tr><th id="2398">2398</th><td><i>				 * against concurrent vma expansions.</i></td></tr>
<tr><th id="2399">2399</th><td><i>				 */</i></td></tr>
<tr><th id="2400">2400</th><td>				<a class="ref fn" href="../include/linux/spinlock.h.html#spin_lock" title='spin_lock' data-ref="spin_lock">spin_lock</a>(&amp;<a class="local col0 ref" href="#310mm" title='mm' data-ref="310mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::page_table_lock" title='mm_struct::page_table_lock' data-ref="mm_struct::page_table_lock">page_table_lock</a>);</td></tr>
<tr><th id="2401">2401</th><td>				<b>if</b> (<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#180" title="0x00002000" data-ref="_M/VM_LOCKED">VM_LOCKED</a>)</td></tr>
<tr><th id="2402">2402</th><td>					<a class="local col0 ref" href="#310mm" title='mm' data-ref="310mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::locked_vm" title='mm_struct::locked_vm' data-ref="mm_struct::locked_vm">locked_vm</a> += <a class="local col4 ref" href="#314grow" title='grow' data-ref="314grow">grow</a>;</td></tr>
<tr><th id="2403">2403</th><td>				<a class="ref fn" href="#vm_stat_account" title='vm_stat_account' data-ref="vm_stat_account">vm_stat_account</a>(<a class="local col0 ref" href="#310mm" title='mm' data-ref="310mm">mm</a>, <a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a>, <a class="local col4 ref" href="#314grow" title='grow' data-ref="314grow">grow</a>);</td></tr>
<tr><th id="2404">2404</th><td>				<a class="tu ref fn" href="#anon_vma_interval_tree_pre_update_vma" title='anon_vma_interval_tree_pre_update_vma' data-use='c' data-ref="anon_vma_interval_tree_pre_update_vma">anon_vma_interval_tree_pre_update_vma</a>(<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>);</td></tr>
<tr><th id="2405">2405</th><td>				<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> = <a class="local col9 ref" href="#309address" title='address' data-ref="309address">address</a>;</td></tr>
<tr><th id="2406">2406</th><td>				<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> -= <a class="local col4 ref" href="#314grow" title='grow' data-ref="314grow">grow</a>;</td></tr>
<tr><th id="2407">2407</th><td>				<a class="tu ref fn" href="#anon_vma_interval_tree_post_update_vma" title='anon_vma_interval_tree_post_update_vma' data-use='c' data-ref="anon_vma_interval_tree_post_update_vma">anon_vma_interval_tree_post_update_vma</a>(<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>);</td></tr>
<tr><th id="2408">2408</th><td>				<a class="tu ref fn" href="#vma_gap_update" title='vma_gap_update' data-use='c' data-ref="vma_gap_update">vma_gap_update</a>(<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>);</td></tr>
<tr><th id="2409">2409</th><td>				<a class="ref fn" href="../include/linux/spinlock.h.html#spin_unlock" title='spin_unlock' data-ref="spin_unlock">spin_unlock</a>(&amp;<a class="local col0 ref" href="#310mm" title='mm' data-ref="310mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::page_table_lock" title='mm_struct::page_table_lock' data-ref="mm_struct::page_table_lock">page_table_lock</a>);</td></tr>
<tr><th id="2410">2410</th><td></td></tr>
<tr><th id="2411">2411</th><td>				<a class="ref fn" href="../include/linux/perf_event.h.html#perf_event_mmap" title='perf_event_mmap' data-ref="perf_event_mmap">perf_event_mmap</a>(<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>);</td></tr>
<tr><th id="2412">2412</th><td>			}</td></tr>
<tr><th id="2413">2413</th><td>		}</td></tr>
<tr><th id="2414">2414</th><td>	}</td></tr>
<tr><th id="2415">2415</th><td>	<a class="ref fn" href="../include/linux/rmap.h.html#anon_vma_unlock_write" title='anon_vma_unlock_write' data-ref="anon_vma_unlock_write">anon_vma_unlock_write</a>(<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>);</td></tr>
<tr><th id="2416">2416</th><td>	<a class="ref fn" href="../include/linux/khugepaged.h.html#khugepaged_enter_vma_merge" title='khugepaged_enter_vma_merge' data-ref="khugepaged_enter_vma_merge">khugepaged_enter_vma_merge</a>(<a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>, <a class="local col8 ref" href="#308vma" title='vma' data-ref="308vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a>);</td></tr>
<tr><th id="2417">2417</th><td>	<a class="macro" href="#393" title="do { } while (0)" data-ref="_M/validate_mm">validate_mm</a>(mm);</td></tr>
<tr><th id="2418">2418</th><td>	<b>return</b> <a class="local col2 ref" href="#312error" title='error' data-ref="312error">error</a>;</td></tr>
<tr><th id="2419">2419</th><td>}</td></tr>
<tr><th id="2420">2420</th><td></td></tr>
<tr><th id="2421">2421</th><td><i>/* enforced gap between the expanding stack and other mappings. */</i></td></tr>
<tr><th id="2422">2422</th><td><em>unsigned</em> <em>long</em> <dfn class="decl def" id="stack_guard_gap" title='stack_guard_gap' data-ref="stack_guard_gap">stack_guard_gap</dfn> = <var>256UL</var>&lt;&lt;<a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2423">2423</th><td></td></tr>
<tr><th id="2424">2424</th><td><em>static</em> <em>int</em> <a class="macro" href="../include/linux/init.h.html#50" title="__attribute__ ((__section__(&quot;.init.text&quot;)))" data-ref="_M/__init">__init</a> <dfn class="tu decl def fn" id="cmdline_parse_stack_guard_gap" title='cmdline_parse_stack_guard_gap' data-type='int cmdline_parse_stack_guard_gap(char * p)' data-ref="cmdline_parse_stack_guard_gap">cmdline_parse_stack_guard_gap</dfn>(<em>char</em> *<dfn class="local col5 decl" id="315p" title='p' data-type='char *' data-ref="315p">p</dfn>)</td></tr>
<tr><th id="2425">2425</th><td>{</td></tr>
<tr><th id="2426">2426</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="316val" title='val' data-type='unsigned long' data-ref="316val">val</dfn>;</td></tr>
<tr><th id="2427">2427</th><td>	<em>char</em> *<dfn class="local col7 decl" id="317endptr" title='endptr' data-type='char *' data-ref="317endptr">endptr</dfn>;</td></tr>
<tr><th id="2428">2428</th><td></td></tr>
<tr><th id="2429">2429</th><td>	<a class="local col6 ref" href="#316val" title='val' data-ref="316val">val</a> = <a class="ref fn" href="../include/linux/kernel.h.html#simple_strtoul" title='simple_strtoul' data-ref="simple_strtoul">simple_strtoul</a>(<a class="local col5 ref" href="#315p" title='p' data-ref="315p">p</a>, &amp;<a class="local col7 ref" href="#317endptr" title='endptr' data-ref="317endptr">endptr</a>, <var>10</var>);</td></tr>
<tr><th id="2430">2430</th><td>	<b>if</b> (!*<a class="local col7 ref" href="#317endptr" title='endptr' data-ref="317endptr">endptr</a>)</td></tr>
<tr><th id="2431">2431</th><td>		<a class="ref" href="../include/linux/mm.h.html#stack_guard_gap" title='stack_guard_gap' data-ref="stack_guard_gap">stack_guard_gap</a> = <a class="local col6 ref" href="#316val" title='val' data-ref="316val">val</a> &lt;&lt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2432">2432</th><td></td></tr>
<tr><th id="2433">2433</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2434">2434</th><td>}</td></tr>
<tr><th id="2435">2435</th><td><a class="macro" href="../include/linux/init.h.html#241" title="static const char __setup_str_cmdline_parse_stack_guard_gap[] __attribute__ ((__section__(&quot;.init.rodata&quot;))) __attribute__((aligned(1))) = &quot;stack_guard_gap=&quot;; static struct obs_kernel_param __setup_cmdline_parse_stack_guard_gap __attribute__((__used__)) __attribute__ ((__section__(&quot;.init.setup&quot;))) __attribute__((aligned((sizeof(long))))) = { __setup_str_cmdline_parse_stack_guard_gap, cmdline_parse_stack_guard_gap, 0 }" data-ref="_M/__setup">__setup</a>(<q>"stack_guard_gap="</q>, <a class="tu ref fn" href="#cmdline_parse_stack_guard_gap" title='cmdline_parse_stack_guard_gap' data-ref="cmdline_parse_stack_guard_gap">cmdline_parse_stack_guard_gap</a>);</td></tr>
<tr><th id="2436">2436</th><td></td></tr>
<tr><th id="2437">2437</th><td><u>#<span data-ppcond="2437">ifdef</span> <span class="macro" data-ref="_M/CONFIG_STACK_GROWSUP">CONFIG_STACK_GROWSUP</span></u></td></tr>
<tr><th id="2438">2438</th><td><em>int</em> expand_stack(<b>struct</b> vm_area_struct *vma, <em>unsigned</em> <em>long</em> address)</td></tr>
<tr><th id="2439">2439</th><td>{</td></tr>
<tr><th id="2440">2440</th><td>	<b>return</b> expand_upwards(vma, address);</td></tr>
<tr><th id="2441">2441</th><td>}</td></tr>
<tr><th id="2442">2442</th><td></td></tr>
<tr><th id="2443">2443</th><td><b>struct</b> vm_area_struct *</td></tr>
<tr><th id="2444">2444</th><td>find_extend_vma(<b>struct</b> mm_struct *mm, <em>unsigned</em> <em>long</em> addr)</td></tr>
<tr><th id="2445">2445</th><td>{</td></tr>
<tr><th id="2446">2446</th><td>	<b>struct</b> vm_area_struct *vma, *prev;</td></tr>
<tr><th id="2447">2447</th><td></td></tr>
<tr><th id="2448">2448</th><td>	addr &amp;= PAGE_MASK;</td></tr>
<tr><th id="2449">2449</th><td>	vma = find_vma_prev(mm, addr, &amp;prev);</td></tr>
<tr><th id="2450">2450</th><td>	<b>if</b> (vma &amp;&amp; (vma-&gt;vm_start &lt;= addr))</td></tr>
<tr><th id="2451">2451</th><td>		<b>return</b> vma;</td></tr>
<tr><th id="2452">2452</th><td>	<b>if</b> (!prev || expand_stack(prev, addr))</td></tr>
<tr><th id="2453">2453</th><td>		<b>return</b> NULL;</td></tr>
<tr><th id="2454">2454</th><td>	<b>if</b> (prev-&gt;vm_flags &amp; VM_LOCKED)</td></tr>
<tr><th id="2455">2455</th><td>		populate_vma_page_range(prev, addr, prev-&gt;vm_end, NULL);</td></tr>
<tr><th id="2456">2456</th><td>	<b>return</b> prev;</td></tr>
<tr><th id="2457">2457</th><td>}</td></tr>
<tr><th id="2458">2458</th><td><u>#<span data-ppcond="2437">else</span></u></td></tr>
<tr><th id="2459">2459</th><td><em>int</em> <dfn class="decl def fn" id="expand_stack" title='expand_stack' data-ref="expand_stack">expand_stack</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col8 decl" id="318vma" title='vma' data-type='struct vm_area_struct *' data-ref="318vma">vma</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="319address" title='address' data-type='unsigned long' data-ref="319address">address</dfn>)</td></tr>
<tr><th id="2460">2460</th><td>{</td></tr>
<tr><th id="2461">2461</th><td>	<b>return</b> <a class="ref fn" href="#expand_downwards" title='expand_downwards' data-ref="expand_downwards">expand_downwards</a>(<a class="local col8 ref" href="#318vma" title='vma' data-ref="318vma">vma</a>, <a class="local col9 ref" href="#319address" title='address' data-ref="319address">address</a>);</td></tr>
<tr><th id="2462">2462</th><td>}</td></tr>
<tr><th id="2463">2463</th><td></td></tr>
<tr><th id="2464">2464</th><td><b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *</td></tr>
<tr><th id="2465">2465</th><td><dfn class="decl def fn" id="find_extend_vma" title='find_extend_vma' data-ref="find_extend_vma">find_extend_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col0 decl" id="320mm" title='mm' data-type='struct mm_struct *' data-ref="320mm">mm</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col1 decl" id="321addr" title='addr' data-type='unsigned long' data-ref="321addr">addr</dfn>)</td></tr>
<tr><th id="2466">2466</th><td>{</td></tr>
<tr><th id="2467">2467</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="322vma" title='vma' data-type='struct vm_area_struct *' data-ref="322vma">vma</dfn>;</td></tr>
<tr><th id="2468">2468</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col3 decl" id="323start" title='start' data-type='unsigned long' data-ref="323start">start</dfn>;</td></tr>
<tr><th id="2469">2469</th><td></td></tr>
<tr><th id="2470">2470</th><td>	<a class="local col1 ref" href="#321addr" title='addr' data-ref="321addr">addr</a> &amp;= <a class="macro" href="../arch/x86/include/asm/page_types.h.html#12" title="(~(((1UL) &lt;&lt; 12)-1))" data-ref="_M/PAGE_MASK">PAGE_MASK</a>;</td></tr>
<tr><th id="2471">2471</th><td>	<a class="local col2 ref" href="#322vma" title='vma' data-ref="322vma">vma</a> = <a class="ref fn" href="#find_vma" title='find_vma' data-ref="find_vma">find_vma</a>(<a class="local col0 ref" href="#320mm" title='mm' data-ref="320mm">mm</a>, <a class="local col1 ref" href="#321addr" title='addr' data-ref="321addr">addr</a>);</td></tr>
<tr><th id="2472">2472</th><td>	<b>if</b> (!<a class="local col2 ref" href="#322vma" title='vma' data-ref="322vma">vma</a>)</td></tr>
<tr><th id="2473">2473</th><td>		<b>return</b> <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="2474">2474</th><td>	<b>if</b> (<a class="local col2 ref" href="#322vma" title='vma' data-ref="322vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &lt;= <a class="local col1 ref" href="#321addr" title='addr' data-ref="321addr">addr</a>)</td></tr>
<tr><th id="2475">2475</th><td>		<b>return</b> <a class="local col2 ref" href="#322vma" title='vma' data-ref="322vma">vma</a>;</td></tr>
<tr><th id="2476">2476</th><td>	<b>if</b> (!(<a class="local col2 ref" href="#322vma" title='vma' data-ref="322vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#174" title="0x00000100" data-ref="_M/VM_GROWSDOWN">VM_GROWSDOWN</a>))</td></tr>
<tr><th id="2477">2477</th><td>		<b>return</b> <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="2478">2478</th><td>	<a class="local col3 ref" href="#323start" title='start' data-ref="323start">start</a> = <a class="local col2 ref" href="#322vma" title='vma' data-ref="322vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>;</td></tr>
<tr><th id="2479">2479</th><td>	<b>if</b> (<a class="ref fn" href="#expand_stack" title='expand_stack' data-ref="expand_stack">expand_stack</a>(<a class="local col2 ref" href="#322vma" title='vma' data-ref="322vma">vma</a>, <a class="local col1 ref" href="#321addr" title='addr' data-ref="321addr">addr</a>))</td></tr>
<tr><th id="2480">2480</th><td>		<b>return</b> <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="2481">2481</th><td>	<b>if</b> (<a class="local col2 ref" href="#322vma" title='vma' data-ref="322vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#180" title="0x00002000" data-ref="_M/VM_LOCKED">VM_LOCKED</a>)</td></tr>
<tr><th id="2482">2482</th><td>		<a class="ref fn" href="internal.h.html#populate_vma_page_range" title='populate_vma_page_range' data-ref="populate_vma_page_range">populate_vma_page_range</a>(<a class="local col2 ref" href="#322vma" title='vma' data-ref="322vma">vma</a>, <a class="local col1 ref" href="#321addr" title='addr' data-ref="321addr">addr</a>, <a class="local col3 ref" href="#323start" title='start' data-ref="323start">start</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="2483">2483</th><td>	<b>return</b> <a class="local col2 ref" href="#322vma" title='vma' data-ref="322vma">vma</a>;</td></tr>
<tr><th id="2484">2484</th><td>}</td></tr>
<tr><th id="2485">2485</th><td><u>#<span data-ppcond="2437">endif</span></u></td></tr>
<tr><th id="2486">2486</th><td></td></tr>
<tr><th id="2487">2487</th><td><a class="macro" href="../include/linux/export.h.html#106" title="extern typeof(find_extend_vma) find_extend_vma; static const char __kstrtab_find_extend_vma[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;find_extend_vma&quot;; static const struct kernel_symbol __ksymtab_find_extend_vma __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;find_extend_vma&quot;), used)) = { (unsigned long)&amp;find_extend_vma, __kstrtab_find_extend_vma }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#find_extend_vma" title='find_extend_vma' data-ref="find_extend_vma"><a class="ref fn" href="#find_extend_vma" title='find_extend_vma' data-ref="find_extend_vma"><a class="ref fn" href="#find_extend_vma" title='find_extend_vma' data-ref="find_extend_vma"><a class="ref fn" href="#find_extend_vma" title='find_extend_vma' data-ref="find_extend_vma">find_extend_vma</a></a></a></a>);</td></tr>
<tr><th id="2488">2488</th><td></td></tr>
<tr><th id="2489">2489</th><td><i  data-doc="remove_vma_list">/*</i></td></tr>
<tr><th id="2490">2490</th><td><i  data-doc="remove_vma_list"> * Ok - we have the memory areas we should free on the vma list,</i></td></tr>
<tr><th id="2491">2491</th><td><i  data-doc="remove_vma_list"> * so release them, and do the vma updates.</i></td></tr>
<tr><th id="2492">2492</th><td><i  data-doc="remove_vma_list"> *</i></td></tr>
<tr><th id="2493">2493</th><td><i  data-doc="remove_vma_list"> * Called with the mm semaphore held.</i></td></tr>
<tr><th id="2494">2494</th><td><i  data-doc="remove_vma_list"> */</i></td></tr>
<tr><th id="2495">2495</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="remove_vma_list" title='remove_vma_list' data-type='void remove_vma_list(struct mm_struct * mm, struct vm_area_struct * vma)' data-ref="remove_vma_list">remove_vma_list</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col4 decl" id="324mm" title='mm' data-type='struct mm_struct *' data-ref="324mm">mm</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col5 decl" id="325vma" title='vma' data-type='struct vm_area_struct *' data-ref="325vma">vma</dfn>)</td></tr>
<tr><th id="2496">2496</th><td>{</td></tr>
<tr><th id="2497">2497</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="326nr_accounted" title='nr_accounted' data-type='unsigned long' data-ref="326nr_accounted">nr_accounted</dfn> = <var>0</var>;</td></tr>
<tr><th id="2498">2498</th><td></td></tr>
<tr><th id="2499">2499</th><td>	<i>/* Update high watermark before we lower total_vm */</i></td></tr>
<tr><th id="2500">2500</th><td>	<a class="ref fn" href="../include/linux/mm.h.html#update_hiwater_vm" title='update_hiwater_vm' data-ref="update_hiwater_vm">update_hiwater_vm</a>(<a class="local col4 ref" href="#324mm" title='mm' data-ref="324mm">mm</a>);</td></tr>
<tr><th id="2501">2501</th><td>	<b>do</b> {</td></tr>
<tr><th id="2502">2502</th><td>		<em>long</em> <dfn class="local col7 decl" id="327nrpages" title='nrpages' data-type='long' data-ref="327nrpages">nrpages</dfn> = <a class="ref fn" href="../include/linux/mm.h.html#vma_pages" title='vma_pages' data-ref="vma_pages">vma_pages</a>(<a class="local col5 ref" href="#325vma" title='vma' data-ref="325vma">vma</a>);</td></tr>
<tr><th id="2503">2503</th><td></td></tr>
<tr><th id="2504">2504</th><td>		<b>if</b> (<a class="local col5 ref" href="#325vma" title='vma' data-ref="325vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#190" title="0x00100000" data-ref="_M/VM_ACCOUNT">VM_ACCOUNT</a>)</td></tr>
<tr><th id="2505">2505</th><td>			<a class="local col6 ref" href="#326nr_accounted" title='nr_accounted' data-ref="326nr_accounted">nr_accounted</a> += <a class="local col7 ref" href="#327nrpages" title='nrpages' data-ref="327nrpages">nrpages</a>;</td></tr>
<tr><th id="2506">2506</th><td>		<a class="ref fn" href="#vm_stat_account" title='vm_stat_account' data-ref="vm_stat_account">vm_stat_account</a>(<a class="local col4 ref" href="#324mm" title='mm' data-ref="324mm">mm</a>, <a class="local col5 ref" href="#325vma" title='vma' data-ref="325vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a>, -<a class="local col7 ref" href="#327nrpages" title='nrpages' data-ref="327nrpages">nrpages</a>);</td></tr>
<tr><th id="2507">2507</th><td>		<a class="local col5 ref" href="#325vma" title='vma' data-ref="325vma">vma</a> = <a class="tu ref fn" href="#remove_vma" title='remove_vma' data-use='c' data-ref="remove_vma">remove_vma</a>(<a class="local col5 ref" href="#325vma" title='vma' data-ref="325vma">vma</a>);</td></tr>
<tr><th id="2508">2508</th><td>	} <b>while</b> (<a class="local col5 ref" href="#325vma" title='vma' data-ref="325vma">vma</a>);</td></tr>
<tr><th id="2509">2509</th><td>	<a class="ref fn" href="../include/linux/mman.h.html#vm_unacct_memory" title='vm_unacct_memory' data-ref="vm_unacct_memory">vm_unacct_memory</a>(<a class="local col6 ref" href="#326nr_accounted" title='nr_accounted' data-ref="326nr_accounted">nr_accounted</a>);</td></tr>
<tr><th id="2510">2510</th><td>	<a class="macro" href="#393" title="do { } while (0)" data-ref="_M/validate_mm">validate_mm</a>(mm);</td></tr>
<tr><th id="2511">2511</th><td>}</td></tr>
<tr><th id="2512">2512</th><td></td></tr>
<tr><th id="2513">2513</th><td><i  data-doc="unmap_region">/*</i></td></tr>
<tr><th id="2514">2514</th><td><i  data-doc="unmap_region"> * Get rid of page table information in the indicated region.</i></td></tr>
<tr><th id="2515">2515</th><td><i  data-doc="unmap_region"> *</i></td></tr>
<tr><th id="2516">2516</th><td><i  data-doc="unmap_region"> * Called with the mm semaphore held.</i></td></tr>
<tr><th id="2517">2517</th><td><i  data-doc="unmap_region"> */</i></td></tr>
<tr><th id="2518">2518</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="unmap_region" title='unmap_region' data-type='void unmap_region(struct mm_struct * mm, struct vm_area_struct * vma, struct vm_area_struct * prev, unsigned long start, unsigned long end)' data-ref="unmap_region">unmap_region</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col8 decl" id="328mm" title='mm' data-type='struct mm_struct *' data-ref="328mm">mm</dfn>,</td></tr>
<tr><th id="2519">2519</th><td>		<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col9 decl" id="329vma" title='vma' data-type='struct vm_area_struct *' data-ref="329vma">vma</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col0 decl" id="330prev" title='prev' data-type='struct vm_area_struct *' data-ref="330prev">prev</dfn>,</td></tr>
<tr><th id="2520">2520</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col1 decl" id="331start" title='start' data-type='unsigned long' data-ref="331start">start</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col2 decl" id="332end" title='end' data-type='unsigned long' data-ref="332end">end</dfn>)</td></tr>
<tr><th id="2521">2521</th><td>{</td></tr>
<tr><th id="2522">2522</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col3 decl" id="333next" title='next' data-type='struct vm_area_struct *' data-ref="333next">next</dfn> = <a class="local col0 ref" href="#330prev" title='prev' data-ref="330prev">prev</a> ? <a class="local col0 ref" href="#330prev" title='prev' data-ref="330prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a> : <a class="local col8 ref" href="#328mm" title='mm' data-ref="328mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap" title='mm_struct::mmap' data-ref="mm_struct::mmap">mmap</a>;</td></tr>
<tr><th id="2523">2523</th><td>	<b>struct</b> <a class="type" href="../include/asm-generic/tlb.h.html#mmu_gather" title='mmu_gather' data-ref="mmu_gather">mmu_gather</a> <dfn class="local col4 decl" id="334tlb" title='tlb' data-type='struct mmu_gather' data-ref="334tlb">tlb</dfn>;</td></tr>
<tr><th id="2524">2524</th><td></td></tr>
<tr><th id="2525">2525</th><td>	<a class="ref fn" href="../include/linux/swap.h.html#lru_add_drain" title='lru_add_drain' data-ref="lru_add_drain">lru_add_drain</a>();</td></tr>
<tr><th id="2526">2526</th><td>	<a class="ref fn" href="../include/linux/mm_types.h.html#tlb_gather_mmu" title='tlb_gather_mmu' data-ref="tlb_gather_mmu">tlb_gather_mmu</a>(&amp;<a class="local col4 ref" href="#334tlb" title='tlb' data-ref="334tlb">tlb</a>, <a class="local col8 ref" href="#328mm" title='mm' data-ref="328mm">mm</a>, <a class="local col1 ref" href="#331start" title='start' data-ref="331start">start</a>, <a class="local col2 ref" href="#332end" title='end' data-ref="332end">end</a>);</td></tr>
<tr><th id="2527">2527</th><td>	<a class="ref fn" href="../include/linux/mm.h.html#update_hiwater_rss" title='update_hiwater_rss' data-ref="update_hiwater_rss">update_hiwater_rss</a>(<a class="local col8 ref" href="#328mm" title='mm' data-ref="328mm">mm</a>);</td></tr>
<tr><th id="2528">2528</th><td>	<a class="ref fn" href="../include/linux/mm.h.html#unmap_vmas" title='unmap_vmas' data-ref="unmap_vmas">unmap_vmas</a>(&amp;<a class="local col4 ref" href="#334tlb" title='tlb' data-ref="334tlb">tlb</a>, <a class="local col9 ref" href="#329vma" title='vma' data-ref="329vma">vma</a>, <a class="local col1 ref" href="#331start" title='start' data-ref="331start">start</a>, <a class="local col2 ref" href="#332end" title='end' data-ref="332end">end</a>);</td></tr>
<tr><th id="2529">2529</th><td>	<a class="ref fn" href="internal.h.html#free_pgtables" title='free_pgtables' data-ref="free_pgtables">free_pgtables</a>(&amp;<a class="local col4 ref" href="#334tlb" title='tlb' data-ref="334tlb">tlb</a>, <a class="local col9 ref" href="#329vma" title='vma' data-ref="329vma">vma</a>, <a class="local col0 ref" href="#330prev" title='prev' data-ref="330prev">prev</a> ? <a class="local col0 ref" href="#330prev" title='prev' data-ref="330prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> : <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#10" title="0UL" data-ref="_M/FIRST_USER_ADDRESS">FIRST_USER_ADDRESS</a>,</td></tr>
<tr><th id="2530">2530</th><td>				 <a class="local col3 ref" href="#333next" title='next' data-ref="333next">next</a> ? <a class="local col3 ref" href="#333next" title='next' data-ref="333next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> : <a class="macro" href="../include/asm-generic/pgtable.h.html#26" title="0UL" data-ref="_M/USER_PGTABLES_CEILING">USER_PGTABLES_CEILING</a>);</td></tr>
<tr><th id="2531">2531</th><td>	<a class="ref fn" href="../include/linux/mm_types.h.html#tlb_finish_mmu" title='tlb_finish_mmu' data-ref="tlb_finish_mmu">tlb_finish_mmu</a>(&amp;<a class="local col4 ref" href="#334tlb" title='tlb' data-ref="334tlb">tlb</a>, <a class="local col1 ref" href="#331start" title='start' data-ref="331start">start</a>, <a class="local col2 ref" href="#332end" title='end' data-ref="332end">end</a>);</td></tr>
<tr><th id="2532">2532</th><td>}</td></tr>
<tr><th id="2533">2533</th><td></td></tr>
<tr><th id="2534">2534</th><td><i  data-doc="detach_vmas_to_be_unmapped">/*</i></td></tr>
<tr><th id="2535">2535</th><td><i  data-doc="detach_vmas_to_be_unmapped"> * Create a list of vma's touched by the unmap, removing them from the mm's</i></td></tr>
<tr><th id="2536">2536</th><td><i  data-doc="detach_vmas_to_be_unmapped"> * vma list as we go..</i></td></tr>
<tr><th id="2537">2537</th><td><i  data-doc="detach_vmas_to_be_unmapped"> */</i></td></tr>
<tr><th id="2538">2538</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="2539">2539</th><td><dfn class="tu decl def fn" id="detach_vmas_to_be_unmapped" title='detach_vmas_to_be_unmapped' data-type='void detach_vmas_to_be_unmapped(struct mm_struct * mm, struct vm_area_struct * vma, struct vm_area_struct * prev, unsigned long end)' data-ref="detach_vmas_to_be_unmapped">detach_vmas_to_be_unmapped</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col5 decl" id="335mm" title='mm' data-type='struct mm_struct *' data-ref="335mm">mm</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col6 decl" id="336vma" title='vma' data-type='struct vm_area_struct *' data-ref="336vma">vma</dfn>,</td></tr>
<tr><th id="2540">2540</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col7 decl" id="337prev" title='prev' data-type='struct vm_area_struct *' data-ref="337prev">prev</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="338end" title='end' data-type='unsigned long' data-ref="338end">end</dfn>)</td></tr>
<tr><th id="2541">2541</th><td>{</td></tr>
<tr><th id="2542">2542</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> **<dfn class="local col9 decl" id="339insertion_point" title='insertion_point' data-type='struct vm_area_struct **' data-ref="339insertion_point">insertion_point</dfn>;</td></tr>
<tr><th id="2543">2543</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col0 decl" id="340tail_vma" title='tail_vma' data-type='struct vm_area_struct *' data-ref="340tail_vma">tail_vma</dfn> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="2544">2544</th><td></td></tr>
<tr><th id="2545">2545</th><td>	<a class="local col9 ref" href="#339insertion_point" title='insertion_point' data-ref="339insertion_point">insertion_point</a> = (<a class="local col7 ref" href="#337prev" title='prev' data-ref="337prev">prev</a> ? &amp;<a class="local col7 ref" href="#337prev" title='prev' data-ref="337prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a> : &amp;<a class="local col5 ref" href="#335mm" title='mm' data-ref="335mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap" title='mm_struct::mmap' data-ref="mm_struct::mmap">mmap</a>);</td></tr>
<tr><th id="2546">2546</th><td>	<a class="local col6 ref" href="#336vma" title='vma' data-ref="336vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="2547">2547</th><td>	<b>do</b> {</td></tr>
<tr><th id="2548">2548</th><td>		<a class="tu ref fn" href="#vma_rb_erase" title='vma_rb_erase' data-use='c' data-ref="vma_rb_erase">vma_rb_erase</a>(<a class="local col6 ref" href="#336vma" title='vma' data-ref="336vma">vma</a>, &amp;<a class="local col5 ref" href="#335mm" title='mm' data-ref="335mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mm_rb" title='mm_struct::mm_rb' data-ref="mm_struct::mm_rb">mm_rb</a>);</td></tr>
<tr><th id="2549">2549</th><td>		<a class="local col5 ref" href="#335mm" title='mm' data-ref="335mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::map_count" title='mm_struct::map_count' data-ref="mm_struct::map_count">map_count</a>--;</td></tr>
<tr><th id="2550">2550</th><td>		<a class="local col0 ref" href="#340tail_vma" title='tail_vma' data-ref="340tail_vma">tail_vma</a> = <a class="local col6 ref" href="#336vma" title='vma' data-ref="336vma">vma</a>;</td></tr>
<tr><th id="2551">2551</th><td>		<a class="local col6 ref" href="#336vma" title='vma' data-ref="336vma">vma</a> = <a class="local col6 ref" href="#336vma" title='vma' data-ref="336vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>;</td></tr>
<tr><th id="2552">2552</th><td>	} <b>while</b> (<a class="local col6 ref" href="#336vma" title='vma' data-ref="336vma">vma</a> &amp;&amp; <a class="local col6 ref" href="#336vma" title='vma' data-ref="336vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &lt; <a class="local col8 ref" href="#338end" title='end' data-ref="338end">end</a>);</td></tr>
<tr><th id="2553">2553</th><td>	*<a class="local col9 ref" href="#339insertion_point" title='insertion_point' data-ref="339insertion_point">insertion_point</a> = <a class="local col6 ref" href="#336vma" title='vma' data-ref="336vma">vma</a>;</td></tr>
<tr><th id="2554">2554</th><td>	<b>if</b> (<a class="local col6 ref" href="#336vma" title='vma' data-ref="336vma">vma</a>) {</td></tr>
<tr><th id="2555">2555</th><td>		<a class="local col6 ref" href="#336vma" title='vma' data-ref="336vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a> = <a class="local col7 ref" href="#337prev" title='prev' data-ref="337prev">prev</a>;</td></tr>
<tr><th id="2556">2556</th><td>		<a class="tu ref fn" href="#vma_gap_update" title='vma_gap_update' data-use='c' data-ref="vma_gap_update">vma_gap_update</a>(<a class="local col6 ref" href="#336vma" title='vma' data-ref="336vma">vma</a>);</td></tr>
<tr><th id="2557">2557</th><td>	} <b>else</b></td></tr>
<tr><th id="2558">2558</th><td>		<a class="local col5 ref" href="#335mm" title='mm' data-ref="335mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::highest_vm_end" title='mm_struct::highest_vm_end' data-ref="mm_struct::highest_vm_end">highest_vm_end</a> = <a class="local col7 ref" href="#337prev" title='prev' data-ref="337prev">prev</a> ? <a class="ref fn" href="../include/linux/mm.h.html#vm_end_gap" title='vm_end_gap' data-ref="vm_end_gap">vm_end_gap</a>(<a class="local col7 ref" href="#337prev" title='prev' data-ref="337prev">prev</a>) : <var>0</var>;</td></tr>
<tr><th id="2559">2559</th><td>	<a class="local col0 ref" href="#340tail_vma" title='tail_vma' data-ref="340tail_vma">tail_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="2560">2560</th><td></td></tr>
<tr><th id="2561">2561</th><td>	<i>/* Kill the cache */</i></td></tr>
<tr><th id="2562">2562</th><td>	<a class="ref fn" href="../include/linux/vmacache.h.html#vmacache_invalidate" title='vmacache_invalidate' data-ref="vmacache_invalidate">vmacache_invalidate</a>(<a class="local col5 ref" href="#335mm" title='mm' data-ref="335mm">mm</a>);</td></tr>
<tr><th id="2563">2563</th><td>}</td></tr>
<tr><th id="2564">2564</th><td></td></tr>
<tr><th id="2565">2565</th><td><i>/*</i></td></tr>
<tr><th id="2566">2566</th><td><i> * __split_vma() bypasses sysctl_max_map_count checking.  We use this where it</i></td></tr>
<tr><th id="2567">2567</th><td><i> * has already been checked or doesn't make sense to fail.</i></td></tr>
<tr><th id="2568">2568</th><td><i> */</i></td></tr>
<tr><th id="2569">2569</th><td><em>int</em> <dfn class="decl def fn" id="__split_vma" title='__split_vma' data-ref="__split_vma">__split_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col1 decl" id="341mm" title='mm' data-type='struct mm_struct *' data-ref="341mm">mm</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="342vma" title='vma' data-type='struct vm_area_struct *' data-ref="342vma">vma</dfn>,</td></tr>
<tr><th id="2570">2570</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col3 decl" id="343addr" title='addr' data-type='unsigned long' data-ref="343addr">addr</dfn>, <em>int</em> <dfn class="local col4 decl" id="344new_below" title='new_below' data-type='int' data-ref="344new_below">new_below</dfn>)</td></tr>
<tr><th id="2571">2571</th><td>{</td></tr>
<tr><th id="2572">2572</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col5 decl" id="345new" title='new' data-type='struct vm_area_struct *' data-ref="345new">new</dfn>;</td></tr>
<tr><th id="2573">2573</th><td>	<em>int</em> <dfn class="local col6 decl" id="346err" title='err' data-type='int' data-ref="346err">err</dfn>;</td></tr>
<tr><th id="2574">2574</th><td></td></tr>
<tr><th id="2575">2575</th><td>	<b>if</b> (<a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a> &amp;&amp; <a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::split" title='vm_operations_struct::split' data-ref="vm_operations_struct::split">split</a>) {</td></tr>
<tr><th id="2576">2576</th><td>		<a class="local col6 ref" href="#346err" title='err' data-ref="346err">err</a> = <a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::split" title='vm_operations_struct::split' data-ref="vm_operations_struct::split">split</a>(<a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>, <a class="local col3 ref" href="#343addr" title='addr' data-ref="343addr">addr</a>);</td></tr>
<tr><th id="2577">2577</th><td>		<b>if</b> (<a class="local col6 ref" href="#346err" title='err' data-ref="346err">err</a>)</td></tr>
<tr><th id="2578">2578</th><td>			<b>return</b> <a class="local col6 ref" href="#346err" title='err' data-ref="346err">err</a>;</td></tr>
<tr><th id="2579">2579</th><td>	}</td></tr>
<tr><th id="2580">2580</th><td></td></tr>
<tr><th id="2581">2581</th><td>	<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a> = <a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_alloc" title='kmem_cache_alloc' data-ref="kmem_cache_alloc">kmem_cache_alloc</a>(<a class="ref" href="../include/linux/mm.h.html#vm_area_cachep" title='vm_area_cachep' data-ref="vm_area_cachep">vm_area_cachep</a>, <a class="macro" href="../include/linux/gfp.h.html#278" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="2582">2582</th><td>	<b>if</b> (!<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>)</td></tr>
<tr><th id="2583">2583</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2584">2584</th><td></td></tr>
<tr><th id="2585">2585</th><td>	<i>/* most fields are the same, copy all, and then fixup */</i></td></tr>
<tr><th id="2586">2586</th><td>	*<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a> = *<a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>;</td></tr>
<tr><th id="2587">2587</th><td></td></tr>
<tr><th id="2588">2588</th><td>	<a class="ref fn" href="../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma_chain" title='vm_area_struct::anon_vma_chain' data-ref="vm_area_struct::anon_vma_chain">anon_vma_chain</a>);</td></tr>
<tr><th id="2589">2589</th><td></td></tr>
<tr><th id="2590">2590</th><td>	<b>if</b> (<a class="local col4 ref" href="#344new_below" title='new_below' data-ref="344new_below">new_below</a>)</td></tr>
<tr><th id="2591">2591</th><td>		<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> = <a class="local col3 ref" href="#343addr" title='addr' data-ref="343addr">addr</a>;</td></tr>
<tr><th id="2592">2592</th><td>	<b>else</b> {</td></tr>
<tr><th id="2593">2593</th><td>		<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> = <a class="local col3 ref" href="#343addr" title='addr' data-ref="343addr">addr</a>;</td></tr>
<tr><th id="2594">2594</th><td>		<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> += ((<a class="local col3 ref" href="#343addr" title='addr' data-ref="343addr">addr</a> - <a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>) &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>);</td></tr>
<tr><th id="2595">2595</th><td>	}</td></tr>
<tr><th id="2596">2596</th><td></td></tr>
<tr><th id="2597">2597</th><td>	<a class="local col6 ref" href="#346err" title='err' data-ref="346err">err</a> = <a class="ref fn" href="../include/linux/mempolicy.h.html#vma_dup_policy" title='vma_dup_policy' data-ref="vma_dup_policy">vma_dup_policy</a>(<a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>, <a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>);</td></tr>
<tr><th id="2598">2598</th><td>	<b>if</b> (<a class="local col6 ref" href="#346err" title='err' data-ref="346err">err</a>)</td></tr>
<tr><th id="2599">2599</th><td>		<b>goto</b> <a class="lbl" href="#347out_free_vma" data-ref="347out_free_vma">out_free_vma</a>;</td></tr>
<tr><th id="2600">2600</th><td></td></tr>
<tr><th id="2601">2601</th><td>	<a class="local col6 ref" href="#346err" title='err' data-ref="346err">err</a> = <a class="ref fn" href="../include/linux/rmap.h.html#anon_vma_clone" title='anon_vma_clone' data-ref="anon_vma_clone">anon_vma_clone</a>(<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>, <a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>);</td></tr>
<tr><th id="2602">2602</th><td>	<b>if</b> (<a class="local col6 ref" href="#346err" title='err' data-ref="346err">err</a>)</td></tr>
<tr><th id="2603">2603</th><td>		<b>goto</b> <a class="lbl" href="#348out_free_mpol" data-ref="348out_free_mpol">out_free_mpol</a>;</td></tr>
<tr><th id="2604">2604</th><td></td></tr>
<tr><th id="2605">2605</th><td>	<b>if</b> (<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>)</td></tr>
<tr><th id="2606">2606</th><td>		<a class="ref fn" href="../include/linux/fs.h.html#get_file" title='get_file' data-ref="get_file">get_file</a>(<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>);</td></tr>
<tr><th id="2607">2607</th><td></td></tr>
<tr><th id="2608">2608</th><td>	<b>if</b> (<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a> &amp;&amp; <a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::open" title='vm_operations_struct::open' data-ref="vm_operations_struct::open">open</a>)</td></tr>
<tr><th id="2609">2609</th><td>		<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::open" title='vm_operations_struct::open' data-ref="vm_operations_struct::open">open</a>(<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>);</td></tr>
<tr><th id="2610">2610</th><td></td></tr>
<tr><th id="2611">2611</th><td>	<b>if</b> (<a class="local col4 ref" href="#344new_below" title='new_below' data-ref="344new_below">new_below</a>)</td></tr>
<tr><th id="2612">2612</th><td>		<a class="local col6 ref" href="#346err" title='err' data-ref="346err">err</a> = <a class="ref fn" href="../include/linux/mm.h.html#vma_adjust" title='vma_adjust' data-ref="vma_adjust">vma_adjust</a>(<a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>, <a class="local col3 ref" href="#343addr" title='addr' data-ref="343addr">addr</a>, <a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>, <a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> +</td></tr>
<tr><th id="2613">2613</th><td>			((<a class="local col3 ref" href="#343addr" title='addr' data-ref="343addr">addr</a> - <a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>) &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>), <a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>);</td></tr>
<tr><th id="2614">2614</th><td>	<b>else</b></td></tr>
<tr><th id="2615">2615</th><td>		<a class="local col6 ref" href="#346err" title='err' data-ref="346err">err</a> = <a class="ref fn" href="../include/linux/mm.h.html#vma_adjust" title='vma_adjust' data-ref="vma_adjust">vma_adjust</a>(<a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>, <a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>, <a class="local col3 ref" href="#343addr" title='addr' data-ref="343addr">addr</a>, <a class="local col2 ref" href="#342vma" title='vma' data-ref="342vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a>, <a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>);</td></tr>
<tr><th id="2616">2616</th><td></td></tr>
<tr><th id="2617">2617</th><td>	<i>/* Success. */</i></td></tr>
<tr><th id="2618">2618</th><td>	<b>if</b> (!<a class="local col6 ref" href="#346err" title='err' data-ref="346err">err</a>)</td></tr>
<tr><th id="2619">2619</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2620">2620</th><td></td></tr>
<tr><th id="2621">2621</th><td>	<i>/* Clean everything up if vma_adjust failed. */</i></td></tr>
<tr><th id="2622">2622</th><td>	<b>if</b> (<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a> &amp;&amp; <a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::close" title='vm_operations_struct::close' data-ref="vm_operations_struct::close">close</a>)</td></tr>
<tr><th id="2623">2623</th><td>		<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::close" title='vm_operations_struct::close' data-ref="vm_operations_struct::close">close</a>(<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>);</td></tr>
<tr><th id="2624">2624</th><td>	<b>if</b> (<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>)</td></tr>
<tr><th id="2625">2625</th><td>		<a class="ref fn" href="../include/linux/file.h.html#fput" title='fput' data-ref="fput">fput</a>(<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>);</td></tr>
<tr><th id="2626">2626</th><td>	<a class="ref fn" href="../include/linux/rmap.h.html#unlink_anon_vmas" title='unlink_anon_vmas' data-ref="unlink_anon_vmas">unlink_anon_vmas</a>(<a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>);</td></tr>
<tr><th id="2627">2627</th><td> <dfn class="lbl" id="348out_free_mpol" data-ref="348out_free_mpol">out_free_mpol</dfn>:</td></tr>
<tr><th id="2628">2628</th><td>	<a class="ref fn" href="../include/linux/mempolicy.h.html#mpol_put" title='mpol_put' data-ref="mpol_put">mpol_put</a>(<a class="macro" href="../include/linux/mempolicy.h.html#246" title="((void *)0)" data-ref="_M/vma_policy">vma_policy</a>(new));</td></tr>
<tr><th id="2629">2629</th><td> <dfn class="lbl" id="347out_free_vma" data-ref="347out_free_vma">out_free_vma</dfn>:</td></tr>
<tr><th id="2630">2630</th><td>	<a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_free" title='kmem_cache_free' data-ref="kmem_cache_free">kmem_cache_free</a>(<a class="ref" href="../include/linux/mm.h.html#vm_area_cachep" title='vm_area_cachep' data-ref="vm_area_cachep">vm_area_cachep</a>, <a class="local col5 ref" href="#345new" title='new' data-ref="345new">new</a>);</td></tr>
<tr><th id="2631">2631</th><td>	<b>return</b> <a class="local col6 ref" href="#346err" title='err' data-ref="346err">err</a>;</td></tr>
<tr><th id="2632">2632</th><td>}</td></tr>
<tr><th id="2633">2633</th><td></td></tr>
<tr><th id="2634">2634</th><td><i>/*</i></td></tr>
<tr><th id="2635">2635</th><td><i> * Split a vma into two pieces at address 'addr', a new vma is allocated</i></td></tr>
<tr><th id="2636">2636</th><td><i> * either for the first part or the tail.</i></td></tr>
<tr><th id="2637">2637</th><td><i> */</i></td></tr>
<tr><th id="2638">2638</th><td><em>int</em> <dfn class="decl def fn" id="split_vma" title='split_vma' data-ref="split_vma">split_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col9 decl" id="349mm" title='mm' data-type='struct mm_struct *' data-ref="349mm">mm</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col0 decl" id="350vma" title='vma' data-type='struct vm_area_struct *' data-ref="350vma">vma</dfn>,</td></tr>
<tr><th id="2639">2639</th><td>	      <em>unsigned</em> <em>long</em> <dfn class="local col1 decl" id="351addr" title='addr' data-type='unsigned long' data-ref="351addr">addr</dfn>, <em>int</em> <dfn class="local col2 decl" id="352new_below" title='new_below' data-type='int' data-ref="352new_below">new_below</dfn>)</td></tr>
<tr><th id="2640">2640</th><td>{</td></tr>
<tr><th id="2641">2641</th><td>	<b>if</b> (<a class="local col9 ref" href="#349mm" title='mm' data-ref="349mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::map_count" title='mm_struct::map_count' data-ref="mm_struct::map_count">map_count</a> &gt;= <a class="ref" href="../include/linux/mm.h.html#sysctl_max_map_count" title='sysctl_max_map_count' data-ref="sysctl_max_map_count">sysctl_max_map_count</a>)</td></tr>
<tr><th id="2642">2642</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2643">2643</th><td></td></tr>
<tr><th id="2644">2644</th><td>	<b>return</b> <a class="ref fn" href="#__split_vma" title='__split_vma' data-ref="__split_vma">__split_vma</a>(<a class="local col9 ref" href="#349mm" title='mm' data-ref="349mm">mm</a>, <a class="local col0 ref" href="#350vma" title='vma' data-ref="350vma">vma</a>, <a class="local col1 ref" href="#351addr" title='addr' data-ref="351addr">addr</a>, <a class="local col2 ref" href="#352new_below" title='new_below' data-ref="352new_below">new_below</a>);</td></tr>
<tr><th id="2645">2645</th><td>}</td></tr>
<tr><th id="2646">2646</th><td></td></tr>
<tr><th id="2647">2647</th><td><i>/* Munmap is split into 2 main parts -- this part which finds</i></td></tr>
<tr><th id="2648">2648</th><td><i> * what needs doing, and the areas themselves, which do the</i></td></tr>
<tr><th id="2649">2649</th><td><i> * work.  This now handles partial unmappings.</i></td></tr>
<tr><th id="2650">2650</th><td><i> * Jeremy Fitzhardinge &lt;jeremy@goop.org&gt;</i></td></tr>
<tr><th id="2651">2651</th><td><i> */</i></td></tr>
<tr><th id="2652">2652</th><td><em>int</em> <dfn class="decl def fn" id="do_munmap" title='do_munmap' data-ref="do_munmap">do_munmap</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col3 decl" id="353mm" title='mm' data-type='struct mm_struct *' data-ref="353mm">mm</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col4 decl" id="354start" title='start' data-type='unsigned long' data-ref="354start">start</dfn>, <a class="typedef" href="../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> <dfn class="local col5 decl" id="355len" title='len' data-type='size_t' data-ref="355len">len</dfn>,</td></tr>
<tr><th id="2653">2653</th><td>	      <b>struct</b> <a class="type" href="../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a> *<dfn class="local col6 decl" id="356uf" title='uf' data-type='struct list_head *' data-ref="356uf">uf</dfn>)</td></tr>
<tr><th id="2654">2654</th><td>{</td></tr>
<tr><th id="2655">2655</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="357end" title='end' data-type='unsigned long' data-ref="357end">end</dfn>;</td></tr>
<tr><th id="2656">2656</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col8 decl" id="358vma" title='vma' data-type='struct vm_area_struct *' data-ref="358vma">vma</dfn>, *<dfn class="local col9 decl" id="359prev" title='prev' data-type='struct vm_area_struct *' data-ref="359prev">prev</dfn>, *<dfn class="local col0 decl" id="360last" title='last' data-type='struct vm_area_struct *' data-ref="360last">last</dfn>;</td></tr>
<tr><th id="2657">2657</th><td></td></tr>
<tr><th id="2658">2658</th><td>	<b>if</b> ((<a class="macro" href="../include/linux/mm.h.html#1216" title="((unsigned long)(start) &amp; ~(~(((1UL) &lt;&lt; 12)-1)))" data-ref="_M/offset_in_page">offset_in_page</a>(<a class="local col4 ref" href="#354start" title='start' data-ref="354start">start</a>)) || <a class="local col4 ref" href="#354start" title='start' data-ref="354start">start</a> &gt; <a class="macro" href="../arch/x86/include/asm/processor.h.html#881" title="(test_ti_thread_flag(((struct thread_info *)get_current()), 29) ? ((get_current()-&gt;personality &amp; ADDR_LIMIT_3GB) ? 0xc0000000 : 0xFFFFe000) : ((1UL &lt;&lt; 47) - ((1UL) &lt;&lt; 12)))" data-ref="_M/TASK_SIZE">TASK_SIZE</a> || <a class="local col5 ref" href="#355len" title='len' data-ref="355len">len</a> &gt; <a class="macro" href="../arch/x86/include/asm/processor.h.html#881" title="(test_ti_thread_flag(((struct thread_info *)get_current()), 29) ? ((get_current()-&gt;personality &amp; ADDR_LIMIT_3GB) ? 0xc0000000 : 0xFFFFe000) : ((1UL &lt;&lt; 47) - ((1UL) &lt;&lt; 12)))" data-ref="_M/TASK_SIZE">TASK_SIZE</a>-<a class="local col4 ref" href="#354start" title='start' data-ref="354start">start</a>)</td></tr>
<tr><th id="2659">2659</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2660">2660</th><td></td></tr>
<tr><th id="2661">2661</th><td>	<a class="local col5 ref" href="#355len" title='len' data-ref="355len">len</a> = <a class="macro" href="../include/linux/mm.h.html#134" title="((((len)) + ((typeof((len)))((((1UL) &lt;&lt; 12))) - 1)) &amp; ~((typeof((len)))((((1UL) &lt;&lt; 12))) - 1))" data-ref="_M/PAGE_ALIGN">PAGE_ALIGN</a>(<a class="local col5 ref" href="#355len" title='len' data-ref="355len">len</a>);</td></tr>
<tr><th id="2662">2662</th><td>	<b>if</b> (<a class="local col5 ref" href="#355len" title='len' data-ref="355len">len</a> == <var>0</var>)</td></tr>
<tr><th id="2663">2663</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2664">2664</th><td></td></tr>
<tr><th id="2665">2665</th><td>	<i>/* Find the first overlapping VMA */</i></td></tr>
<tr><th id="2666">2666</th><td>	<a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a> = <a class="ref fn" href="#find_vma" title='find_vma' data-ref="find_vma">find_vma</a>(<a class="local col3 ref" href="#353mm" title='mm' data-ref="353mm">mm</a>, <a class="local col4 ref" href="#354start" title='start' data-ref="354start">start</a>);</td></tr>
<tr><th id="2667">2667</th><td>	<b>if</b> (!<a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>)</td></tr>
<tr><th id="2668">2668</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2669">2669</th><td>	<a class="local col9 ref" href="#359prev" title='prev' data-ref="359prev">prev</a> = <a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a>;</td></tr>
<tr><th id="2670">2670</th><td>	<i>/* we have  start &lt; vma-&gt;vm_end  */</i></td></tr>
<tr><th id="2671">2671</th><td></td></tr>
<tr><th id="2672">2672</th><td>	<i>/* if it doesn't overlap, we have nothing.. */</i></td></tr>
<tr><th id="2673">2673</th><td>	<a class="local col7 ref" href="#357end" title='end' data-ref="357end">end</a> = <a class="local col4 ref" href="#354start" title='start' data-ref="354start">start</a> + <a class="local col5 ref" href="#355len" title='len' data-ref="355len">len</a>;</td></tr>
<tr><th id="2674">2674</th><td>	<b>if</b> (<a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &gt;= <a class="local col7 ref" href="#357end" title='end' data-ref="357end">end</a>)</td></tr>
<tr><th id="2675">2675</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2676">2676</th><td></td></tr>
<tr><th id="2677">2677</th><td>	<i>/*</i></td></tr>
<tr><th id="2678">2678</th><td><i>	 * If we need to split any vma, do it now to save pain later.</i></td></tr>
<tr><th id="2679">2679</th><td><i>	 *</i></td></tr>
<tr><th id="2680">2680</th><td><i>	 * Note: mremap's move_vma VM_ACCOUNT handling assumes a partially</i></td></tr>
<tr><th id="2681">2681</th><td><i>	 * unmapped vm_area_struct will remain in use: so lower split_vma</i></td></tr>
<tr><th id="2682">2682</th><td><i>	 * places tmp vma above, and higher split_vma places tmp vma below.</i></td></tr>
<tr><th id="2683">2683</th><td><i>	 */</i></td></tr>
<tr><th id="2684">2684</th><td>	<b>if</b> (<a class="local col4 ref" href="#354start" title='start' data-ref="354start">start</a> &gt; <a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>) {</td></tr>
<tr><th id="2685">2685</th><td>		<em>int</em> <dfn class="local col1 decl" id="361error" title='error' data-type='int' data-ref="361error">error</dfn>;</td></tr>
<tr><th id="2686">2686</th><td></td></tr>
<tr><th id="2687">2687</th><td>		<i>/*</i></td></tr>
<tr><th id="2688">2688</th><td><i>		 * Make sure that map_count on return from munmap() will</i></td></tr>
<tr><th id="2689">2689</th><td><i>		 * not exceed its limit; but let map_count go just above</i></td></tr>
<tr><th id="2690">2690</th><td><i>		 * its limit temporarily, to help free resources as expected.</i></td></tr>
<tr><th id="2691">2691</th><td><i>		 */</i></td></tr>
<tr><th id="2692">2692</th><td>		<b>if</b> (<a class="local col7 ref" href="#357end" title='end' data-ref="357end">end</a> &lt; <a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> &amp;&amp; <a class="local col3 ref" href="#353mm" title='mm' data-ref="353mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::map_count" title='mm_struct::map_count' data-ref="mm_struct::map_count">map_count</a> &gt;= <a class="ref" href="../include/linux/mm.h.html#sysctl_max_map_count" title='sysctl_max_map_count' data-ref="sysctl_max_map_count">sysctl_max_map_count</a>)</td></tr>
<tr><th id="2693">2693</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2694">2694</th><td></td></tr>
<tr><th id="2695">2695</th><td>		<a class="local col1 ref" href="#361error" title='error' data-ref="361error">error</a> = <a class="ref fn" href="#__split_vma" title='__split_vma' data-ref="__split_vma">__split_vma</a>(<a class="local col3 ref" href="#353mm" title='mm' data-ref="353mm">mm</a>, <a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>, <a class="local col4 ref" href="#354start" title='start' data-ref="354start">start</a>, <var>0</var>);</td></tr>
<tr><th id="2696">2696</th><td>		<b>if</b> (<a class="local col1 ref" href="#361error" title='error' data-ref="361error">error</a>)</td></tr>
<tr><th id="2697">2697</th><td>			<b>return</b> <a class="local col1 ref" href="#361error" title='error' data-ref="361error">error</a>;</td></tr>
<tr><th id="2698">2698</th><td>		<a class="local col9 ref" href="#359prev" title='prev' data-ref="359prev">prev</a> = <a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>;</td></tr>
<tr><th id="2699">2699</th><td>	}</td></tr>
<tr><th id="2700">2700</th><td></td></tr>
<tr><th id="2701">2701</th><td>	<i>/* Does it split the last one? */</i></td></tr>
<tr><th id="2702">2702</th><td>	<a class="local col0 ref" href="#360last" title='last' data-ref="360last">last</a> = <a class="ref fn" href="#find_vma" title='find_vma' data-ref="find_vma">find_vma</a>(<a class="local col3 ref" href="#353mm" title='mm' data-ref="353mm">mm</a>, <a class="local col7 ref" href="#357end" title='end' data-ref="357end">end</a>);</td></tr>
<tr><th id="2703">2703</th><td>	<b>if</b> (<a class="local col0 ref" href="#360last" title='last' data-ref="360last">last</a> &amp;&amp; <a class="local col7 ref" href="#357end" title='end' data-ref="357end">end</a> &gt; <a class="local col0 ref" href="#360last" title='last' data-ref="360last">last</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>) {</td></tr>
<tr><th id="2704">2704</th><td>		<em>int</em> <dfn class="local col2 decl" id="362error" title='error' data-type='int' data-ref="362error">error</dfn> = <a class="ref fn" href="#__split_vma" title='__split_vma' data-ref="__split_vma">__split_vma</a>(<a class="local col3 ref" href="#353mm" title='mm' data-ref="353mm">mm</a>, <a class="local col0 ref" href="#360last" title='last' data-ref="360last">last</a>, <a class="local col7 ref" href="#357end" title='end' data-ref="357end">end</a>, <var>1</var>);</td></tr>
<tr><th id="2705">2705</th><td>		<b>if</b> (<a class="local col2 ref" href="#362error" title='error' data-ref="362error">error</a>)</td></tr>
<tr><th id="2706">2706</th><td>			<b>return</b> <a class="local col2 ref" href="#362error" title='error' data-ref="362error">error</a>;</td></tr>
<tr><th id="2707">2707</th><td>	}</td></tr>
<tr><th id="2708">2708</th><td>	<a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a> = <a class="local col9 ref" href="#359prev" title='prev' data-ref="359prev">prev</a> ? <a class="local col9 ref" href="#359prev" title='prev' data-ref="359prev">prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a> : <a class="local col3 ref" href="#353mm" title='mm' data-ref="353mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap" title='mm_struct::mmap' data-ref="mm_struct::mmap">mmap</a>;</td></tr>
<tr><th id="2709">2709</th><td></td></tr>
<tr><th id="2710">2710</th><td>	<b>if</b> (<a class="macro" href="../include/linux/compiler.h.html#77" title="__builtin_expect(!!(uf), 0)" data-ref="_M/unlikely">unlikely</a>(<a class="local col6 ref" href="#356uf" title='uf' data-ref="356uf">uf</a>)) {</td></tr>
<tr><th id="2711">2711</th><td>		<i>/*</i></td></tr>
<tr><th id="2712">2712</th><td><i>		 * If userfaultfd_unmap_prep returns an error the vmas</i></td></tr>
<tr><th id="2713">2713</th><td><i>		 * will remain splitted, but userland will get a</i></td></tr>
<tr><th id="2714">2714</th><td><i>		 * highly unexpected error anyway. This is no</i></td></tr>
<tr><th id="2715">2715</th><td><i>		 * different than the case where the first of the two</i></td></tr>
<tr><th id="2716">2716</th><td><i>		 * __split_vma fails, but we don't undo the first</i></td></tr>
<tr><th id="2717">2717</th><td><i>		 * split, despite we could. This is unlikely enough</i></td></tr>
<tr><th id="2718">2718</th><td><i>		 * failure that it's not worth optimizing it for.</i></td></tr>
<tr><th id="2719">2719</th><td><i>		 */</i></td></tr>
<tr><th id="2720">2720</th><td>		<em>int</em> <dfn class="local col3 decl" id="363error" title='error' data-type='int' data-ref="363error">error</dfn> = <a class="ref fn" href="../include/linux/userfaultfd_k.h.html#userfaultfd_unmap_prep" title='userfaultfd_unmap_prep' data-ref="userfaultfd_unmap_prep">userfaultfd_unmap_prep</a>(<a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>, <a class="local col4 ref" href="#354start" title='start' data-ref="354start">start</a>, <a class="local col7 ref" href="#357end" title='end' data-ref="357end">end</a>, <a class="local col6 ref" href="#356uf" title='uf' data-ref="356uf">uf</a>);</td></tr>
<tr><th id="2721">2721</th><td>		<b>if</b> (<a class="local col3 ref" href="#363error" title='error' data-ref="363error">error</a>)</td></tr>
<tr><th id="2722">2722</th><td>			<b>return</b> <a class="local col3 ref" href="#363error" title='error' data-ref="363error">error</a>;</td></tr>
<tr><th id="2723">2723</th><td>	}</td></tr>
<tr><th id="2724">2724</th><td></td></tr>
<tr><th id="2725">2725</th><td>	<i>/*</i></td></tr>
<tr><th id="2726">2726</th><td><i>	 * unlock any mlock()ed ranges before detaching vmas</i></td></tr>
<tr><th id="2727">2727</th><td><i>	 */</i></td></tr>
<tr><th id="2728">2728</th><td>	<b>if</b> (<a class="local col3 ref" href="#353mm" title='mm' data-ref="353mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::locked_vm" title='mm_struct::locked_vm' data-ref="mm_struct::locked_vm">locked_vm</a>) {</td></tr>
<tr><th id="2729">2729</th><td>		<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col4 decl" id="364tmp" title='tmp' data-type='struct vm_area_struct *' data-ref="364tmp">tmp</dfn> = <a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>;</td></tr>
<tr><th id="2730">2730</th><td>		<b>while</b> (<a class="local col4 ref" href="#364tmp" title='tmp' data-ref="364tmp">tmp</a> &amp;&amp; <a class="local col4 ref" href="#364tmp" title='tmp' data-ref="364tmp">tmp</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &lt; <a class="local col7 ref" href="#357end" title='end' data-ref="357end">end</a>) {</td></tr>
<tr><th id="2731">2731</th><td>			<b>if</b> (<a class="local col4 ref" href="#364tmp" title='tmp' data-ref="364tmp">tmp</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#180" title="0x00002000" data-ref="_M/VM_LOCKED">VM_LOCKED</a>) {</td></tr>
<tr><th id="2732">2732</th><td>				<a class="local col3 ref" href="#353mm" title='mm' data-ref="353mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::locked_vm" title='mm_struct::locked_vm' data-ref="mm_struct::locked_vm">locked_vm</a> -= <a class="ref fn" href="../include/linux/mm.h.html#vma_pages" title='vma_pages' data-ref="vma_pages">vma_pages</a>(<a class="local col4 ref" href="#364tmp" title='tmp' data-ref="364tmp">tmp</a>);</td></tr>
<tr><th id="2733">2733</th><td>				<a class="ref fn" href="internal.h.html#munlock_vma_pages_all" title='munlock_vma_pages_all' data-ref="munlock_vma_pages_all">munlock_vma_pages_all</a>(<a class="local col4 ref" href="#364tmp" title='tmp' data-ref="364tmp">tmp</a>);</td></tr>
<tr><th id="2734">2734</th><td>			}</td></tr>
<tr><th id="2735">2735</th><td>			<a class="local col4 ref" href="#364tmp" title='tmp' data-ref="364tmp">tmp</a> = <a class="local col4 ref" href="#364tmp" title='tmp' data-ref="364tmp">tmp</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>;</td></tr>
<tr><th id="2736">2736</th><td>		}</td></tr>
<tr><th id="2737">2737</th><td>	}</td></tr>
<tr><th id="2738">2738</th><td></td></tr>
<tr><th id="2739">2739</th><td>	<i>/*</i></td></tr>
<tr><th id="2740">2740</th><td><i>	 * Remove the vma's, and unmap the actual pages</i></td></tr>
<tr><th id="2741">2741</th><td><i>	 */</i></td></tr>
<tr><th id="2742">2742</th><td>	<a class="tu ref fn" href="#detach_vmas_to_be_unmapped" title='detach_vmas_to_be_unmapped' data-use='c' data-ref="detach_vmas_to_be_unmapped">detach_vmas_to_be_unmapped</a>(<a class="local col3 ref" href="#353mm" title='mm' data-ref="353mm">mm</a>, <a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>, <a class="local col9 ref" href="#359prev" title='prev' data-ref="359prev">prev</a>, <a class="local col7 ref" href="#357end" title='end' data-ref="357end">end</a>);</td></tr>
<tr><th id="2743">2743</th><td>	<a class="tu ref fn" href="#unmap_region" title='unmap_region' data-use='c' data-ref="unmap_region">unmap_region</a>(<a class="local col3 ref" href="#353mm" title='mm' data-ref="353mm">mm</a>, <a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>, <a class="local col9 ref" href="#359prev" title='prev' data-ref="359prev">prev</a>, <a class="local col4 ref" href="#354start" title='start' data-ref="354start">start</a>, <a class="local col7 ref" href="#357end" title='end' data-ref="357end">end</a>);</td></tr>
<tr><th id="2744">2744</th><td></td></tr>
<tr><th id="2745">2745</th><td>	<a class="ref fn" href="../arch/x86/include/asm/mmu_context.h.html#arch_unmap" title='arch_unmap' data-ref="arch_unmap">arch_unmap</a>(<a class="local col3 ref" href="#353mm" title='mm' data-ref="353mm">mm</a>, <a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>, <a class="local col4 ref" href="#354start" title='start' data-ref="354start">start</a>, <a class="local col7 ref" href="#357end" title='end' data-ref="357end">end</a>);</td></tr>
<tr><th id="2746">2746</th><td></td></tr>
<tr><th id="2747">2747</th><td>	<i>/* Fix up all other VM information */</i></td></tr>
<tr><th id="2748">2748</th><td>	<a class="tu ref fn" href="#remove_vma_list" title='remove_vma_list' data-use='c' data-ref="remove_vma_list">remove_vma_list</a>(<a class="local col3 ref" href="#353mm" title='mm' data-ref="353mm">mm</a>, <a class="local col8 ref" href="#358vma" title='vma' data-ref="358vma">vma</a>);</td></tr>
<tr><th id="2749">2749</th><td></td></tr>
<tr><th id="2750">2750</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2751">2751</th><td>}</td></tr>
<tr><th id="2752">2752</th><td></td></tr>
<tr><th id="2753">2753</th><td><em>int</em> <dfn class="decl def fn" id="vm_munmap" title='vm_munmap' data-ref="vm_munmap">vm_munmap</dfn>(<em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="365start" title='start' data-type='unsigned long' data-ref="365start">start</dfn>, <a class="typedef" href="../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> <dfn class="local col6 decl" id="366len" title='len' data-type='size_t' data-ref="366len">len</dfn>)</td></tr>
<tr><th id="2754">2754</th><td>{</td></tr>
<tr><th id="2755">2755</th><td>	<em>int</em> <dfn class="local col7 decl" id="367ret" title='ret' data-type='int' data-ref="367ret">ret</dfn>;</td></tr>
<tr><th id="2756">2756</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col8 decl" id="368mm" title='mm' data-type='struct mm_struct *' data-ref="368mm">mm</dfn> = <a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::mm" title='task_struct::mm' data-ref="task_struct::mm">mm</a>;</td></tr>
<tr><th id="2757">2757</th><td>	<a class="macro" href="../include/linux/list.h.html#23" title="struct list_head uf = { &amp;(uf), &amp;(uf) }" data-ref="_M/LIST_HEAD">LIST_HEAD</a>(<dfn class="local col9 decl" id="369uf" title='uf' data-type='struct list_head' data-ref="369uf"><a class="local col9 ref" href="#2757" title='uf' data-ref="369uf"><a class="local col9 ref" href="#2757" title='uf' data-ref="369uf"><a class="local col9 ref" href="#2757" title='uf' data-ref="369uf"><a class="local col9 ref" href="#2757" title='uf' data-ref="369uf">uf</a></a></a></a></dfn>);</td></tr>
<tr><th id="2758">2758</th><td></td></tr>
<tr><th id="2759">2759</th><td>	<b>if</b> (<a class="ref fn" href="../include/linux/rwsem.h.html#down_write_killable" title='down_write_killable' data-ref="down_write_killable">down_write_killable</a>(&amp;<a class="local col8 ref" href="#368mm" title='mm' data-ref="368mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>))</td></tr>
<tr><th id="2760">2760</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#8" title="4" data-ref="_M/EINTR">EINTR</a>;</td></tr>
<tr><th id="2761">2761</th><td></td></tr>
<tr><th id="2762">2762</th><td>	<a class="local col7 ref" href="#367ret" title='ret' data-ref="367ret">ret</a> = <a class="ref fn" href="#do_munmap" title='do_munmap' data-ref="do_munmap">do_munmap</a>(<a class="local col8 ref" href="#368mm" title='mm' data-ref="368mm">mm</a>, <a class="local col5 ref" href="#365start" title='start' data-ref="365start">start</a>, <a class="local col6 ref" href="#366len" title='len' data-ref="366len">len</a>, &amp;<a class="local col9 ref" href="#2757" title='uf' data-ref="369uf">uf</a>);</td></tr>
<tr><th id="2763">2763</th><td>	<a class="ref fn" href="../include/linux/rwsem.h.html#up_write" title='up_write' data-ref="up_write">up_write</a>(&amp;<a class="local col8 ref" href="#368mm" title='mm' data-ref="368mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>);</td></tr>
<tr><th id="2764">2764</th><td>	<a class="ref fn" href="../include/linux/userfaultfd_k.h.html#userfaultfd_unmap_complete" title='userfaultfd_unmap_complete' data-ref="userfaultfd_unmap_complete">userfaultfd_unmap_complete</a>(<a class="local col8 ref" href="#368mm" title='mm' data-ref="368mm">mm</a>, &amp;<a class="local col9 ref" href="#2757" title='uf' data-ref="369uf">uf</a>);</td></tr>
<tr><th id="2765">2765</th><td>	<b>return</b> <a class="local col7 ref" href="#367ret" title='ret' data-ref="367ret">ret</a>;</td></tr>
<tr><th id="2766">2766</th><td>}</td></tr>
<tr><th id="2767">2767</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(vm_munmap) vm_munmap; static const char __kstrtab_vm_munmap[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vm_munmap&quot;; static const struct kernel_symbol __ksymtab_vm_munmap __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vm_munmap&quot;), used)) = { (unsigned long)&amp;vm_munmap, __kstrtab_vm_munmap }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vm_munmap" title='vm_munmap' data-ref="vm_munmap"><a class="ref fn" href="#vm_munmap" title='vm_munmap' data-ref="vm_munmap"><a class="ref fn" href="#vm_munmap" title='vm_munmap' data-ref="vm_munmap"><a class="ref fn" href="#vm_munmap" title='vm_munmap' data-ref="vm_munmap">vm_munmap</a></a></a></a>);</td></tr>
<tr><th id="2768">2768</th><td></td></tr>
<tr><th id="2769">2769</th><td><a class="macro" href="../include/linux/syscalls.h.html#197" title="static const char *types__munmap[] = { &quot;unsigned long&quot;, &quot;size_t&quot; }; static const char *args__munmap[] = { &quot;addr&quot;, &quot;len&quot; }; static struct syscall_metadata __syscall_meta__munmap; static struct trace_event_call __attribute__((__used__)) event_enter__munmap = { .class = &amp;event_class_syscall_enter, { .name = &quot;sys_enter&quot;&quot;_munmap&quot;, }, .event.funcs = &amp;enter_syscall_print_funcs, .data = (void *)&amp;__syscall_meta__munmap, .flags = TRACE_EVENT_FL_CAP_ANY, }; static struct trace_event_call __attribute__((__used__)) __attribute__((section(&quot;_ftrace_events&quot;))) *__event_enter__munmap = &amp;event_enter__munmap;; static struct syscall_metadata __syscall_meta__munmap; static struct trace_event_call __attribute__((__used__)) event_exit__munmap = { .class = &amp;event_class_syscall_exit, { .name = &quot;sys_exit&quot;&quot;_munmap&quot;, }, .event.funcs = &amp;exit_syscall_print_funcs, .data = (void *)&amp;__syscall_meta__munmap, .flags = TRACE_EVENT_FL_CAP_ANY, }; static struct trace_event_call __attribute__((__used__)) __attribute__((section(&quot;_ftrace_events&quot;))) *__event_exit__munmap = &amp;event_exit__munmap;; static struct syscall_metadata __attribute__((__used__)) __syscall_meta__munmap = { .name = &quot;sys&quot;&quot;_munmap&quot;, .syscall_nr = -1, .nb_args = 2, .types = 2 ? types__munmap : ((void *)0), .args = 2 ? args__munmap : ((void *)0), .enter_event = &amp;event_enter__munmap, .exit_event = &amp;event_exit__munmap, .enter_fields = { &amp;(__syscall_meta__munmap.enter_fields), &amp;(__syscall_meta__munmap.enter_fields) }, }; static struct syscall_metadata __attribute__((__used__)) __attribute__((section(&quot;__syscalls_metadata&quot;))) *__p_syscall_meta__munmap = &amp;__syscall_meta__munmap; long sys_munmap(unsigned long addr, size_t len) __attribute__((alias(&quot;SyS_munmap&quot;))); static inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) long SYSC_munmap(unsigned long addr, size_t len); long SyS_munmap(__typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) addr, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( size_t)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( size_t)0), typeof(0ULL))), 0LL, 0L)) len); long SyS_munmap(__typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) addr, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( size_t)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( size_t)0), typeof(0ULL))), 0LL, 0L)) len) { long ret = SYSC_munmap(( unsigned long) addr, ( size_t) len); (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })), (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( size_t)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( size_t)0), typeof(0ULL))) &amp;&amp; sizeof(size_t) &gt; sizeof(long))); })); do { } while (0); return ret; } static inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) long SYSC_munmap(unsigned long addr, size_t len)" data-ref="_M/SYSCALL_DEFINE2">SYSCALL_DEFINE2</a>(munmap, <em>unsigned</em> <em>long</em>, <dfn class="local col0 decl" id="370addr" title='addr' data-type='unsigned long' data-ref="370addr"><dfn class="local col2 decl" id="372addr" title='addr' data-type='unsigned long' data-ref="372addr"><dfn class="local col4 decl" id="374addr" title='addr' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="374addr"><dfn class="local col6 decl" id="376addr" title='addr' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="376addr"><a class="local col6 ref" href="#2769" title='addr' data-ref="376addr"><dfn class="local col8 decl" id="378addr" title='addr' data-type='unsigned long' data-ref="378addr">addr</dfn></a></dfn></dfn></dfn></dfn>, <a class="typedef" href="../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a>, <dfn class="local col1 decl" id="371len" title='len' data-type='size_t' data-ref="371len"><dfn class="local col3 decl" id="373len" title='len' data-type='size_t' data-ref="373len"><dfn class="local col5 decl" id="375len" title='len' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((size_t)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((size_t)0), typeof (0ULL))), 0LL, 0L))' data-ref="375len"><dfn class="local col7 decl" id="377len" title='len' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((size_t)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((size_t)0), typeof (0ULL))), 0LL, 0L))' data-ref="377len"><a class="local col7 ref" href="#2769" title='len' data-ref="377len"><dfn class="local col9 decl" id="379len" title='len' data-type='size_t' data-ref="379len">len</dfn></a></dfn></dfn></dfn></dfn>)</td></tr>
<tr><th id="2770">2770</th><td>{</td></tr>
<tr><th id="2771">2771</th><td>	<a class="macro" href="../include/linux/profile.h.html#135" title="do { } while (0)" data-ref="_M/profile_munmap">profile_munmap</a>(addr);</td></tr>
<tr><th id="2772">2772</th><td>	<b>return</b> <a class="ref fn" href="#vm_munmap" title='vm_munmap' data-ref="vm_munmap">vm_munmap</a>(<a class="local col8 ref" href="#2769" title='addr' data-ref="378addr">addr</a>, <a class="local col9 ref" href="#2769" title='len' data-ref="379len">len</a>);</td></tr>
<tr><th id="2773">2773</th><td>}</td></tr>
<tr><th id="2774">2774</th><td></td></tr>
<tr><th id="2775">2775</th><td></td></tr>
<tr><th id="2776">2776</th><td><i>/*</i></td></tr>
<tr><th id="2777">2777</th><td><i> * Emulation of deprecated remap_file_pages() syscall.</i></td></tr>
<tr><th id="2778">2778</th><td><i> */</i></td></tr>
<tr><th id="2779">2779</th><td><a class="macro" href="../include/linux/syscalls.h.html#200" title="static const char *types__remap_file_pages[] = { &quot;unsigned long&quot;, &quot;unsigned long&quot;, &quot;unsigned long&quot;, &quot;unsigned long&quot;, &quot;unsigned long&quot; }; static const char *args__remap_file_pages[] = { &quot;start&quot;, &quot;size&quot;, &quot;prot&quot;, &quot;pgoff&quot;, &quot;flags&quot; }; static struct syscall_metadata __syscall_meta__remap_file_pages; static struct trace_event_call __attribute__((__used__)) event_enter__remap_file_pages = { .class = &amp;event_class_syscall_enter, { .name = &quot;sys_enter&quot;&quot;_remap_file_pages&quot;, }, .event.funcs = &amp;enter_syscall_print_funcs, .data = (void *)&amp;__syscall_meta__remap_file_pages, .flags = TRACE_EVENT_FL_CAP_ANY, }; static struct trace_event_call __attribute__((__used__)) __attribute__((section(&quot;_ftrace_events&quot;))) *__event_enter__remap_file_pages = &amp;event_enter__remap_file_pages;; static struct syscall_metadata __syscall_meta__remap_file_pages; static struct trace_event_call __attribute__((__used__)) event_exit__remap_file_pages = { .class = &amp;event_class_syscall_exit, { .name = &quot;sys_exit&quot;&quot;_remap_file_pages&quot;, }, .event.funcs = &amp;exit_syscall_print_funcs, .data = (void *)&amp;__syscall_meta__remap_file_pages, .flags = TRACE_EVENT_FL_CAP_ANY, }; static struct trace_event_call __attribute__((__used__)) __attribute__((section(&quot;_ftrace_events&quot;))) *__event_exit__remap_file_pages = &amp;event_exit__remap_file_pages;; static struct syscall_metadata __attribute__((__used__)) __syscall_meta__remap_file_pages = { .name = &quot;sys&quot;&quot;_remap_file_pages&quot;, .syscall_nr = -1, .nb_args = 5, .types = 5 ? types__remap_file_pages : ((void *)0), .args = 5 ? args__remap_file_pages : ((void *)0), .enter_event = &amp;event_enter__remap_file_pages, .exit_event = &amp;event_exit__remap_file_pages, .enter_fields = { &amp;(__syscall_meta__remap_file_pages.enter_fields), &amp;(__syscall_meta__remap_file_pages.enter_fields) }, }; static struct syscall_metadata __attribute__((__used__)) __attribute__((section(&quot;__syscalls_metadata&quot;))) *__p_syscall_meta__remap_file_pages = &amp;__syscall_meta__remap_file_pages; long sys_remap_file_pages(unsigned long start, unsigned long size, unsigned long prot, unsigned long pgoff, unsigned long flags) __attribute__((alias(&quot;SyS_remap_file_pages&quot;))); static inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) long SYSC_remap_file_pages(unsigned long start, unsigned long size, unsigned long prot, unsigned long pgoff, unsigned long flags); long SyS_remap_file_pages(__typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) start, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) size, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) prot, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) pgoff, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) flags); long SyS_remap_file_pages(__typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) start, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) size, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) prot, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) pgoff, __typeof(__builtin_choose_expr((__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))), 0LL, 0L)) flags) { long ret = SYSC_remap_file_pages(( unsigned long) start, ( unsigned long) size, ( unsigned long) prot, ( unsigned long) pgoff, ( unsigned long) flags); (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })), (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })), (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })), (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })), (void)(sizeof(struct { int:(-!!(!(__builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0LL)) || __builtin_types_compatible_p(typeof(( unsigned long)0), typeof(0ULL))) &amp;&amp; sizeof(unsigned long) &gt; sizeof(long))); })); do { } while (0); return ret; } static inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) long SYSC_remap_file_pages(unsigned long start, unsigned long size, unsigned long prot, unsigned long pgoff, unsigned long flags)" data-ref="_M/SYSCALL_DEFINE5">SYSCALL_DEFINE5</a>(remap_file_pages, <em>unsigned</em> <em>long</em>, <dfn class="local col0 decl" id="380start" title='start' data-type='unsigned long' data-ref="380start"><dfn class="local col5 decl" id="385start" title='start' data-type='unsigned long' data-ref="385start"><dfn class="local col0 decl" id="390start" title='start' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="390start"><dfn class="local col5 decl" id="395start" title='start' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="395start"><a class="local col5 ref" href="#2779" title='start' data-ref="395start"><dfn class="local col0 decl" id="400start" title='start' data-type='unsigned long' data-ref="400start">start</dfn></a></dfn></dfn></dfn></dfn>, <em>unsigned</em> <em>long</em>, <dfn class="local col1 decl" id="381size" title='size' data-type='unsigned long' data-ref="381size"><dfn class="local col6 decl" id="386size" title='size' data-type='unsigned long' data-ref="386size"><dfn class="local col1 decl" id="391size" title='size' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="391size"><dfn class="local col6 decl" id="396size" title='size' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="396size"><a class="local col6 ref" href="#2779" title='size' data-ref="396size"><dfn class="local col1 decl" id="401size" title='size' data-type='unsigned long' data-ref="401size">size</dfn></a></dfn></dfn></dfn></dfn>,</td></tr>
<tr><th id="2780">2780</th><td>		<em>unsigned</em> <em>long</em>, <dfn class="local col2 decl" id="382prot" title='prot' data-type='unsigned long' data-ref="382prot"><dfn class="local col7 decl" id="387prot" title='prot' data-type='unsigned long' data-ref="387prot"><dfn class="local col2 decl" id="392prot" title='prot' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="392prot"><dfn class="local col7 decl" id="397prot" title='prot' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="397prot"><a class="local col7 ref" href="#2779" title='prot' data-ref="397prot"><dfn class="local col2 decl" id="402prot" title='prot' data-type='unsigned long' data-ref="402prot">prot</dfn></a></dfn></dfn></dfn></dfn>, <em>unsigned</em> <em>long</em>, <dfn class="local col3 decl" id="383pgoff" title='pgoff' data-type='unsigned long' data-ref="383pgoff"><dfn class="local col8 decl" id="388pgoff" title='pgoff' data-type='unsigned long' data-ref="388pgoff"><dfn class="local col3 decl" id="393pgoff" title='pgoff' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="393pgoff"><dfn class="local col8 decl" id="398pgoff" title='pgoff' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="398pgoff"><a class="local col8 ref" href="#2779" title='pgoff' data-ref="398pgoff"><dfn class="local col3 decl" id="403pgoff" title='pgoff' data-type='unsigned long' data-ref="403pgoff">pgoff</dfn></a></dfn></dfn></dfn></dfn>, <em>unsigned</em> <em>long</em>, <dfn class="local col4 decl" id="384flags" title='flags' data-type='unsigned long' data-ref="384flags"><dfn class="local col9 decl" id="389flags" title='flags' data-type='unsigned long' data-ref="389flags"><dfn class="local col4 decl" id="394flags" title='flags' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="394flags"><dfn class="local col9 decl" id="399flags" title='flags' data-type='typeof (__builtin_choose_expr((__builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0LL)) || __builtin_types_compatible_p(typeof ((unsigned long)0), typeof (0ULL))), 0LL, 0L))' data-ref="399flags"><a class="local col9 ref" href="#2779" title='flags' data-ref="399flags"><dfn class="local col4 decl" id="404flags" title='flags' data-type='unsigned long' data-ref="404flags">flags</dfn></a></dfn></dfn></dfn></dfn>)</td></tr>
<tr><th id="2781">2781</th><td>{</td></tr>
<tr><th id="2782">2782</th><td></td></tr>
<tr><th id="2783">2783</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col5 decl" id="405mm" title='mm' data-type='struct mm_struct *' data-ref="405mm">mm</dfn> = <a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::mm" title='task_struct::mm' data-ref="task_struct::mm">mm</a>;</td></tr>
<tr><th id="2784">2784</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col6 decl" id="406vma" title='vma' data-type='struct vm_area_struct *' data-ref="406vma">vma</dfn>;</td></tr>
<tr><th id="2785">2785</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="407populate" title='populate' data-type='unsigned long' data-ref="407populate">populate</dfn> = <var>0</var>;</td></tr>
<tr><th id="2786">2786</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="408ret" title='ret' data-type='unsigned long' data-ref="408ret">ret</dfn> = -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2787">2787</th><td>	<b>struct</b> <a class="type" href="../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col9 decl" id="409file" title='file' data-type='struct file *' data-ref="409file">file</dfn>;</td></tr>
<tr><th id="2788">2788</th><td></td></tr>
<tr><th id="2789">2789</th><td>	<a class="macro" href="../include/linux/printk.h.html#385" title="({ static bool __print_once __attribute__((__section__(&quot;.data..read_mostly&quot;))); bool __ret_print_once = !__print_once; if (!__print_once) { __print_once = true; printk(&quot;\001&quot; &quot;4&quot; &quot;mmap&quot; &quot;: &quot; &quot;%s (%d) uses deprecated remap_file_pages() syscall. See Documentation/vm/remap_file_pages.txt.\n&quot;, get_current()-&gt;comm, get_current()-&gt;pid); } __builtin_expect(!!(__ret_print_once), 0); })" data-ref="_M/pr_warn_once">pr_warn_once</a>(<q>"%s (%d) uses deprecated remap_file_pages() syscall. See Documentation/vm/remap_file_pages.txt.\n"</q>,</td></tr>
<tr><th id="2790">2790</th><td>		     current-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::comm" title='task_struct::comm' data-ref="task_struct::comm">comm</a>, current-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::pid" title='task_struct::pid' data-ref="task_struct::pid">pid</a>);</td></tr>
<tr><th id="2791">2791</th><td></td></tr>
<tr><th id="2792">2792</th><td>	<b>if</b> (<a class="local col2 ref" href="#2779" title='prot' data-ref="402prot">prot</a>)</td></tr>
<tr><th id="2793">2793</th><td>		<b>return</b> <a class="local col8 ref" href="#408ret" title='ret' data-ref="408ret">ret</a>;</td></tr>
<tr><th id="2794">2794</th><td>	<a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a> = <a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a> &amp; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#12" title="(~(((1UL) &lt;&lt; 12)-1))" data-ref="_M/PAGE_MASK">PAGE_MASK</a>;</td></tr>
<tr><th id="2795">2795</th><td>	<a class="local col1 ref" href="#2779" title='size' data-ref="401size">size</a> = <a class="local col1 ref" href="#2779" title='size' data-ref="401size">size</a> &amp; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#12" title="(~(((1UL) &lt;&lt; 12)-1))" data-ref="_M/PAGE_MASK">PAGE_MASK</a>;</td></tr>
<tr><th id="2796">2796</th><td></td></tr>
<tr><th id="2797">2797</th><td>	<b>if</b> (<a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a> + <a class="local col1 ref" href="#2779" title='size' data-ref="401size">size</a> &lt;= <a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a>)</td></tr>
<tr><th id="2798">2798</th><td>		<b>return</b> <a class="local col8 ref" href="#408ret" title='ret' data-ref="408ret">ret</a>;</td></tr>
<tr><th id="2799">2799</th><td></td></tr>
<tr><th id="2800">2800</th><td>	<i>/* Does pgoff wrap? */</i></td></tr>
<tr><th id="2801">2801</th><td>	<b>if</b> (<a class="local col3 ref" href="#2779" title='pgoff' data-ref="403pgoff">pgoff</a> + (<a class="local col1 ref" href="#2779" title='size' data-ref="401size">size</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>) &lt; <a class="local col3 ref" href="#2779" title='pgoff' data-ref="403pgoff">pgoff</a>)</td></tr>
<tr><th id="2802">2802</th><td>		<b>return</b> <a class="local col8 ref" href="#408ret" title='ret' data-ref="408ret">ret</a>;</td></tr>
<tr><th id="2803">2803</th><td></td></tr>
<tr><th id="2804">2804</th><td>	<b>if</b> (<a class="ref fn" href="../include/linux/rwsem.h.html#down_write_killable" title='down_write_killable' data-ref="down_write_killable">down_write_killable</a>(&amp;<a class="local col5 ref" href="#405mm" title='mm' data-ref="405mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>))</td></tr>
<tr><th id="2805">2805</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#8" title="4" data-ref="_M/EINTR">EINTR</a>;</td></tr>
<tr><th id="2806">2806</th><td></td></tr>
<tr><th id="2807">2807</th><td>	<a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a> = <a class="ref fn" href="#find_vma" title='find_vma' data-ref="find_vma">find_vma</a>(<a class="local col5 ref" href="#405mm" title='mm' data-ref="405mm">mm</a>, <a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a>);</td></tr>
<tr><th id="2808">2808</th><td></td></tr>
<tr><th id="2809">2809</th><td>	<b>if</b> (!<a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a> || !(<a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#166" title="0x00000008" data-ref="_M/VM_SHARED">VM_SHARED</a>))</td></tr>
<tr><th id="2810">2810</th><td>		<b>goto</b> <a class="lbl" href="#410out" data-ref="410out">out</a>;</td></tr>
<tr><th id="2811">2811</th><td></td></tr>
<tr><th id="2812">2812</th><td>	<b>if</b> (<a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a> &lt; <a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>)</td></tr>
<tr><th id="2813">2813</th><td>		<b>goto</b> <a class="lbl" href="#410out" data-ref="410out">out</a>;</td></tr>
<tr><th id="2814">2814</th><td></td></tr>
<tr><th id="2815">2815</th><td>	<b>if</b> (<a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a> + <a class="local col1 ref" href="#2779" title='size' data-ref="401size">size</a> &gt; <a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>) {</td></tr>
<tr><th id="2816">2816</th><td>		<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col1 decl" id="411next" title='next' data-type='struct vm_area_struct *' data-ref="411next">next</dfn>;</td></tr>
<tr><th id="2817">2817</th><td></td></tr>
<tr><th id="2818">2818</th><td>		<b>for</b> (<a class="local col1 ref" href="#411next" title='next' data-ref="411next">next</a> = <a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>; <a class="local col1 ref" href="#411next" title='next' data-ref="411next">next</a>; <a class="local col1 ref" href="#411next" title='next' data-ref="411next">next</a> = <a class="local col1 ref" href="#411next" title='next' data-ref="411next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>) {</td></tr>
<tr><th id="2819">2819</th><td>			<i>/* hole between vmas ? */</i></td></tr>
<tr><th id="2820">2820</th><td>			<b>if</b> (<a class="local col1 ref" href="#411next" title='next' data-ref="411next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> != <a class="local col1 ref" href="#411next" title='next' data-ref="411next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_prev" title='vm_area_struct::vm_prev' data-ref="vm_area_struct::vm_prev">vm_prev</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>)</td></tr>
<tr><th id="2821">2821</th><td>				<b>goto</b> <a class="lbl" href="#410out" data-ref="410out">out</a>;</td></tr>
<tr><th id="2822">2822</th><td></td></tr>
<tr><th id="2823">2823</th><td>			<b>if</b> (<a class="local col1 ref" href="#411next" title='next' data-ref="411next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a> != <a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>)</td></tr>
<tr><th id="2824">2824</th><td>				<b>goto</b> <a class="lbl" href="#410out" data-ref="410out">out</a>;</td></tr>
<tr><th id="2825">2825</th><td></td></tr>
<tr><th id="2826">2826</th><td>			<b>if</b> (<a class="local col1 ref" href="#411next" title='next' data-ref="411next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> != <a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a>)</td></tr>
<tr><th id="2827">2827</th><td>				<b>goto</b> <a class="lbl" href="#410out" data-ref="410out">out</a>;</td></tr>
<tr><th id="2828">2828</th><td></td></tr>
<tr><th id="2829">2829</th><td>			<b>if</b> (<a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a> + <a class="local col1 ref" href="#2779" title='size' data-ref="401size">size</a> &lt;= <a class="local col1 ref" href="#411next" title='next' data-ref="411next">next</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>)</td></tr>
<tr><th id="2830">2830</th><td>				<b>break</b>;</td></tr>
<tr><th id="2831">2831</th><td>		}</td></tr>
<tr><th id="2832">2832</th><td></td></tr>
<tr><th id="2833">2833</th><td>		<b>if</b> (!<a class="local col1 ref" href="#411next" title='next' data-ref="411next">next</a>)</td></tr>
<tr><th id="2834">2834</th><td>			<b>goto</b> <a class="lbl" href="#410out" data-ref="410out">out</a>;</td></tr>
<tr><th id="2835">2835</th><td>	}</td></tr>
<tr><th id="2836">2836</th><td></td></tr>
<tr><th id="2837">2837</th><td>	<a class="local col2 ref" href="#2779" title='prot' data-ref="402prot">prot</a> |= <a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#163" title="0x00000001" data-ref="_M/VM_READ">VM_READ</a> ? <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#10" title="0x1" data-ref="_M/PROT_READ">PROT_READ</a> : <var>0</var>;</td></tr>
<tr><th id="2838">2838</th><td>	<a class="local col2 ref" href="#2779" title='prot' data-ref="402prot">prot</a> |= <a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#164" title="0x00000002" data-ref="_M/VM_WRITE">VM_WRITE</a> ? <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#11" title="0x2" data-ref="_M/PROT_WRITE">PROT_WRITE</a> : <var>0</var>;</td></tr>
<tr><th id="2839">2839</th><td>	<a class="local col2 ref" href="#2779" title='prot' data-ref="402prot">prot</a> |= <a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#165" title="0x00000004" data-ref="_M/VM_EXEC">VM_EXEC</a> ? <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#12" title="0x4" data-ref="_M/PROT_EXEC">PROT_EXEC</a> : <var>0</var>;</td></tr>
<tr><th id="2840">2840</th><td></td></tr>
<tr><th id="2841">2841</th><td>	<a class="local col4 ref" href="#2779" title='flags' data-ref="404flags">flags</a> &amp;= <a class="macro" href="../include/uapi/asm-generic/mman.h.html#13" title="0x10000" data-ref="_M/MAP_NONBLOCK">MAP_NONBLOCK</a>;</td></tr>
<tr><th id="2842">2842</th><td>	<a class="local col4 ref" href="#2779" title='flags' data-ref="404flags">flags</a> |= <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#18" title="0x01" data-ref="_M/MAP_SHARED">MAP_SHARED</a> | <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#21" title="0x10" data-ref="_M/MAP_FIXED">MAP_FIXED</a> | <a class="macro" href="../include/uapi/asm-generic/mman.h.html#12" title="0x8000" data-ref="_M/MAP_POPULATE">MAP_POPULATE</a>;</td></tr>
<tr><th id="2843">2843</th><td>	<b>if</b> (<a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#180" title="0x00002000" data-ref="_M/VM_LOCKED">VM_LOCKED</a>) {</td></tr>
<tr><th id="2844">2844</th><td>		<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="412tmp" title='tmp' data-type='struct vm_area_struct *' data-ref="412tmp">tmp</dfn>;</td></tr>
<tr><th id="2845">2845</th><td>		<a class="local col4 ref" href="#2779" title='flags' data-ref="404flags">flags</a> |= <a class="macro" href="../include/uapi/asm-generic/mman.h.html#10" title="0x2000" data-ref="_M/MAP_LOCKED">MAP_LOCKED</a>;</td></tr>
<tr><th id="2846">2846</th><td></td></tr>
<tr><th id="2847">2847</th><td>		<i>/* drop PG_Mlocked flag for over-mapped range */</i></td></tr>
<tr><th id="2848">2848</th><td>		<b>for</b> (<a class="local col2 ref" href="#412tmp" title='tmp' data-ref="412tmp">tmp</a> = <a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>; <a class="local col2 ref" href="#412tmp" title='tmp' data-ref="412tmp">tmp</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &gt;= <a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a> + <a class="local col1 ref" href="#2779" title='size' data-ref="401size">size</a>;</td></tr>
<tr><th id="2849">2849</th><td>				<a class="local col2 ref" href="#412tmp" title='tmp' data-ref="412tmp">tmp</a> = <a class="local col2 ref" href="#412tmp" title='tmp' data-ref="412tmp">tmp</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>) {</td></tr>
<tr><th id="2850">2850</th><td>			<i>/*</i></td></tr>
<tr><th id="2851">2851</th><td><i>			 * Split pmd and munlock page on the border</i></td></tr>
<tr><th id="2852">2852</th><td><i>			 * of the range.</i></td></tr>
<tr><th id="2853">2853</th><td><i>			 */</i></td></tr>
<tr><th id="2854">2854</th><td>			<a class="ref fn" href="../include/linux/huge_mm.h.html#vma_adjust_trans_huge" title='vma_adjust_trans_huge' data-ref="vma_adjust_trans_huge">vma_adjust_trans_huge</a>(<a class="local col2 ref" href="#412tmp" title='tmp' data-ref="412tmp">tmp</a>, <a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a>, <a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a> + <a class="local col1 ref" href="#2779" title='size' data-ref="401size">size</a>, <var>0</var>);</td></tr>
<tr><th id="2855">2855</th><td></td></tr>
<tr><th id="2856">2856</th><td>			<a class="ref fn" href="internal.h.html#munlock_vma_pages_range" title='munlock_vma_pages_range' data-ref="munlock_vma_pages_range">munlock_vma_pages_range</a>(<a class="local col2 ref" href="#412tmp" title='tmp' data-ref="412tmp">tmp</a>,</td></tr>
<tr><th id="2857">2857</th><td>					<a class="macro" href="../include/linux/kernel.h.html#815" title="({ typeof(tmp-&gt;vm_start) __UNIQUE_ID_max1_129 = (tmp-&gt;vm_start); typeof(start) __UNIQUE_ID_max2_130 = (start); (void) (&amp;__UNIQUE_ID_max1_129 == &amp;__UNIQUE_ID_max2_130); __UNIQUE_ID_max1_129 &gt; __UNIQUE_ID_max2_130 ? __UNIQUE_ID_max1_129 : __UNIQUE_ID_max2_130; })" data-ref="_M/max">max</a>(<a class="local col2 ref" href="#412tmp" title='tmp' data-ref="412tmp">tmp</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>, <a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a>),</td></tr>
<tr><th id="2858">2858</th><td>					<a class="macro" href="../include/linux/kernel.h.html#799" title="({ typeof(tmp-&gt;vm_end) __UNIQUE_ID_min1_133 = (tmp-&gt;vm_end); typeof(start + size) __UNIQUE_ID_min2_134 = (start + size); (void) (&amp;__UNIQUE_ID_min1_133 == &amp;__UNIQUE_ID_min2_134); __UNIQUE_ID_min1_133 &lt; __UNIQUE_ID_min2_134 ? __UNIQUE_ID_min1_133 : __UNIQUE_ID_min2_134; })" data-ref="_M/min">min</a>(<a class="local col2 ref" href="#412tmp" title='tmp' data-ref="412tmp">tmp</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>, <a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a> + <a class="local col1 ref" href="#2779" title='size' data-ref="401size">size</a>));</td></tr>
<tr><th id="2859">2859</th><td>		}</td></tr>
<tr><th id="2860">2860</th><td>	}</td></tr>
<tr><th id="2861">2861</th><td></td></tr>
<tr><th id="2862">2862</th><td>	<a class="local col9 ref" href="#409file" title='file' data-ref="409file">file</a> = <a class="ref fn" href="../include/linux/fs.h.html#get_file" title='get_file' data-ref="get_file">get_file</a>(<a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>);</td></tr>
<tr><th id="2863">2863</th><td>	<a class="local col8 ref" href="#408ret" title='ret' data-ref="408ret">ret</a> = <a class="ref fn" href="../include/linux/mm.h.html#do_mmap_pgoff" title='do_mmap_pgoff' data-ref="do_mmap_pgoff">do_mmap_pgoff</a>(<a class="local col6 ref" href="#406vma" title='vma' data-ref="406vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>, <a class="local col0 ref" href="#2779" title='start' data-ref="400start">start</a>, <a class="local col1 ref" href="#2779" title='size' data-ref="401size">size</a>,</td></tr>
<tr><th id="2864">2864</th><td>			<a class="local col2 ref" href="#2779" title='prot' data-ref="402prot">prot</a>, <a class="local col4 ref" href="#2779" title='flags' data-ref="404flags">flags</a>, <a class="local col3 ref" href="#2779" title='pgoff' data-ref="403pgoff">pgoff</a>, &amp;<a class="local col7 ref" href="#407populate" title='populate' data-ref="407populate">populate</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="2865">2865</th><td>	<a class="ref fn" href="../include/linux/file.h.html#fput" title='fput' data-ref="fput">fput</a>(<a class="local col9 ref" href="#409file" title='file' data-ref="409file">file</a>);</td></tr>
<tr><th id="2866">2866</th><td><dfn class="lbl" id="410out" data-ref="410out">out</dfn>:</td></tr>
<tr><th id="2867">2867</th><td>	<a class="ref fn" href="../include/linux/rwsem.h.html#up_write" title='up_write' data-ref="up_write">up_write</a>(&amp;<a class="local col5 ref" href="#405mm" title='mm' data-ref="405mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>);</td></tr>
<tr><th id="2868">2868</th><td>	<b>if</b> (<a class="local col7 ref" href="#407populate" title='populate' data-ref="407populate">populate</a>)</td></tr>
<tr><th id="2869">2869</th><td>		<a class="ref fn" href="../include/linux/mm.h.html#mm_populate" title='mm_populate' data-ref="mm_populate">mm_populate</a>(<a class="local col8 ref" href="#408ret" title='ret' data-ref="408ret">ret</a>, <a class="local col7 ref" href="#407populate" title='populate' data-ref="407populate">populate</a>);</td></tr>
<tr><th id="2870">2870</th><td>	<b>if</b> (!<a class="macro" href="../include/linux/err.h.html#22" title="__builtin_expect(!!((unsigned long)(void *)(ret) &gt;= (unsigned long)-4095), 0)" data-ref="_M/IS_ERR_VALUE">IS_ERR_VALUE</a>(<a class="local col8 ref" href="#408ret" title='ret' data-ref="408ret">ret</a>))</td></tr>
<tr><th id="2871">2871</th><td>		<a class="local col8 ref" href="#408ret" title='ret' data-ref="408ret">ret</a> = <var>0</var>;</td></tr>
<tr><th id="2872">2872</th><td>	<b>return</b> <a class="local col8 ref" href="#408ret" title='ret' data-ref="408ret">ret</a>;</td></tr>
<tr><th id="2873">2873</th><td>}</td></tr>
<tr><th id="2874">2874</th><td></td></tr>
<tr><th id="2875">2875</th><td><em>static</em> <a class="macro" href="../include/linux/compiler-gcc.h.html#95" title="inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <em>void</em> <dfn class="tu decl def fn" id="verify_mm_writelocked" title='verify_mm_writelocked' data-type='void verify_mm_writelocked(struct mm_struct * mm)' data-ref="verify_mm_writelocked">verify_mm_writelocked</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col3 decl" id="413mm" title='mm' data-type='struct mm_struct *' data-ref="413mm">mm</dfn>)</td></tr>
<tr><th id="2876">2876</th><td>{</td></tr>
<tr><th id="2877">2877</th><td><u>#<span data-ppcond="2877">ifdef</span> <span class="macro" data-ref="_M/CONFIG_DEBUG_VM">CONFIG_DEBUG_VM</span></u></td></tr>
<tr><th id="2878">2878</th><td>	<b>if</b> (unlikely(down_read_trylock(&amp;mm-&gt;mmap_sem))) {</td></tr>
<tr><th id="2879">2879</th><td>		WARN_ON(<var>1</var>);</td></tr>
<tr><th id="2880">2880</th><td>		up_read(&amp;mm-&gt;mmap_sem);</td></tr>
<tr><th id="2881">2881</th><td>	}</td></tr>
<tr><th id="2882">2882</th><td><u>#<span data-ppcond="2877">endif</span></u></td></tr>
<tr><th id="2883">2883</th><td>}</td></tr>
<tr><th id="2884">2884</th><td></td></tr>
<tr><th id="2885">2885</th><td><i  data-doc="do_brk_flags">/*</i></td></tr>
<tr><th id="2886">2886</th><td><i  data-doc="do_brk_flags"> *  this is really a simplified "do_mmap".  it only handles</i></td></tr>
<tr><th id="2887">2887</th><td><i  data-doc="do_brk_flags"> *  anonymous maps.  eventually we may be able to do some</i></td></tr>
<tr><th id="2888">2888</th><td><i  data-doc="do_brk_flags"> *  brk-specific accounting here.</i></td></tr>
<tr><th id="2889">2889</th><td><i  data-doc="do_brk_flags"> */</i></td></tr>
<tr><th id="2890">2890</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="do_brk_flags" title='do_brk_flags' data-type='int do_brk_flags(unsigned long addr, unsigned long len, unsigned long flags, struct list_head * uf)' data-ref="do_brk_flags">do_brk_flags</dfn>(<em>unsigned</em> <em>long</em> <dfn class="local col4 decl" id="414addr" title='addr' data-type='unsigned long' data-ref="414addr">addr</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="415len" title='len' data-type='unsigned long' data-ref="415len">len</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="416flags" title='flags' data-type='unsigned long' data-ref="416flags">flags</dfn>, <b>struct</b> <a class="type" href="../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a> *<dfn class="local col7 decl" id="417uf" title='uf' data-type='struct list_head *' data-ref="417uf">uf</dfn>)</td></tr>
<tr><th id="2891">2891</th><td>{</td></tr>
<tr><th id="2892">2892</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col8 decl" id="418mm" title='mm' data-type='struct mm_struct *' data-ref="418mm">mm</dfn> = <a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::mm" title='task_struct::mm' data-ref="task_struct::mm">mm</a>;</td></tr>
<tr><th id="2893">2893</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col9 decl" id="419vma" title='vma' data-type='struct vm_area_struct *' data-ref="419vma">vma</dfn>, *<dfn class="local col0 decl" id="420prev" title='prev' data-type='struct vm_area_struct *' data-ref="420prev">prev</dfn>;</td></tr>
<tr><th id="2894">2894</th><td>	<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> **<dfn class="local col1 decl" id="421rb_link" title='rb_link' data-type='struct rb_node **' data-ref="421rb_link">rb_link</dfn>, *<dfn class="local col2 decl" id="422rb_parent" title='rb_parent' data-type='struct rb_node *' data-ref="422rb_parent">rb_parent</dfn>;</td></tr>
<tr><th id="2895">2895</th><td>	<a class="macro" href="../include/linux/types.h.html#141" title="unsigned long" data-ref="_M/pgoff_t">pgoff_t</a> <dfn class="local col3 decl" id="423pgoff" title='pgoff' data-type='unsigned long' data-ref="423pgoff">pgoff</dfn> = <a class="local col4 ref" href="#414addr" title='addr' data-ref="414addr">addr</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2896">2896</th><td>	<em>int</em> <dfn class="local col4 decl" id="424error" title='error' data-type='int' data-ref="424error">error</dfn>;</td></tr>
<tr><th id="2897">2897</th><td></td></tr>
<tr><th id="2898">2898</th><td>	<i>/* Until we need other flags, refuse anything except VM_EXEC. */</i></td></tr>
<tr><th id="2899">2899</th><td>	<b>if</b> ((<a class="local col6 ref" href="#416flags" title='flags' data-ref="416flags">flags</a> &amp; (~<a class="macro" href="../include/linux/mm.h.html#165" title="0x00000004" data-ref="_M/VM_EXEC">VM_EXEC</a>)) != <var>0</var>)</td></tr>
<tr><th id="2900">2900</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2901">2901</th><td>	<a class="local col6 ref" href="#416flags" title='flags' data-ref="416flags">flags</a> |= <a class="macro" href="../arch/x86/include/asm/page_types.h.html#39" title="(((get_current()-&gt;personality &amp; READ_IMPLIES_EXEC) ? 0x00000004 : 0 ) | 0x00000001 | 0x00000002 | 0x00000010 | 0x00000020 | 0x00000040)" data-ref="_M/VM_DATA_DEFAULT_FLAGS">VM_DATA_DEFAULT_FLAGS</a> | <a class="macro" href="../include/linux/mm.h.html#190" title="0x00100000" data-ref="_M/VM_ACCOUNT">VM_ACCOUNT</a> | <a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::def_flags" title='mm_struct::def_flags' data-ref="mm_struct::def_flags">def_flags</a>;</td></tr>
<tr><th id="2902">2902</th><td></td></tr>
<tr><th id="2903">2903</th><td>	<a class="local col4 ref" href="#424error" title='error' data-ref="424error">error</a> = <a class="ref fn" href="#get_unmapped_area" title='get_unmapped_area' data-ref="get_unmapped_area">get_unmapped_area</a>(<a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="local col4 ref" href="#414addr" title='addr' data-ref="414addr">addr</a>, <a class="local col5 ref" href="#415len" title='len' data-ref="415len">len</a>, <var>0</var>, <a class="macro" href="../include/uapi/asm-generic/mman-common.h.html#21" title="0x10" data-ref="_M/MAP_FIXED">MAP_FIXED</a>);</td></tr>
<tr><th id="2904">2904</th><td>	<b>if</b> (<a class="macro" href="../include/linux/mm.h.html#1216" title="((unsigned long)(error) &amp; ~(~(((1UL) &lt;&lt; 12)-1)))" data-ref="_M/offset_in_page">offset_in_page</a>(<a class="local col4 ref" href="#424error" title='error' data-ref="424error">error</a>))</td></tr>
<tr><th id="2905">2905</th><td>		<b>return</b> <a class="local col4 ref" href="#424error" title='error' data-ref="424error">error</a>;</td></tr>
<tr><th id="2906">2906</th><td></td></tr>
<tr><th id="2907">2907</th><td>	<a class="local col4 ref" href="#424error" title='error' data-ref="424error">error</a> = <a class="tu ref fn" href="#mlock_future_check" title='mlock_future_check' data-use='c' data-ref="mlock_future_check">mlock_future_check</a>(<a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>, <a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::def_flags" title='mm_struct::def_flags' data-ref="mm_struct::def_flags">def_flags</a>, <a class="local col5 ref" href="#415len" title='len' data-ref="415len">len</a>);</td></tr>
<tr><th id="2908">2908</th><td>	<b>if</b> (<a class="local col4 ref" href="#424error" title='error' data-ref="424error">error</a>)</td></tr>
<tr><th id="2909">2909</th><td>		<b>return</b> <a class="local col4 ref" href="#424error" title='error' data-ref="424error">error</a>;</td></tr>
<tr><th id="2910">2910</th><td></td></tr>
<tr><th id="2911">2911</th><td>	<i>/*</i></td></tr>
<tr><th id="2912">2912</th><td><i>	 * mm-&gt;mmap_sem is required to protect against another thread</i></td></tr>
<tr><th id="2913">2913</th><td><i>	 * changing the mappings in case we sleep.</i></td></tr>
<tr><th id="2914">2914</th><td><i>	 */</i></td></tr>
<tr><th id="2915">2915</th><td>	<a class="tu ref fn" href="#verify_mm_writelocked" title='verify_mm_writelocked' data-use='c' data-ref="verify_mm_writelocked">verify_mm_writelocked</a>(<a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>);</td></tr>
<tr><th id="2916">2916</th><td></td></tr>
<tr><th id="2917">2917</th><td>	<i>/*</i></td></tr>
<tr><th id="2918">2918</th><td><i>	 * Clear old maps.  this also does some error checking for us</i></td></tr>
<tr><th id="2919">2919</th><td><i>	 */</i></td></tr>
<tr><th id="2920">2920</th><td>	<b>while</b> (<a class="tu ref fn" href="#find_vma_links" title='find_vma_links' data-use='c' data-ref="find_vma_links">find_vma_links</a>(<a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>, <a class="local col4 ref" href="#414addr" title='addr' data-ref="414addr">addr</a>, <a class="local col4 ref" href="#414addr" title='addr' data-ref="414addr">addr</a> + <a class="local col5 ref" href="#415len" title='len' data-ref="415len">len</a>, &amp;<a class="local col0 ref" href="#420prev" title='prev' data-ref="420prev">prev</a>, &amp;<a class="local col1 ref" href="#421rb_link" title='rb_link' data-ref="421rb_link">rb_link</a>,</td></tr>
<tr><th id="2921">2921</th><td>			      &amp;<a class="local col2 ref" href="#422rb_parent" title='rb_parent' data-ref="422rb_parent">rb_parent</a>)) {</td></tr>
<tr><th id="2922">2922</th><td>		<b>if</b> (<a class="ref fn" href="#do_munmap" title='do_munmap' data-ref="do_munmap">do_munmap</a>(<a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>, <a class="local col4 ref" href="#414addr" title='addr' data-ref="414addr">addr</a>, <a class="local col5 ref" href="#415len" title='len' data-ref="415len">len</a>, <a class="local col7 ref" href="#417uf" title='uf' data-ref="417uf">uf</a>))</td></tr>
<tr><th id="2923">2923</th><td>			<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2924">2924</th><td>	}</td></tr>
<tr><th id="2925">2925</th><td></td></tr>
<tr><th id="2926">2926</th><td>	<i>/* Check against address space limits *after* clearing old maps... */</i></td></tr>
<tr><th id="2927">2927</th><td>	<b>if</b> (!<a class="ref fn" href="#may_expand_vm" title='may_expand_vm' data-ref="may_expand_vm">may_expand_vm</a>(<a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>, <a class="local col6 ref" href="#416flags" title='flags' data-ref="416flags">flags</a>, <a class="local col5 ref" href="#415len" title='len' data-ref="415len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>))</td></tr>
<tr><th id="2928">2928</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2929">2929</th><td></td></tr>
<tr><th id="2930">2930</th><td>	<b>if</b> (<a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::map_count" title='mm_struct::map_count' data-ref="mm_struct::map_count">map_count</a> &gt; <a class="ref" href="../include/linux/mm.h.html#sysctl_max_map_count" title='sysctl_max_map_count' data-ref="sysctl_max_map_count">sysctl_max_map_count</a>)</td></tr>
<tr><th id="2931">2931</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2932">2932</th><td></td></tr>
<tr><th id="2933">2933</th><td>	<b>if</b> (<a class="ref fn" href="../include/linux/security.h.html#security_vm_enough_memory_mm" title='security_vm_enough_memory_mm' data-ref="security_vm_enough_memory_mm">security_vm_enough_memory_mm</a>(<a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>, <a class="local col5 ref" href="#415len" title='len' data-ref="415len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>))</td></tr>
<tr><th id="2934">2934</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2935">2935</th><td></td></tr>
<tr><th id="2936">2936</th><td>	<i>/* Can we just expand an old private anonymous mapping? */</i></td></tr>
<tr><th id="2937">2937</th><td>	<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a> = <a class="ref fn" href="#vma_merge" title='vma_merge' data-ref="vma_merge">vma_merge</a>(<a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>, <a class="local col0 ref" href="#420prev" title='prev' data-ref="420prev">prev</a>, <a class="local col4 ref" href="#414addr" title='addr' data-ref="414addr">addr</a>, <a class="local col4 ref" href="#414addr" title='addr' data-ref="414addr">addr</a> + <a class="local col5 ref" href="#415len" title='len' data-ref="415len">len</a>, <a class="local col6 ref" href="#416flags" title='flags' data-ref="416flags">flags</a>,</td></tr>
<tr><th id="2938">2938</th><td>			<a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="local col3 ref" href="#423pgoff" title='pgoff' data-ref="423pgoff">pgoff</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../include/linux/mm_types.h.html#268" title="((struct vm_userfaultfd_ctx) {})" data-ref="_M/NULL_VM_UFFD_CTX">NULL_VM_UFFD_CTX</a>);</td></tr>
<tr><th id="2939">2939</th><td>	<b>if</b> (<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a>)</td></tr>
<tr><th id="2940">2940</th><td>		<b>goto</b> <a class="lbl" href="#425out" data-ref="425out">out</a>;</td></tr>
<tr><th id="2941">2941</th><td></td></tr>
<tr><th id="2942">2942</th><td>	<i>/*</i></td></tr>
<tr><th id="2943">2943</th><td><i>	 * create a vma struct for an anonymous mapping</i></td></tr>
<tr><th id="2944">2944</th><td><i>	 */</i></td></tr>
<tr><th id="2945">2945</th><td>	<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a> = <a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_zalloc" title='kmem_cache_zalloc' data-ref="kmem_cache_zalloc">kmem_cache_zalloc</a>(<a class="ref" href="../include/linux/mm.h.html#vm_area_cachep" title='vm_area_cachep' data-ref="vm_area_cachep">vm_area_cachep</a>, <a class="macro" href="../include/linux/gfp.h.html#278" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="2946">2946</th><td>	<b>if</b> (!<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a>) {</td></tr>
<tr><th id="2947">2947</th><td>		<a class="ref fn" href="../include/linux/mman.h.html#vm_unacct_memory" title='vm_unacct_memory' data-ref="vm_unacct_memory">vm_unacct_memory</a>(<a class="local col5 ref" href="#415len" title='len' data-ref="415len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>);</td></tr>
<tr><th id="2948">2948</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2949">2949</th><td>	}</td></tr>
<tr><th id="2950">2950</th><td></td></tr>
<tr><th id="2951">2951</th><td>	<a class="ref fn" href="../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma_chain" title='vm_area_struct::anon_vma_chain' data-ref="vm_area_struct::anon_vma_chain">anon_vma_chain</a>);</td></tr>
<tr><th id="2952">2952</th><td>	<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_mm" title='vm_area_struct::vm_mm' data-ref="vm_area_struct::vm_mm">vm_mm</a> = <a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>;</td></tr>
<tr><th id="2953">2953</th><td>	<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> = <a class="local col4 ref" href="#414addr" title='addr' data-ref="414addr">addr</a>;</td></tr>
<tr><th id="2954">2954</th><td>	<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> = <a class="local col4 ref" href="#414addr" title='addr' data-ref="414addr">addr</a> + <a class="local col5 ref" href="#415len" title='len' data-ref="415len">len</a>;</td></tr>
<tr><th id="2955">2955</th><td>	<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> = <a class="local col3 ref" href="#423pgoff" title='pgoff' data-ref="423pgoff">pgoff</a>;</td></tr>
<tr><th id="2956">2956</th><td>	<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> = <a class="local col6 ref" href="#416flags" title='flags' data-ref="416flags">flags</a>;</td></tr>
<tr><th id="2957">2957</th><td>	<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_page_prot" title='vm_area_struct::vm_page_prot' data-ref="vm_area_struct::vm_page_prot">vm_page_prot</a> = <a class="ref fn" href="#vm_get_page_prot" title='vm_get_page_prot' data-ref="vm_get_page_prot">vm_get_page_prot</a>(<a class="local col6 ref" href="#416flags" title='flags' data-ref="416flags">flags</a>);</td></tr>
<tr><th id="2958">2958</th><td>	<a class="tu ref fn" href="#vma_link" title='vma_link' data-use='c' data-ref="vma_link">vma_link</a>(<a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>, <a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a>, <a class="local col0 ref" href="#420prev" title='prev' data-ref="420prev">prev</a>, <a class="local col1 ref" href="#421rb_link" title='rb_link' data-ref="421rb_link">rb_link</a>, <a class="local col2 ref" href="#422rb_parent" title='rb_parent' data-ref="422rb_parent">rb_parent</a>);</td></tr>
<tr><th id="2959">2959</th><td><dfn class="lbl" id="425out" data-ref="425out">out</dfn>:</td></tr>
<tr><th id="2960">2960</th><td>	<a class="ref fn" href="../include/linux/perf_event.h.html#perf_event_mmap" title='perf_event_mmap' data-ref="perf_event_mmap">perf_event_mmap</a>(<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a>);</td></tr>
<tr><th id="2961">2961</th><td>	<a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::total_vm" title='mm_struct::total_vm' data-ref="mm_struct::total_vm">total_vm</a> += <a class="local col5 ref" href="#415len" title='len' data-ref="415len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2962">2962</th><td>	<a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::data_vm" title='mm_struct::data_vm' data-ref="mm_struct::data_vm">data_vm</a> += <a class="local col5 ref" href="#415len" title='len' data-ref="415len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2963">2963</th><td>	<b>if</b> (<a class="local col6 ref" href="#416flags" title='flags' data-ref="416flags">flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#180" title="0x00002000" data-ref="_M/VM_LOCKED">VM_LOCKED</a>)</td></tr>
<tr><th id="2964">2964</th><td>		<a class="local col8 ref" href="#418mm" title='mm' data-ref="418mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::locked_vm" title='mm_struct::locked_vm' data-ref="mm_struct::locked_vm">locked_vm</a> += (<a class="local col5 ref" href="#415len" title='len' data-ref="415len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>);</td></tr>
<tr><th id="2965">2965</th><td>	<a class="local col9 ref" href="#419vma" title='vma' data-ref="419vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> |= <a class="macro" href="../include/linux/mm.h.html#200" title="0" data-ref="_M/VM_SOFTDIRTY">VM_SOFTDIRTY</a>;</td></tr>
<tr><th id="2966">2966</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2967">2967</th><td>}</td></tr>
<tr><th id="2968">2968</th><td></td></tr>
<tr><th id="2969">2969</th><td><em>int</em> <dfn class="decl def fn" id="vm_brk_flags" title='vm_brk_flags' data-ref="vm_brk_flags">vm_brk_flags</dfn>(<em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="426addr" title='addr' data-type='unsigned long' data-ref="426addr">addr</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="427request" title='request' data-type='unsigned long' data-ref="427request">request</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="428flags" title='flags' data-type='unsigned long' data-ref="428flags">flags</dfn>)</td></tr>
<tr><th id="2970">2970</th><td>{</td></tr>
<tr><th id="2971">2971</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col9 decl" id="429mm" title='mm' data-type='struct mm_struct *' data-ref="429mm">mm</dfn> = <a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::mm" title='task_struct::mm' data-ref="task_struct::mm">mm</a>;</td></tr>
<tr><th id="2972">2972</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="430len" title='len' data-type='unsigned long' data-ref="430len">len</dfn>;</td></tr>
<tr><th id="2973">2973</th><td>	<em>int</em> <dfn class="local col1 decl" id="431ret" title='ret' data-type='int' data-ref="431ret">ret</dfn>;</td></tr>
<tr><th id="2974">2974</th><td>	<a class="typedef" href="../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="local col2 decl" id="432populate" title='populate' data-type='bool' data-ref="432populate">populate</dfn>;</td></tr>
<tr><th id="2975">2975</th><td>	<a class="macro" href="../include/linux/list.h.html#23" title="struct list_head uf = { &amp;(uf), &amp;(uf) }" data-ref="_M/LIST_HEAD">LIST_HEAD</a>(<dfn class="local col3 decl" id="433uf" title='uf' data-type='struct list_head' data-ref="433uf"><a class="local col3 ref" href="#2975" title='uf' data-ref="433uf"><a class="local col3 ref" href="#2975" title='uf' data-ref="433uf"><a class="local col3 ref" href="#2975" title='uf' data-ref="433uf"><a class="local col3 ref" href="#2975" title='uf' data-ref="433uf">uf</a></a></a></a></dfn>);</td></tr>
<tr><th id="2976">2976</th><td></td></tr>
<tr><th id="2977">2977</th><td>	<a class="local col0 ref" href="#430len" title='len' data-ref="430len">len</a> = <a class="macro" href="../include/linux/mm.h.html#134" title="((((request)) + ((typeof((request)))((((1UL) &lt;&lt; 12))) - 1)) &amp; ~((typeof((request)))((((1UL) &lt;&lt; 12))) - 1))" data-ref="_M/PAGE_ALIGN">PAGE_ALIGN</a>(<a class="local col7 ref" href="#427request" title='request' data-ref="427request">request</a>);</td></tr>
<tr><th id="2978">2978</th><td>	<b>if</b> (<a class="local col0 ref" href="#430len" title='len' data-ref="430len">len</a> &lt; <a class="local col7 ref" href="#427request" title='request' data-ref="427request">request</a>)</td></tr>
<tr><th id="2979">2979</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="2980">2980</th><td>	<b>if</b> (!<a class="local col0 ref" href="#430len" title='len' data-ref="430len">len</a>)</td></tr>
<tr><th id="2981">2981</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2982">2982</th><td></td></tr>
<tr><th id="2983">2983</th><td>	<b>if</b> (<a class="ref fn" href="../include/linux/rwsem.h.html#down_write_killable" title='down_write_killable' data-ref="down_write_killable">down_write_killable</a>(&amp;<a class="local col9 ref" href="#429mm" title='mm' data-ref="429mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>))</td></tr>
<tr><th id="2984">2984</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#8" title="4" data-ref="_M/EINTR">EINTR</a>;</td></tr>
<tr><th id="2985">2985</th><td></td></tr>
<tr><th id="2986">2986</th><td>	<a class="local col1 ref" href="#431ret" title='ret' data-ref="431ret">ret</a> = <a class="tu ref fn" href="#do_brk_flags" title='do_brk_flags' data-use='c' data-ref="do_brk_flags">do_brk_flags</a>(<a class="local col6 ref" href="#426addr" title='addr' data-ref="426addr">addr</a>, <a class="local col0 ref" href="#430len" title='len' data-ref="430len">len</a>, <a class="local col8 ref" href="#428flags" title='flags' data-ref="428flags">flags</a>, &amp;<a class="local col3 ref" href="#2975" title='uf' data-ref="433uf">uf</a>);</td></tr>
<tr><th id="2987">2987</th><td>	<a class="local col2 ref" href="#432populate" title='populate' data-ref="432populate">populate</a> = ((<a class="local col9 ref" href="#429mm" title='mm' data-ref="429mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::def_flags" title='mm_struct::def_flags' data-ref="mm_struct::def_flags">def_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#180" title="0x00002000" data-ref="_M/VM_LOCKED">VM_LOCKED</a>) != <var>0</var>);</td></tr>
<tr><th id="2988">2988</th><td>	<a class="ref fn" href="../include/linux/rwsem.h.html#up_write" title='up_write' data-ref="up_write">up_write</a>(&amp;<a class="local col9 ref" href="#429mm" title='mm' data-ref="429mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>);</td></tr>
<tr><th id="2989">2989</th><td>	<a class="ref fn" href="../include/linux/userfaultfd_k.h.html#userfaultfd_unmap_complete" title='userfaultfd_unmap_complete' data-ref="userfaultfd_unmap_complete">userfaultfd_unmap_complete</a>(<a class="local col9 ref" href="#429mm" title='mm' data-ref="429mm">mm</a>, &amp;<a class="local col3 ref" href="#2975" title='uf' data-ref="433uf">uf</a>);</td></tr>
<tr><th id="2990">2990</th><td>	<b>if</b> (<a class="local col2 ref" href="#432populate" title='populate' data-ref="432populate">populate</a> &amp;&amp; !<a class="local col1 ref" href="#431ret" title='ret' data-ref="431ret">ret</a>)</td></tr>
<tr><th id="2991">2991</th><td>		<a class="ref fn" href="../include/linux/mm.h.html#mm_populate" title='mm_populate' data-ref="mm_populate">mm_populate</a>(<a class="local col6 ref" href="#426addr" title='addr' data-ref="426addr">addr</a>, <a class="local col0 ref" href="#430len" title='len' data-ref="430len">len</a>);</td></tr>
<tr><th id="2992">2992</th><td>	<b>return</b> <a class="local col1 ref" href="#431ret" title='ret' data-ref="431ret">ret</a>;</td></tr>
<tr><th id="2993">2993</th><td>}</td></tr>
<tr><th id="2994">2994</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(vm_brk_flags) vm_brk_flags; static const char __kstrtab_vm_brk_flags[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vm_brk_flags&quot;; static const struct kernel_symbol __ksymtab_vm_brk_flags __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vm_brk_flags&quot;), used)) = { (unsigned long)&amp;vm_brk_flags, __kstrtab_vm_brk_flags }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vm_brk_flags" title='vm_brk_flags' data-ref="vm_brk_flags"><a class="ref fn" href="#vm_brk_flags" title='vm_brk_flags' data-ref="vm_brk_flags"><a class="ref fn" href="#vm_brk_flags" title='vm_brk_flags' data-ref="vm_brk_flags"><a class="ref fn" href="#vm_brk_flags" title='vm_brk_flags' data-ref="vm_brk_flags">vm_brk_flags</a></a></a></a>);</td></tr>
<tr><th id="2995">2995</th><td></td></tr>
<tr><th id="2996">2996</th><td><em>int</em> <dfn class="decl def fn" id="vm_brk" title='vm_brk' data-ref="vm_brk">vm_brk</dfn>(<em>unsigned</em> <em>long</em> <dfn class="local col4 decl" id="434addr" title='addr' data-type='unsigned long' data-ref="434addr">addr</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="435len" title='len' data-type='unsigned long' data-ref="435len">len</dfn>)</td></tr>
<tr><th id="2997">2997</th><td>{</td></tr>
<tr><th id="2998">2998</th><td>	<b>return</b> <a class="ref fn" href="#vm_brk_flags" title='vm_brk_flags' data-ref="vm_brk_flags">vm_brk_flags</a>(<a class="local col4 ref" href="#434addr" title='addr' data-ref="434addr">addr</a>, <a class="local col5 ref" href="#435len" title='len' data-ref="435len">len</a>, <var>0</var>);</td></tr>
<tr><th id="2999">2999</th><td>}</td></tr>
<tr><th id="3000">3000</th><td><a class="macro" href="../include/linux/export.h.html#103" title="extern typeof(vm_brk) vm_brk; static const char __kstrtab_vm_brk[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vm_brk&quot;; static const struct kernel_symbol __ksymtab_vm_brk __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vm_brk&quot;), used)) = { (unsigned long)&amp;vm_brk, __kstrtab_vm_brk }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vm_brk" title='vm_brk' data-ref="vm_brk"><a class="ref fn" href="#vm_brk" title='vm_brk' data-ref="vm_brk"><a class="ref fn" href="#vm_brk" title='vm_brk' data-ref="vm_brk"><a class="ref fn" href="#vm_brk" title='vm_brk' data-ref="vm_brk">vm_brk</a></a></a></a>);</td></tr>
<tr><th id="3001">3001</th><td></td></tr>
<tr><th id="3002">3002</th><td><i>/* Release all mmaps. */</i></td></tr>
<tr><th id="3003">3003</th><td><em>void</em> <dfn class="decl def fn" id="exit_mmap" title='exit_mmap' data-ref="exit_mmap">exit_mmap</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col6 decl" id="436mm" title='mm' data-type='struct mm_struct *' data-ref="436mm">mm</dfn>)</td></tr>
<tr><th id="3004">3004</th><td>{</td></tr>
<tr><th id="3005">3005</th><td>	<b>struct</b> <a class="type" href="../include/asm-generic/tlb.h.html#mmu_gather" title='mmu_gather' data-ref="mmu_gather">mmu_gather</a> <dfn class="local col7 decl" id="437tlb" title='tlb' data-type='struct mmu_gather' data-ref="437tlb">tlb</dfn>;</td></tr>
<tr><th id="3006">3006</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col8 decl" id="438vma" title='vma' data-type='struct vm_area_struct *' data-ref="438vma">vma</dfn>;</td></tr>
<tr><th id="3007">3007</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="439nr_accounted" title='nr_accounted' data-type='unsigned long' data-ref="439nr_accounted">nr_accounted</dfn> = <var>0</var>;</td></tr>
<tr><th id="3008">3008</th><td></td></tr>
<tr><th id="3009">3009</th><td>	<i>/* mm's last user has gone, and its about to be pulled down */</i></td></tr>
<tr><th id="3010">3010</th><td>	<a class="ref fn" href="../include/linux/mmu_notifier.h.html#mmu_notifier_release" title='mmu_notifier_release' data-ref="mmu_notifier_release">mmu_notifier_release</a>(<a class="local col6 ref" href="#436mm" title='mm' data-ref="436mm">mm</a>);</td></tr>
<tr><th id="3011">3011</th><td></td></tr>
<tr><th id="3012">3012</th><td>	<b>if</b> (<a class="macro" href="../include/linux/compiler.h.html#77" title="__builtin_expect(!!(mm_is_oom_victim(mm)), 0)" data-ref="_M/unlikely">unlikely</a>(<a class="ref fn" href="../include/linux/oom.h.html#mm_is_oom_victim" title='mm_is_oom_victim' data-ref="mm_is_oom_victim">mm_is_oom_victim</a>(<a class="local col6 ref" href="#436mm" title='mm' data-ref="436mm">mm</a>))) {</td></tr>
<tr><th id="3013">3013</th><td>		<i>/*</i></td></tr>
<tr><th id="3014">3014</th><td><i>		 * Manually reap the mm to free as much memory as possible.</i></td></tr>
<tr><th id="3015">3015</th><td><i>		 * Then, as the oom reaper does, set MMF_OOM_SKIP to disregard</i></td></tr>
<tr><th id="3016">3016</th><td><i>		 * this mm from further consideration.  Taking mm-&gt;mmap_sem for</i></td></tr>
<tr><th id="3017">3017</th><td><i>		 * write after setting MMF_OOM_SKIP will guarantee that the oom</i></td></tr>
<tr><th id="3018">3018</th><td><i>		 * reaper will not run on this mm again after mmap_sem is</i></td></tr>
<tr><th id="3019">3019</th><td><i>		 * dropped.</i></td></tr>
<tr><th id="3020">3020</th><td><i>		 *</i></td></tr>
<tr><th id="3021">3021</th><td><i>		 * Nothing can be holding mm-&gt;mmap_sem here and the above call</i></td></tr>
<tr><th id="3022">3022</th><td><i>		 * to mmu_notifier_release(mm) ensures mmu notifier callbacks in</i></td></tr>
<tr><th id="3023">3023</th><td><i>		 * __oom_reap_task_mm() will not block.</i></td></tr>
<tr><th id="3024">3024</th><td><i>		 *</i></td></tr>
<tr><th id="3025">3025</th><td><i>		 * This needs to be done before calling munlock_vma_pages_all(),</i></td></tr>
<tr><th id="3026">3026</th><td><i>		 * which clears VM_LOCKED, otherwise the oom reaper cannot</i></td></tr>
<tr><th id="3027">3027</th><td><i>		 * reliably test it.</i></td></tr>
<tr><th id="3028">3028</th><td><i>		 */</i></td></tr>
<tr><th id="3029">3029</th><td>		<a class="ref fn" href="../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="ref" href="../include/linux/oom.h.html#oom_lock" title='oom_lock' data-ref="oom_lock">oom_lock</a>);</td></tr>
<tr><th id="3030">3030</th><td>		<a class="ref fn" href="../include/linux/oom.h.html#__oom_reap_task_mm" title='__oom_reap_task_mm' data-ref="__oom_reap_task_mm">__oom_reap_task_mm</a>(<a class="local col6 ref" href="#436mm" title='mm' data-ref="436mm">mm</a>);</td></tr>
<tr><th id="3031">3031</th><td>		<a class="ref fn" href="../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="ref" href="../include/linux/oom.h.html#oom_lock" title='oom_lock' data-ref="oom_lock">oom_lock</a>);</td></tr>
<tr><th id="3032">3032</th><td></td></tr>
<tr><th id="3033">3033</th><td>		<a class="ref fn" href="../arch/x86/include/asm/bitops.h.html#set_bit" title='set_bit' data-ref="set_bit">set_bit</a>(<a class="macro" href="../include/linux/sched/coredump.h.html#69" title="21" data-ref="_M/MMF_OOM_SKIP">MMF_OOM_SKIP</a>, &amp;<a class="local col6 ref" href="#436mm" title='mm' data-ref="436mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::flags" title='mm_struct::flags' data-ref="mm_struct::flags">flags</a>);</td></tr>
<tr><th id="3034">3034</th><td>		<a class="ref fn" href="../include/linux/rwsem.h.html#down_write" title='down_write' data-ref="down_write">down_write</a>(&amp;<a class="local col6 ref" href="#436mm" title='mm' data-ref="436mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>);</td></tr>
<tr><th id="3035">3035</th><td>		<a class="ref fn" href="../include/linux/rwsem.h.html#up_write" title='up_write' data-ref="up_write">up_write</a>(&amp;<a class="local col6 ref" href="#436mm" title='mm' data-ref="436mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>);</td></tr>
<tr><th id="3036">3036</th><td>	}</td></tr>
<tr><th id="3037">3037</th><td></td></tr>
<tr><th id="3038">3038</th><td>	<b>if</b> (<a class="local col6 ref" href="#436mm" title='mm' data-ref="436mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::locked_vm" title='mm_struct::locked_vm' data-ref="mm_struct::locked_vm">locked_vm</a>) {</td></tr>
<tr><th id="3039">3039</th><td>		<a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a> = <a class="local col6 ref" href="#436mm" title='mm' data-ref="436mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap" title='mm_struct::mmap' data-ref="mm_struct::mmap">mmap</a>;</td></tr>
<tr><th id="3040">3040</th><td>		<b>while</b> (<a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a>) {</td></tr>
<tr><th id="3041">3041</th><td>			<b>if</b> (<a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#180" title="0x00002000" data-ref="_M/VM_LOCKED">VM_LOCKED</a>)</td></tr>
<tr><th id="3042">3042</th><td>				<a class="ref fn" href="internal.h.html#munlock_vma_pages_all" title='munlock_vma_pages_all' data-ref="munlock_vma_pages_all">munlock_vma_pages_all</a>(<a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a>);</td></tr>
<tr><th id="3043">3043</th><td>			<a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a> = <a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>;</td></tr>
<tr><th id="3044">3044</th><td>		}</td></tr>
<tr><th id="3045">3045</th><td>	}</td></tr>
<tr><th id="3046">3046</th><td></td></tr>
<tr><th id="3047">3047</th><td>	<a class="ref fn" href="../arch/x86/include/asm/mmu_context.h.html#arch_exit_mmap" title='arch_exit_mmap' data-ref="arch_exit_mmap">arch_exit_mmap</a>(<a class="local col6 ref" href="#436mm" title='mm' data-ref="436mm">mm</a>);</td></tr>
<tr><th id="3048">3048</th><td></td></tr>
<tr><th id="3049">3049</th><td>	<a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a> = <a class="local col6 ref" href="#436mm" title='mm' data-ref="436mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap" title='mm_struct::mmap' data-ref="mm_struct::mmap">mmap</a>;</td></tr>
<tr><th id="3050">3050</th><td>	<b>if</b> (!<a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a>)	<i>/* Can happen if dup_mmap() received an OOM */</i></td></tr>
<tr><th id="3051">3051</th><td>		<b>return</b>;</td></tr>
<tr><th id="3052">3052</th><td></td></tr>
<tr><th id="3053">3053</th><td>	<a class="ref fn" href="../include/linux/swap.h.html#lru_add_drain" title='lru_add_drain' data-ref="lru_add_drain">lru_add_drain</a>();</td></tr>
<tr><th id="3054">3054</th><td>	<a class="macro" href="../include/asm-generic/cacheflush.h.html#13" title="do { } while (0)" data-ref="_M/flush_cache_mm">flush_cache_mm</a>(mm);</td></tr>
<tr><th id="3055">3055</th><td>	<a class="ref fn" href="../include/linux/mm_types.h.html#tlb_gather_mmu" title='tlb_gather_mmu' data-ref="tlb_gather_mmu">tlb_gather_mmu</a>(&amp;<a class="local col7 ref" href="#437tlb" title='tlb' data-ref="437tlb">tlb</a>, <a class="local col6 ref" href="#436mm" title='mm' data-ref="436mm">mm</a>, <var>0</var>, -<var>1</var>);</td></tr>
<tr><th id="3056">3056</th><td>	<i>/* update_hiwater_rss(mm) here? but nobody should be looking */</i></td></tr>
<tr><th id="3057">3057</th><td>	<i>/* Use -1 here to ensure all VMAs in the mm are unmapped */</i></td></tr>
<tr><th id="3058">3058</th><td>	<a class="ref fn" href="../include/linux/mm.h.html#unmap_vmas" title='unmap_vmas' data-ref="unmap_vmas">unmap_vmas</a>(&amp;<a class="local col7 ref" href="#437tlb" title='tlb' data-ref="437tlb">tlb</a>, <a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a>, <var>0</var>, -<var>1</var>);</td></tr>
<tr><th id="3059">3059</th><td>	<a class="ref fn" href="internal.h.html#free_pgtables" title='free_pgtables' data-ref="free_pgtables">free_pgtables</a>(&amp;<a class="local col7 ref" href="#437tlb" title='tlb' data-ref="437tlb">tlb</a>, <a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a>, <a class="macro" href="../arch/x86/include/asm/pgtable_types.h.html#10" title="0UL" data-ref="_M/FIRST_USER_ADDRESS">FIRST_USER_ADDRESS</a>, <a class="macro" href="../include/asm-generic/pgtable.h.html#26" title="0UL" data-ref="_M/USER_PGTABLES_CEILING">USER_PGTABLES_CEILING</a>);</td></tr>
<tr><th id="3060">3060</th><td>	<a class="ref fn" href="../include/linux/mm_types.h.html#tlb_finish_mmu" title='tlb_finish_mmu' data-ref="tlb_finish_mmu">tlb_finish_mmu</a>(&amp;<a class="local col7 ref" href="#437tlb" title='tlb' data-ref="437tlb">tlb</a>, <var>0</var>, -<var>1</var>);</td></tr>
<tr><th id="3061">3061</th><td></td></tr>
<tr><th id="3062">3062</th><td>	<i>/*</i></td></tr>
<tr><th id="3063">3063</th><td><i>	 * Walk the list again, actually closing and freeing it,</i></td></tr>
<tr><th id="3064">3064</th><td><i>	 * with preemption enabled, without holding any MM locks.</i></td></tr>
<tr><th id="3065">3065</th><td><i>	 */</i></td></tr>
<tr><th id="3066">3066</th><td>	<b>while</b> (<a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a>) {</td></tr>
<tr><th id="3067">3067</th><td>		<b>if</b> (<a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#190" title="0x00100000" data-ref="_M/VM_ACCOUNT">VM_ACCOUNT</a>)</td></tr>
<tr><th id="3068">3068</th><td>			<a class="local col9 ref" href="#439nr_accounted" title='nr_accounted' data-ref="439nr_accounted">nr_accounted</a> += <a class="ref fn" href="../include/linux/mm.h.html#vma_pages" title='vma_pages' data-ref="vma_pages">vma_pages</a>(<a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a>);</td></tr>
<tr><th id="3069">3069</th><td>		<a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a> = <a class="tu ref fn" href="#remove_vma" title='remove_vma' data-use='c' data-ref="remove_vma">remove_vma</a>(<a class="local col8 ref" href="#438vma" title='vma' data-ref="438vma">vma</a>);</td></tr>
<tr><th id="3070">3070</th><td>	}</td></tr>
<tr><th id="3071">3071</th><td>	<a class="ref fn" href="../include/linux/mman.h.html#vm_unacct_memory" title='vm_unacct_memory' data-ref="vm_unacct_memory">vm_unacct_memory</a>(<a class="local col9 ref" href="#439nr_accounted" title='nr_accounted' data-ref="439nr_accounted">nr_accounted</a>);</td></tr>
<tr><th id="3072">3072</th><td>}</td></tr>
<tr><th id="3073">3073</th><td></td></tr>
<tr><th id="3074">3074</th><td><i>/* Insert vm structure into process list sorted by address</i></td></tr>
<tr><th id="3075">3075</th><td><i> * and into the inode's i_mmap tree.  If vm_file is non-NULL</i></td></tr>
<tr><th id="3076">3076</th><td><i> * then i_mmap_rwsem is taken here.</i></td></tr>
<tr><th id="3077">3077</th><td><i> */</i></td></tr>
<tr><th id="3078">3078</th><td><em>int</em> <dfn class="decl def fn" id="insert_vm_struct" title='insert_vm_struct' data-ref="insert_vm_struct">insert_vm_struct</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col0 decl" id="440mm" title='mm' data-type='struct mm_struct *' data-ref="440mm">mm</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col1 decl" id="441vma" title='vma' data-type='struct vm_area_struct *' data-ref="441vma">vma</dfn>)</td></tr>
<tr><th id="3079">3079</th><td>{</td></tr>
<tr><th id="3080">3080</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col2 decl" id="442prev" title='prev' data-type='struct vm_area_struct *' data-ref="442prev">prev</dfn>;</td></tr>
<tr><th id="3081">3081</th><td>	<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> **<dfn class="local col3 decl" id="443rb_link" title='rb_link' data-type='struct rb_node **' data-ref="443rb_link">rb_link</dfn>, *<dfn class="local col4 decl" id="444rb_parent" title='rb_parent' data-type='struct rb_node *' data-ref="444rb_parent">rb_parent</dfn>;</td></tr>
<tr><th id="3082">3082</th><td></td></tr>
<tr><th id="3083">3083</th><td>	<b>if</b> (<a class="tu ref fn" href="#find_vma_links" title='find_vma_links' data-use='c' data-ref="find_vma_links">find_vma_links</a>(<a class="local col0 ref" href="#440mm" title='mm' data-ref="440mm">mm</a>, <a class="local col1 ref" href="#441vma" title='vma' data-ref="441vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>, <a class="local col1 ref" href="#441vma" title='vma' data-ref="441vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>,</td></tr>
<tr><th id="3084">3084</th><td>			   &amp;<a class="local col2 ref" href="#442prev" title='prev' data-ref="442prev">prev</a>, &amp;<a class="local col3 ref" href="#443rb_link" title='rb_link' data-ref="443rb_link">rb_link</a>, &amp;<a class="local col4 ref" href="#444rb_parent" title='rb_parent' data-ref="444rb_parent">rb_parent</a>))</td></tr>
<tr><th id="3085">3085</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="3086">3086</th><td>	<b>if</b> ((<a class="local col1 ref" href="#441vma" title='vma' data-ref="441vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> &amp; <a class="macro" href="../include/linux/mm.h.html#190" title="0x00100000" data-ref="_M/VM_ACCOUNT">VM_ACCOUNT</a>) &amp;&amp;</td></tr>
<tr><th id="3087">3087</th><td>	     <a class="ref fn" href="../include/linux/security.h.html#security_vm_enough_memory_mm" title='security_vm_enough_memory_mm' data-ref="security_vm_enough_memory_mm">security_vm_enough_memory_mm</a>(<a class="local col0 ref" href="#440mm" title='mm' data-ref="440mm">mm</a>, <a class="ref fn" href="../include/linux/mm.h.html#vma_pages" title='vma_pages' data-ref="vma_pages">vma_pages</a>(<a class="local col1 ref" href="#441vma" title='vma' data-ref="441vma">vma</a>)))</td></tr>
<tr><th id="3088">3088</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="3089">3089</th><td></td></tr>
<tr><th id="3090">3090</th><td>	<i>/*</i></td></tr>
<tr><th id="3091">3091</th><td><i>	 * The vm_pgoff of a purely anonymous vma should be irrelevant</i></td></tr>
<tr><th id="3092">3092</th><td><i>	 * until its first write fault, when page's anon_vma and index</i></td></tr>
<tr><th id="3093">3093</th><td><i>	 * are set.  But now set the vm_pgoff it will almost certainly</i></td></tr>
<tr><th id="3094">3094</th><td><i>	 * end up with (unless mremap moves it elsewhere before that</i></td></tr>
<tr><th id="3095">3095</th><td><i>	 * first wfault), so /proc/pid/maps tells a consistent story.</i></td></tr>
<tr><th id="3096">3096</th><td><i>	 *</i></td></tr>
<tr><th id="3097">3097</th><td><i>	 * By setting it to reflect the virtual start address of the</i></td></tr>
<tr><th id="3098">3098</th><td><i>	 * vma, merges and splits can happen in a seamless way, just</i></td></tr>
<tr><th id="3099">3099</th><td><i>	 * using the existing file pgoff checks and manipulations.</i></td></tr>
<tr><th id="3100">3100</th><td><i>	 * Similarly in do_mmap_pgoff and in do_brk.</i></td></tr>
<tr><th id="3101">3101</th><td><i>	 */</i></td></tr>
<tr><th id="3102">3102</th><td>	<b>if</b> (<a class="ref fn" href="../include/linux/mm.h.html#vma_is_anonymous" title='vma_is_anonymous' data-ref="vma_is_anonymous">vma_is_anonymous</a>(<a class="local col1 ref" href="#441vma" title='vma' data-ref="441vma">vma</a>)) {</td></tr>
<tr><th id="3103">3103</th><td>		<a class="macro" href="../include/asm-generic/bug.h.html#59" title="do { if (__builtin_expect(!!(vma-&gt;anon_vma), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/mm/mmap.c&quot;), &quot;i&quot; (3103), &quot;i&quot; (0), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); do { ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (137)); }); do { } while (1); } while (0); } while (0); } while (0)" data-ref="_M/BUG_ON">BUG_ON</a>(<a class="local col1 ref" href="#441vma" title='vma' data-ref="441vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>);</td></tr>
<tr><th id="3104">3104</th><td>		<a class="local col1 ref" href="#441vma" title='vma' data-ref="441vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> = <a class="local col1 ref" href="#441vma" title='vma' data-ref="441vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="3105">3105</th><td>	}</td></tr>
<tr><th id="3106">3106</th><td></td></tr>
<tr><th id="3107">3107</th><td>	<a class="tu ref fn" href="#vma_link" title='vma_link' data-use='c' data-ref="vma_link">vma_link</a>(<a class="local col0 ref" href="#440mm" title='mm' data-ref="440mm">mm</a>, <a class="local col1 ref" href="#441vma" title='vma' data-ref="441vma">vma</a>, <a class="local col2 ref" href="#442prev" title='prev' data-ref="442prev">prev</a>, <a class="local col3 ref" href="#443rb_link" title='rb_link' data-ref="443rb_link">rb_link</a>, <a class="local col4 ref" href="#444rb_parent" title='rb_parent' data-ref="444rb_parent">rb_parent</a>);</td></tr>
<tr><th id="3108">3108</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3109">3109</th><td>}</td></tr>
<tr><th id="3110">3110</th><td></td></tr>
<tr><th id="3111">3111</th><td><i>/*</i></td></tr>
<tr><th id="3112">3112</th><td><i> * Copy the vma structure to a new location in the same mm,</i></td></tr>
<tr><th id="3113">3113</th><td><i> * prior to moving page table entries, to effect an mremap move.</i></td></tr>
<tr><th id="3114">3114</th><td><i> */</i></td></tr>
<tr><th id="3115">3115</th><td><b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="decl def fn" id="copy_vma" title='copy_vma' data-ref="copy_vma">copy_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> **<dfn class="local col5 decl" id="445vmap" title='vmap' data-type='struct vm_area_struct **' data-ref="445vmap">vmap</dfn>,</td></tr>
<tr><th id="3116">3116</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="446addr" title='addr' data-type='unsigned long' data-ref="446addr">addr</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="447len" title='len' data-type='unsigned long' data-ref="447len">len</dfn>, <a class="macro" href="../include/linux/types.h.html#141" title="unsigned long" data-ref="_M/pgoff_t">pgoff_t</a> <dfn class="local col8 decl" id="448pgoff" title='pgoff' data-type='unsigned long' data-ref="448pgoff">pgoff</dfn>,</td></tr>
<tr><th id="3117">3117</th><td>	<a class="typedef" href="../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> *<dfn class="local col9 decl" id="449need_rmap_locks" title='need_rmap_locks' data-type='bool *' data-ref="449need_rmap_locks">need_rmap_locks</dfn>)</td></tr>
<tr><th id="3118">3118</th><td>{</td></tr>
<tr><th id="3119">3119</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col0 decl" id="450vma" title='vma' data-type='struct vm_area_struct *' data-ref="450vma">vma</dfn> = *<a class="local col5 ref" href="#445vmap" title='vmap' data-ref="445vmap">vmap</a>;</td></tr>
<tr><th id="3120">3120</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col1 decl" id="451vma_start" title='vma_start' data-type='unsigned long' data-ref="451vma_start">vma_start</dfn> = <a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a>;</td></tr>
<tr><th id="3121">3121</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col2 decl" id="452mm" title='mm' data-type='struct mm_struct *' data-ref="452mm">mm</dfn> = <a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_mm" title='vm_area_struct::vm_mm' data-ref="vm_area_struct::vm_mm">vm_mm</a>;</td></tr>
<tr><th id="3122">3122</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col3 decl" id="453new_vma" title='new_vma' data-type='struct vm_area_struct *' data-ref="453new_vma">new_vma</dfn>, *<dfn class="local col4 decl" id="454prev" title='prev' data-type='struct vm_area_struct *' data-ref="454prev">prev</dfn>;</td></tr>
<tr><th id="3123">3123</th><td>	<b>struct</b> <a class="type" href="../include/linux/rbtree.h.html#rb_node" title='rb_node' data-ref="rb_node">rb_node</a> **<dfn class="local col5 decl" id="455rb_link" title='rb_link' data-type='struct rb_node **' data-ref="455rb_link">rb_link</dfn>, *<dfn class="local col6 decl" id="456rb_parent" title='rb_parent' data-type='struct rb_node *' data-ref="456rb_parent">rb_parent</dfn>;</td></tr>
<tr><th id="3124">3124</th><td>	<a class="typedef" href="../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="local col7 decl" id="457faulted_in_anon_vma" title='faulted_in_anon_vma' data-type='bool' data-ref="457faulted_in_anon_vma">faulted_in_anon_vma</dfn> = <a class="enum" href="../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="3125">3125</th><td></td></tr>
<tr><th id="3126">3126</th><td>	<i>/*</i></td></tr>
<tr><th id="3127">3127</th><td><i>	 * If anonymous vma has not yet been faulted, update new pgoff</i></td></tr>
<tr><th id="3128">3128</th><td><i>	 * to match new location, to increase its chance of merging.</i></td></tr>
<tr><th id="3129">3129</th><td><i>	 */</i></td></tr>
<tr><th id="3130">3130</th><td>	<b>if</b> (<a class="macro" href="../include/linux/compiler.h.html#77" title="__builtin_expect(!!(vma_is_anonymous(vma) &amp;&amp; !vma-&gt;anon_vma), 0)" data-ref="_M/unlikely">unlikely</a>(<a class="ref fn" href="../include/linux/mm.h.html#vma_is_anonymous" title='vma_is_anonymous' data-ref="vma_is_anonymous">vma_is_anonymous</a>(<a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a>) &amp;&amp; !<a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>)) {</td></tr>
<tr><th id="3131">3131</th><td>		<a class="local col8 ref" href="#448pgoff" title='pgoff' data-ref="448pgoff">pgoff</a> = <a class="local col6 ref" href="#446addr" title='addr' data-ref="446addr">addr</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="3132">3132</th><td>		<a class="local col7 ref" href="#457faulted_in_anon_vma" title='faulted_in_anon_vma' data-ref="457faulted_in_anon_vma">faulted_in_anon_vma</a> = <a class="enum" href="../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="3133">3133</th><td>	}</td></tr>
<tr><th id="3134">3134</th><td></td></tr>
<tr><th id="3135">3135</th><td>	<b>if</b> (<a class="tu ref fn" href="#find_vma_links" title='find_vma_links' data-use='c' data-ref="find_vma_links">find_vma_links</a>(<a class="local col2 ref" href="#452mm" title='mm' data-ref="452mm">mm</a>, <a class="local col6 ref" href="#446addr" title='addr' data-ref="446addr">addr</a>, <a class="local col6 ref" href="#446addr" title='addr' data-ref="446addr">addr</a> + <a class="local col7 ref" href="#447len" title='len' data-ref="447len">len</a>, &amp;<a class="local col4 ref" href="#454prev" title='prev' data-ref="454prev">prev</a>, &amp;<a class="local col5 ref" href="#455rb_link" title='rb_link' data-ref="455rb_link">rb_link</a>, &amp;<a class="local col6 ref" href="#456rb_parent" title='rb_parent' data-ref="456rb_parent">rb_parent</a>))</td></tr>
<tr><th id="3136">3136</th><td>		<b>return</b> <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;	<i>/* should never get here */</i></td></tr>
<tr><th id="3137">3137</th><td>	<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a> = <a class="ref fn" href="#vma_merge" title='vma_merge' data-ref="vma_merge">vma_merge</a>(<a class="local col2 ref" href="#452mm" title='mm' data-ref="452mm">mm</a>, <a class="local col4 ref" href="#454prev" title='prev' data-ref="454prev">prev</a>, <a class="local col6 ref" href="#446addr" title='addr' data-ref="446addr">addr</a>, <a class="local col6 ref" href="#446addr" title='addr' data-ref="446addr">addr</a> + <a class="local col7 ref" href="#447len" title='len' data-ref="447len">len</a>, <a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a>,</td></tr>
<tr><th id="3138">3138</th><td>			    <a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>, <a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>, <a class="local col8 ref" href="#448pgoff" title='pgoff' data-ref="448pgoff">pgoff</a>, <a class="macro" href="../include/linux/mempolicy.h.html#246" title="((void *)0)" data-ref="_M/vma_policy">vma_policy</a>(vma),</td></tr>
<tr><th id="3139">3139</th><td>			    <a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_userfaultfd_ctx" title='vm_area_struct::vm_userfaultfd_ctx' data-ref="vm_area_struct::vm_userfaultfd_ctx">vm_userfaultfd_ctx</a>);</td></tr>
<tr><th id="3140">3140</th><td>	<b>if</b> (<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>) {</td></tr>
<tr><th id="3141">3141</th><td>		<i>/*</i></td></tr>
<tr><th id="3142">3142</th><td><i>		 * Source vma may have been merged into new_vma</i></td></tr>
<tr><th id="3143">3143</th><td><i>		 */</i></td></tr>
<tr><th id="3144">3144</th><td>		<b>if</b> (<a class="macro" href="../include/linux/compiler.h.html#77" title="__builtin_expect(!!(vma_start &gt;= new_vma-&gt;vm_start &amp;&amp; vma_start &lt; new_vma-&gt;vm_end), 0)" data-ref="_M/unlikely">unlikely</a>(<a class="local col1 ref" href="#451vma_start" title='vma_start' data-ref="451vma_start">vma_start</a> &gt;= <a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> &amp;&amp;</td></tr>
<tr><th id="3145">3145</th><td>			     <a class="local col1 ref" href="#451vma_start" title='vma_start' data-ref="451vma_start">vma_start</a> &lt; <a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a>)) {</td></tr>
<tr><th id="3146">3146</th><td>			<i>/*</i></td></tr>
<tr><th id="3147">3147</th><td><i>			 * The only way we can get a vma_merge with</i></td></tr>
<tr><th id="3148">3148</th><td><i>			 * self during an mremap is if the vma hasn't</i></td></tr>
<tr><th id="3149">3149</th><td><i>			 * been faulted in yet and we were allowed to</i></td></tr>
<tr><th id="3150">3150</th><td><i>			 * reset the dst vma-&gt;vm_pgoff to the</i></td></tr>
<tr><th id="3151">3151</th><td><i>			 * destination address of the mremap to allow</i></td></tr>
<tr><th id="3152">3152</th><td><i>			 * the merge to happen. mremap must change the</i></td></tr>
<tr><th id="3153">3153</th><td><i>			 * vm_pgoff linearity between src and dst vmas</i></td></tr>
<tr><th id="3154">3154</th><td><i>			 * (in turn preventing a vma_merge) to be</i></td></tr>
<tr><th id="3155">3155</th><td><i>			 * safe. It is only safe to keep the vm_pgoff</i></td></tr>
<tr><th id="3156">3156</th><td><i>			 * linear if there are no pages mapped yet.</i></td></tr>
<tr><th id="3157">3157</th><td><i>			 */</i></td></tr>
<tr><th id="3158">3158</th><td>			<a class="macro" href="../include/linux/mmdebug.h.html#47" title="((void)(sizeof(( long)(faulted_in_anon_vma))))" data-ref="_M/VM_BUG_ON_VMA">VM_BUG_ON_VMA</a>(<a class="local col7 ref" href="#457faulted_in_anon_vma" title='faulted_in_anon_vma' data-ref="457faulted_in_anon_vma">faulted_in_anon_vma</a>, new_vma);</td></tr>
<tr><th id="3159">3159</th><td>			*<a class="local col5 ref" href="#445vmap" title='vmap' data-ref="445vmap">vmap</a> = <a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a> = <a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>;</td></tr>
<tr><th id="3160">3160</th><td>		}</td></tr>
<tr><th id="3161">3161</th><td>		*<a class="local col9 ref" href="#449need_rmap_locks" title='need_rmap_locks' data-ref="449need_rmap_locks">need_rmap_locks</a> = (<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> &lt;= <a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a>);</td></tr>
<tr><th id="3162">3162</th><td>	} <b>else</b> {</td></tr>
<tr><th id="3163">3163</th><td>		<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a> = <a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_alloc" title='kmem_cache_alloc' data-ref="kmem_cache_alloc">kmem_cache_alloc</a>(<a class="ref" href="../include/linux/mm.h.html#vm_area_cachep" title='vm_area_cachep' data-ref="vm_area_cachep">vm_area_cachep</a>, <a class="macro" href="../include/linux/gfp.h.html#278" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="3164">3164</th><td>		<b>if</b> (!<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>)</td></tr>
<tr><th id="3165">3165</th><td>			<b>goto</b> <a class="lbl" href="#458out" data-ref="458out">out</a>;</td></tr>
<tr><th id="3166">3166</th><td>		*<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a> = *<a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a>;</td></tr>
<tr><th id="3167">3167</th><td>		<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> = <a class="local col6 ref" href="#446addr" title='addr' data-ref="446addr">addr</a>;</td></tr>
<tr><th id="3168">3168</th><td>		<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> = <a class="local col6 ref" href="#446addr" title='addr' data-ref="446addr">addr</a> + <a class="local col7 ref" href="#447len" title='len' data-ref="447len">len</a>;</td></tr>
<tr><th id="3169">3169</th><td>		<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_pgoff" title='vm_area_struct::vm_pgoff' data-ref="vm_area_struct::vm_pgoff">vm_pgoff</a> = <a class="local col8 ref" href="#448pgoff" title='pgoff' data-ref="448pgoff">pgoff</a>;</td></tr>
<tr><th id="3170">3170</th><td>		<b>if</b> (<a class="ref fn" href="../include/linux/mempolicy.h.html#vma_dup_policy" title='vma_dup_policy' data-ref="vma_dup_policy">vma_dup_policy</a>(<a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a>, <a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>))</td></tr>
<tr><th id="3171">3171</th><td>			<b>goto</b> <a class="lbl" href="#459out_free_vma" data-ref="459out_free_vma">out_free_vma</a>;</td></tr>
<tr><th id="3172">3172</th><td>		<a class="ref fn" href="../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma_chain" title='vm_area_struct::anon_vma_chain' data-ref="vm_area_struct::anon_vma_chain">anon_vma_chain</a>);</td></tr>
<tr><th id="3173">3173</th><td>		<b>if</b> (<a class="ref fn" href="../include/linux/rmap.h.html#anon_vma_clone" title='anon_vma_clone' data-ref="anon_vma_clone">anon_vma_clone</a>(<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>, <a class="local col0 ref" href="#450vma" title='vma' data-ref="450vma">vma</a>))</td></tr>
<tr><th id="3174">3174</th><td>			<b>goto</b> <a class="lbl" href="#460out_free_mempol" data-ref="460out_free_mempol">out_free_mempol</a>;</td></tr>
<tr><th id="3175">3175</th><td>		<b>if</b> (<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>)</td></tr>
<tr><th id="3176">3176</th><td>			<a class="ref fn" href="../include/linux/fs.h.html#get_file" title='get_file' data-ref="get_file">get_file</a>(<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>);</td></tr>
<tr><th id="3177">3177</th><td>		<b>if</b> (<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a> &amp;&amp; <a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::open" title='vm_operations_struct::open' data-ref="vm_operations_struct::open">open</a>)</td></tr>
<tr><th id="3178">3178</th><td>			<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::open" title='vm_operations_struct::open' data-ref="vm_operations_struct::open">open</a>(<a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>);</td></tr>
<tr><th id="3179">3179</th><td>		<a class="tu ref fn" href="#vma_link" title='vma_link' data-use='c' data-ref="vma_link">vma_link</a>(<a class="local col2 ref" href="#452mm" title='mm' data-ref="452mm">mm</a>, <a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>, <a class="local col4 ref" href="#454prev" title='prev' data-ref="454prev">prev</a>, <a class="local col5 ref" href="#455rb_link" title='rb_link' data-ref="455rb_link">rb_link</a>, <a class="local col6 ref" href="#456rb_parent" title='rb_parent' data-ref="456rb_parent">rb_parent</a>);</td></tr>
<tr><th id="3180">3180</th><td>		*<a class="local col9 ref" href="#449need_rmap_locks" title='need_rmap_locks' data-ref="449need_rmap_locks">need_rmap_locks</a> = <a class="enum" href="../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="3181">3181</th><td>	}</td></tr>
<tr><th id="3182">3182</th><td>	<b>return</b> <a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>;</td></tr>
<tr><th id="3183">3183</th><td></td></tr>
<tr><th id="3184">3184</th><td><dfn class="lbl" id="460out_free_mempol" data-ref="460out_free_mempol">out_free_mempol</dfn>:</td></tr>
<tr><th id="3185">3185</th><td>	<a class="ref fn" href="../include/linux/mempolicy.h.html#mpol_put" title='mpol_put' data-ref="mpol_put">mpol_put</a>(<a class="macro" href="../include/linux/mempolicy.h.html#246" title="((void *)0)" data-ref="_M/vma_policy">vma_policy</a>(new_vma));</td></tr>
<tr><th id="3186">3186</th><td><dfn class="lbl" id="459out_free_vma" data-ref="459out_free_vma">out_free_vma</dfn>:</td></tr>
<tr><th id="3187">3187</th><td>	<a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_free" title='kmem_cache_free' data-ref="kmem_cache_free">kmem_cache_free</a>(<a class="ref" href="../include/linux/mm.h.html#vm_area_cachep" title='vm_area_cachep' data-ref="vm_area_cachep">vm_area_cachep</a>, <a class="local col3 ref" href="#453new_vma" title='new_vma' data-ref="453new_vma">new_vma</a>);</td></tr>
<tr><th id="3188">3188</th><td><dfn class="lbl" id="458out" data-ref="458out">out</dfn>:</td></tr>
<tr><th id="3189">3189</th><td>	<b>return</b> <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="3190">3190</th><td>}</td></tr>
<tr><th id="3191">3191</th><td></td></tr>
<tr><th id="3192">3192</th><td><i>/*</i></td></tr>
<tr><th id="3193">3193</th><td><i> * Return true if the calling process may expand its vm space by the passed</i></td></tr>
<tr><th id="3194">3194</th><td><i> * number of pages</i></td></tr>
<tr><th id="3195">3195</th><td><i> */</i></td></tr>
<tr><th id="3196">3196</th><td><a class="typedef" href="../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="decl def fn" id="may_expand_vm" title='may_expand_vm' data-ref="may_expand_vm">may_expand_vm</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col1 decl" id="461mm" title='mm' data-type='struct mm_struct *' data-ref="461mm">mm</dfn>, <a class="typedef" href="../include/linux/mm_types.h.html#vm_flags_t" title='vm_flags_t' data-type='unsigned long' data-ref="vm_flags_t">vm_flags_t</a> <dfn class="local col2 decl" id="462flags" title='flags' data-type='vm_flags_t' data-ref="462flags">flags</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col3 decl" id="463npages" title='npages' data-type='unsigned long' data-ref="463npages">npages</dfn>)</td></tr>
<tr><th id="3197">3197</th><td>{</td></tr>
<tr><th id="3198">3198</th><td>	<b>if</b> (<a class="local col1 ref" href="#461mm" title='mm' data-ref="461mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::total_vm" title='mm_struct::total_vm' data-ref="mm_struct::total_vm">total_vm</a> + <a class="local col3 ref" href="#463npages" title='npages' data-ref="463npages">npages</a> &gt; <a class="ref fn" href="../include/linux/sched/signal.h.html#rlimit" title='rlimit' data-ref="rlimit">rlimit</a>(<a class="macro" href="../include/uapi/asm-generic/resource.h.html#39" title="9" data-ref="_M/RLIMIT_AS">RLIMIT_AS</a>) &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>)</td></tr>
<tr><th id="3199">3199</th><td>		<b>return</b> <a class="enum" href="../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="3200">3200</th><td></td></tr>
<tr><th id="3201">3201</th><td>	<b>if</b> (<a class="ref fn" href="internal.h.html#is_data_mapping" title='is_data_mapping' data-ref="is_data_mapping">is_data_mapping</a>(<a class="local col2 ref" href="#462flags" title='flags' data-ref="462flags">flags</a>) &amp;&amp;</td></tr>
<tr><th id="3202">3202</th><td>	    <a class="local col1 ref" href="#461mm" title='mm' data-ref="461mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::data_vm" title='mm_struct::data_vm' data-ref="mm_struct::data_vm">data_vm</a> + <a class="local col3 ref" href="#463npages" title='npages' data-ref="463npages">npages</a> &gt; <a class="ref fn" href="../include/linux/sched/signal.h.html#rlimit" title='rlimit' data-ref="rlimit">rlimit</a>(<a class="macro" href="../include/uapi/asm-generic/resource.h.html#18" title="2" data-ref="_M/RLIMIT_DATA">RLIMIT_DATA</a>) &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>) {</td></tr>
<tr><th id="3203">3203</th><td>		<i>/* Workaround for Valgrind */</i></td></tr>
<tr><th id="3204">3204</th><td>		<b>if</b> (<a class="ref fn" href="../include/linux/sched/signal.h.html#rlimit" title='rlimit' data-ref="rlimit">rlimit</a>(<a class="macro" href="../include/uapi/asm-generic/resource.h.html#18" title="2" data-ref="_M/RLIMIT_DATA">RLIMIT_DATA</a>) == <var>0</var> &amp;&amp;</td></tr>
<tr><th id="3205">3205</th><td>		    <a class="local col1 ref" href="#461mm" title='mm' data-ref="461mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::data_vm" title='mm_struct::data_vm' data-ref="mm_struct::data_vm">data_vm</a> + <a class="local col3 ref" href="#463npages" title='npages' data-ref="463npages">npages</a> &lt;= <a class="ref fn" href="../include/linux/sched/signal.h.html#rlimit_max" title='rlimit_max' data-ref="rlimit_max">rlimit_max</a>(<a class="macro" href="../include/uapi/asm-generic/resource.h.html#18" title="2" data-ref="_M/RLIMIT_DATA">RLIMIT_DATA</a>) &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>)</td></tr>
<tr><th id="3206">3206</th><td>			<b>return</b> <a class="enum" href="../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="3207">3207</th><td>		<b>if</b> (!<a class="tu ref" href="#ignore_rlimit_data" title='ignore_rlimit_data' data-use='r' data-ref="ignore_rlimit_data">ignore_rlimit_data</a>) {</td></tr>
<tr><th id="3208">3208</th><td>			<a class="macro" href="../include/linux/printk.h.html#385" title="({ static bool __print_once __attribute__((__section__(&quot;.data..read_mostly&quot;))); bool __ret_print_once = !__print_once; if (!__print_once) { __print_once = true; printk(&quot;\001&quot; &quot;4&quot; &quot;mmap&quot; &quot;: &quot; &quot;%s (%d): VmData %lu exceed data ulimit %lu. Update limits or use boot option ignore_rlimit_data.\n&quot;, get_current()-&gt;comm, get_current()-&gt;pid, (mm-&gt;data_vm + npages) &lt;&lt; 12, rlimit(2)); } __builtin_expect(!!(__ret_print_once), 0); })" data-ref="_M/pr_warn_once">pr_warn_once</a>(<q>"%s (%d): VmData %lu exceed data ulimit %lu. Update limits or use boot option ignore_rlimit_data.\n"</q>,</td></tr>
<tr><th id="3209">3209</th><td>				     current-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::comm" title='task_struct::comm' data-ref="task_struct::comm">comm</a>, current-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::pid" title='task_struct::pid' data-ref="task_struct::pid">pid</a>,</td></tr>
<tr><th id="3210">3210</th><td>				     (<a class="local col1 ref" href="#461mm" title='mm' data-ref="461mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::data_vm" title='mm_struct::data_vm' data-ref="mm_struct::data_vm">data_vm</a> + <a class="local col3 ref" href="#463npages" title='npages' data-ref="463npages">npages</a>) &lt;&lt; PAGE_SHIFT,</td></tr>
<tr><th id="3211">3211</th><td>				     <a class="ref fn" href="../include/linux/sched/signal.h.html#rlimit" title='rlimit' data-ref="rlimit">rlimit</a>(RLIMIT_DATA));</td></tr>
<tr><th id="3212">3212</th><td>			<b>return</b> <a class="enum" href="../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="3213">3213</th><td>		}</td></tr>
<tr><th id="3214">3214</th><td>	}</td></tr>
<tr><th id="3215">3215</th><td></td></tr>
<tr><th id="3216">3216</th><td>	<b>return</b> <a class="enum" href="../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="3217">3217</th><td>}</td></tr>
<tr><th id="3218">3218</th><td></td></tr>
<tr><th id="3219">3219</th><td><em>void</em> <dfn class="decl def fn" id="vm_stat_account" title='vm_stat_account' data-ref="vm_stat_account">vm_stat_account</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col4 decl" id="464mm" title='mm' data-type='struct mm_struct *' data-ref="464mm">mm</dfn>, <a class="typedef" href="../include/linux/mm_types.h.html#vm_flags_t" title='vm_flags_t' data-type='unsigned long' data-ref="vm_flags_t">vm_flags_t</a> <dfn class="local col5 decl" id="465flags" title='flags' data-type='vm_flags_t' data-ref="465flags">flags</dfn>, <em>long</em> <dfn class="local col6 decl" id="466npages" title='npages' data-type='long' data-ref="466npages">npages</dfn>)</td></tr>
<tr><th id="3220">3220</th><td>{</td></tr>
<tr><th id="3221">3221</th><td>	<a class="local col4 ref" href="#464mm" title='mm' data-ref="464mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::total_vm" title='mm_struct::total_vm' data-ref="mm_struct::total_vm">total_vm</a> += <a class="local col6 ref" href="#466npages" title='npages' data-ref="466npages">npages</a>;</td></tr>
<tr><th id="3222">3222</th><td></td></tr>
<tr><th id="3223">3223</th><td>	<b>if</b> (<a class="ref fn" href="internal.h.html#is_exec_mapping" title='is_exec_mapping' data-ref="is_exec_mapping">is_exec_mapping</a>(<a class="local col5 ref" href="#465flags" title='flags' data-ref="465flags">flags</a>))</td></tr>
<tr><th id="3224">3224</th><td>		<a class="local col4 ref" href="#464mm" title='mm' data-ref="464mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::exec_vm" title='mm_struct::exec_vm' data-ref="mm_struct::exec_vm">exec_vm</a> += <a class="local col6 ref" href="#466npages" title='npages' data-ref="466npages">npages</a>;</td></tr>
<tr><th id="3225">3225</th><td>	<b>else</b> <b>if</b> (<a class="ref fn" href="internal.h.html#is_stack_mapping" title='is_stack_mapping' data-ref="is_stack_mapping">is_stack_mapping</a>(<a class="local col5 ref" href="#465flags" title='flags' data-ref="465flags">flags</a>))</td></tr>
<tr><th id="3226">3226</th><td>		<a class="local col4 ref" href="#464mm" title='mm' data-ref="464mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::stack_vm" title='mm_struct::stack_vm' data-ref="mm_struct::stack_vm">stack_vm</a> += <a class="local col6 ref" href="#466npages" title='npages' data-ref="466npages">npages</a>;</td></tr>
<tr><th id="3227">3227</th><td>	<b>else</b> <b>if</b> (<a class="ref fn" href="internal.h.html#is_data_mapping" title='is_data_mapping' data-ref="is_data_mapping">is_data_mapping</a>(<a class="local col5 ref" href="#465flags" title='flags' data-ref="465flags">flags</a>))</td></tr>
<tr><th id="3228">3228</th><td>		<a class="local col4 ref" href="#464mm" title='mm' data-ref="464mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::data_vm" title='mm_struct::data_vm' data-ref="mm_struct::data_vm">data_vm</a> += <a class="local col6 ref" href="#466npages" title='npages' data-ref="466npages">npages</a>;</td></tr>
<tr><th id="3229">3229</th><td>}</td></tr>
<tr><th id="3230">3230</th><td></td></tr>
<tr><th id="3231">3231</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#special_mapping_fault" title='special_mapping_fault' data-type='int special_mapping_fault(struct vm_fault * vmf)' data-ref="special_mapping_fault">special_mapping_fault</a>(<b>struct</b> <a class="type" href="../include/linux/mm.h.html#vm_fault" title='vm_fault' data-ref="vm_fault">vm_fault</a> *<dfn class="local col7 decl" id="467vmf" title='vmf' data-type='struct vm_fault *' data-ref="467vmf">vmf</dfn>);</td></tr>
<tr><th id="3232">3232</th><td></td></tr>
<tr><th id="3233">3233</th><td><i  data-doc="special_mapping_close">/*</i></td></tr>
<tr><th id="3234">3234</th><td><i  data-doc="special_mapping_close"> * Having a close hook prevents vma merging regardless of flags.</i></td></tr>
<tr><th id="3235">3235</th><td><i  data-doc="special_mapping_close"> */</i></td></tr>
<tr><th id="3236">3236</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="special_mapping_close" title='special_mapping_close' data-type='void special_mapping_close(struct vm_area_struct * vma)' data-ref="special_mapping_close">special_mapping_close</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col8 decl" id="468vma" title='vma' data-type='struct vm_area_struct *' data-ref="468vma">vma</dfn>)</td></tr>
<tr><th id="3237">3237</th><td>{</td></tr>
<tr><th id="3238">3238</th><td>}</td></tr>
<tr><th id="3239">3239</th><td></td></tr>
<tr><th id="3240">3240</th><td><em>static</em> <em>const</em> <em>char</em> *<dfn class="tu decl def fn" id="special_mapping_name" title='special_mapping_name' data-type='const char * special_mapping_name(struct vm_area_struct * vma)' data-ref="special_mapping_name">special_mapping_name</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col9 decl" id="469vma" title='vma' data-type='struct vm_area_struct *' data-ref="469vma">vma</dfn>)</td></tr>
<tr><th id="3241">3241</th><td>{</td></tr>
<tr><th id="3242">3242</th><td>	<b>return</b> ((<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_special_mapping" title='vm_special_mapping' data-ref="vm_special_mapping">vm_special_mapping</a> *)<a class="local col9 ref" href="#469vma" title='vma' data-ref="469vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_private_data" title='vm_area_struct::vm_private_data' data-ref="vm_area_struct::vm_private_data">vm_private_data</a>)-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_special_mapping::name" title='vm_special_mapping::name' data-ref="vm_special_mapping::name">name</a>;</td></tr>
<tr><th id="3243">3243</th><td>}</td></tr>
<tr><th id="3244">3244</th><td></td></tr>
<tr><th id="3245">3245</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="special_mapping_mremap" title='special_mapping_mremap' data-type='int special_mapping_mremap(struct vm_area_struct * new_vma)' data-ref="special_mapping_mremap">special_mapping_mremap</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col0 decl" id="470new_vma" title='new_vma' data-type='struct vm_area_struct *' data-ref="470new_vma">new_vma</dfn>)</td></tr>
<tr><th id="3246">3246</th><td>{</td></tr>
<tr><th id="3247">3247</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_special_mapping" title='vm_special_mapping' data-ref="vm_special_mapping">vm_special_mapping</a> *<dfn class="local col1 decl" id="471sm" title='sm' data-type='struct vm_special_mapping *' data-ref="471sm">sm</dfn> = <a class="local col0 ref" href="#470new_vma" title='new_vma' data-ref="470new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_private_data" title='vm_area_struct::vm_private_data' data-ref="vm_area_struct::vm_private_data">vm_private_data</a>;</td></tr>
<tr><th id="3248">3248</th><td></td></tr>
<tr><th id="3249">3249</th><td>	<b>if</b> (<a class="macro" href="../include/asm-generic/bug.h.html#66" title="({ int __ret_warn_on = !!(get_current()-&gt;mm != new_vma-&gt;vm_mm); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/mm/mmap.c&quot;), &quot;i&quot; (3249), &quot;i&quot; ((1 &lt;&lt; 0)|((1 &lt;&lt; 1)|((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (139)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON_ONCE">WARN_ON_ONCE</a>(<a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::mm" title='task_struct::mm' data-ref="task_struct::mm">mm</a> != <a class="local col0 ref" href="#470new_vma" title='new_vma' data-ref="470new_vma">new_vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_mm" title='vm_area_struct::vm_mm' data-ref="vm_area_struct::vm_mm">vm_mm</a>))</td></tr>
<tr><th id="3250">3250</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="3251">3251</th><td></td></tr>
<tr><th id="3252">3252</th><td>	<b>if</b> (<a class="local col1 ref" href="#471sm" title='sm' data-ref="471sm">sm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_special_mapping::mremap" title='vm_special_mapping::mremap' data-ref="vm_special_mapping::mremap">mremap</a>)</td></tr>
<tr><th id="3253">3253</th><td>		<b>return</b> <a class="local col1 ref" href="#471sm" title='sm' data-ref="471sm">sm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_special_mapping::mremap" title='vm_special_mapping::mremap' data-ref="vm_special_mapping::mremap">mremap</a>(<a class="local col1 ref" href="#471sm" title='sm' data-ref="471sm">sm</a>, <a class="local col0 ref" href="#470new_vma" title='new_vma' data-ref="470new_vma">new_vma</a>);</td></tr>
<tr><th id="3254">3254</th><td></td></tr>
<tr><th id="3255">3255</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3256">3256</th><td>}</td></tr>
<tr><th id="3257">3257</th><td></td></tr>
<tr><th id="3258">3258</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="../include/linux/mm.h.html#vm_operations_struct" title='vm_operations_struct' data-ref="vm_operations_struct">vm_operations_struct</a> <dfn class="tu decl def" id="special_mapping_vmops" title='special_mapping_vmops' data-type='const struct vm_operations_struct' data-ref="special_mapping_vmops">special_mapping_vmops</dfn> = {</td></tr>
<tr><th id="3259">3259</th><td>	.<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::close" title='vm_operations_struct::close' data-ref="vm_operations_struct::close">close</a> = <a class="tu ref fn" href="#special_mapping_close" title='special_mapping_close' data-ref="special_mapping_close">special_mapping_close</a>,</td></tr>
<tr><th id="3260">3260</th><td>	.<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::fault" title='vm_operations_struct::fault' data-ref="vm_operations_struct::fault">fault</a> = <a class="tu ref fn" href="#special_mapping_fault" title='special_mapping_fault' data-ref="special_mapping_fault">special_mapping_fault</a>,</td></tr>
<tr><th id="3261">3261</th><td>	.<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::mremap" title='vm_operations_struct::mremap' data-ref="vm_operations_struct::mremap">mremap</a> = <a class="tu ref fn" href="#special_mapping_mremap" title='special_mapping_mremap' data-ref="special_mapping_mremap">special_mapping_mremap</a>,</td></tr>
<tr><th id="3262">3262</th><td>	.<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::name" title='vm_operations_struct::name' data-ref="vm_operations_struct::name">name</a> = <a class="tu ref fn" href="#special_mapping_name" title='special_mapping_name' data-ref="special_mapping_name">special_mapping_name</a>,</td></tr>
<tr><th id="3263">3263</th><td>};</td></tr>
<tr><th id="3264">3264</th><td></td></tr>
<tr><th id="3265">3265</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="../include/linux/mm.h.html#vm_operations_struct" title='vm_operations_struct' data-ref="vm_operations_struct">vm_operations_struct</a> <dfn class="tu decl def" id="legacy_special_mapping_vmops" title='legacy_special_mapping_vmops' data-type='const struct vm_operations_struct' data-ref="legacy_special_mapping_vmops">legacy_special_mapping_vmops</dfn> = {</td></tr>
<tr><th id="3266">3266</th><td>	.<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::close" title='vm_operations_struct::close' data-ref="vm_operations_struct::close">close</a> = <a class="tu ref fn" href="#special_mapping_close" title='special_mapping_close' data-ref="special_mapping_close">special_mapping_close</a>,</td></tr>
<tr><th id="3267">3267</th><td>	.<a class="ref field" href="../include/linux/mm.h.html#vm_operations_struct::fault" title='vm_operations_struct::fault' data-ref="vm_operations_struct::fault">fault</a> = <a class="tu ref fn" href="#special_mapping_fault" title='special_mapping_fault' data-ref="special_mapping_fault">special_mapping_fault</a>,</td></tr>
<tr><th id="3268">3268</th><td>};</td></tr>
<tr><th id="3269">3269</th><td></td></tr>
<tr><th id="3270">3270</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="special_mapping_fault" title='special_mapping_fault' data-type='int special_mapping_fault(struct vm_fault * vmf)' data-ref="special_mapping_fault">special_mapping_fault</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm.h.html#vm_fault" title='vm_fault' data-ref="vm_fault">vm_fault</a> *<dfn class="local col2 decl" id="472vmf" title='vmf' data-type='struct vm_fault *' data-ref="472vmf">vmf</dfn>)</td></tr>
<tr><th id="3271">3271</th><td>{</td></tr>
<tr><th id="3272">3272</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col3 decl" id="473vma" title='vma' data-type='struct vm_area_struct *' data-ref="473vma">vma</dfn> = <a class="local col2 ref" href="#472vmf" title='vmf' data-ref="472vmf">vmf</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_fault::vma" title='vm_fault::vma' data-ref="vm_fault::vma">vma</a>;</td></tr>
<tr><th id="3273">3273</th><td>	<a class="macro" href="../include/linux/types.h.html#141" title="unsigned long" data-ref="_M/pgoff_t">pgoff_t</a> <dfn class="local col4 decl" id="474pgoff" title='pgoff' data-type='unsigned long' data-ref="474pgoff">pgoff</dfn>;</td></tr>
<tr><th id="3274">3274</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#page" title='page' data-ref="page">page</a> **<dfn class="local col5 decl" id="475pages" title='pages' data-type='struct page **' data-ref="475pages">pages</dfn>;</td></tr>
<tr><th id="3275">3275</th><td></td></tr>
<tr><th id="3276">3276</th><td>	<b>if</b> (<a class="local col3 ref" href="#473vma" title='vma' data-ref="473vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a> == &amp;<a class="tu ref" href="#legacy_special_mapping_vmops" title='legacy_special_mapping_vmops' data-use='a' data-ref="legacy_special_mapping_vmops">legacy_special_mapping_vmops</a>) {</td></tr>
<tr><th id="3277">3277</th><td>		<a class="local col5 ref" href="#475pages" title='pages' data-ref="475pages">pages</a> = <a class="local col3 ref" href="#473vma" title='vma' data-ref="473vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_private_data" title='vm_area_struct::vm_private_data' data-ref="vm_area_struct::vm_private_data">vm_private_data</a>;</td></tr>
<tr><th id="3278">3278</th><td>	} <b>else</b> {</td></tr>
<tr><th id="3279">3279</th><td>		<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_special_mapping" title='vm_special_mapping' data-ref="vm_special_mapping">vm_special_mapping</a> *<dfn class="local col6 decl" id="476sm" title='sm' data-type='struct vm_special_mapping *' data-ref="476sm">sm</dfn> = <a class="local col3 ref" href="#473vma" title='vma' data-ref="473vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_private_data" title='vm_area_struct::vm_private_data' data-ref="vm_area_struct::vm_private_data">vm_private_data</a>;</td></tr>
<tr><th id="3280">3280</th><td></td></tr>
<tr><th id="3281">3281</th><td>		<b>if</b> (<a class="local col6 ref" href="#476sm" title='sm' data-ref="476sm">sm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_special_mapping::fault" title='vm_special_mapping::fault' data-ref="vm_special_mapping::fault">fault</a>)</td></tr>
<tr><th id="3282">3282</th><td>			<b>return</b> <a class="local col6 ref" href="#476sm" title='sm' data-ref="476sm">sm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_special_mapping::fault" title='vm_special_mapping::fault' data-ref="vm_special_mapping::fault">fault</a>(<a class="local col6 ref" href="#476sm" title='sm' data-ref="476sm">sm</a>, <a class="local col2 ref" href="#472vmf" title='vmf' data-ref="472vmf">vmf</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_fault::vma" title='vm_fault::vma' data-ref="vm_fault::vma">vma</a>, <a class="local col2 ref" href="#472vmf" title='vmf' data-ref="472vmf">vmf</a>);</td></tr>
<tr><th id="3283">3283</th><td></td></tr>
<tr><th id="3284">3284</th><td>		<a class="local col5 ref" href="#475pages" title='pages' data-ref="475pages">pages</a> = <a class="local col6 ref" href="#476sm" title='sm' data-ref="476sm">sm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_special_mapping::pages" title='vm_special_mapping::pages' data-ref="vm_special_mapping::pages">pages</a>;</td></tr>
<tr><th id="3285">3285</th><td>	}</td></tr>
<tr><th id="3286">3286</th><td></td></tr>
<tr><th id="3287">3287</th><td>	<b>for</b> (<a class="local col4 ref" href="#474pgoff" title='pgoff' data-ref="474pgoff">pgoff</a> = <a class="local col2 ref" href="#472vmf" title='vmf' data-ref="472vmf">vmf</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_fault::pgoff" title='vm_fault::pgoff' data-ref="vm_fault::pgoff">pgoff</a>; <a class="local col4 ref" href="#474pgoff" title='pgoff' data-ref="474pgoff">pgoff</a> &amp;&amp; *<a class="local col5 ref" href="#475pages" title='pages' data-ref="475pages">pages</a>; ++<a class="local col5 ref" href="#475pages" title='pages' data-ref="475pages">pages</a>)</td></tr>
<tr><th id="3288">3288</th><td>		<a class="local col4 ref" href="#474pgoff" title='pgoff' data-ref="474pgoff">pgoff</a>--;</td></tr>
<tr><th id="3289">3289</th><td></td></tr>
<tr><th id="3290">3290</th><td>	<b>if</b> (*<a class="local col5 ref" href="#475pages" title='pages' data-ref="475pages">pages</a>) {</td></tr>
<tr><th id="3291">3291</th><td>		<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#page" title='page' data-ref="page">page</a> *<dfn class="local col7 decl" id="477page" title='page' data-type='struct page *' data-ref="477page">page</dfn> = *<a class="local col5 ref" href="#475pages" title='pages' data-ref="475pages">pages</a>;</td></tr>
<tr><th id="3292">3292</th><td>		<a class="ref fn" href="../include/linux/mm.h.html#get_page" title='get_page' data-ref="get_page">get_page</a>(<a class="local col7 ref" href="#477page" title='page' data-ref="477page">page</a>);</td></tr>
<tr><th id="3293">3293</th><td>		<a class="local col2 ref" href="#472vmf" title='vmf' data-ref="472vmf">vmf</a>-&gt;<a class="ref field" href="../include/linux/mm.h.html#vm_fault::page" title='vm_fault::page' data-ref="vm_fault::page">page</a> = <a class="local col7 ref" href="#477page" title='page' data-ref="477page">page</a>;</td></tr>
<tr><th id="3294">3294</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3295">3295</th><td>	}</td></tr>
<tr><th id="3296">3296</th><td></td></tr>
<tr><th id="3297">3297</th><td>	<b>return</b> <a class="macro" href="../include/linux/mm.h.html#1174" title="0x0002" data-ref="_M/VM_FAULT_SIGBUS">VM_FAULT_SIGBUS</a>;</td></tr>
<tr><th id="3298">3298</th><td>}</td></tr>
<tr><th id="3299">3299</th><td></td></tr>
<tr><th id="3300">3300</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="tu decl def fn" id="__install_special_mapping" title='__install_special_mapping' data-type='struct vm_area_struct * __install_special_mapping(struct mm_struct * mm, unsigned long addr, unsigned long len, unsigned long vm_flags, void * priv, const struct vm_operations_struct * ops)' data-ref="__install_special_mapping">__install_special_mapping</dfn>(</td></tr>
<tr><th id="3301">3301</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col8 decl" id="478mm" title='mm' data-type='struct mm_struct *' data-ref="478mm">mm</dfn>,</td></tr>
<tr><th id="3302">3302</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="479addr" title='addr' data-type='unsigned long' data-ref="479addr">addr</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="480len" title='len' data-type='unsigned long' data-ref="480len">len</dfn>,</td></tr>
<tr><th id="3303">3303</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col1 decl" id="481vm_flags" title='vm_flags' data-type='unsigned long' data-ref="481vm_flags">vm_flags</dfn>, <em>void</em> *<dfn class="local col2 decl" id="482priv" title='priv' data-type='void *' data-ref="482priv">priv</dfn>,</td></tr>
<tr><th id="3304">3304</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../include/linux/mm.h.html#vm_operations_struct" title='vm_operations_struct' data-ref="vm_operations_struct">vm_operations_struct</a> *<dfn class="local col3 decl" id="483ops" title='ops' data-type='const struct vm_operations_struct *' data-ref="483ops">ops</dfn>)</td></tr>
<tr><th id="3305">3305</th><td>{</td></tr>
<tr><th id="3306">3306</th><td>	<em>int</em> <dfn class="local col4 decl" id="484ret" title='ret' data-type='int' data-ref="484ret">ret</dfn>;</td></tr>
<tr><th id="3307">3307</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col5 decl" id="485vma" title='vma' data-type='struct vm_area_struct *' data-ref="485vma">vma</dfn>;</td></tr>
<tr><th id="3308">3308</th><td></td></tr>
<tr><th id="3309">3309</th><td>	<a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a> = <a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_zalloc" title='kmem_cache_zalloc' data-ref="kmem_cache_zalloc">kmem_cache_zalloc</a>(<a class="ref" href="../include/linux/mm.h.html#vm_area_cachep" title='vm_area_cachep' data-ref="vm_area_cachep">vm_area_cachep</a>, <a class="macro" href="../include/linux/gfp.h.html#278" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="3310">3310</th><td>	<b>if</b> (<a class="macro" href="../include/linux/compiler.h.html#77" title="__builtin_expect(!!(vma == ((void *)0)), 0)" data-ref="_M/unlikely">unlikely</a>(<a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a> == <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>))</td></tr>
<tr><th id="3311">3311</th><td>		<b>return</b> <a class="ref fn" href="../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="3312">3312</th><td></td></tr>
<tr><th id="3313">3313</th><td>	<a class="ref fn" href="../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma_chain" title='vm_area_struct::anon_vma_chain' data-ref="vm_area_struct::anon_vma_chain">anon_vma_chain</a>);</td></tr>
<tr><th id="3314">3314</th><td>	<a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_mm" title='vm_area_struct::vm_mm' data-ref="vm_area_struct::vm_mm">vm_mm</a> = <a class="local col8 ref" href="#478mm" title='mm' data-ref="478mm">mm</a>;</td></tr>
<tr><th id="3315">3315</th><td>	<a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_start" title='vm_area_struct::vm_start' data-ref="vm_area_struct::vm_start">vm_start</a> = <a class="local col9 ref" href="#479addr" title='addr' data-ref="479addr">addr</a>;</td></tr>
<tr><th id="3316">3316</th><td>	<a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_end" title='vm_area_struct::vm_end' data-ref="vm_area_struct::vm_end">vm_end</a> = <a class="local col9 ref" href="#479addr" title='addr' data-ref="479addr">addr</a> + <a class="local col0 ref" href="#480len" title='len' data-ref="480len">len</a>;</td></tr>
<tr><th id="3317">3317</th><td></td></tr>
<tr><th id="3318">3318</th><td>	<a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a> = <a class="local col1 ref" href="#481vm_flags" title='vm_flags' data-ref="481vm_flags">vm_flags</a> | <a class="local col8 ref" href="#478mm" title='mm' data-ref="478mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::def_flags" title='mm_struct::def_flags' data-ref="mm_struct::def_flags">def_flags</a> | <a class="macro" href="../include/linux/mm.h.html#188" title="0x00040000" data-ref="_M/VM_DONTEXPAND">VM_DONTEXPAND</a> | <a class="macro" href="../include/linux/mm.h.html#200" title="0" data-ref="_M/VM_SOFTDIRTY">VM_SOFTDIRTY</a>;</td></tr>
<tr><th id="3319">3319</th><td>	<a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_page_prot" title='vm_area_struct::vm_page_prot' data-ref="vm_area_struct::vm_page_prot">vm_page_prot</a> = <a class="ref fn" href="#vm_get_page_prot" title='vm_get_page_prot' data-ref="vm_get_page_prot">vm_get_page_prot</a>(<a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a>);</td></tr>
<tr><th id="3320">3320</th><td></td></tr>
<tr><th id="3321">3321</th><td>	<a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a> = <a class="local col3 ref" href="#483ops" title='ops' data-ref="483ops">ops</a>;</td></tr>
<tr><th id="3322">3322</th><td>	<a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_private_data" title='vm_area_struct::vm_private_data' data-ref="vm_area_struct::vm_private_data">vm_private_data</a> = <a class="local col2 ref" href="#482priv" title='priv' data-ref="482priv">priv</a>;</td></tr>
<tr><th id="3323">3323</th><td></td></tr>
<tr><th id="3324">3324</th><td>	<a class="local col4 ref" href="#484ret" title='ret' data-ref="484ret">ret</a> = <a class="ref fn" href="#insert_vm_struct" title='insert_vm_struct' data-ref="insert_vm_struct">insert_vm_struct</a>(<a class="local col8 ref" href="#478mm" title='mm' data-ref="478mm">mm</a>, <a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>);</td></tr>
<tr><th id="3325">3325</th><td>	<b>if</b> (<a class="local col4 ref" href="#484ret" title='ret' data-ref="484ret">ret</a>)</td></tr>
<tr><th id="3326">3326</th><td>		<b>goto</b> <a class="lbl" href="#486out" data-ref="486out">out</a>;</td></tr>
<tr><th id="3327">3327</th><td></td></tr>
<tr><th id="3328">3328</th><td>	<a class="ref fn" href="#vm_stat_account" title='vm_stat_account' data-ref="vm_stat_account">vm_stat_account</a>(<a class="local col8 ref" href="#478mm" title='mm' data-ref="478mm">mm</a>, <a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_flags" title='vm_area_struct::vm_flags' data-ref="vm_area_struct::vm_flags">vm_flags</a>, <a class="local col0 ref" href="#480len" title='len' data-ref="480len">len</a> &gt;&gt; <a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>);</td></tr>
<tr><th id="3329">3329</th><td></td></tr>
<tr><th id="3330">3330</th><td>	<a class="ref fn" href="../include/linux/perf_event.h.html#perf_event_mmap" title='perf_event_mmap' data-ref="perf_event_mmap">perf_event_mmap</a>(<a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>);</td></tr>
<tr><th id="3331">3331</th><td></td></tr>
<tr><th id="3332">3332</th><td>	<b>return</b> <a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>;</td></tr>
<tr><th id="3333">3333</th><td></td></tr>
<tr><th id="3334">3334</th><td><dfn class="lbl" id="486out" data-ref="486out">out</dfn>:</td></tr>
<tr><th id="3335">3335</th><td>	<a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_free" title='kmem_cache_free' data-ref="kmem_cache_free">kmem_cache_free</a>(<a class="ref" href="../include/linux/mm.h.html#vm_area_cachep" title='vm_area_cachep' data-ref="vm_area_cachep">vm_area_cachep</a>, <a class="local col5 ref" href="#485vma" title='vma' data-ref="485vma">vma</a>);</td></tr>
<tr><th id="3336">3336</th><td>	<b>return</b> <a class="ref fn" href="../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR">ERR_PTR</a>(<a class="local col4 ref" href="#484ret" title='ret' data-ref="484ret">ret</a>);</td></tr>
<tr><th id="3337">3337</th><td>}</td></tr>
<tr><th id="3338">3338</th><td></td></tr>
<tr><th id="3339">3339</th><td><a class="typedef" href="../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="decl def fn" id="vma_is_special_mapping" title='vma_is_special_mapping' data-ref="vma_is_special_mapping">vma_is_special_mapping</dfn>(<em>const</em> <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col7 decl" id="487vma" title='vma' data-type='const struct vm_area_struct *' data-ref="487vma">vma</dfn>,</td></tr>
<tr><th id="3340">3340</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_special_mapping" title='vm_special_mapping' data-ref="vm_special_mapping">vm_special_mapping</a> *<dfn class="local col8 decl" id="488sm" title='sm' data-type='const struct vm_special_mapping *' data-ref="488sm">sm</dfn>)</td></tr>
<tr><th id="3341">3341</th><td>{</td></tr>
<tr><th id="3342">3342</th><td>	<b>return</b> <a class="local col7 ref" href="#487vma" title='vma' data-ref="487vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_private_data" title='vm_area_struct::vm_private_data' data-ref="vm_area_struct::vm_private_data">vm_private_data</a> == <a class="local col8 ref" href="#488sm" title='sm' data-ref="488sm">sm</a> &amp;&amp;</td></tr>
<tr><th id="3343">3343</th><td>		(<a class="local col7 ref" href="#487vma" title='vma' data-ref="487vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a> == &amp;<a class="tu ref" href="#special_mapping_vmops" title='special_mapping_vmops' data-use='a' data-ref="special_mapping_vmops">special_mapping_vmops</a> ||</td></tr>
<tr><th id="3344">3344</th><td>		 <a class="local col7 ref" href="#487vma" title='vma' data-ref="487vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_ops" title='vm_area_struct::vm_ops' data-ref="vm_area_struct::vm_ops">vm_ops</a> == &amp;<a class="tu ref" href="#legacy_special_mapping_vmops" title='legacy_special_mapping_vmops' data-use='a' data-ref="legacy_special_mapping_vmops">legacy_special_mapping_vmops</a>);</td></tr>
<tr><th id="3345">3345</th><td>}</td></tr>
<tr><th id="3346">3346</th><td></td></tr>
<tr><th id="3347">3347</th><td><i>/*</i></td></tr>
<tr><th id="3348">3348</th><td><i> * Called with mm-&gt;mmap_sem held for writing.</i></td></tr>
<tr><th id="3349">3349</th><td><i> * Insert a new vma covering the given region, with the given flags.</i></td></tr>
<tr><th id="3350">3350</th><td><i> * Its pages are supplied by the given array of struct page *.</i></td></tr>
<tr><th id="3351">3351</th><td><i> * The array can be shorter than len &gt;&gt; PAGE_SHIFT if it's null-terminated.</i></td></tr>
<tr><th id="3352">3352</th><td><i> * The region past the last page supplied will always produce SIGBUS.</i></td></tr>
<tr><th id="3353">3353</th><td><i> * The array pointer and the pages it points to are assumed to stay alive</i></td></tr>
<tr><th id="3354">3354</th><td><i> * for as long as this mapping might exist.</i></td></tr>
<tr><th id="3355">3355</th><td><i> */</i></td></tr>
<tr><th id="3356">3356</th><td><b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="decl def fn" id="_install_special_mapping" title='_install_special_mapping' data-ref="_install_special_mapping">_install_special_mapping</dfn>(</td></tr>
<tr><th id="3357">3357</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col9 decl" id="489mm" title='mm' data-type='struct mm_struct *' data-ref="489mm">mm</dfn>,</td></tr>
<tr><th id="3358">3358</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="490addr" title='addr' data-type='unsigned long' data-ref="490addr">addr</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col1 decl" id="491len" title='len' data-type='unsigned long' data-ref="491len">len</dfn>,</td></tr>
<tr><th id="3359">3359</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col2 decl" id="492vm_flags" title='vm_flags' data-type='unsigned long' data-ref="492vm_flags">vm_flags</dfn>, <em>const</em> <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_special_mapping" title='vm_special_mapping' data-ref="vm_special_mapping">vm_special_mapping</a> *<dfn class="local col3 decl" id="493spec" title='spec' data-type='const struct vm_special_mapping *' data-ref="493spec">spec</dfn>)</td></tr>
<tr><th id="3360">3360</th><td>{</td></tr>
<tr><th id="3361">3361</th><td>	<b>return</b> <a class="tu ref fn" href="#__install_special_mapping" title='__install_special_mapping' data-use='c' data-ref="__install_special_mapping">__install_special_mapping</a>(<a class="local col9 ref" href="#489mm" title='mm' data-ref="489mm">mm</a>, <a class="local col0 ref" href="#490addr" title='addr' data-ref="490addr">addr</a>, <a class="local col1 ref" href="#491len" title='len' data-ref="491len">len</a>, <a class="local col2 ref" href="#492vm_flags" title='vm_flags' data-ref="492vm_flags">vm_flags</a>, (<em>void</em> *)<a class="local col3 ref" href="#493spec" title='spec' data-ref="493spec">spec</a>,</td></tr>
<tr><th id="3362">3362</th><td>					&amp;<a class="tu ref" href="#special_mapping_vmops" title='special_mapping_vmops' data-use='a' data-ref="special_mapping_vmops">special_mapping_vmops</a>);</td></tr>
<tr><th id="3363">3363</th><td>}</td></tr>
<tr><th id="3364">3364</th><td></td></tr>
<tr><th id="3365">3365</th><td><em>int</em> <dfn class="decl def fn" id="install_special_mapping" title='install_special_mapping' data-ref="install_special_mapping">install_special_mapping</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col4 decl" id="494mm" title='mm' data-type='struct mm_struct *' data-ref="494mm">mm</dfn>,</td></tr>
<tr><th id="3366">3366</th><td>			    <em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="495addr" title='addr' data-type='unsigned long' data-ref="495addr">addr</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="496len" title='len' data-type='unsigned long' data-ref="496len">len</dfn>,</td></tr>
<tr><th id="3367">3367</th><td>			    <em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="497vm_flags" title='vm_flags' data-type='unsigned long' data-ref="497vm_flags">vm_flags</dfn>, <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#page" title='page' data-ref="page">page</a> **<dfn class="local col8 decl" id="498pages" title='pages' data-type='struct page **' data-ref="498pages">pages</dfn>)</td></tr>
<tr><th id="3368">3368</th><td>{</td></tr>
<tr><th id="3369">3369</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col9 decl" id="499vma" title='vma' data-type='struct vm_area_struct *' data-ref="499vma">vma</dfn> = <a class="tu ref fn" href="#__install_special_mapping" title='__install_special_mapping' data-use='c' data-ref="__install_special_mapping">__install_special_mapping</a>(</td></tr>
<tr><th id="3370">3370</th><td>		<a class="local col4 ref" href="#494mm" title='mm' data-ref="494mm">mm</a>, <a class="local col5 ref" href="#495addr" title='addr' data-ref="495addr">addr</a>, <a class="local col6 ref" href="#496len" title='len' data-ref="496len">len</a>, <a class="local col7 ref" href="#497vm_flags" title='vm_flags' data-ref="497vm_flags">vm_flags</a>, (<em>void</em> *)<a class="local col8 ref" href="#498pages" title='pages' data-ref="498pages">pages</a>,</td></tr>
<tr><th id="3371">3371</th><td>		&amp;<a class="tu ref" href="#legacy_special_mapping_vmops" title='legacy_special_mapping_vmops' data-use='a' data-ref="legacy_special_mapping_vmops">legacy_special_mapping_vmops</a>);</td></tr>
<tr><th id="3372">3372</th><td></td></tr>
<tr><th id="3373">3373</th><td>	<b>return</b> <a class="ref fn" href="../include/linux/err.h.html#PTR_ERR_OR_ZERO" title='PTR_ERR_OR_ZERO' data-ref="PTR_ERR_OR_ZERO">PTR_ERR_OR_ZERO</a>(<a class="local col9 ref" href="#499vma" title='vma' data-ref="499vma">vma</a>);</td></tr>
<tr><th id="3374">3374</th><td>}</td></tr>
<tr><th id="3375">3375</th><td></td></tr>
<tr><th id="3376">3376</th><td><em>static</em> <a class="macro" href="../include/linux/mutex.h.html#131" title="struct mutex mm_all_locks_mutex = { .owner = { (0) } , .wait_lock = (spinlock_t ) { { .rlock = { .raw_lock = { { (0) } }, } } } , .wait_list = { &amp;(mm_all_locks_mutex.wait_list), &amp;(mm_all_locks_mutex.wait_list) } }" data-ref="_M/DEFINE_MUTEX">DEFINE_MUTEX</a>(<dfn class="tu decl def" id="mm_all_locks_mutex" title='mm_all_locks_mutex' data-type='struct mutex' data-ref="mm_all_locks_mutex"><a class="tu ref" href="#3376" title='mm_all_locks_mutex' data-use='m' data-ref="mm_all_locks_mutex"><a class="tu ref" href="#3376" title='mm_all_locks_mutex' data-use='m' data-ref="mm_all_locks_mutex"><a class="tu ref" href="#3376" title='mm_all_locks_mutex' data-use='m' data-ref="mm_all_locks_mutex"><a class="tu ref" href="#3376" title='mm_all_locks_mutex' data-use='m' data-ref="mm_all_locks_mutex"><a class="tu ref" href="#3376" title='mm_all_locks_mutex' data-use='m' data-ref="mm_all_locks_mutex"><a class="tu ref" href="#3376" title='mm_all_locks_mutex' data-use='m' data-ref="mm_all_locks_mutex"><a class="tu ref" href="#3376" title='mm_all_locks_mutex' data-use='m' data-ref="mm_all_locks_mutex"><a class="tu ref" href="#3376" title='mm_all_locks_mutex' data-use='m' data-ref="mm_all_locks_mutex">mm_all_locks_mutex</a></a></a></a></a></a></a></a></dfn>);</td></tr>
<tr><th id="3377">3377</th><td></td></tr>
<tr><th id="3378">3378</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vm_lock_anon_vma" title='vm_lock_anon_vma' data-type='void vm_lock_anon_vma(struct mm_struct * mm, struct anon_vma * anon_vma)' data-ref="vm_lock_anon_vma">vm_lock_anon_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col0 decl" id="500mm" title='mm' data-type='struct mm_struct *' data-ref="500mm">mm</dfn>, <b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma" title='anon_vma' data-ref="anon_vma">anon_vma</a> *<dfn class="local col1 decl" id="501anon_vma" title='anon_vma' data-type='struct anon_vma *' data-ref="501anon_vma">anon_vma</dfn>)</td></tr>
<tr><th id="3379">3379</th><td>{</td></tr>
<tr><th id="3380">3380</th><td>	<b>if</b> (!<a class="macro" href="../arch/x86/include/asm/bitops.h.html#349" title="(__builtin_constant_p((0)) ? constant_test_bit((0), ((unsigned long *) &amp;anon_vma-&gt;root-&gt;rb_root.rb_root.rb_node)) : variable_test_bit((0), ((unsigned long *) &amp;anon_vma-&gt;root-&gt;rb_root.rb_root.rb_node)))" data-ref="_M/test_bit">test_bit</a>(<var>0</var>, (<em>unsigned</em> <em>long</em> *) &amp;<a class="local col1 ref" href="#501anon_vma" title='anon_vma' data-ref="501anon_vma">anon_vma</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma::root" title='anon_vma::root' data-ref="anon_vma::root">root</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma::rb_root" title='anon_vma::rb_root' data-ref="anon_vma::rb_root">rb_root</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root_cached::rb_root" title='rb_root_cached::rb_root' data-ref="rb_root_cached::rb_root">rb_root</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root::rb_node" title='rb_root::rb_node' data-ref="rb_root::rb_node">rb_node</a>)) {</td></tr>
<tr><th id="3381">3381</th><td>		<i>/*</i></td></tr>
<tr><th id="3382">3382</th><td><i>		 * The LSB of head.next can't change from under us</i></td></tr>
<tr><th id="3383">3383</th><td><i>		 * because we hold the mm_all_locks_mutex.</i></td></tr>
<tr><th id="3384">3384</th><td><i>		 */</i></td></tr>
<tr><th id="3385">3385</th><td>		<a class="macro" href="../include/linux/rwsem.h.html#188" title="down_write(&amp;anon_vma-&gt;root-&gt;rwsem)" data-ref="_M/down_write_nest_lock">down_write_nest_lock</a>(&amp;<a class="local col1 ref" href="#501anon_vma" title='anon_vma' data-ref="501anon_vma">anon_vma</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma::root" title='anon_vma::root' data-ref="anon_vma::root">root</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma::rwsem" title='anon_vma::rwsem' data-ref="anon_vma::rwsem">rwsem</a>, &amp;mm-&gt;mmap_sem);</td></tr>
<tr><th id="3386">3386</th><td>		<i>/*</i></td></tr>
<tr><th id="3387">3387</th><td><i>		 * We can safely modify head.next after taking the</i></td></tr>
<tr><th id="3388">3388</th><td><i>		 * anon_vma-&gt;root-&gt;rwsem. If some other vma in this mm shares</i></td></tr>
<tr><th id="3389">3389</th><td><i>		 * the same anon_vma we won't take it again.</i></td></tr>
<tr><th id="3390">3390</th><td><i>		 *</i></td></tr>
<tr><th id="3391">3391</th><td><i>		 * No need of atomic instructions here, head.next</i></td></tr>
<tr><th id="3392">3392</th><td><i>		 * can't change from under us thanks to the</i></td></tr>
<tr><th id="3393">3393</th><td><i>		 * anon_vma-&gt;root-&gt;rwsem.</i></td></tr>
<tr><th id="3394">3394</th><td><i>		 */</i></td></tr>
<tr><th id="3395">3395</th><td>		<b>if</b> (<a class="ref fn" href="../arch/x86/include/asm/bitops.h.html#__test_and_set_bit" title='__test_and_set_bit' data-ref="__test_and_set_bit">__test_and_set_bit</a>(<var>0</var>, (<em>unsigned</em> <em>long</em> *)</td></tr>
<tr><th id="3396">3396</th><td>				       &amp;<a class="local col1 ref" href="#501anon_vma" title='anon_vma' data-ref="501anon_vma">anon_vma</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma::root" title='anon_vma::root' data-ref="anon_vma::root">root</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma::rb_root" title='anon_vma::rb_root' data-ref="anon_vma::rb_root">rb_root</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root_cached::rb_root" title='rb_root_cached::rb_root' data-ref="rb_root_cached::rb_root">rb_root</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root::rb_node" title='rb_root::rb_node' data-ref="rb_root::rb_node">rb_node</a>))</td></tr>
<tr><th id="3397">3397</th><td>			<a class="macro" href="../arch/x86/include/asm/bug.h.html#71" title="do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/mm/mmap.c&quot;), &quot;i&quot; (3397), &quot;i&quot; (0), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); do { ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (141)); }); do { } while (1); } while (0); } while (0)" data-ref="_M/BUG">BUG</a>();</td></tr>
<tr><th id="3398">3398</th><td>	}</td></tr>
<tr><th id="3399">3399</th><td>}</td></tr>
<tr><th id="3400">3400</th><td></td></tr>
<tr><th id="3401">3401</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vm_lock_mapping" title='vm_lock_mapping' data-type='void vm_lock_mapping(struct mm_struct * mm, struct address_space * mapping)' data-ref="vm_lock_mapping">vm_lock_mapping</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col2 decl" id="502mm" title='mm' data-type='struct mm_struct *' data-ref="502mm">mm</dfn>, <b>struct</b> <a class="type" href="../include/linux/fs.h.html#address_space" title='address_space' data-ref="address_space">address_space</a> *<dfn class="local col3 decl" id="503mapping" title='mapping' data-type='struct address_space *' data-ref="503mapping">mapping</dfn>)</td></tr>
<tr><th id="3402">3402</th><td>{</td></tr>
<tr><th id="3403">3403</th><td>	<b>if</b> (!<a class="macro" href="../arch/x86/include/asm/bitops.h.html#349" title="(__builtin_constant_p((AS_MM_ALL_LOCKS)) ? constant_test_bit((AS_MM_ALL_LOCKS), (&amp;mapping-&gt;flags)) : variable_test_bit((AS_MM_ALL_LOCKS), (&amp;mapping-&gt;flags)))" data-ref="_M/test_bit">test_bit</a>(<a class="enum" href="../include/linux/pagemap.h.html#AS_MM_ALL_LOCKS" title='AS_MM_ALL_LOCKS' data-ref="AS_MM_ALL_LOCKS">AS_MM_ALL_LOCKS</a>, &amp;<a class="local col3 ref" href="#503mapping" title='mapping' data-ref="503mapping">mapping</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#address_space::flags" title='address_space::flags' data-ref="address_space::flags">flags</a>)) {</td></tr>
<tr><th id="3404">3404</th><td>		<i>/*</i></td></tr>
<tr><th id="3405">3405</th><td><i>		 * AS_MM_ALL_LOCKS can't change from under us because</i></td></tr>
<tr><th id="3406">3406</th><td><i>		 * we hold the mm_all_locks_mutex.</i></td></tr>
<tr><th id="3407">3407</th><td><i>		 *</i></td></tr>
<tr><th id="3408">3408</th><td><i>		 * Operations on -&gt;flags have to be atomic because</i></td></tr>
<tr><th id="3409">3409</th><td><i>		 * even if AS_MM_ALL_LOCKS is stable thanks to the</i></td></tr>
<tr><th id="3410">3410</th><td><i>		 * mm_all_locks_mutex, there may be other cpus</i></td></tr>
<tr><th id="3411">3411</th><td><i>		 * changing other bitflags in parallel to us.</i></td></tr>
<tr><th id="3412">3412</th><td><i>		 */</i></td></tr>
<tr><th id="3413">3413</th><td>		<b>if</b> (<a class="ref fn" href="../arch/x86/include/asm/bitops.h.html#test_and_set_bit" title='test_and_set_bit' data-ref="test_and_set_bit">test_and_set_bit</a>(<a class="enum" href="../include/linux/pagemap.h.html#AS_MM_ALL_LOCKS" title='AS_MM_ALL_LOCKS' data-ref="AS_MM_ALL_LOCKS">AS_MM_ALL_LOCKS</a>, &amp;<a class="local col3 ref" href="#503mapping" title='mapping' data-ref="503mapping">mapping</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#address_space::flags" title='address_space::flags' data-ref="address_space::flags">flags</a>))</td></tr>
<tr><th id="3414">3414</th><td>			<a class="macro" href="../arch/x86/include/asm/bug.h.html#71" title="do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/mm/mmap.c&quot;), &quot;i&quot; (3414), &quot;i&quot; (0), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); do { ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (143)); }); do { } while (1); } while (0); } while (0)" data-ref="_M/BUG">BUG</a>();</td></tr>
<tr><th id="3415">3415</th><td>		<a class="macro" href="../include/linux/rwsem.h.html#188" title="down_write(&amp;mapping-&gt;i_mmap_rwsem)" data-ref="_M/down_write_nest_lock">down_write_nest_lock</a>(&amp;<a class="local col3 ref" href="#503mapping" title='mapping' data-ref="503mapping">mapping</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#address_space::i_mmap_rwsem" title='address_space::i_mmap_rwsem' data-ref="address_space::i_mmap_rwsem">i_mmap_rwsem</a>, &amp;mm-&gt;mmap_sem);</td></tr>
<tr><th id="3416">3416</th><td>	}</td></tr>
<tr><th id="3417">3417</th><td>}</td></tr>
<tr><th id="3418">3418</th><td></td></tr>
<tr><th id="3419">3419</th><td><i>/*</i></td></tr>
<tr><th id="3420">3420</th><td><i> * This operation locks against the VM for all pte/vma/mm related</i></td></tr>
<tr><th id="3421">3421</th><td><i> * operations that could ever happen on a certain mm. This includes</i></td></tr>
<tr><th id="3422">3422</th><td><i> * vmtruncate, try_to_unmap, and all page faults.</i></td></tr>
<tr><th id="3423">3423</th><td><i> *</i></td></tr>
<tr><th id="3424">3424</th><td><i> * The caller must take the mmap_sem in write mode before calling</i></td></tr>
<tr><th id="3425">3425</th><td><i> * mm_take_all_locks(). The caller isn't allowed to release the</i></td></tr>
<tr><th id="3426">3426</th><td><i> * mmap_sem until mm_drop_all_locks() returns.</i></td></tr>
<tr><th id="3427">3427</th><td><i> *</i></td></tr>
<tr><th id="3428">3428</th><td><i> * mmap_sem in write mode is required in order to block all operations</i></td></tr>
<tr><th id="3429">3429</th><td><i> * that could modify pagetables and free pages without need of</i></td></tr>
<tr><th id="3430">3430</th><td><i> * altering the vma layout. It's also needed in write mode to avoid new</i></td></tr>
<tr><th id="3431">3431</th><td><i> * anon_vmas to be associated with existing vmas.</i></td></tr>
<tr><th id="3432">3432</th><td><i> *</i></td></tr>
<tr><th id="3433">3433</th><td><i> * A single task can't take more than one mm_take_all_locks() in a row</i></td></tr>
<tr><th id="3434">3434</th><td><i> * or it would deadlock.</i></td></tr>
<tr><th id="3435">3435</th><td><i> *</i></td></tr>
<tr><th id="3436">3436</th><td><i> * The LSB in anon_vma-&gt;rb_root.rb_node and the AS_MM_ALL_LOCKS bitflag in</i></td></tr>
<tr><th id="3437">3437</th><td><i> * mapping-&gt;flags avoid to take the same lock twice, if more than one</i></td></tr>
<tr><th id="3438">3438</th><td><i> * vma in this mm is backed by the same anon_vma or address_space.</i></td></tr>
<tr><th id="3439">3439</th><td><i> *</i></td></tr>
<tr><th id="3440">3440</th><td><i> * We take locks in following order, accordingly to comment at beginning</i></td></tr>
<tr><th id="3441">3441</th><td><i> * of mm/rmap.c:</i></td></tr>
<tr><th id="3442">3442</th><td><i> *   - all hugetlbfs_i_mmap_rwsem_key locks (aka mapping-&gt;i_mmap_rwsem for</i></td></tr>
<tr><th id="3443">3443</th><td><i> *     hugetlb mapping);</i></td></tr>
<tr><th id="3444">3444</th><td><i> *   - all i_mmap_rwsem locks;</i></td></tr>
<tr><th id="3445">3445</th><td><i> *   - all anon_vma-&gt;rwseml</i></td></tr>
<tr><th id="3446">3446</th><td><i> *</i></td></tr>
<tr><th id="3447">3447</th><td><i> * We can take all locks within these types randomly because the VM code</i></td></tr>
<tr><th id="3448">3448</th><td><i> * doesn't nest them and we protected from parallel mm_take_all_locks() by</i></td></tr>
<tr><th id="3449">3449</th><td><i> * mm_all_locks_mutex.</i></td></tr>
<tr><th id="3450">3450</th><td><i> *</i></td></tr>
<tr><th id="3451">3451</th><td><i> * mm_take_all_locks() and mm_drop_all_locks are expensive operations</i></td></tr>
<tr><th id="3452">3452</th><td><i> * that may have to take thousand of locks.</i></td></tr>
<tr><th id="3453">3453</th><td><i> *</i></td></tr>
<tr><th id="3454">3454</th><td><i> * mm_take_all_locks() can fail if it's interrupted by signals.</i></td></tr>
<tr><th id="3455">3455</th><td><i> */</i></td></tr>
<tr><th id="3456">3456</th><td><em>int</em> <dfn class="decl def fn" id="mm_take_all_locks" title='mm_take_all_locks' data-ref="mm_take_all_locks">mm_take_all_locks</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col4 decl" id="504mm" title='mm' data-type='struct mm_struct *' data-ref="504mm">mm</dfn>)</td></tr>
<tr><th id="3457">3457</th><td>{</td></tr>
<tr><th id="3458">3458</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col5 decl" id="505vma" title='vma' data-type='struct vm_area_struct *' data-ref="505vma">vma</dfn>;</td></tr>
<tr><th id="3459">3459</th><td>	<b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma_chain" title='anon_vma_chain' data-ref="anon_vma_chain">anon_vma_chain</a> *<dfn class="local col6 decl" id="506avc" title='avc' data-type='struct anon_vma_chain *' data-ref="506avc">avc</dfn>;</td></tr>
<tr><th id="3460">3460</th><td></td></tr>
<tr><th id="3461">3461</th><td>	<a class="macro" href="../include/asm-generic/bug.h.html#59" title="do { if (__builtin_expect(!!(down_read_trylock(&amp;mm-&gt;mmap_sem)), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/mm/mmap.c&quot;), &quot;i&quot; (3461), &quot;i&quot; (0), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); do { ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (145)); }); do { } while (1); } while (0); } while (0); } while (0)" data-ref="_M/BUG_ON">BUG_ON</a>(<a class="ref fn" href="../include/linux/rwsem.h.html#down_read_trylock" title='down_read_trylock' data-ref="down_read_trylock">down_read_trylock</a>(&amp;<a class="local col4 ref" href="#504mm" title='mm' data-ref="504mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>));</td></tr>
<tr><th id="3462">3462</th><td></td></tr>
<tr><th id="3463">3463</th><td>	<a class="ref fn" href="../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#3376" title='mm_all_locks_mutex' data-use='a' data-ref="mm_all_locks_mutex">mm_all_locks_mutex</a>);</td></tr>
<tr><th id="3464">3464</th><td></td></tr>
<tr><th id="3465">3465</th><td>	<b>for</b> (<a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a> = <a class="local col4 ref" href="#504mm" title='mm' data-ref="504mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap" title='mm_struct::mmap' data-ref="mm_struct::mmap">mmap</a>; <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>; <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a> = <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>) {</td></tr>
<tr><th id="3466">3466</th><td>		<b>if</b> (<a class="ref fn" href="../include/linux/sched/signal.h.html#signal_pending" title='signal_pending' data-ref="signal_pending">signal_pending</a>(<a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>))</td></tr>
<tr><th id="3467">3467</th><td>			<b>goto</b> <a class="lbl" href="#507out_unlock" data-ref="507out_unlock">out_unlock</a>;</td></tr>
<tr><th id="3468">3468</th><td>		<b>if</b> (<a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a> &amp;&amp; <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a> &amp;&amp;</td></tr>
<tr><th id="3469">3469</th><td>				<a class="ref fn" href="../include/linux/hugetlb_inline.h.html#is_vm_hugetlb_page" title='is_vm_hugetlb_page' data-ref="is_vm_hugetlb_page">is_vm_hugetlb_page</a>(<a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>))</td></tr>
<tr><th id="3470">3470</th><td>			<a class="tu ref fn" href="#vm_lock_mapping" title='vm_lock_mapping' data-use='c' data-ref="vm_lock_mapping">vm_lock_mapping</a>(<a class="local col4 ref" href="#504mm" title='mm' data-ref="504mm">mm</a>, <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a>);</td></tr>
<tr><th id="3471">3471</th><td>	}</td></tr>
<tr><th id="3472">3472</th><td></td></tr>
<tr><th id="3473">3473</th><td>	<b>for</b> (<a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a> = <a class="local col4 ref" href="#504mm" title='mm' data-ref="504mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap" title='mm_struct::mmap' data-ref="mm_struct::mmap">mmap</a>; <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>; <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a> = <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>) {</td></tr>
<tr><th id="3474">3474</th><td>		<b>if</b> (<a class="ref fn" href="../include/linux/sched/signal.h.html#signal_pending" title='signal_pending' data-ref="signal_pending">signal_pending</a>(<a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>))</td></tr>
<tr><th id="3475">3475</th><td>			<b>goto</b> <a class="lbl" href="#507out_unlock" data-ref="507out_unlock">out_unlock</a>;</td></tr>
<tr><th id="3476">3476</th><td>		<b>if</b> (<a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a> &amp;&amp; <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a> &amp;&amp;</td></tr>
<tr><th id="3477">3477</th><td>				!<a class="ref fn" href="../include/linux/hugetlb_inline.h.html#is_vm_hugetlb_page" title='is_vm_hugetlb_page' data-ref="is_vm_hugetlb_page">is_vm_hugetlb_page</a>(<a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>))</td></tr>
<tr><th id="3478">3478</th><td>			<a class="tu ref fn" href="#vm_lock_mapping" title='vm_lock_mapping' data-use='c' data-ref="vm_lock_mapping">vm_lock_mapping</a>(<a class="local col4 ref" href="#504mm" title='mm' data-ref="504mm">mm</a>, <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a>);</td></tr>
<tr><th id="3479">3479</th><td>	}</td></tr>
<tr><th id="3480">3480</th><td></td></tr>
<tr><th id="3481">3481</th><td>	<b>for</b> (<a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a> = <a class="local col4 ref" href="#504mm" title='mm' data-ref="504mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap" title='mm_struct::mmap' data-ref="mm_struct::mmap">mmap</a>; <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>; <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a> = <a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>) {</td></tr>
<tr><th id="3482">3482</th><td>		<b>if</b> (<a class="ref fn" href="../include/linux/sched/signal.h.html#signal_pending" title='signal_pending' data-ref="signal_pending">signal_pending</a>(<a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>))</td></tr>
<tr><th id="3483">3483</th><td>			<b>goto</b> <a class="lbl" href="#507out_unlock" data-ref="507out_unlock">out_unlock</a>;</td></tr>
<tr><th id="3484">3484</th><td>		<b>if</b> (<a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>)</td></tr>
<tr><th id="3485">3485</th><td>			<a class="macro" href="../include/linux/list.h.html#463" title="for (avc = ({ void *__mptr = (void *)((&amp;vma-&gt;anon_vma_chain)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;vma-&gt;anon_vma_chain)-&gt;next)), typeof(((typeof(*avc) *)0)-&gt;same_vma)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;vma-&gt;anon_vma_chain)-&gt;next)), typeof(void)))); extern void __compiletime_assert_3485(void) ; if (__cond) __compiletime_assert_3485(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*avc) *)(__mptr - __builtin_offsetof(typeof(*avc), same_vma))); }); &amp;avc-&gt;same_vma != (&amp;vma-&gt;anon_vma_chain); avc = ({ void *__mptr = (void *)((avc)-&gt;same_vma.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((avc)-&gt;same_vma.next)), typeof(((typeof(*(avc)) *)0)-&gt;same_vma)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((avc)-&gt;same_vma.next)), typeof(void)))); extern void __compiletime_assert_3485(void) ; if (__cond) __compiletime_assert_3485(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(avc)) *)(__mptr - __builtin_offsetof(typeof(*(avc)), same_vma))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col6 ref" href="#506avc" title='avc' data-ref="506avc">avc</a>, &amp;<a class="local col5 ref" href="#505vma" title='vma' data-ref="505vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma_chain" title='vm_area_struct::anon_vma_chain' data-ref="vm_area_struct::anon_vma_chain">anon_vma_chain</a>, <a class="ref field" href="../include/linux/rmap.h.html#anon_vma_chain::same_vma" title='anon_vma_chain::same_vma' data-ref="anon_vma_chain::same_vma">same_vma</a>)</td></tr>
<tr><th id="3486">3486</th><td>				<a class="tu ref fn" href="#vm_lock_anon_vma" title='vm_lock_anon_vma' data-use='c' data-ref="vm_lock_anon_vma">vm_lock_anon_vma</a>(<a class="local col4 ref" href="#504mm" title='mm' data-ref="504mm">mm</a>, <a class="local col6 ref" href="#506avc" title='avc' data-ref="506avc">avc</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma_chain::anon_vma" title='anon_vma_chain::anon_vma' data-ref="anon_vma_chain::anon_vma">anon_vma</a>);</td></tr>
<tr><th id="3487">3487</th><td>	}</td></tr>
<tr><th id="3488">3488</th><td></td></tr>
<tr><th id="3489">3489</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3490">3490</th><td></td></tr>
<tr><th id="3491">3491</th><td><dfn class="lbl" id="507out_unlock" data-ref="507out_unlock">out_unlock</dfn>:</td></tr>
<tr><th id="3492">3492</th><td>	<a class="ref fn" href="#mm_drop_all_locks" title='mm_drop_all_locks' data-ref="mm_drop_all_locks">mm_drop_all_locks</a>(<a class="local col4 ref" href="#504mm" title='mm' data-ref="504mm">mm</a>);</td></tr>
<tr><th id="3493">3493</th><td>	<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#8" title="4" data-ref="_M/EINTR">EINTR</a>;</td></tr>
<tr><th id="3494">3494</th><td>}</td></tr>
<tr><th id="3495">3495</th><td></td></tr>
<tr><th id="3496">3496</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vm_unlock_anon_vma" title='vm_unlock_anon_vma' data-type='void vm_unlock_anon_vma(struct anon_vma * anon_vma)' data-ref="vm_unlock_anon_vma">vm_unlock_anon_vma</dfn>(<b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma" title='anon_vma' data-ref="anon_vma">anon_vma</a> *<dfn class="local col8 decl" id="508anon_vma" title='anon_vma' data-type='struct anon_vma *' data-ref="508anon_vma">anon_vma</dfn>)</td></tr>
<tr><th id="3497">3497</th><td>{</td></tr>
<tr><th id="3498">3498</th><td>	<b>if</b> (<a class="macro" href="../arch/x86/include/asm/bitops.h.html#349" title="(__builtin_constant_p((0)) ? constant_test_bit((0), ((unsigned long *) &amp;anon_vma-&gt;root-&gt;rb_root.rb_root.rb_node)) : variable_test_bit((0), ((unsigned long *) &amp;anon_vma-&gt;root-&gt;rb_root.rb_root.rb_node)))" data-ref="_M/test_bit">test_bit</a>(<var>0</var>, (<em>unsigned</em> <em>long</em> *) &amp;<a class="local col8 ref" href="#508anon_vma" title='anon_vma' data-ref="508anon_vma">anon_vma</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma::root" title='anon_vma::root' data-ref="anon_vma::root">root</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma::rb_root" title='anon_vma::rb_root' data-ref="anon_vma::rb_root">rb_root</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root_cached::rb_root" title='rb_root_cached::rb_root' data-ref="rb_root_cached::rb_root">rb_root</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root::rb_node" title='rb_root::rb_node' data-ref="rb_root::rb_node">rb_node</a>)) {</td></tr>
<tr><th id="3499">3499</th><td>		<i>/*</i></td></tr>
<tr><th id="3500">3500</th><td><i>		 * The LSB of head.next can't change to 0 from under</i></td></tr>
<tr><th id="3501">3501</th><td><i>		 * us because we hold the mm_all_locks_mutex.</i></td></tr>
<tr><th id="3502">3502</th><td><i>		 *</i></td></tr>
<tr><th id="3503">3503</th><td><i>		 * We must however clear the bitflag before unlocking</i></td></tr>
<tr><th id="3504">3504</th><td><i>		 * the vma so the users using the anon_vma-&gt;rb_root will</i></td></tr>
<tr><th id="3505">3505</th><td><i>		 * never see our bitflag.</i></td></tr>
<tr><th id="3506">3506</th><td><i>		 *</i></td></tr>
<tr><th id="3507">3507</th><td><i>		 * No need of atomic instructions here, head.next</i></td></tr>
<tr><th id="3508">3508</th><td><i>		 * can't change from under us until we release the</i></td></tr>
<tr><th id="3509">3509</th><td><i>		 * anon_vma-&gt;root-&gt;rwsem.</i></td></tr>
<tr><th id="3510">3510</th><td><i>		 */</i></td></tr>
<tr><th id="3511">3511</th><td>		<b>if</b> (!<a class="ref fn" href="../arch/x86/include/asm/bitops.h.html#__test_and_clear_bit" title='__test_and_clear_bit' data-ref="__test_and_clear_bit">__test_and_clear_bit</a>(<var>0</var>, (<em>unsigned</em> <em>long</em> *)</td></tr>
<tr><th id="3512">3512</th><td>					  &amp;<a class="local col8 ref" href="#508anon_vma" title='anon_vma' data-ref="508anon_vma">anon_vma</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma::root" title='anon_vma::root' data-ref="anon_vma::root">root</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma::rb_root" title='anon_vma::rb_root' data-ref="anon_vma::rb_root">rb_root</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root_cached::rb_root" title='rb_root_cached::rb_root' data-ref="rb_root_cached::rb_root">rb_root</a>.<a class="ref field" href="../include/linux/rbtree.h.html#rb_root::rb_node" title='rb_root::rb_node' data-ref="rb_root::rb_node">rb_node</a>))</td></tr>
<tr><th id="3513">3513</th><td>			<a class="macro" href="../arch/x86/include/asm/bug.h.html#71" title="do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/mm/mmap.c&quot;), &quot;i&quot; (3513), &quot;i&quot; (0), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); do { ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (147)); }); do { } while (1); } while (0); } while (0)" data-ref="_M/BUG">BUG</a>();</td></tr>
<tr><th id="3514">3514</th><td>		<a class="ref fn" href="../include/linux/rmap.h.html#anon_vma_unlock_write" title='anon_vma_unlock_write' data-ref="anon_vma_unlock_write">anon_vma_unlock_write</a>(<a class="local col8 ref" href="#508anon_vma" title='anon_vma' data-ref="508anon_vma">anon_vma</a>);</td></tr>
<tr><th id="3515">3515</th><td>	}</td></tr>
<tr><th id="3516">3516</th><td>}</td></tr>
<tr><th id="3517">3517</th><td></td></tr>
<tr><th id="3518">3518</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vm_unlock_mapping" title='vm_unlock_mapping' data-type='void vm_unlock_mapping(struct address_space * mapping)' data-ref="vm_unlock_mapping">vm_unlock_mapping</dfn>(<b>struct</b> <a class="type" href="../include/linux/fs.h.html#address_space" title='address_space' data-ref="address_space">address_space</a> *<dfn class="local col9 decl" id="509mapping" title='mapping' data-type='struct address_space *' data-ref="509mapping">mapping</dfn>)</td></tr>
<tr><th id="3519">3519</th><td>{</td></tr>
<tr><th id="3520">3520</th><td>	<b>if</b> (<a class="macro" href="../arch/x86/include/asm/bitops.h.html#349" title="(__builtin_constant_p((AS_MM_ALL_LOCKS)) ? constant_test_bit((AS_MM_ALL_LOCKS), (&amp;mapping-&gt;flags)) : variable_test_bit((AS_MM_ALL_LOCKS), (&amp;mapping-&gt;flags)))" data-ref="_M/test_bit">test_bit</a>(<a class="enum" href="../include/linux/pagemap.h.html#AS_MM_ALL_LOCKS" title='AS_MM_ALL_LOCKS' data-ref="AS_MM_ALL_LOCKS">AS_MM_ALL_LOCKS</a>, &amp;<a class="local col9 ref" href="#509mapping" title='mapping' data-ref="509mapping">mapping</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#address_space::flags" title='address_space::flags' data-ref="address_space::flags">flags</a>)) {</td></tr>
<tr><th id="3521">3521</th><td>		<i>/*</i></td></tr>
<tr><th id="3522">3522</th><td><i>		 * AS_MM_ALL_LOCKS can't change to 0 from under us</i></td></tr>
<tr><th id="3523">3523</th><td><i>		 * because we hold the mm_all_locks_mutex.</i></td></tr>
<tr><th id="3524">3524</th><td><i>		 */</i></td></tr>
<tr><th id="3525">3525</th><td>		<a class="ref fn" href="../include/linux/fs.h.html#i_mmap_unlock_write" title='i_mmap_unlock_write' data-ref="i_mmap_unlock_write">i_mmap_unlock_write</a>(<a class="local col9 ref" href="#509mapping" title='mapping' data-ref="509mapping">mapping</a>);</td></tr>
<tr><th id="3526">3526</th><td>		<b>if</b> (!<a class="ref fn" href="../arch/x86/include/asm/bitops.h.html#test_and_clear_bit" title='test_and_clear_bit' data-ref="test_and_clear_bit">test_and_clear_bit</a>(<a class="enum" href="../include/linux/pagemap.h.html#AS_MM_ALL_LOCKS" title='AS_MM_ALL_LOCKS' data-ref="AS_MM_ALL_LOCKS">AS_MM_ALL_LOCKS</a>,</td></tr>
<tr><th id="3527">3527</th><td>					&amp;<a class="local col9 ref" href="#509mapping" title='mapping' data-ref="509mapping">mapping</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#address_space::flags" title='address_space::flags' data-ref="address_space::flags">flags</a>))</td></tr>
<tr><th id="3528">3528</th><td>			<a class="macro" href="../arch/x86/include/asm/bug.h.html#71" title="do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/mm/mmap.c&quot;), &quot;i&quot; (3528), &quot;i&quot; (0), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); do { ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (149)); }); do { } while (1); } while (0); } while (0)" data-ref="_M/BUG">BUG</a>();</td></tr>
<tr><th id="3529">3529</th><td>	}</td></tr>
<tr><th id="3530">3530</th><td>}</td></tr>
<tr><th id="3531">3531</th><td></td></tr>
<tr><th id="3532">3532</th><td><i>/*</i></td></tr>
<tr><th id="3533">3533</th><td><i> * The mmap_sem cannot be released by the caller until</i></td></tr>
<tr><th id="3534">3534</th><td><i> * mm_drop_all_locks() returns.</i></td></tr>
<tr><th id="3535">3535</th><td><i> */</i></td></tr>
<tr><th id="3536">3536</th><td><em>void</em> <dfn class="decl def fn" id="mm_drop_all_locks" title='mm_drop_all_locks' data-ref="mm_drop_all_locks">mm_drop_all_locks</dfn>(<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#mm_struct" title='mm_struct' data-ref="mm_struct">mm_struct</a> *<dfn class="local col0 decl" id="510mm" title='mm' data-type='struct mm_struct *' data-ref="510mm">mm</dfn>)</td></tr>
<tr><th id="3537">3537</th><td>{</td></tr>
<tr><th id="3538">3538</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col1 decl" id="511vma" title='vma' data-type='struct vm_area_struct *' data-ref="511vma">vma</dfn>;</td></tr>
<tr><th id="3539">3539</th><td>	<b>struct</b> <a class="type" href="../include/linux/rmap.h.html#anon_vma_chain" title='anon_vma_chain' data-ref="anon_vma_chain">anon_vma_chain</a> *<dfn class="local col2 decl" id="512avc" title='avc' data-type='struct anon_vma_chain *' data-ref="512avc">avc</dfn>;</td></tr>
<tr><th id="3540">3540</th><td></td></tr>
<tr><th id="3541">3541</th><td>	<a class="macro" href="../include/asm-generic/bug.h.html#59" title="do { if (__builtin_expect(!!(down_read_trylock(&amp;mm-&gt;mmap_sem)), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/mm/mmap.c&quot;), &quot;i&quot; (3541), &quot;i&quot; (0), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); do { ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (151)); }); do { } while (1); } while (0); } while (0); } while (0)" data-ref="_M/BUG_ON">BUG_ON</a>(<a class="ref fn" href="../include/linux/rwsem.h.html#down_read_trylock" title='down_read_trylock' data-ref="down_read_trylock">down_read_trylock</a>(&amp;<a class="local col0 ref" href="#510mm" title='mm' data-ref="510mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap_sem" title='mm_struct::mmap_sem' data-ref="mm_struct::mmap_sem">mmap_sem</a>));</td></tr>
<tr><th id="3542">3542</th><td>	<a class="macro" href="../include/asm-generic/bug.h.html#59" title="do { if (__builtin_expect(!!(!mutex_is_locked(&amp;mm_all_locks_mutex)), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/mm/mmap.c&quot;), &quot;i&quot; (3542), &quot;i&quot; (0), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); do { ({ asm(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (153)); }); do { } while (1); } while (0); } while (0); } while (0)" data-ref="_M/BUG_ON">BUG_ON</a>(!<a class="ref fn" href="../include/linux/mutex.h.html#mutex_is_locked" title='mutex_is_locked' data-ref="mutex_is_locked">mutex_is_locked</a>(&amp;<a class="tu ref" href="#3376" title='mm_all_locks_mutex' data-use='a' data-ref="mm_all_locks_mutex">mm_all_locks_mutex</a>));</td></tr>
<tr><th id="3543">3543</th><td></td></tr>
<tr><th id="3544">3544</th><td>	<b>for</b> (<a class="local col1 ref" href="#511vma" title='vma' data-ref="511vma">vma</a> = <a class="local col0 ref" href="#510mm" title='mm' data-ref="510mm">mm</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#mm_struct::mmap" title='mm_struct::mmap' data-ref="mm_struct::mmap">mmap</a>; <a class="local col1 ref" href="#511vma" title='vma' data-ref="511vma">vma</a>; <a class="local col1 ref" href="#511vma" title='vma' data-ref="511vma">vma</a> = <a class="local col1 ref" href="#511vma" title='vma' data-ref="511vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_next" title='vm_area_struct::vm_next' data-ref="vm_area_struct::vm_next">vm_next</a>) {</td></tr>
<tr><th id="3545">3545</th><td>		<b>if</b> (<a class="local col1 ref" href="#511vma" title='vma' data-ref="511vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma" title='vm_area_struct::anon_vma' data-ref="vm_area_struct::anon_vma">anon_vma</a>)</td></tr>
<tr><th id="3546">3546</th><td>			<a class="macro" href="../include/linux/list.h.html#463" title="for (avc = ({ void *__mptr = (void *)((&amp;vma-&gt;anon_vma_chain)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;vma-&gt;anon_vma_chain)-&gt;next)), typeof(((typeof(*avc) *)0)-&gt;same_vma)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;vma-&gt;anon_vma_chain)-&gt;next)), typeof(void)))); extern void __compiletime_assert_3546(void) ; if (__cond) __compiletime_assert_3546(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*avc) *)(__mptr - __builtin_offsetof(typeof(*avc), same_vma))); }); &amp;avc-&gt;same_vma != (&amp;vma-&gt;anon_vma_chain); avc = ({ void *__mptr = (void *)((avc)-&gt;same_vma.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((avc)-&gt;same_vma.next)), typeof(((typeof(*(avc)) *)0)-&gt;same_vma)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((avc)-&gt;same_vma.next)), typeof(void)))); extern void __compiletime_assert_3546(void) ; if (__cond) __compiletime_assert_3546(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(avc)) *)(__mptr - __builtin_offsetof(typeof(*(avc)), same_vma))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col2 ref" href="#512avc" title='avc' data-ref="512avc">avc</a>, &amp;<a class="local col1 ref" href="#511vma" title='vma' data-ref="511vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::anon_vma_chain" title='vm_area_struct::anon_vma_chain' data-ref="vm_area_struct::anon_vma_chain">anon_vma_chain</a>, <a class="ref field" href="../include/linux/rmap.h.html#anon_vma_chain::same_vma" title='anon_vma_chain::same_vma' data-ref="anon_vma_chain::same_vma">same_vma</a>)</td></tr>
<tr><th id="3547">3547</th><td>				<a class="tu ref fn" href="#vm_unlock_anon_vma" title='vm_unlock_anon_vma' data-use='c' data-ref="vm_unlock_anon_vma">vm_unlock_anon_vma</a>(<a class="local col2 ref" href="#512avc" title='avc' data-ref="512avc">avc</a>-&gt;<a class="ref field" href="../include/linux/rmap.h.html#anon_vma_chain::anon_vma" title='anon_vma_chain::anon_vma' data-ref="anon_vma_chain::anon_vma">anon_vma</a>);</td></tr>
<tr><th id="3548">3548</th><td>		<b>if</b> (<a class="local col1 ref" href="#511vma" title='vma' data-ref="511vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a> &amp;&amp; <a class="local col1 ref" href="#511vma" title='vma' data-ref="511vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a>)</td></tr>
<tr><th id="3549">3549</th><td>			<a class="tu ref fn" href="#vm_unlock_mapping" title='vm_unlock_mapping' data-use='c' data-ref="vm_unlock_mapping">vm_unlock_mapping</a>(<a class="local col1 ref" href="#511vma" title='vma' data-ref="511vma">vma</a>-&gt;<a class="ref field" href="../include/linux/mm_types.h.html#vm_area_struct::vm_file" title='vm_area_struct::vm_file' data-ref="vm_area_struct::vm_file">vm_file</a>-&gt;<a class="ref field" href="../include/linux/fs.h.html#file::f_mapping" title='file::f_mapping' data-ref="file::f_mapping">f_mapping</a>);</td></tr>
<tr><th id="3550">3550</th><td>	}</td></tr>
<tr><th id="3551">3551</th><td></td></tr>
<tr><th id="3552">3552</th><td>	<a class="ref fn" href="../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#3376" title='mm_all_locks_mutex' data-use='a' data-ref="mm_all_locks_mutex">mm_all_locks_mutex</a>);</td></tr>
<tr><th id="3553">3553</th><td>}</td></tr>
<tr><th id="3554">3554</th><td></td></tr>
<tr><th id="3555">3555</th><td><i>/*</i></td></tr>
<tr><th id="3556">3556</th><td><i> * initialise the percpu counter for VM</i></td></tr>
<tr><th id="3557">3557</th><td><i> */</i></td></tr>
<tr><th id="3558">3558</th><td><em>void</em> <a class="macro" href="../include/linux/init.h.html#50" title="__attribute__ ((__section__(&quot;.init.text&quot;)))" data-ref="_M/__init">__init</a> <dfn class="decl def fn" id="mmap_init" title='mmap_init' data-ref="mmap_init">mmap_init</dfn>(<em>void</em>)</td></tr>
<tr><th id="3559">3559</th><td>{</td></tr>
<tr><th id="3560">3560</th><td>	<em>int</em> <dfn class="local col3 decl" id="513ret" title='ret' data-type='int' data-ref="513ret">ret</dfn>;</td></tr>
<tr><th id="3561">3561</th><td></td></tr>
<tr><th id="3562">3562</th><td>	<a class="local col3 ref" href="#513ret" title='ret' data-ref="513ret">ret</a> = <a class="macro" href="../include/linux/percpu_counter.h.html#34" title="({ static struct lock_class_key __key; __percpu_counter_init(&amp;vm_committed_as, 0, ((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u)), &amp;__key); })" data-ref="_M/percpu_counter_init">percpu_counter_init</a>(&amp;<a class="ref" href="../include/linux/mman.h.html#vm_committed_as" title='vm_committed_as' data-ref="vm_committed_as">vm_committed_as</a>, <var>0</var>, <a class="macro" href="../include/linux/gfp.h.html#278" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="3563">3563</th><td>	<a class="macro" href="../include/linux/mmdebug.h.html#45" title="((void)(sizeof(( long)(ret))))" data-ref="_M/VM_BUG_ON">VM_BUG_ON</a>(<a class="local col3 ref" href="#513ret" title='ret' data-ref="513ret">ret</a>);</td></tr>
<tr><th id="3564">3564</th><td>}</td></tr>
<tr><th id="3565">3565</th><td></td></tr>
<tr><th id="3566">3566</th><td><i  data-doc="init_user_reserve">/*</i></td></tr>
<tr><th id="3567">3567</th><td><i  data-doc="init_user_reserve"> * Initialise sysctl_user_reserve_kbytes.</i></td></tr>
<tr><th id="3568">3568</th><td><i  data-doc="init_user_reserve"> *</i></td></tr>
<tr><th id="3569">3569</th><td><i  data-doc="init_user_reserve"> * This is intended to prevent a user from starting a single memory hogging</i></td></tr>
<tr><th id="3570">3570</th><td><i  data-doc="init_user_reserve"> * process, such that they cannot recover (kill the hog) in OVERCOMMIT_NEVER</i></td></tr>
<tr><th id="3571">3571</th><td><i  data-doc="init_user_reserve"> * mode.</i></td></tr>
<tr><th id="3572">3572</th><td><i  data-doc="init_user_reserve"> *</i></td></tr>
<tr><th id="3573">3573</th><td><i  data-doc="init_user_reserve"> * The default value is min(3% of free memory, 128MB)</i></td></tr>
<tr><th id="3574">3574</th><td><i  data-doc="init_user_reserve"> * 128MB is enough to recover with sshd/login, bash, and top/kill.</i></td></tr>
<tr><th id="3575">3575</th><td><i  data-doc="init_user_reserve"> */</i></td></tr>
<tr><th id="3576">3576</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="init_user_reserve" title='init_user_reserve' data-type='int init_user_reserve()' data-ref="init_user_reserve">init_user_reserve</dfn>(<em>void</em>)</td></tr>
<tr><th id="3577">3577</th><td>{</td></tr>
<tr><th id="3578">3578</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col4 decl" id="514free_kbytes" title='free_kbytes' data-type='unsigned long' data-ref="514free_kbytes">free_kbytes</dfn>;</td></tr>
<tr><th id="3579">3579</th><td></td></tr>
<tr><th id="3580">3580</th><td>	<a class="local col4 ref" href="#514free_kbytes" title='free_kbytes' data-ref="514free_kbytes">free_kbytes</a> = <a class="ref fn" href="../include/linux/vmstat.h.html#global_zone_page_state" title='global_zone_page_state' data-ref="global_zone_page_state">global_zone_page_state</a>(<a class="enum" href="../include/linux/mmzone.h.html#NR_FREE_PAGES" title='NR_FREE_PAGES' data-ref="NR_FREE_PAGES">NR_FREE_PAGES</a>) &lt;&lt; (<a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a> - <var>10</var>);</td></tr>
<tr><th id="3581">3581</th><td></td></tr>
<tr><th id="3582">3582</th><td>	<a class="ref" href="../include/linux/mm.h.html#sysctl_user_reserve_kbytes" title='sysctl_user_reserve_kbytes' data-ref="sysctl_user_reserve_kbytes">sysctl_user_reserve_kbytes</a> = <a class="macro" href="../include/linux/kernel.h.html#799" title="({ typeof(free_kbytes / 32) __UNIQUE_ID_min1_155 = (free_kbytes / 32); typeof(1UL &lt;&lt; 17) __UNIQUE_ID_min2_156 = (1UL &lt;&lt; 17); (void) (&amp;__UNIQUE_ID_min1_155 == &amp;__UNIQUE_ID_min2_156); __UNIQUE_ID_min1_155 &lt; __UNIQUE_ID_min2_156 ? __UNIQUE_ID_min1_155 : __UNIQUE_ID_min2_156; })" data-ref="_M/min">min</a>(<a class="local col4 ref" href="#514free_kbytes" title='free_kbytes' data-ref="514free_kbytes">free_kbytes</a> / <var>32</var>, <var>1UL</var> &lt;&lt; <var>17</var>);</td></tr>
<tr><th id="3583">3583</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3584">3584</th><td>}</td></tr>
<tr><th id="3585">3585</th><td><a class="macro" href="../include/linux/init.h.html#198" title="static initcall_t __initcall_init_user_reserve4 __attribute__((__used__)) __attribute__((__section__(&quot;.initcall&quot; &quot;4&quot; &quot;.init&quot;))) = init_user_reserve;" data-ref="_M/subsys_initcall">subsys_initcall</a>(<a class="tu ref fn" href="#init_user_reserve" title='init_user_reserve' data-ref="init_user_reserve">init_user_reserve</a>);</td></tr>
<tr><th id="3586">3586</th><td></td></tr>
<tr><th id="3587">3587</th><td><i  data-doc="init_admin_reserve">/*</i></td></tr>
<tr><th id="3588">3588</th><td><i  data-doc="init_admin_reserve"> * Initialise sysctl_admin_reserve_kbytes.</i></td></tr>
<tr><th id="3589">3589</th><td><i  data-doc="init_admin_reserve"> *</i></td></tr>
<tr><th id="3590">3590</th><td><i  data-doc="init_admin_reserve"> * The purpose of sysctl_admin_reserve_kbytes is to allow the sys admin</i></td></tr>
<tr><th id="3591">3591</th><td><i  data-doc="init_admin_reserve"> * to log in and kill a memory hogging process.</i></td></tr>
<tr><th id="3592">3592</th><td><i  data-doc="init_admin_reserve"> *</i></td></tr>
<tr><th id="3593">3593</th><td><i  data-doc="init_admin_reserve"> * Systems with more than 256MB will reserve 8MB, enough to recover</i></td></tr>
<tr><th id="3594">3594</th><td><i  data-doc="init_admin_reserve"> * with sshd, bash, and top in OVERCOMMIT_GUESS. Smaller systems will</i></td></tr>
<tr><th id="3595">3595</th><td><i  data-doc="init_admin_reserve"> * only reserve 3% of free pages by default.</i></td></tr>
<tr><th id="3596">3596</th><td><i  data-doc="init_admin_reserve"> */</i></td></tr>
<tr><th id="3597">3597</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="init_admin_reserve" title='init_admin_reserve' data-type='int init_admin_reserve()' data-ref="init_admin_reserve">init_admin_reserve</dfn>(<em>void</em>)</td></tr>
<tr><th id="3598">3598</th><td>{</td></tr>
<tr><th id="3599">3599</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col5 decl" id="515free_kbytes" title='free_kbytes' data-type='unsigned long' data-ref="515free_kbytes">free_kbytes</dfn>;</td></tr>
<tr><th id="3600">3600</th><td></td></tr>
<tr><th id="3601">3601</th><td>	<a class="local col5 ref" href="#515free_kbytes" title='free_kbytes' data-ref="515free_kbytes">free_kbytes</a> = <a class="ref fn" href="../include/linux/vmstat.h.html#global_zone_page_state" title='global_zone_page_state' data-ref="global_zone_page_state">global_zone_page_state</a>(<a class="enum" href="../include/linux/mmzone.h.html#NR_FREE_PAGES" title='NR_FREE_PAGES' data-ref="NR_FREE_PAGES">NR_FREE_PAGES</a>) &lt;&lt; (<a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a> - <var>10</var>);</td></tr>
<tr><th id="3602">3602</th><td></td></tr>
<tr><th id="3603">3603</th><td>	<a class="ref" href="../include/linux/mm.h.html#sysctl_admin_reserve_kbytes" title='sysctl_admin_reserve_kbytes' data-ref="sysctl_admin_reserve_kbytes">sysctl_admin_reserve_kbytes</a> = <a class="macro" href="../include/linux/kernel.h.html#799" title="({ typeof(free_kbytes / 32) __UNIQUE_ID_min1_159 = (free_kbytes / 32); typeof(1UL &lt;&lt; 13) __UNIQUE_ID_min2_160 = (1UL &lt;&lt; 13); (void) (&amp;__UNIQUE_ID_min1_159 == &amp;__UNIQUE_ID_min2_160); __UNIQUE_ID_min1_159 &lt; __UNIQUE_ID_min2_160 ? __UNIQUE_ID_min1_159 : __UNIQUE_ID_min2_160; })" data-ref="_M/min">min</a>(<a class="local col5 ref" href="#515free_kbytes" title='free_kbytes' data-ref="515free_kbytes">free_kbytes</a> / <var>32</var>, <var>1UL</var> &lt;&lt; <var>13</var>);</td></tr>
<tr><th id="3604">3604</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3605">3605</th><td>}</td></tr>
<tr><th id="3606">3606</th><td><a class="macro" href="../include/linux/init.h.html#198" title="static initcall_t __initcall_init_admin_reserve4 __attribute__((__used__)) __attribute__((__section__(&quot;.initcall&quot; &quot;4&quot; &quot;.init&quot;))) = init_admin_reserve;" data-ref="_M/subsys_initcall">subsys_initcall</a>(<a class="tu ref fn" href="#init_admin_reserve" title='init_admin_reserve' data-ref="init_admin_reserve">init_admin_reserve</a>);</td></tr>
<tr><th id="3607">3607</th><td></td></tr>
<tr><th id="3608">3608</th><td><i  data-doc="reserve_mem_notifier">/*</i></td></tr>
<tr><th id="3609">3609</th><td><i  data-doc="reserve_mem_notifier"> * Reinititalise user and admin reserves if memory is added or removed.</i></td></tr>
<tr><th id="3610">3610</th><td><i  data-doc="reserve_mem_notifier"> *</i></td></tr>
<tr><th id="3611">3611</th><td><i  data-doc="reserve_mem_notifier"> * The default user reserve max is 128MB, and the default max for the</i></td></tr>
<tr><th id="3612">3612</th><td><i  data-doc="reserve_mem_notifier"> * admin reserve is 8MB. These are usually, but not always, enough to</i></td></tr>
<tr><th id="3613">3613</th><td><i  data-doc="reserve_mem_notifier"> * enable recovery from a memory hogging process using login/sshd, a shell,</i></td></tr>
<tr><th id="3614">3614</th><td><i  data-doc="reserve_mem_notifier"> * and tools like top. It may make sense to increase or even disable the</i></td></tr>
<tr><th id="3615">3615</th><td><i  data-doc="reserve_mem_notifier"> * reserve depending on the existence of swap or variations in the recovery</i></td></tr>
<tr><th id="3616">3616</th><td><i  data-doc="reserve_mem_notifier"> * tools. So, the admin may have changed them.</i></td></tr>
<tr><th id="3617">3617</th><td><i  data-doc="reserve_mem_notifier"> *</i></td></tr>
<tr><th id="3618">3618</th><td><i  data-doc="reserve_mem_notifier"> * If memory is added and the reserves have been eliminated or increased above</i></td></tr>
<tr><th id="3619">3619</th><td><i  data-doc="reserve_mem_notifier"> * the default max, then we'll trust the admin.</i></td></tr>
<tr><th id="3620">3620</th><td><i  data-doc="reserve_mem_notifier"> *</i></td></tr>
<tr><th id="3621">3621</th><td><i  data-doc="reserve_mem_notifier"> * If memory is removed and there isn't enough free memory, then we</i></td></tr>
<tr><th id="3622">3622</th><td><i  data-doc="reserve_mem_notifier"> * need to reset the reserves.</i></td></tr>
<tr><th id="3623">3623</th><td><i  data-doc="reserve_mem_notifier"> *</i></td></tr>
<tr><th id="3624">3624</th><td><i  data-doc="reserve_mem_notifier"> * Otherwise keep the reserve set by the admin.</i></td></tr>
<tr><th id="3625">3625</th><td><i  data-doc="reserve_mem_notifier"> */</i></td></tr>
<tr><th id="3626">3626</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="reserve_mem_notifier" title='reserve_mem_notifier' data-type='int reserve_mem_notifier(struct notifier_block * nb, unsigned long action, void * data)' data-ref="reserve_mem_notifier">reserve_mem_notifier</dfn>(<b>struct</b> <a class="type" href="../include/linux/notifier.h.html#notifier_block" title='notifier_block' data-ref="notifier_block">notifier_block</a> *<dfn class="local col6 decl" id="516nb" title='nb' data-type='struct notifier_block *' data-ref="516nb">nb</dfn>,</td></tr>
<tr><th id="3627">3627</th><td>			     <em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="517action" title='action' data-type='unsigned long' data-ref="517action">action</dfn>, <em>void</em> *<dfn class="local col8 decl" id="518data" title='data' data-type='void *' data-ref="518data">data</dfn>)</td></tr>
<tr><th id="3628">3628</th><td>{</td></tr>
<tr><th id="3629">3629</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="519tmp" title='tmp' data-type='unsigned long' data-ref="519tmp">tmp</dfn>, <dfn class="local col0 decl" id="520free_kbytes" title='free_kbytes' data-type='unsigned long' data-ref="520free_kbytes">free_kbytes</dfn>;</td></tr>
<tr><th id="3630">3630</th><td></td></tr>
<tr><th id="3631">3631</th><td>	<b>switch</b> (<a class="local col7 ref" href="#517action" title='action' data-ref="517action">action</a>) {</td></tr>
<tr><th id="3632">3632</th><td>	<b>case</b> <a class="macro" href="../include/linux/memory.h.html#42" title="(1&lt;&lt;0)" data-ref="_M/MEM_ONLINE">MEM_ONLINE</a>:</td></tr>
<tr><th id="3633">3633</th><td>		<i>/* Default max is 128MB. Leave alone if modified by operator. */</i></td></tr>
<tr><th id="3634">3634</th><td>		<a class="local col9 ref" href="#519tmp" title='tmp' data-ref="519tmp">tmp</a> = <a class="ref" href="../include/linux/mm.h.html#sysctl_user_reserve_kbytes" title='sysctl_user_reserve_kbytes' data-ref="sysctl_user_reserve_kbytes">sysctl_user_reserve_kbytes</a>;</td></tr>
<tr><th id="3635">3635</th><td>		<b>if</b> (<var>0</var> &lt; <a class="local col9 ref" href="#519tmp" title='tmp' data-ref="519tmp">tmp</a> &amp;&amp; <a class="local col9 ref" href="#519tmp" title='tmp' data-ref="519tmp">tmp</a> &lt; (<var>1UL</var> &lt;&lt; <var>17</var>))</td></tr>
<tr><th id="3636">3636</th><td>			<a class="tu ref fn" href="#init_user_reserve" title='init_user_reserve' data-use='c' data-ref="init_user_reserve">init_user_reserve</a>();</td></tr>
<tr><th id="3637">3637</th><td></td></tr>
<tr><th id="3638">3638</th><td>		<i>/* Default max is 8MB.  Leave alone if modified by operator. */</i></td></tr>
<tr><th id="3639">3639</th><td>		<a class="local col9 ref" href="#519tmp" title='tmp' data-ref="519tmp">tmp</a> = <a class="ref" href="../include/linux/mm.h.html#sysctl_admin_reserve_kbytes" title='sysctl_admin_reserve_kbytes' data-ref="sysctl_admin_reserve_kbytes">sysctl_admin_reserve_kbytes</a>;</td></tr>
<tr><th id="3640">3640</th><td>		<b>if</b> (<var>0</var> &lt; <a class="local col9 ref" href="#519tmp" title='tmp' data-ref="519tmp">tmp</a> &amp;&amp; <a class="local col9 ref" href="#519tmp" title='tmp' data-ref="519tmp">tmp</a> &lt; (<var>1UL</var> &lt;&lt; <var>13</var>))</td></tr>
<tr><th id="3641">3641</th><td>			<a class="tu ref fn" href="#init_admin_reserve" title='init_admin_reserve' data-use='c' data-ref="init_admin_reserve">init_admin_reserve</a>();</td></tr>
<tr><th id="3642">3642</th><td></td></tr>
<tr><th id="3643">3643</th><td>		<b>break</b>;</td></tr>
<tr><th id="3644">3644</th><td>	<b>case</b> <a class="macro" href="../include/linux/memory.h.html#44" title="(1&lt;&lt;2)" data-ref="_M/MEM_OFFLINE">MEM_OFFLINE</a>:</td></tr>
<tr><th id="3645">3645</th><td>		<a class="local col0 ref" href="#520free_kbytes" title='free_kbytes' data-ref="520free_kbytes">free_kbytes</a> = <a class="ref fn" href="../include/linux/vmstat.h.html#global_zone_page_state" title='global_zone_page_state' data-ref="global_zone_page_state">global_zone_page_state</a>(<a class="enum" href="../include/linux/mmzone.h.html#NR_FREE_PAGES" title='NR_FREE_PAGES' data-ref="NR_FREE_PAGES">NR_FREE_PAGES</a>) &lt;&lt; (<a class="macro" href="../arch/x86/include/asm/page_types.h.html#10" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a> - <var>10</var>);</td></tr>
<tr><th id="3646">3646</th><td></td></tr>
<tr><th id="3647">3647</th><td>		<b>if</b> (<a class="ref" href="../include/linux/mm.h.html#sysctl_user_reserve_kbytes" title='sysctl_user_reserve_kbytes' data-ref="sysctl_user_reserve_kbytes">sysctl_user_reserve_kbytes</a> &gt; <a class="local col0 ref" href="#520free_kbytes" title='free_kbytes' data-ref="520free_kbytes">free_kbytes</a>) {</td></tr>
<tr><th id="3648">3648</th><td>			<a class="tu ref fn" href="#init_user_reserve" title='init_user_reserve' data-use='c' data-ref="init_user_reserve">init_user_reserve</a>();</td></tr>
<tr><th id="3649">3649</th><td>			<a class="macro" href="../include/linux/printk.h.html#308" title="printk(&quot;\001&quot; &quot;6&quot; &quot;mmap&quot; &quot;: &quot; &quot;vm.user_reserve_kbytes reset to %lu\n&quot;, sysctl_user_reserve_kbytes)" data-ref="_M/pr_info">pr_info</a>(<q>"vm.user_reserve_kbytes reset to %lu\n"</q>,</td></tr>
<tr><th id="3650">3650</th><td>				<a class="ref" href="../include/linux/mm.h.html#sysctl_user_reserve_kbytes" title='sysctl_user_reserve_kbytes' data-ref="sysctl_user_reserve_kbytes">sysctl_user_reserve_kbytes</a>);</td></tr>
<tr><th id="3651">3651</th><td>		}</td></tr>
<tr><th id="3652">3652</th><td></td></tr>
<tr><th id="3653">3653</th><td>		<b>if</b> (<a class="ref" href="../include/linux/mm.h.html#sysctl_admin_reserve_kbytes" title='sysctl_admin_reserve_kbytes' data-ref="sysctl_admin_reserve_kbytes">sysctl_admin_reserve_kbytes</a> &gt; <a class="local col0 ref" href="#520free_kbytes" title='free_kbytes' data-ref="520free_kbytes">free_kbytes</a>) {</td></tr>
<tr><th id="3654">3654</th><td>			<a class="tu ref fn" href="#init_admin_reserve" title='init_admin_reserve' data-use='c' data-ref="init_admin_reserve">init_admin_reserve</a>();</td></tr>
<tr><th id="3655">3655</th><td>			<a class="macro" href="../include/linux/printk.h.html#308" title="printk(&quot;\001&quot; &quot;6&quot; &quot;mmap&quot; &quot;: &quot; &quot;vm.admin_reserve_kbytes reset to %lu\n&quot;, sysctl_admin_reserve_kbytes)" data-ref="_M/pr_info">pr_info</a>(<q>"vm.admin_reserve_kbytes reset to %lu\n"</q>,</td></tr>
<tr><th id="3656">3656</th><td>				<a class="ref" href="../include/linux/mm.h.html#sysctl_admin_reserve_kbytes" title='sysctl_admin_reserve_kbytes' data-ref="sysctl_admin_reserve_kbytes">sysctl_admin_reserve_kbytes</a>);</td></tr>
<tr><th id="3657">3657</th><td>		}</td></tr>
<tr><th id="3658">3658</th><td>		<b>break</b>;</td></tr>
<tr><th id="3659">3659</th><td>	<b>default</b>:</td></tr>
<tr><th id="3660">3660</th><td>		<b>break</b>;</td></tr>
<tr><th id="3661">3661</th><td>	}</td></tr>
<tr><th id="3662">3662</th><td>	<b>return</b> <a class="macro" href="../include/linux/notifier.h.html#161" title="0x0001" data-ref="_M/NOTIFY_OK">NOTIFY_OK</a>;</td></tr>
<tr><th id="3663">3663</th><td>}</td></tr>
<tr><th id="3664">3664</th><td></td></tr>
<tr><th id="3665">3665</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/notifier.h.html#notifier_block" title='notifier_block' data-ref="notifier_block">notifier_block</a> <dfn class="tu decl def" id="reserve_mem_nb" title='reserve_mem_nb' data-type='struct notifier_block' data-ref="reserve_mem_nb">reserve_mem_nb</dfn> = {</td></tr>
<tr><th id="3666">3666</th><td>	.<a class="ref field" href="../include/linux/notifier.h.html#notifier_block::notifier_call" title='notifier_block::notifier_call' data-ref="notifier_block::notifier_call">notifier_call</a> = <a class="tu ref fn" href="#reserve_mem_notifier" title='reserve_mem_notifier' data-ref="reserve_mem_notifier">reserve_mem_notifier</a>,</td></tr>
<tr><th id="3667">3667</th><td>};</td></tr>
<tr><th id="3668">3668</th><td></td></tr>
<tr><th id="3669">3669</th><td><em>static</em> <em>int</em> <a class="macro" href="../include/linux/init.h.html#88" title="__attribute__ ((__section__(&quot;.meminit.text&quot;))) __attribute__((no_instrument_function))" data-ref="_M/__meminit">__meminit</a> <dfn class="tu decl def fn" id="init_reserve_notifier" title='init_reserve_notifier' data-type='int init_reserve_notifier()' data-ref="init_reserve_notifier">init_reserve_notifier</dfn>(<em>void</em>)</td></tr>
<tr><th id="3670">3670</th><td>{</td></tr>
<tr><th id="3671">3671</th><td>	<b>if</b> (<a class="macro" href="../include/linux/memory.h.html#136" title="({ (void)(&amp;reserve_mem_nb); 0; })" data-ref="_M/register_hotmemory_notifier">register_hotmemory_notifier</a>(&amp;<a class="tu ref" href="#reserve_mem_nb" title='reserve_mem_nb' data-use='a' data-ref="reserve_mem_nb">reserve_mem_nb</a>))</td></tr>
<tr><th id="3672">3672</th><td>		<a class="macro" href="../include/linux/printk.h.html#301" title="printk(&quot;\001&quot; &quot;3&quot; &quot;mmap&quot; &quot;: &quot; &quot;Failed registering memory add/remove notifier for admin reserve\n&quot;)" data-ref="_M/pr_err">pr_err</a>(<q>"Failed registering memory add/remove notifier for admin reserve\n"</q>);</td></tr>
<tr><th id="3673">3673</th><td></td></tr>
<tr><th id="3674">3674</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3675">3675</th><td>}</td></tr>
<tr><th id="3676">3676</th><td><a class="macro" href="../include/linux/init.h.html#198" title="static initcall_t __initcall_init_reserve_notifier4 __attribute__((__used__)) __attribute__((__section__(&quot;.initcall&quot; &quot;4&quot; &quot;.init&quot;))) = init_reserve_notifier;" data-ref="_M/subsys_initcall">subsys_initcall</a>(<a class="tu ref fn" href="#init_reserve_notifier" title='init_reserve_notifier' data-ref="init_reserve_notifier">init_reserve_notifier</a>);</td></tr>
<tr><th id="3677">3677</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2018-Aug-13</em> from project linux-4.14.y revision <em>linux-4.14.y</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
