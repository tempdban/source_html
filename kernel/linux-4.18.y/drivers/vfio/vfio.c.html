<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>vfio.c source code [linux-4.18.y/drivers/vfio/vfio.c] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="vfio,vfio_container,vfio_device,vfio_group,vfio_group_put_work,vfio_iommu_driver,vfio_unbound_dev "/>
<link rel="stylesheet" href="../../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'linux-4.18.y/drivers/vfio/vfio.c'; var root_path = '../../..'; var data_path = '../../../../data';</script>
<script src='../../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../..'>linux-4.18.y</a>/<a href='..'>drivers</a>/<a href='./'>vfio</a>/<a href='vfio.c.html'>vfio.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> * VFIO core</i></td></tr>
<tr><th id="3">3</th><td><i> *</i></td></tr>
<tr><th id="4">4</th><td><i> * Copyright (C) 2012 Red Hat, Inc.  All rights reserved.</i></td></tr>
<tr><th id="5">5</th><td><i> *     Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;</i></td></tr>
<tr><th id="6">6</th><td><i> *</i></td></tr>
<tr><th id="7">7</th><td><i> * This program is free software; you can redistribute it and/or modify</i></td></tr>
<tr><th id="8">8</th><td><i> * it under the terms of the GNU General Public License version 2 as</i></td></tr>
<tr><th id="9">9</th><td><i> * published by the Free Software Foundation.</i></td></tr>
<tr><th id="10">10</th><td><i> *</i></td></tr>
<tr><th id="11">11</th><td><i> * Derived from original vfio:</i></td></tr>
<tr><th id="12">12</th><td><i> * Copyright 2010 Cisco Systems, Inc.  All rights reserved.</i></td></tr>
<tr><th id="13">13</th><td><i> * Author: Tom Lyon, pugs@cisco.com</i></td></tr>
<tr><th id="14">14</th><td><i> */</i></td></tr>
<tr><th id="15">15</th><td></td></tr>
<tr><th id="16">16</th><td><u>#include <a href="../../include/linux/cdev.h.html">&lt;linux/cdev.h&gt;</a></u></td></tr>
<tr><th id="17">17</th><td><u>#include <a href="../../include/linux/compat.h.html">&lt;linux/compat.h&gt;</a></u></td></tr>
<tr><th id="18">18</th><td><u>#include <a href="../../include/linux/device.h.html">&lt;linux/device.h&gt;</a></u></td></tr>
<tr><th id="19">19</th><td><u>#include <a href="../../include/linux/file.h.html">&lt;linux/file.h&gt;</a></u></td></tr>
<tr><th id="20">20</th><td><u>#include <a href="../../include/linux/anon_inodes.h.html">&lt;linux/anon_inodes.h&gt;</a></u></td></tr>
<tr><th id="21">21</th><td><u>#include <a href="../../include/linux/fs.h.html">&lt;linux/fs.h&gt;</a></u></td></tr>
<tr><th id="22">22</th><td><u>#include <a href="../../include/linux/idr.h.html">&lt;linux/idr.h&gt;</a></u></td></tr>
<tr><th id="23">23</th><td><u>#include <a href="../../include/linux/iommu.h.html">&lt;linux/iommu.h&gt;</a></u></td></tr>
<tr><th id="24">24</th><td><u>#include <a href="../../include/linux/list.h.html">&lt;linux/list.h&gt;</a></u></td></tr>
<tr><th id="25">25</th><td><u>#include <a href="../../include/linux/miscdevice.h.html">&lt;linux/miscdevice.h&gt;</a></u></td></tr>
<tr><th id="26">26</th><td><u>#include <a href="../../include/linux/module.h.html">&lt;linux/module.h&gt;</a></u></td></tr>
<tr><th id="27">27</th><td><u>#include <a href="../../include/linux/mutex.h.html">&lt;linux/mutex.h&gt;</a></u></td></tr>
<tr><th id="28">28</th><td><u>#include <a href="../../include/linux/pci.h.html">&lt;linux/pci.h&gt;</a></u></td></tr>
<tr><th id="29">29</th><td><u>#include <a href="../../include/linux/rwsem.h.html">&lt;linux/rwsem.h&gt;</a></u></td></tr>
<tr><th id="30">30</th><td><u>#include <a href="../../include/linux/sched.h.html">&lt;linux/sched.h&gt;</a></u></td></tr>
<tr><th id="31">31</th><td><u>#include <a href="../../include/linux/slab.h.html">&lt;linux/slab.h&gt;</a></u></td></tr>
<tr><th id="32">32</th><td><u>#include <a href="../../include/linux/stat.h.html">&lt;linux/stat.h&gt;</a></u></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="../../include/linux/string.h.html">&lt;linux/string.h&gt;</a></u></td></tr>
<tr><th id="34">34</th><td><u>#include <a href="../../include/linux/uaccess.h.html">&lt;linux/uaccess.h&gt;</a></u></td></tr>
<tr><th id="35">35</th><td><u>#include <a href="../../include/linux/vfio.h.html">&lt;linux/vfio.h&gt;</a></u></td></tr>
<tr><th id="36">36</th><td><u>#include <a href="../../include/linux/wait.h.html">&lt;linux/wait.h&gt;</a></u></td></tr>
<tr><th id="37">37</th><td></td></tr>
<tr><th id="38">38</th><td><u>#define <dfn class="macro" id="_M/DRIVER_VERSION" data-ref="_M/DRIVER_VERSION">DRIVER_VERSION</dfn>	"0.3"</u></td></tr>
<tr><th id="39">39</th><td><u>#define <dfn class="macro" id="_M/DRIVER_AUTHOR" data-ref="_M/DRIVER_AUTHOR">DRIVER_AUTHOR</dfn>	"Alex Williamson &lt;alex.williamson@redhat.com&gt;"</u></td></tr>
<tr><th id="40">40</th><td><u>#define <dfn class="macro" id="_M/DRIVER_DESC" data-ref="_M/DRIVER_DESC">DRIVER_DESC</dfn>	"VFIO - User Level meta-driver"</u></td></tr>
<tr><th id="41">41</th><td></td></tr>
<tr><th id="42">42</th><td><em>static</em> <b>struct</b> <dfn class="type def" id="vfio" title='vfio' data-ref="vfio"><a class="type" href="#vfio" title='vfio' data-ref="vfio">vfio</a></dfn> {</td></tr>
<tr><th id="43">43</th><td>	<b>struct</b> <a class="type" href="../../include/linux/device.h.html#class" title='class' data-ref="class">class</a>			*<dfn class="tu decl field" id="vfio::class" title='vfio::class' data-type='struct class *' data-ref="vfio::class">class</dfn>;</td></tr>
<tr><th id="44">44</th><td>	<b>struct</b> <a class="type" href="../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a>		<dfn class="tu decl field" id="vfio::iommu_drivers_list" title='vfio::iommu_drivers_list' data-type='struct list_head' data-ref="vfio::iommu_drivers_list">iommu_drivers_list</dfn>;</td></tr>
<tr><th id="45">45</th><td>	<b>struct</b> <a class="type" href="../../include/linux/mutex.h.html#mutex" title='mutex' data-ref="mutex">mutex</a>			<dfn class="tu decl field" id="vfio::iommu_drivers_lock" title='vfio::iommu_drivers_lock' data-type='struct mutex' data-ref="vfio::iommu_drivers_lock">iommu_drivers_lock</dfn>;</td></tr>
<tr><th id="46">46</th><td>	<b>struct</b> <a class="type" href="../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a>		<dfn class="tu decl field" id="vfio::group_list" title='vfio::group_list' data-type='struct list_head' data-ref="vfio::group_list">group_list</dfn>;</td></tr>
<tr><th id="47">47</th><td>	<b>struct</b> <a class="type" href="../../include/linux/idr.h.html#idr" title='idr' data-ref="idr">idr</a>			<dfn class="tu decl field" id="vfio::group_idr" title='vfio::group_idr' data-type='struct idr' data-ref="vfio::group_idr">group_idr</dfn>;</td></tr>
<tr><th id="48">48</th><td>	<b>struct</b> <a class="type" href="../../include/linux/mutex.h.html#mutex" title='mutex' data-ref="mutex">mutex</a>			<dfn class="tu decl field" id="vfio::group_lock" title='vfio::group_lock' data-type='struct mutex' data-ref="vfio::group_lock">group_lock</dfn>;</td></tr>
<tr><th id="49">49</th><td>	<b>struct</b> <a class="type" href="../../include/linux/cdev.h.html#cdev" title='cdev' data-ref="cdev">cdev</a>			<dfn class="tu decl field" id="vfio::group_cdev" title='vfio::group_cdev' data-type='struct cdev' data-ref="vfio::group_cdev">group_cdev</dfn>;</td></tr>
<tr><th id="50">50</th><td>	<a class="typedef" href="../../include/linux/types.h.html#dev_t" title='dev_t' data-type='__kernel_dev_t' data-ref="dev_t">dev_t</a>				<dfn class="tu decl field" id="vfio::group_devt" title='vfio::group_devt' data-type='dev_t' data-ref="vfio::group_devt">group_devt</dfn>;</td></tr>
<tr><th id="51">51</th><td>	<a class="typedef" href="../../include/linux/wait.h.html#wait_queue_head_t" title='wait_queue_head_t' data-type='struct wait_queue_head' data-ref="wait_queue_head_t">wait_queue_head_t</a>		<dfn class="tu decl field" id="vfio::release_q" title='vfio::release_q' data-type='wait_queue_head_t' data-ref="vfio::release_q">release_q</dfn>;</td></tr>
<tr><th id="52">52</th><td>} <dfn class="tu decl def" id="vfio" title='vfio' data-type='struct vfio' data-ref="vfio">vfio</dfn>;</td></tr>
<tr><th id="53">53</th><td></td></tr>
<tr><th id="54">54</th><td><b>struct</b> <dfn class="type def" id="vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</dfn> {</td></tr>
<tr><th id="55">55</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops" title='vfio_iommu_driver_ops' data-ref="vfio_iommu_driver_ops">vfio_iommu_driver_ops</a>	*<dfn class="tu decl field" id="vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-type='const struct vfio_iommu_driver_ops *' data-ref="vfio_iommu_driver::ops">ops</dfn>;</td></tr>
<tr><th id="56">56</th><td>	<b>struct</b> <a class="type" href="../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a>			<dfn class="tu decl field" id="vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-type='struct list_head' data-ref="vfio_iommu_driver::vfio_next">vfio_next</dfn>;</td></tr>
<tr><th id="57">57</th><td>};</td></tr>
<tr><th id="58">58</th><td></td></tr>
<tr><th id="59">59</th><td><b>struct</b> <dfn class="type def" id="vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</dfn> {</td></tr>
<tr><th id="60">60</th><td>	<b>struct</b> <a class="type" href="../../include/linux/kref.h.html#kref" title='kref' data-ref="kref">kref</a>			<dfn class="tu decl field" id="vfio_container::kref" title='vfio_container::kref' data-type='struct kref' data-ref="vfio_container::kref">kref</dfn>;</td></tr>
<tr><th id="61">61</th><td>	<b>struct</b> <a class="type" href="../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a>		<dfn class="tu decl field" id="vfio_container::group_list" title='vfio_container::group_list' data-type='struct list_head' data-ref="vfio_container::group_list">group_list</dfn>;</td></tr>
<tr><th id="62">62</th><td>	<b>struct</b> <a class="type" href="../../include/linux/rwsem.h.html#rw_semaphore" title='rw_semaphore' data-ref="rw_semaphore">rw_semaphore</a>		<dfn class="tu decl field" id="vfio_container::group_lock" title='vfio_container::group_lock' data-type='struct rw_semaphore' data-ref="vfio_container::group_lock">group_lock</dfn>;</td></tr>
<tr><th id="63">63</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a>	*<dfn class="tu decl field" id="vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-type='struct vfio_iommu_driver *' data-ref="vfio_container::iommu_driver">iommu_driver</dfn>;</td></tr>
<tr><th id="64">64</th><td>	<em>void</em>				*<dfn class="tu decl field" id="vfio_container::iommu_data" title='vfio_container::iommu_data' data-type='void *' data-ref="vfio_container::iommu_data">iommu_data</dfn>;</td></tr>
<tr><th id="65">65</th><td>	<a class="typedef" href="../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a>				<dfn class="tu decl field" id="vfio_container::noiommu" title='vfio_container::noiommu' data-type='bool' data-ref="vfio_container::noiommu">noiommu</dfn>;</td></tr>
<tr><th id="66">66</th><td>};</td></tr>
<tr><th id="67">67</th><td></td></tr>
<tr><th id="68">68</th><td><b>struct</b> <dfn class="type def" id="vfio_unbound_dev" title='vfio_unbound_dev' data-ref="vfio_unbound_dev">vfio_unbound_dev</dfn> {</td></tr>
<tr><th id="69">69</th><td>	<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a>			*<dfn class="tu decl field" id="vfio_unbound_dev::dev" title='vfio_unbound_dev::dev' data-type='struct device *' data-ref="vfio_unbound_dev::dev">dev</dfn>;</td></tr>
<tr><th id="70">70</th><td>	<b>struct</b> <a class="type" href="../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a>		<dfn class="tu decl field" id="vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-type='struct list_head' data-ref="vfio_unbound_dev::unbound_next">unbound_next</dfn>;</td></tr>
<tr><th id="71">71</th><td>};</td></tr>
<tr><th id="72">72</th><td></td></tr>
<tr><th id="73">73</th><td><b>struct</b> <dfn class="type def" id="vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</dfn> {</td></tr>
<tr><th id="74">74</th><td>	<b>struct</b> <a class="type" href="../../include/linux/kref.h.html#kref" title='kref' data-ref="kref">kref</a>			<dfn class="decl field" id="vfio_group::kref" title='vfio_group::kref' data-ref="vfio_group::kref">kref</dfn>;</td></tr>
<tr><th id="75">75</th><td>	<em>int</em>				<dfn class="decl field" id="vfio_group::minor" title='vfio_group::minor' data-ref="vfio_group::minor">minor</dfn>;</td></tr>
<tr><th id="76">76</th><td>	<a class="typedef" href="../../include/linux/types.h.html#atomic_t" title='atomic_t' data-type='struct atomic_t' data-ref="atomic_t">atomic_t</a>			<dfn class="decl field" id="vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</dfn>;</td></tr>
<tr><th id="77">77</th><td>	<b>struct</b> <a class="type" href="../../include/linux/device.h.html#iommu_group" title='iommu_group' data-ref="iommu_group">iommu_group</a>		*<dfn class="decl field" id="vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</dfn>;</td></tr>
<tr><th id="78">78</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a>		*<dfn class="decl field" id="vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</dfn>;</td></tr>
<tr><th id="79">79</th><td>	<b>struct</b> <a class="type" href="../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a>		<dfn class="decl field" id="vfio_group::device_list" title='vfio_group::device_list' data-ref="vfio_group::device_list">device_list</dfn>;</td></tr>
<tr><th id="80">80</th><td>	<b>struct</b> <a class="type" href="../../include/linux/mutex.h.html#mutex" title='mutex' data-ref="mutex">mutex</a>			<dfn class="decl field" id="vfio_group::device_lock" title='vfio_group::device_lock' data-ref="vfio_group::device_lock">device_lock</dfn>;</td></tr>
<tr><th id="81">81</th><td>	<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a>			*<dfn class="decl field" id="vfio_group::dev" title='vfio_group::dev' data-ref="vfio_group::dev">dev</dfn>;</td></tr>
<tr><th id="82">82</th><td>	<b>struct</b> <a class="type" href="../../include/linux/notifier.h.html#notifier_block" title='notifier_block' data-ref="notifier_block">notifier_block</a>		<dfn class="decl field" id="vfio_group::nb" title='vfio_group::nb' data-ref="vfio_group::nb">nb</dfn>;</td></tr>
<tr><th id="83">83</th><td>	<b>struct</b> <a class="type" href="../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a>		<dfn class="decl field" id="vfio_group::vfio_next" title='vfio_group::vfio_next' data-ref="vfio_group::vfio_next">vfio_next</dfn>;</td></tr>
<tr><th id="84">84</th><td>	<b>struct</b> <a class="type" href="../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a>		<dfn class="decl field" id="vfio_group::container_next" title='vfio_group::container_next' data-ref="vfio_group::container_next">container_next</dfn>;</td></tr>
<tr><th id="85">85</th><td>	<b>struct</b> <a class="type" href="../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a>		<dfn class="decl field" id="vfio_group::unbound_list" title='vfio_group::unbound_list' data-ref="vfio_group::unbound_list">unbound_list</dfn>;</td></tr>
<tr><th id="86">86</th><td>	<b>struct</b> <a class="type" href="../../include/linux/mutex.h.html#mutex" title='mutex' data-ref="mutex">mutex</a>			<dfn class="decl field" id="vfio_group::unbound_lock" title='vfio_group::unbound_lock' data-ref="vfio_group::unbound_lock">unbound_lock</dfn>;</td></tr>
<tr><th id="87">87</th><td>	<a class="typedef" href="../../include/linux/types.h.html#atomic_t" title='atomic_t' data-type='struct atomic_t' data-ref="atomic_t">atomic_t</a>			<dfn class="decl field" id="vfio_group::opened" title='vfio_group::opened' data-ref="vfio_group::opened">opened</dfn>;</td></tr>
<tr><th id="88">88</th><td>	<a class="typedef" href="../../include/linux/wait.h.html#wait_queue_head_t" title='wait_queue_head_t' data-type='struct wait_queue_head' data-ref="wait_queue_head_t">wait_queue_head_t</a>		<dfn class="decl field" id="vfio_group::container_q" title='vfio_group::container_q' data-ref="vfio_group::container_q">container_q</dfn>;</td></tr>
<tr><th id="89">89</th><td>	<a class="typedef" href="../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a>				<dfn class="decl field" id="vfio_group::noiommu" title='vfio_group::noiommu' data-ref="vfio_group::noiommu">noiommu</dfn>;</td></tr>
<tr><th id="90">90</th><td>	<b>struct</b> <a class="type" href="../../include/linux/vfio.h.html#kvm" title='kvm' data-ref="kvm">kvm</a>			*<dfn class="decl field" id="vfio_group::kvm" title='vfio_group::kvm' data-ref="vfio_group::kvm">kvm</dfn>;</td></tr>
<tr><th id="91">91</th><td>	<b>struct</b> <a class="type" href="../../include/linux/notifier.h.html#blocking_notifier_head" title='blocking_notifier_head' data-ref="blocking_notifier_head">blocking_notifier_head</a>	<dfn class="decl field" id="vfio_group::notifier" title='vfio_group::notifier' data-ref="vfio_group::notifier">notifier</dfn>;</td></tr>
<tr><th id="92">92</th><td>};</td></tr>
<tr><th id="93">93</th><td></td></tr>
<tr><th id="94">94</th><td><b>struct</b> <dfn class="type def" id="vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</dfn> {</td></tr>
<tr><th id="95">95</th><td>	<b>struct</b> <a class="type" href="../../include/linux/kref.h.html#kref" title='kref' data-ref="kref">kref</a>			<dfn class="decl field" id="vfio_device::kref" title='vfio_device::kref' data-ref="vfio_device::kref">kref</dfn>;</td></tr>
<tr><th id="96">96</th><td>	<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a>			*<dfn class="decl field" id="vfio_device::dev" title='vfio_device::dev' data-ref="vfio_device::dev">dev</dfn>;</td></tr>
<tr><th id="97">97</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../../include/linux/vfio.h.html#vfio_device_ops" title='vfio_device_ops' data-ref="vfio_device_ops">vfio_device_ops</a>	*<dfn class="decl field" id="vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</dfn>;</td></tr>
<tr><th id="98">98</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a>		*<dfn class="decl field" id="vfio_device::group" title='vfio_device::group' data-ref="vfio_device::group">group</dfn>;</td></tr>
<tr><th id="99">99</th><td>	<b>struct</b> <a class="type" href="../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head">list_head</a>		<dfn class="decl field" id="vfio_device::group_next" title='vfio_device::group_next' data-ref="vfio_device::group_next">group_next</dfn>;</td></tr>
<tr><th id="100">100</th><td>	<em>void</em>				*<dfn class="decl field" id="vfio_device::device_data" title='vfio_device::device_data' data-ref="vfio_device::device_data">device_data</dfn>;</td></tr>
<tr><th id="101">101</th><td>};</td></tr>
<tr><th id="102">102</th><td></td></tr>
<tr><th id="103">103</th><td><u>#<span data-ppcond="103">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#156" data-ref="_M/CONFIG_VFIO_NOIOMMU">CONFIG_VFIO_NOIOMMU</a></u></td></tr>
<tr><th id="104">104</th><td><em>static</em> <a class="typedef" href="../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="tu decl def" id="noiommu" title='noiommu' data-type='bool' data-ref="noiommu">noiommu</dfn> <a class="macro" href="../../arch/x86/include/asm/cache.h.html#11" title="__attribute__((__section__(&quot;.data..read_mostly&quot;)))" data-ref="_M/__read_mostly">__read_mostly</a>;</td></tr>
<tr><th id="105">105</th><td><a class="macro" href="../../include/linux/moduleparam.h.html#148" title="static inline __attribute__((always_inline, unused)) __attribute__((no_instrument_function)) bool __attribute__((unused)) *__check_enable_unsafe_noiommu_mode(void) { return(&amp;(noiommu)); }; static const char __param_str_enable_unsafe_noiommu_mode[] = &quot;vfio&quot; &quot;.&quot; &quot;enable_unsafe_noiommu_mode&quot;; static struct kernel_param const __param_enable_unsafe_noiommu_mode __attribute__((__used__)) __attribute__ ((unused,__section__ (&quot;__param&quot;),aligned(sizeof(void *)))) = { __param_str_enable_unsafe_noiommu_mode, ((struct module *)0), &amp;param_ops_bool, ((sizeof(struct { int:(-!!(((00400|00040|00004) | 00200) &lt; 0)); })) + (sizeof(struct { int:(-!!(((00400|00040|00004) | 00200) &gt; 0777)); })) + (sizeof(struct { int:(-!!(((((00400|00040|00004) | 00200) &gt;&gt; 6) &amp; 4) &lt; ((((00400|00040|00004) | 00200) &gt;&gt; 3) &amp; 4))); })) + (sizeof(struct { int:(-!!(((((00400|00040|00004) | 00200) &gt;&gt; 3) &amp; 4) &lt; (((00400|00040|00004) | 00200) &amp; 4))); })) + (sizeof(struct { int:(-!!(((((00400|00040|00004) | 00200) &gt;&gt; 6) &amp; 2) &lt; ((((00400|00040|00004) | 00200) &gt;&gt; 3) &amp; 2))); })) + (sizeof(struct { int:(-!!(((00400|00040|00004) | 00200) &amp; 2)); })) + ((00400|00040|00004) | 00200)), -1, 0, { &amp;noiommu } }; struct __UNIQUE_ID_enable_unsafe_noiommu_modetype62 {}" data-ref="_M/module_param_named">module_param_named</a>(enable_unsafe_noiommu_mode,</td></tr>
<tr><th id="106">106</th><td>		   <a class="tu ref" href="#noiommu" title='noiommu' data-use='a' data-ref="noiommu">noiommu</a>, bool, <a class="macro" href="../../include/linux/stat.h.html#11" title="(00400|00040|00004)" data-ref="_M/S_IRUGO">S_IRUGO</a> | <a class="macro" href="../../include/uapi/linux/stat.h.html#31" title="00200" data-ref="_M/S_IWUSR">S_IWUSR</a>);</td></tr>
<tr><th id="107">107</th><td><a class="macro" href="../../include/linux/moduleparam.h.html#35" title="struct __UNIQUE_ID_enable_unsafe_noiommu_mode64 {}" data-ref="_M/MODULE_PARM_DESC">MODULE_PARM_DESC</a>(enable_unsafe_noiommu_mode, <q>"Enable UNSAFE, no-IOMMU mode.  This mode provides no device isolation, no DMA translation, no host kernel protection, cannot be used for device assignment to virtual machines, requires RAWIO permissions, and will taint the kernel.  If you do not know what this is for, step away. (default: false)"</q>);</td></tr>
<tr><th id="108">108</th><td><u>#<span data-ppcond="103">endif</span></u></td></tr>
<tr><th id="109">109</th><td></td></tr>
<tr><th id="110">110</th><td><i>/*</i></td></tr>
<tr><th id="111">111</th><td><i> * vfio_iommu_group_{get,put} are only intended for VFIO bus driver probe</i></td></tr>
<tr><th id="112">112</th><td><i> * and remove functions, any use cases other than acquiring the first</i></td></tr>
<tr><th id="113">113</th><td><i> * reference for the purpose of calling vfio_add_group_dev() or removing</i></td></tr>
<tr><th id="114">114</th><td><i> * that symmetric reference after vfio_del_group_dev() should use the raw</i></td></tr>
<tr><th id="115">115</th><td><i> * iommu_group_{get,put} functions.  In particular, vfio_iommu_group_put()</i></td></tr>
<tr><th id="116">116</th><td><i> * removes the device from the dummy group and cannot be nested.</i></td></tr>
<tr><th id="117">117</th><td><i> */</i></td></tr>
<tr><th id="118">118</th><td><b>struct</b> <a class="type" href="../../include/linux/device.h.html#iommu_group" title='iommu_group' data-ref="iommu_group">iommu_group</a> *<dfn class="decl def fn" id="vfio_iommu_group_get" title='vfio_iommu_group_get' data-ref="vfio_iommu_group_get">vfio_iommu_group_get</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col1 decl" id="1dev" title='dev' data-type='struct device *' data-ref="1dev">dev</dfn>)</td></tr>
<tr><th id="119">119</th><td>{</td></tr>
<tr><th id="120">120</th><td>	<b>struct</b> <a class="type" href="../../include/linux/device.h.html#iommu_group" title='iommu_group' data-ref="iommu_group">iommu_group</a> *<dfn class="local col2 decl" id="2group" title='group' data-type='struct iommu_group *' data-ref="2group">group</dfn>;</td></tr>
<tr><th id="121">121</th><td>	<em>int</em> <a class="macro" href="../../include/linux/compiler-gcc.h.html#147" title="__attribute__((unused))" data-ref="_M/__maybe_unused">__maybe_unused</a> <dfn class="local col3 decl" id="3ret" title='ret' data-type='int' data-ref="3ret">ret</dfn>;</td></tr>
<tr><th id="122">122</th><td></td></tr>
<tr><th id="123">123</th><td>	<a class="local col2 ref" href="#2group" title='group' data-ref="2group">group</a> = <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_get" title='iommu_group_get' data-ref="iommu_group_get">iommu_group_get</a>(<a class="local col1 ref" href="#1dev" title='dev' data-ref="1dev">dev</a>);</td></tr>
<tr><th id="124">124</th><td></td></tr>
<tr><th id="125">125</th><td><u>#<span data-ppcond="125">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#156" data-ref="_M/CONFIG_VFIO_NOIOMMU">CONFIG_VFIO_NOIOMMU</a></u></td></tr>
<tr><th id="126">126</th><td>	<i>/*</i></td></tr>
<tr><th id="127">127</th><td><i>	 * With noiommu enabled, an IOMMU group will be created for a device</i></td></tr>
<tr><th id="128">128</th><td><i>	 * that doesn't already have one and doesn't have an iommu_ops on their</i></td></tr>
<tr><th id="129">129</th><td><i>	 * bus.  We set iommudata simply to be able to identify these groups</i></td></tr>
<tr><th id="130">130</th><td><i>	 * as special use and for reclamation later.</i></td></tr>
<tr><th id="131">131</th><td><i>	 */</i></td></tr>
<tr><th id="132">132</th><td>	<b>if</b> (<a class="local col2 ref" href="#2group" title='group' data-ref="2group">group</a> || !<a class="tu ref" href="#noiommu" title='noiommu' data-use='r' data-ref="noiommu">noiommu</a> || <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_present" title='iommu_present' data-ref="iommu_present">iommu_present</a>(<a class="local col1 ref" href="#1dev" title='dev' data-ref="1dev">dev</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#device::bus" title='device::bus' data-ref="device::bus">bus</a>))</td></tr>
<tr><th id="133">133</th><td>		<b>return</b> <a class="local col2 ref" href="#2group" title='group' data-ref="2group">group</a>;</td></tr>
<tr><th id="134">134</th><td></td></tr>
<tr><th id="135">135</th><td>	<a class="local col2 ref" href="#2group" title='group' data-ref="2group">group</a> = <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_alloc" title='iommu_group_alloc' data-ref="iommu_group_alloc">iommu_group_alloc</a>();</td></tr>
<tr><th id="136">136</th><td>	<b>if</b> (<a class="ref fn" href="../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="local col2 ref" href="#2group" title='group' data-ref="2group">group</a>))</td></tr>
<tr><th id="137">137</th><td>		<b>return</b> <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="138">138</th><td></td></tr>
<tr><th id="139">139</th><td>	<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_set_name" title='iommu_group_set_name' data-ref="iommu_group_set_name">iommu_group_set_name</a>(<a class="local col2 ref" href="#2group" title='group' data-ref="2group">group</a>, <q>"vfio-noiommu"</q>);</td></tr>
<tr><th id="140">140</th><td>	<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_set_iommudata" title='iommu_group_set_iommudata' data-ref="iommu_group_set_iommudata">iommu_group_set_iommudata</a>(<a class="local col2 ref" href="#2group" title='group' data-ref="2group">group</a>, &amp;<a class="tu ref" href="#noiommu" title='noiommu' data-use='a' data-ref="noiommu">noiommu</a>, <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="141">141</th><td>	<a class="local col3 ref" href="#3ret" title='ret' data-ref="3ret">ret</a> = <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_add_device" title='iommu_group_add_device' data-ref="iommu_group_add_device">iommu_group_add_device</a>(<a class="local col2 ref" href="#2group" title='group' data-ref="2group">group</a>, <a class="local col1 ref" href="#1dev" title='dev' data-ref="1dev">dev</a>);</td></tr>
<tr><th id="142">142</th><td>	<b>if</b> (<a class="local col3 ref" href="#3ret" title='ret' data-ref="3ret">ret</a>) {</td></tr>
<tr><th id="143">143</th><td>		<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_put" title='iommu_group_put' data-ref="iommu_group_put">iommu_group_put</a>(<a class="local col2 ref" href="#2group" title='group' data-ref="2group">group</a>);</td></tr>
<tr><th id="144">144</th><td>		<b>return</b> <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="145">145</th><td>	}</td></tr>
<tr><th id="146">146</th><td></td></tr>
<tr><th id="147">147</th><td>	<i>/*</i></td></tr>
<tr><th id="148">148</th><td><i>	 * Where to taint?  At this point we've added an IOMMU group for a</i></td></tr>
<tr><th id="149">149</th><td><i>	 * device that is not backed by iommu_ops, therefore any iommu_</i></td></tr>
<tr><th id="150">150</th><td><i>	 * callback using iommu_ops can legitimately Oops.  So, while we may</i></td></tr>
<tr><th id="151">151</th><td><i>	 * be about to give a DMA capable device to a user without IOMMU</i></td></tr>
<tr><th id="152">152</th><td><i>	 * protection, which is clearly taint-worthy, let's go ahead and do</i></td></tr>
<tr><th id="153">153</th><td><i>	 * it here.</i></td></tr>
<tr><th id="154">154</th><td><i>	 */</i></td></tr>
<tr><th id="155">155</th><td>	<a class="ref fn" href="../../include/linux/kernel.h.html#add_taint" title='add_taint' data-ref="add_taint">add_taint</a>(<a class="macro" href="../../include/linux/kernel.h.html#556" title="6" data-ref="_M/TAINT_USER">TAINT_USER</a>, <a class="enum" href="../../include/linux/kernel.h.html#LOCKDEP_STILL_OK" title='LOCKDEP_STILL_OK' data-ref="LOCKDEP_STILL_OK">LOCKDEP_STILL_OK</a>);</td></tr>
<tr><th id="156">156</th><td>	<a class="ref fn" href="../../include/linux/device.h.html#dev_warn" title='dev_warn' data-ref="dev_warn">dev_warn</a>(<a class="local col1 ref" href="#1dev" title='dev' data-ref="1dev">dev</a>, <q>"Adding kernel taint for vfio-noiommu group on device\n"</q>);</td></tr>
<tr><th id="157">157</th><td><u>#<span data-ppcond="125">endif</span></u></td></tr>
<tr><th id="158">158</th><td></td></tr>
<tr><th id="159">159</th><td>	<b>return</b> <a class="local col2 ref" href="#2group" title='group' data-ref="2group">group</a>;</td></tr>
<tr><th id="160">160</th><td>}</td></tr>
<tr><th id="161">161</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_iommu_group_get) vfio_iommu_group_get; static const char __kstrtab_vfio_iommu_group_get[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_iommu_group_get&quot;; static const struct kernel_symbol __ksymtab_vfio_iommu_group_get __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_iommu_group_get&quot;), used)) = { (unsigned long)&amp;vfio_iommu_group_get, __kstrtab_vfio_iommu_group_get }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_iommu_group_get" title='vfio_iommu_group_get' data-ref="vfio_iommu_group_get"><a class="ref fn" href="#vfio_iommu_group_get" title='vfio_iommu_group_get' data-ref="vfio_iommu_group_get"><a class="ref fn" href="#vfio_iommu_group_get" title='vfio_iommu_group_get' data-ref="vfio_iommu_group_get"><a class="ref fn" href="#vfio_iommu_group_get" title='vfio_iommu_group_get' data-ref="vfio_iommu_group_get">vfio_iommu_group_get</a></a></a></a>);</td></tr>
<tr><th id="162">162</th><td></td></tr>
<tr><th id="163">163</th><td><em>void</em> <dfn class="decl def fn" id="vfio_iommu_group_put" title='vfio_iommu_group_put' data-ref="vfio_iommu_group_put">vfio_iommu_group_put</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#iommu_group" title='iommu_group' data-ref="iommu_group">iommu_group</a> *<dfn class="local col4 decl" id="4group" title='group' data-type='struct iommu_group *' data-ref="4group">group</dfn>, <b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col5 decl" id="5dev" title='dev' data-type='struct device *' data-ref="5dev">dev</dfn>)</td></tr>
<tr><th id="164">164</th><td>{</td></tr>
<tr><th id="165">165</th><td><u>#<span data-ppcond="165">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#156" data-ref="_M/CONFIG_VFIO_NOIOMMU">CONFIG_VFIO_NOIOMMU</a></u></td></tr>
<tr><th id="166">166</th><td>	<b>if</b> (<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_get_iommudata" title='iommu_group_get_iommudata' data-ref="iommu_group_get_iommudata">iommu_group_get_iommudata</a>(<a class="local col4 ref" href="#4group" title='group' data-ref="4group">group</a>) == &amp;<a class="tu ref" href="#noiommu" title='noiommu' data-use='a' data-ref="noiommu">noiommu</a>)</td></tr>
<tr><th id="167">167</th><td>		<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_remove_device" title='iommu_group_remove_device' data-ref="iommu_group_remove_device">iommu_group_remove_device</a>(<a class="local col5 ref" href="#5dev" title='dev' data-ref="5dev">dev</a>);</td></tr>
<tr><th id="168">168</th><td><u>#<span data-ppcond="165">endif</span></u></td></tr>
<tr><th id="169">169</th><td></td></tr>
<tr><th id="170">170</th><td>	<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_put" title='iommu_group_put' data-ref="iommu_group_put">iommu_group_put</a>(<a class="local col4 ref" href="#4group" title='group' data-ref="4group">group</a>);</td></tr>
<tr><th id="171">171</th><td>}</td></tr>
<tr><th id="172">172</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_iommu_group_put) vfio_iommu_group_put; static const char __kstrtab_vfio_iommu_group_put[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_iommu_group_put&quot;; static const struct kernel_symbol __ksymtab_vfio_iommu_group_put __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_iommu_group_put&quot;), used)) = { (unsigned long)&amp;vfio_iommu_group_put, __kstrtab_vfio_iommu_group_put }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_iommu_group_put" title='vfio_iommu_group_put' data-ref="vfio_iommu_group_put"><a class="ref fn" href="#vfio_iommu_group_put" title='vfio_iommu_group_put' data-ref="vfio_iommu_group_put"><a class="ref fn" href="#vfio_iommu_group_put" title='vfio_iommu_group_put' data-ref="vfio_iommu_group_put"><a class="ref fn" href="#vfio_iommu_group_put" title='vfio_iommu_group_put' data-ref="vfio_iommu_group_put">vfio_iommu_group_put</a></a></a></a>);</td></tr>
<tr><th id="173">173</th><td></td></tr>
<tr><th id="174">174</th><td><u>#<span data-ppcond="174">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#156" data-ref="_M/CONFIG_VFIO_NOIOMMU">CONFIG_VFIO_NOIOMMU</a></u></td></tr>
<tr><th id="175">175</th><td><em>static</em> <em>void</em> *<dfn class="tu decl def fn" id="vfio_noiommu_open" title='vfio_noiommu_open' data-type='void * vfio_noiommu_open(unsigned long arg)' data-ref="vfio_noiommu_open">vfio_noiommu_open</dfn>(<em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="6arg" title='arg' data-type='unsigned long' data-ref="6arg">arg</dfn>)</td></tr>
<tr><th id="176">176</th><td>{</td></tr>
<tr><th id="177">177</th><td>	<b>if</b> (<a class="local col6 ref" href="#6arg" title='arg' data-ref="6arg">arg</a> != <a class="macro" href="../../include/uapi/linux/vfio.h.html#47" title="8" data-ref="_M/VFIO_NOIOMMU_IOMMU">VFIO_NOIOMMU_IOMMU</a>)</td></tr>
<tr><th id="178">178</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>);</td></tr>
<tr><th id="179">179</th><td>	<b>if</b> (!<a class="ref fn" href="../../include/linux/capability.h.html#capable" title='capable' data-ref="capable">capable</a>(<a class="macro" href="../../include/uapi/linux/capability.h.html#227" title="17" data-ref="_M/CAP_SYS_RAWIO">CAP_SYS_RAWIO</a>))</td></tr>
<tr><th id="180">180</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>);</td></tr>
<tr><th id="181">181</th><td></td></tr>
<tr><th id="182">182</th><td>	<b>return</b> <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="183">183</th><td>}</td></tr>
<tr><th id="184">184</th><td></td></tr>
<tr><th id="185">185</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_noiommu_release" title='vfio_noiommu_release' data-type='void vfio_noiommu_release(void * iommu_data)' data-ref="vfio_noiommu_release">vfio_noiommu_release</dfn>(<em>void</em> *<dfn class="local col7 decl" id="7iommu_data" title='iommu_data' data-type='void *' data-ref="7iommu_data">iommu_data</dfn>)</td></tr>
<tr><th id="186">186</th><td>{</td></tr>
<tr><th id="187">187</th><td>}</td></tr>
<tr><th id="188">188</th><td></td></tr>
<tr><th id="189">189</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="vfio_noiommu_ioctl" title='vfio_noiommu_ioctl' data-type='long vfio_noiommu_ioctl(void * iommu_data, unsigned int cmd, unsigned long arg)' data-ref="vfio_noiommu_ioctl">vfio_noiommu_ioctl</dfn>(<em>void</em> *<dfn class="local col8 decl" id="8iommu_data" title='iommu_data' data-type='void *' data-ref="8iommu_data">iommu_data</dfn>,</td></tr>
<tr><th id="190">190</th><td>			       <em>unsigned</em> <em>int</em> <dfn class="local col9 decl" id="9cmd" title='cmd' data-type='unsigned int' data-ref="9cmd">cmd</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col0 decl" id="10arg" title='arg' data-type='unsigned long' data-ref="10arg">arg</dfn>)</td></tr>
<tr><th id="191">191</th><td>{</td></tr>
<tr><th id="192">192</th><td>	<b>if</b> (<a class="local col9 ref" href="#9cmd" title='cmd' data-ref="9cmd">cmd</a> == <a class="macro" href="../../include/uapi/linux/vfio.h.html#110" title="(((0U) &lt;&lt; (((0+8)+8)+14)) | ((((&apos;;&apos;))) &lt;&lt; (0+8)) | (((100 + 1)) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VFIO_CHECK_EXTENSION">VFIO_CHECK_EXTENSION</a>)</td></tr>
<tr><th id="193">193</th><td>		<b>return</b> <a class="tu ref" href="#noiommu" title='noiommu' data-use='r' data-ref="noiommu">noiommu</a> &amp;&amp; (<a class="local col0 ref" href="#10arg" title='arg' data-ref="10arg">arg</a> == <a class="macro" href="../../include/uapi/linux/vfio.h.html#47" title="8" data-ref="_M/VFIO_NOIOMMU_IOMMU">VFIO_NOIOMMU_IOMMU</a>) ? <var>1</var> : <var>0</var>;</td></tr>
<tr><th id="194">194</th><td></td></tr>
<tr><th id="195">195</th><td>	<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#29" title="25" data-ref="_M/ENOTTY">ENOTTY</a>;</td></tr>
<tr><th id="196">196</th><td>}</td></tr>
<tr><th id="197">197</th><td></td></tr>
<tr><th id="198">198</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_noiommu_attach_group" title='vfio_noiommu_attach_group' data-type='int vfio_noiommu_attach_group(void * iommu_data, struct iommu_group * iommu_group)' data-ref="vfio_noiommu_attach_group">vfio_noiommu_attach_group</dfn>(<em>void</em> *<dfn class="local col1 decl" id="11iommu_data" title='iommu_data' data-type='void *' data-ref="11iommu_data">iommu_data</dfn>,</td></tr>
<tr><th id="199">199</th><td>				     <b>struct</b> <a class="type" href="../../include/linux/device.h.html#iommu_group" title='iommu_group' data-ref="iommu_group">iommu_group</a> *<dfn class="local col2 decl" id="12iommu_group" title='iommu_group' data-type='struct iommu_group *' data-ref="12iommu_group">iommu_group</dfn>)</td></tr>
<tr><th id="200">200</th><td>{</td></tr>
<tr><th id="201">201</th><td>	<b>return</b> <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_get_iommudata" title='iommu_group_get_iommudata' data-ref="iommu_group_get_iommudata">iommu_group_get_iommudata</a>(<a class="local col2 ref" href="#12iommu_group" title='iommu_group' data-ref="12iommu_group">iommu_group</a>) == &amp;<a class="tu ref" href="#noiommu" title='noiommu' data-use='a' data-ref="noiommu">noiommu</a> ? <var>0</var> : -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="202">202</th><td>}</td></tr>
<tr><th id="203">203</th><td></td></tr>
<tr><th id="204">204</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_noiommu_detach_group" title='vfio_noiommu_detach_group' data-type='void vfio_noiommu_detach_group(void * iommu_data, struct iommu_group * iommu_group)' data-ref="vfio_noiommu_detach_group">vfio_noiommu_detach_group</dfn>(<em>void</em> *<dfn class="local col3 decl" id="13iommu_data" title='iommu_data' data-type='void *' data-ref="13iommu_data">iommu_data</dfn>,</td></tr>
<tr><th id="205">205</th><td>				      <b>struct</b> <a class="type" href="../../include/linux/device.h.html#iommu_group" title='iommu_group' data-ref="iommu_group">iommu_group</a> *<dfn class="local col4 decl" id="14iommu_group" title='iommu_group' data-type='struct iommu_group *' data-ref="14iommu_group">iommu_group</dfn>)</td></tr>
<tr><th id="206">206</th><td>{</td></tr>
<tr><th id="207">207</th><td>}</td></tr>
<tr><th id="208">208</th><td></td></tr>
<tr><th id="209">209</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops" title='vfio_iommu_driver_ops' data-ref="vfio_iommu_driver_ops">vfio_iommu_driver_ops</a> <dfn class="tu decl def" id="vfio_noiommu_ops" title='vfio_noiommu_ops' data-type='const struct vfio_iommu_driver_ops' data-ref="vfio_noiommu_ops">vfio_noiommu_ops</dfn> = {</td></tr>
<tr><th id="210">210</th><td>	.<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::name" title='vfio_iommu_driver_ops::name' data-ref="vfio_iommu_driver_ops::name">name</a> = <q>"vfio-noiommu"</q>,</td></tr>
<tr><th id="211">211</th><td>	.<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::owner" title='vfio_iommu_driver_ops::owner' data-ref="vfio_iommu_driver_ops::owner">owner</a> = <a class="macro" href="../../include/linux/export.h.html#31" title="((struct module *)0)" data-ref="_M/THIS_MODULE">THIS_MODULE</a>,</td></tr>
<tr><th id="212">212</th><td>	.<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::open" title='vfio_iommu_driver_ops::open' data-ref="vfio_iommu_driver_ops::open">open</a> = <a class="tu ref fn" href="#vfio_noiommu_open" title='vfio_noiommu_open' data-ref="vfio_noiommu_open">vfio_noiommu_open</a>,</td></tr>
<tr><th id="213">213</th><td>	.<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::release" title='vfio_iommu_driver_ops::release' data-ref="vfio_iommu_driver_ops::release">release</a> = <a class="tu ref fn" href="#vfio_noiommu_release" title='vfio_noiommu_release' data-ref="vfio_noiommu_release">vfio_noiommu_release</a>,</td></tr>
<tr><th id="214">214</th><td>	.<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::ioctl" title='vfio_iommu_driver_ops::ioctl' data-ref="vfio_iommu_driver_ops::ioctl">ioctl</a> = <a class="tu ref fn" href="#vfio_noiommu_ioctl" title='vfio_noiommu_ioctl' data-ref="vfio_noiommu_ioctl">vfio_noiommu_ioctl</a>,</td></tr>
<tr><th id="215">215</th><td>	.<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::attach_group" title='vfio_iommu_driver_ops::attach_group' data-ref="vfio_iommu_driver_ops::attach_group">attach_group</a> = <a class="tu ref fn" href="#vfio_noiommu_attach_group" title='vfio_noiommu_attach_group' data-ref="vfio_noiommu_attach_group">vfio_noiommu_attach_group</a>,</td></tr>
<tr><th id="216">216</th><td>	.<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::detach_group" title='vfio_iommu_driver_ops::detach_group' data-ref="vfio_iommu_driver_ops::detach_group">detach_group</a> = <a class="tu ref fn" href="#vfio_noiommu_detach_group" title='vfio_noiommu_detach_group' data-ref="vfio_noiommu_detach_group">vfio_noiommu_detach_group</a>,</td></tr>
<tr><th id="217">217</th><td>};</td></tr>
<tr><th id="218">218</th><td><u>#<span data-ppcond="174">endif</span></u></td></tr>
<tr><th id="219">219</th><td></td></tr>
<tr><th id="220">220</th><td></td></tr>
<tr><th id="221">221</th><td><i class="doc">/**</i></td></tr>
<tr><th id="222">222</th><td><i class="doc"> * IOMMU driver registration</i></td></tr>
<tr><th id="223">223</th><td><i class="doc"> */</i></td></tr>
<tr><th id="224">224</th><td><em>int</em> <dfn class="decl def fn" id="vfio_register_iommu_driver" title='vfio_register_iommu_driver' data-ref="vfio_register_iommu_driver">vfio_register_iommu_driver</dfn>(<em>const</em> <b>struct</b> <a class="type" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops" title='vfio_iommu_driver_ops' data-ref="vfio_iommu_driver_ops">vfio_iommu_driver_ops</a> *<dfn class="local col5 decl" id="15ops" title='ops' data-type='const struct vfio_iommu_driver_ops *' data-ref="15ops">ops</dfn>)</td></tr>
<tr><th id="225">225</th><td>{</td></tr>
<tr><th id="226">226</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col6 decl" id="16driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="16driver">driver</dfn>, *<dfn class="local col7 decl" id="17tmp" title='tmp' data-type='struct vfio_iommu_driver *' data-ref="17tmp">tmp</dfn>;</td></tr>
<tr><th id="227">227</th><td></td></tr>
<tr><th id="228">228</th><td>	<a class="local col6 ref" href="#16driver" title='driver' data-ref="16driver">driver</a> = <a class="ref fn" href="../../include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc">kzalloc</a>(<b>sizeof</b>(*<a class="local col6 ref" href="#16driver" title='driver' data-ref="16driver">driver</a>), <a class="macro" href="../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x200000u|0x400000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="229">229</th><td>	<b>if</b> (!<a class="local col6 ref" href="#16driver" title='driver' data-ref="16driver">driver</a>)</td></tr>
<tr><th id="230">230</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="231">231</th><td></td></tr>
<tr><th id="232">232</th><td>	<a class="local col6 ref" href="#16driver" title='driver' data-ref="16driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='w' data-ref="vfio_iommu_driver::ops">ops</a> = <a class="local col5 ref" href="#15ops" title='ops' data-ref="15ops">ops</a>;</td></tr>
<tr><th id="233">233</th><td></td></tr>
<tr><th id="234">234</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_lock" title='vfio::iommu_drivers_lock' data-use='a' data-ref="vfio::iommu_drivers_lock">iommu_drivers_lock</a>);</td></tr>
<tr><th id="235">235</th><td></td></tr>
<tr><th id="236">236</th><td>	<i>/* Check for duplicates */</i></td></tr>
<tr><th id="237">237</th><td>	<a class="macro" href="../../include/linux/list.h.html#463" title="for (tmp = ({ void *__mptr = (void *)((&amp;vfio.iommu_drivers_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;vfio.iommu_drivers_list)-&gt;next)), typeof(((typeof(*tmp) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;vfio.iommu_drivers_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_237(void) ; if (__cond) __compiletime_assert_237(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*tmp) *)(__mptr - __builtin_offsetof(typeof(*tmp), vfio_next))); }); &amp;tmp-&gt;vfio_next != (&amp;vfio.iommu_drivers_list); tmp = ({ void *__mptr = (void *)((tmp)-&gt;vfio_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((tmp)-&gt;vfio_next.next)), typeof(((typeof(*(tmp)) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((tmp)-&gt;vfio_next.next)), typeof(void)))); extern void __compiletime_assert_237(void) ; if (__cond) __compiletime_assert_237(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(tmp)) *)(__mptr - __builtin_offsetof(typeof(*(tmp)), vfio_next))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col7 ref" href="#17tmp" title='tmp' data-ref="17tmp">tmp</a>, &amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_list" title='vfio::iommu_drivers_list' data-use='a' data-ref="vfio::iommu_drivers_list">iommu_drivers_list</a>, <a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='r' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='a' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='m' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='m' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='m' data-ref="vfio_iommu_driver::vfio_next">vfio_next</a></a></a></a></a>) {</td></tr>
<tr><th id="238">238</th><td>		<b>if</b> (<a class="local col7 ref" href="#17tmp" title='tmp' data-ref="17tmp">tmp</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a> == <a class="local col5 ref" href="#15ops" title='ops' data-ref="15ops">ops</a>) {</td></tr>
<tr><th id="239">239</th><td>			<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_lock" title='vfio::iommu_drivers_lock' data-use='a' data-ref="vfio::iommu_drivers_lock">iommu_drivers_lock</a>);</td></tr>
<tr><th id="240">240</th><td>			<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col6 ref" href="#16driver" title='driver' data-ref="16driver">driver</a>);</td></tr>
<tr><th id="241">241</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="242">242</th><td>		}</td></tr>
<tr><th id="243">243</th><td>	}</td></tr>
<tr><th id="244">244</th><td></td></tr>
<tr><th id="245">245</th><td>	<a class="ref fn" href="../../include/linux/list.h.html#list_add" title='list_add' data-ref="list_add">list_add</a>(&amp;<a class="local col6 ref" href="#16driver" title='driver' data-ref="16driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='a' data-ref="vfio_iommu_driver::vfio_next">vfio_next</a>, &amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_list" title='vfio::iommu_drivers_list' data-use='a' data-ref="vfio::iommu_drivers_list">iommu_drivers_list</a>);</td></tr>
<tr><th id="246">246</th><td></td></tr>
<tr><th id="247">247</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_lock" title='vfio::iommu_drivers_lock' data-use='a' data-ref="vfio::iommu_drivers_lock">iommu_drivers_lock</a>);</td></tr>
<tr><th id="248">248</th><td></td></tr>
<tr><th id="249">249</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="250">250</th><td>}</td></tr>
<tr><th id="251">251</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_register_iommu_driver) vfio_register_iommu_driver; static const char __kstrtab_vfio_register_iommu_driver[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_register_iommu_driver&quot;; static const struct kernel_symbol __ksymtab_vfio_register_iommu_driver __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_register_iommu_driver&quot;), used)) = { (unsigned long)&amp;vfio_register_iommu_driver, __kstrtab_vfio_register_iommu_driver }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_register_iommu_driver" title='vfio_register_iommu_driver' data-ref="vfio_register_iommu_driver"><a class="ref fn" href="#vfio_register_iommu_driver" title='vfio_register_iommu_driver' data-ref="vfio_register_iommu_driver"><a class="ref fn" href="#vfio_register_iommu_driver" title='vfio_register_iommu_driver' data-ref="vfio_register_iommu_driver"><a class="ref fn" href="#vfio_register_iommu_driver" title='vfio_register_iommu_driver' data-ref="vfio_register_iommu_driver">vfio_register_iommu_driver</a></a></a></a>);</td></tr>
<tr><th id="252">252</th><td></td></tr>
<tr><th id="253">253</th><td><em>void</em> <dfn class="decl def fn" id="vfio_unregister_iommu_driver" title='vfio_unregister_iommu_driver' data-ref="vfio_unregister_iommu_driver">vfio_unregister_iommu_driver</dfn>(<em>const</em> <b>struct</b> <a class="type" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops" title='vfio_iommu_driver_ops' data-ref="vfio_iommu_driver_ops">vfio_iommu_driver_ops</a> *<dfn class="local col8 decl" id="18ops" title='ops' data-type='const struct vfio_iommu_driver_ops *' data-ref="18ops">ops</dfn>)</td></tr>
<tr><th id="254">254</th><td>{</td></tr>
<tr><th id="255">255</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col9 decl" id="19driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="19driver">driver</dfn>;</td></tr>
<tr><th id="256">256</th><td></td></tr>
<tr><th id="257">257</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_lock" title='vfio::iommu_drivers_lock' data-use='a' data-ref="vfio::iommu_drivers_lock">iommu_drivers_lock</a>);</td></tr>
<tr><th id="258">258</th><td>	<a class="macro" href="../../include/linux/list.h.html#463" title="for (driver = ({ void *__mptr = (void *)((&amp;vfio.iommu_drivers_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;vfio.iommu_drivers_list)-&gt;next)), typeof(((typeof(*driver) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;vfio.iommu_drivers_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_258(void) ; if (__cond) __compiletime_assert_258(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*driver) *)(__mptr - __builtin_offsetof(typeof(*driver), vfio_next))); }); &amp;driver-&gt;vfio_next != (&amp;vfio.iommu_drivers_list); driver = ({ void *__mptr = (void *)((driver)-&gt;vfio_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((driver)-&gt;vfio_next.next)), typeof(((typeof(*(driver)) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((driver)-&gt;vfio_next.next)), typeof(void)))); extern void __compiletime_assert_258(void) ; if (__cond) __compiletime_assert_258(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(driver)) *)(__mptr - __builtin_offsetof(typeof(*(driver)), vfio_next))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col9 ref" href="#19driver" title='driver' data-ref="19driver">driver</a>, &amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_list" title='vfio::iommu_drivers_list' data-use='a' data-ref="vfio::iommu_drivers_list">iommu_drivers_list</a>, <a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='r' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='a' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='m' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='m' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='m' data-ref="vfio_iommu_driver::vfio_next">vfio_next</a></a></a></a></a>) {</td></tr>
<tr><th id="259">259</th><td>		<b>if</b> (<a class="local col9 ref" href="#19driver" title='driver' data-ref="19driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a> == <a class="local col8 ref" href="#18ops" title='ops' data-ref="18ops">ops</a>) {</td></tr>
<tr><th id="260">260</th><td>			<a class="ref fn" href="../../include/linux/list.h.html#list_del" title='list_del' data-ref="list_del">list_del</a>(&amp;<a class="local col9 ref" href="#19driver" title='driver' data-ref="19driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='a' data-ref="vfio_iommu_driver::vfio_next">vfio_next</a>);</td></tr>
<tr><th id="261">261</th><td>			<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_lock" title='vfio::iommu_drivers_lock' data-use='a' data-ref="vfio::iommu_drivers_lock">iommu_drivers_lock</a>);</td></tr>
<tr><th id="262">262</th><td>			<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col9 ref" href="#19driver" title='driver' data-ref="19driver">driver</a>);</td></tr>
<tr><th id="263">263</th><td>			<b>return</b>;</td></tr>
<tr><th id="264">264</th><td>		}</td></tr>
<tr><th id="265">265</th><td>	}</td></tr>
<tr><th id="266">266</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_lock" title='vfio::iommu_drivers_lock' data-use='a' data-ref="vfio::iommu_drivers_lock">iommu_drivers_lock</a>);</td></tr>
<tr><th id="267">267</th><td>}</td></tr>
<tr><th id="268">268</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_unregister_iommu_driver) vfio_unregister_iommu_driver; static const char __kstrtab_vfio_unregister_iommu_driver[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_unregister_iommu_driver&quot;; static const struct kernel_symbol __ksymtab_vfio_unregister_iommu_driver __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_unregister_iommu_driver&quot;), used)) = { (unsigned long)&amp;vfio_unregister_iommu_driver, __kstrtab_vfio_unregister_iommu_driver }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_unregister_iommu_driver" title='vfio_unregister_iommu_driver' data-ref="vfio_unregister_iommu_driver"><a class="ref fn" href="#vfio_unregister_iommu_driver" title='vfio_unregister_iommu_driver' data-ref="vfio_unregister_iommu_driver"><a class="ref fn" href="#vfio_unregister_iommu_driver" title='vfio_unregister_iommu_driver' data-ref="vfio_unregister_iommu_driver"><a class="ref fn" href="#vfio_unregister_iommu_driver" title='vfio_unregister_iommu_driver' data-ref="vfio_unregister_iommu_driver">vfio_unregister_iommu_driver</a></a></a></a>);</td></tr>
<tr><th id="269">269</th><td></td></tr>
<tr><th id="270">270</th><td><i class="doc" data-doc="vfio_alloc_group_minor">/**</i></td></tr>
<tr><th id="271">271</th><td><i class="doc" data-doc="vfio_alloc_group_minor"> * Group minor allocation/free - both called with vfio.group_lock held</i></td></tr>
<tr><th id="272">272</th><td><i class="doc" data-doc="vfio_alloc_group_minor"> */</i></td></tr>
<tr><th id="273">273</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_alloc_group_minor" title='vfio_alloc_group_minor' data-type='int vfio_alloc_group_minor(struct vfio_group * group)' data-ref="vfio_alloc_group_minor">vfio_alloc_group_minor</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col0 decl" id="20group" title='group' data-type='struct vfio_group *' data-ref="20group">group</dfn>)</td></tr>
<tr><th id="274">274</th><td>{</td></tr>
<tr><th id="275">275</th><td>	<b>return</b> <a class="ref fn" href="../../include/linux/idr.h.html#idr_alloc" title='idr_alloc' data-ref="idr_alloc">idr_alloc</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_idr" title='vfio::group_idr' data-use='a' data-ref="vfio::group_idr">group_idr</a>, <a class="local col0 ref" href="#20group" title='group' data-ref="20group">group</a>, <var>0</var>, <a class="macro" href="../../include/linux/kdev_t.h.html#8" title="((1U &lt;&lt; 20) - 1)" data-ref="_M/MINORMASK">MINORMASK</a> + <var>1</var>, <a class="macro" href="../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x200000u|0x400000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="276">276</th><td>}</td></tr>
<tr><th id="277">277</th><td></td></tr>
<tr><th id="278">278</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_free_group_minor" title='vfio_free_group_minor' data-type='void vfio_free_group_minor(int minor)' data-ref="vfio_free_group_minor">vfio_free_group_minor</dfn>(<em>int</em> <dfn class="local col1 decl" id="21minor" title='minor' data-type='int' data-ref="21minor">minor</dfn>)</td></tr>
<tr><th id="279">279</th><td>{</td></tr>
<tr><th id="280">280</th><td>	<a class="ref fn" href="../../include/linux/idr.h.html#idr_remove" title='idr_remove' data-ref="idr_remove">idr_remove</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_idr" title='vfio::group_idr' data-use='a' data-ref="vfio::group_idr">group_idr</a>, <a class="local col1 ref" href="#21minor" title='minor' data-ref="21minor">minor</a>);</td></tr>
<tr><th id="281">281</th><td>}</td></tr>
<tr><th id="282">282</th><td></td></tr>
<tr><th id="283">283</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#vfio_iommu_group_notifier" title='vfio_iommu_group_notifier' data-type='int vfio_iommu_group_notifier(struct notifier_block * nb, unsigned long action, void * data)' data-ref="vfio_iommu_group_notifier">vfio_iommu_group_notifier</a>(<b>struct</b> <a class="type" href="../../include/linux/notifier.h.html#notifier_block" title='notifier_block' data-ref="notifier_block">notifier_block</a> *<dfn class="local col2 decl" id="22nb" title='nb' data-type='struct notifier_block *' data-ref="22nb">nb</dfn>,</td></tr>
<tr><th id="284">284</th><td>				     <em>unsigned</em> <em>long</em> <dfn class="local col3 decl" id="23action" title='action' data-type='unsigned long' data-ref="23action">action</dfn>, <em>void</em> *<dfn class="local col4 decl" id="24data" title='data' data-type='void *' data-ref="24data">data</dfn>);</td></tr>
<tr><th id="285">285</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#vfio_group_get" title='vfio_group_get' data-type='void vfio_group_get(struct vfio_group * group)' data-ref="vfio_group_get">vfio_group_get</a>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col5 decl" id="25group" title='group' data-type='struct vfio_group *' data-ref="25group">group</dfn>);</td></tr>
<tr><th id="286">286</th><td></td></tr>
<tr><th id="287">287</th><td><i class="doc" data-doc="vfio_container_get">/**</i></td></tr>
<tr><th id="288">288</th><td><i class="doc" data-doc="vfio_container_get"> * Container objects - containers are created when /dev/vfio/vfio is</i></td></tr>
<tr><th id="289">289</th><td><i class="doc" data-doc="vfio_container_get"> * opened, but their lifecycle extends until the last user is done, so</i></td></tr>
<tr><th id="290">290</th><td><i class="doc" data-doc="vfio_container_get"> * it's freed via kref.  Must support container/group/device being</i></td></tr>
<tr><th id="291">291</th><td><i class="doc" data-doc="vfio_container_get"> * closed in any order.</i></td></tr>
<tr><th id="292">292</th><td><i class="doc" data-doc="vfio_container_get"> */</i></td></tr>
<tr><th id="293">293</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_container_get" title='vfio_container_get' data-type='void vfio_container_get(struct vfio_container * container)' data-ref="vfio_container_get">vfio_container_get</dfn>(<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col6 decl" id="26container" title='container' data-type='struct vfio_container *' data-ref="26container">container</dfn>)</td></tr>
<tr><th id="294">294</th><td>{</td></tr>
<tr><th id="295">295</th><td>	<a class="ref fn" href="../../include/linux/kref.h.html#kref_get" title='kref_get' data-ref="kref_get">kref_get</a>(&amp;<a class="local col6 ref" href="#26container" title='container' data-ref="26container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::kref" title='vfio_container::kref' data-use='a' data-ref="vfio_container::kref">kref</a>);</td></tr>
<tr><th id="296">296</th><td>}</td></tr>
<tr><th id="297">297</th><td></td></tr>
<tr><th id="298">298</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_container_release" title='vfio_container_release' data-type='void vfio_container_release(struct kref * kref)' data-ref="vfio_container_release">vfio_container_release</dfn>(<b>struct</b> <a class="type" href="../../include/linux/kref.h.html#kref" title='kref' data-ref="kref">kref</a> *<dfn class="local col7 decl" id="27kref" title='kref' data-type='struct kref *' data-ref="27kref">kref</dfn>)</td></tr>
<tr><th id="299">299</th><td>{</td></tr>
<tr><th id="300">300</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col8 decl" id="28container" title='container' data-type='struct vfio_container *' data-ref="28container">container</dfn>;</td></tr>
<tr><th id="301">301</th><td>	<a class="local col8 ref" href="#28container" title='container' data-ref="28container">container</a> = <a class="macro" href="../../include/linux/kernel.h.html#962" title="({ void *__mptr = (void *)(kref); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(kref)), typeof(((struct vfio_container *)0)-&gt;kref)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(kref)), typeof(void)))); extern void __compiletime_assert_301(void) ; if (__cond) __compiletime_assert_301(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vfio_container *)(__mptr - __builtin_offsetof(struct vfio_container, kref))); })" data-ref="_M/container_of">container_of</a>(<a class="local col7 ref" href="#27kref" title='kref' data-ref="27kref">kref</a>, <b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a>, <a class="tu ref field" href="#vfio_container::kref" title='vfio_container::kref' data-use='r' data-ref="vfio_container::kref">kref</a>);</td></tr>
<tr><th id="302">302</th><td></td></tr>
<tr><th id="303">303</th><td>	<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col8 ref" href="#28container" title='container' data-ref="28container">container</a>);</td></tr>
<tr><th id="304">304</th><td>}</td></tr>
<tr><th id="305">305</th><td></td></tr>
<tr><th id="306">306</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_container_put" title='vfio_container_put' data-type='void vfio_container_put(struct vfio_container * container)' data-ref="vfio_container_put">vfio_container_put</dfn>(<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col9 decl" id="29container" title='container' data-type='struct vfio_container *' data-ref="29container">container</dfn>)</td></tr>
<tr><th id="307">307</th><td>{</td></tr>
<tr><th id="308">308</th><td>	<a class="ref fn" href="../../include/linux/kref.h.html#kref_put" title='kref_put' data-ref="kref_put">kref_put</a>(&amp;<a class="local col9 ref" href="#29container" title='container' data-ref="29container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::kref" title='vfio_container::kref' data-use='a' data-ref="vfio_container::kref">kref</a>, <a class="tu ref fn" href="#vfio_container_release" title='vfio_container_release' data-use='r' data-ref="vfio_container_release">vfio_container_release</a>);</td></tr>
<tr><th id="309">309</th><td>}</td></tr>
<tr><th id="310">310</th><td></td></tr>
<tr><th id="311">311</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_group_unlock_and_free" title='vfio_group_unlock_and_free' data-type='void vfio_group_unlock_and_free(struct vfio_group * group)' data-ref="vfio_group_unlock_and_free">vfio_group_unlock_and_free</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col0 decl" id="30group" title='group' data-type='struct vfio_group *' data-ref="30group">group</dfn>)</td></tr>
<tr><th id="312">312</th><td>{</td></tr>
<tr><th id="313">313</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="314">314</th><td>	<i>/*</i></td></tr>
<tr><th id="315">315</th><td><i>	 * Unregister outside of lock.  A spurious callback is harmless now</i></td></tr>
<tr><th id="316">316</th><td><i>	 * that the group is no longer in vfio.group_list.</i></td></tr>
<tr><th id="317">317</th><td><i>	 */</i></td></tr>
<tr><th id="318">318</th><td>	<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_unregister_notifier" title='iommu_group_unregister_notifier' data-ref="iommu_group_unregister_notifier">iommu_group_unregister_notifier</a>(<a class="local col0 ref" href="#30group" title='group' data-ref="30group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>, &amp;<a class="local col0 ref" href="#30group" title='group' data-ref="30group">group</a>-&gt;<a class="ref field" href="#vfio_group::nb" title='vfio_group::nb' data-ref="vfio_group::nb">nb</a>);</td></tr>
<tr><th id="319">319</th><td>	<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col0 ref" href="#30group" title='group' data-ref="30group">group</a>);</td></tr>
<tr><th id="320">320</th><td>}</td></tr>
<tr><th id="321">321</th><td></td></tr>
<tr><th id="322">322</th><td><i class="doc" data-doc="vfio_create_group">/**</i></td></tr>
<tr><th id="323">323</th><td><i class="doc" data-doc="vfio_create_group"> * Group objects - create, release, get, put, search</i></td></tr>
<tr><th id="324">324</th><td><i class="doc" data-doc="vfio_create_group"> */</i></td></tr>
<tr><th id="325">325</th><td><em>static</em> <b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="tu decl def fn" id="vfio_create_group" title='vfio_create_group' data-type='struct vfio_group * vfio_create_group(struct iommu_group * iommu_group)' data-ref="vfio_create_group">vfio_create_group</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#iommu_group" title='iommu_group' data-ref="iommu_group">iommu_group</a> *<dfn class="local col1 decl" id="31iommu_group" title='iommu_group' data-type='struct iommu_group *' data-ref="31iommu_group">iommu_group</dfn>)</td></tr>
<tr><th id="326">326</th><td>{</td></tr>
<tr><th id="327">327</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col2 decl" id="32group" title='group' data-type='struct vfio_group *' data-ref="32group">group</dfn>, *<dfn class="local col3 decl" id="33tmp" title='tmp' data-type='struct vfio_group *' data-ref="33tmp">tmp</dfn>;</td></tr>
<tr><th id="328">328</th><td>	<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col4 decl" id="34dev" title='dev' data-type='struct device *' data-ref="34dev">dev</dfn>;</td></tr>
<tr><th id="329">329</th><td>	<em>int</em> <dfn class="local col5 decl" id="35ret" title='ret' data-type='int' data-ref="35ret">ret</dfn>, <dfn class="local col6 decl" id="36minor" title='minor' data-type='int' data-ref="36minor">minor</dfn>;</td></tr>
<tr><th id="330">330</th><td></td></tr>
<tr><th id="331">331</th><td>	<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a> = <a class="ref fn" href="../../include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc">kzalloc</a>(<b>sizeof</b>(*<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>), <a class="macro" href="../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x200000u|0x400000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="332">332</th><td>	<b>if</b> (!<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>)</td></tr>
<tr><th id="333">333</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="334">334</th><td></td></tr>
<tr><th id="335">335</th><td>	<a class="ref fn" href="../../include/linux/kref.h.html#kref_init" title='kref_init' data-ref="kref_init">kref_init</a>(&amp;<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::kref" title='vfio_group::kref' data-ref="vfio_group::kref">kref</a>);</td></tr>
<tr><th id="336">336</th><td>	<a class="ref fn" href="../../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_list" title='vfio_group::device_list' data-ref="vfio_group::device_list">device_list</a>);</td></tr>
<tr><th id="337">337</th><td>	<a class="macro" href="../../include/linux/mutex.h.html#114" title="do { static struct lock_class_key __key; __mutex_init((&amp;group-&gt;device_lock), &quot;&amp;group-&gt;device_lock&quot;, &amp;__key); } while (0)" data-ref="_M/mutex_init">mutex_init</a>(&amp;<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_lock" title='vfio_group::device_lock' data-ref="vfio_group::device_lock">device_lock</a>);</td></tr>
<tr><th id="338">338</th><td>	<a class="ref fn" href="../../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::unbound_list" title='vfio_group::unbound_list' data-ref="vfio_group::unbound_list">unbound_list</a>);</td></tr>
<tr><th id="339">339</th><td>	<a class="macro" href="../../include/linux/mutex.h.html#114" title="do { static struct lock_class_key __key; __mutex_init((&amp;group-&gt;unbound_lock), &quot;&amp;group-&gt;unbound_lock&quot;, &amp;__key); } while (0)" data-ref="_M/mutex_init">mutex_init</a>(&amp;<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::unbound_lock" title='vfio_group::unbound_lock' data-ref="vfio_group::unbound_lock">unbound_lock</a>);</td></tr>
<tr><th id="340">340</th><td>	<a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_set" title='atomic_set' data-ref="atomic_set">atomic_set</a>(&amp;<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</a>, <var>0</var>);</td></tr>
<tr><th id="341">341</th><td>	<a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_set" title='atomic_set' data-ref="atomic_set">atomic_set</a>(&amp;<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::opened" title='vfio_group::opened' data-ref="vfio_group::opened">opened</a>, <var>0</var>);</td></tr>
<tr><th id="342">342</th><td>	<a class="macro" href="../../include/linux/wait.h.html#63" title="do { static struct lock_class_key __key; __init_waitqueue_head((&amp;group-&gt;container_q), &quot;&amp;group-&gt;container_q&quot;, &amp;__key); } while (0)" data-ref="_M/init_waitqueue_head">init_waitqueue_head</a>(&amp;<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_q" title='vfio_group::container_q' data-ref="vfio_group::container_q">container_q</a>);</td></tr>
<tr><th id="343">343</th><td>	<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a> = <a class="local col1 ref" href="#31iommu_group" title='iommu_group' data-ref="31iommu_group">iommu_group</a>;</td></tr>
<tr><th id="344">344</th><td><u>#<span data-ppcond="344">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#156" data-ref="_M/CONFIG_VFIO_NOIOMMU">CONFIG_VFIO_NOIOMMU</a></u></td></tr>
<tr><th id="345">345</th><td>	<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::noiommu" title='vfio_group::noiommu' data-ref="vfio_group::noiommu">noiommu</a> = (<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_get_iommudata" title='iommu_group_get_iommudata' data-ref="iommu_group_get_iommudata">iommu_group_get_iommudata</a>(<a class="local col1 ref" href="#31iommu_group" title='iommu_group' data-ref="31iommu_group">iommu_group</a>) == &amp;<a class="tu ref" href="#noiommu" title='noiommu' data-use='a' data-ref="noiommu">noiommu</a>);</td></tr>
<tr><th id="346">346</th><td><u>#<span data-ppcond="344">endif</span></u></td></tr>
<tr><th id="347">347</th><td>	<a class="macro" href="../../include/linux/notifier.h.html#84" title="do { do { static struct lock_class_key __key; __init_rwsem((&amp;(&amp;group-&gt;notifier)-&gt;rwsem), &quot;&amp;(&amp;group-&gt;notifier)-&gt;rwsem&quot;, &amp;__key); } while (0); (&amp;group-&gt;notifier)-&gt;head = ((void *)0); } while (0)" data-ref="_M/BLOCKING_INIT_NOTIFIER_HEAD">BLOCKING_INIT_NOTIFIER_HEAD</a>(&amp;<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::notifier" title='vfio_group::notifier' data-ref="vfio_group::notifier">notifier</a>);</td></tr>
<tr><th id="348">348</th><td></td></tr>
<tr><th id="349">349</th><td>	<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::nb" title='vfio_group::nb' data-ref="vfio_group::nb">nb</a>.<a class="ref field" href="../../include/linux/notifier.h.html#notifier_block::notifier_call" title='notifier_block::notifier_call' data-ref="notifier_block::notifier_call">notifier_call</a> = <a class="tu ref fn" href="#vfio_iommu_group_notifier" title='vfio_iommu_group_notifier' data-use='r' data-ref="vfio_iommu_group_notifier">vfio_iommu_group_notifier</a>;</td></tr>
<tr><th id="350">350</th><td></td></tr>
<tr><th id="351">351</th><td>	<i>/*</i></td></tr>
<tr><th id="352">352</th><td><i>	 * blocking notifiers acquire a rwsem around registering and hold</i></td></tr>
<tr><th id="353">353</th><td><i>	 * it around callback.  Therefore, need to register outside of</i></td></tr>
<tr><th id="354">354</th><td><i>	 * vfio.group_lock to avoid A-B/B-A contention.  Our callback won't</i></td></tr>
<tr><th id="355">355</th><td><i>	 * do anything unless it can find the group in vfio.group_list, so</i></td></tr>
<tr><th id="356">356</th><td><i>	 * no harm in registering early.</i></td></tr>
<tr><th id="357">357</th><td><i>	 */</i></td></tr>
<tr><th id="358">358</th><td>	<a class="local col5 ref" href="#35ret" title='ret' data-ref="35ret">ret</a> = <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_register_notifier" title='iommu_group_register_notifier' data-ref="iommu_group_register_notifier">iommu_group_register_notifier</a>(<a class="local col1 ref" href="#31iommu_group" title='iommu_group' data-ref="31iommu_group">iommu_group</a>, &amp;<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::nb" title='vfio_group::nb' data-ref="vfio_group::nb">nb</a>);</td></tr>
<tr><th id="359">359</th><td>	<b>if</b> (<a class="local col5 ref" href="#35ret" title='ret' data-ref="35ret">ret</a>) {</td></tr>
<tr><th id="360">360</th><td>		<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>);</td></tr>
<tr><th id="361">361</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR">ERR_PTR</a>(<a class="local col5 ref" href="#35ret" title='ret' data-ref="35ret">ret</a>);</td></tr>
<tr><th id="362">362</th><td>	}</td></tr>
<tr><th id="363">363</th><td></td></tr>
<tr><th id="364">364</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="365">365</th><td></td></tr>
<tr><th id="366">366</th><td>	<i>/* Did we race creating this group? */</i></td></tr>
<tr><th id="367">367</th><td>	<a class="macro" href="../../include/linux/list.h.html#463" title="for (tmp = ({ void *__mptr = (void *)((&amp;vfio.group_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;vfio.group_list)-&gt;next)), typeof(((typeof(*tmp) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;vfio.group_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_367(void) ; if (__cond) __compiletime_assert_367(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*tmp) *)(__mptr - __builtin_offsetof(typeof(*tmp), vfio_next))); }); &amp;tmp-&gt;vfio_next != (&amp;vfio.group_list); tmp = ({ void *__mptr = (void *)((tmp)-&gt;vfio_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((tmp)-&gt;vfio_next.next)), typeof(((typeof(*(tmp)) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((tmp)-&gt;vfio_next.next)), typeof(void)))); extern void __compiletime_assert_367(void) ; if (__cond) __compiletime_assert_367(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(tmp)) *)(__mptr - __builtin_offsetof(typeof(*(tmp)), vfio_next))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col3 ref" href="#33tmp" title='tmp' data-ref="33tmp">tmp</a>, &amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_list" title='vfio::group_list' data-use='a' data-ref="vfio::group_list">group_list</a>, <a class="ref field" href="#vfio_group::vfio_next" title='vfio_group::vfio_next' data-ref="vfio_group::vfio_next">vfio_next</a>) {</td></tr>
<tr><th id="368">368</th><td>		<b>if</b> (<a class="local col3 ref" href="#33tmp" title='tmp' data-ref="33tmp">tmp</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a> == <a class="local col1 ref" href="#31iommu_group" title='iommu_group' data-ref="31iommu_group">iommu_group</a>) {</td></tr>
<tr><th id="369">369</th><td>			<a class="tu ref fn" href="#vfio_group_get" title='vfio_group_get' data-use='c' data-ref="vfio_group_get">vfio_group_get</a>(<a class="local col3 ref" href="#33tmp" title='tmp' data-ref="33tmp">tmp</a>);</td></tr>
<tr><th id="370">370</th><td>			<a class="tu ref fn" href="#vfio_group_unlock_and_free" title='vfio_group_unlock_and_free' data-use='c' data-ref="vfio_group_unlock_and_free">vfio_group_unlock_and_free</a>(<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>);</td></tr>
<tr><th id="371">371</th><td>			<b>return</b> <a class="local col3 ref" href="#33tmp" title='tmp' data-ref="33tmp">tmp</a>;</td></tr>
<tr><th id="372">372</th><td>		}</td></tr>
<tr><th id="373">373</th><td>	}</td></tr>
<tr><th id="374">374</th><td></td></tr>
<tr><th id="375">375</th><td>	<a class="local col6 ref" href="#36minor" title='minor' data-ref="36minor">minor</a> = <a class="tu ref fn" href="#vfio_alloc_group_minor" title='vfio_alloc_group_minor' data-use='c' data-ref="vfio_alloc_group_minor">vfio_alloc_group_minor</a>(<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>);</td></tr>
<tr><th id="376">376</th><td>	<b>if</b> (<a class="local col6 ref" href="#36minor" title='minor' data-ref="36minor">minor</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="377">377</th><td>		<a class="tu ref fn" href="#vfio_group_unlock_and_free" title='vfio_group_unlock_and_free' data-use='c' data-ref="vfio_group_unlock_and_free">vfio_group_unlock_and_free</a>(<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>);</td></tr>
<tr><th id="378">378</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR">ERR_PTR</a>(<a class="local col6 ref" href="#36minor" title='minor' data-ref="36minor">minor</a>);</td></tr>
<tr><th id="379">379</th><td>	}</td></tr>
<tr><th id="380">380</th><td></td></tr>
<tr><th id="381">381</th><td>	<a class="local col4 ref" href="#34dev" title='dev' data-ref="34dev">dev</a> = <a class="ref fn" href="../../include/linux/device.h.html#device_create" title='device_create' data-ref="device_create">device_create</a>(<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::class" title='vfio::class' data-use='r' data-ref="vfio::class">class</a>, <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>,</td></tr>
<tr><th id="382">382</th><td>			    <a class="macro" href="../../include/linux/kdev_t.h.html#12" title="(((((unsigned int) ((vfio.group_devt) &gt;&gt; 20))) &lt;&lt; 20) | (minor))" data-ref="_M/MKDEV">MKDEV</a>(<a class="macro" href="../../include/linux/kdev_t.h.html#10" title="((unsigned int) ((vfio.group_devt) &gt;&gt; 20))" data-ref="_M/MAJOR">MAJOR</a>(<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_devt" title='vfio::group_devt' data-use='r' data-ref="vfio::group_devt">group_devt</a>), <a class="local col6 ref" href="#36minor" title='minor' data-ref="36minor">minor</a>),</td></tr>
<tr><th id="383">383</th><td>			    <a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>, <q>"%s%d"</q>, <a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::noiommu" title='vfio_group::noiommu' data-ref="vfio_group::noiommu">noiommu</a> ? <q>"noiommu-"</q> : <q>""</q>,</td></tr>
<tr><th id="384">384</th><td>			    <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_id" title='iommu_group_id' data-ref="iommu_group_id">iommu_group_id</a>(<a class="local col1 ref" href="#31iommu_group" title='iommu_group' data-ref="31iommu_group">iommu_group</a>));</td></tr>
<tr><th id="385">385</th><td>	<b>if</b> (<a class="ref fn" href="../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="local col4 ref" href="#34dev" title='dev' data-ref="34dev">dev</a>)) {</td></tr>
<tr><th id="386">386</th><td>		<a class="tu ref fn" href="#vfio_free_group_minor" title='vfio_free_group_minor' data-use='c' data-ref="vfio_free_group_minor">vfio_free_group_minor</a>(<a class="local col6 ref" href="#36minor" title='minor' data-ref="36minor">minor</a>);</td></tr>
<tr><th id="387">387</th><td>		<a class="tu ref fn" href="#vfio_group_unlock_and_free" title='vfio_group_unlock_and_free' data-use='c' data-ref="vfio_group_unlock_and_free">vfio_group_unlock_and_free</a>(<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>);</td></tr>
<tr><th id="388">388</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#ERR_CAST" title='ERR_CAST' data-ref="ERR_CAST">ERR_CAST</a>(<a class="local col4 ref" href="#34dev" title='dev' data-ref="34dev">dev</a>);</td></tr>
<tr><th id="389">389</th><td>	}</td></tr>
<tr><th id="390">390</th><td></td></tr>
<tr><th id="391">391</th><td>	<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::minor" title='vfio_group::minor' data-ref="vfio_group::minor">minor</a> = <a class="local col6 ref" href="#36minor" title='minor' data-ref="36minor">minor</a>;</td></tr>
<tr><th id="392">392</th><td>	<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::dev" title='vfio_group::dev' data-ref="vfio_group::dev">dev</a> = <a class="local col4 ref" href="#34dev" title='dev' data-ref="34dev">dev</a>;</td></tr>
<tr><th id="393">393</th><td></td></tr>
<tr><th id="394">394</th><td>	<a class="ref fn" href="../../include/linux/list.h.html#list_add" title='list_add' data-ref="list_add">list_add</a>(&amp;<a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>-&gt;<a class="ref field" href="#vfio_group::vfio_next" title='vfio_group::vfio_next' data-ref="vfio_group::vfio_next">vfio_next</a>, &amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_list" title='vfio::group_list' data-use='a' data-ref="vfio::group_list">group_list</a>);</td></tr>
<tr><th id="395">395</th><td></td></tr>
<tr><th id="396">396</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="397">397</th><td></td></tr>
<tr><th id="398">398</th><td>	<b>return</b> <a class="local col2 ref" href="#32group" title='group' data-ref="32group">group</a>;</td></tr>
<tr><th id="399">399</th><td>}</td></tr>
<tr><th id="400">400</th><td></td></tr>
<tr><th id="401">401</th><td><i  data-doc="vfio_group_release">/* called with vfio.group_lock held */</i></td></tr>
<tr><th id="402">402</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_group_release" title='vfio_group_release' data-type='void vfio_group_release(struct kref * kref)' data-ref="vfio_group_release">vfio_group_release</dfn>(<b>struct</b> <a class="type" href="../../include/linux/kref.h.html#kref" title='kref' data-ref="kref">kref</a> *<dfn class="local col7 decl" id="37kref" title='kref' data-type='struct kref *' data-ref="37kref">kref</dfn>)</td></tr>
<tr><th id="403">403</th><td>{</td></tr>
<tr><th id="404">404</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col8 decl" id="38group" title='group' data-type='struct vfio_group *' data-ref="38group">group</dfn> = <a class="macro" href="../../include/linux/kernel.h.html#962" title="({ void *__mptr = (void *)(kref); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(kref)), typeof(((struct vfio_group *)0)-&gt;kref)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(kref)), typeof(void)))); extern void __compiletime_assert_404(void) ; if (__cond) __compiletime_assert_404(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vfio_group *)(__mptr - __builtin_offsetof(struct vfio_group, kref))); })" data-ref="_M/container_of">container_of</a>(<a class="local col7 ref" href="#37kref" title='kref' data-ref="37kref">kref</a>, <b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a>, <a class="ref field" href="#vfio_group::kref" title='vfio_group::kref' data-ref="vfio_group::kref">kref</a>);</td></tr>
<tr><th id="405">405</th><td>	<b>struct</b> <a class="type" href="#vfio_unbound_dev" title='vfio_unbound_dev' data-ref="vfio_unbound_dev">vfio_unbound_dev</a> *<dfn class="local col9 decl" id="39unbound" title='unbound' data-type='struct vfio_unbound_dev *' data-ref="39unbound">unbound</dfn>, *<dfn class="local col0 decl" id="40tmp" title='tmp' data-type='struct vfio_unbound_dev *' data-ref="40tmp">tmp</dfn>;</td></tr>
<tr><th id="406">406</th><td>	<b>struct</b> <a class="type" href="../../include/linux/device.h.html#iommu_group" title='iommu_group' data-ref="iommu_group">iommu_group</a> *<dfn class="local col1 decl" id="41iommu_group" title='iommu_group' data-type='struct iommu_group *' data-ref="41iommu_group">iommu_group</dfn> = <a class="local col8 ref" href="#38group" title='group' data-ref="38group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>;</td></tr>
<tr><th id="407">407</th><td></td></tr>
<tr><th id="408">408</th><td>	<a class="macro" href="../../include/asm-generic/bug.h.html#111" title="({ int __ret_warn_on = !!(!list_empty(&amp;group-&gt;device_list)); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/drivers/vfio/vfio.c&quot;), &quot;i&quot; (408), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (66)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="ref fn" href="../../include/linux/list.h.html#list_empty" title='list_empty' data-ref="list_empty">list_empty</a>(&amp;<a class="local col8 ref" href="#38group" title='group' data-ref="38group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_list" title='vfio_group::device_list' data-ref="vfio_group::device_list">device_list</a>));</td></tr>
<tr><th id="409">409</th><td>	<a class="macro" href="../../include/asm-generic/bug.h.html#111" title="({ int __ret_warn_on = !!(group-&gt;notifier.head); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/drivers/vfio/vfio.c&quot;), &quot;i&quot; (409), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (68)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="local col8 ref" href="#38group" title='group' data-ref="38group">group</a>-&gt;<a class="ref field" href="#vfio_group::notifier" title='vfio_group::notifier' data-ref="vfio_group::notifier">notifier</a>.<a class="ref field" href="../../include/linux/notifier.h.html#blocking_notifier_head::head" title='blocking_notifier_head::head' data-ref="blocking_notifier_head::head">head</a>);</td></tr>
<tr><th id="410">410</th><td></td></tr>
<tr><th id="411">411</th><td>	<a class="macro" href="../../include/linux/list.h.html#550" title="for (unbound = ({ void *__mptr = (void *)((&amp;group-&gt;unbound_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;group-&gt;unbound_list)-&gt;next)), typeof(((typeof(*unbound) *)0)-&gt;unbound_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;group-&gt;unbound_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_412(void) ; if (__cond) __compiletime_assert_412(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*unbound) *)(__mptr - __builtin_offsetof(typeof(*unbound), unbound_next))); }), tmp = ({ void *__mptr = (void *)((unbound)-&gt;unbound_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((unbound)-&gt;unbound_next.next)), typeof(((typeof(*(unbound)) *)0)-&gt;unbound_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((unbound)-&gt;unbound_next.next)), typeof(void)))); extern void __compiletime_assert_412(void) ; if (__cond) __compiletime_assert_412(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(unbound)) *)(__mptr - __builtin_offsetof(typeof(*(unbound)), unbound_next))); }); &amp;unbound-&gt;unbound_next != (&amp;group-&gt;unbound_list); unbound = tmp, tmp = ({ void *__mptr = (void *)((tmp)-&gt;unbound_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((tmp)-&gt;unbound_next.next)), typeof(((typeof(*(tmp)) *)0)-&gt;unbound_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((tmp)-&gt;unbound_next.next)), typeof(void)))); extern void __compiletime_assert_412(void) ; if (__cond) __compiletime_assert_412(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(tmp)) *)(__mptr - __builtin_offsetof(typeof(*(tmp)), unbound_next))); }))" data-ref="_M/list_for_each_entry_safe">list_for_each_entry_safe</a>(<a class="local col9 ref" href="#39unbound" title='unbound' data-ref="39unbound">unbound</a>, <a class="local col0 ref" href="#40tmp" title='tmp' data-ref="40tmp">tmp</a>,</td></tr>
<tr><th id="412">412</th><td>				 &amp;<a class="local col8 ref" href="#38group" title='group' data-ref="38group">group</a>-&gt;<a class="ref field" href="#vfio_group::unbound_list" title='vfio_group::unbound_list' data-ref="vfio_group::unbound_list">unbound_list</a>, <a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='r' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='m' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='m' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='m' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='a' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='m' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='m' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='m' data-ref="vfio_unbound_dev::unbound_next">unbound_next</a></a></a></a></a></a></a></a>) {</td></tr>
<tr><th id="413">413</th><td>		<a class="ref fn" href="../../include/linux/list.h.html#list_del" title='list_del' data-ref="list_del">list_del</a>(&amp;<a class="local col9 ref" href="#39unbound" title='unbound' data-ref="39unbound">unbound</a>-&gt;<a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='a' data-ref="vfio_unbound_dev::unbound_next">unbound_next</a>);</td></tr>
<tr><th id="414">414</th><td>		<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col9 ref" href="#39unbound" title='unbound' data-ref="39unbound">unbound</a>);</td></tr>
<tr><th id="415">415</th><td>	}</td></tr>
<tr><th id="416">416</th><td></td></tr>
<tr><th id="417">417</th><td>	<a class="ref fn" href="../../include/linux/device.h.html#device_destroy" title='device_destroy' data-ref="device_destroy">device_destroy</a>(<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::class" title='vfio::class' data-use='r' data-ref="vfio::class">class</a>, <a class="macro" href="../../include/linux/kdev_t.h.html#12" title="(((((unsigned int) ((vfio.group_devt) &gt;&gt; 20))) &lt;&lt; 20) | (group-&gt;minor))" data-ref="_M/MKDEV">MKDEV</a>(<a class="macro" href="../../include/linux/kdev_t.h.html#10" title="((unsigned int) ((vfio.group_devt) &gt;&gt; 20))" data-ref="_M/MAJOR">MAJOR</a>(<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_devt" title='vfio::group_devt' data-use='r' data-ref="vfio::group_devt">group_devt</a>), <a class="local col8 ref" href="#38group" title='group' data-ref="38group">group</a>-&gt;<a class="ref field" href="#vfio_group::minor" title='vfio_group::minor' data-ref="vfio_group::minor">minor</a>));</td></tr>
<tr><th id="418">418</th><td>	<a class="ref fn" href="../../include/linux/list.h.html#list_del" title='list_del' data-ref="list_del">list_del</a>(&amp;<a class="local col8 ref" href="#38group" title='group' data-ref="38group">group</a>-&gt;<a class="ref field" href="#vfio_group::vfio_next" title='vfio_group::vfio_next' data-ref="vfio_group::vfio_next">vfio_next</a>);</td></tr>
<tr><th id="419">419</th><td>	<a class="tu ref fn" href="#vfio_free_group_minor" title='vfio_free_group_minor' data-use='c' data-ref="vfio_free_group_minor">vfio_free_group_minor</a>(<a class="local col8 ref" href="#38group" title='group' data-ref="38group">group</a>-&gt;<a class="ref field" href="#vfio_group::minor" title='vfio_group::minor' data-ref="vfio_group::minor">minor</a>);</td></tr>
<tr><th id="420">420</th><td>	<a class="tu ref fn" href="#vfio_group_unlock_and_free" title='vfio_group_unlock_and_free' data-use='c' data-ref="vfio_group_unlock_and_free">vfio_group_unlock_and_free</a>(<a class="local col8 ref" href="#38group" title='group' data-ref="38group">group</a>);</td></tr>
<tr><th id="421">421</th><td>	<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_put" title='iommu_group_put' data-ref="iommu_group_put">iommu_group_put</a>(<a class="local col1 ref" href="#41iommu_group" title='iommu_group' data-ref="41iommu_group">iommu_group</a>);</td></tr>
<tr><th id="422">422</th><td>}</td></tr>
<tr><th id="423">423</th><td></td></tr>
<tr><th id="424">424</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_group_put" title='vfio_group_put' data-type='void vfio_group_put(struct vfio_group * group)' data-ref="vfio_group_put">vfio_group_put</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col2 decl" id="42group" title='group' data-type='struct vfio_group *' data-ref="42group">group</dfn>)</td></tr>
<tr><th id="425">425</th><td>{</td></tr>
<tr><th id="426">426</th><td>	<a class="ref fn" href="../../include/linux/kref.h.html#kref_put_mutex" title='kref_put_mutex' data-ref="kref_put_mutex">kref_put_mutex</a>(&amp;<a class="local col2 ref" href="#42group" title='group' data-ref="42group">group</a>-&gt;<a class="ref field" href="#vfio_group::kref" title='vfio_group::kref' data-ref="vfio_group::kref">kref</a>, <a class="tu ref fn" href="#vfio_group_release" title='vfio_group_release' data-use='r' data-ref="vfio_group_release">vfio_group_release</a>, &amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="427">427</th><td>}</td></tr>
<tr><th id="428">428</th><td></td></tr>
<tr><th id="429">429</th><td><b>struct</b> <dfn class="type def" id="vfio_group_put_work" title='vfio_group_put_work' data-ref="vfio_group_put_work">vfio_group_put_work</dfn> {</td></tr>
<tr><th id="430">430</th><td>	<b>struct</b> <a class="type" href="../../include/linux/workqueue.h.html#work_struct" title='work_struct' data-ref="work_struct">work_struct</a> <dfn class="tu decl field" id="vfio_group_put_work::work" title='vfio_group_put_work::work' data-type='struct work_struct' data-ref="vfio_group_put_work::work">work</dfn>;</td></tr>
<tr><th id="431">431</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="tu decl field" id="vfio_group_put_work::group" title='vfio_group_put_work::group' data-type='struct vfio_group *' data-ref="vfio_group_put_work::group">group</dfn>;</td></tr>
<tr><th id="432">432</th><td>};</td></tr>
<tr><th id="433">433</th><td></td></tr>
<tr><th id="434">434</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_group_put_bg" title='vfio_group_put_bg' data-type='void vfio_group_put_bg(struct work_struct * work)' data-ref="vfio_group_put_bg">vfio_group_put_bg</dfn>(<b>struct</b> <a class="type" href="../../include/linux/workqueue.h.html#work_struct" title='work_struct' data-ref="work_struct">work_struct</a> *<dfn class="local col3 decl" id="43work" title='work' data-type='struct work_struct *' data-ref="43work">work</dfn>)</td></tr>
<tr><th id="435">435</th><td>{</td></tr>
<tr><th id="436">436</th><td>	<b>struct</b> <a class="type" href="#vfio_group_put_work" title='vfio_group_put_work' data-ref="vfio_group_put_work">vfio_group_put_work</a> *<dfn class="local col4 decl" id="44do_work" title='do_work' data-type='struct vfio_group_put_work *' data-ref="44do_work">do_work</dfn>;</td></tr>
<tr><th id="437">437</th><td></td></tr>
<tr><th id="438">438</th><td>	<a class="local col4 ref" href="#44do_work" title='do_work' data-ref="44do_work">do_work</a> = <a class="macro" href="../../include/linux/kernel.h.html#962" title="({ void *__mptr = (void *)(work); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(work)), typeof(((struct vfio_group_put_work *)0)-&gt;work)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(work)), typeof(void)))); extern void __compiletime_assert_438(void) ; if (__cond) __compiletime_assert_438(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vfio_group_put_work *)(__mptr - __builtin_offsetof(struct vfio_group_put_work, work))); })" data-ref="_M/container_of">container_of</a>(<a class="local col3 ref" href="#43work" title='work' data-ref="43work">work</a>, <b>struct</b> <a class="type" href="#vfio_group_put_work" title='vfio_group_put_work' data-ref="vfio_group_put_work">vfio_group_put_work</a>, <a class="tu ref field" href="#vfio_group_put_work::work" title='vfio_group_put_work::work' data-use='r' data-ref="vfio_group_put_work::work">work</a>);</td></tr>
<tr><th id="439">439</th><td></td></tr>
<tr><th id="440">440</th><td>	<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col4 ref" href="#44do_work" title='do_work' data-ref="44do_work">do_work</a>-&gt;<a class="tu ref field" href="#vfio_group_put_work::group" title='vfio_group_put_work::group' data-use='r' data-ref="vfio_group_put_work::group">group</a>);</td></tr>
<tr><th id="441">441</th><td>	<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col4 ref" href="#44do_work" title='do_work' data-ref="44do_work">do_work</a>);</td></tr>
<tr><th id="442">442</th><td>}</td></tr>
<tr><th id="443">443</th><td></td></tr>
<tr><th id="444">444</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_group_schedule_put" title='vfio_group_schedule_put' data-type='void vfio_group_schedule_put(struct vfio_group * group)' data-ref="vfio_group_schedule_put">vfio_group_schedule_put</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col5 decl" id="45group" title='group' data-type='struct vfio_group *' data-ref="45group">group</dfn>)</td></tr>
<tr><th id="445">445</th><td>{</td></tr>
<tr><th id="446">446</th><td>	<b>struct</b> <a class="type" href="#vfio_group_put_work" title='vfio_group_put_work' data-ref="vfio_group_put_work">vfio_group_put_work</a> *<dfn class="local col6 decl" id="46do_work" title='do_work' data-type='struct vfio_group_put_work *' data-ref="46do_work">do_work</dfn>;</td></tr>
<tr><th id="447">447</th><td></td></tr>
<tr><th id="448">448</th><td>	<a class="local col6 ref" href="#46do_work" title='do_work' data-ref="46do_work">do_work</a> = <a class="ref fn" href="../../include/linux/slab.h.html#kmalloc" title='kmalloc' data-ref="kmalloc">kmalloc</a>(<b>sizeof</b>(*<a class="local col6 ref" href="#46do_work" title='do_work' data-ref="46do_work">do_work</a>), <a class="macro" href="../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x200000u|0x400000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="449">449</th><td>	<b>if</b> (<a class="macro" href="../../include/asm-generic/bug.h.html#111" title="({ int __ret_warn_on = !!(!do_work); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/drivers/vfio/vfio.c&quot;), &quot;i&quot; (449), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (70)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col6 ref" href="#46do_work" title='do_work' data-ref="46do_work">do_work</a>))</td></tr>
<tr><th id="450">450</th><td>		<b>return</b>;</td></tr>
<tr><th id="451">451</th><td></td></tr>
<tr><th id="452">452</th><td>	<a class="macro" href="../../include/linux/workqueue.h.html#249" title="do { __init_work(((&amp;do_work-&gt;work)), 0); ((&amp;do_work-&gt;work))-&gt;data = (atomic_long_t) { ((unsigned long)WORK_STRUCT_NO_POOL) }; INIT_LIST_HEAD(&amp;((&amp;do_work-&gt;work))-&gt;entry); ((&amp;do_work-&gt;work))-&gt;func = ((vfio_group_put_bg)); } while (0)" data-ref="_M/INIT_WORK">INIT_WORK</a>(&amp;<a class="local col6 ref" href="#46do_work" title='do_work' data-ref="46do_work">do_work</a>-&gt;<a class="tu ref field" href="#vfio_group_put_work::work" title='vfio_group_put_work::work' data-use='a' data-ref="vfio_group_put_work::work">work</a>, <a class="tu ref fn" href="#vfio_group_put_bg" title='vfio_group_put_bg' data-use='r' data-ref="vfio_group_put_bg">vfio_group_put_bg</a>);</td></tr>
<tr><th id="453">453</th><td>	<a class="local col6 ref" href="#46do_work" title='do_work' data-ref="46do_work">do_work</a>-&gt;<a class="tu ref field" href="#vfio_group_put_work::group" title='vfio_group_put_work::group' data-use='w' data-ref="vfio_group_put_work::group">group</a> = <a class="local col5 ref" href="#45group" title='group' data-ref="45group">group</a>;</td></tr>
<tr><th id="454">454</th><td>	<a class="ref fn" href="../../include/linux/workqueue.h.html#schedule_work" title='schedule_work' data-ref="schedule_work">schedule_work</a>(&amp;<a class="local col6 ref" href="#46do_work" title='do_work' data-ref="46do_work">do_work</a>-&gt;<a class="tu ref field" href="#vfio_group_put_work::work" title='vfio_group_put_work::work' data-use='a' data-ref="vfio_group_put_work::work">work</a>);</td></tr>
<tr><th id="455">455</th><td>}</td></tr>
<tr><th id="456">456</th><td></td></tr>
<tr><th id="457">457</th><td><i  data-doc="vfio_group_get">/* Assume group_lock or group reference is held */</i></td></tr>
<tr><th id="458">458</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_group_get" title='vfio_group_get' data-type='void vfio_group_get(struct vfio_group * group)' data-ref="vfio_group_get">vfio_group_get</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col7 decl" id="47group" title='group' data-type='struct vfio_group *' data-ref="47group">group</dfn>)</td></tr>
<tr><th id="459">459</th><td>{</td></tr>
<tr><th id="460">460</th><td>	<a class="ref fn" href="../../include/linux/kref.h.html#kref_get" title='kref_get' data-ref="kref_get">kref_get</a>(&amp;<a class="local col7 ref" href="#47group" title='group' data-ref="47group">group</a>-&gt;<a class="ref field" href="#vfio_group::kref" title='vfio_group::kref' data-ref="vfio_group::kref">kref</a>);</td></tr>
<tr><th id="461">461</th><td>}</td></tr>
<tr><th id="462">462</th><td></td></tr>
<tr><th id="463">463</th><td><i  data-doc="vfio_group_try_get">/*</i></td></tr>
<tr><th id="464">464</th><td><i  data-doc="vfio_group_try_get"> * Not really a try as we will sleep for mutex, but we need to make</i></td></tr>
<tr><th id="465">465</th><td><i  data-doc="vfio_group_try_get"> * sure the group pointer is valid under lock and get a reference.</i></td></tr>
<tr><th id="466">466</th><td><i  data-doc="vfio_group_try_get"> */</i></td></tr>
<tr><th id="467">467</th><td><em>static</em> <b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="tu decl def fn" id="vfio_group_try_get" title='vfio_group_try_get' data-type='struct vfio_group * vfio_group_try_get(struct vfio_group * group)' data-ref="vfio_group_try_get">vfio_group_try_get</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col8 decl" id="48group" title='group' data-type='struct vfio_group *' data-ref="48group">group</dfn>)</td></tr>
<tr><th id="468">468</th><td>{</td></tr>
<tr><th id="469">469</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col9 decl" id="49target" title='target' data-type='struct vfio_group *' data-ref="49target">target</dfn> = <a class="local col8 ref" href="#48group" title='group' data-ref="48group">group</a>;</td></tr>
<tr><th id="470">470</th><td></td></tr>
<tr><th id="471">471</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="472">472</th><td>	<a class="macro" href="../../include/linux/list.h.html#463" title="for (group = ({ void *__mptr = (void *)((&amp;vfio.group_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;vfio.group_list)-&gt;next)), typeof(((typeof(*group) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;vfio.group_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_472(void) ; if (__cond) __compiletime_assert_472(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*group) *)(__mptr - __builtin_offsetof(typeof(*group), vfio_next))); }); &amp;group-&gt;vfio_next != (&amp;vfio.group_list); group = ({ void *__mptr = (void *)((group)-&gt;vfio_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((group)-&gt;vfio_next.next)), typeof(((typeof(*(group)) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((group)-&gt;vfio_next.next)), typeof(void)))); extern void __compiletime_assert_472(void) ; if (__cond) __compiletime_assert_472(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(group)) *)(__mptr - __builtin_offsetof(typeof(*(group)), vfio_next))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col8 ref" href="#48group" title='group' data-ref="48group">group</a>, &amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_list" title='vfio::group_list' data-use='a' data-ref="vfio::group_list">group_list</a>, <a class="ref field" href="#vfio_group::vfio_next" title='vfio_group::vfio_next' data-ref="vfio_group::vfio_next">vfio_next</a>) {</td></tr>
<tr><th id="473">473</th><td>		<b>if</b> (<a class="local col8 ref" href="#48group" title='group' data-ref="48group">group</a> == <a class="local col9 ref" href="#49target" title='target' data-ref="49target">target</a>) {</td></tr>
<tr><th id="474">474</th><td>			<a class="tu ref fn" href="#vfio_group_get" title='vfio_group_get' data-use='c' data-ref="vfio_group_get">vfio_group_get</a>(<a class="local col8 ref" href="#48group" title='group' data-ref="48group">group</a>);</td></tr>
<tr><th id="475">475</th><td>			<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="476">476</th><td>			<b>return</b> <a class="local col8 ref" href="#48group" title='group' data-ref="48group">group</a>;</td></tr>
<tr><th id="477">477</th><td>		}</td></tr>
<tr><th id="478">478</th><td>	}</td></tr>
<tr><th id="479">479</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="480">480</th><td></td></tr>
<tr><th id="481">481</th><td>	<b>return</b> <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="482">482</th><td>}</td></tr>
<tr><th id="483">483</th><td></td></tr>
<tr><th id="484">484</th><td><em>static</em></td></tr>
<tr><th id="485">485</th><td><b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="tu decl def fn" id="vfio_group_get_from_iommu" title='vfio_group_get_from_iommu' data-type='struct vfio_group * vfio_group_get_from_iommu(struct iommu_group * iommu_group)' data-ref="vfio_group_get_from_iommu">vfio_group_get_from_iommu</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#iommu_group" title='iommu_group' data-ref="iommu_group">iommu_group</a> *<dfn class="local col0 decl" id="50iommu_group" title='iommu_group' data-type='struct iommu_group *' data-ref="50iommu_group">iommu_group</dfn>)</td></tr>
<tr><th id="486">486</th><td>{</td></tr>
<tr><th id="487">487</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col1 decl" id="51group" title='group' data-type='struct vfio_group *' data-ref="51group">group</dfn>;</td></tr>
<tr><th id="488">488</th><td></td></tr>
<tr><th id="489">489</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="490">490</th><td>	<a class="macro" href="../../include/linux/list.h.html#463" title="for (group = ({ void *__mptr = (void *)((&amp;vfio.group_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;vfio.group_list)-&gt;next)), typeof(((typeof(*group) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;vfio.group_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_490(void) ; if (__cond) __compiletime_assert_490(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*group) *)(__mptr - __builtin_offsetof(typeof(*group), vfio_next))); }); &amp;group-&gt;vfio_next != (&amp;vfio.group_list); group = ({ void *__mptr = (void *)((group)-&gt;vfio_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((group)-&gt;vfio_next.next)), typeof(((typeof(*(group)) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((group)-&gt;vfio_next.next)), typeof(void)))); extern void __compiletime_assert_490(void) ; if (__cond) __compiletime_assert_490(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(group)) *)(__mptr - __builtin_offsetof(typeof(*(group)), vfio_next))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col1 ref" href="#51group" title='group' data-ref="51group">group</a>, &amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_list" title='vfio::group_list' data-use='a' data-ref="vfio::group_list">group_list</a>, <a class="ref field" href="#vfio_group::vfio_next" title='vfio_group::vfio_next' data-ref="vfio_group::vfio_next">vfio_next</a>) {</td></tr>
<tr><th id="491">491</th><td>		<b>if</b> (<a class="local col1 ref" href="#51group" title='group' data-ref="51group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a> == <a class="local col0 ref" href="#50iommu_group" title='iommu_group' data-ref="50iommu_group">iommu_group</a>) {</td></tr>
<tr><th id="492">492</th><td>			<a class="tu ref fn" href="#vfio_group_get" title='vfio_group_get' data-use='c' data-ref="vfio_group_get">vfio_group_get</a>(<a class="local col1 ref" href="#51group" title='group' data-ref="51group">group</a>);</td></tr>
<tr><th id="493">493</th><td>			<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="494">494</th><td>			<b>return</b> <a class="local col1 ref" href="#51group" title='group' data-ref="51group">group</a>;</td></tr>
<tr><th id="495">495</th><td>		}</td></tr>
<tr><th id="496">496</th><td>	}</td></tr>
<tr><th id="497">497</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="498">498</th><td></td></tr>
<tr><th id="499">499</th><td>	<b>return</b> <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="500">500</th><td>}</td></tr>
<tr><th id="501">501</th><td></td></tr>
<tr><th id="502">502</th><td><em>static</em> <b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="tu decl def fn" id="vfio_group_get_from_minor" title='vfio_group_get_from_minor' data-type='struct vfio_group * vfio_group_get_from_minor(int minor)' data-ref="vfio_group_get_from_minor">vfio_group_get_from_minor</dfn>(<em>int</em> <dfn class="local col2 decl" id="52minor" title='minor' data-type='int' data-ref="52minor">minor</dfn>)</td></tr>
<tr><th id="503">503</th><td>{</td></tr>
<tr><th id="504">504</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col3 decl" id="53group" title='group' data-type='struct vfio_group *' data-ref="53group">group</dfn>;</td></tr>
<tr><th id="505">505</th><td></td></tr>
<tr><th id="506">506</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="507">507</th><td>	<a class="local col3 ref" href="#53group" title='group' data-ref="53group">group</a> = <a class="ref fn" href="../../include/linux/idr.h.html#idr_find" title='idr_find' data-ref="idr_find">idr_find</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_idr" title='vfio::group_idr' data-use='a' data-ref="vfio::group_idr">group_idr</a>, <a class="local col2 ref" href="#52minor" title='minor' data-ref="52minor">minor</a>);</td></tr>
<tr><th id="508">508</th><td>	<b>if</b> (!<a class="local col3 ref" href="#53group" title='group' data-ref="53group">group</a>) {</td></tr>
<tr><th id="509">509</th><td>		<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="510">510</th><td>		<b>return</b> <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="511">511</th><td>	}</td></tr>
<tr><th id="512">512</th><td>	<a class="tu ref fn" href="#vfio_group_get" title='vfio_group_get' data-use='c' data-ref="vfio_group_get">vfio_group_get</a>(<a class="local col3 ref" href="#53group" title='group' data-ref="53group">group</a>);</td></tr>
<tr><th id="513">513</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="514">514</th><td></td></tr>
<tr><th id="515">515</th><td>	<b>return</b> <a class="local col3 ref" href="#53group" title='group' data-ref="53group">group</a>;</td></tr>
<tr><th id="516">516</th><td>}</td></tr>
<tr><th id="517">517</th><td></td></tr>
<tr><th id="518">518</th><td><em>static</em> <b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="tu decl def fn" id="vfio_group_get_from_dev" title='vfio_group_get_from_dev' data-type='struct vfio_group * vfio_group_get_from_dev(struct device * dev)' data-ref="vfio_group_get_from_dev">vfio_group_get_from_dev</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col4 decl" id="54dev" title='dev' data-type='struct device *' data-ref="54dev">dev</dfn>)</td></tr>
<tr><th id="519">519</th><td>{</td></tr>
<tr><th id="520">520</th><td>	<b>struct</b> <a class="type" href="../../include/linux/device.h.html#iommu_group" title='iommu_group' data-ref="iommu_group">iommu_group</a> *<dfn class="local col5 decl" id="55iommu_group" title='iommu_group' data-type='struct iommu_group *' data-ref="55iommu_group">iommu_group</dfn>;</td></tr>
<tr><th id="521">521</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col6 decl" id="56group" title='group' data-type='struct vfio_group *' data-ref="56group">group</dfn>;</td></tr>
<tr><th id="522">522</th><td></td></tr>
<tr><th id="523">523</th><td>	<a class="local col5 ref" href="#55iommu_group" title='iommu_group' data-ref="55iommu_group">iommu_group</a> = <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_get" title='iommu_group_get' data-ref="iommu_group_get">iommu_group_get</a>(<a class="local col4 ref" href="#54dev" title='dev' data-ref="54dev">dev</a>);</td></tr>
<tr><th id="524">524</th><td>	<b>if</b> (!<a class="local col5 ref" href="#55iommu_group" title='iommu_group' data-ref="55iommu_group">iommu_group</a>)</td></tr>
<tr><th id="525">525</th><td>		<b>return</b> <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="526">526</th><td></td></tr>
<tr><th id="527">527</th><td>	<a class="local col6 ref" href="#56group" title='group' data-ref="56group">group</a> = <a class="tu ref fn" href="#vfio_group_get_from_iommu" title='vfio_group_get_from_iommu' data-use='c' data-ref="vfio_group_get_from_iommu">vfio_group_get_from_iommu</a>(<a class="local col5 ref" href="#55iommu_group" title='iommu_group' data-ref="55iommu_group">iommu_group</a>);</td></tr>
<tr><th id="528">528</th><td>	<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_put" title='iommu_group_put' data-ref="iommu_group_put">iommu_group_put</a>(<a class="local col5 ref" href="#55iommu_group" title='iommu_group' data-ref="55iommu_group">iommu_group</a>);</td></tr>
<tr><th id="529">529</th><td></td></tr>
<tr><th id="530">530</th><td>	<b>return</b> <a class="local col6 ref" href="#56group" title='group' data-ref="56group">group</a>;</td></tr>
<tr><th id="531">531</th><td>}</td></tr>
<tr><th id="532">532</th><td></td></tr>
<tr><th id="533">533</th><td><i class="doc" data-doc="vfio_group_create_device">/**</i></td></tr>
<tr><th id="534">534</th><td><i class="doc" data-doc="vfio_group_create_device"> * Device objects - create, release, get, put, search</i></td></tr>
<tr><th id="535">535</th><td><i class="doc" data-doc="vfio_group_create_device"> */</i></td></tr>
<tr><th id="536">536</th><td><em>static</em></td></tr>
<tr><th id="537">537</th><td><b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="tu decl def fn" id="vfio_group_create_device" title='vfio_group_create_device' data-type='struct vfio_device * vfio_group_create_device(struct vfio_group * group, struct device * dev, const struct vfio_device_ops * ops, void * device_data)' data-ref="vfio_group_create_device">vfio_group_create_device</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col7 decl" id="57group" title='group' data-type='struct vfio_group *' data-ref="57group">group</dfn>,</td></tr>
<tr><th id="538">538</th><td>					     <b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col8 decl" id="58dev" title='dev' data-type='struct device *' data-ref="58dev">dev</dfn>,</td></tr>
<tr><th id="539">539</th><td>					     <em>const</em> <b>struct</b> <a class="type" href="../../include/linux/vfio.h.html#vfio_device_ops" title='vfio_device_ops' data-ref="vfio_device_ops">vfio_device_ops</a> *<dfn class="local col9 decl" id="59ops" title='ops' data-type='const struct vfio_device_ops *' data-ref="59ops">ops</dfn>,</td></tr>
<tr><th id="540">540</th><td>					     <em>void</em> *<dfn class="local col0 decl" id="60device_data" title='device_data' data-type='void *' data-ref="60device_data">device_data</dfn>)</td></tr>
<tr><th id="541">541</th><td>{</td></tr>
<tr><th id="542">542</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col1 decl" id="61device" title='device' data-type='struct vfio_device *' data-ref="61device">device</dfn>;</td></tr>
<tr><th id="543">543</th><td></td></tr>
<tr><th id="544">544</th><td>	<a class="local col1 ref" href="#61device" title='device' data-ref="61device">device</a> = <a class="ref fn" href="../../include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc">kzalloc</a>(<b>sizeof</b>(*<a class="local col1 ref" href="#61device" title='device' data-ref="61device">device</a>), <a class="macro" href="../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x200000u|0x400000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="545">545</th><td>	<b>if</b> (!<a class="local col1 ref" href="#61device" title='device' data-ref="61device">device</a>)</td></tr>
<tr><th id="546">546</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="547">547</th><td></td></tr>
<tr><th id="548">548</th><td>	<a class="ref fn" href="../../include/linux/kref.h.html#kref_init" title='kref_init' data-ref="kref_init">kref_init</a>(&amp;<a class="local col1 ref" href="#61device" title='device' data-ref="61device">device</a>-&gt;<a class="ref field" href="#vfio_device::kref" title='vfio_device::kref' data-ref="vfio_device::kref">kref</a>);</td></tr>
<tr><th id="549">549</th><td>	<a class="local col1 ref" href="#61device" title='device' data-ref="61device">device</a>-&gt;<a class="ref field" href="#vfio_device::dev" title='vfio_device::dev' data-ref="vfio_device::dev">dev</a> = <a class="local col8 ref" href="#58dev" title='dev' data-ref="58dev">dev</a>;</td></tr>
<tr><th id="550">550</th><td>	<a class="local col1 ref" href="#61device" title='device' data-ref="61device">device</a>-&gt;<a class="ref field" href="#vfio_device::group" title='vfio_device::group' data-ref="vfio_device::group">group</a> = <a class="local col7 ref" href="#57group" title='group' data-ref="57group">group</a>;</td></tr>
<tr><th id="551">551</th><td>	<a class="local col1 ref" href="#61device" title='device' data-ref="61device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a> = <a class="local col9 ref" href="#59ops" title='ops' data-ref="59ops">ops</a>;</td></tr>
<tr><th id="552">552</th><td>	<a class="local col1 ref" href="#61device" title='device' data-ref="61device">device</a>-&gt;<a class="ref field" href="#vfio_device::device_data" title='vfio_device::device_data' data-ref="vfio_device::device_data">device_data</a> = <a class="local col0 ref" href="#60device_data" title='device_data' data-ref="60device_data">device_data</a>;</td></tr>
<tr><th id="553">553</th><td>	<a class="ref fn" href="../../include/linux/device.h.html#dev_set_drvdata" title='dev_set_drvdata' data-ref="dev_set_drvdata">dev_set_drvdata</a>(<a class="local col8 ref" href="#58dev" title='dev' data-ref="58dev">dev</a>, <a class="local col1 ref" href="#61device" title='device' data-ref="61device">device</a>);</td></tr>
<tr><th id="554">554</th><td></td></tr>
<tr><th id="555">555</th><td>	<i>/* No need to get group_lock, caller has group reference */</i></td></tr>
<tr><th id="556">556</th><td>	<a class="tu ref fn" href="#vfio_group_get" title='vfio_group_get' data-use='c' data-ref="vfio_group_get">vfio_group_get</a>(<a class="local col7 ref" href="#57group" title='group' data-ref="57group">group</a>);</td></tr>
<tr><th id="557">557</th><td></td></tr>
<tr><th id="558">558</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="local col7 ref" href="#57group" title='group' data-ref="57group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_lock" title='vfio_group::device_lock' data-ref="vfio_group::device_lock">device_lock</a>);</td></tr>
<tr><th id="559">559</th><td>	<a class="ref fn" href="../../include/linux/list.h.html#list_add" title='list_add' data-ref="list_add">list_add</a>(&amp;<a class="local col1 ref" href="#61device" title='device' data-ref="61device">device</a>-&gt;<a class="ref field" href="#vfio_device::group_next" title='vfio_device::group_next' data-ref="vfio_device::group_next">group_next</a>, &amp;<a class="local col7 ref" href="#57group" title='group' data-ref="57group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_list" title='vfio_group::device_list' data-ref="vfio_group::device_list">device_list</a>);</td></tr>
<tr><th id="560">560</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="local col7 ref" href="#57group" title='group' data-ref="57group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_lock" title='vfio_group::device_lock' data-ref="vfio_group::device_lock">device_lock</a>);</td></tr>
<tr><th id="561">561</th><td></td></tr>
<tr><th id="562">562</th><td>	<b>return</b> <a class="local col1 ref" href="#61device" title='device' data-ref="61device">device</a>;</td></tr>
<tr><th id="563">563</th><td>}</td></tr>
<tr><th id="564">564</th><td></td></tr>
<tr><th id="565">565</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_device_release" title='vfio_device_release' data-type='void vfio_device_release(struct kref * kref)' data-ref="vfio_device_release">vfio_device_release</dfn>(<b>struct</b> <a class="type" href="../../include/linux/kref.h.html#kref" title='kref' data-ref="kref">kref</a> *<dfn class="local col2 decl" id="62kref" title='kref' data-type='struct kref *' data-ref="62kref">kref</dfn>)</td></tr>
<tr><th id="566">566</th><td>{</td></tr>
<tr><th id="567">567</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col3 decl" id="63device" title='device' data-type='struct vfio_device *' data-ref="63device">device</dfn> = <a class="macro" href="../../include/linux/kernel.h.html#962" title="({ void *__mptr = (void *)(kref); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(kref)), typeof(((struct vfio_device *)0)-&gt;kref)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(kref)), typeof(void)))); extern void __compiletime_assert_568(void) ; if (__cond) __compiletime_assert_568(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vfio_device *)(__mptr - __builtin_offsetof(struct vfio_device, kref))); })" data-ref="_M/container_of">container_of</a>(<a class="local col2 ref" href="#62kref" title='kref' data-ref="62kref">kref</a>,</td></tr>
<tr><th id="568">568</th><td>						  <b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a>, <a class="ref field" href="#vfio_device::kref" title='vfio_device::kref' data-ref="vfio_device::kref">kref</a>);</td></tr>
<tr><th id="569">569</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col4 decl" id="64group" title='group' data-type='struct vfio_group *' data-ref="64group">group</dfn> = <a class="local col3 ref" href="#63device" title='device' data-ref="63device">device</a>-&gt;<a class="ref field" href="#vfio_device::group" title='vfio_device::group' data-ref="vfio_device::group">group</a>;</td></tr>
<tr><th id="570">570</th><td></td></tr>
<tr><th id="571">571</th><td>	<a class="ref fn" href="../../include/linux/list.h.html#list_del" title='list_del' data-ref="list_del">list_del</a>(&amp;<a class="local col3 ref" href="#63device" title='device' data-ref="63device">device</a>-&gt;<a class="ref field" href="#vfio_device::group_next" title='vfio_device::group_next' data-ref="vfio_device::group_next">group_next</a>);</td></tr>
<tr><th id="572">572</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="local col4 ref" href="#64group" title='group' data-ref="64group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_lock" title='vfio_group::device_lock' data-ref="vfio_group::device_lock">device_lock</a>);</td></tr>
<tr><th id="573">573</th><td></td></tr>
<tr><th id="574">574</th><td>	<a class="ref fn" href="../../include/linux/device.h.html#dev_set_drvdata" title='dev_set_drvdata' data-ref="dev_set_drvdata">dev_set_drvdata</a>(<a class="local col3 ref" href="#63device" title='device' data-ref="63device">device</a>-&gt;<a class="ref field" href="#vfio_device::dev" title='vfio_device::dev' data-ref="vfio_device::dev">dev</a>, <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="575">575</th><td></td></tr>
<tr><th id="576">576</th><td>	<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col3 ref" href="#63device" title='device' data-ref="63device">device</a>);</td></tr>
<tr><th id="577">577</th><td></td></tr>
<tr><th id="578">578</th><td>	<i>/* vfio_del_group_dev may be waiting for this device */</i></td></tr>
<tr><th id="579">579</th><td>	<a class="macro" href="../../include/linux/wait.h.html#195" title="__wake_up(&amp;vfio.release_q, (0x0001 | 0x0002), 1, ((void *)0))" data-ref="_M/wake_up">wake_up</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::release_q" title='vfio::release_q' data-use='a' data-ref="vfio::release_q">release_q</a>);</td></tr>
<tr><th id="580">580</th><td>}</td></tr>
<tr><th id="581">581</th><td></td></tr>
<tr><th id="582">582</th><td><i>/* Device reference always implies a group reference */</i></td></tr>
<tr><th id="583">583</th><td><em>void</em> <dfn class="decl def fn" id="vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put">vfio_device_put</dfn>(<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col5 decl" id="65device" title='device' data-type='struct vfio_device *' data-ref="65device">device</dfn>)</td></tr>
<tr><th id="584">584</th><td>{</td></tr>
<tr><th id="585">585</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col6 decl" id="66group" title='group' data-type='struct vfio_group *' data-ref="66group">group</dfn> = <a class="local col5 ref" href="#65device" title='device' data-ref="65device">device</a>-&gt;<a class="ref field" href="#vfio_device::group" title='vfio_device::group' data-ref="vfio_device::group">group</a>;</td></tr>
<tr><th id="586">586</th><td>	<a class="ref fn" href="../../include/linux/kref.h.html#kref_put_mutex" title='kref_put_mutex' data-ref="kref_put_mutex">kref_put_mutex</a>(&amp;<a class="local col5 ref" href="#65device" title='device' data-ref="65device">device</a>-&gt;<a class="ref field" href="#vfio_device::kref" title='vfio_device::kref' data-ref="vfio_device::kref">kref</a>, <a class="tu ref fn" href="#vfio_device_release" title='vfio_device_release' data-use='r' data-ref="vfio_device_release">vfio_device_release</a>, &amp;<a class="local col6 ref" href="#66group" title='group' data-ref="66group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_lock" title='vfio_group::device_lock' data-ref="vfio_group::device_lock">device_lock</a>);</td></tr>
<tr><th id="587">587</th><td>	<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col6 ref" href="#66group" title='group' data-ref="66group">group</a>);</td></tr>
<tr><th id="588">588</th><td>}</td></tr>
<tr><th id="589">589</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_device_put) vfio_device_put; static const char __kstrtab_vfio_device_put[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_device_put&quot;; static const struct kernel_symbol __ksymtab_vfio_device_put __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_device_put&quot;), used)) = { (unsigned long)&amp;vfio_device_put, __kstrtab_vfio_device_put }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put"><a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put"><a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put"><a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put">vfio_device_put</a></a></a></a>);</td></tr>
<tr><th id="590">590</th><td></td></tr>
<tr><th id="591">591</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_device_get" title='vfio_device_get' data-type='void vfio_device_get(struct vfio_device * device)' data-ref="vfio_device_get">vfio_device_get</dfn>(<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col7 decl" id="67device" title='device' data-type='struct vfio_device *' data-ref="67device">device</dfn>)</td></tr>
<tr><th id="592">592</th><td>{</td></tr>
<tr><th id="593">593</th><td>	<a class="tu ref fn" href="#vfio_group_get" title='vfio_group_get' data-use='c' data-ref="vfio_group_get">vfio_group_get</a>(<a class="local col7 ref" href="#67device" title='device' data-ref="67device">device</a>-&gt;<a class="ref field" href="#vfio_device::group" title='vfio_device::group' data-ref="vfio_device::group">group</a>);</td></tr>
<tr><th id="594">594</th><td>	<a class="ref fn" href="../../include/linux/kref.h.html#kref_get" title='kref_get' data-ref="kref_get">kref_get</a>(&amp;<a class="local col7 ref" href="#67device" title='device' data-ref="67device">device</a>-&gt;<a class="ref field" href="#vfio_device::kref" title='vfio_device::kref' data-ref="vfio_device::kref">kref</a>);</td></tr>
<tr><th id="595">595</th><td>}</td></tr>
<tr><th id="596">596</th><td></td></tr>
<tr><th id="597">597</th><td><em>static</em> <b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="tu decl def fn" id="vfio_group_get_device" title='vfio_group_get_device' data-type='struct vfio_device * vfio_group_get_device(struct vfio_group * group, struct device * dev)' data-ref="vfio_group_get_device">vfio_group_get_device</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col8 decl" id="68group" title='group' data-type='struct vfio_group *' data-ref="68group">group</dfn>,</td></tr>
<tr><th id="598">598</th><td>						 <b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col9 decl" id="69dev" title='dev' data-type='struct device *' data-ref="69dev">dev</dfn>)</td></tr>
<tr><th id="599">599</th><td>{</td></tr>
<tr><th id="600">600</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col0 decl" id="70device" title='device' data-type='struct vfio_device *' data-ref="70device">device</dfn>;</td></tr>
<tr><th id="601">601</th><td></td></tr>
<tr><th id="602">602</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="local col8 ref" href="#68group" title='group' data-ref="68group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_lock" title='vfio_group::device_lock' data-ref="vfio_group::device_lock">device_lock</a>);</td></tr>
<tr><th id="603">603</th><td>	<a class="macro" href="../../include/linux/list.h.html#463" title="for (device = ({ void *__mptr = (void *)((&amp;group-&gt;device_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;group-&gt;device_list)-&gt;next)), typeof(((typeof(*device) *)0)-&gt;group_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;group-&gt;device_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_603(void) ; if (__cond) __compiletime_assert_603(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*device) *)(__mptr - __builtin_offsetof(typeof(*device), group_next))); }); &amp;device-&gt;group_next != (&amp;group-&gt;device_list); device = ({ void *__mptr = (void *)((device)-&gt;group_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((device)-&gt;group_next.next)), typeof(((typeof(*(device)) *)0)-&gt;group_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((device)-&gt;group_next.next)), typeof(void)))); extern void __compiletime_assert_603(void) ; if (__cond) __compiletime_assert_603(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(device)) *)(__mptr - __builtin_offsetof(typeof(*(device)), group_next))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col0 ref" href="#70device" title='device' data-ref="70device">device</a>, &amp;<a class="local col8 ref" href="#68group" title='group' data-ref="68group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_list" title='vfio_group::device_list' data-ref="vfio_group::device_list">device_list</a>, <a class="ref field" href="#vfio_device::group_next" title='vfio_device::group_next' data-ref="vfio_device::group_next">group_next</a>) {</td></tr>
<tr><th id="604">604</th><td>		<b>if</b> (<a class="local col0 ref" href="#70device" title='device' data-ref="70device">device</a>-&gt;<a class="ref field" href="#vfio_device::dev" title='vfio_device::dev' data-ref="vfio_device::dev">dev</a> == <a class="local col9 ref" href="#69dev" title='dev' data-ref="69dev">dev</a>) {</td></tr>
<tr><th id="605">605</th><td>			<a class="tu ref fn" href="#vfio_device_get" title='vfio_device_get' data-use='c' data-ref="vfio_device_get">vfio_device_get</a>(<a class="local col0 ref" href="#70device" title='device' data-ref="70device">device</a>);</td></tr>
<tr><th id="606">606</th><td>			<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="local col8 ref" href="#68group" title='group' data-ref="68group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_lock" title='vfio_group::device_lock' data-ref="vfio_group::device_lock">device_lock</a>);</td></tr>
<tr><th id="607">607</th><td>			<b>return</b> <a class="local col0 ref" href="#70device" title='device' data-ref="70device">device</a>;</td></tr>
<tr><th id="608">608</th><td>		}</td></tr>
<tr><th id="609">609</th><td>	}</td></tr>
<tr><th id="610">610</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="local col8 ref" href="#68group" title='group' data-ref="68group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_lock" title='vfio_group::device_lock' data-ref="vfio_group::device_lock">device_lock</a>);</td></tr>
<tr><th id="611">611</th><td>	<b>return</b> <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="612">612</th><td>}</td></tr>
<tr><th id="613">613</th><td></td></tr>
<tr><th id="614">614</th><td><i  data-doc="vfio_driver_whitelist">/*</i></td></tr>
<tr><th id="615">615</th><td><i  data-doc="vfio_driver_whitelist"> * Some drivers, like pci-stub, are only used to prevent other drivers from</i></td></tr>
<tr><th id="616">616</th><td><i  data-doc="vfio_driver_whitelist"> * claiming a device and are therefore perfectly legitimate for a user owned</i></td></tr>
<tr><th id="617">617</th><td><i  data-doc="vfio_driver_whitelist"> * group.  The pci-stub driver has no dependencies on DMA or the IOVA mapping</i></td></tr>
<tr><th id="618">618</th><td><i  data-doc="vfio_driver_whitelist"> * of the device, but it does prevent the user from having direct access to</i></td></tr>
<tr><th id="619">619</th><td><i  data-doc="vfio_driver_whitelist"> * the device, which is useful in some circumstances.</i></td></tr>
<tr><th id="620">620</th><td><i  data-doc="vfio_driver_whitelist"> *</i></td></tr>
<tr><th id="621">621</th><td><i  data-doc="vfio_driver_whitelist"> * We also assume that we can include PCI interconnect devices, ie. bridges.</i></td></tr>
<tr><th id="622">622</th><td><i  data-doc="vfio_driver_whitelist"> * IOMMU grouping on PCI necessitates that if we lack isolation on a bridge</i></td></tr>
<tr><th id="623">623</th><td><i  data-doc="vfio_driver_whitelist"> * then all of the downstream devices will be part of the same IOMMU group as</i></td></tr>
<tr><th id="624">624</th><td><i  data-doc="vfio_driver_whitelist"> * the bridge.  Thus, if placing the bridge into the user owned IOVA space</i></td></tr>
<tr><th id="625">625</th><td><i  data-doc="vfio_driver_whitelist"> * breaks anything, it only does so for user owned devices downstream.  Note</i></td></tr>
<tr><th id="626">626</th><td><i  data-doc="vfio_driver_whitelist"> * that error notification via MSI can be affected for platforms that handle</i></td></tr>
<tr><th id="627">627</th><td><i  data-doc="vfio_driver_whitelist"> * MSI within the same IOVA space as DMA.</i></td></tr>
<tr><th id="628">628</th><td><i  data-doc="vfio_driver_whitelist"> */</i></td></tr>
<tr><th id="629">629</th><td><em>static</em> <em>const</em> <em>char</em> * <em>const</em> <dfn class="tu decl def" id="vfio_driver_whitelist" title='vfio_driver_whitelist' data-type='const char *const [1]' data-ref="vfio_driver_whitelist">vfio_driver_whitelist</dfn>[] = { <q>"pci-stub"</q> };</td></tr>
<tr><th id="630">630</th><td></td></tr>
<tr><th id="631">631</th><td><em>static</em> <a class="typedef" href="../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="tu decl def fn" id="vfio_dev_whitelisted" title='vfio_dev_whitelisted' data-type='bool vfio_dev_whitelisted(struct device * dev, struct device_driver * drv)' data-ref="vfio_dev_whitelisted">vfio_dev_whitelisted</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col1 decl" id="71dev" title='dev' data-type='struct device *' data-ref="71dev">dev</dfn>, <b>struct</b> <a class="type" href="../../include/linux/device.h.html#device_driver" title='device_driver' data-ref="device_driver">device_driver</a> *<dfn class="local col2 decl" id="72drv" title='drv' data-type='struct device_driver *' data-ref="72drv">drv</dfn>)</td></tr>
<tr><th id="632">632</th><td>{</td></tr>
<tr><th id="633">633</th><td>	<b>if</b> (<a class="macro" href="../../include/linux/pci.h.html#933" title="((dev)-&gt;bus == &amp;pci_bus_type)" data-ref="_M/dev_is_pci">dev_is_pci</a>(<a class="local col1 ref" href="#71dev" title='dev' data-ref="71dev">dev</a>)) {</td></tr>
<tr><th id="634">634</th><td>		<b>struct</b> <a class="type" href="../../include/linux/pci.h.html#pci_dev" title='pci_dev' data-ref="pci_dev">pci_dev</a> *<dfn class="local col3 decl" id="73pdev" title='pdev' data-type='struct pci_dev *' data-ref="73pdev">pdev</dfn> = <a class="macro" href="../../include/linux/pci.h.html#454" title="({ void *__mptr = (void *)(dev); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(dev)), typeof(((struct pci_dev *)0)-&gt;dev)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(dev)), typeof(void)))); extern void __compiletime_assert_634(void) ; if (__cond) __compiletime_assert_634(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct pci_dev *)(__mptr - __builtin_offsetof(struct pci_dev, dev))); })" data-ref="_M/to_pci_dev">to_pci_dev</a>(<a class="local col1 ref" href="#71dev" title='dev' data-ref="71dev">dev</a>);</td></tr>
<tr><th id="635">635</th><td></td></tr>
<tr><th id="636">636</th><td>		<b>if</b> (<a class="local col3 ref" href="#73pdev" title='pdev' data-ref="73pdev">pdev</a>-&gt;<a class="ref field" href="../../include/linux/pci.h.html#pci_dev::hdr_type" title='pci_dev::hdr_type' data-ref="pci_dev::hdr_type">hdr_type</a> != <a class="macro" href="../../include/uapi/linux/pci_regs.h.html#79" title="0" data-ref="_M/PCI_HEADER_TYPE_NORMAL">PCI_HEADER_TYPE_NORMAL</a>)</td></tr>
<tr><th id="637">637</th><td>			<b>return</b> <a class="enum" href="../../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="638">638</th><td>	}</td></tr>
<tr><th id="639">639</th><td></td></tr>
<tr><th id="640">640</th><td>	<b>return</b> <a class="ref fn" href="../../include/linux/string.h.html#match_string" title='match_string' data-ref="match_string">match_string</a>(<a class="tu ref" href="#vfio_driver_whitelist" title='vfio_driver_whitelist' data-use='r' data-ref="vfio_driver_whitelist">vfio_driver_whitelist</a>,</td></tr>
<tr><th id="641">641</th><td>			    <a class="macro" href="../../include/linux/kernel.h.html#72" title="(sizeof(vfio_driver_whitelist) / sizeof((vfio_driver_whitelist)[0]) + (sizeof(struct { int:(-!!(__builtin_types_compatible_p(typeof((vfio_driver_whitelist)), typeof(&amp;(vfio_driver_whitelist)[0])))); })))" data-ref="_M/ARRAY_SIZE">ARRAY_SIZE</a>(<a class="tu ref" href="#vfio_driver_whitelist" title='vfio_driver_whitelist' data-use='r' data-ref="vfio_driver_whitelist">vfio_driver_whitelist</a>),</td></tr>
<tr><th id="642">642</th><td>			    <a class="local col2 ref" href="#72drv" title='drv' data-ref="72drv">drv</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#device_driver::name" title='device_driver::name' data-ref="device_driver::name">name</a>) &gt;= <var>0</var>;</td></tr>
<tr><th id="643">643</th><td>}</td></tr>
<tr><th id="644">644</th><td></td></tr>
<tr><th id="645">645</th><td><i  data-doc="vfio_dev_viable">/*</i></td></tr>
<tr><th id="646">646</th><td><i  data-doc="vfio_dev_viable"> * A vfio group is viable for use by userspace if all devices are in</i></td></tr>
<tr><th id="647">647</th><td><i  data-doc="vfio_dev_viable"> * one of the following states:</i></td></tr>
<tr><th id="648">648</th><td><i  data-doc="vfio_dev_viable"> *  - driver-less</i></td></tr>
<tr><th id="649">649</th><td><i  data-doc="vfio_dev_viable"> *  - bound to a vfio driver</i></td></tr>
<tr><th id="650">650</th><td><i  data-doc="vfio_dev_viable"> *  - bound to a whitelisted driver</i></td></tr>
<tr><th id="651">651</th><td><i  data-doc="vfio_dev_viable"> *  - a PCI interconnect device</i></td></tr>
<tr><th id="652">652</th><td><i  data-doc="vfio_dev_viable"> *</i></td></tr>
<tr><th id="653">653</th><td><i  data-doc="vfio_dev_viable"> * We use two methods to determine whether a device is bound to a vfio</i></td></tr>
<tr><th id="654">654</th><td><i  data-doc="vfio_dev_viable"> * driver.  The first is to test whether the device exists in the vfio</i></td></tr>
<tr><th id="655">655</th><td><i  data-doc="vfio_dev_viable"> * group.  The second is to test if the device exists on the group</i></td></tr>
<tr><th id="656">656</th><td><i  data-doc="vfio_dev_viable"> * unbound_list, indicating it's in the middle of transitioning from</i></td></tr>
<tr><th id="657">657</th><td><i  data-doc="vfio_dev_viable"> * a vfio driver to driver-less.</i></td></tr>
<tr><th id="658">658</th><td><i  data-doc="vfio_dev_viable"> */</i></td></tr>
<tr><th id="659">659</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_dev_viable" title='vfio_dev_viable' data-type='int vfio_dev_viable(struct device * dev, void * data)' data-ref="vfio_dev_viable">vfio_dev_viable</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col4 decl" id="74dev" title='dev' data-type='struct device *' data-ref="74dev">dev</dfn>, <em>void</em> *<dfn class="local col5 decl" id="75data" title='data' data-type='void *' data-ref="75data">data</dfn>)</td></tr>
<tr><th id="660">660</th><td>{</td></tr>
<tr><th id="661">661</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col6 decl" id="76group" title='group' data-type='struct vfio_group *' data-ref="76group">group</dfn> = <a class="local col5 ref" href="#75data" title='data' data-ref="75data">data</a>;</td></tr>
<tr><th id="662">662</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col7 decl" id="77device" title='device' data-type='struct vfio_device *' data-ref="77device">device</dfn>;</td></tr>
<tr><th id="663">663</th><td>	<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device_driver" title='device_driver' data-ref="device_driver">device_driver</a> *<dfn class="local col8 decl" id="78drv" title='drv' data-type='struct device_driver *' data-ref="78drv">drv</dfn> = <a class="macro" href="../../include/linux/compiler.h.html#258" title="({ union { typeof(dev-&gt;driver) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(dev-&gt;driver), __u.__c, sizeof(dev-&gt;driver)); else __read_once_size_nocheck(&amp;(dev-&gt;driver), __u.__c, sizeof(dev-&gt;driver)); do { } while (0); __u.__val; })" data-ref="_M/READ_ONCE">READ_ONCE</a>(<a class="local col4 ref" href="#74dev" title='dev' data-ref="74dev">dev</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#device::driver" title='device::driver' data-ref="device::driver">driver</a>);</td></tr>
<tr><th id="664">664</th><td>	<b>struct</b> <a class="type" href="#vfio_unbound_dev" title='vfio_unbound_dev' data-ref="vfio_unbound_dev">vfio_unbound_dev</a> *<dfn class="local col9 decl" id="79unbound" title='unbound' data-type='struct vfio_unbound_dev *' data-ref="79unbound">unbound</dfn>;</td></tr>
<tr><th id="665">665</th><td>	<em>int</em> <dfn class="local col0 decl" id="80ret" title='ret' data-type='int' data-ref="80ret">ret</dfn> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="666">666</th><td></td></tr>
<tr><th id="667">667</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="local col6 ref" href="#76group" title='group' data-ref="76group">group</a>-&gt;<a class="ref field" href="#vfio_group::unbound_lock" title='vfio_group::unbound_lock' data-ref="vfio_group::unbound_lock">unbound_lock</a>);</td></tr>
<tr><th id="668">668</th><td>	<a class="macro" href="../../include/linux/list.h.html#463" title="for (unbound = ({ void *__mptr = (void *)((&amp;group-&gt;unbound_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;group-&gt;unbound_list)-&gt;next)), typeof(((typeof(*unbound) *)0)-&gt;unbound_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;group-&gt;unbound_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_668(void) ; if (__cond) __compiletime_assert_668(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*unbound) *)(__mptr - __builtin_offsetof(typeof(*unbound), unbound_next))); }); &amp;unbound-&gt;unbound_next != (&amp;group-&gt;unbound_list); unbound = ({ void *__mptr = (void *)((unbound)-&gt;unbound_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((unbound)-&gt;unbound_next.next)), typeof(((typeof(*(unbound)) *)0)-&gt;unbound_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((unbound)-&gt;unbound_next.next)), typeof(void)))); extern void __compiletime_assert_668(void) ; if (__cond) __compiletime_assert_668(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(unbound)) *)(__mptr - __builtin_offsetof(typeof(*(unbound)), unbound_next))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col9 ref" href="#79unbound" title='unbound' data-ref="79unbound">unbound</a>, &amp;<a class="local col6 ref" href="#76group" title='group' data-ref="76group">group</a>-&gt;<a class="ref field" href="#vfio_group::unbound_list" title='vfio_group::unbound_list' data-ref="vfio_group::unbound_list">unbound_list</a>, <a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='r' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='a' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='m' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='m' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='m' data-ref="vfio_unbound_dev::unbound_next">unbound_next</a></a></a></a></a>) {</td></tr>
<tr><th id="669">669</th><td>		<b>if</b> (<a class="local col4 ref" href="#74dev" title='dev' data-ref="74dev">dev</a> == <a class="local col9 ref" href="#79unbound" title='unbound' data-ref="79unbound">unbound</a>-&gt;<a class="tu ref field" href="#vfio_unbound_dev::dev" title='vfio_unbound_dev::dev' data-use='r' data-ref="vfio_unbound_dev::dev">dev</a>) {</td></tr>
<tr><th id="670">670</th><td>			<a class="local col0 ref" href="#80ret" title='ret' data-ref="80ret">ret</a> = <var>0</var>;</td></tr>
<tr><th id="671">671</th><td>			<b>break</b>;</td></tr>
<tr><th id="672">672</th><td>		}</td></tr>
<tr><th id="673">673</th><td>	}</td></tr>
<tr><th id="674">674</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="local col6 ref" href="#76group" title='group' data-ref="76group">group</a>-&gt;<a class="ref field" href="#vfio_group::unbound_lock" title='vfio_group::unbound_lock' data-ref="vfio_group::unbound_lock">unbound_lock</a>);</td></tr>
<tr><th id="675">675</th><td></td></tr>
<tr><th id="676">676</th><td>	<b>if</b> (!<a class="local col0 ref" href="#80ret" title='ret' data-ref="80ret">ret</a> || !<a class="local col8 ref" href="#78drv" title='drv' data-ref="78drv">drv</a> || <a class="tu ref fn" href="#vfio_dev_whitelisted" title='vfio_dev_whitelisted' data-use='c' data-ref="vfio_dev_whitelisted">vfio_dev_whitelisted</a>(<a class="local col4 ref" href="#74dev" title='dev' data-ref="74dev">dev</a>, <a class="local col8 ref" href="#78drv" title='drv' data-ref="78drv">drv</a>))</td></tr>
<tr><th id="677">677</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="678">678</th><td></td></tr>
<tr><th id="679">679</th><td>	<a class="local col7 ref" href="#77device" title='device' data-ref="77device">device</a> = <a class="tu ref fn" href="#vfio_group_get_device" title='vfio_group_get_device' data-use='c' data-ref="vfio_group_get_device">vfio_group_get_device</a>(<a class="local col6 ref" href="#76group" title='group' data-ref="76group">group</a>, <a class="local col4 ref" href="#74dev" title='dev' data-ref="74dev">dev</a>);</td></tr>
<tr><th id="680">680</th><td>	<b>if</b> (<a class="local col7 ref" href="#77device" title='device' data-ref="77device">device</a>) {</td></tr>
<tr><th id="681">681</th><td>		<a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put">vfio_device_put</a>(<a class="local col7 ref" href="#77device" title='device' data-ref="77device">device</a>);</td></tr>
<tr><th id="682">682</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="683">683</th><td>	}</td></tr>
<tr><th id="684">684</th><td></td></tr>
<tr><th id="685">685</th><td>	<b>return</b> <a class="local col0 ref" href="#80ret" title='ret' data-ref="80ret">ret</a>;</td></tr>
<tr><th id="686">686</th><td>}</td></tr>
<tr><th id="687">687</th><td></td></tr>
<tr><th id="688">688</th><td><i class="doc" data-doc="vfio_group_nb_add_dev">/**</i></td></tr>
<tr><th id="689">689</th><td><i class="doc" data-doc="vfio_group_nb_add_dev"> * Async device support</i></td></tr>
<tr><th id="690">690</th><td><i class="doc" data-doc="vfio_group_nb_add_dev"> */</i></td></tr>
<tr><th id="691">691</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_group_nb_add_dev" title='vfio_group_nb_add_dev' data-type='int vfio_group_nb_add_dev(struct vfio_group * group, struct device * dev)' data-ref="vfio_group_nb_add_dev">vfio_group_nb_add_dev</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col1 decl" id="81group" title='group' data-type='struct vfio_group *' data-ref="81group">group</dfn>, <b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col2 decl" id="82dev" title='dev' data-type='struct device *' data-ref="82dev">dev</dfn>)</td></tr>
<tr><th id="692">692</th><td>{</td></tr>
<tr><th id="693">693</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col3 decl" id="83device" title='device' data-type='struct vfio_device *' data-ref="83device">device</dfn>;</td></tr>
<tr><th id="694">694</th><td></td></tr>
<tr><th id="695">695</th><td>	<i>/* Do we already know about it?  We shouldn't */</i></td></tr>
<tr><th id="696">696</th><td>	<a class="local col3 ref" href="#83device" title='device' data-ref="83device">device</a> = <a class="tu ref fn" href="#vfio_group_get_device" title='vfio_group_get_device' data-use='c' data-ref="vfio_group_get_device">vfio_group_get_device</a>(<a class="local col1 ref" href="#81group" title='group' data-ref="81group">group</a>, <a class="local col2 ref" href="#82dev" title='dev' data-ref="82dev">dev</a>);</td></tr>
<tr><th id="697">697</th><td>	<b>if</b> (<a class="macro" href="../../include/asm-generic/bug.h.html#68" title="({ int __ret_warn_on = !!(device); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/drivers/vfio/vfio.c&quot;), &quot;i&quot; (697), &quot;i&quot; ((1 &lt;&lt; 0)|((1 &lt;&lt; 1)|((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (72)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON_ONCE">WARN_ON_ONCE</a>(<a class="local col3 ref" href="#83device" title='device' data-ref="83device">device</a>)) {</td></tr>
<tr><th id="698">698</th><td>		<a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put">vfio_device_put</a>(<a class="local col3 ref" href="#83device" title='device' data-ref="83device">device</a>);</td></tr>
<tr><th id="699">699</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="700">700</th><td>	}</td></tr>
<tr><th id="701">701</th><td></td></tr>
<tr><th id="702">702</th><td>	<i>/* Nothing to do for idle groups */</i></td></tr>
<tr><th id="703">703</th><td>	<b>if</b> (!<a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_read" title='atomic_read' data-ref="atomic_read">atomic_read</a>(&amp;<a class="local col1 ref" href="#81group" title='group' data-ref="81group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</a>))</td></tr>
<tr><th id="704">704</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="705">705</th><td></td></tr>
<tr><th id="706">706</th><td>	<i>/* TODO Prevent device auto probing */</i></td></tr>
<tr><th id="707">707</th><td>	<a class="macro" href="../../include/asm-generic/bug.h.html#120" title="({ int __ret_warn_on = !!(1); if (__builtin_expect(!!(__ret_warn_on), 0)) do { __warn_printk(&quot;Device %s added to live group %d!\n&quot;, dev_name(dev), iommu_group_id(group-&gt;iommu_group)); do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/drivers/vfio/vfio.c&quot;), &quot;i&quot; (708), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (74)); }); } while (0); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN">WARN</a>(<var>1</var>, <q>"Device %s added to live group %d!\n"</q>, <a class="ref fn" href="../../include/linux/device.h.html#dev_name" title='dev_name' data-ref="dev_name">dev_name</a>(<a class="local col2 ref" href="#82dev" title='dev' data-ref="82dev">dev</a>),</td></tr>
<tr><th id="708">708</th><td>	     <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_id" title='iommu_group_id' data-ref="iommu_group_id">iommu_group_id</a>(<a class="local col1 ref" href="#81group" title='group' data-ref="81group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>));</td></tr>
<tr><th id="709">709</th><td></td></tr>
<tr><th id="710">710</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="711">711</th><td>}</td></tr>
<tr><th id="712">712</th><td></td></tr>
<tr><th id="713">713</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_group_nb_verify" title='vfio_group_nb_verify' data-type='int vfio_group_nb_verify(struct vfio_group * group, struct device * dev)' data-ref="vfio_group_nb_verify">vfio_group_nb_verify</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col4 decl" id="84group" title='group' data-type='struct vfio_group *' data-ref="84group">group</dfn>, <b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col5 decl" id="85dev" title='dev' data-type='struct device *' data-ref="85dev">dev</dfn>)</td></tr>
<tr><th id="714">714</th><td>{</td></tr>
<tr><th id="715">715</th><td>	<i>/* We don't care what happens when the group isn't in use */</i></td></tr>
<tr><th id="716">716</th><td>	<b>if</b> (!<a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_read" title='atomic_read' data-ref="atomic_read">atomic_read</a>(&amp;<a class="local col4 ref" href="#84group" title='group' data-ref="84group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</a>))</td></tr>
<tr><th id="717">717</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="718">718</th><td></td></tr>
<tr><th id="719">719</th><td>	<b>return</b> <a class="tu ref fn" href="#vfio_dev_viable" title='vfio_dev_viable' data-use='c' data-ref="vfio_dev_viable">vfio_dev_viable</a>(<a class="local col5 ref" href="#85dev" title='dev' data-ref="85dev">dev</a>, <a class="local col4 ref" href="#84group" title='group' data-ref="84group">group</a>);</td></tr>
<tr><th id="720">720</th><td>}</td></tr>
<tr><th id="721">721</th><td></td></tr>
<tr><th id="722">722</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_iommu_group_notifier" title='vfio_iommu_group_notifier' data-type='int vfio_iommu_group_notifier(struct notifier_block * nb, unsigned long action, void * data)' data-ref="vfio_iommu_group_notifier">vfio_iommu_group_notifier</dfn>(<b>struct</b> <a class="type" href="../../include/linux/notifier.h.html#notifier_block" title='notifier_block' data-ref="notifier_block">notifier_block</a> *<dfn class="local col6 decl" id="86nb" title='nb' data-type='struct notifier_block *' data-ref="86nb">nb</dfn>,</td></tr>
<tr><th id="723">723</th><td>				     <em>unsigned</em> <em>long</em> <dfn class="local col7 decl" id="87action" title='action' data-type='unsigned long' data-ref="87action">action</dfn>, <em>void</em> *<dfn class="local col8 decl" id="88data" title='data' data-type='void *' data-ref="88data">data</dfn>)</td></tr>
<tr><th id="724">724</th><td>{</td></tr>
<tr><th id="725">725</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col9 decl" id="89group" title='group' data-type='struct vfio_group *' data-ref="89group">group</dfn> = <a class="macro" href="../../include/linux/kernel.h.html#962" title="({ void *__mptr = (void *)(nb); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(nb)), typeof(((struct vfio_group *)0)-&gt;nb)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(nb)), typeof(void)))); extern void __compiletime_assert_725(void) ; if (__cond) __compiletime_assert_725(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vfio_group *)(__mptr - __builtin_offsetof(struct vfio_group, nb))); })" data-ref="_M/container_of">container_of</a>(<a class="local col6 ref" href="#86nb" title='nb' data-ref="86nb">nb</a>, <b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a>, <a class="ref field" href="#vfio_group::nb" title='vfio_group::nb' data-ref="vfio_group::nb">nb</a>);</td></tr>
<tr><th id="726">726</th><td>	<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col0 decl" id="90dev" title='dev' data-type='struct device *' data-ref="90dev">dev</dfn> = <a class="local col8 ref" href="#88data" title='data' data-ref="88data">data</a>;</td></tr>
<tr><th id="727">727</th><td>	<b>struct</b> <a class="type" href="#vfio_unbound_dev" title='vfio_unbound_dev' data-ref="vfio_unbound_dev">vfio_unbound_dev</a> *<dfn class="local col1 decl" id="91unbound" title='unbound' data-type='struct vfio_unbound_dev *' data-ref="91unbound">unbound</dfn>;</td></tr>
<tr><th id="728">728</th><td></td></tr>
<tr><th id="729">729</th><td>	<i>/*</i></td></tr>
<tr><th id="730">730</th><td><i>	 * Need to go through a group_lock lookup to get a reference or we</i></td></tr>
<tr><th id="731">731</th><td><i>	 * risk racing a group being removed.  Ignore spurious notifies.</i></td></tr>
<tr><th id="732">732</th><td><i>	 */</i></td></tr>
<tr><th id="733">733</th><td>	<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a> = <a class="tu ref fn" href="#vfio_group_try_get" title='vfio_group_try_get' data-use='c' data-ref="vfio_group_try_get">vfio_group_try_get</a>(<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a>);</td></tr>
<tr><th id="734">734</th><td>	<b>if</b> (!<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a>)</td></tr>
<tr><th id="735">735</th><td>		<b>return</b> <a class="macro" href="../../include/linux/notifier.h.html#185" title="0x0001" data-ref="_M/NOTIFY_OK">NOTIFY_OK</a>;</td></tr>
<tr><th id="736">736</th><td></td></tr>
<tr><th id="737">737</th><td>	<b>switch</b> (<a class="local col7 ref" href="#87action" title='action' data-ref="87action">action</a>) {</td></tr>
<tr><th id="738">738</th><td>	<b>case</b> <a class="macro" href="../../include/linux/iommu.h.html#282" title="1" data-ref="_M/IOMMU_GROUP_NOTIFY_ADD_DEVICE">IOMMU_GROUP_NOTIFY_ADD_DEVICE</a>:</td></tr>
<tr><th id="739">739</th><td>		<a class="tu ref fn" href="#vfio_group_nb_add_dev" title='vfio_group_nb_add_dev' data-use='c' data-ref="vfio_group_nb_add_dev">vfio_group_nb_add_dev</a>(<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a>, <a class="local col0 ref" href="#90dev" title='dev' data-ref="90dev">dev</a>);</td></tr>
<tr><th id="740">740</th><td>		<b>break</b>;</td></tr>
<tr><th id="741">741</th><td>	<b>case</b> <a class="macro" href="../../include/linux/iommu.h.html#283" title="2" data-ref="_M/IOMMU_GROUP_NOTIFY_DEL_DEVICE">IOMMU_GROUP_NOTIFY_DEL_DEVICE</a>:</td></tr>
<tr><th id="742">742</th><td>		<i>/*</i></td></tr>
<tr><th id="743">743</th><td><i>		 * Nothing to do here.  If the device is in use, then the</i></td></tr>
<tr><th id="744">744</th><td><i>		 * vfio sub-driver should block the remove callback until</i></td></tr>
<tr><th id="745">745</th><td><i>		 * it is unused.  If the device is unused or attached to a</i></td></tr>
<tr><th id="746">746</th><td><i>		 * stub driver, then it should be released and we don't</i></td></tr>
<tr><th id="747">747</th><td><i>		 * care that it will be going away.</i></td></tr>
<tr><th id="748">748</th><td><i>		 */</i></td></tr>
<tr><th id="749">749</th><td>		<b>break</b>;</td></tr>
<tr><th id="750">750</th><td>	<b>case</b> <a class="macro" href="../../include/linux/iommu.h.html#284" title="3" data-ref="_M/IOMMU_GROUP_NOTIFY_BIND_DRIVER">IOMMU_GROUP_NOTIFY_BIND_DRIVER</a>:</td></tr>
<tr><th id="751">751</th><td>		<a class="macro" href="../../include/linux/printk.h.html#345" title="({ if (0) printk(&quot;\001&quot; &quot;7&quot; &quot;%s: Device %s, group %d binding to driver\n&quot;, __func__, dev_name(dev), iommu_group_id(group-&gt;iommu_group)); 0; })" data-ref="_M/pr_debug">pr_debug</a>(<q>"%s: Device %s, group %d binding to driver\n"</q>,</td></tr>
<tr><th id="752">752</th><td>			 <b>__func__</b>, <a class="ref fn" href="../../include/linux/device.h.html#dev_name" title='dev_name' data-ref="dev_name">dev_name</a>(<a class="local col0 ref" href="#90dev" title='dev' data-ref="90dev">dev</a>),</td></tr>
<tr><th id="753">753</th><td>			 <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_id" title='iommu_group_id' data-ref="iommu_group_id">iommu_group_id</a>(<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>));</td></tr>
<tr><th id="754">754</th><td>		<b>break</b>;</td></tr>
<tr><th id="755">755</th><td>	<b>case</b> <a class="macro" href="../../include/linux/iommu.h.html#285" title="4" data-ref="_M/IOMMU_GROUP_NOTIFY_BOUND_DRIVER">IOMMU_GROUP_NOTIFY_BOUND_DRIVER</a>:</td></tr>
<tr><th id="756">756</th><td>		<a class="macro" href="../../include/linux/printk.h.html#345" title="({ if (0) printk(&quot;\001&quot; &quot;7&quot; &quot;%s: Device %s, group %d bound to driver %s\n&quot;, __func__, dev_name(dev), iommu_group_id(group-&gt;iommu_group), dev-&gt;driver-&gt;name); 0; })" data-ref="_M/pr_debug">pr_debug</a>(<q>"%s: Device %s, group %d bound to driver %s\n"</q>,</td></tr>
<tr><th id="757">757</th><td>			 <b>__func__</b>, <a class="ref fn" href="../../include/linux/device.h.html#dev_name" title='dev_name' data-ref="dev_name">dev_name</a>(<a class="local col0 ref" href="#90dev" title='dev' data-ref="90dev">dev</a>),</td></tr>
<tr><th id="758">758</th><td>			 <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_id" title='iommu_group_id' data-ref="iommu_group_id">iommu_group_id</a>(<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>), <a class="local col0 ref" href="#90dev" title='dev' data-ref="90dev">dev</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#device::driver" title='device::driver' data-ref="device::driver">driver</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#device_driver::name" title='device_driver::name' data-ref="device_driver::name">name</a>);</td></tr>
<tr><th id="759">759</th><td>		<a class="macro" href="../../include/asm-generic/bug.h.html#61" title="do { if (__builtin_expect(!!(vfio_group_nb_verify(group, dev)), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/drivers/vfio/vfio.c&quot;), &quot;i&quot; (759), &quot;i&quot; (0), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); do { ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (76)); }); do { } while (1); } while (0); } while (0); } while (0)" data-ref="_M/BUG_ON">BUG_ON</a>(<a class="tu ref fn" href="#vfio_group_nb_verify" title='vfio_group_nb_verify' data-use='c' data-ref="vfio_group_nb_verify">vfio_group_nb_verify</a>(<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a>, <a class="local col0 ref" href="#90dev" title='dev' data-ref="90dev">dev</a>));</td></tr>
<tr><th id="760">760</th><td>		<b>break</b>;</td></tr>
<tr><th id="761">761</th><td>	<b>case</b> <a class="macro" href="../../include/linux/iommu.h.html#286" title="5" data-ref="_M/IOMMU_GROUP_NOTIFY_UNBIND_DRIVER">IOMMU_GROUP_NOTIFY_UNBIND_DRIVER</a>:</td></tr>
<tr><th id="762">762</th><td>		<a class="macro" href="../../include/linux/printk.h.html#345" title="({ if (0) printk(&quot;\001&quot; &quot;7&quot; &quot;%s: Device %s, group %d unbinding from driver %s\n&quot;, __func__, dev_name(dev), iommu_group_id(group-&gt;iommu_group), dev-&gt;driver-&gt;name); 0; })" data-ref="_M/pr_debug">pr_debug</a>(<q>"%s: Device %s, group %d unbinding from driver %s\n"</q>,</td></tr>
<tr><th id="763">763</th><td>			 <b>__func__</b>, <a class="ref fn" href="../../include/linux/device.h.html#dev_name" title='dev_name' data-ref="dev_name">dev_name</a>(<a class="local col0 ref" href="#90dev" title='dev' data-ref="90dev">dev</a>),</td></tr>
<tr><th id="764">764</th><td>			 <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_id" title='iommu_group_id' data-ref="iommu_group_id">iommu_group_id</a>(<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>), <a class="local col0 ref" href="#90dev" title='dev' data-ref="90dev">dev</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#device::driver" title='device::driver' data-ref="device::driver">driver</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#device_driver::name" title='device_driver::name' data-ref="device_driver::name">name</a>);</td></tr>
<tr><th id="765">765</th><td>		<b>break</b>;</td></tr>
<tr><th id="766">766</th><td>	<b>case</b> <a class="macro" href="../../include/linux/iommu.h.html#287" title="6" data-ref="_M/IOMMU_GROUP_NOTIFY_UNBOUND_DRIVER">IOMMU_GROUP_NOTIFY_UNBOUND_DRIVER</a>:</td></tr>
<tr><th id="767">767</th><td>		<a class="macro" href="../../include/linux/printk.h.html#345" title="({ if (0) printk(&quot;\001&quot; &quot;7&quot; &quot;%s: Device %s, group %d unbound from driver\n&quot;, __func__, dev_name(dev), iommu_group_id(group-&gt;iommu_group)); 0; })" data-ref="_M/pr_debug">pr_debug</a>(<q>"%s: Device %s, group %d unbound from driver\n"</q>,</td></tr>
<tr><th id="768">768</th><td>			 <b>__func__</b>, <a class="ref fn" href="../../include/linux/device.h.html#dev_name" title='dev_name' data-ref="dev_name">dev_name</a>(<a class="local col0 ref" href="#90dev" title='dev' data-ref="90dev">dev</a>),</td></tr>
<tr><th id="769">769</th><td>			 <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_id" title='iommu_group_id' data-ref="iommu_group_id">iommu_group_id</a>(<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>));</td></tr>
<tr><th id="770">770</th><td>		<i>/*</i></td></tr>
<tr><th id="771">771</th><td><i>		 * XXX An unbound device in a live group is ok, but we'd</i></td></tr>
<tr><th id="772">772</th><td><i>		 * really like to avoid the above BUG_ON by preventing other</i></td></tr>
<tr><th id="773">773</th><td><i>		 * drivers from binding to it.  Once that occurs, we have to</i></td></tr>
<tr><th id="774">774</th><td><i>		 * stop the system to maintain isolation.  At a minimum, we'd</i></td></tr>
<tr><th id="775">775</th><td><i>		 * want a toggle to disable driver auto probe for this device.</i></td></tr>
<tr><th id="776">776</th><td><i>		 */</i></td></tr>
<tr><th id="777">777</th><td></td></tr>
<tr><th id="778">778</th><td>		<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a>-&gt;<a class="ref field" href="#vfio_group::unbound_lock" title='vfio_group::unbound_lock' data-ref="vfio_group::unbound_lock">unbound_lock</a>);</td></tr>
<tr><th id="779">779</th><td>		<a class="macro" href="../../include/linux/list.h.html#463" title="for (unbound = ({ void *__mptr = (void *)((&amp;group-&gt;unbound_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;group-&gt;unbound_list)-&gt;next)), typeof(((typeof(*unbound) *)0)-&gt;unbound_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;group-&gt;unbound_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_780(void) ; if (__cond) __compiletime_assert_780(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*unbound) *)(__mptr - __builtin_offsetof(typeof(*unbound), unbound_next))); }); &amp;unbound-&gt;unbound_next != (&amp;group-&gt;unbound_list); unbound = ({ void *__mptr = (void *)((unbound)-&gt;unbound_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((unbound)-&gt;unbound_next.next)), typeof(((typeof(*(unbound)) *)0)-&gt;unbound_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((unbound)-&gt;unbound_next.next)), typeof(void)))); extern void __compiletime_assert_780(void) ; if (__cond) __compiletime_assert_780(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(unbound)) *)(__mptr - __builtin_offsetof(typeof(*(unbound)), unbound_next))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col1 ref" href="#91unbound" title='unbound' data-ref="91unbound">unbound</a>,</td></tr>
<tr><th id="780">780</th><td>				    &amp;<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a>-&gt;<a class="ref field" href="#vfio_group::unbound_list" title='vfio_group::unbound_list' data-ref="vfio_group::unbound_list">unbound_list</a>, <a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='r' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='a' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='m' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='m' data-ref="vfio_unbound_dev::unbound_next"><a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='m' data-ref="vfio_unbound_dev::unbound_next">unbound_next</a></a></a></a></a>) {</td></tr>
<tr><th id="781">781</th><td>			<b>if</b> (<a class="local col0 ref" href="#90dev" title='dev' data-ref="90dev">dev</a> == <a class="local col1 ref" href="#91unbound" title='unbound' data-ref="91unbound">unbound</a>-&gt;<a class="tu ref field" href="#vfio_unbound_dev::dev" title='vfio_unbound_dev::dev' data-use='r' data-ref="vfio_unbound_dev::dev">dev</a>) {</td></tr>
<tr><th id="782">782</th><td>				<a class="ref fn" href="../../include/linux/list.h.html#list_del" title='list_del' data-ref="list_del">list_del</a>(&amp;<a class="local col1 ref" href="#91unbound" title='unbound' data-ref="91unbound">unbound</a>-&gt;<a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='a' data-ref="vfio_unbound_dev::unbound_next">unbound_next</a>);</td></tr>
<tr><th id="783">783</th><td>				<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col1 ref" href="#91unbound" title='unbound' data-ref="91unbound">unbound</a>);</td></tr>
<tr><th id="784">784</th><td>				<b>break</b>;</td></tr>
<tr><th id="785">785</th><td>			}</td></tr>
<tr><th id="786">786</th><td>		}</td></tr>
<tr><th id="787">787</th><td>		<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a>-&gt;<a class="ref field" href="#vfio_group::unbound_lock" title='vfio_group::unbound_lock' data-ref="vfio_group::unbound_lock">unbound_lock</a>);</td></tr>
<tr><th id="788">788</th><td>		<b>break</b>;</td></tr>
<tr><th id="789">789</th><td>	}</td></tr>
<tr><th id="790">790</th><td></td></tr>
<tr><th id="791">791</th><td>	<i>/*</i></td></tr>
<tr><th id="792">792</th><td><i>	 * If we're the last reference to the group, the group will be</i></td></tr>
<tr><th id="793">793</th><td><i>	 * released, which includes unregistering the iommu group notifier.</i></td></tr>
<tr><th id="794">794</th><td><i>	 * We hold a read-lock on that notifier list, unregistering needs</i></td></tr>
<tr><th id="795">795</th><td><i>	 * a write-lock... deadlock.  Release our reference asynchronously</i></td></tr>
<tr><th id="796">796</th><td><i>	 * to avoid that situation.</i></td></tr>
<tr><th id="797">797</th><td><i>	 */</i></td></tr>
<tr><th id="798">798</th><td>	<a class="tu ref fn" href="#vfio_group_schedule_put" title='vfio_group_schedule_put' data-use='c' data-ref="vfio_group_schedule_put">vfio_group_schedule_put</a>(<a class="local col9 ref" href="#89group" title='group' data-ref="89group">group</a>);</td></tr>
<tr><th id="799">799</th><td>	<b>return</b> <a class="macro" href="../../include/linux/notifier.h.html#185" title="0x0001" data-ref="_M/NOTIFY_OK">NOTIFY_OK</a>;</td></tr>
<tr><th id="800">800</th><td>}</td></tr>
<tr><th id="801">801</th><td></td></tr>
<tr><th id="802">802</th><td><i class="doc">/**</i></td></tr>
<tr><th id="803">803</th><td><i class="doc"> * VFIO driver API</i></td></tr>
<tr><th id="804">804</th><td><i class="doc"> */</i></td></tr>
<tr><th id="805">805</th><td><em>int</em> <dfn class="decl def fn" id="vfio_add_group_dev" title='vfio_add_group_dev' data-ref="vfio_add_group_dev">vfio_add_group_dev</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col2 decl" id="92dev" title='dev' data-type='struct device *' data-ref="92dev">dev</dfn>,</td></tr>
<tr><th id="806">806</th><td>		       <em>const</em> <b>struct</b> <a class="type" href="../../include/linux/vfio.h.html#vfio_device_ops" title='vfio_device_ops' data-ref="vfio_device_ops">vfio_device_ops</a> *<dfn class="local col3 decl" id="93ops" title='ops' data-type='const struct vfio_device_ops *' data-ref="93ops">ops</dfn>, <em>void</em> *<dfn class="local col4 decl" id="94device_data" title='device_data' data-type='void *' data-ref="94device_data">device_data</dfn>)</td></tr>
<tr><th id="807">807</th><td>{</td></tr>
<tr><th id="808">808</th><td>	<b>struct</b> <a class="type" href="../../include/linux/device.h.html#iommu_group" title='iommu_group' data-ref="iommu_group">iommu_group</a> *<dfn class="local col5 decl" id="95iommu_group" title='iommu_group' data-type='struct iommu_group *' data-ref="95iommu_group">iommu_group</dfn>;</td></tr>
<tr><th id="809">809</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col6 decl" id="96group" title='group' data-type='struct vfio_group *' data-ref="96group">group</dfn>;</td></tr>
<tr><th id="810">810</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col7 decl" id="97device" title='device' data-type='struct vfio_device *' data-ref="97device">device</dfn>;</td></tr>
<tr><th id="811">811</th><td></td></tr>
<tr><th id="812">812</th><td>	<a class="local col5 ref" href="#95iommu_group" title='iommu_group' data-ref="95iommu_group">iommu_group</a> = <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_get" title='iommu_group_get' data-ref="iommu_group_get">iommu_group_get</a>(<a class="local col2 ref" href="#92dev" title='dev' data-ref="92dev">dev</a>);</td></tr>
<tr><th id="813">813</th><td>	<b>if</b> (!<a class="local col5 ref" href="#95iommu_group" title='iommu_group' data-ref="95iommu_group">iommu_group</a>)</td></tr>
<tr><th id="814">814</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="815">815</th><td></td></tr>
<tr><th id="816">816</th><td>	<a class="local col6 ref" href="#96group" title='group' data-ref="96group">group</a> = <a class="tu ref fn" href="#vfio_group_get_from_iommu" title='vfio_group_get_from_iommu' data-use='c' data-ref="vfio_group_get_from_iommu">vfio_group_get_from_iommu</a>(<a class="local col5 ref" href="#95iommu_group" title='iommu_group' data-ref="95iommu_group">iommu_group</a>);</td></tr>
<tr><th id="817">817</th><td>	<b>if</b> (!<a class="local col6 ref" href="#96group" title='group' data-ref="96group">group</a>) {</td></tr>
<tr><th id="818">818</th><td>		<a class="local col6 ref" href="#96group" title='group' data-ref="96group">group</a> = <a class="tu ref fn" href="#vfio_create_group" title='vfio_create_group' data-use='c' data-ref="vfio_create_group">vfio_create_group</a>(<a class="local col5 ref" href="#95iommu_group" title='iommu_group' data-ref="95iommu_group">iommu_group</a>);</td></tr>
<tr><th id="819">819</th><td>		<b>if</b> (<a class="ref fn" href="../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="local col6 ref" href="#96group" title='group' data-ref="96group">group</a>)) {</td></tr>
<tr><th id="820">820</th><td>			<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_put" title='iommu_group_put' data-ref="iommu_group_put">iommu_group_put</a>(<a class="local col5 ref" href="#95iommu_group" title='iommu_group' data-ref="95iommu_group">iommu_group</a>);</td></tr>
<tr><th id="821">821</th><td>			<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR">PTR_ERR</a>(<a class="local col6 ref" href="#96group" title='group' data-ref="96group">group</a>);</td></tr>
<tr><th id="822">822</th><td>		}</td></tr>
<tr><th id="823">823</th><td>	} <b>else</b> {</td></tr>
<tr><th id="824">824</th><td>		<i>/*</i></td></tr>
<tr><th id="825">825</th><td><i>		 * A found vfio_group already holds a reference to the</i></td></tr>
<tr><th id="826">826</th><td><i>		 * iommu_group.  A created vfio_group keeps the reference.</i></td></tr>
<tr><th id="827">827</th><td><i>		 */</i></td></tr>
<tr><th id="828">828</th><td>		<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_put" title='iommu_group_put' data-ref="iommu_group_put">iommu_group_put</a>(<a class="local col5 ref" href="#95iommu_group" title='iommu_group' data-ref="95iommu_group">iommu_group</a>);</td></tr>
<tr><th id="829">829</th><td>	}</td></tr>
<tr><th id="830">830</th><td></td></tr>
<tr><th id="831">831</th><td>	<a class="local col7 ref" href="#97device" title='device' data-ref="97device">device</a> = <a class="tu ref fn" href="#vfio_group_get_device" title='vfio_group_get_device' data-use='c' data-ref="vfio_group_get_device">vfio_group_get_device</a>(<a class="local col6 ref" href="#96group" title='group' data-ref="96group">group</a>, <a class="local col2 ref" href="#92dev" title='dev' data-ref="92dev">dev</a>);</td></tr>
<tr><th id="832">832</th><td>	<b>if</b> (<a class="local col7 ref" href="#97device" title='device' data-ref="97device">device</a>) {</td></tr>
<tr><th id="833">833</th><td>		<a class="macro" href="../../include/asm-generic/bug.h.html#120" title="({ int __ret_warn_on = !!(1); if (__builtin_expect(!!(__ret_warn_on), 0)) do { __warn_printk(&quot;Device %s already exists on group %d\n&quot;, dev_name(dev), iommu_group_id(iommu_group)); do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/drivers/vfio/vfio.c&quot;), &quot;i&quot; (834), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (78)); }); } while (0); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN">WARN</a>(<var>1</var>, <q>"Device %s already exists on group %d\n"</q>,</td></tr>
<tr><th id="834">834</th><td>		     <a class="ref fn" href="../../include/linux/device.h.html#dev_name" title='dev_name' data-ref="dev_name">dev_name</a>(<a class="local col2 ref" href="#92dev" title='dev' data-ref="92dev">dev</a>), <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_id" title='iommu_group_id' data-ref="iommu_group_id">iommu_group_id</a>(<a class="local col5 ref" href="#95iommu_group" title='iommu_group' data-ref="95iommu_group">iommu_group</a>));</td></tr>
<tr><th id="835">835</th><td>		<a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put">vfio_device_put</a>(<a class="local col7 ref" href="#97device" title='device' data-ref="97device">device</a>);</td></tr>
<tr><th id="836">836</th><td>		<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col6 ref" href="#96group" title='group' data-ref="96group">group</a>);</td></tr>
<tr><th id="837">837</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#20" title="16" data-ref="_M/EBUSY">EBUSY</a>;</td></tr>
<tr><th id="838">838</th><td>	}</td></tr>
<tr><th id="839">839</th><td></td></tr>
<tr><th id="840">840</th><td>	<a class="local col7 ref" href="#97device" title='device' data-ref="97device">device</a> = <a class="tu ref fn" href="#vfio_group_create_device" title='vfio_group_create_device' data-use='c' data-ref="vfio_group_create_device">vfio_group_create_device</a>(<a class="local col6 ref" href="#96group" title='group' data-ref="96group">group</a>, <a class="local col2 ref" href="#92dev" title='dev' data-ref="92dev">dev</a>, <a class="local col3 ref" href="#93ops" title='ops' data-ref="93ops">ops</a>, <a class="local col4 ref" href="#94device_data" title='device_data' data-ref="94device_data">device_data</a>);</td></tr>
<tr><th id="841">841</th><td>	<b>if</b> (<a class="ref fn" href="../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="local col7 ref" href="#97device" title='device' data-ref="97device">device</a>)) {</td></tr>
<tr><th id="842">842</th><td>		<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col6 ref" href="#96group" title='group' data-ref="96group">group</a>);</td></tr>
<tr><th id="843">843</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR">PTR_ERR</a>(<a class="local col7 ref" href="#97device" title='device' data-ref="97device">device</a>);</td></tr>
<tr><th id="844">844</th><td>	}</td></tr>
<tr><th id="845">845</th><td></td></tr>
<tr><th id="846">846</th><td>	<i>/*</i></td></tr>
<tr><th id="847">847</th><td><i>	 * Drop all but the vfio_device reference.  The vfio_device holds</i></td></tr>
<tr><th id="848">848</th><td><i>	 * a reference to the vfio_group, which holds a reference to the</i></td></tr>
<tr><th id="849">849</th><td><i>	 * iommu_group.</i></td></tr>
<tr><th id="850">850</th><td><i>	 */</i></td></tr>
<tr><th id="851">851</th><td>	<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col6 ref" href="#96group" title='group' data-ref="96group">group</a>);</td></tr>
<tr><th id="852">852</th><td></td></tr>
<tr><th id="853">853</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="854">854</th><td>}</td></tr>
<tr><th id="855">855</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_add_group_dev) vfio_add_group_dev; static const char __kstrtab_vfio_add_group_dev[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_add_group_dev&quot;; static const struct kernel_symbol __ksymtab_vfio_add_group_dev __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_add_group_dev&quot;), used)) = { (unsigned long)&amp;vfio_add_group_dev, __kstrtab_vfio_add_group_dev }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_add_group_dev" title='vfio_add_group_dev' data-ref="vfio_add_group_dev"><a class="ref fn" href="#vfio_add_group_dev" title='vfio_add_group_dev' data-ref="vfio_add_group_dev"><a class="ref fn" href="#vfio_add_group_dev" title='vfio_add_group_dev' data-ref="vfio_add_group_dev"><a class="ref fn" href="#vfio_add_group_dev" title='vfio_add_group_dev' data-ref="vfio_add_group_dev">vfio_add_group_dev</a></a></a></a>);</td></tr>
<tr><th id="856">856</th><td></td></tr>
<tr><th id="857">857</th><td><i class="doc">/**</i></td></tr>
<tr><th id="858">858</th><td><i class="doc"> * Get a reference to the vfio_device for a device.  Even if the</i></td></tr>
<tr><th id="859">859</th><td><i class="doc"> * caller thinks they own the device, they could be racing with a</i></td></tr>
<tr><th id="860">860</th><td><i class="doc"> * release call path, so we can't trust drvdata for the shortcut.</i></td></tr>
<tr><th id="861">861</th><td><i class="doc"> * Go the long way around, from the iommu_group to the vfio_group</i></td></tr>
<tr><th id="862">862</th><td><i class="doc"> * to the vfio_device.</i></td></tr>
<tr><th id="863">863</th><td><i class="doc"> */</i></td></tr>
<tr><th id="864">864</th><td><b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="decl def fn" id="vfio_device_get_from_dev" title='vfio_device_get_from_dev' data-ref="vfio_device_get_from_dev">vfio_device_get_from_dev</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col8 decl" id="98dev" title='dev' data-type='struct device *' data-ref="98dev">dev</dfn>)</td></tr>
<tr><th id="865">865</th><td>{</td></tr>
<tr><th id="866">866</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col9 decl" id="99group" title='group' data-type='struct vfio_group *' data-ref="99group">group</dfn>;</td></tr>
<tr><th id="867">867</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col0 decl" id="100device" title='device' data-type='struct vfio_device *' data-ref="100device">device</dfn>;</td></tr>
<tr><th id="868">868</th><td></td></tr>
<tr><th id="869">869</th><td>	<a class="local col9 ref" href="#99group" title='group' data-ref="99group">group</a> = <a class="tu ref fn" href="#vfio_group_get_from_dev" title='vfio_group_get_from_dev' data-use='c' data-ref="vfio_group_get_from_dev">vfio_group_get_from_dev</a>(<a class="local col8 ref" href="#98dev" title='dev' data-ref="98dev">dev</a>);</td></tr>
<tr><th id="870">870</th><td>	<b>if</b> (!<a class="local col9 ref" href="#99group" title='group' data-ref="99group">group</a>)</td></tr>
<tr><th id="871">871</th><td>		<b>return</b> <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="872">872</th><td></td></tr>
<tr><th id="873">873</th><td>	<a class="local col0 ref" href="#100device" title='device' data-ref="100device">device</a> = <a class="tu ref fn" href="#vfio_group_get_device" title='vfio_group_get_device' data-use='c' data-ref="vfio_group_get_device">vfio_group_get_device</a>(<a class="local col9 ref" href="#99group" title='group' data-ref="99group">group</a>, <a class="local col8 ref" href="#98dev" title='dev' data-ref="98dev">dev</a>);</td></tr>
<tr><th id="874">874</th><td>	<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col9 ref" href="#99group" title='group' data-ref="99group">group</a>);</td></tr>
<tr><th id="875">875</th><td></td></tr>
<tr><th id="876">876</th><td>	<b>return</b> <a class="local col0 ref" href="#100device" title='device' data-ref="100device">device</a>;</td></tr>
<tr><th id="877">877</th><td>}</td></tr>
<tr><th id="878">878</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_device_get_from_dev) vfio_device_get_from_dev; static const char __kstrtab_vfio_device_get_from_dev[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_device_get_from_dev&quot;; static const struct kernel_symbol __ksymtab_vfio_device_get_from_dev __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_device_get_from_dev&quot;), used)) = { (unsigned long)&amp;vfio_device_get_from_dev, __kstrtab_vfio_device_get_from_dev }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_device_get_from_dev" title='vfio_device_get_from_dev' data-ref="vfio_device_get_from_dev"><a class="ref fn" href="#vfio_device_get_from_dev" title='vfio_device_get_from_dev' data-ref="vfio_device_get_from_dev"><a class="ref fn" href="#vfio_device_get_from_dev" title='vfio_device_get_from_dev' data-ref="vfio_device_get_from_dev"><a class="ref fn" href="#vfio_device_get_from_dev" title='vfio_device_get_from_dev' data-ref="vfio_device_get_from_dev">vfio_device_get_from_dev</a></a></a></a>);</td></tr>
<tr><th id="879">879</th><td></td></tr>
<tr><th id="880">880</th><td><em>static</em> <b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="tu decl def fn" id="vfio_device_get_from_name" title='vfio_device_get_from_name' data-type='struct vfio_device * vfio_device_get_from_name(struct vfio_group * group, char * buf)' data-ref="vfio_device_get_from_name">vfio_device_get_from_name</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col1 decl" id="101group" title='group' data-type='struct vfio_group *' data-ref="101group">group</dfn>,</td></tr>
<tr><th id="881">881</th><td>						     <em>char</em> *<dfn class="local col2 decl" id="102buf" title='buf' data-type='char *' data-ref="102buf">buf</dfn>)</td></tr>
<tr><th id="882">882</th><td>{</td></tr>
<tr><th id="883">883</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col3 decl" id="103it" title='it' data-type='struct vfio_device *' data-ref="103it">it</dfn>, *<dfn class="local col4 decl" id="104device" title='device' data-type='struct vfio_device *' data-ref="104device">device</dfn> = <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="884">884</th><td></td></tr>
<tr><th id="885">885</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="local col1 ref" href="#101group" title='group' data-ref="101group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_lock" title='vfio_group::device_lock' data-ref="vfio_group::device_lock">device_lock</a>);</td></tr>
<tr><th id="886">886</th><td>	<a class="macro" href="../../include/linux/list.h.html#463" title="for (it = ({ void *__mptr = (void *)((&amp;group-&gt;device_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;group-&gt;device_list)-&gt;next)), typeof(((typeof(*it) *)0)-&gt;group_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;group-&gt;device_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_886(void) ; if (__cond) __compiletime_assert_886(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*it) *)(__mptr - __builtin_offsetof(typeof(*it), group_next))); }); &amp;it-&gt;group_next != (&amp;group-&gt;device_list); it = ({ void *__mptr = (void *)((it)-&gt;group_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((it)-&gt;group_next.next)), typeof(((typeof(*(it)) *)0)-&gt;group_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((it)-&gt;group_next.next)), typeof(void)))); extern void __compiletime_assert_886(void) ; if (__cond) __compiletime_assert_886(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(it)) *)(__mptr - __builtin_offsetof(typeof(*(it)), group_next))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col3 ref" href="#103it" title='it' data-ref="103it">it</a>, &amp;<a class="local col1 ref" href="#101group" title='group' data-ref="101group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_list" title='vfio_group::device_list' data-ref="vfio_group::device_list">device_list</a>, <a class="ref field" href="#vfio_device::group_next" title='vfio_device::group_next' data-ref="vfio_device::group_next">group_next</a>) {</td></tr>
<tr><th id="887">887</th><td>		<b>if</b> (!<a class="ref fn" href="../../arch/x86/include/asm/string_64.h.html#strcmp" title='strcmp' data-ref="strcmp">strcmp</a>(<a class="ref fn" href="../../include/linux/device.h.html#dev_name" title='dev_name' data-ref="dev_name">dev_name</a>(<a class="local col3 ref" href="#103it" title='it' data-ref="103it">it</a>-&gt;<a class="ref field" href="#vfio_device::dev" title='vfio_device::dev' data-ref="vfio_device::dev">dev</a>), <a class="local col2 ref" href="#102buf" title='buf' data-ref="102buf">buf</a>)) {</td></tr>
<tr><th id="888">888</th><td>			<a class="local col4 ref" href="#104device" title='device' data-ref="104device">device</a> = <a class="local col3 ref" href="#103it" title='it' data-ref="103it">it</a>;</td></tr>
<tr><th id="889">889</th><td>			<a class="tu ref fn" href="#vfio_device_get" title='vfio_device_get' data-use='c' data-ref="vfio_device_get">vfio_device_get</a>(<a class="local col4 ref" href="#104device" title='device' data-ref="104device">device</a>);</td></tr>
<tr><th id="890">890</th><td>			<b>break</b>;</td></tr>
<tr><th id="891">891</th><td>		}</td></tr>
<tr><th id="892">892</th><td>	}</td></tr>
<tr><th id="893">893</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="local col1 ref" href="#101group" title='group' data-ref="101group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_lock" title='vfio_group::device_lock' data-ref="vfio_group::device_lock">device_lock</a>);</td></tr>
<tr><th id="894">894</th><td></td></tr>
<tr><th id="895">895</th><td>	<b>return</b> <a class="local col4 ref" href="#104device" title='device' data-ref="104device">device</a>;</td></tr>
<tr><th id="896">896</th><td>}</td></tr>
<tr><th id="897">897</th><td></td></tr>
<tr><th id="898">898</th><td><i>/*</i></td></tr>
<tr><th id="899">899</th><td><i> * Caller must hold a reference to the vfio_device</i></td></tr>
<tr><th id="900">900</th><td><i> */</i></td></tr>
<tr><th id="901">901</th><td><em>void</em> *<dfn class="decl def fn" id="vfio_device_data" title='vfio_device_data' data-ref="vfio_device_data">vfio_device_data</dfn>(<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col5 decl" id="105device" title='device' data-type='struct vfio_device *' data-ref="105device">device</dfn>)</td></tr>
<tr><th id="902">902</th><td>{</td></tr>
<tr><th id="903">903</th><td>	<b>return</b> <a class="local col5 ref" href="#105device" title='device' data-ref="105device">device</a>-&gt;<a class="ref field" href="#vfio_device::device_data" title='vfio_device::device_data' data-ref="vfio_device::device_data">device_data</a>;</td></tr>
<tr><th id="904">904</th><td>}</td></tr>
<tr><th id="905">905</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_device_data) vfio_device_data; static const char __kstrtab_vfio_device_data[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_device_data&quot;; static const struct kernel_symbol __ksymtab_vfio_device_data __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_device_data&quot;), used)) = { (unsigned long)&amp;vfio_device_data, __kstrtab_vfio_device_data }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_device_data" title='vfio_device_data' data-ref="vfio_device_data"><a class="ref fn" href="#vfio_device_data" title='vfio_device_data' data-ref="vfio_device_data"><a class="ref fn" href="#vfio_device_data" title='vfio_device_data' data-ref="vfio_device_data"><a class="ref fn" href="#vfio_device_data" title='vfio_device_data' data-ref="vfio_device_data">vfio_device_data</a></a></a></a>);</td></tr>
<tr><th id="906">906</th><td></td></tr>
<tr><th id="907">907</th><td><i  data-doc="vfio_dev_present">/* Given a referenced group, check if it contains the device */</i></td></tr>
<tr><th id="908">908</th><td><em>static</em> <a class="typedef" href="../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="tu decl def fn" id="vfio_dev_present" title='vfio_dev_present' data-type='bool vfio_dev_present(struct vfio_group * group, struct device * dev)' data-ref="vfio_dev_present">vfio_dev_present</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col6 decl" id="106group" title='group' data-type='struct vfio_group *' data-ref="106group">group</dfn>, <b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col7 decl" id="107dev" title='dev' data-type='struct device *' data-ref="107dev">dev</dfn>)</td></tr>
<tr><th id="909">909</th><td>{</td></tr>
<tr><th id="910">910</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col8 decl" id="108device" title='device' data-type='struct vfio_device *' data-ref="108device">device</dfn>;</td></tr>
<tr><th id="911">911</th><td></td></tr>
<tr><th id="912">912</th><td>	<a class="local col8 ref" href="#108device" title='device' data-ref="108device">device</a> = <a class="tu ref fn" href="#vfio_group_get_device" title='vfio_group_get_device' data-use='c' data-ref="vfio_group_get_device">vfio_group_get_device</a>(<a class="local col6 ref" href="#106group" title='group' data-ref="106group">group</a>, <a class="local col7 ref" href="#107dev" title='dev' data-ref="107dev">dev</a>);</td></tr>
<tr><th id="913">913</th><td>	<b>if</b> (!<a class="local col8 ref" href="#108device" title='device' data-ref="108device">device</a>)</td></tr>
<tr><th id="914">914</th><td>		<b>return</b> <a class="enum" href="../../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="915">915</th><td></td></tr>
<tr><th id="916">916</th><td>	<a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put">vfio_device_put</a>(<a class="local col8 ref" href="#108device" title='device' data-ref="108device">device</a>);</td></tr>
<tr><th id="917">917</th><td>	<b>return</b> <a class="enum" href="../../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="918">918</th><td>}</td></tr>
<tr><th id="919">919</th><td></td></tr>
<tr><th id="920">920</th><td><i>/*</i></td></tr>
<tr><th id="921">921</th><td><i> * Decrement the device reference count and wait for the device to be</i></td></tr>
<tr><th id="922">922</th><td><i> * removed.  Open file descriptors for the device... */</i></td></tr>
<tr><th id="923">923</th><td><em>void</em> *<dfn class="decl def fn" id="vfio_del_group_dev" title='vfio_del_group_dev' data-ref="vfio_del_group_dev">vfio_del_group_dev</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col9 decl" id="109dev" title='dev' data-type='struct device *' data-ref="109dev">dev</dfn>)</td></tr>
<tr><th id="924">924</th><td>{</td></tr>
<tr><th id="925">925</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col0 decl" id="110device" title='device' data-type='struct vfio_device *' data-ref="110device">device</dfn> = <a class="ref fn" href="../../include/linux/device.h.html#dev_get_drvdata" title='dev_get_drvdata' data-ref="dev_get_drvdata">dev_get_drvdata</a>(<a class="local col9 ref" href="#109dev" title='dev' data-ref="109dev">dev</a>);</td></tr>
<tr><th id="926">926</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col1 decl" id="111group" title='group' data-type='struct vfio_group *' data-ref="111group">group</dfn> = <a class="local col0 ref" href="#110device" title='device' data-ref="110device">device</a>-&gt;<a class="ref field" href="#vfio_device::group" title='vfio_device::group' data-ref="vfio_device::group">group</a>;</td></tr>
<tr><th id="927">927</th><td>	<em>void</em> *<dfn class="local col2 decl" id="112device_data" title='device_data' data-type='void *' data-ref="112device_data">device_data</dfn> = <a class="local col0 ref" href="#110device" title='device' data-ref="110device">device</a>-&gt;<a class="ref field" href="#vfio_device::device_data" title='vfio_device::device_data' data-ref="vfio_device::device_data">device_data</a>;</td></tr>
<tr><th id="928">928</th><td>	<b>struct</b> <a class="type" href="#vfio_unbound_dev" title='vfio_unbound_dev' data-ref="vfio_unbound_dev">vfio_unbound_dev</a> *<dfn class="local col3 decl" id="113unbound" title='unbound' data-type='struct vfio_unbound_dev *' data-ref="113unbound">unbound</dfn>;</td></tr>
<tr><th id="929">929</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col4 decl" id="114i" title='i' data-type='unsigned int' data-ref="114i">i</dfn> = <var>0</var>;</td></tr>
<tr><th id="930">930</th><td>	<em>long</em> <dfn class="local col5 decl" id="115ret" title='ret' data-type='long' data-ref="115ret">ret</dfn>;</td></tr>
<tr><th id="931">931</th><td>	<a class="typedef" href="../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="local col6 decl" id="116interrupted" title='interrupted' data-type='bool' data-ref="116interrupted">interrupted</dfn> = <a class="enum" href="../../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="932">932</th><td></td></tr>
<tr><th id="933">933</th><td>	<i>/*</i></td></tr>
<tr><th id="934">934</th><td><i>	 * The group exists so long as we have a device reference.  Get</i></td></tr>
<tr><th id="935">935</th><td><i>	 * a group reference and use it to scan for the device going away.</i></td></tr>
<tr><th id="936">936</th><td><i>	 */</i></td></tr>
<tr><th id="937">937</th><td>	<a class="tu ref fn" href="#vfio_group_get" title='vfio_group_get' data-use='c' data-ref="vfio_group_get">vfio_group_get</a>(<a class="local col1 ref" href="#111group" title='group' data-ref="111group">group</a>);</td></tr>
<tr><th id="938">938</th><td></td></tr>
<tr><th id="939">939</th><td>	<i>/*</i></td></tr>
<tr><th id="940">940</th><td><i>	 * When the device is removed from the group, the group suddenly</i></td></tr>
<tr><th id="941">941</th><td><i>	 * becomes non-viable; the device has a driver (until the unbind</i></td></tr>
<tr><th id="942">942</th><td><i>	 * completes), but it's not present in the group.  This is bad news</i></td></tr>
<tr><th id="943">943</th><td><i>	 * for any external users that need to re-acquire a group reference</i></td></tr>
<tr><th id="944">944</th><td><i>	 * in order to match and release their existing reference.  To</i></td></tr>
<tr><th id="945">945</th><td><i>	 * solve this, we track such devices on the unbound_list to bridge</i></td></tr>
<tr><th id="946">946</th><td><i>	 * the gap until they're fully unbound.</i></td></tr>
<tr><th id="947">947</th><td><i>	 */</i></td></tr>
<tr><th id="948">948</th><td>	<a class="local col3 ref" href="#113unbound" title='unbound' data-ref="113unbound">unbound</a> = <a class="ref fn" href="../../include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc">kzalloc</a>(<b>sizeof</b>(*<a class="local col3 ref" href="#113unbound" title='unbound' data-ref="113unbound">unbound</a>), <a class="macro" href="../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x200000u|0x400000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="949">949</th><td>	<b>if</b> (<a class="local col3 ref" href="#113unbound" title='unbound' data-ref="113unbound">unbound</a>) {</td></tr>
<tr><th id="950">950</th><td>		<a class="local col3 ref" href="#113unbound" title='unbound' data-ref="113unbound">unbound</a>-&gt;<a class="tu ref field" href="#vfio_unbound_dev::dev" title='vfio_unbound_dev::dev' data-use='w' data-ref="vfio_unbound_dev::dev">dev</a> = <a class="local col9 ref" href="#109dev" title='dev' data-ref="109dev">dev</a>;</td></tr>
<tr><th id="951">951</th><td>		<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="local col1 ref" href="#111group" title='group' data-ref="111group">group</a>-&gt;<a class="ref field" href="#vfio_group::unbound_lock" title='vfio_group::unbound_lock' data-ref="vfio_group::unbound_lock">unbound_lock</a>);</td></tr>
<tr><th id="952">952</th><td>		<a class="ref fn" href="../../include/linux/list.h.html#list_add" title='list_add' data-ref="list_add">list_add</a>(&amp;<a class="local col3 ref" href="#113unbound" title='unbound' data-ref="113unbound">unbound</a>-&gt;<a class="tu ref field" href="#vfio_unbound_dev::unbound_next" title='vfio_unbound_dev::unbound_next' data-use='a' data-ref="vfio_unbound_dev::unbound_next">unbound_next</a>, &amp;<a class="local col1 ref" href="#111group" title='group' data-ref="111group">group</a>-&gt;<a class="ref field" href="#vfio_group::unbound_list" title='vfio_group::unbound_list' data-ref="vfio_group::unbound_list">unbound_list</a>);</td></tr>
<tr><th id="953">953</th><td>		<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="local col1 ref" href="#111group" title='group' data-ref="111group">group</a>-&gt;<a class="ref field" href="#vfio_group::unbound_lock" title='vfio_group::unbound_lock' data-ref="vfio_group::unbound_lock">unbound_lock</a>);</td></tr>
<tr><th id="954">954</th><td>	}</td></tr>
<tr><th id="955">955</th><td>	<a class="macro" href="../../include/asm-generic/bug.h.html#111" title="({ int __ret_warn_on = !!(!unbound); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/drivers/vfio/vfio.c&quot;), &quot;i&quot; (955), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (80)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col3 ref" href="#113unbound" title='unbound' data-ref="113unbound">unbound</a>);</td></tr>
<tr><th id="956">956</th><td></td></tr>
<tr><th id="957">957</th><td>	<a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put">vfio_device_put</a>(<a class="local col0 ref" href="#110device" title='device' data-ref="110device">device</a>);</td></tr>
<tr><th id="958">958</th><td></td></tr>
<tr><th id="959">959</th><td>	<i>/*</i></td></tr>
<tr><th id="960">960</th><td><i>	 * If the device is still present in the group after the above</i></td></tr>
<tr><th id="961">961</th><td><i>	 * 'put', then it is in use and we need to request it from the</i></td></tr>
<tr><th id="962">962</th><td><i>	 * bus driver.  The driver may in turn need to request the</i></td></tr>
<tr><th id="963">963</th><td><i>	 * device from the user.  We send the request on an arbitrary</i></td></tr>
<tr><th id="964">964</th><td><i>	 * interval with counter to allow the driver to take escalating</i></td></tr>
<tr><th id="965">965</th><td><i>	 * measures to release the device if it has the ability to do so.</i></td></tr>
<tr><th id="966">966</th><td><i>	 */</i></td></tr>
<tr><th id="967">967</th><td>	<b>do</b> {</td></tr>
<tr><th id="968">968</th><td>		<a class="local col0 ref" href="#110device" title='device' data-ref="110device">device</a> = <a class="tu ref fn" href="#vfio_group_get_device" title='vfio_group_get_device' data-use='c' data-ref="vfio_group_get_device">vfio_group_get_device</a>(<a class="local col1 ref" href="#111group" title='group' data-ref="111group">group</a>, <a class="local col9 ref" href="#109dev" title='dev' data-ref="109dev">dev</a>);</td></tr>
<tr><th id="969">969</th><td>		<b>if</b> (!<a class="local col0 ref" href="#110device" title='device' data-ref="110device">device</a>)</td></tr>
<tr><th id="970">970</th><td>			<b>break</b>;</td></tr>
<tr><th id="971">971</th><td></td></tr>
<tr><th id="972">972</th><td>		<b>if</b> (<a class="local col0 ref" href="#110device" title='device' data-ref="110device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::request" title='vfio_device_ops::request' data-ref="vfio_device_ops::request">request</a>)</td></tr>
<tr><th id="973">973</th><td>			<a class="local col0 ref" href="#110device" title='device' data-ref="110device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::request" title='vfio_device_ops::request' data-ref="vfio_device_ops::request">request</a>(<a class="local col2 ref" href="#112device_data" title='device_data' data-ref="112device_data">device_data</a>, <a class="local col4 ref" href="#114i" title='i' data-ref="114i">i</a>++);</td></tr>
<tr><th id="974">974</th><td></td></tr>
<tr><th id="975">975</th><td>		<a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put">vfio_device_put</a>(<a class="local col0 ref" href="#110device" title='device' data-ref="110device">device</a>);</td></tr>
<tr><th id="976">976</th><td></td></tr>
<tr><th id="977">977</th><td>		<b>if</b> (<a class="local col6 ref" href="#116interrupted" title='interrupted' data-ref="116interrupted">interrupted</a>) {</td></tr>
<tr><th id="978">978</th><td>			<a class="local col5 ref" href="#115ret" title='ret' data-ref="115ret">ret</a> = <a class="macro" href="../../include/linux/wait.h.html#358" title="({ long __ret = 100 * 10; do { do { } while (0); } while (0); if (!({ bool __cond = (!vfio_dev_present(group, dev)); if (__cond &amp;&amp; !__ret) __ret = 1; __cond || !__ret; })) __ret = ({ __label__ __out; struct wait_queue_entry __wq_entry; long __ret = 100 * 10; init_wait_entry(&amp;__wq_entry, 0 ? 0x01 : 0); for (;;) { long __int = prepare_to_wait_event(&amp;vfio.release_q, &amp;__wq_entry, 0x0002); if (({ bool __cond = (!vfio_dev_present(group, dev)); if (__cond &amp;&amp; !__ret) __ret = 1; __cond || !__ret; })) break; if ((!__builtin_constant_p(0x0002) || 0x0002 == 0x0001 || 0x0002 == (0x0100 | 0x0002)) &amp;&amp; __int) { __ret = __int; goto __out; } __ret = schedule_timeout(__ret); } finish_wait(&amp;vfio.release_q, &amp;__wq_entry); __out: __ret; }); __ret; })" data-ref="_M/wait_event_timeout">wait_event_timeout</a>(<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::release_q" title='vfio::release_q' data-use='a' data-ref="vfio::release_q">release_q</a>,</td></tr>
<tr><th id="979">979</th><td>					!<a class="tu ref fn" href="#vfio_dev_present" title='vfio_dev_present' data-use='c' data-ref="vfio_dev_present">vfio_dev_present</a>(<a class="local col1 ref" href="#111group" title='group' data-ref="111group">group</a>, <a class="local col9 ref" href="#109dev" title='dev' data-ref="109dev">dev</a>), <a class="macro" href="../../include/asm-generic/param.h.html#8" title="100" data-ref="_M/HZ">HZ</a> * <var>10</var>);</td></tr>
<tr><th id="980">980</th><td>		} <b>else</b> {</td></tr>
<tr><th id="981">981</th><td>			<a class="local col5 ref" href="#115ret" title='ret' data-ref="115ret">ret</a> = <a class="macro" href="../../include/linux/wait.h.html#476" title="({ long __ret = 100 * 10; do { do { } while (0); } while (0); if (!({ bool __cond = (!vfio_dev_present(group, dev)); if (__cond &amp;&amp; !__ret) __ret = 1; __cond || !__ret; })) __ret = ({ __label__ __out; struct wait_queue_entry __wq_entry; long __ret = 100 * 10; init_wait_entry(&amp;__wq_entry, 0 ? 0x01 : 0); for (;;) { long __int = prepare_to_wait_event(&amp;vfio.release_q, &amp;__wq_entry, 0x0001); if (({ bool __cond = (!vfio_dev_present(group, dev)); if (__cond &amp;&amp; !__ret) __ret = 1; __cond || !__ret; })) break; if ((!__builtin_constant_p(0x0001) || 0x0001 == 0x0001 || 0x0001 == (0x0100 | 0x0002)) &amp;&amp; __int) { __ret = __int; goto __out; } __ret = schedule_timeout(__ret); } finish_wait(&amp;vfio.release_q, &amp;__wq_entry); __out: __ret; }); __ret; })" data-ref="_M/wait_event_interruptible_timeout">wait_event_interruptible_timeout</a>(<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::release_q" title='vfio::release_q' data-use='a' data-ref="vfio::release_q">release_q</a>,</td></tr>
<tr><th id="982">982</th><td>					!<a class="tu ref fn" href="#vfio_dev_present" title='vfio_dev_present' data-use='c' data-ref="vfio_dev_present">vfio_dev_present</a>(<a class="local col1 ref" href="#111group" title='group' data-ref="111group">group</a>, <a class="local col9 ref" href="#109dev" title='dev' data-ref="109dev">dev</a>), <a class="macro" href="../../include/asm-generic/param.h.html#8" title="100" data-ref="_M/HZ">HZ</a> * <var>10</var>);</td></tr>
<tr><th id="983">983</th><td>			<b>if</b> (<a class="local col5 ref" href="#115ret" title='ret' data-ref="115ret">ret</a> == -<a class="macro" href="../../include/linux/errno.h.html#14" title="512" data-ref="_M/ERESTARTSYS">ERESTARTSYS</a>) {</td></tr>
<tr><th id="984">984</th><td>				<a class="local col6 ref" href="#116interrupted" title='interrupted' data-ref="116interrupted">interrupted</a> = <a class="enum" href="../../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="985">985</th><td>				<a class="ref fn" href="../../include/linux/device.h.html#dev_warn" title='dev_warn' data-ref="dev_warn">dev_warn</a>(<a class="local col9 ref" href="#109dev" title='dev' data-ref="109dev">dev</a>,</td></tr>
<tr><th id="986">986</th><td>					 <q>"Device is currently in use, task"</q></td></tr>
<tr><th id="987">987</th><td>					 <q>" \"%s\" (%d) "</q></td></tr>
<tr><th id="988">988</th><td>					 <q>"blocked until device is released"</q>,</td></tr>
<tr><th id="989">989</th><td>					 <a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::comm" title='task_struct::comm' data-ref="task_struct::comm">comm</a>, <a class="ref fn" href="../../include/linux/sched.h.html#task_pid_nr" title='task_pid_nr' data-ref="task_pid_nr">task_pid_nr</a>(<a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>));</td></tr>
<tr><th id="990">990</th><td>			}</td></tr>
<tr><th id="991">991</th><td>		}</td></tr>
<tr><th id="992">992</th><td>	} <b>while</b> (<a class="local col5 ref" href="#115ret" title='ret' data-ref="115ret">ret</a> &lt;= <var>0</var>);</td></tr>
<tr><th id="993">993</th><td></td></tr>
<tr><th id="994">994</th><td>	<i>/*</i></td></tr>
<tr><th id="995">995</th><td><i>	 * In order to support multiple devices per group, devices can be</i></td></tr>
<tr><th id="996">996</th><td><i>	 * plucked from the group while other devices in the group are still</i></td></tr>
<tr><th id="997">997</th><td><i>	 * in use.  The container persists with this group and those remaining</i></td></tr>
<tr><th id="998">998</th><td><i>	 * devices still attached.  If the user creates an isolation violation</i></td></tr>
<tr><th id="999">999</th><td><i>	 * by binding this device to another driver while the group is still in</i></td></tr>
<tr><th id="1000">1000</th><td><i>	 * use, that's their fault.  However, in the case of removing the last,</i></td></tr>
<tr><th id="1001">1001</th><td><i>	 * or potentially the only, device in the group there can be no other</i></td></tr>
<tr><th id="1002">1002</th><td><i>	 * in-use devices in the group.  The user has done their due diligence</i></td></tr>
<tr><th id="1003">1003</th><td><i>	 * and we should lay no claims to those devices.  In order to do that,</i></td></tr>
<tr><th id="1004">1004</th><td><i>	 * we need to make sure the group is detached from the container.</i></td></tr>
<tr><th id="1005">1005</th><td><i>	 * Without this stall, we're potentially racing with a user process</i></td></tr>
<tr><th id="1006">1006</th><td><i>	 * that may attempt to immediately bind this device to another driver.</i></td></tr>
<tr><th id="1007">1007</th><td><i>	 */</i></td></tr>
<tr><th id="1008">1008</th><td>	<b>if</b> (<a class="ref fn" href="../../include/linux/list.h.html#list_empty" title='list_empty' data-ref="list_empty">list_empty</a>(&amp;<a class="local col1 ref" href="#111group" title='group' data-ref="111group">group</a>-&gt;<a class="ref field" href="#vfio_group::device_list" title='vfio_group::device_list' data-ref="vfio_group::device_list">device_list</a>))</td></tr>
<tr><th id="1009">1009</th><td>		<a class="macro" href="../../include/linux/wait.h.html#286" title="do { do { do { } while (0); } while (0); if (!group-&gt;container) break; (void)({ __label__ __out; struct wait_queue_entry __wq_entry; long __ret = 0; init_wait_entry(&amp;__wq_entry, 0 ? 0x01 : 0); for (;;) { long __int = prepare_to_wait_event(&amp;group-&gt;container_q, &amp;__wq_entry, 0x0002); if (!group-&gt;container) break; if ((!__builtin_constant_p(0x0002) || 0x0002 == 0x0001 || 0x0002 == (0x0100 | 0x0002)) &amp;&amp; __int) { __ret = __int; goto __out; } schedule(); } finish_wait(&amp;group-&gt;container_q, &amp;__wq_entry); __out: __ret; }); } while (0)" data-ref="_M/wait_event">wait_event</a>(<a class="local col1 ref" href="#111group" title='group' data-ref="111group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_q" title='vfio_group::container_q' data-ref="vfio_group::container_q">container_q</a>, !<a class="local col1 ref" href="#111group" title='group' data-ref="111group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a>);</td></tr>
<tr><th id="1010">1010</th><td></td></tr>
<tr><th id="1011">1011</th><td>	<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col1 ref" href="#111group" title='group' data-ref="111group">group</a>);</td></tr>
<tr><th id="1012">1012</th><td></td></tr>
<tr><th id="1013">1013</th><td>	<b>return</b> <a class="local col2 ref" href="#112device_data" title='device_data' data-ref="112device_data">device_data</a>;</td></tr>
<tr><th id="1014">1014</th><td>}</td></tr>
<tr><th id="1015">1015</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_del_group_dev) vfio_del_group_dev; static const char __kstrtab_vfio_del_group_dev[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_del_group_dev&quot;; static const struct kernel_symbol __ksymtab_vfio_del_group_dev __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_del_group_dev&quot;), used)) = { (unsigned long)&amp;vfio_del_group_dev, __kstrtab_vfio_del_group_dev }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_del_group_dev" title='vfio_del_group_dev' data-ref="vfio_del_group_dev"><a class="ref fn" href="#vfio_del_group_dev" title='vfio_del_group_dev' data-ref="vfio_del_group_dev"><a class="ref fn" href="#vfio_del_group_dev" title='vfio_del_group_dev' data-ref="vfio_del_group_dev"><a class="ref fn" href="#vfio_del_group_dev" title='vfio_del_group_dev' data-ref="vfio_del_group_dev">vfio_del_group_dev</a></a></a></a>);</td></tr>
<tr><th id="1016">1016</th><td></td></tr>
<tr><th id="1017">1017</th><td><i class="doc" data-doc="vfio_ioctl_check_extension">/**</i></td></tr>
<tr><th id="1018">1018</th><td><i class="doc" data-doc="vfio_ioctl_check_extension"> * VFIO base fd, /dev/vfio/vfio</i></td></tr>
<tr><th id="1019">1019</th><td><i class="doc" data-doc="vfio_ioctl_check_extension"> */</i></td></tr>
<tr><th id="1020">1020</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="vfio_ioctl_check_extension" title='vfio_ioctl_check_extension' data-type='long vfio_ioctl_check_extension(struct vfio_container * container, unsigned long arg)' data-ref="vfio_ioctl_check_extension">vfio_ioctl_check_extension</dfn>(<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col7 decl" id="117container" title='container' data-type='struct vfio_container *' data-ref="117container">container</dfn>,</td></tr>
<tr><th id="1021">1021</th><td>				       <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="118arg" title='arg' data-type='unsigned long' data-ref="118arg">arg</dfn>)</td></tr>
<tr><th id="1022">1022</th><td>{</td></tr>
<tr><th id="1023">1023</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col9 decl" id="119driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="119driver">driver</dfn>;</td></tr>
<tr><th id="1024">1024</th><td>	<em>long</em> <dfn class="local col0 decl" id="120ret" title='ret' data-type='long' data-ref="120ret">ret</dfn> = <var>0</var>;</td></tr>
<tr><th id="1025">1025</th><td></td></tr>
<tr><th id="1026">1026</th><td>	<a class="ref fn" href="../../include/linux/rwsem.h.html#down_read" title='down_read' data-ref="down_read">down_read</a>(&amp;<a class="local col7 ref" href="#117container" title='container' data-ref="117container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_lock" title='vfio_container::group_lock' data-use='a' data-ref="vfio_container::group_lock">group_lock</a>);</td></tr>
<tr><th id="1027">1027</th><td></td></tr>
<tr><th id="1028">1028</th><td>	<a class="local col9 ref" href="#119driver" title='driver' data-ref="119driver">driver</a> = <a class="local col7 ref" href="#117container" title='container' data-ref="117container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a>;</td></tr>
<tr><th id="1029">1029</th><td></td></tr>
<tr><th id="1030">1030</th><td>	<b>switch</b> (<a class="local col8 ref" href="#118arg" title='arg' data-ref="118arg">arg</a>) {</td></tr>
<tr><th id="1031">1031</th><td>		<i>/* No base extensions yet */</i></td></tr>
<tr><th id="1032">1032</th><td>	<b>default</b>:</td></tr>
<tr><th id="1033">1033</th><td>		<i>/*</i></td></tr>
<tr><th id="1034">1034</th><td><i>		 * If no driver is set, poll all registered drivers for</i></td></tr>
<tr><th id="1035">1035</th><td><i>		 * extensions and return the first positive result.  If</i></td></tr>
<tr><th id="1036">1036</th><td><i>		 * a driver is already set, further queries will be passed</i></td></tr>
<tr><th id="1037">1037</th><td><i>		 * only to that driver.</i></td></tr>
<tr><th id="1038">1038</th><td><i>		 */</i></td></tr>
<tr><th id="1039">1039</th><td>		<b>if</b> (!<a class="local col9 ref" href="#119driver" title='driver' data-ref="119driver">driver</a>) {</td></tr>
<tr><th id="1040">1040</th><td>			<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_lock" title='vfio::iommu_drivers_lock' data-use='a' data-ref="vfio::iommu_drivers_lock">iommu_drivers_lock</a>);</td></tr>
<tr><th id="1041">1041</th><td>			<a class="macro" href="../../include/linux/list.h.html#463" title="for (driver = ({ void *__mptr = (void *)((&amp;vfio.iommu_drivers_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;vfio.iommu_drivers_list)-&gt;next)), typeof(((typeof(*driver) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;vfio.iommu_drivers_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_1042(void) ; if (__cond) __compiletime_assert_1042(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*driver) *)(__mptr - __builtin_offsetof(typeof(*driver), vfio_next))); }); &amp;driver-&gt;vfio_next != (&amp;vfio.iommu_drivers_list); driver = ({ void *__mptr = (void *)((driver)-&gt;vfio_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((driver)-&gt;vfio_next.next)), typeof(((typeof(*(driver)) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((driver)-&gt;vfio_next.next)), typeof(void)))); extern void __compiletime_assert_1042(void) ; if (__cond) __compiletime_assert_1042(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(driver)) *)(__mptr - __builtin_offsetof(typeof(*(driver)), vfio_next))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col9 ref" href="#119driver" title='driver' data-ref="119driver">driver</a>, &amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_list" title='vfio::iommu_drivers_list' data-use='a' data-ref="vfio::iommu_drivers_list">iommu_drivers_list</a>,</td></tr>
<tr><th id="1042">1042</th><td>					    <a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='r' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='a' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='m' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='m' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='m' data-ref="vfio_iommu_driver::vfio_next">vfio_next</a></a></a></a></a>) {</td></tr>
<tr><th id="1043">1043</th><td></td></tr>
<tr><th id="1044">1044</th><td><u>#<span data-ppcond="1044">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#156" data-ref="_M/CONFIG_VFIO_NOIOMMU">CONFIG_VFIO_NOIOMMU</a></u></td></tr>
<tr><th id="1045">1045</th><td>				<b>if</b> (!<a class="ref fn" href="../../include/linux/list.h.html#list_empty" title='list_empty' data-ref="list_empty">list_empty</a>(&amp;<a class="local col7 ref" href="#117container" title='container' data-ref="117container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_list" title='vfio_container::group_list' data-use='a' data-ref="vfio_container::group_list">group_list</a>) &amp;&amp;</td></tr>
<tr><th id="1046">1046</th><td>				    (<a class="local col7 ref" href="#117container" title='container' data-ref="117container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::noiommu" title='vfio_container::noiommu' data-use='r' data-ref="vfio_container::noiommu">noiommu</a> !=</td></tr>
<tr><th id="1047">1047</th><td>				     (<a class="local col9 ref" href="#119driver" title='driver' data-ref="119driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a> == &amp;<a class="tu ref" href="#vfio_noiommu_ops" title='vfio_noiommu_ops' data-use='a' data-ref="vfio_noiommu_ops">vfio_noiommu_ops</a>)))</td></tr>
<tr><th id="1048">1048</th><td>					<b>continue</b>;</td></tr>
<tr><th id="1049">1049</th><td><u>#<span data-ppcond="1044">endif</span></u></td></tr>
<tr><th id="1050">1050</th><td></td></tr>
<tr><th id="1051">1051</th><td>				<b>if</b> (!<a class="ref fn" href="../../include/linux/module.h.html#try_module_get" title='try_module_get' data-ref="try_module_get">try_module_get</a>(<a class="local col9 ref" href="#119driver" title='driver' data-ref="119driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::owner" title='vfio_iommu_driver_ops::owner' data-ref="vfio_iommu_driver_ops::owner">owner</a>))</td></tr>
<tr><th id="1052">1052</th><td>					<b>continue</b>;</td></tr>
<tr><th id="1053">1053</th><td></td></tr>
<tr><th id="1054">1054</th><td>				<a class="local col0 ref" href="#120ret" title='ret' data-ref="120ret">ret</a> = <a class="local col9 ref" href="#119driver" title='driver' data-ref="119driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::ioctl" title='vfio_iommu_driver_ops::ioctl' data-ref="vfio_iommu_driver_ops::ioctl">ioctl</a>(<a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>,</td></tr>
<tr><th id="1055">1055</th><td>							 <a class="macro" href="../../include/uapi/linux/vfio.h.html#110" title="(((0U) &lt;&lt; (((0+8)+8)+14)) | ((((&apos;;&apos;))) &lt;&lt; (0+8)) | (((100 + 1)) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VFIO_CHECK_EXTENSION">VFIO_CHECK_EXTENSION</a>,</td></tr>
<tr><th id="1056">1056</th><td>							 <a class="local col8 ref" href="#118arg" title='arg' data-ref="118arg">arg</a>);</td></tr>
<tr><th id="1057">1057</th><td>				<a class="ref fn" href="../../include/linux/module.h.html#module_put" title='module_put' data-ref="module_put">module_put</a>(<a class="local col9 ref" href="#119driver" title='driver' data-ref="119driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::owner" title='vfio_iommu_driver_ops::owner' data-ref="vfio_iommu_driver_ops::owner">owner</a>);</td></tr>
<tr><th id="1058">1058</th><td>				<b>if</b> (<a class="local col0 ref" href="#120ret" title='ret' data-ref="120ret">ret</a> &gt; <var>0</var>)</td></tr>
<tr><th id="1059">1059</th><td>					<b>break</b>;</td></tr>
<tr><th id="1060">1060</th><td>			}</td></tr>
<tr><th id="1061">1061</th><td>			<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_lock" title='vfio::iommu_drivers_lock' data-use='a' data-ref="vfio::iommu_drivers_lock">iommu_drivers_lock</a>);</td></tr>
<tr><th id="1062">1062</th><td>		} <b>else</b></td></tr>
<tr><th id="1063">1063</th><td>			<a class="local col0 ref" href="#120ret" title='ret' data-ref="120ret">ret</a> = <a class="local col9 ref" href="#119driver" title='driver' data-ref="119driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::ioctl" title='vfio_iommu_driver_ops::ioctl' data-ref="vfio_iommu_driver_ops::ioctl">ioctl</a>(<a class="local col7 ref" href="#117container" title='container' data-ref="117container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='r' data-ref="vfio_container::iommu_data">iommu_data</a>,</td></tr>
<tr><th id="1064">1064</th><td>						 <a class="macro" href="../../include/uapi/linux/vfio.h.html#110" title="(((0U) &lt;&lt; (((0+8)+8)+14)) | ((((&apos;;&apos;))) &lt;&lt; (0+8)) | (((100 + 1)) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VFIO_CHECK_EXTENSION">VFIO_CHECK_EXTENSION</a>, <a class="local col8 ref" href="#118arg" title='arg' data-ref="118arg">arg</a>);</td></tr>
<tr><th id="1065">1065</th><td>	}</td></tr>
<tr><th id="1066">1066</th><td></td></tr>
<tr><th id="1067">1067</th><td>	<a class="ref fn" href="../../include/linux/rwsem.h.html#up_read" title='up_read' data-ref="up_read">up_read</a>(&amp;<a class="local col7 ref" href="#117container" title='container' data-ref="117container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_lock" title='vfio_container::group_lock' data-use='a' data-ref="vfio_container::group_lock">group_lock</a>);</td></tr>
<tr><th id="1068">1068</th><td></td></tr>
<tr><th id="1069">1069</th><td>	<b>return</b> <a class="local col0 ref" href="#120ret" title='ret' data-ref="120ret">ret</a>;</td></tr>
<tr><th id="1070">1070</th><td>}</td></tr>
<tr><th id="1071">1071</th><td></td></tr>
<tr><th id="1072">1072</th><td><i  data-doc="__vfio_container_attach_groups">/* hold write lock on container-&gt;group_lock */</i></td></tr>
<tr><th id="1073">1073</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="__vfio_container_attach_groups" title='__vfio_container_attach_groups' data-type='int __vfio_container_attach_groups(struct vfio_container * container, struct vfio_iommu_driver * driver, void * data)' data-ref="__vfio_container_attach_groups">__vfio_container_attach_groups</dfn>(<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col1 decl" id="121container" title='container' data-type='struct vfio_container *' data-ref="121container">container</dfn>,</td></tr>
<tr><th id="1074">1074</th><td>					  <b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col2 decl" id="122driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="122driver">driver</dfn>,</td></tr>
<tr><th id="1075">1075</th><td>					  <em>void</em> *<dfn class="local col3 decl" id="123data" title='data' data-type='void *' data-ref="123data">data</dfn>)</td></tr>
<tr><th id="1076">1076</th><td>{</td></tr>
<tr><th id="1077">1077</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col4 decl" id="124group" title='group' data-type='struct vfio_group *' data-ref="124group">group</dfn>;</td></tr>
<tr><th id="1078">1078</th><td>	<em>int</em> <dfn class="local col5 decl" id="125ret" title='ret' data-type='int' data-ref="125ret">ret</dfn> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#23" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="1079">1079</th><td></td></tr>
<tr><th id="1080">1080</th><td>	<a class="macro" href="../../include/linux/list.h.html#463" title="for (group = ({ void *__mptr = (void *)((&amp;container-&gt;group_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;container-&gt;group_list)-&gt;next)), typeof(((typeof(*group) *)0)-&gt;container_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;container-&gt;group_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_1080(void) ; if (__cond) __compiletime_assert_1080(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*group) *)(__mptr - __builtin_offsetof(typeof(*group), container_next))); }); &amp;group-&gt;container_next != (&amp;container-&gt;group_list); group = ({ void *__mptr = (void *)((group)-&gt;container_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((group)-&gt;container_next.next)), typeof(((typeof(*(group)) *)0)-&gt;container_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((group)-&gt;container_next.next)), typeof(void)))); extern void __compiletime_assert_1080(void) ; if (__cond) __compiletime_assert_1080(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(group)) *)(__mptr - __builtin_offsetof(typeof(*(group)), container_next))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col4 ref" href="#124group" title='group' data-ref="124group">group</a>, &amp;<a class="local col1 ref" href="#121container" title='container' data-ref="121container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_list" title='vfio_container::group_list' data-use='a' data-ref="vfio_container::group_list">group_list</a>, <a class="ref field" href="#vfio_group::container_next" title='vfio_group::container_next' data-ref="vfio_group::container_next">container_next</a>) {</td></tr>
<tr><th id="1081">1081</th><td>		<a class="local col5 ref" href="#125ret" title='ret' data-ref="125ret">ret</a> = <a class="local col2 ref" href="#122driver" title='driver' data-ref="122driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::attach_group" title='vfio_iommu_driver_ops::attach_group' data-ref="vfio_iommu_driver_ops::attach_group">attach_group</a>(<a class="local col3 ref" href="#123data" title='data' data-ref="123data">data</a>, <a class="local col4 ref" href="#124group" title='group' data-ref="124group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>);</td></tr>
<tr><th id="1082">1082</th><td>		<b>if</b> (<a class="local col5 ref" href="#125ret" title='ret' data-ref="125ret">ret</a>)</td></tr>
<tr><th id="1083">1083</th><td>			<b>goto</b> <a class="lbl" href="#126unwind" data-ref="126unwind">unwind</a>;</td></tr>
<tr><th id="1084">1084</th><td>	}</td></tr>
<tr><th id="1085">1085</th><td></td></tr>
<tr><th id="1086">1086</th><td>	<b>return</b> <a class="local col5 ref" href="#125ret" title='ret' data-ref="125ret">ret</a>;</td></tr>
<tr><th id="1087">1087</th><td></td></tr>
<tr><th id="1088">1088</th><td><dfn class="lbl" id="126unwind" data-ref="126unwind">unwind</dfn>:</td></tr>
<tr><th id="1089">1089</th><td>	<a class="macro" href="../../include/linux/list.h.html#513" title="for (group = ({ void *__mptr = (void *)((group)-&gt;container_next.prev); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((group)-&gt;container_next.prev)), typeof(((typeof(*(group)) *)0)-&gt;container_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((group)-&gt;container_next.prev)), typeof(void)))); extern void __compiletime_assert_1090(void) ; if (__cond) __compiletime_assert_1090(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(group)) *)(__mptr - __builtin_offsetof(typeof(*(group)), container_next))); }); &amp;group-&gt;container_next != (&amp;container-&gt;group_list); group = ({ void *__mptr = (void *)((group)-&gt;container_next.prev); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((group)-&gt;container_next.prev)), typeof(((typeof(*(group)) *)0)-&gt;container_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((group)-&gt;container_next.prev)), typeof(void)))); extern void __compiletime_assert_1090(void) ; if (__cond) __compiletime_assert_1090(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(group)) *)(__mptr - __builtin_offsetof(typeof(*(group)), container_next))); }))" data-ref="_M/list_for_each_entry_continue_reverse">list_for_each_entry_continue_reverse</a>(<a class="local col4 ref" href="#124group" title='group' data-ref="124group">group</a>, &amp;<a class="local col1 ref" href="#121container" title='container' data-ref="121container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_list" title='vfio_container::group_list' data-use='a' data-ref="vfio_container::group_list">group_list</a>,</td></tr>
<tr><th id="1090">1090</th><td>					     <a class="ref field" href="#vfio_group::container_next" title='vfio_group::container_next' data-ref="vfio_group::container_next">container_next</a>) {</td></tr>
<tr><th id="1091">1091</th><td>		<a class="local col2 ref" href="#122driver" title='driver' data-ref="122driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::detach_group" title='vfio_iommu_driver_ops::detach_group' data-ref="vfio_iommu_driver_ops::detach_group">detach_group</a>(<a class="local col3 ref" href="#123data" title='data' data-ref="123data">data</a>, <a class="local col4 ref" href="#124group" title='group' data-ref="124group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>);</td></tr>
<tr><th id="1092">1092</th><td>	}</td></tr>
<tr><th id="1093">1093</th><td></td></tr>
<tr><th id="1094">1094</th><td>	<b>return</b> <a class="local col5 ref" href="#125ret" title='ret' data-ref="125ret">ret</a>;</td></tr>
<tr><th id="1095">1095</th><td>}</td></tr>
<tr><th id="1096">1096</th><td></td></tr>
<tr><th id="1097">1097</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="vfio_ioctl_set_iommu" title='vfio_ioctl_set_iommu' data-type='long vfio_ioctl_set_iommu(struct vfio_container * container, unsigned long arg)' data-ref="vfio_ioctl_set_iommu">vfio_ioctl_set_iommu</dfn>(<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col7 decl" id="127container" title='container' data-type='struct vfio_container *' data-ref="127container">container</dfn>,</td></tr>
<tr><th id="1098">1098</th><td>				 <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="128arg" title='arg' data-type='unsigned long' data-ref="128arg">arg</dfn>)</td></tr>
<tr><th id="1099">1099</th><td>{</td></tr>
<tr><th id="1100">1100</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col9 decl" id="129driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="129driver">driver</dfn>;</td></tr>
<tr><th id="1101">1101</th><td>	<em>long</em> <dfn class="local col0 decl" id="130ret" title='ret' data-type='long' data-ref="130ret">ret</dfn> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#23" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="1102">1102</th><td></td></tr>
<tr><th id="1103">1103</th><td>	<a class="ref fn" href="../../include/linux/rwsem.h.html#down_write" title='down_write' data-ref="down_write">down_write</a>(&amp;<a class="local col7 ref" href="#127container" title='container' data-ref="127container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_lock" title='vfio_container::group_lock' data-use='a' data-ref="vfio_container::group_lock">group_lock</a>);</td></tr>
<tr><th id="1104">1104</th><td></td></tr>
<tr><th id="1105">1105</th><td>	<i>/*</i></td></tr>
<tr><th id="1106">1106</th><td><i>	 * The container is designed to be an unprivileged interface while</i></td></tr>
<tr><th id="1107">1107</th><td><i>	 * the group can be assigned to specific users.  Therefore, only by</i></td></tr>
<tr><th id="1108">1108</th><td><i>	 * adding a group to a container does the user get the privilege of</i></td></tr>
<tr><th id="1109">1109</th><td><i>	 * enabling the iommu, which may allocate finite resources.  There</i></td></tr>
<tr><th id="1110">1110</th><td><i>	 * is no unset_iommu, but by removing all the groups from a container,</i></td></tr>
<tr><th id="1111">1111</th><td><i>	 * the container is deprivileged and returns to an unset state.</i></td></tr>
<tr><th id="1112">1112</th><td><i>	 */</i></td></tr>
<tr><th id="1113">1113</th><td>	<b>if</b> (<a class="ref fn" href="../../include/linux/list.h.html#list_empty" title='list_empty' data-ref="list_empty">list_empty</a>(&amp;<a class="local col7 ref" href="#127container" title='container' data-ref="127container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_list" title='vfio_container::group_list' data-use='a' data-ref="vfio_container::group_list">group_list</a>) || <a class="local col7 ref" href="#127container" title='container' data-ref="127container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a>) {</td></tr>
<tr><th id="1114">1114</th><td>		<a class="ref fn" href="../../include/linux/rwsem.h.html#up_write" title='up_write' data-ref="up_write">up_write</a>(&amp;<a class="local col7 ref" href="#127container" title='container' data-ref="127container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_lock" title='vfio_container::group_lock' data-use='a' data-ref="vfio_container::group_lock">group_lock</a>);</td></tr>
<tr><th id="1115">1115</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1116">1116</th><td>	}</td></tr>
<tr><th id="1117">1117</th><td></td></tr>
<tr><th id="1118">1118</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_lock" title='vfio::iommu_drivers_lock' data-use='a' data-ref="vfio::iommu_drivers_lock">iommu_drivers_lock</a>);</td></tr>
<tr><th id="1119">1119</th><td>	<a class="macro" href="../../include/linux/list.h.html#463" title="for (driver = ({ void *__mptr = (void *)((&amp;vfio.iommu_drivers_list)-&gt;next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((&amp;vfio.iommu_drivers_list)-&gt;next)), typeof(((typeof(*driver) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((&amp;vfio.iommu_drivers_list)-&gt;next)), typeof(void)))); extern void __compiletime_assert_1119(void) ; if (__cond) __compiletime_assert_1119(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*driver) *)(__mptr - __builtin_offsetof(typeof(*driver), vfio_next))); }); &amp;driver-&gt;vfio_next != (&amp;vfio.iommu_drivers_list); driver = ({ void *__mptr = (void *)((driver)-&gt;vfio_next.next); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*((driver)-&gt;vfio_next.next)), typeof(((typeof(*(driver)) *)0)-&gt;vfio_next)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((driver)-&gt;vfio_next.next)), typeof(void)))); extern void __compiletime_assert_1119(void) ; if (__cond) __compiletime_assert_1119(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((typeof(*(driver)) *)(__mptr - __builtin_offsetof(typeof(*(driver)), vfio_next))); }))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col9 ref" href="#129driver" title='driver' data-ref="129driver">driver</a>, &amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_list" title='vfio::iommu_drivers_list' data-use='a' data-ref="vfio::iommu_drivers_list">iommu_drivers_list</a>, <a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='r' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='a' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='m' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='m' data-ref="vfio_iommu_driver::vfio_next"><a class="tu ref field" href="#vfio_iommu_driver::vfio_next" title='vfio_iommu_driver::vfio_next' data-use='m' data-ref="vfio_iommu_driver::vfio_next">vfio_next</a></a></a></a></a>) {</td></tr>
<tr><th id="1120">1120</th><td>		<em>void</em> *<dfn class="local col1 decl" id="131data" title='data' data-type='void *' data-ref="131data">data</dfn>;</td></tr>
<tr><th id="1121">1121</th><td></td></tr>
<tr><th id="1122">1122</th><td><u>#<span data-ppcond="1122">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#156" data-ref="_M/CONFIG_VFIO_NOIOMMU">CONFIG_VFIO_NOIOMMU</a></u></td></tr>
<tr><th id="1123">1123</th><td>		<i>/*</i></td></tr>
<tr><th id="1124">1124</th><td><i>		 * Only noiommu containers can use vfio-noiommu and noiommu</i></td></tr>
<tr><th id="1125">1125</th><td><i>		 * containers can only use vfio-noiommu.</i></td></tr>
<tr><th id="1126">1126</th><td><i>		 */</i></td></tr>
<tr><th id="1127">1127</th><td>		<b>if</b> (<a class="local col7 ref" href="#127container" title='container' data-ref="127container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::noiommu" title='vfio_container::noiommu' data-use='r' data-ref="vfio_container::noiommu">noiommu</a> != (<a class="local col9 ref" href="#129driver" title='driver' data-ref="129driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a> == &amp;<a class="tu ref" href="#vfio_noiommu_ops" title='vfio_noiommu_ops' data-use='a' data-ref="vfio_noiommu_ops">vfio_noiommu_ops</a>))</td></tr>
<tr><th id="1128">1128</th><td>			<b>continue</b>;</td></tr>
<tr><th id="1129">1129</th><td><u>#<span data-ppcond="1122">endif</span></u></td></tr>
<tr><th id="1130">1130</th><td></td></tr>
<tr><th id="1131">1131</th><td>		<b>if</b> (!<a class="ref fn" href="../../include/linux/module.h.html#try_module_get" title='try_module_get' data-ref="try_module_get">try_module_get</a>(<a class="local col9 ref" href="#129driver" title='driver' data-ref="129driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::owner" title='vfio_iommu_driver_ops::owner' data-ref="vfio_iommu_driver_ops::owner">owner</a>))</td></tr>
<tr><th id="1132">1132</th><td>			<b>continue</b>;</td></tr>
<tr><th id="1133">1133</th><td></td></tr>
<tr><th id="1134">1134</th><td>		<i>/*</i></td></tr>
<tr><th id="1135">1135</th><td><i>		 * The arg magic for SET_IOMMU is the same as CHECK_EXTENSION,</i></td></tr>
<tr><th id="1136">1136</th><td><i>		 * so test which iommu driver reported support for this</i></td></tr>
<tr><th id="1137">1137</th><td><i>		 * extension and call open on them.  We also pass them the</i></td></tr>
<tr><th id="1138">1138</th><td><i>		 * magic, allowing a single driver to support multiple</i></td></tr>
<tr><th id="1139">1139</th><td><i>		 * interfaces if they'd like.</i></td></tr>
<tr><th id="1140">1140</th><td><i>		 */</i></td></tr>
<tr><th id="1141">1141</th><td>		<b>if</b> (<a class="local col9 ref" href="#129driver" title='driver' data-ref="129driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::ioctl" title='vfio_iommu_driver_ops::ioctl' data-ref="vfio_iommu_driver_ops::ioctl">ioctl</a>(<a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../../include/uapi/linux/vfio.h.html#110" title="(((0U) &lt;&lt; (((0+8)+8)+14)) | ((((&apos;;&apos;))) &lt;&lt; (0+8)) | (((100 + 1)) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VFIO_CHECK_EXTENSION">VFIO_CHECK_EXTENSION</a>, <a class="local col8 ref" href="#128arg" title='arg' data-ref="128arg">arg</a>) &lt;= <var>0</var>) {</td></tr>
<tr><th id="1142">1142</th><td>			<a class="ref fn" href="../../include/linux/module.h.html#module_put" title='module_put' data-ref="module_put">module_put</a>(<a class="local col9 ref" href="#129driver" title='driver' data-ref="129driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::owner" title='vfio_iommu_driver_ops::owner' data-ref="vfio_iommu_driver_ops::owner">owner</a>);</td></tr>
<tr><th id="1143">1143</th><td>			<b>continue</b>;</td></tr>
<tr><th id="1144">1144</th><td>		}</td></tr>
<tr><th id="1145">1145</th><td></td></tr>
<tr><th id="1146">1146</th><td>		<a class="local col1 ref" href="#131data" title='data' data-ref="131data">data</a> = <a class="local col9 ref" href="#129driver" title='driver' data-ref="129driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::open" title='vfio_iommu_driver_ops::open' data-ref="vfio_iommu_driver_ops::open">open</a>(<a class="local col8 ref" href="#128arg" title='arg' data-ref="128arg">arg</a>);</td></tr>
<tr><th id="1147">1147</th><td>		<b>if</b> (<a class="ref fn" href="../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="local col1 ref" href="#131data" title='data' data-ref="131data">data</a>)) {</td></tr>
<tr><th id="1148">1148</th><td>			<a class="local col0 ref" href="#130ret" title='ret' data-ref="130ret">ret</a> = <a class="ref fn" href="../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR">PTR_ERR</a>(<a class="local col1 ref" href="#131data" title='data' data-ref="131data">data</a>);</td></tr>
<tr><th id="1149">1149</th><td>			<a class="ref fn" href="../../include/linux/module.h.html#module_put" title='module_put' data-ref="module_put">module_put</a>(<a class="local col9 ref" href="#129driver" title='driver' data-ref="129driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::owner" title='vfio_iommu_driver_ops::owner' data-ref="vfio_iommu_driver_ops::owner">owner</a>);</td></tr>
<tr><th id="1150">1150</th><td>			<b>continue</b>;</td></tr>
<tr><th id="1151">1151</th><td>		}</td></tr>
<tr><th id="1152">1152</th><td></td></tr>
<tr><th id="1153">1153</th><td>		<a class="local col0 ref" href="#130ret" title='ret' data-ref="130ret">ret</a> = <a class="tu ref fn" href="#__vfio_container_attach_groups" title='__vfio_container_attach_groups' data-use='c' data-ref="__vfio_container_attach_groups">__vfio_container_attach_groups</a>(<a class="local col7 ref" href="#127container" title='container' data-ref="127container">container</a>, <a class="local col9 ref" href="#129driver" title='driver' data-ref="129driver">driver</a>, <a class="local col1 ref" href="#131data" title='data' data-ref="131data">data</a>);</td></tr>
<tr><th id="1154">1154</th><td>		<b>if</b> (<a class="local col0 ref" href="#130ret" title='ret' data-ref="130ret">ret</a>) {</td></tr>
<tr><th id="1155">1155</th><td>			<a class="local col9 ref" href="#129driver" title='driver' data-ref="129driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::release" title='vfio_iommu_driver_ops::release' data-ref="vfio_iommu_driver_ops::release">release</a>(<a class="local col1 ref" href="#131data" title='data' data-ref="131data">data</a>);</td></tr>
<tr><th id="1156">1156</th><td>			<a class="ref fn" href="../../include/linux/module.h.html#module_put" title='module_put' data-ref="module_put">module_put</a>(<a class="local col9 ref" href="#129driver" title='driver' data-ref="129driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::owner" title='vfio_iommu_driver_ops::owner' data-ref="vfio_iommu_driver_ops::owner">owner</a>);</td></tr>
<tr><th id="1157">1157</th><td>			<b>continue</b>;</td></tr>
<tr><th id="1158">1158</th><td>		}</td></tr>
<tr><th id="1159">1159</th><td></td></tr>
<tr><th id="1160">1160</th><td>		<a class="local col7 ref" href="#127container" title='container' data-ref="127container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='w' data-ref="vfio_container::iommu_driver">iommu_driver</a> = <a class="local col9 ref" href="#129driver" title='driver' data-ref="129driver">driver</a>;</td></tr>
<tr><th id="1161">1161</th><td>		<a class="local col7 ref" href="#127container" title='container' data-ref="127container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='w' data-ref="vfio_container::iommu_data">iommu_data</a> = <a class="local col1 ref" href="#131data" title='data' data-ref="131data">data</a>;</td></tr>
<tr><th id="1162">1162</th><td>		<b>break</b>;</td></tr>
<tr><th id="1163">1163</th><td>	}</td></tr>
<tr><th id="1164">1164</th><td></td></tr>
<tr><th id="1165">1165</th><td>	<a class="ref fn" href="../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_lock" title='vfio::iommu_drivers_lock' data-use='a' data-ref="vfio::iommu_drivers_lock">iommu_drivers_lock</a>);</td></tr>
<tr><th id="1166">1166</th><td>	<a class="ref fn" href="../../include/linux/rwsem.h.html#up_write" title='up_write' data-ref="up_write">up_write</a>(&amp;<a class="local col7 ref" href="#127container" title='container' data-ref="127container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_lock" title='vfio_container::group_lock' data-use='a' data-ref="vfio_container::group_lock">group_lock</a>);</td></tr>
<tr><th id="1167">1167</th><td></td></tr>
<tr><th id="1168">1168</th><td>	<b>return</b> <a class="local col0 ref" href="#130ret" title='ret' data-ref="130ret">ret</a>;</td></tr>
<tr><th id="1169">1169</th><td>}</td></tr>
<tr><th id="1170">1170</th><td></td></tr>
<tr><th id="1171">1171</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="vfio_fops_unl_ioctl" title='vfio_fops_unl_ioctl' data-type='long vfio_fops_unl_ioctl(struct file * filep, unsigned int cmd, unsigned long arg)' data-ref="vfio_fops_unl_ioctl">vfio_fops_unl_ioctl</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col2 decl" id="132filep" title='filep' data-type='struct file *' data-ref="132filep">filep</dfn>,</td></tr>
<tr><th id="1172">1172</th><td>				<em>unsigned</em> <em>int</em> <dfn class="local col3 decl" id="133cmd" title='cmd' data-type='unsigned int' data-ref="133cmd">cmd</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col4 decl" id="134arg" title='arg' data-type='unsigned long' data-ref="134arg">arg</dfn>)</td></tr>
<tr><th id="1173">1173</th><td>{</td></tr>
<tr><th id="1174">1174</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col5 decl" id="135container" title='container' data-type='struct vfio_container *' data-ref="135container">container</dfn> = <a class="local col2 ref" href="#132filep" title='filep' data-ref="132filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1175">1175</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col6 decl" id="136driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="136driver">driver</dfn>;</td></tr>
<tr><th id="1176">1176</th><td>	<em>void</em> *<dfn class="local col7 decl" id="137data" title='data' data-type='void *' data-ref="137data">data</dfn>;</td></tr>
<tr><th id="1177">1177</th><td>	<em>long</em> <dfn class="local col8 decl" id="138ret" title='ret' data-type='long' data-ref="138ret">ret</dfn> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1178">1178</th><td></td></tr>
<tr><th id="1179">1179</th><td>	<b>if</b> (!<a class="local col5 ref" href="#135container" title='container' data-ref="135container">container</a>)</td></tr>
<tr><th id="1180">1180</th><td>		<b>return</b> <a class="local col8 ref" href="#138ret" title='ret' data-ref="138ret">ret</a>;</td></tr>
<tr><th id="1181">1181</th><td></td></tr>
<tr><th id="1182">1182</th><td>	<b>switch</b> (<a class="local col3 ref" href="#133cmd" title='cmd' data-ref="133cmd">cmd</a>) {</td></tr>
<tr><th id="1183">1183</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/vfio.h.html#101" title="(((0U) &lt;&lt; (((0+8)+8)+14)) | ((((&apos;;&apos;))) &lt;&lt; (0+8)) | (((100 + 0)) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VFIO_GET_API_VERSION">VFIO_GET_API_VERSION</a>:</td></tr>
<tr><th id="1184">1184</th><td>		<a class="local col8 ref" href="#138ret" title='ret' data-ref="138ret">ret</a> = <a class="macro" href="../../include/uapi/linux/vfio.h.html#18" title="0" data-ref="_M/VFIO_API_VERSION">VFIO_API_VERSION</a>;</td></tr>
<tr><th id="1185">1185</th><td>		<b>break</b>;</td></tr>
<tr><th id="1186">1186</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/vfio.h.html#110" title="(((0U) &lt;&lt; (((0+8)+8)+14)) | ((((&apos;;&apos;))) &lt;&lt; (0+8)) | (((100 + 1)) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VFIO_CHECK_EXTENSION">VFIO_CHECK_EXTENSION</a>:</td></tr>
<tr><th id="1187">1187</th><td>		<a class="local col8 ref" href="#138ret" title='ret' data-ref="138ret">ret</a> = <a class="tu ref fn" href="#vfio_ioctl_check_extension" title='vfio_ioctl_check_extension' data-use='c' data-ref="vfio_ioctl_check_extension">vfio_ioctl_check_extension</a>(<a class="local col5 ref" href="#135container" title='container' data-ref="135container">container</a>, <a class="local col4 ref" href="#134arg" title='arg' data-ref="134arg">arg</a>);</td></tr>
<tr><th id="1188">1188</th><td>		<b>break</b>;</td></tr>
<tr><th id="1189">1189</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/vfio.h.html#123" title="(((0U) &lt;&lt; (((0+8)+8)+14)) | ((((&apos;;&apos;))) &lt;&lt; (0+8)) | (((100 + 2)) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VFIO_SET_IOMMU">VFIO_SET_IOMMU</a>:</td></tr>
<tr><th id="1190">1190</th><td>		<a class="local col8 ref" href="#138ret" title='ret' data-ref="138ret">ret</a> = <a class="tu ref fn" href="#vfio_ioctl_set_iommu" title='vfio_ioctl_set_iommu' data-use='c' data-ref="vfio_ioctl_set_iommu">vfio_ioctl_set_iommu</a>(<a class="local col5 ref" href="#135container" title='container' data-ref="135container">container</a>, <a class="local col4 ref" href="#134arg" title='arg' data-ref="134arg">arg</a>);</td></tr>
<tr><th id="1191">1191</th><td>		<b>break</b>;</td></tr>
<tr><th id="1192">1192</th><td>	<b>default</b>:</td></tr>
<tr><th id="1193">1193</th><td>		<a class="local col6 ref" href="#136driver" title='driver' data-ref="136driver">driver</a> = <a class="local col5 ref" href="#135container" title='container' data-ref="135container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a>;</td></tr>
<tr><th id="1194">1194</th><td>		<a class="local col7 ref" href="#137data" title='data' data-ref="137data">data</a> = <a class="local col5 ref" href="#135container" title='container' data-ref="135container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='r' data-ref="vfio_container::iommu_data">iommu_data</a>;</td></tr>
<tr><th id="1195">1195</th><td></td></tr>
<tr><th id="1196">1196</th><td>		<b>if</b> (<a class="local col6 ref" href="#136driver" title='driver' data-ref="136driver">driver</a>) <i>/* passthrough all unrecognized ioctls */</i></td></tr>
<tr><th id="1197">1197</th><td>			<a class="local col8 ref" href="#138ret" title='ret' data-ref="138ret">ret</a> = <a class="local col6 ref" href="#136driver" title='driver' data-ref="136driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::ioctl" title='vfio_iommu_driver_ops::ioctl' data-ref="vfio_iommu_driver_ops::ioctl">ioctl</a>(<a class="local col7 ref" href="#137data" title='data' data-ref="137data">data</a>, <a class="local col3 ref" href="#133cmd" title='cmd' data-ref="133cmd">cmd</a>, <a class="local col4 ref" href="#134arg" title='arg' data-ref="134arg">arg</a>);</td></tr>
<tr><th id="1198">1198</th><td>	}</td></tr>
<tr><th id="1199">1199</th><td></td></tr>
<tr><th id="1200">1200</th><td>	<b>return</b> <a class="local col8 ref" href="#138ret" title='ret' data-ref="138ret">ret</a>;</td></tr>
<tr><th id="1201">1201</th><td>}</td></tr>
<tr><th id="1202">1202</th><td></td></tr>
<tr><th id="1203">1203</th><td><u>#<span data-ppcond="1203">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#96" data-ref="_M/CONFIG_COMPAT">CONFIG_COMPAT</a></u></td></tr>
<tr><th id="1204">1204</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="vfio_fops_compat_ioctl" title='vfio_fops_compat_ioctl' data-type='long vfio_fops_compat_ioctl(struct file * filep, unsigned int cmd, unsigned long arg)' data-ref="vfio_fops_compat_ioctl">vfio_fops_compat_ioctl</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col9 decl" id="139filep" title='filep' data-type='struct file *' data-ref="139filep">filep</dfn>,</td></tr>
<tr><th id="1205">1205</th><td>				   <em>unsigned</em> <em>int</em> <dfn class="local col0 decl" id="140cmd" title='cmd' data-type='unsigned int' data-ref="140cmd">cmd</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col1 decl" id="141arg" title='arg' data-type='unsigned long' data-ref="141arg">arg</dfn>)</td></tr>
<tr><th id="1206">1206</th><td>{</td></tr>
<tr><th id="1207">1207</th><td>	<a class="local col1 ref" href="#141arg" title='arg' data-ref="141arg">arg</a> = (<em>unsigned</em> <em>long</em>)<a class="ref fn" href="../../arch/x86/include/asm/compat.h.html#compat_ptr" title='compat_ptr' data-ref="compat_ptr">compat_ptr</a>(<a class="local col1 ref" href="#141arg" title='arg' data-ref="141arg">arg</a>);</td></tr>
<tr><th id="1208">1208</th><td>	<b>return</b> <a class="tu ref fn" href="#vfio_fops_unl_ioctl" title='vfio_fops_unl_ioctl' data-use='c' data-ref="vfio_fops_unl_ioctl">vfio_fops_unl_ioctl</a>(<a class="local col9 ref" href="#139filep" title='filep' data-ref="139filep">filep</a>, <a class="local col0 ref" href="#140cmd" title='cmd' data-ref="140cmd">cmd</a>, <a class="local col1 ref" href="#141arg" title='arg' data-ref="141arg">arg</a>);</td></tr>
<tr><th id="1209">1209</th><td>}</td></tr>
<tr><th id="1210">1210</th><td><u>#<span data-ppcond="1203">endif</span>	/* CONFIG_COMPAT */</u></td></tr>
<tr><th id="1211">1211</th><td></td></tr>
<tr><th id="1212">1212</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_fops_open" title='vfio_fops_open' data-type='int vfio_fops_open(struct inode * inode, struct file * filep)' data-ref="vfio_fops_open">vfio_fops_open</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col2 decl" id="142inode" title='inode' data-type='struct inode *' data-ref="142inode">inode</dfn>, <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col3 decl" id="143filep" title='filep' data-type='struct file *' data-ref="143filep">filep</dfn>)</td></tr>
<tr><th id="1213">1213</th><td>{</td></tr>
<tr><th id="1214">1214</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col4 decl" id="144container" title='container' data-type='struct vfio_container *' data-ref="144container">container</dfn>;</td></tr>
<tr><th id="1215">1215</th><td></td></tr>
<tr><th id="1216">1216</th><td>	<a class="local col4 ref" href="#144container" title='container' data-ref="144container">container</a> = <a class="ref fn" href="../../include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc">kzalloc</a>(<b>sizeof</b>(*<a class="local col4 ref" href="#144container" title='container' data-ref="144container">container</a>), <a class="macro" href="../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x200000u|0x400000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="1217">1217</th><td>	<b>if</b> (!<a class="local col4 ref" href="#144container" title='container' data-ref="144container">container</a>)</td></tr>
<tr><th id="1218">1218</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1219">1219</th><td></td></tr>
<tr><th id="1220">1220</th><td>	<a class="ref fn" href="../../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col4 ref" href="#144container" title='container' data-ref="144container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_list" title='vfio_container::group_list' data-use='a' data-ref="vfio_container::group_list">group_list</a>);</td></tr>
<tr><th id="1221">1221</th><td>	<a class="macro" href="../../include/linux/rwsem.h.html#99" title="do { static struct lock_class_key __key; __init_rwsem((&amp;container-&gt;group_lock), &quot;&amp;container-&gt;group_lock&quot;, &amp;__key); } while (0)" data-ref="_M/init_rwsem">init_rwsem</a>(&amp;<a class="local col4 ref" href="#144container" title='container' data-ref="144container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_lock" title='vfio_container::group_lock' data-use='a' data-ref="vfio_container::group_lock">group_lock</a>);</td></tr>
<tr><th id="1222">1222</th><td>	<a class="ref fn" href="../../include/linux/kref.h.html#kref_init" title='kref_init' data-ref="kref_init">kref_init</a>(&amp;<a class="local col4 ref" href="#144container" title='container' data-ref="144container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::kref" title='vfio_container::kref' data-use='a' data-ref="vfio_container::kref">kref</a>);</td></tr>
<tr><th id="1223">1223</th><td></td></tr>
<tr><th id="1224">1224</th><td>	<a class="local col3 ref" href="#143filep" title='filep' data-ref="143filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a> = <a class="local col4 ref" href="#144container" title='container' data-ref="144container">container</a>;</td></tr>
<tr><th id="1225">1225</th><td></td></tr>
<tr><th id="1226">1226</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1227">1227</th><td>}</td></tr>
<tr><th id="1228">1228</th><td></td></tr>
<tr><th id="1229">1229</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_fops_release" title='vfio_fops_release' data-type='int vfio_fops_release(struct inode * inode, struct file * filep)' data-ref="vfio_fops_release">vfio_fops_release</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col5 decl" id="145inode" title='inode' data-type='struct inode *' data-ref="145inode">inode</dfn>, <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col6 decl" id="146filep" title='filep' data-type='struct file *' data-ref="146filep">filep</dfn>)</td></tr>
<tr><th id="1230">1230</th><td>{</td></tr>
<tr><th id="1231">1231</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col7 decl" id="147container" title='container' data-type='struct vfio_container *' data-ref="147container">container</dfn> = <a class="local col6 ref" href="#146filep" title='filep' data-ref="146filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1232">1232</th><td></td></tr>
<tr><th id="1233">1233</th><td>	<a class="local col6 ref" href="#146filep" title='filep' data-ref="146filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a> = <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1234">1234</th><td></td></tr>
<tr><th id="1235">1235</th><td>	<a class="tu ref fn" href="#vfio_container_put" title='vfio_container_put' data-use='c' data-ref="vfio_container_put">vfio_container_put</a>(<a class="local col7 ref" href="#147container" title='container' data-ref="147container">container</a>);</td></tr>
<tr><th id="1236">1236</th><td></td></tr>
<tr><th id="1237">1237</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1238">1238</th><td>}</td></tr>
<tr><th id="1239">1239</th><td></td></tr>
<tr><th id="1240">1240</th><td><i  data-doc="vfio_fops_read">/*</i></td></tr>
<tr><th id="1241">1241</th><td><i  data-doc="vfio_fops_read"> * Once an iommu driver is set, we optionally pass read/write/mmap</i></td></tr>
<tr><th id="1242">1242</th><td><i  data-doc="vfio_fops_read"> * on to the driver, allowing management interfaces beyond ioctl.</i></td></tr>
<tr><th id="1243">1243</th><td><i  data-doc="vfio_fops_read"> */</i></td></tr>
<tr><th id="1244">1244</th><td><em>static</em> <a class="typedef" href="../../include/linux/types.h.html#ssize_t" title='ssize_t' data-type='__kernel_ssize_t' data-ref="ssize_t">ssize_t</a> <dfn class="tu decl def fn" id="vfio_fops_read" title='vfio_fops_read' data-type='ssize_t vfio_fops_read(struct file * filep, char * buf, size_t count, loff_t * ppos)' data-ref="vfio_fops_read">vfio_fops_read</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col8 decl" id="148filep" title='filep' data-type='struct file *' data-ref="148filep">filep</dfn>, <em>char</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *<dfn class="local col9 decl" id="149buf" title='buf' data-type='char *' data-ref="149buf">buf</dfn>,</td></tr>
<tr><th id="1245">1245</th><td>			      <a class="typedef" href="../../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> <dfn class="local col0 decl" id="150count" title='count' data-type='size_t' data-ref="150count">count</dfn>, <a class="typedef" href="../../include/linux/types.h.html#loff_t" title='loff_t' data-type='__kernel_loff_t' data-ref="loff_t">loff_t</a> *<dfn class="local col1 decl" id="151ppos" title='ppos' data-type='loff_t *' data-ref="151ppos">ppos</dfn>)</td></tr>
<tr><th id="1246">1246</th><td>{</td></tr>
<tr><th id="1247">1247</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col2 decl" id="152container" title='container' data-type='struct vfio_container *' data-ref="152container">container</dfn> = <a class="local col8 ref" href="#148filep" title='filep' data-ref="148filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1248">1248</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col3 decl" id="153driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="153driver">driver</dfn>;</td></tr>
<tr><th id="1249">1249</th><td>	<a class="typedef" href="../../include/linux/types.h.html#ssize_t" title='ssize_t' data-type='__kernel_ssize_t' data-ref="ssize_t">ssize_t</a> <dfn class="local col4 decl" id="154ret" title='ret' data-type='ssize_t' data-ref="154ret">ret</dfn> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1250">1250</th><td></td></tr>
<tr><th id="1251">1251</th><td>	<a class="local col3 ref" href="#153driver" title='driver' data-ref="153driver">driver</a> = <a class="local col2 ref" href="#152container" title='container' data-ref="152container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a>;</td></tr>
<tr><th id="1252">1252</th><td>	<b>if</b> (<a class="macro" href="../../include/linux/compiler.h.html#76" title="__builtin_expect(!!(driver &amp;&amp; driver-&gt;ops-&gt;read), 1)" data-ref="_M/likely">likely</a>(<a class="local col3 ref" href="#153driver" title='driver' data-ref="153driver">driver</a> &amp;&amp; <a class="local col3 ref" href="#153driver" title='driver' data-ref="153driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::read" title='vfio_iommu_driver_ops::read' data-ref="vfio_iommu_driver_ops::read">read</a>))</td></tr>
<tr><th id="1253">1253</th><td>		<a class="local col4 ref" href="#154ret" title='ret' data-ref="154ret">ret</a> = <a class="local col3 ref" href="#153driver" title='driver' data-ref="153driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::read" title='vfio_iommu_driver_ops::read' data-ref="vfio_iommu_driver_ops::read">read</a>(<a class="local col2 ref" href="#152container" title='container' data-ref="152container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='r' data-ref="vfio_container::iommu_data">iommu_data</a>,</td></tr>
<tr><th id="1254">1254</th><td>					<a class="local col9 ref" href="#149buf" title='buf' data-ref="149buf">buf</a>, <a class="local col0 ref" href="#150count" title='count' data-ref="150count">count</a>, <a class="local col1 ref" href="#151ppos" title='ppos' data-ref="151ppos">ppos</a>);</td></tr>
<tr><th id="1255">1255</th><td></td></tr>
<tr><th id="1256">1256</th><td>	<b>return</b> <a class="local col4 ref" href="#154ret" title='ret' data-ref="154ret">ret</a>;</td></tr>
<tr><th id="1257">1257</th><td>}</td></tr>
<tr><th id="1258">1258</th><td></td></tr>
<tr><th id="1259">1259</th><td><em>static</em> <a class="typedef" href="../../include/linux/types.h.html#ssize_t" title='ssize_t' data-type='__kernel_ssize_t' data-ref="ssize_t">ssize_t</a> <dfn class="tu decl def fn" id="vfio_fops_write" title='vfio_fops_write' data-type='ssize_t vfio_fops_write(struct file * filep, const char * buf, size_t count, loff_t * ppos)' data-ref="vfio_fops_write">vfio_fops_write</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col5 decl" id="155filep" title='filep' data-type='struct file *' data-ref="155filep">filep</dfn>, <em>const</em> <em>char</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *<dfn class="local col6 decl" id="156buf" title='buf' data-type='const char *' data-ref="156buf">buf</dfn>,</td></tr>
<tr><th id="1260">1260</th><td>			       <a class="typedef" href="../../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> <dfn class="local col7 decl" id="157count" title='count' data-type='size_t' data-ref="157count">count</dfn>, <a class="typedef" href="../../include/linux/types.h.html#loff_t" title='loff_t' data-type='__kernel_loff_t' data-ref="loff_t">loff_t</a> *<dfn class="local col8 decl" id="158ppos" title='ppos' data-type='loff_t *' data-ref="158ppos">ppos</dfn>)</td></tr>
<tr><th id="1261">1261</th><td>{</td></tr>
<tr><th id="1262">1262</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col9 decl" id="159container" title='container' data-type='struct vfio_container *' data-ref="159container">container</dfn> = <a class="local col5 ref" href="#155filep" title='filep' data-ref="155filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1263">1263</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col0 decl" id="160driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="160driver">driver</dfn>;</td></tr>
<tr><th id="1264">1264</th><td>	<a class="typedef" href="../../include/linux/types.h.html#ssize_t" title='ssize_t' data-type='__kernel_ssize_t' data-ref="ssize_t">ssize_t</a> <dfn class="local col1 decl" id="161ret" title='ret' data-type='ssize_t' data-ref="161ret">ret</dfn> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1265">1265</th><td></td></tr>
<tr><th id="1266">1266</th><td>	<a class="local col0 ref" href="#160driver" title='driver' data-ref="160driver">driver</a> = <a class="local col9 ref" href="#159container" title='container' data-ref="159container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a>;</td></tr>
<tr><th id="1267">1267</th><td>	<b>if</b> (<a class="macro" href="../../include/linux/compiler.h.html#76" title="__builtin_expect(!!(driver &amp;&amp; driver-&gt;ops-&gt;write), 1)" data-ref="_M/likely">likely</a>(<a class="local col0 ref" href="#160driver" title='driver' data-ref="160driver">driver</a> &amp;&amp; <a class="local col0 ref" href="#160driver" title='driver' data-ref="160driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::write" title='vfio_iommu_driver_ops::write' data-ref="vfio_iommu_driver_ops::write">write</a>))</td></tr>
<tr><th id="1268">1268</th><td>		<a class="local col1 ref" href="#161ret" title='ret' data-ref="161ret">ret</a> = <a class="local col0 ref" href="#160driver" title='driver' data-ref="160driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::write" title='vfio_iommu_driver_ops::write' data-ref="vfio_iommu_driver_ops::write">write</a>(<a class="local col9 ref" href="#159container" title='container' data-ref="159container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='r' data-ref="vfio_container::iommu_data">iommu_data</a>,</td></tr>
<tr><th id="1269">1269</th><td>					 <a class="local col6 ref" href="#156buf" title='buf' data-ref="156buf">buf</a>, <a class="local col7 ref" href="#157count" title='count' data-ref="157count">count</a>, <a class="local col8 ref" href="#158ppos" title='ppos' data-ref="158ppos">ppos</a>);</td></tr>
<tr><th id="1270">1270</th><td></td></tr>
<tr><th id="1271">1271</th><td>	<b>return</b> <a class="local col1 ref" href="#161ret" title='ret' data-ref="161ret">ret</a>;</td></tr>
<tr><th id="1272">1272</th><td>}</td></tr>
<tr><th id="1273">1273</th><td></td></tr>
<tr><th id="1274">1274</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_fops_mmap" title='vfio_fops_mmap' data-type='int vfio_fops_mmap(struct file * filep, struct vm_area_struct * vma)' data-ref="vfio_fops_mmap">vfio_fops_mmap</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col2 decl" id="162filep" title='filep' data-type='struct file *' data-ref="162filep">filep</dfn>, <b>struct</b> <a class="type" href="../../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col3 decl" id="163vma" title='vma' data-type='struct vm_area_struct *' data-ref="163vma">vma</dfn>)</td></tr>
<tr><th id="1275">1275</th><td>{</td></tr>
<tr><th id="1276">1276</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col4 decl" id="164container" title='container' data-type='struct vfio_container *' data-ref="164container">container</dfn> = <a class="local col2 ref" href="#162filep" title='filep' data-ref="162filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1277">1277</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col5 decl" id="165driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="165driver">driver</dfn>;</td></tr>
<tr><th id="1278">1278</th><td>	<em>int</em> <dfn class="local col6 decl" id="166ret" title='ret' data-type='int' data-ref="166ret">ret</dfn> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1279">1279</th><td></td></tr>
<tr><th id="1280">1280</th><td>	<a class="local col5 ref" href="#165driver" title='driver' data-ref="165driver">driver</a> = <a class="local col4 ref" href="#164container" title='container' data-ref="164container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a>;</td></tr>
<tr><th id="1281">1281</th><td>	<b>if</b> (<a class="macro" href="../../include/linux/compiler.h.html#76" title="__builtin_expect(!!(driver &amp;&amp; driver-&gt;ops-&gt;mmap), 1)" data-ref="_M/likely">likely</a>(<a class="local col5 ref" href="#165driver" title='driver' data-ref="165driver">driver</a> &amp;&amp; <a class="local col5 ref" href="#165driver" title='driver' data-ref="165driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::mmap" title='vfio_iommu_driver_ops::mmap' data-ref="vfio_iommu_driver_ops::mmap">mmap</a>))</td></tr>
<tr><th id="1282">1282</th><td>		<a class="local col6 ref" href="#166ret" title='ret' data-ref="166ret">ret</a> = <a class="local col5 ref" href="#165driver" title='driver' data-ref="165driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::mmap" title='vfio_iommu_driver_ops::mmap' data-ref="vfio_iommu_driver_ops::mmap">mmap</a>(<a class="local col4 ref" href="#164container" title='container' data-ref="164container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='r' data-ref="vfio_container::iommu_data">iommu_data</a>, <a class="local col3 ref" href="#163vma" title='vma' data-ref="163vma">vma</a>);</td></tr>
<tr><th id="1283">1283</th><td></td></tr>
<tr><th id="1284">1284</th><td>	<b>return</b> <a class="local col6 ref" href="#166ret" title='ret' data-ref="166ret">ret</a>;</td></tr>
<tr><th id="1285">1285</th><td>}</td></tr>
<tr><th id="1286">1286</th><td></td></tr>
<tr><th id="1287">1287</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file_operations" title='file_operations' data-ref="file_operations">file_operations</a> <dfn class="tu decl def" id="vfio_fops" title='vfio_fops' data-type='const struct file_operations' data-ref="vfio_fops">vfio_fops</dfn> = {</td></tr>
<tr><th id="1288">1288</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::owner" title='file_operations::owner' data-ref="file_operations::owner">owner</a>		= <a class="macro" href="../../include/linux/export.h.html#31" title="((struct module *)0)" data-ref="_M/THIS_MODULE">THIS_MODULE</a>,</td></tr>
<tr><th id="1289">1289</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::open" title='file_operations::open' data-ref="file_operations::open">open</a>		= <a class="tu ref fn" href="#vfio_fops_open" title='vfio_fops_open' data-ref="vfio_fops_open">vfio_fops_open</a>,</td></tr>
<tr><th id="1290">1290</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::release" title='file_operations::release' data-ref="file_operations::release">release</a>	= <a class="tu ref fn" href="#vfio_fops_release" title='vfio_fops_release' data-ref="vfio_fops_release">vfio_fops_release</a>,</td></tr>
<tr><th id="1291">1291</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::read" title='file_operations::read' data-ref="file_operations::read">read</a>		= <a class="tu ref fn" href="#vfio_fops_read" title='vfio_fops_read' data-ref="vfio_fops_read">vfio_fops_read</a>,</td></tr>
<tr><th id="1292">1292</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::write" title='file_operations::write' data-ref="file_operations::write">write</a>		= <a class="tu ref fn" href="#vfio_fops_write" title='vfio_fops_write' data-ref="vfio_fops_write">vfio_fops_write</a>,</td></tr>
<tr><th id="1293">1293</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::unlocked_ioctl" title='file_operations::unlocked_ioctl' data-ref="file_operations::unlocked_ioctl">unlocked_ioctl</a>	= <a class="tu ref fn" href="#vfio_fops_unl_ioctl" title='vfio_fops_unl_ioctl' data-ref="vfio_fops_unl_ioctl">vfio_fops_unl_ioctl</a>,</td></tr>
<tr><th id="1294">1294</th><td><u>#<span data-ppcond="1294">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#96" data-ref="_M/CONFIG_COMPAT">CONFIG_COMPAT</a></u></td></tr>
<tr><th id="1295">1295</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::compat_ioctl" title='file_operations::compat_ioctl' data-ref="file_operations::compat_ioctl">compat_ioctl</a>	= <a class="tu ref fn" href="#vfio_fops_compat_ioctl" title='vfio_fops_compat_ioctl' data-ref="vfio_fops_compat_ioctl">vfio_fops_compat_ioctl</a>,</td></tr>
<tr><th id="1296">1296</th><td><u>#<span data-ppcond="1294">endif</span></u></td></tr>
<tr><th id="1297">1297</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::mmap" title='file_operations::mmap' data-ref="file_operations::mmap">mmap</a>		= <a class="tu ref fn" href="#vfio_fops_mmap" title='vfio_fops_mmap' data-ref="vfio_fops_mmap">vfio_fops_mmap</a>,</td></tr>
<tr><th id="1298">1298</th><td>};</td></tr>
<tr><th id="1299">1299</th><td></td></tr>
<tr><th id="1300">1300</th><td><i class="doc" data-doc="__vfio_group_unset_container">/**</i></td></tr>
<tr><th id="1301">1301</th><td><i class="doc" data-doc="__vfio_group_unset_container"> * VFIO Group fd, /dev/vfio/$GROUP</i></td></tr>
<tr><th id="1302">1302</th><td><i class="doc" data-doc="__vfio_group_unset_container"> */</i></td></tr>
<tr><th id="1303">1303</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="__vfio_group_unset_container" title='__vfio_group_unset_container' data-type='void __vfio_group_unset_container(struct vfio_group * group)' data-ref="__vfio_group_unset_container">__vfio_group_unset_container</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col7 decl" id="167group" title='group' data-type='struct vfio_group *' data-ref="167group">group</dfn>)</td></tr>
<tr><th id="1304">1304</th><td>{</td></tr>
<tr><th id="1305">1305</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col8 decl" id="168container" title='container' data-type='struct vfio_container *' data-ref="168container">container</dfn> = <a class="local col7 ref" href="#167group" title='group' data-ref="167group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a>;</td></tr>
<tr><th id="1306">1306</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col9 decl" id="169driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="169driver">driver</dfn>;</td></tr>
<tr><th id="1307">1307</th><td></td></tr>
<tr><th id="1308">1308</th><td>	<a class="ref fn" href="../../include/linux/rwsem.h.html#down_write" title='down_write' data-ref="down_write">down_write</a>(&amp;<a class="local col8 ref" href="#168container" title='container' data-ref="168container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_lock" title='vfio_container::group_lock' data-use='a' data-ref="vfio_container::group_lock">group_lock</a>);</td></tr>
<tr><th id="1309">1309</th><td></td></tr>
<tr><th id="1310">1310</th><td>	<a class="local col9 ref" href="#169driver" title='driver' data-ref="169driver">driver</a> = <a class="local col8 ref" href="#168container" title='container' data-ref="168container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a>;</td></tr>
<tr><th id="1311">1311</th><td>	<b>if</b> (<a class="local col9 ref" href="#169driver" title='driver' data-ref="169driver">driver</a>)</td></tr>
<tr><th id="1312">1312</th><td>		<a class="local col9 ref" href="#169driver" title='driver' data-ref="169driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::detach_group" title='vfio_iommu_driver_ops::detach_group' data-ref="vfio_iommu_driver_ops::detach_group">detach_group</a>(<a class="local col8 ref" href="#168container" title='container' data-ref="168container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='r' data-ref="vfio_container::iommu_data">iommu_data</a>,</td></tr>
<tr><th id="1313">1313</th><td>					  <a class="local col7 ref" href="#167group" title='group' data-ref="167group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>);</td></tr>
<tr><th id="1314">1314</th><td></td></tr>
<tr><th id="1315">1315</th><td>	<a class="local col7 ref" href="#167group" title='group' data-ref="167group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a> = <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1316">1316</th><td>	<a class="macro" href="../../include/linux/wait.h.html#195" title="__wake_up(&amp;group-&gt;container_q, (0x0001 | 0x0002), 1, ((void *)0))" data-ref="_M/wake_up">wake_up</a>(&amp;<a class="local col7 ref" href="#167group" title='group' data-ref="167group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_q" title='vfio_group::container_q' data-ref="vfio_group::container_q">container_q</a>);</td></tr>
<tr><th id="1317">1317</th><td>	<a class="ref fn" href="../../include/linux/list.h.html#list_del" title='list_del' data-ref="list_del">list_del</a>(&amp;<a class="local col7 ref" href="#167group" title='group' data-ref="167group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_next" title='vfio_group::container_next' data-ref="vfio_group::container_next">container_next</a>);</td></tr>
<tr><th id="1318">1318</th><td></td></tr>
<tr><th id="1319">1319</th><td>	<i>/* Detaching the last group deprivileges a container, remove iommu */</i></td></tr>
<tr><th id="1320">1320</th><td>	<b>if</b> (<a class="local col9 ref" href="#169driver" title='driver' data-ref="169driver">driver</a> &amp;&amp; <a class="ref fn" href="../../include/linux/list.h.html#list_empty" title='list_empty' data-ref="list_empty">list_empty</a>(&amp;<a class="local col8 ref" href="#168container" title='container' data-ref="168container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_list" title='vfio_container::group_list' data-use='a' data-ref="vfio_container::group_list">group_list</a>)) {</td></tr>
<tr><th id="1321">1321</th><td>		<a class="local col9 ref" href="#169driver" title='driver' data-ref="169driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::release" title='vfio_iommu_driver_ops::release' data-ref="vfio_iommu_driver_ops::release">release</a>(<a class="local col8 ref" href="#168container" title='container' data-ref="168container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='r' data-ref="vfio_container::iommu_data">iommu_data</a>);</td></tr>
<tr><th id="1322">1322</th><td>		<a class="ref fn" href="../../include/linux/module.h.html#module_put" title='module_put' data-ref="module_put">module_put</a>(<a class="local col9 ref" href="#169driver" title='driver' data-ref="169driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::owner" title='vfio_iommu_driver_ops::owner' data-ref="vfio_iommu_driver_ops::owner">owner</a>);</td></tr>
<tr><th id="1323">1323</th><td>		<a class="local col8 ref" href="#168container" title='container' data-ref="168container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='w' data-ref="vfio_container::iommu_driver">iommu_driver</a> = <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1324">1324</th><td>		<a class="local col8 ref" href="#168container" title='container' data-ref="168container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='w' data-ref="vfio_container::iommu_data">iommu_data</a> = <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1325">1325</th><td>	}</td></tr>
<tr><th id="1326">1326</th><td></td></tr>
<tr><th id="1327">1327</th><td>	<a class="ref fn" href="../../include/linux/rwsem.h.html#up_write" title='up_write' data-ref="up_write">up_write</a>(&amp;<a class="local col8 ref" href="#168container" title='container' data-ref="168container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_lock" title='vfio_container::group_lock' data-use='a' data-ref="vfio_container::group_lock">group_lock</a>);</td></tr>
<tr><th id="1328">1328</th><td></td></tr>
<tr><th id="1329">1329</th><td>	<a class="tu ref fn" href="#vfio_container_put" title='vfio_container_put' data-use='c' data-ref="vfio_container_put">vfio_container_put</a>(<a class="local col8 ref" href="#168container" title='container' data-ref="168container">container</a>);</td></tr>
<tr><th id="1330">1330</th><td>}</td></tr>
<tr><th id="1331">1331</th><td></td></tr>
<tr><th id="1332">1332</th><td><i  data-doc="vfio_group_unset_container">/*</i></td></tr>
<tr><th id="1333">1333</th><td><i  data-doc="vfio_group_unset_container"> * VFIO_GROUP_UNSET_CONTAINER should fail if there are other users or</i></td></tr>
<tr><th id="1334">1334</th><td><i  data-doc="vfio_group_unset_container"> * if there was no container to unset.  Since the ioctl is called on</i></td></tr>
<tr><th id="1335">1335</th><td><i  data-doc="vfio_group_unset_container"> * the group, we know that still exists, therefore the only valid</i></td></tr>
<tr><th id="1336">1336</th><td><i  data-doc="vfio_group_unset_container"> * transition here is 1-&gt;0.</i></td></tr>
<tr><th id="1337">1337</th><td><i  data-doc="vfio_group_unset_container"> */</i></td></tr>
<tr><th id="1338">1338</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_group_unset_container" title='vfio_group_unset_container' data-type='int vfio_group_unset_container(struct vfio_group * group)' data-ref="vfio_group_unset_container">vfio_group_unset_container</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col0 decl" id="170group" title='group' data-type='struct vfio_group *' data-ref="170group">group</dfn>)</td></tr>
<tr><th id="1339">1339</th><td>{</td></tr>
<tr><th id="1340">1340</th><td>	<em>int</em> <dfn class="local col1 decl" id="171users" title='users' data-type='int' data-ref="171users">users</dfn> = <a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_cmpxchg" title='atomic_cmpxchg' data-ref="atomic_cmpxchg">atomic_cmpxchg</a>(&amp;<a class="local col0 ref" href="#170group" title='group' data-ref="170group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</a>, <var>1</var>, <var>0</var>);</td></tr>
<tr><th id="1341">1341</th><td></td></tr>
<tr><th id="1342">1342</th><td>	<b>if</b> (!<a class="local col1 ref" href="#171users" title='users' data-ref="171users">users</a>)</td></tr>
<tr><th id="1343">1343</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1344">1344</th><td>	<b>if</b> (<a class="local col1 ref" href="#171users" title='users' data-ref="171users">users</a> != <var>1</var>)</td></tr>
<tr><th id="1345">1345</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#20" title="16" data-ref="_M/EBUSY">EBUSY</a>;</td></tr>
<tr><th id="1346">1346</th><td></td></tr>
<tr><th id="1347">1347</th><td>	<a class="tu ref fn" href="#__vfio_group_unset_container" title='__vfio_group_unset_container' data-use='c' data-ref="__vfio_group_unset_container">__vfio_group_unset_container</a>(<a class="local col0 ref" href="#170group" title='group' data-ref="170group">group</a>);</td></tr>
<tr><th id="1348">1348</th><td></td></tr>
<tr><th id="1349">1349</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1350">1350</th><td>}</td></tr>
<tr><th id="1351">1351</th><td></td></tr>
<tr><th id="1352">1352</th><td><i  data-doc="vfio_group_try_dissolve_container">/*</i></td></tr>
<tr><th id="1353">1353</th><td><i  data-doc="vfio_group_try_dissolve_container"> * When removing container users, anything that removes the last user</i></td></tr>
<tr><th id="1354">1354</th><td><i  data-doc="vfio_group_try_dissolve_container"> * implicitly removes the group from the container.  That is, if the</i></td></tr>
<tr><th id="1355">1355</th><td><i  data-doc="vfio_group_try_dissolve_container"> * group file descriptor is closed, as well as any device file descriptors,</i></td></tr>
<tr><th id="1356">1356</th><td><i  data-doc="vfio_group_try_dissolve_container"> * the group is free.</i></td></tr>
<tr><th id="1357">1357</th><td><i  data-doc="vfio_group_try_dissolve_container"> */</i></td></tr>
<tr><th id="1358">1358</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vfio_group_try_dissolve_container" title='vfio_group_try_dissolve_container' data-type='void vfio_group_try_dissolve_container(struct vfio_group * group)' data-ref="vfio_group_try_dissolve_container">vfio_group_try_dissolve_container</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col2 decl" id="172group" title='group' data-type='struct vfio_group *' data-ref="172group">group</dfn>)</td></tr>
<tr><th id="1359">1359</th><td>{</td></tr>
<tr><th id="1360">1360</th><td>	<b>if</b> (<var>0</var> == <a class="ref fn" href="../../include/linux/atomic.h.html#atomic_dec_if_positive" title='atomic_dec_if_positive' data-ref="atomic_dec_if_positive">atomic_dec_if_positive</a>(&amp;<a class="local col2 ref" href="#172group" title='group' data-ref="172group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</a>))</td></tr>
<tr><th id="1361">1361</th><td>		<a class="tu ref fn" href="#__vfio_group_unset_container" title='__vfio_group_unset_container' data-use='c' data-ref="__vfio_group_unset_container">__vfio_group_unset_container</a>(<a class="local col2 ref" href="#172group" title='group' data-ref="172group">group</a>);</td></tr>
<tr><th id="1362">1362</th><td>}</td></tr>
<tr><th id="1363">1363</th><td></td></tr>
<tr><th id="1364">1364</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_group_set_container" title='vfio_group_set_container' data-type='int vfio_group_set_container(struct vfio_group * group, int container_fd)' data-ref="vfio_group_set_container">vfio_group_set_container</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col3 decl" id="173group" title='group' data-type='struct vfio_group *' data-ref="173group">group</dfn>, <em>int</em> <dfn class="local col4 decl" id="174container_fd" title='container_fd' data-type='int' data-ref="174container_fd">container_fd</dfn>)</td></tr>
<tr><th id="1365">1365</th><td>{</td></tr>
<tr><th id="1366">1366</th><td>	<b>struct</b> <a class="type" href="../../include/linux/file.h.html#fd" title='fd' data-ref="fd">fd</a> <dfn class="local col5 decl" id="175f" title='f' data-type='struct fd' data-ref="175f">f</dfn>;</td></tr>
<tr><th id="1367">1367</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col6 decl" id="176container" title='container' data-type='struct vfio_container *' data-ref="176container">container</dfn>;</td></tr>
<tr><th id="1368">1368</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col7 decl" id="177driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="177driver">driver</dfn>;</td></tr>
<tr><th id="1369">1369</th><td>	<em>int</em> <dfn class="local col8 decl" id="178ret" title='ret' data-type='int' data-ref="178ret">ret</dfn> = <var>0</var>;</td></tr>
<tr><th id="1370">1370</th><td></td></tr>
<tr><th id="1371">1371</th><td>	<b>if</b> (<a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_read" title='atomic_read' data-ref="atomic_read">atomic_read</a>(&amp;<a class="local col3 ref" href="#173group" title='group' data-ref="173group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</a>))</td></tr>
<tr><th id="1372">1372</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1373">1373</th><td></td></tr>
<tr><th id="1374">1374</th><td>	<b>if</b> (<a class="local col3 ref" href="#173group" title='group' data-ref="173group">group</a>-&gt;<a class="ref field" href="#vfio_group::noiommu" title='vfio_group::noiommu' data-ref="vfio_group::noiommu">noiommu</a> &amp;&amp; !<a class="ref fn" href="../../include/linux/capability.h.html#capable" title='capable' data-ref="capable">capable</a>(<a class="macro" href="../../include/uapi/linux/capability.h.html#227" title="17" data-ref="_M/CAP_SYS_RAWIO">CAP_SYS_RAWIO</a>))</td></tr>
<tr><th id="1375">1375</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="1376">1376</th><td></td></tr>
<tr><th id="1377">1377</th><td>	<a class="local col5 ref" href="#175f" title='f' data-ref="175f">f</a> = <a class="ref fn" href="../../include/linux/file.h.html#fdget" title='fdget' data-ref="fdget">fdget</a>(<a class="local col4 ref" href="#174container_fd" title='container_fd' data-ref="174container_fd">container_fd</a>);</td></tr>
<tr><th id="1378">1378</th><td>	<b>if</b> (!<a class="local col5 ref" href="#175f" title='f' data-ref="175f">f</a>.<a class="ref field" href="../../include/linux/file.h.html#fd::file" title='fd::file' data-ref="fd::file">file</a>)</td></tr>
<tr><th id="1379">1379</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#13" title="9" data-ref="_M/EBADF">EBADF</a>;</td></tr>
<tr><th id="1380">1380</th><td></td></tr>
<tr><th id="1381">1381</th><td>	<i>/* Sanity check, is this really our fd? */</i></td></tr>
<tr><th id="1382">1382</th><td>	<b>if</b> (<a class="local col5 ref" href="#175f" title='f' data-ref="175f">f</a>.<a class="ref field" href="../../include/linux/file.h.html#fd::file" title='fd::file' data-ref="fd::file">file</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::f_op" title='file::f_op' data-ref="file::f_op">f_op</a> != &amp;<a class="tu ref" href="#vfio_fops" title='vfio_fops' data-use='a' data-ref="vfio_fops">vfio_fops</a>) {</td></tr>
<tr><th id="1383">1383</th><td>		<a class="ref fn" href="../../include/linux/file.h.html#fdput" title='fdput' data-ref="fdput">fdput</a>(<a class="local col5 ref" href="#175f" title='f' data-ref="175f">f</a>);</td></tr>
<tr><th id="1384">1384</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1385">1385</th><td>	}</td></tr>
<tr><th id="1386">1386</th><td></td></tr>
<tr><th id="1387">1387</th><td>	<a class="local col6 ref" href="#176container" title='container' data-ref="176container">container</a> = <a class="local col5 ref" href="#175f" title='f' data-ref="175f">f</a>.<a class="ref field" href="../../include/linux/file.h.html#fd::file" title='fd::file' data-ref="fd::file">file</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1388">1388</th><td>	<a class="macro" href="../../include/asm-generic/bug.h.html#111" title="({ int __ret_warn_on = !!(!container); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/drivers/vfio/vfio.c&quot;), &quot;i&quot; (1388), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (82)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col6 ref" href="#176container" title='container' data-ref="176container">container</a>); <i>/* fget ensures we don't race vfio_release */</i></td></tr>
<tr><th id="1389">1389</th><td></td></tr>
<tr><th id="1390">1390</th><td>	<a class="ref fn" href="../../include/linux/rwsem.h.html#down_write" title='down_write' data-ref="down_write">down_write</a>(&amp;<a class="local col6 ref" href="#176container" title='container' data-ref="176container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_lock" title='vfio_container::group_lock' data-use='a' data-ref="vfio_container::group_lock">group_lock</a>);</td></tr>
<tr><th id="1391">1391</th><td></td></tr>
<tr><th id="1392">1392</th><td>	<i>/* Real groups and fake groups cannot mix */</i></td></tr>
<tr><th id="1393">1393</th><td>	<b>if</b> (!<a class="ref fn" href="../../include/linux/list.h.html#list_empty" title='list_empty' data-ref="list_empty">list_empty</a>(&amp;<a class="local col6 ref" href="#176container" title='container' data-ref="176container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_list" title='vfio_container::group_list' data-use='a' data-ref="vfio_container::group_list">group_list</a>) &amp;&amp;</td></tr>
<tr><th id="1394">1394</th><td>	    <a class="local col6 ref" href="#176container" title='container' data-ref="176container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::noiommu" title='vfio_container::noiommu' data-use='r' data-ref="vfio_container::noiommu">noiommu</a> != <a class="local col3 ref" href="#173group" title='group' data-ref="173group">group</a>-&gt;<a class="ref field" href="#vfio_group::noiommu" title='vfio_group::noiommu' data-ref="vfio_group::noiommu">noiommu</a>) {</td></tr>
<tr><th id="1395">1395</th><td>		<a class="local col8 ref" href="#178ret" title='ret' data-ref="178ret">ret</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="1396">1396</th><td>		<b>goto</b> <a class="lbl" href="#179unlock_out" data-ref="179unlock_out">unlock_out</a>;</td></tr>
<tr><th id="1397">1397</th><td>	}</td></tr>
<tr><th id="1398">1398</th><td></td></tr>
<tr><th id="1399">1399</th><td>	<a class="local col7 ref" href="#177driver" title='driver' data-ref="177driver">driver</a> = <a class="local col6 ref" href="#176container" title='container' data-ref="176container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a>;</td></tr>
<tr><th id="1400">1400</th><td>	<b>if</b> (<a class="local col7 ref" href="#177driver" title='driver' data-ref="177driver">driver</a>) {</td></tr>
<tr><th id="1401">1401</th><td>		<a class="local col8 ref" href="#178ret" title='ret' data-ref="178ret">ret</a> = <a class="local col7 ref" href="#177driver" title='driver' data-ref="177driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::attach_group" title='vfio_iommu_driver_ops::attach_group' data-ref="vfio_iommu_driver_ops::attach_group">attach_group</a>(<a class="local col6 ref" href="#176container" title='container' data-ref="176container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='r' data-ref="vfio_container::iommu_data">iommu_data</a>,</td></tr>
<tr><th id="1402">1402</th><td>						<a class="local col3 ref" href="#173group" title='group' data-ref="173group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>);</td></tr>
<tr><th id="1403">1403</th><td>		<b>if</b> (<a class="local col8 ref" href="#178ret" title='ret' data-ref="178ret">ret</a>)</td></tr>
<tr><th id="1404">1404</th><td>			<b>goto</b> <a class="lbl" href="#179unlock_out" data-ref="179unlock_out">unlock_out</a>;</td></tr>
<tr><th id="1405">1405</th><td>	}</td></tr>
<tr><th id="1406">1406</th><td></td></tr>
<tr><th id="1407">1407</th><td>	<a class="local col3 ref" href="#173group" title='group' data-ref="173group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a> = <a class="local col6 ref" href="#176container" title='container' data-ref="176container">container</a>;</td></tr>
<tr><th id="1408">1408</th><td>	<a class="local col6 ref" href="#176container" title='container' data-ref="176container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::noiommu" title='vfio_container::noiommu' data-use='w' data-ref="vfio_container::noiommu">noiommu</a> = <a class="local col3 ref" href="#173group" title='group' data-ref="173group">group</a>-&gt;<a class="ref field" href="#vfio_group::noiommu" title='vfio_group::noiommu' data-ref="vfio_group::noiommu">noiommu</a>;</td></tr>
<tr><th id="1409">1409</th><td>	<a class="ref fn" href="../../include/linux/list.h.html#list_add" title='list_add' data-ref="list_add">list_add</a>(&amp;<a class="local col3 ref" href="#173group" title='group' data-ref="173group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_next" title='vfio_group::container_next' data-ref="vfio_group::container_next">container_next</a>, &amp;<a class="local col6 ref" href="#176container" title='container' data-ref="176container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_list" title='vfio_container::group_list' data-use='a' data-ref="vfio_container::group_list">group_list</a>);</td></tr>
<tr><th id="1410">1410</th><td></td></tr>
<tr><th id="1411">1411</th><td>	<i>/* Get a reference on the container and mark a user within the group */</i></td></tr>
<tr><th id="1412">1412</th><td>	<a class="tu ref fn" href="#vfio_container_get" title='vfio_container_get' data-use='c' data-ref="vfio_container_get">vfio_container_get</a>(<a class="local col6 ref" href="#176container" title='container' data-ref="176container">container</a>);</td></tr>
<tr><th id="1413">1413</th><td>	<a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_inc" title='atomic_inc' data-ref="atomic_inc">atomic_inc</a>(&amp;<a class="local col3 ref" href="#173group" title='group' data-ref="173group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</a>);</td></tr>
<tr><th id="1414">1414</th><td></td></tr>
<tr><th id="1415">1415</th><td><dfn class="lbl" id="179unlock_out" data-ref="179unlock_out">unlock_out</dfn>:</td></tr>
<tr><th id="1416">1416</th><td>	<a class="ref fn" href="../../include/linux/rwsem.h.html#up_write" title='up_write' data-ref="up_write">up_write</a>(&amp;<a class="local col6 ref" href="#176container" title='container' data-ref="176container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::group_lock" title='vfio_container::group_lock' data-use='a' data-ref="vfio_container::group_lock">group_lock</a>);</td></tr>
<tr><th id="1417">1417</th><td>	<a class="ref fn" href="../../include/linux/file.h.html#fdput" title='fdput' data-ref="fdput">fdput</a>(<a class="local col5 ref" href="#175f" title='f' data-ref="175f">f</a>);</td></tr>
<tr><th id="1418">1418</th><td>	<b>return</b> <a class="local col8 ref" href="#178ret" title='ret' data-ref="178ret">ret</a>;</td></tr>
<tr><th id="1419">1419</th><td>}</td></tr>
<tr><th id="1420">1420</th><td></td></tr>
<tr><th id="1421">1421</th><td><em>static</em> <a class="typedef" href="../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="tu decl def fn" id="vfio_group_viable" title='vfio_group_viable' data-type='bool vfio_group_viable(struct vfio_group * group)' data-ref="vfio_group_viable">vfio_group_viable</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col0 decl" id="180group" title='group' data-type='struct vfio_group *' data-ref="180group">group</dfn>)</td></tr>
<tr><th id="1422">1422</th><td>{</td></tr>
<tr><th id="1423">1423</th><td>	<b>return</b> (<a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_for_each_dev" title='iommu_group_for_each_dev' data-ref="iommu_group_for_each_dev">iommu_group_for_each_dev</a>(<a class="local col0 ref" href="#180group" title='group' data-ref="180group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>,</td></tr>
<tr><th id="1424">1424</th><td>					 <a class="local col0 ref" href="#180group" title='group' data-ref="180group">group</a>, <a class="tu ref fn" href="#vfio_dev_viable" title='vfio_dev_viable' data-use='r' data-ref="vfio_dev_viable">vfio_dev_viable</a>) == <var>0</var>);</td></tr>
<tr><th id="1425">1425</th><td>}</td></tr>
<tr><th id="1426">1426</th><td></td></tr>
<tr><th id="1427">1427</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_group_add_container_user" title='vfio_group_add_container_user' data-type='int vfio_group_add_container_user(struct vfio_group * group)' data-ref="vfio_group_add_container_user">vfio_group_add_container_user</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col1 decl" id="181group" title='group' data-type='struct vfio_group *' data-ref="181group">group</dfn>)</td></tr>
<tr><th id="1428">1428</th><td>{</td></tr>
<tr><th id="1429">1429</th><td>	<b>if</b> (!<a class="macro" href="../../include/linux/atomic.h.html#544" title="atomic_add_unless((&amp;group-&gt;container_users), 1, 0)" data-ref="_M/atomic_inc_not_zero">atomic_inc_not_zero</a>(&amp;<a class="local col1 ref" href="#181group" title='group' data-ref="181group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</a>))</td></tr>
<tr><th id="1430">1430</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1431">1431</th><td></td></tr>
<tr><th id="1432">1432</th><td>	<b>if</b> (<a class="local col1 ref" href="#181group" title='group' data-ref="181group">group</a>-&gt;<a class="ref field" href="#vfio_group::noiommu" title='vfio_group::noiommu' data-ref="vfio_group::noiommu">noiommu</a>) {</td></tr>
<tr><th id="1433">1433</th><td>		<a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_dec" title='atomic_dec' data-ref="atomic_dec">atomic_dec</a>(&amp;<a class="local col1 ref" href="#181group" title='group' data-ref="181group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</a>);</td></tr>
<tr><th id="1434">1434</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="1435">1435</th><td>	}</td></tr>
<tr><th id="1436">1436</th><td>	<b>if</b> (!<a class="local col1 ref" href="#181group" title='group' data-ref="181group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a> || !<a class="tu ref fn" href="#vfio_group_viable" title='vfio_group_viable' data-use='c' data-ref="vfio_group_viable">vfio_group_viable</a>(<a class="local col1 ref" href="#181group" title='group' data-ref="181group">group</a>)) {</td></tr>
<tr><th id="1437">1437</th><td>		<a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_dec" title='atomic_dec' data-ref="atomic_dec">atomic_dec</a>(&amp;<a class="local col1 ref" href="#181group" title='group' data-ref="181group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</a>);</td></tr>
<tr><th id="1438">1438</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1439">1439</th><td>	}</td></tr>
<tr><th id="1440">1440</th><td></td></tr>
<tr><th id="1441">1441</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1442">1442</th><td>}</td></tr>
<tr><th id="1443">1443</th><td></td></tr>
<tr><th id="1444">1444</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file_operations" title='file_operations' data-ref="file_operations">file_operations</a> <dfn class="tu decl def" id="vfio_device_fops" title='vfio_device_fops' data-type='const struct file_operations' data-ref="vfio_device_fops">vfio_device_fops</dfn>;</td></tr>
<tr><th id="1445">1445</th><td></td></tr>
<tr><th id="1446">1446</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_group_get_device_fd" title='vfio_group_get_device_fd' data-type='int vfio_group_get_device_fd(struct vfio_group * group, char * buf)' data-ref="vfio_group_get_device_fd">vfio_group_get_device_fd</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col2 decl" id="182group" title='group' data-type='struct vfio_group *' data-ref="182group">group</dfn>, <em>char</em> *<dfn class="local col3 decl" id="183buf" title='buf' data-type='char *' data-ref="183buf">buf</dfn>)</td></tr>
<tr><th id="1447">1447</th><td>{</td></tr>
<tr><th id="1448">1448</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col4 decl" id="184device" title='device' data-type='struct vfio_device *' data-ref="184device">device</dfn>;</td></tr>
<tr><th id="1449">1449</th><td>	<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col5 decl" id="185filep" title='filep' data-type='struct file *' data-ref="185filep">filep</dfn>;</td></tr>
<tr><th id="1450">1450</th><td>	<em>int</em> <dfn class="local col6 decl" id="186ret" title='ret' data-type='int' data-ref="186ret">ret</dfn>;</td></tr>
<tr><th id="1451">1451</th><td></td></tr>
<tr><th id="1452">1452</th><td>	<b>if</b> (<var>0</var> == <a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_read" title='atomic_read' data-ref="atomic_read">atomic_read</a>(&amp;<a class="local col2 ref" href="#182group" title='group' data-ref="182group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</a>) ||</td></tr>
<tr><th id="1453">1453</th><td>	    !<a class="local col2 ref" href="#182group" title='group' data-ref="182group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a> || !<a class="tu ref fn" href="#vfio_group_viable" title='vfio_group_viable' data-use='c' data-ref="vfio_group_viable">vfio_group_viable</a>(<a class="local col2 ref" href="#182group" title='group' data-ref="182group">group</a>))</td></tr>
<tr><th id="1454">1454</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1455">1455</th><td></td></tr>
<tr><th id="1456">1456</th><td>	<b>if</b> (<a class="local col2 ref" href="#182group" title='group' data-ref="182group">group</a>-&gt;<a class="ref field" href="#vfio_group::noiommu" title='vfio_group::noiommu' data-ref="vfio_group::noiommu">noiommu</a> &amp;&amp; !<a class="ref fn" href="../../include/linux/capability.h.html#capable" title='capable' data-ref="capable">capable</a>(<a class="macro" href="../../include/uapi/linux/capability.h.html#227" title="17" data-ref="_M/CAP_SYS_RAWIO">CAP_SYS_RAWIO</a>))</td></tr>
<tr><th id="1457">1457</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="1458">1458</th><td></td></tr>
<tr><th id="1459">1459</th><td>	<a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a> = <a class="tu ref fn" href="#vfio_device_get_from_name" title='vfio_device_get_from_name' data-use='c' data-ref="vfio_device_get_from_name">vfio_device_get_from_name</a>(<a class="local col2 ref" href="#182group" title='group' data-ref="182group">group</a>, <a class="local col3 ref" href="#183buf" title='buf' data-ref="183buf">buf</a>);</td></tr>
<tr><th id="1460">1460</th><td>	<b>if</b> (!<a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a>)</td></tr>
<tr><th id="1461">1461</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#23" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="1462">1462</th><td></td></tr>
<tr><th id="1463">1463</th><td>	<a class="local col6 ref" href="#186ret" title='ret' data-ref="186ret">ret</a> = <a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::open" title='vfio_device_ops::open' data-ref="vfio_device_ops::open">open</a>(<a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a>-&gt;<a class="ref field" href="#vfio_device::device_data" title='vfio_device::device_data' data-ref="vfio_device::device_data">device_data</a>);</td></tr>
<tr><th id="1464">1464</th><td>	<b>if</b> (<a class="local col6 ref" href="#186ret" title='ret' data-ref="186ret">ret</a>) {</td></tr>
<tr><th id="1465">1465</th><td>		<a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put">vfio_device_put</a>(<a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a>);</td></tr>
<tr><th id="1466">1466</th><td>		<b>return</b> <a class="local col6 ref" href="#186ret" title='ret' data-ref="186ret">ret</a>;</td></tr>
<tr><th id="1467">1467</th><td>	}</td></tr>
<tr><th id="1468">1468</th><td></td></tr>
<tr><th id="1469">1469</th><td>	<i>/*</i></td></tr>
<tr><th id="1470">1470</th><td><i>	 * We can't use anon_inode_getfd() because we need to modify</i></td></tr>
<tr><th id="1471">1471</th><td><i>	 * the f_mode flags directly to allow more than just ioctls</i></td></tr>
<tr><th id="1472">1472</th><td><i>	 */</i></td></tr>
<tr><th id="1473">1473</th><td>	<a class="local col6 ref" href="#186ret" title='ret' data-ref="186ret">ret</a> = <a class="ref fn" href="../../include/linux/file.h.html#get_unused_fd_flags" title='get_unused_fd_flags' data-ref="get_unused_fd_flags">get_unused_fd_flags</a>(<a class="macro" href="../../include/uapi/asm-generic/fcntl.h.html#63" title="02000000" data-ref="_M/O_CLOEXEC">O_CLOEXEC</a>);</td></tr>
<tr><th id="1474">1474</th><td>	<b>if</b> (<a class="local col6 ref" href="#186ret" title='ret' data-ref="186ret">ret</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="1475">1475</th><td>		<a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::release" title='vfio_device_ops::release' data-ref="vfio_device_ops::release">release</a>(<a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a>-&gt;<a class="ref field" href="#vfio_device::device_data" title='vfio_device::device_data' data-ref="vfio_device::device_data">device_data</a>);</td></tr>
<tr><th id="1476">1476</th><td>		<a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put">vfio_device_put</a>(<a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a>);</td></tr>
<tr><th id="1477">1477</th><td>		<b>return</b> <a class="local col6 ref" href="#186ret" title='ret' data-ref="186ret">ret</a>;</td></tr>
<tr><th id="1478">1478</th><td>	}</td></tr>
<tr><th id="1479">1479</th><td></td></tr>
<tr><th id="1480">1480</th><td>	<a class="local col5 ref" href="#185filep" title='filep' data-ref="185filep">filep</a> = <a class="ref fn" href="../../include/linux/anon_inodes.h.html#anon_inode_getfile" title='anon_inode_getfile' data-ref="anon_inode_getfile">anon_inode_getfile</a>(<q>"[vfio-device]"</q>, &amp;<a class="tu ref" href="#vfio_device_fops" title='vfio_device_fops' data-use='a' data-ref="vfio_device_fops">vfio_device_fops</a>,</td></tr>
<tr><th id="1481">1481</th><td>				   <a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a>, <a class="macro" href="../../include/uapi/asm-generic/fcntl.h.html#22" title="00000002" data-ref="_M/O_RDWR">O_RDWR</a>);</td></tr>
<tr><th id="1482">1482</th><td>	<b>if</b> (<a class="ref fn" href="../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="local col5 ref" href="#185filep" title='filep' data-ref="185filep">filep</a>)) {</td></tr>
<tr><th id="1483">1483</th><td>		<a class="ref fn" href="../../include/linux/file.h.html#put_unused_fd" title='put_unused_fd' data-ref="put_unused_fd">put_unused_fd</a>(<a class="local col6 ref" href="#186ret" title='ret' data-ref="186ret">ret</a>);</td></tr>
<tr><th id="1484">1484</th><td>		<a class="local col6 ref" href="#186ret" title='ret' data-ref="186ret">ret</a> = <a class="ref fn" href="../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR">PTR_ERR</a>(<a class="local col5 ref" href="#185filep" title='filep' data-ref="185filep">filep</a>);</td></tr>
<tr><th id="1485">1485</th><td>		<a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::release" title='vfio_device_ops::release' data-ref="vfio_device_ops::release">release</a>(<a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a>-&gt;<a class="ref field" href="#vfio_device::device_data" title='vfio_device::device_data' data-ref="vfio_device::device_data">device_data</a>);</td></tr>
<tr><th id="1486">1486</th><td>		<a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put">vfio_device_put</a>(<a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a>);</td></tr>
<tr><th id="1487">1487</th><td>		<b>return</b> <a class="local col6 ref" href="#186ret" title='ret' data-ref="186ret">ret</a>;</td></tr>
<tr><th id="1488">1488</th><td>	}</td></tr>
<tr><th id="1489">1489</th><td></td></tr>
<tr><th id="1490">1490</th><td>	<i>/*</i></td></tr>
<tr><th id="1491">1491</th><td><i>	 * TODO: add an anon_inode interface to do this.</i></td></tr>
<tr><th id="1492">1492</th><td><i>	 * Appears to be missing by lack of need rather than</i></td></tr>
<tr><th id="1493">1493</th><td><i>	 * explicitly prevented.  Now there's need.</i></td></tr>
<tr><th id="1494">1494</th><td><i>	 */</i></td></tr>
<tr><th id="1495">1495</th><td>	<a class="local col5 ref" href="#185filep" title='filep' data-ref="185filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::f_mode" title='file::f_mode' data-ref="file::f_mode">f_mode</a> |= (<a class="macro" href="../../include/linux/fs.h.html#106" title="(( fmode_t)0x4)" data-ref="_M/FMODE_LSEEK">FMODE_LSEEK</a> | <a class="macro" href="../../include/linux/fs.h.html#108" title="(( fmode_t)0x8)" data-ref="_M/FMODE_PREAD">FMODE_PREAD</a> | <a class="macro" href="../../include/linux/fs.h.html#110" title="(( fmode_t)0x10)" data-ref="_M/FMODE_PWRITE">FMODE_PWRITE</a>);</td></tr>
<tr><th id="1496">1496</th><td></td></tr>
<tr><th id="1497">1497</th><td>	<a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_inc" title='atomic_inc' data-ref="atomic_inc">atomic_inc</a>(&amp;<a class="local col2 ref" href="#182group" title='group' data-ref="182group">group</a>-&gt;<a class="ref field" href="#vfio_group::container_users" title='vfio_group::container_users' data-ref="vfio_group::container_users">container_users</a>);</td></tr>
<tr><th id="1498">1498</th><td></td></tr>
<tr><th id="1499">1499</th><td>	<a class="ref fn" href="../../include/linux/file.h.html#fd_install" title='fd_install' data-ref="fd_install">fd_install</a>(<a class="local col6 ref" href="#186ret" title='ret' data-ref="186ret">ret</a>, <a class="local col5 ref" href="#185filep" title='filep' data-ref="185filep">filep</a>);</td></tr>
<tr><th id="1500">1500</th><td></td></tr>
<tr><th id="1501">1501</th><td>	<b>if</b> (<a class="local col2 ref" href="#182group" title='group' data-ref="182group">group</a>-&gt;<a class="ref field" href="#vfio_group::noiommu" title='vfio_group::noiommu' data-ref="vfio_group::noiommu">noiommu</a>)</td></tr>
<tr><th id="1502">1502</th><td>		<a class="ref fn" href="../../include/linux/device.h.html#dev_warn" title='dev_warn' data-ref="dev_warn">dev_warn</a>(<a class="local col4 ref" href="#184device" title='device' data-ref="184device">device</a>-&gt;<a class="ref field" href="#vfio_device::dev" title='vfio_device::dev' data-ref="vfio_device::dev">dev</a>, <q>"vfio-noiommu device opened by user "</q></td></tr>
<tr><th id="1503">1503</th><td>			 <q>"(%s:%d)\n"</q>, <a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../../include/linux/sched.h.html#task_struct::comm" title='task_struct::comm' data-ref="task_struct::comm">comm</a>, <a class="ref fn" href="../../include/linux/sched.h.html#task_pid_nr" title='task_pid_nr' data-ref="task_pid_nr">task_pid_nr</a>(<a class="macro" href="../../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>));</td></tr>
<tr><th id="1504">1504</th><td></td></tr>
<tr><th id="1505">1505</th><td>	<b>return</b> <a class="local col6 ref" href="#186ret" title='ret' data-ref="186ret">ret</a>;</td></tr>
<tr><th id="1506">1506</th><td>}</td></tr>
<tr><th id="1507">1507</th><td></td></tr>
<tr><th id="1508">1508</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="vfio_group_fops_unl_ioctl" title='vfio_group_fops_unl_ioctl' data-type='long vfio_group_fops_unl_ioctl(struct file * filep, unsigned int cmd, unsigned long arg)' data-ref="vfio_group_fops_unl_ioctl">vfio_group_fops_unl_ioctl</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col7 decl" id="187filep" title='filep' data-type='struct file *' data-ref="187filep">filep</dfn>,</td></tr>
<tr><th id="1509">1509</th><td>				      <em>unsigned</em> <em>int</em> <dfn class="local col8 decl" id="188cmd" title='cmd' data-type='unsigned int' data-ref="188cmd">cmd</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="189arg" title='arg' data-type='unsigned long' data-ref="189arg">arg</dfn>)</td></tr>
<tr><th id="1510">1510</th><td>{</td></tr>
<tr><th id="1511">1511</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col0 decl" id="190group" title='group' data-type='struct vfio_group *' data-ref="190group">group</dfn> = <a class="local col7 ref" href="#187filep" title='filep' data-ref="187filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1512">1512</th><td>	<em>long</em> <dfn class="local col1 decl" id="191ret" title='ret' data-type='long' data-ref="191ret">ret</dfn> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#29" title="25" data-ref="_M/ENOTTY">ENOTTY</a>;</td></tr>
<tr><th id="1513">1513</th><td></td></tr>
<tr><th id="1514">1514</th><td>	<b>switch</b> (<a class="local col8 ref" href="#188cmd" title='cmd' data-ref="188cmd">cmd</a>) {</td></tr>
<tr><th id="1515">1515</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/vfio.h.html#142" title="(((0U) &lt;&lt; (((0+8)+8)+14)) | ((((&apos;;&apos;))) &lt;&lt; (0+8)) | (((100 + 3)) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VFIO_GROUP_GET_STATUS">VFIO_GROUP_GET_STATUS</a>:</td></tr>
<tr><th id="1516">1516</th><td>	{</td></tr>
<tr><th id="1517">1517</th><td>		<b>struct</b> <a class="type" href="../../include/uapi/linux/vfio.h.html#vfio_group_status" title='vfio_group_status' data-ref="vfio_group_status">vfio_group_status</a> <dfn class="local col2 decl" id="192status" title='status' data-type='struct vfio_group_status' data-ref="192status">status</dfn>;</td></tr>
<tr><th id="1518">1518</th><td>		<em>unsigned</em> <em>long</em> <dfn class="local col3 decl" id="193minsz" title='minsz' data-type='unsigned long' data-ref="193minsz">minsz</dfn>;</td></tr>
<tr><th id="1519">1519</th><td></td></tr>
<tr><th id="1520">1520</th><td>		<a class="local col3 ref" href="#193minsz" title='minsz' data-ref="193minsz">minsz</a> = <a class="macro" href="../../include/linux/stddef.h.html#36" title="(__builtin_offsetof(struct vfio_group_status, flags) + sizeof((((struct vfio_group_status *)0)-&gt;flags)))" data-ref="_M/offsetofend">offsetofend</a>(<b>struct</b> <a class="type" href="../../include/uapi/linux/vfio.h.html#vfio_group_status" title='vfio_group_status' data-ref="vfio_group_status">vfio_group_status</a>, <a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_group_status::flags" title='vfio_group_status::flags' data-ref="vfio_group_status::flags">flags</a>);</td></tr>
<tr><th id="1521">1521</th><td></td></tr>
<tr><th id="1522">1522</th><td>		<b>if</b> (<a class="ref fn" href="../../include/linux/uaccess.h.html#copy_from_user" title='copy_from_user' data-ref="copy_from_user">copy_from_user</a>(&amp;<a class="local col2 ref" href="#192status" title='status' data-ref="192status">status</a>, (<em>void</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *)<a class="local col9 ref" href="#189arg" title='arg' data-ref="189arg">arg</a>, <a class="local col3 ref" href="#193minsz" title='minsz' data-ref="193minsz">minsz</a>))</td></tr>
<tr><th id="1523">1523</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="1524">1524</th><td></td></tr>
<tr><th id="1525">1525</th><td>		<b>if</b> (<a class="local col2 ref" href="#192status" title='status' data-ref="192status">status</a>.<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_group_status::argsz" title='vfio_group_status::argsz' data-ref="vfio_group_status::argsz">argsz</a> &lt; <a class="local col3 ref" href="#193minsz" title='minsz' data-ref="193minsz">minsz</a>)</td></tr>
<tr><th id="1526">1526</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1527">1527</th><td></td></tr>
<tr><th id="1528">1528</th><td>		<a class="local col2 ref" href="#192status" title='status' data-ref="192status">status</a>.<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_group_status::flags" title='vfio_group_status::flags' data-ref="vfio_group_status::flags">flags</a> = <var>0</var>;</td></tr>
<tr><th id="1529">1529</th><td></td></tr>
<tr><th id="1530">1530</th><td>		<b>if</b> (<a class="tu ref fn" href="#vfio_group_viable" title='vfio_group_viable' data-use='c' data-ref="vfio_group_viable">vfio_group_viable</a>(<a class="local col0 ref" href="#190group" title='group' data-ref="190group">group</a>))</td></tr>
<tr><th id="1531">1531</th><td>			<a class="local col2 ref" href="#192status" title='status' data-ref="192status">status</a>.<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_group_status::flags" title='vfio_group_status::flags' data-ref="vfio_group_status::flags">flags</a> |= <a class="macro" href="../../include/uapi/linux/vfio.h.html#139" title="(1 &lt;&lt; 0)" data-ref="_M/VFIO_GROUP_FLAGS_VIABLE">VFIO_GROUP_FLAGS_VIABLE</a>;</td></tr>
<tr><th id="1532">1532</th><td></td></tr>
<tr><th id="1533">1533</th><td>		<b>if</b> (<a class="local col0 ref" href="#190group" title='group' data-ref="190group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a>)</td></tr>
<tr><th id="1534">1534</th><td>			<a class="local col2 ref" href="#192status" title='status' data-ref="192status">status</a>.<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_group_status::flags" title='vfio_group_status::flags' data-ref="vfio_group_status::flags">flags</a> |= <a class="macro" href="../../include/uapi/linux/vfio.h.html#140" title="(1 &lt;&lt; 1)" data-ref="_M/VFIO_GROUP_FLAGS_CONTAINER_SET">VFIO_GROUP_FLAGS_CONTAINER_SET</a>;</td></tr>
<tr><th id="1535">1535</th><td></td></tr>
<tr><th id="1536">1536</th><td>		<b>if</b> (<a class="ref fn" href="../../include/linux/uaccess.h.html#copy_to_user" title='copy_to_user' data-ref="copy_to_user">copy_to_user</a>((<em>void</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *)<a class="local col9 ref" href="#189arg" title='arg' data-ref="189arg">arg</a>, &amp;<a class="local col2 ref" href="#192status" title='status' data-ref="192status">status</a>, <a class="local col3 ref" href="#193minsz" title='minsz' data-ref="193minsz">minsz</a>))</td></tr>
<tr><th id="1537">1537</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="1538">1538</th><td></td></tr>
<tr><th id="1539">1539</th><td>		<a class="local col1 ref" href="#191ret" title='ret' data-ref="191ret">ret</a> = <var>0</var>;</td></tr>
<tr><th id="1540">1540</th><td>		<b>break</b>;</td></tr>
<tr><th id="1541">1541</th><td>	}</td></tr>
<tr><th id="1542">1542</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/vfio.h.html#156" title="(((0U) &lt;&lt; (((0+8)+8)+14)) | ((((&apos;;&apos;))) &lt;&lt; (0+8)) | (((100 + 4)) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VFIO_GROUP_SET_CONTAINER">VFIO_GROUP_SET_CONTAINER</a>:</td></tr>
<tr><th id="1543">1543</th><td>	{</td></tr>
<tr><th id="1544">1544</th><td>		<em>int</em> <dfn class="local col4 decl" id="194fd" title='fd' data-type='int' data-ref="194fd">fd</dfn>;</td></tr>
<tr><th id="1545">1545</th><td></td></tr>
<tr><th id="1546">1546</th><td>		<b>if</b> (<a class="macro" href="../../arch/x86/include/asm/uaccess.h.html#171" title="({ int __ret_gu; register __typeof__(__builtin_choose_expr(sizeof(*((int *)arg)) &gt; sizeof(0UL), 0ULL, 0UL)) __val_gu asm(&quot;%&quot;&quot;rdx&quot;); (void)0; might_fault(); asm volatile(&quot;call __get_user_%P4&quot; : &quot;=a&quot; (__ret_gu), &quot;=r&quot; (__val_gu), &quot;+r&quot; (current_stack_pointer) : &quot;0&quot; ((int *)arg), &quot;i&quot; (sizeof(*((int *)arg)))); (fd) = ( __typeof__(*((int *)arg))) __val_gu; __builtin_expect(__ret_gu, 0); })" data-ref="_M/get_user">get_user</a>(<a class="local col4 ref" href="#194fd" title='fd' data-ref="194fd">fd</a>, (<em>int</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *)<a class="local col9 ref" href="#189arg" title='arg' data-ref="189arg">arg</a>))</td></tr>
<tr><th id="1547">1547</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="1548">1548</th><td></td></tr>
<tr><th id="1549">1549</th><td>		<b>if</b> (<a class="local col4 ref" href="#194fd" title='fd' data-ref="194fd">fd</a> &lt; <var>0</var>)</td></tr>
<tr><th id="1550">1550</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1551">1551</th><td></td></tr>
<tr><th id="1552">1552</th><td>		<a class="local col1 ref" href="#191ret" title='ret' data-ref="191ret">ret</a> = <a class="tu ref fn" href="#vfio_group_set_container" title='vfio_group_set_container' data-use='c' data-ref="vfio_group_set_container">vfio_group_set_container</a>(<a class="local col0 ref" href="#190group" title='group' data-ref="190group">group</a>, <a class="local col4 ref" href="#194fd" title='fd' data-ref="194fd">fd</a>);</td></tr>
<tr><th id="1553">1553</th><td>		<b>break</b>;</td></tr>
<tr><th id="1554">1554</th><td>	}</td></tr>
<tr><th id="1555">1555</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/vfio.h.html#171" title="(((0U) &lt;&lt; (((0+8)+8)+14)) | ((((&apos;;&apos;))) &lt;&lt; (0+8)) | (((100 + 5)) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VFIO_GROUP_UNSET_CONTAINER">VFIO_GROUP_UNSET_CONTAINER</a>:</td></tr>
<tr><th id="1556">1556</th><td>		<a class="local col1 ref" href="#191ret" title='ret' data-ref="191ret">ret</a> = <a class="tu ref fn" href="#vfio_group_unset_container" title='vfio_group_unset_container' data-use='c' data-ref="vfio_group_unset_container">vfio_group_unset_container</a>(<a class="local col0 ref" href="#190group" title='group' data-ref="190group">group</a>);</td></tr>
<tr><th id="1557">1557</th><td>		<b>break</b>;</td></tr>
<tr><th id="1558">1558</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/vfio.h.html#183" title="(((0U) &lt;&lt; (((0+8)+8)+14)) | ((((&apos;;&apos;))) &lt;&lt; (0+8)) | (((100 + 6)) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VFIO_GROUP_GET_DEVICE_FD">VFIO_GROUP_GET_DEVICE_FD</a>:</td></tr>
<tr><th id="1559">1559</th><td>	{</td></tr>
<tr><th id="1560">1560</th><td>		<em>char</em> *<dfn class="local col5 decl" id="195buf" title='buf' data-type='char *' data-ref="195buf">buf</dfn>;</td></tr>
<tr><th id="1561">1561</th><td></td></tr>
<tr><th id="1562">1562</th><td>		<a class="local col5 ref" href="#195buf" title='buf' data-ref="195buf">buf</a> = <a class="ref fn" href="../../include/linux/string.h.html#strndup_user" title='strndup_user' data-ref="strndup_user">strndup_user</a>((<em>const</em> <em>char</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *)<a class="local col9 ref" href="#189arg" title='arg' data-ref="189arg">arg</a>, <a class="macro" href="../../arch/x86/include/asm/page_types.h.html#11" title="((1UL) &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>);</td></tr>
<tr><th id="1563">1563</th><td>		<b>if</b> (<a class="ref fn" href="../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="local col5 ref" href="#195buf" title='buf' data-ref="195buf">buf</a>))</td></tr>
<tr><th id="1564">1564</th><td>			<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR">PTR_ERR</a>(<a class="local col5 ref" href="#195buf" title='buf' data-ref="195buf">buf</a>);</td></tr>
<tr><th id="1565">1565</th><td></td></tr>
<tr><th id="1566">1566</th><td>		<a class="local col1 ref" href="#191ret" title='ret' data-ref="191ret">ret</a> = <a class="tu ref fn" href="#vfio_group_get_device_fd" title='vfio_group_get_device_fd' data-use='c' data-ref="vfio_group_get_device_fd">vfio_group_get_device_fd</a>(<a class="local col0 ref" href="#190group" title='group' data-ref="190group">group</a>, <a class="local col5 ref" href="#195buf" title='buf' data-ref="195buf">buf</a>);</td></tr>
<tr><th id="1567">1567</th><td>		<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col5 ref" href="#195buf" title='buf' data-ref="195buf">buf</a>);</td></tr>
<tr><th id="1568">1568</th><td>		<b>break</b>;</td></tr>
<tr><th id="1569">1569</th><td>	}</td></tr>
<tr><th id="1570">1570</th><td>	}</td></tr>
<tr><th id="1571">1571</th><td></td></tr>
<tr><th id="1572">1572</th><td>	<b>return</b> <a class="local col1 ref" href="#191ret" title='ret' data-ref="191ret">ret</a>;</td></tr>
<tr><th id="1573">1573</th><td>}</td></tr>
<tr><th id="1574">1574</th><td></td></tr>
<tr><th id="1575">1575</th><td><u>#<span data-ppcond="1575">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#96" data-ref="_M/CONFIG_COMPAT">CONFIG_COMPAT</a></u></td></tr>
<tr><th id="1576">1576</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="vfio_group_fops_compat_ioctl" title='vfio_group_fops_compat_ioctl' data-type='long vfio_group_fops_compat_ioctl(struct file * filep, unsigned int cmd, unsigned long arg)' data-ref="vfio_group_fops_compat_ioctl">vfio_group_fops_compat_ioctl</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col6 decl" id="196filep" title='filep' data-type='struct file *' data-ref="196filep">filep</dfn>,</td></tr>
<tr><th id="1577">1577</th><td>					 <em>unsigned</em> <em>int</em> <dfn class="local col7 decl" id="197cmd" title='cmd' data-type='unsigned int' data-ref="197cmd">cmd</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="198arg" title='arg' data-type='unsigned long' data-ref="198arg">arg</dfn>)</td></tr>
<tr><th id="1578">1578</th><td>{</td></tr>
<tr><th id="1579">1579</th><td>	<a class="local col8 ref" href="#198arg" title='arg' data-ref="198arg">arg</a> = (<em>unsigned</em> <em>long</em>)<a class="ref fn" href="../../arch/x86/include/asm/compat.h.html#compat_ptr" title='compat_ptr' data-ref="compat_ptr">compat_ptr</a>(<a class="local col8 ref" href="#198arg" title='arg' data-ref="198arg">arg</a>);</td></tr>
<tr><th id="1580">1580</th><td>	<b>return</b> <a class="tu ref fn" href="#vfio_group_fops_unl_ioctl" title='vfio_group_fops_unl_ioctl' data-use='c' data-ref="vfio_group_fops_unl_ioctl">vfio_group_fops_unl_ioctl</a>(<a class="local col6 ref" href="#196filep" title='filep' data-ref="196filep">filep</a>, <a class="local col7 ref" href="#197cmd" title='cmd' data-ref="197cmd">cmd</a>, <a class="local col8 ref" href="#198arg" title='arg' data-ref="198arg">arg</a>);</td></tr>
<tr><th id="1581">1581</th><td>}</td></tr>
<tr><th id="1582">1582</th><td><u>#<span data-ppcond="1575">endif</span>	/* CONFIG_COMPAT */</u></td></tr>
<tr><th id="1583">1583</th><td></td></tr>
<tr><th id="1584">1584</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_group_fops_open" title='vfio_group_fops_open' data-type='int vfio_group_fops_open(struct inode * inode, struct file * filep)' data-ref="vfio_group_fops_open">vfio_group_fops_open</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col9 decl" id="199inode" title='inode' data-type='struct inode *' data-ref="199inode">inode</dfn>, <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col0 decl" id="200filep" title='filep' data-type='struct file *' data-ref="200filep">filep</dfn>)</td></tr>
<tr><th id="1585">1585</th><td>{</td></tr>
<tr><th id="1586">1586</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col1 decl" id="201group" title='group' data-type='struct vfio_group *' data-ref="201group">group</dfn>;</td></tr>
<tr><th id="1587">1587</th><td>	<em>int</em> <dfn class="local col2 decl" id="202opened" title='opened' data-type='int' data-ref="202opened">opened</dfn>;</td></tr>
<tr><th id="1588">1588</th><td></td></tr>
<tr><th id="1589">1589</th><td>	<a class="local col1 ref" href="#201group" title='group' data-ref="201group">group</a> = <a class="tu ref fn" href="#vfio_group_get_from_minor" title='vfio_group_get_from_minor' data-use='c' data-ref="vfio_group_get_from_minor">vfio_group_get_from_minor</a>(<a class="ref fn" href="../../include/linux/fs.h.html#iminor" title='iminor' data-ref="iminor">iminor</a>(<a class="local col9 ref" href="#199inode" title='inode' data-ref="199inode">inode</a>));</td></tr>
<tr><th id="1590">1590</th><td>	<b>if</b> (!<a class="local col1 ref" href="#201group" title='group' data-ref="201group">group</a>)</td></tr>
<tr><th id="1591">1591</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#23" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="1592">1592</th><td></td></tr>
<tr><th id="1593">1593</th><td>	<b>if</b> (<a class="local col1 ref" href="#201group" title='group' data-ref="201group">group</a>-&gt;<a class="ref field" href="#vfio_group::noiommu" title='vfio_group::noiommu' data-ref="vfio_group::noiommu">noiommu</a> &amp;&amp; !<a class="ref fn" href="../../include/linux/capability.h.html#capable" title='capable' data-ref="capable">capable</a>(<a class="macro" href="../../include/uapi/linux/capability.h.html#227" title="17" data-ref="_M/CAP_SYS_RAWIO">CAP_SYS_RAWIO</a>)) {</td></tr>
<tr><th id="1594">1594</th><td>		<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col1 ref" href="#201group" title='group' data-ref="201group">group</a>);</td></tr>
<tr><th id="1595">1595</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="1596">1596</th><td>	}</td></tr>
<tr><th id="1597">1597</th><td></td></tr>
<tr><th id="1598">1598</th><td>	<i>/* Do we need multiple instances of the group open?  Seems not. */</i></td></tr>
<tr><th id="1599">1599</th><td>	<a class="local col2 ref" href="#202opened" title='opened' data-ref="202opened">opened</a> = <a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_cmpxchg" title='atomic_cmpxchg' data-ref="atomic_cmpxchg">atomic_cmpxchg</a>(&amp;<a class="local col1 ref" href="#201group" title='group' data-ref="201group">group</a>-&gt;<a class="ref field" href="#vfio_group::opened" title='vfio_group::opened' data-ref="vfio_group::opened">opened</a>, <var>0</var>, <var>1</var>);</td></tr>
<tr><th id="1600">1600</th><td>	<b>if</b> (<a class="local col2 ref" href="#202opened" title='opened' data-ref="202opened">opened</a>) {</td></tr>
<tr><th id="1601">1601</th><td>		<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col1 ref" href="#201group" title='group' data-ref="201group">group</a>);</td></tr>
<tr><th id="1602">1602</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#20" title="16" data-ref="_M/EBUSY">EBUSY</a>;</td></tr>
<tr><th id="1603">1603</th><td>	}</td></tr>
<tr><th id="1604">1604</th><td></td></tr>
<tr><th id="1605">1605</th><td>	<i>/* Is something still in use from a previous open? */</i></td></tr>
<tr><th id="1606">1606</th><td>	<b>if</b> (<a class="local col1 ref" href="#201group" title='group' data-ref="201group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a>) {</td></tr>
<tr><th id="1607">1607</th><td>		<a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_dec" title='atomic_dec' data-ref="atomic_dec">atomic_dec</a>(&amp;<a class="local col1 ref" href="#201group" title='group' data-ref="201group">group</a>-&gt;<a class="ref field" href="#vfio_group::opened" title='vfio_group::opened' data-ref="vfio_group::opened">opened</a>);</td></tr>
<tr><th id="1608">1608</th><td>		<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col1 ref" href="#201group" title='group' data-ref="201group">group</a>);</td></tr>
<tr><th id="1609">1609</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#20" title="16" data-ref="_M/EBUSY">EBUSY</a>;</td></tr>
<tr><th id="1610">1610</th><td>	}</td></tr>
<tr><th id="1611">1611</th><td></td></tr>
<tr><th id="1612">1612</th><td>	<i>/* Warn if previous user didn't cleanup and re-init to drop them */</i></td></tr>
<tr><th id="1613">1613</th><td>	<b>if</b> (<a class="macro" href="../../include/asm-generic/bug.h.html#111" title="({ int __ret_warn_on = !!(group-&gt;notifier.head); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/drivers/vfio/vfio.c&quot;), &quot;i&quot; (1613), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (84)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="local col1 ref" href="#201group" title='group' data-ref="201group">group</a>-&gt;<a class="ref field" href="#vfio_group::notifier" title='vfio_group::notifier' data-ref="vfio_group::notifier">notifier</a>.<a class="ref field" href="../../include/linux/notifier.h.html#blocking_notifier_head::head" title='blocking_notifier_head::head' data-ref="blocking_notifier_head::head">head</a>))</td></tr>
<tr><th id="1614">1614</th><td>		<a class="macro" href="../../include/linux/notifier.h.html#84" title="do { do { static struct lock_class_key __key; __init_rwsem((&amp;(&amp;group-&gt;notifier)-&gt;rwsem), &quot;&amp;(&amp;group-&gt;notifier)-&gt;rwsem&quot;, &amp;__key); } while (0); (&amp;group-&gt;notifier)-&gt;head = ((void *)0); } while (0)" data-ref="_M/BLOCKING_INIT_NOTIFIER_HEAD">BLOCKING_INIT_NOTIFIER_HEAD</a>(&amp;<a class="local col1 ref" href="#201group" title='group' data-ref="201group">group</a>-&gt;<a class="ref field" href="#vfio_group::notifier" title='vfio_group::notifier' data-ref="vfio_group::notifier">notifier</a>);</td></tr>
<tr><th id="1615">1615</th><td></td></tr>
<tr><th id="1616">1616</th><td>	<a class="local col0 ref" href="#200filep" title='filep' data-ref="200filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a> = <a class="local col1 ref" href="#201group" title='group' data-ref="201group">group</a>;</td></tr>
<tr><th id="1617">1617</th><td></td></tr>
<tr><th id="1618">1618</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1619">1619</th><td>}</td></tr>
<tr><th id="1620">1620</th><td></td></tr>
<tr><th id="1621">1621</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_group_fops_release" title='vfio_group_fops_release' data-type='int vfio_group_fops_release(struct inode * inode, struct file * filep)' data-ref="vfio_group_fops_release">vfio_group_fops_release</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col3 decl" id="203inode" title='inode' data-type='struct inode *' data-ref="203inode">inode</dfn>, <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col4 decl" id="204filep" title='filep' data-type='struct file *' data-ref="204filep">filep</dfn>)</td></tr>
<tr><th id="1622">1622</th><td>{</td></tr>
<tr><th id="1623">1623</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col5 decl" id="205group" title='group' data-type='struct vfio_group *' data-ref="205group">group</dfn> = <a class="local col4 ref" href="#204filep" title='filep' data-ref="204filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1624">1624</th><td></td></tr>
<tr><th id="1625">1625</th><td>	<a class="local col4 ref" href="#204filep" title='filep' data-ref="204filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a> = <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1626">1626</th><td></td></tr>
<tr><th id="1627">1627</th><td>	<a class="tu ref fn" href="#vfio_group_try_dissolve_container" title='vfio_group_try_dissolve_container' data-use='c' data-ref="vfio_group_try_dissolve_container">vfio_group_try_dissolve_container</a>(<a class="local col5 ref" href="#205group" title='group' data-ref="205group">group</a>);</td></tr>
<tr><th id="1628">1628</th><td></td></tr>
<tr><th id="1629">1629</th><td>	<a class="ref fn" href="../../include/asm-generic/atomic-instrumented.h.html#atomic_dec" title='atomic_dec' data-ref="atomic_dec">atomic_dec</a>(&amp;<a class="local col5 ref" href="#205group" title='group' data-ref="205group">group</a>-&gt;<a class="ref field" href="#vfio_group::opened" title='vfio_group::opened' data-ref="vfio_group::opened">opened</a>);</td></tr>
<tr><th id="1630">1630</th><td></td></tr>
<tr><th id="1631">1631</th><td>	<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col5 ref" href="#205group" title='group' data-ref="205group">group</a>);</td></tr>
<tr><th id="1632">1632</th><td></td></tr>
<tr><th id="1633">1633</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1634">1634</th><td>}</td></tr>
<tr><th id="1635">1635</th><td></td></tr>
<tr><th id="1636">1636</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file_operations" title='file_operations' data-ref="file_operations">file_operations</a> <dfn class="tu decl def" id="vfio_group_fops" title='vfio_group_fops' data-type='const struct file_operations' data-ref="vfio_group_fops">vfio_group_fops</dfn> = {</td></tr>
<tr><th id="1637">1637</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::owner" title='file_operations::owner' data-ref="file_operations::owner">owner</a>		= <a class="macro" href="../../include/linux/export.h.html#31" title="((struct module *)0)" data-ref="_M/THIS_MODULE">THIS_MODULE</a>,</td></tr>
<tr><th id="1638">1638</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::unlocked_ioctl" title='file_operations::unlocked_ioctl' data-ref="file_operations::unlocked_ioctl">unlocked_ioctl</a>	= <a class="tu ref fn" href="#vfio_group_fops_unl_ioctl" title='vfio_group_fops_unl_ioctl' data-ref="vfio_group_fops_unl_ioctl">vfio_group_fops_unl_ioctl</a>,</td></tr>
<tr><th id="1639">1639</th><td><u>#<span data-ppcond="1639">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#96" data-ref="_M/CONFIG_COMPAT">CONFIG_COMPAT</a></u></td></tr>
<tr><th id="1640">1640</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::compat_ioctl" title='file_operations::compat_ioctl' data-ref="file_operations::compat_ioctl">compat_ioctl</a>	= <a class="tu ref fn" href="#vfio_group_fops_compat_ioctl" title='vfio_group_fops_compat_ioctl' data-ref="vfio_group_fops_compat_ioctl">vfio_group_fops_compat_ioctl</a>,</td></tr>
<tr><th id="1641">1641</th><td><u>#<span data-ppcond="1639">endif</span></u></td></tr>
<tr><th id="1642">1642</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::open" title='file_operations::open' data-ref="file_operations::open">open</a>		= <a class="tu ref fn" href="#vfio_group_fops_open" title='vfio_group_fops_open' data-ref="vfio_group_fops_open">vfio_group_fops_open</a>,</td></tr>
<tr><th id="1643">1643</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::release" title='file_operations::release' data-ref="file_operations::release">release</a>	= <a class="tu ref fn" href="#vfio_group_fops_release" title='vfio_group_fops_release' data-ref="vfio_group_fops_release">vfio_group_fops_release</a>,</td></tr>
<tr><th id="1644">1644</th><td>};</td></tr>
<tr><th id="1645">1645</th><td></td></tr>
<tr><th id="1646">1646</th><td><i class="doc" data-doc="vfio_device_fops_release">/**</i></td></tr>
<tr><th id="1647">1647</th><td><i class="doc" data-doc="vfio_device_fops_release"> * VFIO Device fd</i></td></tr>
<tr><th id="1648">1648</th><td><i class="doc" data-doc="vfio_device_fops_release"> */</i></td></tr>
<tr><th id="1649">1649</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_device_fops_release" title='vfio_device_fops_release' data-type='int vfio_device_fops_release(struct inode * inode, struct file * filep)' data-ref="vfio_device_fops_release">vfio_device_fops_release</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col6 decl" id="206inode" title='inode' data-type='struct inode *' data-ref="206inode">inode</dfn>, <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col7 decl" id="207filep" title='filep' data-type='struct file *' data-ref="207filep">filep</dfn>)</td></tr>
<tr><th id="1650">1650</th><td>{</td></tr>
<tr><th id="1651">1651</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col8 decl" id="208device" title='device' data-type='struct vfio_device *' data-ref="208device">device</dfn> = <a class="local col7 ref" href="#207filep" title='filep' data-ref="207filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1652">1652</th><td></td></tr>
<tr><th id="1653">1653</th><td>	<a class="local col8 ref" href="#208device" title='device' data-ref="208device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::release" title='vfio_device_ops::release' data-ref="vfio_device_ops::release">release</a>(<a class="local col8 ref" href="#208device" title='device' data-ref="208device">device</a>-&gt;<a class="ref field" href="#vfio_device::device_data" title='vfio_device::device_data' data-ref="vfio_device::device_data">device_data</a>);</td></tr>
<tr><th id="1654">1654</th><td></td></tr>
<tr><th id="1655">1655</th><td>	<a class="tu ref fn" href="#vfio_group_try_dissolve_container" title='vfio_group_try_dissolve_container' data-use='c' data-ref="vfio_group_try_dissolve_container">vfio_group_try_dissolve_container</a>(<a class="local col8 ref" href="#208device" title='device' data-ref="208device">device</a>-&gt;<a class="ref field" href="#vfio_device::group" title='vfio_device::group' data-ref="vfio_device::group">group</a>);</td></tr>
<tr><th id="1656">1656</th><td></td></tr>
<tr><th id="1657">1657</th><td>	<a class="ref fn" href="#vfio_device_put" title='vfio_device_put' data-ref="vfio_device_put">vfio_device_put</a>(<a class="local col8 ref" href="#208device" title='device' data-ref="208device">device</a>);</td></tr>
<tr><th id="1658">1658</th><td></td></tr>
<tr><th id="1659">1659</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1660">1660</th><td>}</td></tr>
<tr><th id="1661">1661</th><td></td></tr>
<tr><th id="1662">1662</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="vfio_device_fops_unl_ioctl" title='vfio_device_fops_unl_ioctl' data-type='long vfio_device_fops_unl_ioctl(struct file * filep, unsigned int cmd, unsigned long arg)' data-ref="vfio_device_fops_unl_ioctl">vfio_device_fops_unl_ioctl</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col9 decl" id="209filep" title='filep' data-type='struct file *' data-ref="209filep">filep</dfn>,</td></tr>
<tr><th id="1663">1663</th><td>				       <em>unsigned</em> <em>int</em> <dfn class="local col0 decl" id="210cmd" title='cmd' data-type='unsigned int' data-ref="210cmd">cmd</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col1 decl" id="211arg" title='arg' data-type='unsigned long' data-ref="211arg">arg</dfn>)</td></tr>
<tr><th id="1664">1664</th><td>{</td></tr>
<tr><th id="1665">1665</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col2 decl" id="212device" title='device' data-type='struct vfio_device *' data-ref="212device">device</dfn> = <a class="local col9 ref" href="#209filep" title='filep' data-ref="209filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1666">1666</th><td></td></tr>
<tr><th id="1667">1667</th><td>	<b>if</b> (<a class="macro" href="../../include/linux/compiler.h.html#77" title="__builtin_expect(!!(!device-&gt;ops-&gt;ioctl), 0)" data-ref="_M/unlikely">unlikely</a>(!<a class="local col2 ref" href="#212device" title='device' data-ref="212device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::ioctl" title='vfio_device_ops::ioctl' data-ref="vfio_device_ops::ioctl">ioctl</a>))</td></tr>
<tr><th id="1668">1668</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1669">1669</th><td></td></tr>
<tr><th id="1670">1670</th><td>	<b>return</b> <a class="local col2 ref" href="#212device" title='device' data-ref="212device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::ioctl" title='vfio_device_ops::ioctl' data-ref="vfio_device_ops::ioctl">ioctl</a>(<a class="local col2 ref" href="#212device" title='device' data-ref="212device">device</a>-&gt;<a class="ref field" href="#vfio_device::device_data" title='vfio_device::device_data' data-ref="vfio_device::device_data">device_data</a>, <a class="local col0 ref" href="#210cmd" title='cmd' data-ref="210cmd">cmd</a>, <a class="local col1 ref" href="#211arg" title='arg' data-ref="211arg">arg</a>);</td></tr>
<tr><th id="1671">1671</th><td>}</td></tr>
<tr><th id="1672">1672</th><td></td></tr>
<tr><th id="1673">1673</th><td><em>static</em> <a class="typedef" href="../../include/linux/types.h.html#ssize_t" title='ssize_t' data-type='__kernel_ssize_t' data-ref="ssize_t">ssize_t</a> <dfn class="tu decl def fn" id="vfio_device_fops_read" title='vfio_device_fops_read' data-type='ssize_t vfio_device_fops_read(struct file * filep, char * buf, size_t count, loff_t * ppos)' data-ref="vfio_device_fops_read">vfio_device_fops_read</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col3 decl" id="213filep" title='filep' data-type='struct file *' data-ref="213filep">filep</dfn>, <em>char</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *<dfn class="local col4 decl" id="214buf" title='buf' data-type='char *' data-ref="214buf">buf</dfn>,</td></tr>
<tr><th id="1674">1674</th><td>				     <a class="typedef" href="../../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> <dfn class="local col5 decl" id="215count" title='count' data-type='size_t' data-ref="215count">count</dfn>, <a class="typedef" href="../../include/linux/types.h.html#loff_t" title='loff_t' data-type='__kernel_loff_t' data-ref="loff_t">loff_t</a> *<dfn class="local col6 decl" id="216ppos" title='ppos' data-type='loff_t *' data-ref="216ppos">ppos</dfn>)</td></tr>
<tr><th id="1675">1675</th><td>{</td></tr>
<tr><th id="1676">1676</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col7 decl" id="217device" title='device' data-type='struct vfio_device *' data-ref="217device">device</dfn> = <a class="local col3 ref" href="#213filep" title='filep' data-ref="213filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1677">1677</th><td></td></tr>
<tr><th id="1678">1678</th><td>	<b>if</b> (<a class="macro" href="../../include/linux/compiler.h.html#77" title="__builtin_expect(!!(!device-&gt;ops-&gt;read), 0)" data-ref="_M/unlikely">unlikely</a>(!<a class="local col7 ref" href="#217device" title='device' data-ref="217device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::read" title='vfio_device_ops::read' data-ref="vfio_device_ops::read">read</a>))</td></tr>
<tr><th id="1679">1679</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1680">1680</th><td></td></tr>
<tr><th id="1681">1681</th><td>	<b>return</b> <a class="local col7 ref" href="#217device" title='device' data-ref="217device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::read" title='vfio_device_ops::read' data-ref="vfio_device_ops::read">read</a>(<a class="local col7 ref" href="#217device" title='device' data-ref="217device">device</a>-&gt;<a class="ref field" href="#vfio_device::device_data" title='vfio_device::device_data' data-ref="vfio_device::device_data">device_data</a>, <a class="local col4 ref" href="#214buf" title='buf' data-ref="214buf">buf</a>, <a class="local col5 ref" href="#215count" title='count' data-ref="215count">count</a>, <a class="local col6 ref" href="#216ppos" title='ppos' data-ref="216ppos">ppos</a>);</td></tr>
<tr><th id="1682">1682</th><td>}</td></tr>
<tr><th id="1683">1683</th><td></td></tr>
<tr><th id="1684">1684</th><td><em>static</em> <a class="typedef" href="../../include/linux/types.h.html#ssize_t" title='ssize_t' data-type='__kernel_ssize_t' data-ref="ssize_t">ssize_t</a> <dfn class="tu decl def fn" id="vfio_device_fops_write" title='vfio_device_fops_write' data-type='ssize_t vfio_device_fops_write(struct file * filep, const char * buf, size_t count, loff_t * ppos)' data-ref="vfio_device_fops_write">vfio_device_fops_write</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col8 decl" id="218filep" title='filep' data-type='struct file *' data-ref="218filep">filep</dfn>,</td></tr>
<tr><th id="1685">1685</th><td>				      <em>const</em> <em>char</em> <a class="macro" href="../../include/linux/compiler_types.h.html#29" title="" data-ref="_M/__user">__user</a> *<dfn class="local col9 decl" id="219buf" title='buf' data-type='const char *' data-ref="219buf">buf</dfn>,</td></tr>
<tr><th id="1686">1686</th><td>				      <a class="typedef" href="../../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> <dfn class="local col0 decl" id="220count" title='count' data-type='size_t' data-ref="220count">count</dfn>, <a class="typedef" href="../../include/linux/types.h.html#loff_t" title='loff_t' data-type='__kernel_loff_t' data-ref="loff_t">loff_t</a> *<dfn class="local col1 decl" id="221ppos" title='ppos' data-type='loff_t *' data-ref="221ppos">ppos</dfn>)</td></tr>
<tr><th id="1687">1687</th><td>{</td></tr>
<tr><th id="1688">1688</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col2 decl" id="222device" title='device' data-type='struct vfio_device *' data-ref="222device">device</dfn> = <a class="local col8 ref" href="#218filep" title='filep' data-ref="218filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1689">1689</th><td></td></tr>
<tr><th id="1690">1690</th><td>	<b>if</b> (<a class="macro" href="../../include/linux/compiler.h.html#77" title="__builtin_expect(!!(!device-&gt;ops-&gt;write), 0)" data-ref="_M/unlikely">unlikely</a>(!<a class="local col2 ref" href="#222device" title='device' data-ref="222device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::write" title='vfio_device_ops::write' data-ref="vfio_device_ops::write">write</a>))</td></tr>
<tr><th id="1691">1691</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1692">1692</th><td></td></tr>
<tr><th id="1693">1693</th><td>	<b>return</b> <a class="local col2 ref" href="#222device" title='device' data-ref="222device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::write" title='vfio_device_ops::write' data-ref="vfio_device_ops::write">write</a>(<a class="local col2 ref" href="#222device" title='device' data-ref="222device">device</a>-&gt;<a class="ref field" href="#vfio_device::device_data" title='vfio_device::device_data' data-ref="vfio_device::device_data">device_data</a>, <a class="local col9 ref" href="#219buf" title='buf' data-ref="219buf">buf</a>, <a class="local col0 ref" href="#220count" title='count' data-ref="220count">count</a>, <a class="local col1 ref" href="#221ppos" title='ppos' data-ref="221ppos">ppos</a>);</td></tr>
<tr><th id="1694">1694</th><td>}</td></tr>
<tr><th id="1695">1695</th><td></td></tr>
<tr><th id="1696">1696</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_device_fops_mmap" title='vfio_device_fops_mmap' data-type='int vfio_device_fops_mmap(struct file * filep, struct vm_area_struct * vma)' data-ref="vfio_device_fops_mmap">vfio_device_fops_mmap</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col3 decl" id="223filep" title='filep' data-type='struct file *' data-ref="223filep">filep</dfn>, <b>struct</b> <a class="type" href="../../include/linux/mm_types.h.html#vm_area_struct" title='vm_area_struct' data-ref="vm_area_struct">vm_area_struct</a> *<dfn class="local col4 decl" id="224vma" title='vma' data-type='struct vm_area_struct *' data-ref="224vma">vma</dfn>)</td></tr>
<tr><th id="1697">1697</th><td>{</td></tr>
<tr><th id="1698">1698</th><td>	<b>struct</b> <a class="type" href="#vfio_device" title='vfio_device' data-ref="vfio_device">vfio_device</a> *<dfn class="local col5 decl" id="225device" title='device' data-type='struct vfio_device *' data-ref="225device">device</dfn> = <a class="local col3 ref" href="#223filep" title='filep' data-ref="223filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1699">1699</th><td></td></tr>
<tr><th id="1700">1700</th><td>	<b>if</b> (<a class="macro" href="../../include/linux/compiler.h.html#77" title="__builtin_expect(!!(!device-&gt;ops-&gt;mmap), 0)" data-ref="_M/unlikely">unlikely</a>(!<a class="local col5 ref" href="#225device" title='device' data-ref="225device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::mmap" title='vfio_device_ops::mmap' data-ref="vfio_device_ops::mmap">mmap</a>))</td></tr>
<tr><th id="1701">1701</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1702">1702</th><td></td></tr>
<tr><th id="1703">1703</th><td>	<b>return</b> <a class="local col5 ref" href="#225device" title='device' data-ref="225device">device</a>-&gt;<a class="ref field" href="#vfio_device::ops" title='vfio_device::ops' data-ref="vfio_device::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_device_ops::mmap" title='vfio_device_ops::mmap' data-ref="vfio_device_ops::mmap">mmap</a>(<a class="local col5 ref" href="#225device" title='device' data-ref="225device">device</a>-&gt;<a class="ref field" href="#vfio_device::device_data" title='vfio_device::device_data' data-ref="vfio_device::device_data">device_data</a>, <a class="local col4 ref" href="#224vma" title='vma' data-ref="224vma">vma</a>);</td></tr>
<tr><th id="1704">1704</th><td>}</td></tr>
<tr><th id="1705">1705</th><td></td></tr>
<tr><th id="1706">1706</th><td><u>#<span data-ppcond="1706">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#96" data-ref="_M/CONFIG_COMPAT">CONFIG_COMPAT</a></u></td></tr>
<tr><th id="1707">1707</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="vfio_device_fops_compat_ioctl" title='vfio_device_fops_compat_ioctl' data-type='long vfio_device_fops_compat_ioctl(struct file * filep, unsigned int cmd, unsigned long arg)' data-ref="vfio_device_fops_compat_ioctl">vfio_device_fops_compat_ioctl</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col6 decl" id="226filep" title='filep' data-type='struct file *' data-ref="226filep">filep</dfn>,</td></tr>
<tr><th id="1708">1708</th><td>					  <em>unsigned</em> <em>int</em> <dfn class="local col7 decl" id="227cmd" title='cmd' data-type='unsigned int' data-ref="227cmd">cmd</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="228arg" title='arg' data-type='unsigned long' data-ref="228arg">arg</dfn>)</td></tr>
<tr><th id="1709">1709</th><td>{</td></tr>
<tr><th id="1710">1710</th><td>	<a class="local col8 ref" href="#228arg" title='arg' data-ref="228arg">arg</a> = (<em>unsigned</em> <em>long</em>)<a class="ref fn" href="../../arch/x86/include/asm/compat.h.html#compat_ptr" title='compat_ptr' data-ref="compat_ptr">compat_ptr</a>(<a class="local col8 ref" href="#228arg" title='arg' data-ref="228arg">arg</a>);</td></tr>
<tr><th id="1711">1711</th><td>	<b>return</b> <a class="tu ref fn" href="#vfio_device_fops_unl_ioctl" title='vfio_device_fops_unl_ioctl' data-use='c' data-ref="vfio_device_fops_unl_ioctl">vfio_device_fops_unl_ioctl</a>(<a class="local col6 ref" href="#226filep" title='filep' data-ref="226filep">filep</a>, <a class="local col7 ref" href="#227cmd" title='cmd' data-ref="227cmd">cmd</a>, <a class="local col8 ref" href="#228arg" title='arg' data-ref="228arg">arg</a>);</td></tr>
<tr><th id="1712">1712</th><td>}</td></tr>
<tr><th id="1713">1713</th><td><u>#<span data-ppcond="1706">endif</span>	/* CONFIG_COMPAT */</u></td></tr>
<tr><th id="1714">1714</th><td></td></tr>
<tr><th id="1715">1715</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file_operations" title='file_operations' data-ref="file_operations">file_operations</a> <dfn class="tu decl def" id="vfio_device_fops" title='vfio_device_fops' data-type='const struct file_operations' data-ref="vfio_device_fops">vfio_device_fops</dfn> = {</td></tr>
<tr><th id="1716">1716</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::owner" title='file_operations::owner' data-ref="file_operations::owner">owner</a>		= <a class="macro" href="../../include/linux/export.h.html#31" title="((struct module *)0)" data-ref="_M/THIS_MODULE">THIS_MODULE</a>,</td></tr>
<tr><th id="1717">1717</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::release" title='file_operations::release' data-ref="file_operations::release">release</a>	= <a class="tu ref fn" href="#vfio_device_fops_release" title='vfio_device_fops_release' data-ref="vfio_device_fops_release">vfio_device_fops_release</a>,</td></tr>
<tr><th id="1718">1718</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::read" title='file_operations::read' data-ref="file_operations::read">read</a>		= <a class="tu ref fn" href="#vfio_device_fops_read" title='vfio_device_fops_read' data-ref="vfio_device_fops_read">vfio_device_fops_read</a>,</td></tr>
<tr><th id="1719">1719</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::write" title='file_operations::write' data-ref="file_operations::write">write</a>		= <a class="tu ref fn" href="#vfio_device_fops_write" title='vfio_device_fops_write' data-ref="vfio_device_fops_write">vfio_device_fops_write</a>,</td></tr>
<tr><th id="1720">1720</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::unlocked_ioctl" title='file_operations::unlocked_ioctl' data-ref="file_operations::unlocked_ioctl">unlocked_ioctl</a>	= <a class="tu ref fn" href="#vfio_device_fops_unl_ioctl" title='vfio_device_fops_unl_ioctl' data-ref="vfio_device_fops_unl_ioctl">vfio_device_fops_unl_ioctl</a>,</td></tr>
<tr><th id="1721">1721</th><td><u>#<span data-ppcond="1721">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#96" data-ref="_M/CONFIG_COMPAT">CONFIG_COMPAT</a></u></td></tr>
<tr><th id="1722">1722</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::compat_ioctl" title='file_operations::compat_ioctl' data-ref="file_operations::compat_ioctl">compat_ioctl</a>	= <a class="tu ref fn" href="#vfio_device_fops_compat_ioctl" title='vfio_device_fops_compat_ioctl' data-ref="vfio_device_fops_compat_ioctl">vfio_device_fops_compat_ioctl</a>,</td></tr>
<tr><th id="1723">1723</th><td><u>#<span data-ppcond="1721">endif</span></u></td></tr>
<tr><th id="1724">1724</th><td>	.<a class="ref field" href="../../include/linux/fs.h.html#file_operations::mmap" title='file_operations::mmap' data-ref="file_operations::mmap">mmap</a>		= <a class="tu ref fn" href="#vfio_device_fops_mmap" title='vfio_device_fops_mmap' data-ref="vfio_device_fops_mmap">vfio_device_fops_mmap</a>,</td></tr>
<tr><th id="1725">1725</th><td>};</td></tr>
<tr><th id="1726">1726</th><td></td></tr>
<tr><th id="1727">1727</th><td><i class="doc">/**</i></td></tr>
<tr><th id="1728">1728</th><td><i class="doc"> * External user API, exported by symbols to be linked dynamically.</i></td></tr>
<tr><th id="1729">1729</th><td><i class="doc"> *</i></td></tr>
<tr><th id="1730">1730</th><td><i class="doc"> * The protocol includes:</i></td></tr>
<tr><th id="1731">1731</th><td><i class="doc"> *  1. do normal VFIO init operation:</i></td></tr>
<tr><th id="1732">1732</th><td><i class="doc"> *	- opening a new container;</i></td></tr>
<tr><th id="1733">1733</th><td><i class="doc"> *	- attaching group(s) to it;</i></td></tr>
<tr><th id="1734">1734</th><td><i class="doc"> *	- setting an IOMMU driver for a container.</i></td></tr>
<tr><th id="1735">1735</th><td><i class="doc"> * When IOMMU is set for a container, all groups in it are</i></td></tr>
<tr><th id="1736">1736</th><td><i class="doc"> * considered ready to use by an external user.</i></td></tr>
<tr><th id="1737">1737</th><td><i class="doc"> *</i></td></tr>
<tr><th id="1738">1738</th><td><i class="doc"> * 2. User space passes a group fd to an external user.</i></td></tr>
<tr><th id="1739">1739</th><td><i class="doc"> * The external user calls vfio_group_get_external_user()</i></td></tr>
<tr><th id="1740">1740</th><td><i class="doc"> * to verify that:</i></td></tr>
<tr><th id="1741">1741</th><td><i class="doc"> *	- the group is initialized;</i></td></tr>
<tr><th id="1742">1742</th><td><i class="doc"> *	- IOMMU is set for it.</i></td></tr>
<tr><th id="1743">1743</th><td><i class="doc"> * If both checks passed, vfio_group_get_external_user()</i></td></tr>
<tr><th id="1744">1744</th><td><i class="doc"> * increments the container user counter to prevent</i></td></tr>
<tr><th id="1745">1745</th><td><i class="doc"> * the VFIO group from disposal before KVM exits.</i></td></tr>
<tr><th id="1746">1746</th><td><i class="doc"> *</i></td></tr>
<tr><th id="1747">1747</th><td><i class="doc"> * 3. The external user calls vfio_external_user_iommu_id()</i></td></tr>
<tr><th id="1748">1748</th><td><i class="doc"> * to know an IOMMU ID.</i></td></tr>
<tr><th id="1749">1749</th><td><i class="doc"> *</i></td></tr>
<tr><th id="1750">1750</th><td><i class="doc"> * 4. When the external KVM finishes, it calls</i></td></tr>
<tr><th id="1751">1751</th><td><i class="doc"> * vfio_group_put_external_user() to release the VFIO group.</i></td></tr>
<tr><th id="1752">1752</th><td><i class="doc"> * This call decrements the container user counter.</i></td></tr>
<tr><th id="1753">1753</th><td><i class="doc"> */</i></td></tr>
<tr><th id="1754">1754</th><td><b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="decl def fn" id="vfio_group_get_external_user" title='vfio_group_get_external_user' data-ref="vfio_group_get_external_user">vfio_group_get_external_user</dfn>(<b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col9 decl" id="229filep" title='filep' data-type='struct file *' data-ref="229filep">filep</dfn>)</td></tr>
<tr><th id="1755">1755</th><td>{</td></tr>
<tr><th id="1756">1756</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col0 decl" id="230group" title='group' data-type='struct vfio_group *' data-ref="230group">group</dfn> = <a class="local col9 ref" href="#229filep" title='filep' data-ref="229filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1757">1757</th><td>	<em>int</em> <dfn class="local col1 decl" id="231ret" title='ret' data-type='int' data-ref="231ret">ret</dfn>;</td></tr>
<tr><th id="1758">1758</th><td></td></tr>
<tr><th id="1759">1759</th><td>	<b>if</b> (<a class="local col9 ref" href="#229filep" title='filep' data-ref="229filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::f_op" title='file::f_op' data-ref="file::f_op">f_op</a> != &amp;<a class="tu ref" href="#vfio_group_fops" title='vfio_group_fops' data-use='a' data-ref="vfio_group_fops">vfio_group_fops</a>)</td></tr>
<tr><th id="1760">1760</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>);</td></tr>
<tr><th id="1761">1761</th><td></td></tr>
<tr><th id="1762">1762</th><td>	<a class="local col1 ref" href="#231ret" title='ret' data-ref="231ret">ret</a> = <a class="tu ref fn" href="#vfio_group_add_container_user" title='vfio_group_add_container_user' data-use='c' data-ref="vfio_group_add_container_user">vfio_group_add_container_user</a>(<a class="local col0 ref" href="#230group" title='group' data-ref="230group">group</a>);</td></tr>
<tr><th id="1763">1763</th><td>	<b>if</b> (<a class="local col1 ref" href="#231ret" title='ret' data-ref="231ret">ret</a>)</td></tr>
<tr><th id="1764">1764</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR">ERR_PTR</a>(<a class="local col1 ref" href="#231ret" title='ret' data-ref="231ret">ret</a>);</td></tr>
<tr><th id="1765">1765</th><td></td></tr>
<tr><th id="1766">1766</th><td>	<a class="tu ref fn" href="#vfio_group_get" title='vfio_group_get' data-use='c' data-ref="vfio_group_get">vfio_group_get</a>(<a class="local col0 ref" href="#230group" title='group' data-ref="230group">group</a>);</td></tr>
<tr><th id="1767">1767</th><td></td></tr>
<tr><th id="1768">1768</th><td>	<b>return</b> <a class="local col0 ref" href="#230group" title='group' data-ref="230group">group</a>;</td></tr>
<tr><th id="1769">1769</th><td>}</td></tr>
<tr><th id="1770">1770</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_group_get_external_user) vfio_group_get_external_user; static const char __kstrtab_vfio_group_get_external_user[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_group_get_external_user&quot;; static const struct kernel_symbol __ksymtab_vfio_group_get_external_user __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_group_get_external_user&quot;), used)) = { (unsigned long)&amp;vfio_group_get_external_user, __kstrtab_vfio_group_get_external_user }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_group_get_external_user" title='vfio_group_get_external_user' data-ref="vfio_group_get_external_user"><a class="ref fn" href="#vfio_group_get_external_user" title='vfio_group_get_external_user' data-ref="vfio_group_get_external_user"><a class="ref fn" href="#vfio_group_get_external_user" title='vfio_group_get_external_user' data-ref="vfio_group_get_external_user"><a class="ref fn" href="#vfio_group_get_external_user" title='vfio_group_get_external_user' data-ref="vfio_group_get_external_user">vfio_group_get_external_user</a></a></a></a>);</td></tr>
<tr><th id="1771">1771</th><td></td></tr>
<tr><th id="1772">1772</th><td><em>void</em> <dfn class="decl def fn" id="vfio_group_put_external_user" title='vfio_group_put_external_user' data-ref="vfio_group_put_external_user">vfio_group_put_external_user</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col2 decl" id="232group" title='group' data-type='struct vfio_group *' data-ref="232group">group</dfn>)</td></tr>
<tr><th id="1773">1773</th><td>{</td></tr>
<tr><th id="1774">1774</th><td>	<a class="tu ref fn" href="#vfio_group_try_dissolve_container" title='vfio_group_try_dissolve_container' data-use='c' data-ref="vfio_group_try_dissolve_container">vfio_group_try_dissolve_container</a>(<a class="local col2 ref" href="#232group" title='group' data-ref="232group">group</a>);</td></tr>
<tr><th id="1775">1775</th><td>	<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col2 ref" href="#232group" title='group' data-ref="232group">group</a>);</td></tr>
<tr><th id="1776">1776</th><td>}</td></tr>
<tr><th id="1777">1777</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_group_put_external_user) vfio_group_put_external_user; static const char __kstrtab_vfio_group_put_external_user[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_group_put_external_user&quot;; static const struct kernel_symbol __ksymtab_vfio_group_put_external_user __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_group_put_external_user&quot;), used)) = { (unsigned long)&amp;vfio_group_put_external_user, __kstrtab_vfio_group_put_external_user }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_group_put_external_user" title='vfio_group_put_external_user' data-ref="vfio_group_put_external_user"><a class="ref fn" href="#vfio_group_put_external_user" title='vfio_group_put_external_user' data-ref="vfio_group_put_external_user"><a class="ref fn" href="#vfio_group_put_external_user" title='vfio_group_put_external_user' data-ref="vfio_group_put_external_user"><a class="ref fn" href="#vfio_group_put_external_user" title='vfio_group_put_external_user' data-ref="vfio_group_put_external_user">vfio_group_put_external_user</a></a></a></a>);</td></tr>
<tr><th id="1778">1778</th><td></td></tr>
<tr><th id="1779">1779</th><td><a class="typedef" href="../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="decl def fn" id="vfio_external_group_match_file" title='vfio_external_group_match_file' data-ref="vfio_external_group_match_file">vfio_external_group_match_file</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col3 decl" id="233test_group" title='test_group' data-type='struct vfio_group *' data-ref="233test_group">test_group</dfn>,</td></tr>
<tr><th id="1780">1780</th><td>				    <b>struct</b> <a class="type" href="../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col4 decl" id="234filep" title='filep' data-type='struct file *' data-ref="234filep">filep</dfn>)</td></tr>
<tr><th id="1781">1781</th><td>{</td></tr>
<tr><th id="1782">1782</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col5 decl" id="235group" title='group' data-type='struct vfio_group *' data-ref="235group">group</dfn> = <a class="local col4 ref" href="#234filep" title='filep' data-ref="234filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="1783">1783</th><td></td></tr>
<tr><th id="1784">1784</th><td>	<b>return</b> (<a class="local col4 ref" href="#234filep" title='filep' data-ref="234filep">filep</a>-&gt;<a class="ref field" href="../../include/linux/fs.h.html#file::f_op" title='file::f_op' data-ref="file::f_op">f_op</a> == &amp;<a class="tu ref" href="#vfio_group_fops" title='vfio_group_fops' data-use='a' data-ref="vfio_group_fops">vfio_group_fops</a>) &amp;&amp; (<a class="local col5 ref" href="#235group" title='group' data-ref="235group">group</a> == <a class="local col3 ref" href="#233test_group" title='test_group' data-ref="233test_group">test_group</a>);</td></tr>
<tr><th id="1785">1785</th><td>}</td></tr>
<tr><th id="1786">1786</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_external_group_match_file) vfio_external_group_match_file; static const char __kstrtab_vfio_external_group_match_file[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_external_group_match_file&quot;; static const struct kernel_symbol __ksymtab_vfio_external_group_match_file __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_external_group_match_file&quot;), used)) = { (unsigned long)&amp;vfio_external_group_match_file, __kstrtab_vfio_external_group_match_file }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_external_group_match_file" title='vfio_external_group_match_file' data-ref="vfio_external_group_match_file"><a class="ref fn" href="#vfio_external_group_match_file" title='vfio_external_group_match_file' data-ref="vfio_external_group_match_file"><a class="ref fn" href="#vfio_external_group_match_file" title='vfio_external_group_match_file' data-ref="vfio_external_group_match_file"><a class="ref fn" href="#vfio_external_group_match_file" title='vfio_external_group_match_file' data-ref="vfio_external_group_match_file">vfio_external_group_match_file</a></a></a></a>);</td></tr>
<tr><th id="1787">1787</th><td></td></tr>
<tr><th id="1788">1788</th><td><em>int</em> <dfn class="decl def fn" id="vfio_external_user_iommu_id" title='vfio_external_user_iommu_id' data-ref="vfio_external_user_iommu_id">vfio_external_user_iommu_id</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col6 decl" id="236group" title='group' data-type='struct vfio_group *' data-ref="236group">group</dfn>)</td></tr>
<tr><th id="1789">1789</th><td>{</td></tr>
<tr><th id="1790">1790</th><td>	<b>return</b> <a class="ref fn" href="../../include/linux/iommu.h.html#iommu_group_id" title='iommu_group_id' data-ref="iommu_group_id">iommu_group_id</a>(<a class="local col6 ref" href="#236group" title='group' data-ref="236group">group</a>-&gt;<a class="ref field" href="#vfio_group::iommu_group" title='vfio_group::iommu_group' data-ref="vfio_group::iommu_group">iommu_group</a>);</td></tr>
<tr><th id="1791">1791</th><td>}</td></tr>
<tr><th id="1792">1792</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_external_user_iommu_id) vfio_external_user_iommu_id; static const char __kstrtab_vfio_external_user_iommu_id[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_external_user_iommu_id&quot;; static const struct kernel_symbol __ksymtab_vfio_external_user_iommu_id __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_external_user_iommu_id&quot;), used)) = { (unsigned long)&amp;vfio_external_user_iommu_id, __kstrtab_vfio_external_user_iommu_id }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_external_user_iommu_id" title='vfio_external_user_iommu_id' data-ref="vfio_external_user_iommu_id"><a class="ref fn" href="#vfio_external_user_iommu_id" title='vfio_external_user_iommu_id' data-ref="vfio_external_user_iommu_id"><a class="ref fn" href="#vfio_external_user_iommu_id" title='vfio_external_user_iommu_id' data-ref="vfio_external_user_iommu_id"><a class="ref fn" href="#vfio_external_user_iommu_id" title='vfio_external_user_iommu_id' data-ref="vfio_external_user_iommu_id">vfio_external_user_iommu_id</a></a></a></a>);</td></tr>
<tr><th id="1793">1793</th><td></td></tr>
<tr><th id="1794">1794</th><td><em>long</em> <dfn class="decl def fn" id="vfio_external_check_extension" title='vfio_external_check_extension' data-ref="vfio_external_check_extension">vfio_external_check_extension</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col7 decl" id="237group" title='group' data-type='struct vfio_group *' data-ref="237group">group</dfn>, <em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="238arg" title='arg' data-type='unsigned long' data-ref="238arg">arg</dfn>)</td></tr>
<tr><th id="1795">1795</th><td>{</td></tr>
<tr><th id="1796">1796</th><td>	<b>return</b> <a class="tu ref fn" href="#vfio_ioctl_check_extension" title='vfio_ioctl_check_extension' data-use='c' data-ref="vfio_ioctl_check_extension">vfio_ioctl_check_extension</a>(<a class="local col7 ref" href="#237group" title='group' data-ref="237group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a>, <a class="local col8 ref" href="#238arg" title='arg' data-ref="238arg">arg</a>);</td></tr>
<tr><th id="1797">1797</th><td>}</td></tr>
<tr><th id="1798">1798</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_external_check_extension) vfio_external_check_extension; static const char __kstrtab_vfio_external_check_extension[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_external_check_extension&quot;; static const struct kernel_symbol __ksymtab_vfio_external_check_extension __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_external_check_extension&quot;), used)) = { (unsigned long)&amp;vfio_external_check_extension, __kstrtab_vfio_external_check_extension }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_external_check_extension" title='vfio_external_check_extension' data-ref="vfio_external_check_extension"><a class="ref fn" href="#vfio_external_check_extension" title='vfio_external_check_extension' data-ref="vfio_external_check_extension"><a class="ref fn" href="#vfio_external_check_extension" title='vfio_external_check_extension' data-ref="vfio_external_check_extension"><a class="ref fn" href="#vfio_external_check_extension" title='vfio_external_check_extension' data-ref="vfio_external_check_extension">vfio_external_check_extension</a></a></a></a>);</td></tr>
<tr><th id="1799">1799</th><td></td></tr>
<tr><th id="1800">1800</th><td><i class="doc">/**</i></td></tr>
<tr><th id="1801">1801</th><td><i class="doc"> * Sub-module support</i></td></tr>
<tr><th id="1802">1802</th><td><i class="doc"> */</i></td></tr>
<tr><th id="1803">1803</th><td><i>/*</i></td></tr>
<tr><th id="1804">1804</th><td><i> * Helper for managing a buffer of info chain capabilities, allocate or</i></td></tr>
<tr><th id="1805">1805</th><td><i> * reallocate a buffer with additional @size, filling in @id and @version</i></td></tr>
<tr><th id="1806">1806</th><td><i> * of the capability.  A pointer to the new capability is returned.</i></td></tr>
<tr><th id="1807">1807</th><td><i> *</i></td></tr>
<tr><th id="1808">1808</th><td><i> * NB. The chain is based at the head of the buffer, so new entries are</i></td></tr>
<tr><th id="1809">1809</th><td><i> * added to the tail, vfio_info_cap_shift() should be called to fixup the</i></td></tr>
<tr><th id="1810">1810</th><td><i> * next offsets prior to copying to the user buffer.</i></td></tr>
<tr><th id="1811">1811</th><td><i> */</i></td></tr>
<tr><th id="1812">1812</th><td><b>struct</b> <a class="type" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header" title='vfio_info_cap_header' data-ref="vfio_info_cap_header">vfio_info_cap_header</a> *<dfn class="decl def fn" id="vfio_info_cap_add" title='vfio_info_cap_add' data-ref="vfio_info_cap_add">vfio_info_cap_add</dfn>(<b>struct</b> <a class="type" href="../../include/linux/vfio.h.html#vfio_info_cap" title='vfio_info_cap' data-ref="vfio_info_cap">vfio_info_cap</a> *<dfn class="local col9 decl" id="239caps" title='caps' data-type='struct vfio_info_cap *' data-ref="239caps">caps</dfn>,</td></tr>
<tr><th id="1813">1813</th><td>					       <a class="typedef" href="../../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> <dfn class="local col0 decl" id="240size" title='size' data-type='size_t' data-ref="240size">size</dfn>, <a class="typedef" href="../../include/asm-generic/int-ll64.h.html#u16" title='u16' data-type='__u16' data-ref="u16">u16</a> <dfn class="local col1 decl" id="241id" title='id' data-type='u16' data-ref="241id">id</dfn>, <a class="typedef" href="../../include/asm-generic/int-ll64.h.html#u16" title='u16' data-type='__u16' data-ref="u16">u16</a> <dfn class="local col2 decl" id="242version" title='version' data-type='u16' data-ref="242version">version</dfn>)</td></tr>
<tr><th id="1814">1814</th><td>{</td></tr>
<tr><th id="1815">1815</th><td>	<em>void</em> *<dfn class="local col3 decl" id="243buf" title='buf' data-type='void *' data-ref="243buf">buf</dfn>;</td></tr>
<tr><th id="1816">1816</th><td>	<b>struct</b> <a class="type" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header" title='vfio_info_cap_header' data-ref="vfio_info_cap_header">vfio_info_cap_header</a> *<dfn class="local col4 decl" id="244header" title='header' data-type='struct vfio_info_cap_header *' data-ref="244header">header</dfn>, *<dfn class="local col5 decl" id="245tmp" title='tmp' data-type='struct vfio_info_cap_header *' data-ref="245tmp">tmp</dfn>;</td></tr>
<tr><th id="1817">1817</th><td></td></tr>
<tr><th id="1818">1818</th><td>	<a class="local col3 ref" href="#243buf" title='buf' data-ref="243buf">buf</a> = <a class="ref fn" href="../../include/linux/slab.h.html#krealloc" title='krealloc' data-ref="krealloc">krealloc</a>(<a class="local col9 ref" href="#239caps" title='caps' data-ref="239caps">caps</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_info_cap::buf" title='vfio_info_cap::buf' data-ref="vfio_info_cap::buf">buf</a>, <a class="local col9 ref" href="#239caps" title='caps' data-ref="239caps">caps</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_info_cap::size" title='vfio_info_cap::size' data-ref="vfio_info_cap::size">size</a> + <a class="local col0 ref" href="#240size" title='size' data-ref="240size">size</a>, <a class="macro" href="../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x200000u|0x400000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="1819">1819</th><td>	<b>if</b> (!<a class="local col3 ref" href="#243buf" title='buf' data-ref="243buf">buf</a>) {</td></tr>
<tr><th id="1820">1820</th><td>		<a class="ref fn" href="../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col9 ref" href="#239caps" title='caps' data-ref="239caps">caps</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_info_cap::buf" title='vfio_info_cap::buf' data-ref="vfio_info_cap::buf">buf</a>);</td></tr>
<tr><th id="1821">1821</th><td>		<a class="local col9 ref" href="#239caps" title='caps' data-ref="239caps">caps</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_info_cap::size" title='vfio_info_cap::size' data-ref="vfio_info_cap::size">size</a> = <var>0</var>;</td></tr>
<tr><th id="1822">1822</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="1823">1823</th><td>	}</td></tr>
<tr><th id="1824">1824</th><td></td></tr>
<tr><th id="1825">1825</th><td>	<a class="local col9 ref" href="#239caps" title='caps' data-ref="239caps">caps</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_info_cap::buf" title='vfio_info_cap::buf' data-ref="vfio_info_cap::buf">buf</a> = <a class="local col3 ref" href="#243buf" title='buf' data-ref="243buf">buf</a>;</td></tr>
<tr><th id="1826">1826</th><td>	<a class="local col4 ref" href="#244header" title='header' data-ref="244header">header</a> = <a class="local col3 ref" href="#243buf" title='buf' data-ref="243buf">buf</a> + <a class="local col9 ref" href="#239caps" title='caps' data-ref="239caps">caps</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_info_cap::size" title='vfio_info_cap::size' data-ref="vfio_info_cap::size">size</a>;</td></tr>
<tr><th id="1827">1827</th><td></td></tr>
<tr><th id="1828">1828</th><td>	<i>/* Eventually copied to user buffer, zero */</i></td></tr>
<tr><th id="1829">1829</th><td>	<a class="ref fn" href="../../arch/x86/include/asm/string_64.h.html#memset" title='memset' data-ref="memset">memset</a>(<a class="local col4 ref" href="#244header" title='header' data-ref="244header">header</a>, <var>0</var>, <a class="local col0 ref" href="#240size" title='size' data-ref="240size">size</a>);</td></tr>
<tr><th id="1830">1830</th><td></td></tr>
<tr><th id="1831">1831</th><td>	<a class="local col4 ref" href="#244header" title='header' data-ref="244header">header</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header::id" title='vfio_info_cap_header::id' data-ref="vfio_info_cap_header::id">id</a> = <a class="local col1 ref" href="#241id" title='id' data-ref="241id">id</a>;</td></tr>
<tr><th id="1832">1832</th><td>	<a class="local col4 ref" href="#244header" title='header' data-ref="244header">header</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header::version" title='vfio_info_cap_header::version' data-ref="vfio_info_cap_header::version">version</a> = <a class="local col2 ref" href="#242version" title='version' data-ref="242version">version</a>;</td></tr>
<tr><th id="1833">1833</th><td></td></tr>
<tr><th id="1834">1834</th><td>	<i>/* Add to the end of the capability chain */</i></td></tr>
<tr><th id="1835">1835</th><td>	<b>for</b> (<a class="local col5 ref" href="#245tmp" title='tmp' data-ref="245tmp">tmp</a> = <a class="local col3 ref" href="#243buf" title='buf' data-ref="243buf">buf</a>; <a class="local col5 ref" href="#245tmp" title='tmp' data-ref="245tmp">tmp</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header::next" title='vfio_info_cap_header::next' data-ref="vfio_info_cap_header::next">next</a>; <a class="local col5 ref" href="#245tmp" title='tmp' data-ref="245tmp">tmp</a> = <a class="local col3 ref" href="#243buf" title='buf' data-ref="243buf">buf</a> + <a class="local col5 ref" href="#245tmp" title='tmp' data-ref="245tmp">tmp</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header::next" title='vfio_info_cap_header::next' data-ref="vfio_info_cap_header::next">next</a>)</td></tr>
<tr><th id="1836">1836</th><td>		; <i>/* nothing */</i></td></tr>
<tr><th id="1837">1837</th><td></td></tr>
<tr><th id="1838">1838</th><td>	<a class="local col5 ref" href="#245tmp" title='tmp' data-ref="245tmp">tmp</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header::next" title='vfio_info_cap_header::next' data-ref="vfio_info_cap_header::next">next</a> = <a class="local col9 ref" href="#239caps" title='caps' data-ref="239caps">caps</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_info_cap::size" title='vfio_info_cap::size' data-ref="vfio_info_cap::size">size</a>;</td></tr>
<tr><th id="1839">1839</th><td>	<a class="local col9 ref" href="#239caps" title='caps' data-ref="239caps">caps</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_info_cap::size" title='vfio_info_cap::size' data-ref="vfio_info_cap::size">size</a> += <a class="local col0 ref" href="#240size" title='size' data-ref="240size">size</a>;</td></tr>
<tr><th id="1840">1840</th><td></td></tr>
<tr><th id="1841">1841</th><td>	<b>return</b> <a class="local col4 ref" href="#244header" title='header' data-ref="244header">header</a>;</td></tr>
<tr><th id="1842">1842</th><td>}</td></tr>
<tr><th id="1843">1843</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_info_cap_add) vfio_info_cap_add; static const char __kstrtab_vfio_info_cap_add[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_info_cap_add&quot;; static const struct kernel_symbol __ksymtab_vfio_info_cap_add __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_info_cap_add&quot;), used)) = { (unsigned long)&amp;vfio_info_cap_add, __kstrtab_vfio_info_cap_add }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_info_cap_add" title='vfio_info_cap_add' data-ref="vfio_info_cap_add"><a class="ref fn" href="#vfio_info_cap_add" title='vfio_info_cap_add' data-ref="vfio_info_cap_add"><a class="ref fn" href="#vfio_info_cap_add" title='vfio_info_cap_add' data-ref="vfio_info_cap_add"><a class="ref fn" href="#vfio_info_cap_add" title='vfio_info_cap_add' data-ref="vfio_info_cap_add">vfio_info_cap_add</a></a></a></a>);</td></tr>
<tr><th id="1844">1844</th><td></td></tr>
<tr><th id="1845">1845</th><td><em>void</em> <dfn class="decl def fn" id="vfio_info_cap_shift" title='vfio_info_cap_shift' data-ref="vfio_info_cap_shift">vfio_info_cap_shift</dfn>(<b>struct</b> <a class="type" href="../../include/linux/vfio.h.html#vfio_info_cap" title='vfio_info_cap' data-ref="vfio_info_cap">vfio_info_cap</a> *<dfn class="local col6 decl" id="246caps" title='caps' data-type='struct vfio_info_cap *' data-ref="246caps">caps</dfn>, <a class="typedef" href="../../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> <dfn class="local col7 decl" id="247offset" title='offset' data-type='size_t' data-ref="247offset">offset</dfn>)</td></tr>
<tr><th id="1846">1846</th><td>{</td></tr>
<tr><th id="1847">1847</th><td>	<b>struct</b> <a class="type" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header" title='vfio_info_cap_header' data-ref="vfio_info_cap_header">vfio_info_cap_header</a> *<dfn class="local col8 decl" id="248tmp" title='tmp' data-type='struct vfio_info_cap_header *' data-ref="248tmp">tmp</dfn>;</td></tr>
<tr><th id="1848">1848</th><td>	<em>void</em> *<dfn class="local col9 decl" id="249buf" title='buf' data-type='void *' data-ref="249buf">buf</dfn> = (<em>void</em> *)<a class="local col6 ref" href="#246caps" title='caps' data-ref="246caps">caps</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_info_cap::buf" title='vfio_info_cap::buf' data-ref="vfio_info_cap::buf">buf</a>;</td></tr>
<tr><th id="1849">1849</th><td></td></tr>
<tr><th id="1850">1850</th><td>	<b>for</b> (<a class="local col8 ref" href="#248tmp" title='tmp' data-ref="248tmp">tmp</a> = <a class="local col9 ref" href="#249buf" title='buf' data-ref="249buf">buf</a>; <a class="local col8 ref" href="#248tmp" title='tmp' data-ref="248tmp">tmp</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header::next" title='vfio_info_cap_header::next' data-ref="vfio_info_cap_header::next">next</a>; <a class="local col8 ref" href="#248tmp" title='tmp' data-ref="248tmp">tmp</a> = <a class="local col9 ref" href="#249buf" title='buf' data-ref="249buf">buf</a> + <a class="local col8 ref" href="#248tmp" title='tmp' data-ref="248tmp">tmp</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header::next" title='vfio_info_cap_header::next' data-ref="vfio_info_cap_header::next">next</a> - <a class="local col7 ref" href="#247offset" title='offset' data-ref="247offset">offset</a>)</td></tr>
<tr><th id="1851">1851</th><td>		<a class="local col8 ref" href="#248tmp" title='tmp' data-ref="248tmp">tmp</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header::next" title='vfio_info_cap_header::next' data-ref="vfio_info_cap_header::next">next</a> += <a class="local col7 ref" href="#247offset" title='offset' data-ref="247offset">offset</a>;</td></tr>
<tr><th id="1852">1852</th><td>}</td></tr>
<tr><th id="1853">1853</th><td><a class="macro" href="../../include/linux/export.h.html#97" title="extern typeof(vfio_info_cap_shift) vfio_info_cap_shift; static const char __kstrtab_vfio_info_cap_shift[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_info_cap_shift&quot;; static const struct kernel_symbol __ksymtab_vfio_info_cap_shift __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vfio_info_cap_shift&quot;), used)) = { (unsigned long)&amp;vfio_info_cap_shift, __kstrtab_vfio_info_cap_shift }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vfio_info_cap_shift" title='vfio_info_cap_shift' data-ref="vfio_info_cap_shift"><a class="ref fn" href="#vfio_info_cap_shift" title='vfio_info_cap_shift' data-ref="vfio_info_cap_shift"><a class="ref fn" href="#vfio_info_cap_shift" title='vfio_info_cap_shift' data-ref="vfio_info_cap_shift"><a class="ref fn" href="#vfio_info_cap_shift" title='vfio_info_cap_shift' data-ref="vfio_info_cap_shift">vfio_info_cap_shift</a></a></a></a>);</td></tr>
<tr><th id="1854">1854</th><td></td></tr>
<tr><th id="1855">1855</th><td><em>int</em> <dfn class="decl def fn" id="vfio_info_add_capability" title='vfio_info_add_capability' data-ref="vfio_info_add_capability">vfio_info_add_capability</dfn>(<b>struct</b> <a class="type" href="../../include/linux/vfio.h.html#vfio_info_cap" title='vfio_info_cap' data-ref="vfio_info_cap">vfio_info_cap</a> *<dfn class="local col0 decl" id="250caps" title='caps' data-type='struct vfio_info_cap *' data-ref="250caps">caps</dfn>,</td></tr>
<tr><th id="1856">1856</th><td>			     <b>struct</b> <a class="type" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header" title='vfio_info_cap_header' data-ref="vfio_info_cap_header">vfio_info_cap_header</a> *<dfn class="local col1 decl" id="251cap" title='cap' data-type='struct vfio_info_cap_header *' data-ref="251cap">cap</dfn>, <a class="typedef" href="../../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> <dfn class="local col2 decl" id="252size" title='size' data-type='size_t' data-ref="252size">size</dfn>)</td></tr>
<tr><th id="1857">1857</th><td>{</td></tr>
<tr><th id="1858">1858</th><td>	<b>struct</b> <a class="type" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header" title='vfio_info_cap_header' data-ref="vfio_info_cap_header">vfio_info_cap_header</a> *<dfn class="local col3 decl" id="253header" title='header' data-type='struct vfio_info_cap_header *' data-ref="253header">header</dfn>;</td></tr>
<tr><th id="1859">1859</th><td></td></tr>
<tr><th id="1860">1860</th><td>	<a class="local col3 ref" href="#253header" title='header' data-ref="253header">header</a> = <a class="ref fn" href="#vfio_info_cap_add" title='vfio_info_cap_add' data-ref="vfio_info_cap_add">vfio_info_cap_add</a>(<a class="local col0 ref" href="#250caps" title='caps' data-ref="250caps">caps</a>, <a class="local col2 ref" href="#252size" title='size' data-ref="252size">size</a>, <a class="local col1 ref" href="#251cap" title='cap' data-ref="251cap">cap</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header::id" title='vfio_info_cap_header::id' data-ref="vfio_info_cap_header::id">id</a>, <a class="local col1 ref" href="#251cap" title='cap' data-ref="251cap">cap</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_info_cap_header::version" title='vfio_info_cap_header::version' data-ref="vfio_info_cap_header::version">version</a>);</td></tr>
<tr><th id="1861">1861</th><td>	<b>if</b> (<a class="ref fn" href="../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="local col3 ref" href="#253header" title='header' data-ref="253header">header</a>))</td></tr>
<tr><th id="1862">1862</th><td>		<b>return</b> <a class="ref fn" href="../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR">PTR_ERR</a>(<a class="local col3 ref" href="#253header" title='header' data-ref="253header">header</a>);</td></tr>
<tr><th id="1863">1863</th><td></td></tr>
<tr><th id="1864">1864</th><td>	<a class="macro" href="../../arch/x86/include/asm/string_64.h.html#37" title="({ size_t __len = (size - sizeof(*header)); void *__ret; if (__builtin_constant_p(size - sizeof(*header)) &amp;&amp; __len &gt;= 64) __ret = __memcpy((header + 1), (cap + 1), __len); else __ret = __builtin_memcpy((header + 1), (cap + 1), __len); __ret; })" data-ref="_M/memcpy">memcpy</a>(<a class="local col3 ref" href="#253header" title='header' data-ref="253header">header</a> + <var>1</var>, <a class="local col1 ref" href="#251cap" title='cap' data-ref="251cap">cap</a> + <var>1</var>, <a class="local col2 ref" href="#252size" title='size' data-ref="252size">size</a> - <b>sizeof</b>(*<a class="local col3 ref" href="#253header" title='header' data-ref="253header">header</a>));</td></tr>
<tr><th id="1865">1865</th><td></td></tr>
<tr><th id="1866">1866</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1867">1867</th><td>}</td></tr>
<tr><th id="1868">1868</th><td><a class="macro" href="../../include/linux/export.h.html#97" title="extern typeof(vfio_info_add_capability) vfio_info_add_capability; static const char __kstrtab_vfio_info_add_capability[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_info_add_capability&quot;; static const struct kernel_symbol __ksymtab_vfio_info_add_capability __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vfio_info_add_capability&quot;), used)) = { (unsigned long)&amp;vfio_info_add_capability, __kstrtab_vfio_info_add_capability }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vfio_info_add_capability" title='vfio_info_add_capability' data-ref="vfio_info_add_capability"><a class="ref fn" href="#vfio_info_add_capability" title='vfio_info_add_capability' data-ref="vfio_info_add_capability"><a class="ref fn" href="#vfio_info_add_capability" title='vfio_info_add_capability' data-ref="vfio_info_add_capability"><a class="ref fn" href="#vfio_info_add_capability" title='vfio_info_add_capability' data-ref="vfio_info_add_capability">vfio_info_add_capability</a></a></a></a>);</td></tr>
<tr><th id="1869">1869</th><td></td></tr>
<tr><th id="1870">1870</th><td><em>int</em> <dfn class="decl def fn" id="vfio_set_irqs_validate_and_prepare" title='vfio_set_irqs_validate_and_prepare' data-ref="vfio_set_irqs_validate_and_prepare">vfio_set_irqs_validate_and_prepare</dfn>(<b>struct</b> <a class="type" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set" title='vfio_irq_set' data-ref="vfio_irq_set">vfio_irq_set</a> *<dfn class="local col4 decl" id="254hdr" title='hdr' data-type='struct vfio_irq_set *' data-ref="254hdr">hdr</dfn>, <em>int</em> <dfn class="local col5 decl" id="255num_irqs" title='num_irqs' data-type='int' data-ref="255num_irqs">num_irqs</dfn>,</td></tr>
<tr><th id="1871">1871</th><td>				       <em>int</em> <dfn class="local col6 decl" id="256max_irq_type" title='max_irq_type' data-type='int' data-ref="256max_irq_type">max_irq_type</dfn>, <a class="typedef" href="../../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> *<dfn class="local col7 decl" id="257data_size" title='data_size' data-type='size_t *' data-ref="257data_size">data_size</dfn>)</td></tr>
<tr><th id="1872">1872</th><td>{</td></tr>
<tr><th id="1873">1873</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col8 decl" id="258minsz" title='minsz' data-type='unsigned long' data-ref="258minsz">minsz</dfn>;</td></tr>
<tr><th id="1874">1874</th><td>	<a class="typedef" href="../../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> <dfn class="local col9 decl" id="259size" title='size' data-type='size_t' data-ref="259size">size</dfn>;</td></tr>
<tr><th id="1875">1875</th><td></td></tr>
<tr><th id="1876">1876</th><td>	<a class="local col8 ref" href="#258minsz" title='minsz' data-ref="258minsz">minsz</a> = <a class="macro" href="../../include/linux/stddef.h.html#36" title="(__builtin_offsetof(struct vfio_irq_set, count) + sizeof((((struct vfio_irq_set *)0)-&gt;count)))" data-ref="_M/offsetofend">offsetofend</a>(<b>struct</b> <a class="type" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set" title='vfio_irq_set' data-ref="vfio_irq_set">vfio_irq_set</a>, <a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::count" title='vfio_irq_set::count' data-ref="vfio_irq_set::count">count</a>);</td></tr>
<tr><th id="1877">1877</th><td></td></tr>
<tr><th id="1878">1878</th><td>	<b>if</b> ((<a class="local col4 ref" href="#254hdr" title='hdr' data-ref="254hdr">hdr</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::argsz" title='vfio_irq_set::argsz' data-ref="vfio_irq_set::argsz">argsz</a> &lt; <a class="local col8 ref" href="#258minsz" title='minsz' data-ref="258minsz">minsz</a>) || (<a class="local col4 ref" href="#254hdr" title='hdr' data-ref="254hdr">hdr</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::index" title='vfio_irq_set::index' data-ref="vfio_irq_set::index">index</a> &gt;= <a class="local col6 ref" href="#256max_irq_type" title='max_irq_type' data-ref="256max_irq_type">max_irq_type</a>) ||</td></tr>
<tr><th id="1879">1879</th><td>	    (<a class="local col4 ref" href="#254hdr" title='hdr' data-ref="254hdr">hdr</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::count" title='vfio_irq_set::count' data-ref="vfio_irq_set::count">count</a> &gt;= (<a class="macro" href="../../include/linux/kernel.h.html#40" title="((u32)~0U)" data-ref="_M/U32_MAX">U32_MAX</a> - <a class="local col4 ref" href="#254hdr" title='hdr' data-ref="254hdr">hdr</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::start" title='vfio_irq_set::start' data-ref="vfio_irq_set::start">start</a>)) ||</td></tr>
<tr><th id="1880">1880</th><td>	    (<a class="local col4 ref" href="#254hdr" title='hdr' data-ref="254hdr">hdr</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::flags" title='vfio_irq_set::flags' data-ref="vfio_irq_set::flags">flags</a> &amp; ~(<a class="macro" href="../../include/uapi/linux/vfio.h.html#412" title="((1 &lt;&lt; 0) | (1 &lt;&lt; 1) | (1 &lt;&lt; 2))" data-ref="_M/VFIO_IRQ_SET_DATA_TYPE_MASK">VFIO_IRQ_SET_DATA_TYPE_MASK</a> |</td></tr>
<tr><th id="1881">1881</th><td>				<a class="macro" href="../../include/uapi/linux/vfio.h.html#415" title="((1 &lt;&lt; 3) | (1 &lt;&lt; 4) | (1 &lt;&lt; 5))" data-ref="_M/VFIO_IRQ_SET_ACTION_TYPE_MASK">VFIO_IRQ_SET_ACTION_TYPE_MASK</a>)))</td></tr>
<tr><th id="1882">1882</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1883">1883</th><td></td></tr>
<tr><th id="1884">1884</th><td>	<b>if</b> (<a class="local col7 ref" href="#257data_size" title='data_size' data-ref="257data_size">data_size</a>)</td></tr>
<tr><th id="1885">1885</th><td>		*<a class="local col7 ref" href="#257data_size" title='data_size' data-ref="257data_size">data_size</a> = <var>0</var>;</td></tr>
<tr><th id="1886">1886</th><td></td></tr>
<tr><th id="1887">1887</th><td>	<b>if</b> (<a class="local col4 ref" href="#254hdr" title='hdr' data-ref="254hdr">hdr</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::start" title='vfio_irq_set::start' data-ref="vfio_irq_set::start">start</a> &gt;= <a class="local col5 ref" href="#255num_irqs" title='num_irqs' data-ref="255num_irqs">num_irqs</a> || <a class="local col4 ref" href="#254hdr" title='hdr' data-ref="254hdr">hdr</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::start" title='vfio_irq_set::start' data-ref="vfio_irq_set::start">start</a> + <a class="local col4 ref" href="#254hdr" title='hdr' data-ref="254hdr">hdr</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::count" title='vfio_irq_set::count' data-ref="vfio_irq_set::count">count</a> &gt; <a class="local col5 ref" href="#255num_irqs" title='num_irqs' data-ref="255num_irqs">num_irqs</a>)</td></tr>
<tr><th id="1888">1888</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1889">1889</th><td></td></tr>
<tr><th id="1890">1890</th><td>	<b>switch</b> (<a class="local col4 ref" href="#254hdr" title='hdr' data-ref="254hdr">hdr</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::flags" title='vfio_irq_set::flags' data-ref="vfio_irq_set::flags">flags</a> &amp; <a class="macro" href="../../include/uapi/linux/vfio.h.html#412" title="((1 &lt;&lt; 0) | (1 &lt;&lt; 1) | (1 &lt;&lt; 2))" data-ref="_M/VFIO_IRQ_SET_DATA_TYPE_MASK">VFIO_IRQ_SET_DATA_TYPE_MASK</a>) {</td></tr>
<tr><th id="1891">1891</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/vfio.h.html#399" title="(1 &lt;&lt; 0)" data-ref="_M/VFIO_IRQ_SET_DATA_NONE">VFIO_IRQ_SET_DATA_NONE</a>:</td></tr>
<tr><th id="1892">1892</th><td>		<a class="local col9 ref" href="#259size" title='size' data-ref="259size">size</a> = <var>0</var>;</td></tr>
<tr><th id="1893">1893</th><td>		<b>break</b>;</td></tr>
<tr><th id="1894">1894</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/vfio.h.html#400" title="(1 &lt;&lt; 1)" data-ref="_M/VFIO_IRQ_SET_DATA_BOOL">VFIO_IRQ_SET_DATA_BOOL</a>:</td></tr>
<tr><th id="1895">1895</th><td>		<a class="local col9 ref" href="#259size" title='size' data-ref="259size">size</a> = <b>sizeof</b>(<a class="typedef" href="../../include/linux/types.h.html#uint8_t" title='uint8_t' data-type='u8' data-ref="uint8_t">uint8_t</a>);</td></tr>
<tr><th id="1896">1896</th><td>		<b>break</b>;</td></tr>
<tr><th id="1897">1897</th><td>	<b>case</b> <a class="macro" href="../../include/uapi/linux/vfio.h.html#401" title="(1 &lt;&lt; 2)" data-ref="_M/VFIO_IRQ_SET_DATA_EVENTFD">VFIO_IRQ_SET_DATA_EVENTFD</a>:</td></tr>
<tr><th id="1898">1898</th><td>		<a class="local col9 ref" href="#259size" title='size' data-ref="259size">size</a> = <b>sizeof</b>(<a class="typedef" href="../../include/linux/types.h.html#int32_t" title='int32_t' data-type='s32' data-ref="int32_t">int32_t</a>);</td></tr>
<tr><th id="1899">1899</th><td>		<b>break</b>;</td></tr>
<tr><th id="1900">1900</th><td>	<b>default</b>:</td></tr>
<tr><th id="1901">1901</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1902">1902</th><td>	}</td></tr>
<tr><th id="1903">1903</th><td></td></tr>
<tr><th id="1904">1904</th><td>	<b>if</b> (<a class="local col9 ref" href="#259size" title='size' data-ref="259size">size</a>) {</td></tr>
<tr><th id="1905">1905</th><td>		<b>if</b> (<a class="local col4 ref" href="#254hdr" title='hdr' data-ref="254hdr">hdr</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::argsz" title='vfio_irq_set::argsz' data-ref="vfio_irq_set::argsz">argsz</a> - <a class="local col8 ref" href="#258minsz" title='minsz' data-ref="258minsz">minsz</a> &lt; <a class="local col4 ref" href="#254hdr" title='hdr' data-ref="254hdr">hdr</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::count" title='vfio_irq_set::count' data-ref="vfio_irq_set::count">count</a> * <a class="local col9 ref" href="#259size" title='size' data-ref="259size">size</a>)</td></tr>
<tr><th id="1906">1906</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1907">1907</th><td></td></tr>
<tr><th id="1908">1908</th><td>		<b>if</b> (!<a class="local col7 ref" href="#257data_size" title='data_size' data-ref="257data_size">data_size</a>)</td></tr>
<tr><th id="1909">1909</th><td>			<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1910">1910</th><td></td></tr>
<tr><th id="1911">1911</th><td>		*<a class="local col7 ref" href="#257data_size" title='data_size' data-ref="257data_size">data_size</a> = <a class="local col4 ref" href="#254hdr" title='hdr' data-ref="254hdr">hdr</a>-&gt;<a class="ref field" href="../../include/uapi/linux/vfio.h.html#vfio_irq_set::count" title='vfio_irq_set::count' data-ref="vfio_irq_set::count">count</a> * <a class="local col9 ref" href="#259size" title='size' data-ref="259size">size</a>;</td></tr>
<tr><th id="1912">1912</th><td>	}</td></tr>
<tr><th id="1913">1913</th><td></td></tr>
<tr><th id="1914">1914</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1915">1915</th><td>}</td></tr>
<tr><th id="1916">1916</th><td><a class="macro" href="../../include/linux/export.h.html#97" title="extern typeof(vfio_set_irqs_validate_and_prepare) vfio_set_irqs_validate_and_prepare; static const char __kstrtab_vfio_set_irqs_validate_and_prepare[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_set_irqs_validate_and_prepare&quot;; static const struct kernel_symbol __ksymtab_vfio_set_irqs_validate_and_prepare __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vfio_set_irqs_validate_and_prepare&quot;), used)) = { (unsigned long)&amp;vfio_set_irqs_validate_and_prepare, __kstrtab_vfio_set_irqs_validate_and_prepare }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vfio_set_irqs_validate_and_prepare" title='vfio_set_irqs_validate_and_prepare' data-ref="vfio_set_irqs_validate_and_prepare"><a class="ref fn" href="#vfio_set_irqs_validate_and_prepare" title='vfio_set_irqs_validate_and_prepare' data-ref="vfio_set_irqs_validate_and_prepare"><a class="ref fn" href="#vfio_set_irqs_validate_and_prepare" title='vfio_set_irqs_validate_and_prepare' data-ref="vfio_set_irqs_validate_and_prepare"><a class="ref fn" href="#vfio_set_irqs_validate_and_prepare" title='vfio_set_irqs_validate_and_prepare' data-ref="vfio_set_irqs_validate_and_prepare">vfio_set_irqs_validate_and_prepare</a></a></a></a>);</td></tr>
<tr><th id="1917">1917</th><td></td></tr>
<tr><th id="1918">1918</th><td><i>/*</i></td></tr>
<tr><th id="1919">1919</th><td><i> * Pin a set of guest PFNs and return their associated host PFNs for local</i></td></tr>
<tr><th id="1920">1920</th><td><i> * domain only.</i></td></tr>
<tr><th id="1921">1921</th><td><i> * @dev [in]     : device</i></td></tr>
<tr><th id="1922">1922</th><td><i> * @user_pfn [in]: array of user/guest PFNs to be pinned.</i></td></tr>
<tr><th id="1923">1923</th><td><i> * @npage [in]   : count of elements in user_pfn array.  This count should not</i></td></tr>
<tr><th id="1924">1924</th><td><i> *		   be greater VFIO_PIN_PAGES_MAX_ENTRIES.</i></td></tr>
<tr><th id="1925">1925</th><td><i> * @prot [in]    : protection flags</i></td></tr>
<tr><th id="1926">1926</th><td><i> * @phys_pfn[out]: array of host PFNs</i></td></tr>
<tr><th id="1927">1927</th><td><i> * Return error or number of pages pinned.</i></td></tr>
<tr><th id="1928">1928</th><td><i> */</i></td></tr>
<tr><th id="1929">1929</th><td><em>int</em> <dfn class="decl def fn" id="vfio_pin_pages" title='vfio_pin_pages' data-ref="vfio_pin_pages">vfio_pin_pages</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col0 decl" id="260dev" title='dev' data-type='struct device *' data-ref="260dev">dev</dfn>, <em>unsigned</em> <em>long</em> *<dfn class="local col1 decl" id="261user_pfn" title='user_pfn' data-type='unsigned long *' data-ref="261user_pfn">user_pfn</dfn>, <em>int</em> <dfn class="local col2 decl" id="262npage" title='npage' data-type='int' data-ref="262npage">npage</dfn>,</td></tr>
<tr><th id="1930">1930</th><td>		   <em>int</em> <dfn class="local col3 decl" id="263prot" title='prot' data-type='int' data-ref="263prot">prot</dfn>, <em>unsigned</em> <em>long</em> *<dfn class="local col4 decl" id="264phys_pfn" title='phys_pfn' data-type='unsigned long *' data-ref="264phys_pfn">phys_pfn</dfn>)</td></tr>
<tr><th id="1931">1931</th><td>{</td></tr>
<tr><th id="1932">1932</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col5 decl" id="265container" title='container' data-type='struct vfio_container *' data-ref="265container">container</dfn>;</td></tr>
<tr><th id="1933">1933</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col6 decl" id="266group" title='group' data-type='struct vfio_group *' data-ref="266group">group</dfn>;</td></tr>
<tr><th id="1934">1934</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col7 decl" id="267driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="267driver">driver</dfn>;</td></tr>
<tr><th id="1935">1935</th><td>	<em>int</em> <dfn class="local col8 decl" id="268ret" title='ret' data-type='int' data-ref="268ret">ret</dfn>;</td></tr>
<tr><th id="1936">1936</th><td></td></tr>
<tr><th id="1937">1937</th><td>	<b>if</b> (!<a class="local col0 ref" href="#260dev" title='dev' data-ref="260dev">dev</a> || !<a class="local col1 ref" href="#261user_pfn" title='user_pfn' data-ref="261user_pfn">user_pfn</a> || !<a class="local col4 ref" href="#264phys_pfn" title='phys_pfn' data-ref="264phys_pfn">phys_pfn</a> || !<a class="local col2 ref" href="#262npage" title='npage' data-ref="262npage">npage</a>)</td></tr>
<tr><th id="1938">1938</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1939">1939</th><td></td></tr>
<tr><th id="1940">1940</th><td>	<b>if</b> (<a class="local col2 ref" href="#262npage" title='npage' data-ref="262npage">npage</a> &gt; <a class="macro" href="../../include/linux/vfio.h.html#106" title="(((1UL) &lt;&lt; 12)/sizeof(unsigned long))" data-ref="_M/VFIO_PIN_PAGES_MAX_ENTRIES">VFIO_PIN_PAGES_MAX_ENTRIES</a>)</td></tr>
<tr><th id="1941">1941</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#11" title="7" data-ref="_M/E2BIG">E2BIG</a>;</td></tr>
<tr><th id="1942">1942</th><td></td></tr>
<tr><th id="1943">1943</th><td>	<a class="local col6 ref" href="#266group" title='group' data-ref="266group">group</a> = <a class="tu ref fn" href="#vfio_group_get_from_dev" title='vfio_group_get_from_dev' data-use='c' data-ref="vfio_group_get_from_dev">vfio_group_get_from_dev</a>(<a class="local col0 ref" href="#260dev" title='dev' data-ref="260dev">dev</a>);</td></tr>
<tr><th id="1944">1944</th><td>	<b>if</b> (!<a class="local col6 ref" href="#266group" title='group' data-ref="266group">group</a>)</td></tr>
<tr><th id="1945">1945</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#23" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="1946">1946</th><td></td></tr>
<tr><th id="1947">1947</th><td>	<a class="local col8 ref" href="#268ret" title='ret' data-ref="268ret">ret</a> = <a class="tu ref fn" href="#vfio_group_add_container_user" title='vfio_group_add_container_user' data-use='c' data-ref="vfio_group_add_container_user">vfio_group_add_container_user</a>(<a class="local col6 ref" href="#266group" title='group' data-ref="266group">group</a>);</td></tr>
<tr><th id="1948">1948</th><td>	<b>if</b> (<a class="local col8 ref" href="#268ret" title='ret' data-ref="268ret">ret</a>)</td></tr>
<tr><th id="1949">1949</th><td>		<b>goto</b> <a class="lbl" href="#269err_pin_pages" data-ref="269err_pin_pages">err_pin_pages</a>;</td></tr>
<tr><th id="1950">1950</th><td></td></tr>
<tr><th id="1951">1951</th><td>	<a class="local col5 ref" href="#265container" title='container' data-ref="265container">container</a> = <a class="local col6 ref" href="#266group" title='group' data-ref="266group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a>;</td></tr>
<tr><th id="1952">1952</th><td>	<a class="local col7 ref" href="#267driver" title='driver' data-ref="267driver">driver</a> = <a class="local col5 ref" href="#265container" title='container' data-ref="265container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a>;</td></tr>
<tr><th id="1953">1953</th><td>	<b>if</b> (<a class="macro" href="../../include/linux/compiler.h.html#76" title="__builtin_expect(!!(driver &amp;&amp; driver-&gt;ops-&gt;pin_pages), 1)" data-ref="_M/likely">likely</a>(<a class="local col7 ref" href="#267driver" title='driver' data-ref="267driver">driver</a> &amp;&amp; <a class="local col7 ref" href="#267driver" title='driver' data-ref="267driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::pin_pages" title='vfio_iommu_driver_ops::pin_pages' data-ref="vfio_iommu_driver_ops::pin_pages">pin_pages</a>))</td></tr>
<tr><th id="1954">1954</th><td>		<a class="local col8 ref" href="#268ret" title='ret' data-ref="268ret">ret</a> = <a class="local col7 ref" href="#267driver" title='driver' data-ref="267driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::pin_pages" title='vfio_iommu_driver_ops::pin_pages' data-ref="vfio_iommu_driver_ops::pin_pages">pin_pages</a>(<a class="local col5 ref" href="#265container" title='container' data-ref="265container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='r' data-ref="vfio_container::iommu_data">iommu_data</a>, <a class="local col1 ref" href="#261user_pfn" title='user_pfn' data-ref="261user_pfn">user_pfn</a>,</td></tr>
<tr><th id="1955">1955</th><td>					     <a class="local col2 ref" href="#262npage" title='npage' data-ref="262npage">npage</a>, <a class="local col3 ref" href="#263prot" title='prot' data-ref="263prot">prot</a>, <a class="local col4 ref" href="#264phys_pfn" title='phys_pfn' data-ref="264phys_pfn">phys_pfn</a>);</td></tr>
<tr><th id="1956">1956</th><td>	<b>else</b></td></tr>
<tr><th id="1957">1957</th><td>		<a class="local col8 ref" href="#268ret" title='ret' data-ref="268ret">ret</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#29" title="25" data-ref="_M/ENOTTY">ENOTTY</a>;</td></tr>
<tr><th id="1958">1958</th><td></td></tr>
<tr><th id="1959">1959</th><td>	<a class="tu ref fn" href="#vfio_group_try_dissolve_container" title='vfio_group_try_dissolve_container' data-use='c' data-ref="vfio_group_try_dissolve_container">vfio_group_try_dissolve_container</a>(<a class="local col6 ref" href="#266group" title='group' data-ref="266group">group</a>);</td></tr>
<tr><th id="1960">1960</th><td></td></tr>
<tr><th id="1961">1961</th><td><dfn class="lbl" id="269err_pin_pages" data-ref="269err_pin_pages">err_pin_pages</dfn>:</td></tr>
<tr><th id="1962">1962</th><td>	<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col6 ref" href="#266group" title='group' data-ref="266group">group</a>);</td></tr>
<tr><th id="1963">1963</th><td>	<b>return</b> <a class="local col8 ref" href="#268ret" title='ret' data-ref="268ret">ret</a>;</td></tr>
<tr><th id="1964">1964</th><td>}</td></tr>
<tr><th id="1965">1965</th><td><a class="macro" href="../../include/linux/export.h.html#97" title="extern typeof(vfio_pin_pages) vfio_pin_pages; static const char __kstrtab_vfio_pin_pages[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_pin_pages&quot;; static const struct kernel_symbol __ksymtab_vfio_pin_pages __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vfio_pin_pages&quot;), used)) = { (unsigned long)&amp;vfio_pin_pages, __kstrtab_vfio_pin_pages }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vfio_pin_pages" title='vfio_pin_pages' data-ref="vfio_pin_pages"><a class="ref fn" href="#vfio_pin_pages" title='vfio_pin_pages' data-ref="vfio_pin_pages"><a class="ref fn" href="#vfio_pin_pages" title='vfio_pin_pages' data-ref="vfio_pin_pages"><a class="ref fn" href="#vfio_pin_pages" title='vfio_pin_pages' data-ref="vfio_pin_pages">vfio_pin_pages</a></a></a></a>);</td></tr>
<tr><th id="1966">1966</th><td></td></tr>
<tr><th id="1967">1967</th><td><i>/*</i></td></tr>
<tr><th id="1968">1968</th><td><i> * Unpin set of host PFNs for local domain only.</i></td></tr>
<tr><th id="1969">1969</th><td><i> * @dev [in]     : device</i></td></tr>
<tr><th id="1970">1970</th><td><i> * @user_pfn [in]: array of user/guest PFNs to be unpinned. Number of user/guest</i></td></tr>
<tr><th id="1971">1971</th><td><i> *		   PFNs should not be greater than VFIO_PIN_PAGES_MAX_ENTRIES.</i></td></tr>
<tr><th id="1972">1972</th><td><i> * @npage [in]   : count of elements in user_pfn array.  This count should not</i></td></tr>
<tr><th id="1973">1973</th><td><i> *                 be greater than VFIO_PIN_PAGES_MAX_ENTRIES.</i></td></tr>
<tr><th id="1974">1974</th><td><i> * Return error or number of pages unpinned.</i></td></tr>
<tr><th id="1975">1975</th><td><i> */</i></td></tr>
<tr><th id="1976">1976</th><td><em>int</em> <dfn class="decl def fn" id="vfio_unpin_pages" title='vfio_unpin_pages' data-ref="vfio_unpin_pages">vfio_unpin_pages</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col0 decl" id="270dev" title='dev' data-type='struct device *' data-ref="270dev">dev</dfn>, <em>unsigned</em> <em>long</em> *<dfn class="local col1 decl" id="271user_pfn" title='user_pfn' data-type='unsigned long *' data-ref="271user_pfn">user_pfn</dfn>, <em>int</em> <dfn class="local col2 decl" id="272npage" title='npage' data-type='int' data-ref="272npage">npage</dfn>)</td></tr>
<tr><th id="1977">1977</th><td>{</td></tr>
<tr><th id="1978">1978</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col3 decl" id="273container" title='container' data-type='struct vfio_container *' data-ref="273container">container</dfn>;</td></tr>
<tr><th id="1979">1979</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col4 decl" id="274group" title='group' data-type='struct vfio_group *' data-ref="274group">group</dfn>;</td></tr>
<tr><th id="1980">1980</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col5 decl" id="275driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="275driver">driver</dfn>;</td></tr>
<tr><th id="1981">1981</th><td>	<em>int</em> <dfn class="local col6 decl" id="276ret" title='ret' data-type='int' data-ref="276ret">ret</dfn>;</td></tr>
<tr><th id="1982">1982</th><td></td></tr>
<tr><th id="1983">1983</th><td>	<b>if</b> (!<a class="local col0 ref" href="#270dev" title='dev' data-ref="270dev">dev</a> || !<a class="local col1 ref" href="#271user_pfn" title='user_pfn' data-ref="271user_pfn">user_pfn</a> || !<a class="local col2 ref" href="#272npage" title='npage' data-ref="272npage">npage</a>)</td></tr>
<tr><th id="1984">1984</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="1985">1985</th><td></td></tr>
<tr><th id="1986">1986</th><td>	<b>if</b> (<a class="local col2 ref" href="#272npage" title='npage' data-ref="272npage">npage</a> &gt; <a class="macro" href="../../include/linux/vfio.h.html#106" title="(((1UL) &lt;&lt; 12)/sizeof(unsigned long))" data-ref="_M/VFIO_PIN_PAGES_MAX_ENTRIES">VFIO_PIN_PAGES_MAX_ENTRIES</a>)</td></tr>
<tr><th id="1987">1987</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#11" title="7" data-ref="_M/E2BIG">E2BIG</a>;</td></tr>
<tr><th id="1988">1988</th><td></td></tr>
<tr><th id="1989">1989</th><td>	<a class="local col4 ref" href="#274group" title='group' data-ref="274group">group</a> = <a class="tu ref fn" href="#vfio_group_get_from_dev" title='vfio_group_get_from_dev' data-use='c' data-ref="vfio_group_get_from_dev">vfio_group_get_from_dev</a>(<a class="local col0 ref" href="#270dev" title='dev' data-ref="270dev">dev</a>);</td></tr>
<tr><th id="1990">1990</th><td>	<b>if</b> (!<a class="local col4 ref" href="#274group" title='group' data-ref="274group">group</a>)</td></tr>
<tr><th id="1991">1991</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#23" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="1992">1992</th><td></td></tr>
<tr><th id="1993">1993</th><td>	<a class="local col6 ref" href="#276ret" title='ret' data-ref="276ret">ret</a> = <a class="tu ref fn" href="#vfio_group_add_container_user" title='vfio_group_add_container_user' data-use='c' data-ref="vfio_group_add_container_user">vfio_group_add_container_user</a>(<a class="local col4 ref" href="#274group" title='group' data-ref="274group">group</a>);</td></tr>
<tr><th id="1994">1994</th><td>	<b>if</b> (<a class="local col6 ref" href="#276ret" title='ret' data-ref="276ret">ret</a>)</td></tr>
<tr><th id="1995">1995</th><td>		<b>goto</b> <a class="lbl" href="#277err_unpin_pages" data-ref="277err_unpin_pages">err_unpin_pages</a>;</td></tr>
<tr><th id="1996">1996</th><td></td></tr>
<tr><th id="1997">1997</th><td>	<a class="local col3 ref" href="#273container" title='container' data-ref="273container">container</a> = <a class="local col4 ref" href="#274group" title='group' data-ref="274group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a>;</td></tr>
<tr><th id="1998">1998</th><td>	<a class="local col5 ref" href="#275driver" title='driver' data-ref="275driver">driver</a> = <a class="local col3 ref" href="#273container" title='container' data-ref="273container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a>;</td></tr>
<tr><th id="1999">1999</th><td>	<b>if</b> (<a class="macro" href="../../include/linux/compiler.h.html#76" title="__builtin_expect(!!(driver &amp;&amp; driver-&gt;ops-&gt;unpin_pages), 1)" data-ref="_M/likely">likely</a>(<a class="local col5 ref" href="#275driver" title='driver' data-ref="275driver">driver</a> &amp;&amp; <a class="local col5 ref" href="#275driver" title='driver' data-ref="275driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::unpin_pages" title='vfio_iommu_driver_ops::unpin_pages' data-ref="vfio_iommu_driver_ops::unpin_pages">unpin_pages</a>))</td></tr>
<tr><th id="2000">2000</th><td>		<a class="local col6 ref" href="#276ret" title='ret' data-ref="276ret">ret</a> = <a class="local col5 ref" href="#275driver" title='driver' data-ref="275driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::unpin_pages" title='vfio_iommu_driver_ops::unpin_pages' data-ref="vfio_iommu_driver_ops::unpin_pages">unpin_pages</a>(<a class="local col3 ref" href="#273container" title='container' data-ref="273container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='r' data-ref="vfio_container::iommu_data">iommu_data</a>, <a class="local col1 ref" href="#271user_pfn" title='user_pfn' data-ref="271user_pfn">user_pfn</a>,</td></tr>
<tr><th id="2001">2001</th><td>					       <a class="local col2 ref" href="#272npage" title='npage' data-ref="272npage">npage</a>);</td></tr>
<tr><th id="2002">2002</th><td>	<b>else</b></td></tr>
<tr><th id="2003">2003</th><td>		<a class="local col6 ref" href="#276ret" title='ret' data-ref="276ret">ret</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#29" title="25" data-ref="_M/ENOTTY">ENOTTY</a>;</td></tr>
<tr><th id="2004">2004</th><td></td></tr>
<tr><th id="2005">2005</th><td>	<a class="tu ref fn" href="#vfio_group_try_dissolve_container" title='vfio_group_try_dissolve_container' data-use='c' data-ref="vfio_group_try_dissolve_container">vfio_group_try_dissolve_container</a>(<a class="local col4 ref" href="#274group" title='group' data-ref="274group">group</a>);</td></tr>
<tr><th id="2006">2006</th><td></td></tr>
<tr><th id="2007">2007</th><td><dfn class="lbl" id="277err_unpin_pages" data-ref="277err_unpin_pages">err_unpin_pages</dfn>:</td></tr>
<tr><th id="2008">2008</th><td>	<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col4 ref" href="#274group" title='group' data-ref="274group">group</a>);</td></tr>
<tr><th id="2009">2009</th><td>	<b>return</b> <a class="local col6 ref" href="#276ret" title='ret' data-ref="276ret">ret</a>;</td></tr>
<tr><th id="2010">2010</th><td>}</td></tr>
<tr><th id="2011">2011</th><td><a class="macro" href="../../include/linux/export.h.html#97" title="extern typeof(vfio_unpin_pages) vfio_unpin_pages; static const char __kstrtab_vfio_unpin_pages[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_unpin_pages&quot;; static const struct kernel_symbol __ksymtab_vfio_unpin_pages __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vfio_unpin_pages&quot;), used)) = { (unsigned long)&amp;vfio_unpin_pages, __kstrtab_vfio_unpin_pages }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vfio_unpin_pages" title='vfio_unpin_pages' data-ref="vfio_unpin_pages"><a class="ref fn" href="#vfio_unpin_pages" title='vfio_unpin_pages' data-ref="vfio_unpin_pages"><a class="ref fn" href="#vfio_unpin_pages" title='vfio_unpin_pages' data-ref="vfio_unpin_pages"><a class="ref fn" href="#vfio_unpin_pages" title='vfio_unpin_pages' data-ref="vfio_unpin_pages">vfio_unpin_pages</a></a></a></a>);</td></tr>
<tr><th id="2012">2012</th><td></td></tr>
<tr><th id="2013">2013</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_register_iommu_notifier" title='vfio_register_iommu_notifier' data-type='int vfio_register_iommu_notifier(struct vfio_group * group, unsigned long * events, struct notifier_block * nb)' data-ref="vfio_register_iommu_notifier">vfio_register_iommu_notifier</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col8 decl" id="278group" title='group' data-type='struct vfio_group *' data-ref="278group">group</dfn>,</td></tr>
<tr><th id="2014">2014</th><td>					<em>unsigned</em> <em>long</em> *<dfn class="local col9 decl" id="279events" title='events' data-type='unsigned long *' data-ref="279events">events</dfn>,</td></tr>
<tr><th id="2015">2015</th><td>					<b>struct</b> <a class="type" href="../../include/linux/notifier.h.html#notifier_block" title='notifier_block' data-ref="notifier_block">notifier_block</a> *<dfn class="local col0 decl" id="280nb" title='nb' data-type='struct notifier_block *' data-ref="280nb">nb</dfn>)</td></tr>
<tr><th id="2016">2016</th><td>{</td></tr>
<tr><th id="2017">2017</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col1 decl" id="281container" title='container' data-type='struct vfio_container *' data-ref="281container">container</dfn>;</td></tr>
<tr><th id="2018">2018</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col2 decl" id="282driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="282driver">driver</dfn>;</td></tr>
<tr><th id="2019">2019</th><td>	<em>int</em> <dfn class="local col3 decl" id="283ret" title='ret' data-type='int' data-ref="283ret">ret</dfn>;</td></tr>
<tr><th id="2020">2020</th><td></td></tr>
<tr><th id="2021">2021</th><td>	<a class="local col3 ref" href="#283ret" title='ret' data-ref="283ret">ret</a> = <a class="tu ref fn" href="#vfio_group_add_container_user" title='vfio_group_add_container_user' data-use='c' data-ref="vfio_group_add_container_user">vfio_group_add_container_user</a>(<a class="local col8 ref" href="#278group" title='group' data-ref="278group">group</a>);</td></tr>
<tr><th id="2022">2022</th><td>	<b>if</b> (<a class="local col3 ref" href="#283ret" title='ret' data-ref="283ret">ret</a>)</td></tr>
<tr><th id="2023">2023</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2024">2024</th><td></td></tr>
<tr><th id="2025">2025</th><td>	<a class="local col1 ref" href="#281container" title='container' data-ref="281container">container</a> = <a class="local col8 ref" href="#278group" title='group' data-ref="278group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a>;</td></tr>
<tr><th id="2026">2026</th><td>	<a class="local col2 ref" href="#282driver" title='driver' data-ref="282driver">driver</a> = <a class="local col1 ref" href="#281container" title='container' data-ref="281container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a>;</td></tr>
<tr><th id="2027">2027</th><td>	<b>if</b> (<a class="macro" href="../../include/linux/compiler.h.html#76" title="__builtin_expect(!!(driver &amp;&amp; driver-&gt;ops-&gt;register_notifier), 1)" data-ref="_M/likely">likely</a>(<a class="local col2 ref" href="#282driver" title='driver' data-ref="282driver">driver</a> &amp;&amp; <a class="local col2 ref" href="#282driver" title='driver' data-ref="282driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::register_notifier" title='vfio_iommu_driver_ops::register_notifier' data-ref="vfio_iommu_driver_ops::register_notifier">register_notifier</a>))</td></tr>
<tr><th id="2028">2028</th><td>		<a class="local col3 ref" href="#283ret" title='ret' data-ref="283ret">ret</a> = <a class="local col2 ref" href="#282driver" title='driver' data-ref="282driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::register_notifier" title='vfio_iommu_driver_ops::register_notifier' data-ref="vfio_iommu_driver_ops::register_notifier">register_notifier</a>(<a class="local col1 ref" href="#281container" title='container' data-ref="281container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='r' data-ref="vfio_container::iommu_data">iommu_data</a>,</td></tr>
<tr><th id="2029">2029</th><td>						     <a class="local col9 ref" href="#279events" title='events' data-ref="279events">events</a>, <a class="local col0 ref" href="#280nb" title='nb' data-ref="280nb">nb</a>);</td></tr>
<tr><th id="2030">2030</th><td>	<b>else</b></td></tr>
<tr><th id="2031">2031</th><td>		<a class="local col3 ref" href="#283ret" title='ret' data-ref="283ret">ret</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#29" title="25" data-ref="_M/ENOTTY">ENOTTY</a>;</td></tr>
<tr><th id="2032">2032</th><td></td></tr>
<tr><th id="2033">2033</th><td>	<a class="tu ref fn" href="#vfio_group_try_dissolve_container" title='vfio_group_try_dissolve_container' data-use='c' data-ref="vfio_group_try_dissolve_container">vfio_group_try_dissolve_container</a>(<a class="local col8 ref" href="#278group" title='group' data-ref="278group">group</a>);</td></tr>
<tr><th id="2034">2034</th><td></td></tr>
<tr><th id="2035">2035</th><td>	<b>return</b> <a class="local col3 ref" href="#283ret" title='ret' data-ref="283ret">ret</a>;</td></tr>
<tr><th id="2036">2036</th><td>}</td></tr>
<tr><th id="2037">2037</th><td></td></tr>
<tr><th id="2038">2038</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_unregister_iommu_notifier" title='vfio_unregister_iommu_notifier' data-type='int vfio_unregister_iommu_notifier(struct vfio_group * group, struct notifier_block * nb)' data-ref="vfio_unregister_iommu_notifier">vfio_unregister_iommu_notifier</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col4 decl" id="284group" title='group' data-type='struct vfio_group *' data-ref="284group">group</dfn>,</td></tr>
<tr><th id="2039">2039</th><td>					  <b>struct</b> <a class="type" href="../../include/linux/notifier.h.html#notifier_block" title='notifier_block' data-ref="notifier_block">notifier_block</a> *<dfn class="local col5 decl" id="285nb" title='nb' data-type='struct notifier_block *' data-ref="285nb">nb</dfn>)</td></tr>
<tr><th id="2040">2040</th><td>{</td></tr>
<tr><th id="2041">2041</th><td>	<b>struct</b> <a class="type" href="#vfio_container" title='vfio_container' data-ref="vfio_container">vfio_container</a> *<dfn class="local col6 decl" id="286container" title='container' data-type='struct vfio_container *' data-ref="286container">container</dfn>;</td></tr>
<tr><th id="2042">2042</th><td>	<b>struct</b> <a class="type" href="#vfio_iommu_driver" title='vfio_iommu_driver' data-ref="vfio_iommu_driver">vfio_iommu_driver</a> *<dfn class="local col7 decl" id="287driver" title='driver' data-type='struct vfio_iommu_driver *' data-ref="287driver">driver</dfn>;</td></tr>
<tr><th id="2043">2043</th><td>	<em>int</em> <dfn class="local col8 decl" id="288ret" title='ret' data-type='int' data-ref="288ret">ret</dfn>;</td></tr>
<tr><th id="2044">2044</th><td></td></tr>
<tr><th id="2045">2045</th><td>	<a class="local col8 ref" href="#288ret" title='ret' data-ref="288ret">ret</a> = <a class="tu ref fn" href="#vfio_group_add_container_user" title='vfio_group_add_container_user' data-use='c' data-ref="vfio_group_add_container_user">vfio_group_add_container_user</a>(<a class="local col4 ref" href="#284group" title='group' data-ref="284group">group</a>);</td></tr>
<tr><th id="2046">2046</th><td>	<b>if</b> (<a class="local col8 ref" href="#288ret" title='ret' data-ref="288ret">ret</a>)</td></tr>
<tr><th id="2047">2047</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2048">2048</th><td></td></tr>
<tr><th id="2049">2049</th><td>	<a class="local col6 ref" href="#286container" title='container' data-ref="286container">container</a> = <a class="local col4 ref" href="#284group" title='group' data-ref="284group">group</a>-&gt;<a class="ref field" href="#vfio_group::container" title='vfio_group::container' data-ref="vfio_group::container">container</a>;</td></tr>
<tr><th id="2050">2050</th><td>	<a class="local col7 ref" href="#287driver" title='driver' data-ref="287driver">driver</a> = <a class="local col6 ref" href="#286container" title='container' data-ref="286container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_driver" title='vfio_container::iommu_driver' data-use='r' data-ref="vfio_container::iommu_driver">iommu_driver</a>;</td></tr>
<tr><th id="2051">2051</th><td>	<b>if</b> (<a class="macro" href="../../include/linux/compiler.h.html#76" title="__builtin_expect(!!(driver &amp;&amp; driver-&gt;ops-&gt;unregister_notifier), 1)" data-ref="_M/likely">likely</a>(<a class="local col7 ref" href="#287driver" title='driver' data-ref="287driver">driver</a> &amp;&amp; <a class="local col7 ref" href="#287driver" title='driver' data-ref="287driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::unregister_notifier" title='vfio_iommu_driver_ops::unregister_notifier' data-ref="vfio_iommu_driver_ops::unregister_notifier">unregister_notifier</a>))</td></tr>
<tr><th id="2052">2052</th><td>		<a class="local col8 ref" href="#288ret" title='ret' data-ref="288ret">ret</a> = <a class="local col7 ref" href="#287driver" title='driver' data-ref="287driver">driver</a>-&gt;<a class="tu ref field" href="#vfio_iommu_driver::ops" title='vfio_iommu_driver::ops' data-use='r' data-ref="vfio_iommu_driver::ops">ops</a>-&gt;<a class="ref field" href="../../include/linux/vfio.h.html#vfio_iommu_driver_ops::unregister_notifier" title='vfio_iommu_driver_ops::unregister_notifier' data-ref="vfio_iommu_driver_ops::unregister_notifier">unregister_notifier</a>(<a class="local col6 ref" href="#286container" title='container' data-ref="286container">container</a>-&gt;<a class="tu ref field" href="#vfio_container::iommu_data" title='vfio_container::iommu_data' data-use='r' data-ref="vfio_container::iommu_data">iommu_data</a>,</td></tr>
<tr><th id="2053">2053</th><td>						       <a class="local col5 ref" href="#285nb" title='nb' data-ref="285nb">nb</a>);</td></tr>
<tr><th id="2054">2054</th><td>	<b>else</b></td></tr>
<tr><th id="2055">2055</th><td>		<a class="local col8 ref" href="#288ret" title='ret' data-ref="288ret">ret</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#29" title="25" data-ref="_M/ENOTTY">ENOTTY</a>;</td></tr>
<tr><th id="2056">2056</th><td></td></tr>
<tr><th id="2057">2057</th><td>	<a class="tu ref fn" href="#vfio_group_try_dissolve_container" title='vfio_group_try_dissolve_container' data-use='c' data-ref="vfio_group_try_dissolve_container">vfio_group_try_dissolve_container</a>(<a class="local col4 ref" href="#284group" title='group' data-ref="284group">group</a>);</td></tr>
<tr><th id="2058">2058</th><td></td></tr>
<tr><th id="2059">2059</th><td>	<b>return</b> <a class="local col8 ref" href="#288ret" title='ret' data-ref="288ret">ret</a>;</td></tr>
<tr><th id="2060">2060</th><td>}</td></tr>
<tr><th id="2061">2061</th><td></td></tr>
<tr><th id="2062">2062</th><td><em>void</em> <dfn class="decl def fn" id="vfio_group_set_kvm" title='vfio_group_set_kvm' data-ref="vfio_group_set_kvm">vfio_group_set_kvm</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col9 decl" id="289group" title='group' data-type='struct vfio_group *' data-ref="289group">group</dfn>, <b>struct</b> <a class="type" href="../../include/linux/vfio.h.html#kvm" title='kvm' data-ref="kvm">kvm</a> *<dfn class="local col0 decl" id="290kvm" title='kvm' data-type='struct kvm *' data-ref="290kvm">kvm</dfn>)</td></tr>
<tr><th id="2063">2063</th><td>{</td></tr>
<tr><th id="2064">2064</th><td>	<a class="local col9 ref" href="#289group" title='group' data-ref="289group">group</a>-&gt;<a class="ref field" href="#vfio_group::kvm" title='vfio_group::kvm' data-ref="vfio_group::kvm">kvm</a> = <a class="local col0 ref" href="#290kvm" title='kvm' data-ref="290kvm">kvm</a>;</td></tr>
<tr><th id="2065">2065</th><td>	<a class="ref fn" href="../../include/linux/notifier.h.html#blocking_notifier_call_chain" title='blocking_notifier_call_chain' data-ref="blocking_notifier_call_chain">blocking_notifier_call_chain</a>(&amp;<a class="local col9 ref" href="#289group" title='group' data-ref="289group">group</a>-&gt;<a class="ref field" href="#vfio_group::notifier" title='vfio_group::notifier' data-ref="vfio_group::notifier">notifier</a>,</td></tr>
<tr><th id="2066">2066</th><td>				<a class="macro" href="../../include/linux/vfio.h.html#123" title="(1UL &lt;&lt; (0))" data-ref="_M/VFIO_GROUP_NOTIFY_SET_KVM">VFIO_GROUP_NOTIFY_SET_KVM</a>, <a class="local col0 ref" href="#290kvm" title='kvm' data-ref="290kvm">kvm</a>);</td></tr>
<tr><th id="2067">2067</th><td>}</td></tr>
<tr><th id="2068">2068</th><td><a class="macro" href="../../include/linux/export.h.html#100" title="extern typeof(vfio_group_set_kvm) vfio_group_set_kvm; static const char __kstrtab_vfio_group_set_kvm[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_group_set_kvm&quot;; static const struct kernel_symbol __ksymtab_vfio_group_set_kvm __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;vfio_group_set_kvm&quot;), used)) = { (unsigned long)&amp;vfio_group_set_kvm, __kstrtab_vfio_group_set_kvm }" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#vfio_group_set_kvm" title='vfio_group_set_kvm' data-ref="vfio_group_set_kvm"><a class="ref fn" href="#vfio_group_set_kvm" title='vfio_group_set_kvm' data-ref="vfio_group_set_kvm"><a class="ref fn" href="#vfio_group_set_kvm" title='vfio_group_set_kvm' data-ref="vfio_group_set_kvm"><a class="ref fn" href="#vfio_group_set_kvm" title='vfio_group_set_kvm' data-ref="vfio_group_set_kvm">vfio_group_set_kvm</a></a></a></a>);</td></tr>
<tr><th id="2069">2069</th><td></td></tr>
<tr><th id="2070">2070</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_register_group_notifier" title='vfio_register_group_notifier' data-type='int vfio_register_group_notifier(struct vfio_group * group, unsigned long * events, struct notifier_block * nb)' data-ref="vfio_register_group_notifier">vfio_register_group_notifier</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col1 decl" id="291group" title='group' data-type='struct vfio_group *' data-ref="291group">group</dfn>,</td></tr>
<tr><th id="2071">2071</th><td>					<em>unsigned</em> <em>long</em> *<dfn class="local col2 decl" id="292events" title='events' data-type='unsigned long *' data-ref="292events">events</dfn>,</td></tr>
<tr><th id="2072">2072</th><td>					<b>struct</b> <a class="type" href="../../include/linux/notifier.h.html#notifier_block" title='notifier_block' data-ref="notifier_block">notifier_block</a> *<dfn class="local col3 decl" id="293nb" title='nb' data-type='struct notifier_block *' data-ref="293nb">nb</dfn>)</td></tr>
<tr><th id="2073">2073</th><td>{</td></tr>
<tr><th id="2074">2074</th><td>	<em>int</em> <dfn class="local col4 decl" id="294ret" title='ret' data-type='int' data-ref="294ret">ret</dfn>;</td></tr>
<tr><th id="2075">2075</th><td>	<a class="typedef" href="../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="local col5 decl" id="295set_kvm" title='set_kvm' data-type='bool' data-ref="295set_kvm">set_kvm</dfn> = <a class="enum" href="../../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>;</td></tr>
<tr><th id="2076">2076</th><td></td></tr>
<tr><th id="2077">2077</th><td>	<b>if</b> (*<a class="local col2 ref" href="#292events" title='events' data-ref="292events">events</a> &amp; <a class="macro" href="../../include/linux/vfio.h.html#123" title="(1UL &lt;&lt; (0))" data-ref="_M/VFIO_GROUP_NOTIFY_SET_KVM">VFIO_GROUP_NOTIFY_SET_KVM</a>)</td></tr>
<tr><th id="2078">2078</th><td>		<a class="local col5 ref" href="#295set_kvm" title='set_kvm' data-ref="295set_kvm">set_kvm</a> = <a class="enum" href="../../include/linux/stddef.h.html#true" title='true' data-ref="true">true</a>;</td></tr>
<tr><th id="2079">2079</th><td></td></tr>
<tr><th id="2080">2080</th><td>	<i>/* clear known events */</i></td></tr>
<tr><th id="2081">2081</th><td>	*<a class="local col2 ref" href="#292events" title='events' data-ref="292events">events</a> &amp;= ~<a class="macro" href="../../include/linux/vfio.h.html#123" title="(1UL &lt;&lt; (0))" data-ref="_M/VFIO_GROUP_NOTIFY_SET_KVM">VFIO_GROUP_NOTIFY_SET_KVM</a>;</td></tr>
<tr><th id="2082">2082</th><td></td></tr>
<tr><th id="2083">2083</th><td>	<i>/* refuse to continue if still events remaining */</i></td></tr>
<tr><th id="2084">2084</th><td>	<b>if</b> (*<a class="local col2 ref" href="#292events" title='events' data-ref="292events">events</a>)</td></tr>
<tr><th id="2085">2085</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2086">2086</th><td></td></tr>
<tr><th id="2087">2087</th><td>	<a class="local col4 ref" href="#294ret" title='ret' data-ref="294ret">ret</a> = <a class="tu ref fn" href="#vfio_group_add_container_user" title='vfio_group_add_container_user' data-use='c' data-ref="vfio_group_add_container_user">vfio_group_add_container_user</a>(<a class="local col1 ref" href="#291group" title='group' data-ref="291group">group</a>);</td></tr>
<tr><th id="2088">2088</th><td>	<b>if</b> (<a class="local col4 ref" href="#294ret" title='ret' data-ref="294ret">ret</a>)</td></tr>
<tr><th id="2089">2089</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2090">2090</th><td></td></tr>
<tr><th id="2091">2091</th><td>	<a class="local col4 ref" href="#294ret" title='ret' data-ref="294ret">ret</a> = <a class="ref fn" href="../../include/linux/notifier.h.html#blocking_notifier_chain_register" title='blocking_notifier_chain_register' data-ref="blocking_notifier_chain_register">blocking_notifier_chain_register</a>(&amp;<a class="local col1 ref" href="#291group" title='group' data-ref="291group">group</a>-&gt;<a class="ref field" href="#vfio_group::notifier" title='vfio_group::notifier' data-ref="vfio_group::notifier">notifier</a>, <a class="local col3 ref" href="#293nb" title='nb' data-ref="293nb">nb</a>);</td></tr>
<tr><th id="2092">2092</th><td></td></tr>
<tr><th id="2093">2093</th><td>	<i>/*</i></td></tr>
<tr><th id="2094">2094</th><td><i>	 * The attaching of kvm and vfio_group might already happen, so</i></td></tr>
<tr><th id="2095">2095</th><td><i>	 * here we replay once upon registration.</i></td></tr>
<tr><th id="2096">2096</th><td><i>	 */</i></td></tr>
<tr><th id="2097">2097</th><td>	<b>if</b> (!<a class="local col4 ref" href="#294ret" title='ret' data-ref="294ret">ret</a> &amp;&amp; <a class="local col5 ref" href="#295set_kvm" title='set_kvm' data-ref="295set_kvm">set_kvm</a> &amp;&amp; <a class="local col1 ref" href="#291group" title='group' data-ref="291group">group</a>-&gt;<a class="ref field" href="#vfio_group::kvm" title='vfio_group::kvm' data-ref="vfio_group::kvm">kvm</a>)</td></tr>
<tr><th id="2098">2098</th><td>		<a class="ref fn" href="../../include/linux/notifier.h.html#blocking_notifier_call_chain" title='blocking_notifier_call_chain' data-ref="blocking_notifier_call_chain">blocking_notifier_call_chain</a>(&amp;<a class="local col1 ref" href="#291group" title='group' data-ref="291group">group</a>-&gt;<a class="ref field" href="#vfio_group::notifier" title='vfio_group::notifier' data-ref="vfio_group::notifier">notifier</a>,</td></tr>
<tr><th id="2099">2099</th><td>					<a class="macro" href="../../include/linux/vfio.h.html#123" title="(1UL &lt;&lt; (0))" data-ref="_M/VFIO_GROUP_NOTIFY_SET_KVM">VFIO_GROUP_NOTIFY_SET_KVM</a>, <a class="local col1 ref" href="#291group" title='group' data-ref="291group">group</a>-&gt;<a class="ref field" href="#vfio_group::kvm" title='vfio_group::kvm' data-ref="vfio_group::kvm">kvm</a>);</td></tr>
<tr><th id="2100">2100</th><td></td></tr>
<tr><th id="2101">2101</th><td>	<a class="tu ref fn" href="#vfio_group_try_dissolve_container" title='vfio_group_try_dissolve_container' data-use='c' data-ref="vfio_group_try_dissolve_container">vfio_group_try_dissolve_container</a>(<a class="local col1 ref" href="#291group" title='group' data-ref="291group">group</a>);</td></tr>
<tr><th id="2102">2102</th><td></td></tr>
<tr><th id="2103">2103</th><td>	<b>return</b> <a class="local col4 ref" href="#294ret" title='ret' data-ref="294ret">ret</a>;</td></tr>
<tr><th id="2104">2104</th><td>}</td></tr>
<tr><th id="2105">2105</th><td></td></tr>
<tr><th id="2106">2106</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vfio_unregister_group_notifier" title='vfio_unregister_group_notifier' data-type='int vfio_unregister_group_notifier(struct vfio_group * group, struct notifier_block * nb)' data-ref="vfio_unregister_group_notifier">vfio_unregister_group_notifier</dfn>(<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col6 decl" id="296group" title='group' data-type='struct vfio_group *' data-ref="296group">group</dfn>,</td></tr>
<tr><th id="2107">2107</th><td>					 <b>struct</b> <a class="type" href="../../include/linux/notifier.h.html#notifier_block" title='notifier_block' data-ref="notifier_block">notifier_block</a> *<dfn class="local col7 decl" id="297nb" title='nb' data-type='struct notifier_block *' data-ref="297nb">nb</dfn>)</td></tr>
<tr><th id="2108">2108</th><td>{</td></tr>
<tr><th id="2109">2109</th><td>	<em>int</em> <dfn class="local col8 decl" id="298ret" title='ret' data-type='int' data-ref="298ret">ret</dfn>;</td></tr>
<tr><th id="2110">2110</th><td></td></tr>
<tr><th id="2111">2111</th><td>	<a class="local col8 ref" href="#298ret" title='ret' data-ref="298ret">ret</a> = <a class="tu ref fn" href="#vfio_group_add_container_user" title='vfio_group_add_container_user' data-use='c' data-ref="vfio_group_add_container_user">vfio_group_add_container_user</a>(<a class="local col6 ref" href="#296group" title='group' data-ref="296group">group</a>);</td></tr>
<tr><th id="2112">2112</th><td>	<b>if</b> (<a class="local col8 ref" href="#298ret" title='ret' data-ref="298ret">ret</a>)</td></tr>
<tr><th id="2113">2113</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2114">2114</th><td></td></tr>
<tr><th id="2115">2115</th><td>	<a class="local col8 ref" href="#298ret" title='ret' data-ref="298ret">ret</a> = <a class="ref fn" href="../../include/linux/notifier.h.html#blocking_notifier_chain_unregister" title='blocking_notifier_chain_unregister' data-ref="blocking_notifier_chain_unregister">blocking_notifier_chain_unregister</a>(&amp;<a class="local col6 ref" href="#296group" title='group' data-ref="296group">group</a>-&gt;<a class="ref field" href="#vfio_group::notifier" title='vfio_group::notifier' data-ref="vfio_group::notifier">notifier</a>, <a class="local col7 ref" href="#297nb" title='nb' data-ref="297nb">nb</a>);</td></tr>
<tr><th id="2116">2116</th><td></td></tr>
<tr><th id="2117">2117</th><td>	<a class="tu ref fn" href="#vfio_group_try_dissolve_container" title='vfio_group_try_dissolve_container' data-use='c' data-ref="vfio_group_try_dissolve_container">vfio_group_try_dissolve_container</a>(<a class="local col6 ref" href="#296group" title='group' data-ref="296group">group</a>);</td></tr>
<tr><th id="2118">2118</th><td></td></tr>
<tr><th id="2119">2119</th><td>	<b>return</b> <a class="local col8 ref" href="#298ret" title='ret' data-ref="298ret">ret</a>;</td></tr>
<tr><th id="2120">2120</th><td>}</td></tr>
<tr><th id="2121">2121</th><td></td></tr>
<tr><th id="2122">2122</th><td><em>int</em> <dfn class="decl def fn" id="vfio_register_notifier" title='vfio_register_notifier' data-ref="vfio_register_notifier">vfio_register_notifier</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col9 decl" id="299dev" title='dev' data-type='struct device *' data-ref="299dev">dev</dfn>, <b>enum</b> <a class="type" href="../../include/linux/vfio.h.html#vfio_notify_type" title='vfio_notify_type' data-ref="vfio_notify_type">vfio_notify_type</a> <dfn class="local col0 decl" id="300type" title='type' data-type='enum vfio_notify_type' data-ref="300type">type</dfn>,</td></tr>
<tr><th id="2123">2123</th><td>			   <em>unsigned</em> <em>long</em> *<dfn class="local col1 decl" id="301events" title='events' data-type='unsigned long *' data-ref="301events">events</dfn>, <b>struct</b> <a class="type" href="../../include/linux/notifier.h.html#notifier_block" title='notifier_block' data-ref="notifier_block">notifier_block</a> *<dfn class="local col2 decl" id="302nb" title='nb' data-type='struct notifier_block *' data-ref="302nb">nb</dfn>)</td></tr>
<tr><th id="2124">2124</th><td>{</td></tr>
<tr><th id="2125">2125</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col3 decl" id="303group" title='group' data-type='struct vfio_group *' data-ref="303group">group</dfn>;</td></tr>
<tr><th id="2126">2126</th><td>	<em>int</em> <dfn class="local col4 decl" id="304ret" title='ret' data-type='int' data-ref="304ret">ret</dfn>;</td></tr>
<tr><th id="2127">2127</th><td></td></tr>
<tr><th id="2128">2128</th><td>	<b>if</b> (!<a class="local col9 ref" href="#299dev" title='dev' data-ref="299dev">dev</a> || !<a class="local col2 ref" href="#302nb" title='nb' data-ref="302nb">nb</a> || !<a class="local col1 ref" href="#301events" title='events' data-ref="301events">events</a> || (*<a class="local col1 ref" href="#301events" title='events' data-ref="301events">events</a> == <var>0</var>))</td></tr>
<tr><th id="2129">2129</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2130">2130</th><td></td></tr>
<tr><th id="2131">2131</th><td>	<a class="local col3 ref" href="#303group" title='group' data-ref="303group">group</a> = <a class="tu ref fn" href="#vfio_group_get_from_dev" title='vfio_group_get_from_dev' data-use='c' data-ref="vfio_group_get_from_dev">vfio_group_get_from_dev</a>(<a class="local col9 ref" href="#299dev" title='dev' data-ref="299dev">dev</a>);</td></tr>
<tr><th id="2132">2132</th><td>	<b>if</b> (!<a class="local col3 ref" href="#303group" title='group' data-ref="303group">group</a>)</td></tr>
<tr><th id="2133">2133</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#23" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="2134">2134</th><td></td></tr>
<tr><th id="2135">2135</th><td>	<b>switch</b> (<a class="local col0 ref" href="#300type" title='type' data-ref="300type">type</a>) {</td></tr>
<tr><th id="2136">2136</th><td>	<b>case</b> <a class="enum" href="../../include/linux/vfio.h.html#VFIO_IOMMU_NOTIFY" title='VFIO_IOMMU_NOTIFY' data-ref="VFIO_IOMMU_NOTIFY">VFIO_IOMMU_NOTIFY</a>:</td></tr>
<tr><th id="2137">2137</th><td>		<a class="local col4 ref" href="#304ret" title='ret' data-ref="304ret">ret</a> = <a class="tu ref fn" href="#vfio_register_iommu_notifier" title='vfio_register_iommu_notifier' data-use='c' data-ref="vfio_register_iommu_notifier">vfio_register_iommu_notifier</a>(<a class="local col3 ref" href="#303group" title='group' data-ref="303group">group</a>, <a class="local col1 ref" href="#301events" title='events' data-ref="301events">events</a>, <a class="local col2 ref" href="#302nb" title='nb' data-ref="302nb">nb</a>);</td></tr>
<tr><th id="2138">2138</th><td>		<b>break</b>;</td></tr>
<tr><th id="2139">2139</th><td>	<b>case</b> <a class="enum" href="../../include/linux/vfio.h.html#VFIO_GROUP_NOTIFY" title='VFIO_GROUP_NOTIFY' data-ref="VFIO_GROUP_NOTIFY">VFIO_GROUP_NOTIFY</a>:</td></tr>
<tr><th id="2140">2140</th><td>		<a class="local col4 ref" href="#304ret" title='ret' data-ref="304ret">ret</a> = <a class="tu ref fn" href="#vfio_register_group_notifier" title='vfio_register_group_notifier' data-use='c' data-ref="vfio_register_group_notifier">vfio_register_group_notifier</a>(<a class="local col3 ref" href="#303group" title='group' data-ref="303group">group</a>, <a class="local col1 ref" href="#301events" title='events' data-ref="301events">events</a>, <a class="local col2 ref" href="#302nb" title='nb' data-ref="302nb">nb</a>);</td></tr>
<tr><th id="2141">2141</th><td>		<b>break</b>;</td></tr>
<tr><th id="2142">2142</th><td>	<b>default</b>:</td></tr>
<tr><th id="2143">2143</th><td>		<a class="local col4 ref" href="#304ret" title='ret' data-ref="304ret">ret</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2144">2144</th><td>	}</td></tr>
<tr><th id="2145">2145</th><td></td></tr>
<tr><th id="2146">2146</th><td>	<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col3 ref" href="#303group" title='group' data-ref="303group">group</a>);</td></tr>
<tr><th id="2147">2147</th><td>	<b>return</b> <a class="local col4 ref" href="#304ret" title='ret' data-ref="304ret">ret</a>;</td></tr>
<tr><th id="2148">2148</th><td>}</td></tr>
<tr><th id="2149">2149</th><td><a class="macro" href="../../include/linux/export.h.html#97" title="extern typeof(vfio_register_notifier) vfio_register_notifier; static const char __kstrtab_vfio_register_notifier[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_register_notifier&quot;; static const struct kernel_symbol __ksymtab_vfio_register_notifier __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vfio_register_notifier&quot;), used)) = { (unsigned long)&amp;vfio_register_notifier, __kstrtab_vfio_register_notifier }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vfio_register_notifier" title='vfio_register_notifier' data-ref="vfio_register_notifier"><a class="ref fn" href="#vfio_register_notifier" title='vfio_register_notifier' data-ref="vfio_register_notifier"><a class="ref fn" href="#vfio_register_notifier" title='vfio_register_notifier' data-ref="vfio_register_notifier"><a class="ref fn" href="#vfio_register_notifier" title='vfio_register_notifier' data-ref="vfio_register_notifier">vfio_register_notifier</a></a></a></a>);</td></tr>
<tr><th id="2150">2150</th><td></td></tr>
<tr><th id="2151">2151</th><td><em>int</em> <dfn class="decl def fn" id="vfio_unregister_notifier" title='vfio_unregister_notifier' data-ref="vfio_unregister_notifier">vfio_unregister_notifier</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col5 decl" id="305dev" title='dev' data-type='struct device *' data-ref="305dev">dev</dfn>, <b>enum</b> <a class="type" href="../../include/linux/vfio.h.html#vfio_notify_type" title='vfio_notify_type' data-ref="vfio_notify_type">vfio_notify_type</a> <dfn class="local col6 decl" id="306type" title='type' data-type='enum vfio_notify_type' data-ref="306type">type</dfn>,</td></tr>
<tr><th id="2152">2152</th><td>			     <b>struct</b> <a class="type" href="../../include/linux/notifier.h.html#notifier_block" title='notifier_block' data-ref="notifier_block">notifier_block</a> *<dfn class="local col7 decl" id="307nb" title='nb' data-type='struct notifier_block *' data-ref="307nb">nb</dfn>)</td></tr>
<tr><th id="2153">2153</th><td>{</td></tr>
<tr><th id="2154">2154</th><td>	<b>struct</b> <a class="type" href="#vfio_group" title='vfio_group' data-ref="vfio_group">vfio_group</a> *<dfn class="local col8 decl" id="308group" title='group' data-type='struct vfio_group *' data-ref="308group">group</dfn>;</td></tr>
<tr><th id="2155">2155</th><td>	<em>int</em> <dfn class="local col9 decl" id="309ret" title='ret' data-type='int' data-ref="309ret">ret</dfn>;</td></tr>
<tr><th id="2156">2156</th><td></td></tr>
<tr><th id="2157">2157</th><td>	<b>if</b> (!<a class="local col5 ref" href="#305dev" title='dev' data-ref="305dev">dev</a> || !<a class="local col7 ref" href="#307nb" title='nb' data-ref="307nb">nb</a>)</td></tr>
<tr><th id="2158">2158</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2159">2159</th><td></td></tr>
<tr><th id="2160">2160</th><td>	<a class="local col8 ref" href="#308group" title='group' data-ref="308group">group</a> = <a class="tu ref fn" href="#vfio_group_get_from_dev" title='vfio_group_get_from_dev' data-use='c' data-ref="vfio_group_get_from_dev">vfio_group_get_from_dev</a>(<a class="local col5 ref" href="#305dev" title='dev' data-ref="305dev">dev</a>);</td></tr>
<tr><th id="2161">2161</th><td>	<b>if</b> (!<a class="local col8 ref" href="#308group" title='group' data-ref="308group">group</a>)</td></tr>
<tr><th id="2162">2162</th><td>		<b>return</b> -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#23" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="2163">2163</th><td></td></tr>
<tr><th id="2164">2164</th><td>	<b>switch</b> (<a class="local col6 ref" href="#306type" title='type' data-ref="306type">type</a>) {</td></tr>
<tr><th id="2165">2165</th><td>	<b>case</b> <a class="enum" href="../../include/linux/vfio.h.html#VFIO_IOMMU_NOTIFY" title='VFIO_IOMMU_NOTIFY' data-ref="VFIO_IOMMU_NOTIFY">VFIO_IOMMU_NOTIFY</a>:</td></tr>
<tr><th id="2166">2166</th><td>		<a class="local col9 ref" href="#309ret" title='ret' data-ref="309ret">ret</a> = <a class="tu ref fn" href="#vfio_unregister_iommu_notifier" title='vfio_unregister_iommu_notifier' data-use='c' data-ref="vfio_unregister_iommu_notifier">vfio_unregister_iommu_notifier</a>(<a class="local col8 ref" href="#308group" title='group' data-ref="308group">group</a>, <a class="local col7 ref" href="#307nb" title='nb' data-ref="307nb">nb</a>);</td></tr>
<tr><th id="2167">2167</th><td>		<b>break</b>;</td></tr>
<tr><th id="2168">2168</th><td>	<b>case</b> <a class="enum" href="../../include/linux/vfio.h.html#VFIO_GROUP_NOTIFY" title='VFIO_GROUP_NOTIFY' data-ref="VFIO_GROUP_NOTIFY">VFIO_GROUP_NOTIFY</a>:</td></tr>
<tr><th id="2169">2169</th><td>		<a class="local col9 ref" href="#309ret" title='ret' data-ref="309ret">ret</a> = <a class="tu ref fn" href="#vfio_unregister_group_notifier" title='vfio_unregister_group_notifier' data-use='c' data-ref="vfio_unregister_group_notifier">vfio_unregister_group_notifier</a>(<a class="local col8 ref" href="#308group" title='group' data-ref="308group">group</a>, <a class="local col7 ref" href="#307nb" title='nb' data-ref="307nb">nb</a>);</td></tr>
<tr><th id="2170">2170</th><td>		<b>break</b>;</td></tr>
<tr><th id="2171">2171</th><td>	<b>default</b>:</td></tr>
<tr><th id="2172">2172</th><td>		<a class="local col9 ref" href="#309ret" title='ret' data-ref="309ret">ret</a> = -<a class="macro" href="../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="2173">2173</th><td>	}</td></tr>
<tr><th id="2174">2174</th><td></td></tr>
<tr><th id="2175">2175</th><td>	<a class="tu ref fn" href="#vfio_group_put" title='vfio_group_put' data-use='c' data-ref="vfio_group_put">vfio_group_put</a>(<a class="local col8 ref" href="#308group" title='group' data-ref="308group">group</a>);</td></tr>
<tr><th id="2176">2176</th><td>	<b>return</b> <a class="local col9 ref" href="#309ret" title='ret' data-ref="309ret">ret</a>;</td></tr>
<tr><th id="2177">2177</th><td>}</td></tr>
<tr><th id="2178">2178</th><td><a class="macro" href="../../include/linux/export.h.html#97" title="extern typeof(vfio_unregister_notifier) vfio_unregister_notifier; static const char __kstrtab_vfio_unregister_notifier[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vfio_unregister_notifier&quot;; static const struct kernel_symbol __ksymtab_vfio_unregister_notifier __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vfio_unregister_notifier&quot;), used)) = { (unsigned long)&amp;vfio_unregister_notifier, __kstrtab_vfio_unregister_notifier }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vfio_unregister_notifier" title='vfio_unregister_notifier' data-ref="vfio_unregister_notifier"><a class="ref fn" href="#vfio_unregister_notifier" title='vfio_unregister_notifier' data-ref="vfio_unregister_notifier"><a class="ref fn" href="#vfio_unregister_notifier" title='vfio_unregister_notifier' data-ref="vfio_unregister_notifier"><a class="ref fn" href="#vfio_unregister_notifier" title='vfio_unregister_notifier' data-ref="vfio_unregister_notifier">vfio_unregister_notifier</a></a></a></a>);</td></tr>
<tr><th id="2179">2179</th><td></td></tr>
<tr><th id="2180">2180</th><td><i class="doc" data-doc="vfio_devnode">/**</i></td></tr>
<tr><th id="2181">2181</th><td><i class="doc" data-doc="vfio_devnode"> * Module/class support</i></td></tr>
<tr><th id="2182">2182</th><td><i class="doc" data-doc="vfio_devnode"> */</i></td></tr>
<tr><th id="2183">2183</th><td><em>static</em> <em>char</em> *<dfn class="tu decl def fn" id="vfio_devnode" title='vfio_devnode' data-type='char * vfio_devnode(struct device * dev, umode_t * mode)' data-ref="vfio_devnode">vfio_devnode</dfn>(<b>struct</b> <a class="type" href="../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col0 decl" id="310dev" title='dev' data-type='struct device *' data-ref="310dev">dev</dfn>, <a class="typedef" href="../../include/linux/types.h.html#umode_t" title='umode_t' data-type='unsigned short' data-ref="umode_t">umode_t</a> *<dfn class="local col1 decl" id="311mode" title='mode' data-type='umode_t *' data-ref="311mode">mode</dfn>)</td></tr>
<tr><th id="2184">2184</th><td>{</td></tr>
<tr><th id="2185">2185</th><td>	<b>return</b> <a class="ref fn" href="../../include/linux/kernel.h.html#kasprintf" title='kasprintf' data-ref="kasprintf">kasprintf</a>(<a class="macro" href="../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x200000u|0x400000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>, <q>"vfio/%s"</q>, <a class="ref fn" href="../../include/linux/device.h.html#dev_name" title='dev_name' data-ref="dev_name">dev_name</a>(<a class="local col0 ref" href="#310dev" title='dev' data-ref="310dev">dev</a>));</td></tr>
<tr><th id="2186">2186</th><td>}</td></tr>
<tr><th id="2187">2187</th><td></td></tr>
<tr><th id="2188">2188</th><td><em>static</em> <b>struct</b> <a class="type" href="../../include/linux/miscdevice.h.html#miscdevice" title='miscdevice' data-ref="miscdevice">miscdevice</a> <dfn class="tu decl def" id="vfio_dev" title='vfio_dev' data-type='struct miscdevice' data-ref="vfio_dev">vfio_dev</dfn> = {</td></tr>
<tr><th id="2189">2189</th><td>	.<a class="ref field" href="../../include/linux/miscdevice.h.html#miscdevice::minor" title='miscdevice::minor' data-ref="miscdevice::minor">minor</a> = <a class="macro" href="../../include/linux/miscdevice.h.html#40" title="196" data-ref="_M/VFIO_MINOR">VFIO_MINOR</a>,</td></tr>
<tr><th id="2190">2190</th><td>	.<a class="ref field" href="../../include/linux/miscdevice.h.html#miscdevice::name" title='miscdevice::name' data-ref="miscdevice::name">name</a> = <q>"vfio"</q>,</td></tr>
<tr><th id="2191">2191</th><td>	.<a class="ref field" href="../../include/linux/miscdevice.h.html#miscdevice::fops" title='miscdevice::fops' data-ref="miscdevice::fops">fops</a> = &amp;<a class="tu ref" href="#vfio_fops" title='vfio_fops' data-use='a' data-ref="vfio_fops">vfio_fops</a>,</td></tr>
<tr><th id="2192">2192</th><td>	.<a class="ref field" href="../../include/linux/miscdevice.h.html#miscdevice::nodename" title='miscdevice::nodename' data-ref="miscdevice::nodename">nodename</a> = <q>"vfio/vfio"</q>,</td></tr>
<tr><th id="2193">2193</th><td>	.<a class="ref field" href="../../include/linux/miscdevice.h.html#miscdevice::mode" title='miscdevice::mode' data-ref="miscdevice::mode">mode</a> = <a class="macro" href="../../include/linux/stat.h.html#11" title="(00400|00040|00004)" data-ref="_M/S_IRUGO">S_IRUGO</a> | <a class="macro" href="../../include/linux/stat.h.html#12" title="(00200|00020|00002)" data-ref="_M/S_IWUGO">S_IWUGO</a>,</td></tr>
<tr><th id="2194">2194</th><td>};</td></tr>
<tr><th id="2195">2195</th><td></td></tr>
<tr><th id="2196">2196</th><td><em>static</em> <em>int</em> <a class="macro" href="../../include/linux/init.h.html#50" title="__attribute__ ((__section__(&quot;.init.text&quot;)))" data-ref="_M/__init">__init</a> <dfn class="tu decl def fn" id="vfio_init" title='vfio_init' data-type='int vfio_init()' data-ref="vfio_init">vfio_init</dfn>(<em>void</em>)</td></tr>
<tr><th id="2197">2197</th><td>{</td></tr>
<tr><th id="2198">2198</th><td>	<em>int</em> <dfn class="local col2 decl" id="312ret" title='ret' data-type='int' data-ref="312ret">ret</dfn>;</td></tr>
<tr><th id="2199">2199</th><td></td></tr>
<tr><th id="2200">2200</th><td>	<a class="ref fn" href="../../include/linux/idr.h.html#idr_init" title='idr_init' data-ref="idr_init">idr_init</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_idr" title='vfio::group_idr' data-use='a' data-ref="vfio::group_idr">group_idr</a>);</td></tr>
<tr><th id="2201">2201</th><td>	<a class="macro" href="../../include/linux/mutex.h.html#114" title="do { static struct lock_class_key __key; __mutex_init((&amp;vfio.group_lock), &quot;&amp;vfio.group_lock&quot;, &amp;__key); } while (0)" data-ref="_M/mutex_init">mutex_init</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_lock" title='vfio::group_lock' data-use='a' data-ref="vfio::group_lock">group_lock</a>);</td></tr>
<tr><th id="2202">2202</th><td>	<a class="macro" href="../../include/linux/mutex.h.html#114" title="do { static struct lock_class_key __key; __mutex_init((&amp;vfio.iommu_drivers_lock), &quot;&amp;vfio.iommu_drivers_lock&quot;, &amp;__key); } while (0)" data-ref="_M/mutex_init">mutex_init</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_lock" title='vfio::iommu_drivers_lock' data-use='a' data-ref="vfio::iommu_drivers_lock">iommu_drivers_lock</a>);</td></tr>
<tr><th id="2203">2203</th><td>	<a class="ref fn" href="../../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_list" title='vfio::group_list' data-use='a' data-ref="vfio::group_list">group_list</a>);</td></tr>
<tr><th id="2204">2204</th><td>	<a class="ref fn" href="../../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::iommu_drivers_list" title='vfio::iommu_drivers_list' data-use='a' data-ref="vfio::iommu_drivers_list">iommu_drivers_list</a>);</td></tr>
<tr><th id="2205">2205</th><td>	<a class="macro" href="../../include/linux/wait.h.html#63" title="do { static struct lock_class_key __key; __init_waitqueue_head((&amp;vfio.release_q), &quot;&amp;vfio.release_q&quot;, &amp;__key); } while (0)" data-ref="_M/init_waitqueue_head">init_waitqueue_head</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::release_q" title='vfio::release_q' data-use='a' data-ref="vfio::release_q">release_q</a>);</td></tr>
<tr><th id="2206">2206</th><td></td></tr>
<tr><th id="2207">2207</th><td>	<a class="local col2 ref" href="#312ret" title='ret' data-ref="312ret">ret</a> = <a class="ref fn" href="../../include/linux/miscdevice.h.html#misc_register" title='misc_register' data-ref="misc_register">misc_register</a>(&amp;<a class="tu ref" href="#vfio_dev" title='vfio_dev' data-use='a' data-ref="vfio_dev">vfio_dev</a>);</td></tr>
<tr><th id="2208">2208</th><td>	<b>if</b> (<a class="local col2 ref" href="#312ret" title='ret' data-ref="312ret">ret</a>) {</td></tr>
<tr><th id="2209">2209</th><td>		<a class="macro" href="../../include/linux/printk.h.html#307" title="printk(&quot;\001&quot; &quot;3&quot; &quot;vfio: misc device register failed\n&quot;)" data-ref="_M/pr_err">pr_err</a>(<q>"vfio: misc device register failed\n"</q>);</td></tr>
<tr><th id="2210">2210</th><td>		<b>return</b> <a class="local col2 ref" href="#312ret" title='ret' data-ref="312ret">ret</a>;</td></tr>
<tr><th id="2211">2211</th><td>	}</td></tr>
<tr><th id="2212">2212</th><td></td></tr>
<tr><th id="2213">2213</th><td>	<i>/* /dev/vfio/$GROUP */</i></td></tr>
<tr><th id="2214">2214</th><td>	<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::class" title='vfio::class' data-use='w' data-ref="vfio::class">class</a> = <a class="macro" href="../../include/linux/device.h.html#530" title="({ static struct lock_class_key __key; __class_create(((struct module *)0), &quot;vfio&quot;, &amp;__key); })" data-ref="_M/class_create">class_create</a>(<a class="macro" href="../../include/linux/export.h.html#31" title="((struct module *)0)" data-ref="_M/THIS_MODULE">THIS_MODULE</a>, <q>"vfio"</q>);</td></tr>
<tr><th id="2215">2215</th><td>	<b>if</b> (<a class="ref fn" href="../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::class" title='vfio::class' data-use='r' data-ref="vfio::class">class</a>)) {</td></tr>
<tr><th id="2216">2216</th><td>		<a class="local col2 ref" href="#312ret" title='ret' data-ref="312ret">ret</a> = <a class="ref fn" href="../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR">PTR_ERR</a>(<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::class" title='vfio::class' data-use='r' data-ref="vfio::class">class</a>);</td></tr>
<tr><th id="2217">2217</th><td>		<b>goto</b> <a class="lbl" href="#313err_class" data-ref="313err_class">err_class</a>;</td></tr>
<tr><th id="2218">2218</th><td>	}</td></tr>
<tr><th id="2219">2219</th><td></td></tr>
<tr><th id="2220">2220</th><td>	<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::class" title='vfio::class' data-use='r' data-ref="vfio::class">class</a>-&gt;<a class="ref field" href="../../include/linux/device.h.html#class::devnode" title='class::devnode' data-ref="class::devnode">devnode</a> = <a class="tu ref fn" href="#vfio_devnode" title='vfio_devnode' data-use='r' data-ref="vfio_devnode">vfio_devnode</a>;</td></tr>
<tr><th id="2221">2221</th><td></td></tr>
<tr><th id="2222">2222</th><td>	<a class="local col2 ref" href="#312ret" title='ret' data-ref="312ret">ret</a> = <a class="ref fn" href="../../include/linux/fs.h.html#alloc_chrdev_region" title='alloc_chrdev_region' data-ref="alloc_chrdev_region">alloc_chrdev_region</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_devt" title='vfio::group_devt' data-use='a' data-ref="vfio::group_devt">group_devt</a>, <var>0</var>, <a class="macro" href="../../include/linux/kdev_t.h.html#8" title="((1U &lt;&lt; 20) - 1)" data-ref="_M/MINORMASK">MINORMASK</a>, <q>"vfio"</q>);</td></tr>
<tr><th id="2223">2223</th><td>	<b>if</b> (<a class="local col2 ref" href="#312ret" title='ret' data-ref="312ret">ret</a>)</td></tr>
<tr><th id="2224">2224</th><td>		<b>goto</b> <a class="lbl" href="#314err_alloc_chrdev" data-ref="314err_alloc_chrdev">err_alloc_chrdev</a>;</td></tr>
<tr><th id="2225">2225</th><td></td></tr>
<tr><th id="2226">2226</th><td>	<a class="ref fn" href="../../include/linux/cdev.h.html#cdev_init" title='cdev_init' data-ref="cdev_init">cdev_init</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_cdev" title='vfio::group_cdev' data-use='a' data-ref="vfio::group_cdev">group_cdev</a>, &amp;<a class="tu ref" href="#vfio_group_fops" title='vfio_group_fops' data-use='a' data-ref="vfio_group_fops">vfio_group_fops</a>);</td></tr>
<tr><th id="2227">2227</th><td>	<a class="local col2 ref" href="#312ret" title='ret' data-ref="312ret">ret</a> = <a class="ref fn" href="../../include/linux/cdev.h.html#cdev_add" title='cdev_add' data-ref="cdev_add">cdev_add</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_cdev" title='vfio::group_cdev' data-use='a' data-ref="vfio::group_cdev">group_cdev</a>, <a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_devt" title='vfio::group_devt' data-use='r' data-ref="vfio::group_devt">group_devt</a>, <a class="macro" href="../../include/linux/kdev_t.h.html#8" title="((1U &lt;&lt; 20) - 1)" data-ref="_M/MINORMASK">MINORMASK</a>);</td></tr>
<tr><th id="2228">2228</th><td>	<b>if</b> (<a class="local col2 ref" href="#312ret" title='ret' data-ref="312ret">ret</a>)</td></tr>
<tr><th id="2229">2229</th><td>		<b>goto</b> <a class="lbl" href="#315err_cdev_add" data-ref="315err_cdev_add">err_cdev_add</a>;</td></tr>
<tr><th id="2230">2230</th><td></td></tr>
<tr><th id="2231">2231</th><td>	<a class="macro" href="../../include/linux/printk.h.html#314" title="printk(&quot;\001&quot; &quot;6&quot; &quot;VFIO - User Level meta-driver&quot; &quot; version: &quot; &quot;0.3&quot; &quot;\n&quot;)" data-ref="_M/pr_info">pr_info</a>(<a class="macro" href="#40" title="&quot;VFIO - User Level meta-driver&quot;" data-ref="_M/DRIVER_DESC">DRIVER_DESC</a> <q>" version: "</q> <a class="macro" href="#38" title="&quot;0.3&quot;" data-ref="_M/DRIVER_VERSION">DRIVER_VERSION</a> <q>"\n"</q>);</td></tr>
<tr><th id="2232">2232</th><td></td></tr>
<tr><th id="2233">2233</th><td><u>#<span data-ppcond="2233">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#156" data-ref="_M/CONFIG_VFIO_NOIOMMU">CONFIG_VFIO_NOIOMMU</a></u></td></tr>
<tr><th id="2234">2234</th><td>	<a class="ref fn" href="#vfio_register_iommu_driver" title='vfio_register_iommu_driver' data-ref="vfio_register_iommu_driver">vfio_register_iommu_driver</a>(&amp;<a class="tu ref" href="#vfio_noiommu_ops" title='vfio_noiommu_ops' data-use='a' data-ref="vfio_noiommu_ops">vfio_noiommu_ops</a>);</td></tr>
<tr><th id="2235">2235</th><td><u>#<span data-ppcond="2233">endif</span></u></td></tr>
<tr><th id="2236">2236</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2237">2237</th><td></td></tr>
<tr><th id="2238">2238</th><td><dfn class="lbl" id="315err_cdev_add" data-ref="315err_cdev_add">err_cdev_add</dfn>:</td></tr>
<tr><th id="2239">2239</th><td>	<a class="ref fn" href="../../include/linux/fs.h.html#unregister_chrdev_region" title='unregister_chrdev_region' data-ref="unregister_chrdev_region">unregister_chrdev_region</a>(<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_devt" title='vfio::group_devt' data-use='r' data-ref="vfio::group_devt">group_devt</a>, <a class="macro" href="../../include/linux/kdev_t.h.html#8" title="((1U &lt;&lt; 20) - 1)" data-ref="_M/MINORMASK">MINORMASK</a>);</td></tr>
<tr><th id="2240">2240</th><td><dfn class="lbl" id="314err_alloc_chrdev" data-ref="314err_alloc_chrdev">err_alloc_chrdev</dfn>:</td></tr>
<tr><th id="2241">2241</th><td>	<a class="ref fn" href="../../include/linux/device.h.html#class_destroy" title='class_destroy' data-ref="class_destroy">class_destroy</a>(<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::class" title='vfio::class' data-use='r' data-ref="vfio::class">class</a>);</td></tr>
<tr><th id="2242">2242</th><td>	<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::class" title='vfio::class' data-use='w' data-ref="vfio::class">class</a> = <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="2243">2243</th><td><dfn class="lbl" id="313err_class" data-ref="313err_class">err_class</dfn>:</td></tr>
<tr><th id="2244">2244</th><td>	<a class="ref fn" href="../../include/linux/miscdevice.h.html#misc_deregister" title='misc_deregister' data-ref="misc_deregister">misc_deregister</a>(&amp;<a class="tu ref" href="#vfio_dev" title='vfio_dev' data-use='a' data-ref="vfio_dev">vfio_dev</a>);</td></tr>
<tr><th id="2245">2245</th><td>	<b>return</b> <a class="local col2 ref" href="#312ret" title='ret' data-ref="312ret">ret</a>;</td></tr>
<tr><th id="2246">2246</th><td>}</td></tr>
<tr><th id="2247">2247</th><td></td></tr>
<tr><th id="2248">2248</th><td><em>static</em> <em>void</em> <a class="macro" href="../../include/linux/init.h.html#83" title="__attribute__ ((__section__(&quot;.exit.text&quot;))) __attribute__((__used__)) __attribute__((no_instrument_function))" data-ref="_M/__exit">__exit</a> <dfn class="tu decl def fn" id="vfio_cleanup" title='vfio_cleanup' data-type='void vfio_cleanup()' data-ref="vfio_cleanup">vfio_cleanup</dfn>(<em>void</em>)</td></tr>
<tr><th id="2249">2249</th><td>{</td></tr>
<tr><th id="2250">2250</th><td>	<a class="macro" href="../../include/asm-generic/bug.h.html#111" title="({ int __ret_warn_on = !!(!list_empty(&amp;vfio.group_list)); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/drivers/vfio/vfio.c&quot;), &quot;i&quot; (2250), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (86)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="ref fn" href="../../include/linux/list.h.html#list_empty" title='list_empty' data-ref="list_empty">list_empty</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_list" title='vfio::group_list' data-use='a' data-ref="vfio::group_list">group_list</a>));</td></tr>
<tr><th id="2251">2251</th><td></td></tr>
<tr><th id="2252">2252</th><td><u>#<span data-ppcond="2252">ifdef</span> <a class="macro" href="../../include/generated/autoconf.h.html#156" data-ref="_M/CONFIG_VFIO_NOIOMMU">CONFIG_VFIO_NOIOMMU</a></u></td></tr>
<tr><th id="2253">2253</th><td>	<a class="ref fn" href="#vfio_unregister_iommu_driver" title='vfio_unregister_iommu_driver' data-ref="vfio_unregister_iommu_driver">vfio_unregister_iommu_driver</a>(&amp;<a class="tu ref" href="#vfio_noiommu_ops" title='vfio_noiommu_ops' data-use='a' data-ref="vfio_noiommu_ops">vfio_noiommu_ops</a>);</td></tr>
<tr><th id="2254">2254</th><td><u>#<span data-ppcond="2252">endif</span></u></td></tr>
<tr><th id="2255">2255</th><td>	<a class="ref fn" href="../../include/linux/idr.h.html#idr_destroy" title='idr_destroy' data-ref="idr_destroy">idr_destroy</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_idr" title='vfio::group_idr' data-use='a' data-ref="vfio::group_idr">group_idr</a>);</td></tr>
<tr><th id="2256">2256</th><td>	<a class="ref fn" href="../../include/linux/cdev.h.html#cdev_del" title='cdev_del' data-ref="cdev_del">cdev_del</a>(&amp;<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_cdev" title='vfio::group_cdev' data-use='a' data-ref="vfio::group_cdev">group_cdev</a>);</td></tr>
<tr><th id="2257">2257</th><td>	<a class="ref fn" href="../../include/linux/fs.h.html#unregister_chrdev_region" title='unregister_chrdev_region' data-ref="unregister_chrdev_region">unregister_chrdev_region</a>(<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::group_devt" title='vfio::group_devt' data-use='r' data-ref="vfio::group_devt">group_devt</a>, <a class="macro" href="../../include/linux/kdev_t.h.html#8" title="((1U &lt;&lt; 20) - 1)" data-ref="_M/MINORMASK">MINORMASK</a>);</td></tr>
<tr><th id="2258">2258</th><td>	<a class="ref fn" href="../../include/linux/device.h.html#class_destroy" title='class_destroy' data-ref="class_destroy">class_destroy</a>(<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::class" title='vfio::class' data-use='r' data-ref="vfio::class">class</a>);</td></tr>
<tr><th id="2259">2259</th><td>	<a class="tu ref" href="#vfio" title='vfio' data-use='m' data-ref="vfio">vfio</a>.<a class="tu ref field" href="#vfio::class" title='vfio::class' data-use='w' data-ref="vfio::class">class</a> = <a class="macro" href="../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="2260">2260</th><td>	<a class="ref fn" href="../../include/linux/miscdevice.h.html#misc_deregister" title='misc_deregister' data-ref="misc_deregister">misc_deregister</a>(&amp;<a class="tu ref" href="#vfio_dev" title='vfio_dev' data-use='a' data-ref="vfio_dev">vfio_dev</a>);</td></tr>
<tr><th id="2261">2261</th><td>}</td></tr>
<tr><th id="2262">2262</th><td></td></tr>
<tr><th id="2263">2263</th><td><a class="macro" href="../../include/linux/module.h.html#86" title="static initcall_t __initcall_vfio_init6 __attribute__((__used__)) __attribute__((__section__(&quot;.initcall&quot; &quot;6&quot; &quot;.init&quot;))) = vfio_init;;" data-ref="_M/module_init">module_init</a>(<a class="tu ref fn" href="#vfio_init" title='vfio_init' data-ref="vfio_init">vfio_init</a>);</td></tr>
<tr><th id="2264">2264</th><td><a class="macro" href="../../include/linux/module.h.html#98" title="static exitcall_t __exitcall_vfio_cleanup __attribute__((__used__)) __attribute__ ((__section__(&quot;.exitcall.exit&quot;))) = vfio_cleanup;" data-ref="_M/module_exit">module_exit</a>(<a class="tu ref fn" href="#vfio_cleanup" title='vfio_cleanup' data-ref="vfio_cleanup">vfio_cleanup</a>);</td></tr>
<tr><th id="2265">2265</th><td></td></tr>
<tr><th id="2266">2266</th><td><a class="macro" href="../../include/linux/module.h.html#239" title="static struct module_version_attribute ___modver_attr = { .mattr = { .attr = { .name = &quot;version&quot;, .mode = (00400|00040|00004), }, .show = __modver_version_show, }, .module_name = &quot;vfio&quot;, .version = &quot;0.3&quot;, }; static const struct module_version_attribute __attribute__((__used__)) __attribute__ ((__section__ (&quot;__modver&quot;))) * const __modver_attr = &amp;___modver_attr" data-ref="_M/MODULE_VERSION">MODULE_VERSION</a>(<a class="macro" href="#38" title="&quot;0.3&quot;" data-ref="_M/DRIVER_VERSION">DRIVER_VERSION</a>);</td></tr>
<tr><th id="2267">2267</th><td><a class="macro" href="../../include/linux/module.h.html#199" title="struct __UNIQUE_ID_license88 {}" data-ref="_M/MODULE_LICENSE">MODULE_LICENSE</a>(<q>"GPL v2"</q>);</td></tr>
<tr><th id="2268">2268</th><td><a class="macro" href="../../include/linux/module.h.html#205" title="struct __UNIQUE_ID_author90 {}" data-ref="_M/MODULE_AUTHOR">MODULE_AUTHOR</a>(<a class="macro" href="#39" title="&quot;Alex Williamson &lt;alex.williamson@redhat.com&gt;&quot;" data-ref="_M/DRIVER_AUTHOR">DRIVER_AUTHOR</a>);</td></tr>
<tr><th id="2269">2269</th><td><a class="macro" href="../../include/linux/module.h.html#208" title="struct __UNIQUE_ID_description92 {}" data-ref="_M/MODULE_DESCRIPTION">MODULE_DESCRIPTION</a>(<a class="macro" href="#40" title="&quot;VFIO - User Level meta-driver&quot;" data-ref="_M/DRIVER_DESC">DRIVER_DESC</a>);</td></tr>
<tr><th id="2270">2270</th><td><a class="macro" href="../../include/linux/miscdevice.h.html#94" title="struct __UNIQUE_ID_alias94 {}" data-ref="_M/MODULE_ALIAS_MISCDEV">MODULE_ALIAS_MISCDEV</a>(<a class="macro" href="../../include/linux/miscdevice.h.html#40" title="196" data-ref="_M/VFIO_MINOR">VFIO_MINOR</a>);</td></tr>
<tr><th id="2271">2271</th><td><a class="macro" href="../../include/linux/module.h.html#164" title="struct __UNIQUE_ID_alias96 {}" data-ref="_M/MODULE_ALIAS">MODULE_ALIAS</a>(<q>"devname:vfio/vfio"</q>);</td></tr>
<tr><th id="2272">2272</th><td><a class="macro" href="../../include/linux/module.h.html#169" title="struct __UNIQUE_ID_softdep98 {}" data-ref="_M/MODULE_SOFTDEP">MODULE_SOFTDEP</a>(<q>"post: vfio_iommu_type1 vfio_iommu_spapr_tce"</q>);</td></tr>
<tr><th id="2273">2273</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2018-Oct-01</em> from project linux-4.18.y revision <em>linux-4.18.y</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
