<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>vboxguest_linux.c source code [linux-4.18.y/drivers/virt/vboxguest/vboxguest_linux.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'linux-4.18.y/drivers/virt/vboxguest/vboxguest_linux.c'; var root_path = '../../../..'; var data_path = '../../../../../data';</script>
<script src='../../../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../..'>linux-4.18.y</a>/<a href='../..'>drivers</a>/<a href='..'>virt</a>/<a href='./'>vboxguest</a>/<a href='vboxguest_linux.c.html'>vboxguest_linux.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/* SPDX-License-Identifier: GPL-2.0 */</i></td></tr>
<tr><th id="2">2</th><td><i>/*</i></td></tr>
<tr><th id="3">3</th><td><i> * vboxguest linux pci driver, char-dev and input-device code,</i></td></tr>
<tr><th id="4">4</th><td><i> *</i></td></tr>
<tr><th id="5">5</th><td><i> * Copyright (C) 2006-2016 Oracle Corporation</i></td></tr>
<tr><th id="6">6</th><td><i> */</i></td></tr>
<tr><th id="7">7</th><td></td></tr>
<tr><th id="8">8</th><td><u>#include <a href="../../../include/linux/input.h.html">&lt;linux/input.h&gt;</a></u></td></tr>
<tr><th id="9">9</th><td><u>#include <a href="../../../include/linux/kernel.h.html">&lt;linux/kernel.h&gt;</a></u></td></tr>
<tr><th id="10">10</th><td><u>#include <a href="../../../include/linux/miscdevice.h.html">&lt;linux/miscdevice.h&gt;</a></u></td></tr>
<tr><th id="11">11</th><td><u>#include <a href="../../../include/linux/module.h.html">&lt;linux/module.h&gt;</a></u></td></tr>
<tr><th id="12">12</th><td><u>#include <a href="../../../include/linux/pci.h.html">&lt;linux/pci.h&gt;</a></u></td></tr>
<tr><th id="13">13</th><td><u>#include <a href="../../../include/linux/poll.h.html">&lt;linux/poll.h&gt;</a></u></td></tr>
<tr><th id="14">14</th><td><u>#include <a href="../../../include/linux/vbox_utils.h.html">&lt;linux/vbox_utils.h&gt;</a></u></td></tr>
<tr><th id="15">15</th><td><u>#include <a href="vboxguest_core.h.html">"vboxguest_core.h"</a></u></td></tr>
<tr><th id="16">16</th><td></td></tr>
<tr><th id="17">17</th><td><i class="doc">/** The device name. */</i></td></tr>
<tr><th id="18">18</th><td><u>#define <dfn class="macro" id="_M/DEVICE_NAME" data-ref="_M/DEVICE_NAME">DEVICE_NAME</dfn>		"vboxguest"</u></td></tr>
<tr><th id="19">19</th><td><i class="doc">/** The device name for the device node open to everyone. */</i></td></tr>
<tr><th id="20">20</th><td><u>#define <dfn class="macro" id="_M/DEVICE_NAME_USER" data-ref="_M/DEVICE_NAME_USER">DEVICE_NAME_USER</dfn>	"vboxuser"</u></td></tr>
<tr><th id="21">21</th><td><i class="doc">/** VirtualBox PCI vendor ID. */</i></td></tr>
<tr><th id="22">22</th><td><u>#define <dfn class="macro" id="_M/VBOX_VENDORID" data-ref="_M/VBOX_VENDORID">VBOX_VENDORID</dfn>		0x80ee</u></td></tr>
<tr><th id="23">23</th><td><i class="doc">/** VMMDev PCI card product ID. */</i></td></tr>
<tr><th id="24">24</th><td><u>#define <dfn class="macro" id="_M/VMMDEV_DEVICEID" data-ref="_M/VMMDEV_DEVICEID">VMMDEV_DEVICEID</dfn>		0xcafe</u></td></tr>
<tr><th id="25">25</th><td></td></tr>
<tr><th id="26">26</th><td><i class="doc" data-doc="vbg_gdev_mutex">/** Mutex protecting the global vbg_gdev pointer used by vbg_get/put_gdev. */</i></td></tr>
<tr><th id="27">27</th><td><em>static</em> <a class="macro" href="../../../include/linux/mutex.h.html#135" title="struct mutex vbg_gdev_mutex = { .owner = { (0) } , .wait_lock = (spinlock_t ) { { .rlock = { .raw_lock = { { .val = { (0) } } }, } } } , .wait_list = { &amp;(vbg_gdev_mutex.wait_list), &amp;(vbg_gdev_mutex.wait_list) } }" data-ref="_M/DEFINE_MUTEX">DEFINE_MUTEX</a>(<dfn class="tu decl def" id="vbg_gdev_mutex" title='vbg_gdev_mutex' data-type='struct mutex' data-ref="vbg_gdev_mutex"><a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='m' data-ref="vbg_gdev_mutex"><a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='m' data-ref="vbg_gdev_mutex"><a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='m' data-ref="vbg_gdev_mutex"><a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='m' data-ref="vbg_gdev_mutex"><a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='m' data-ref="vbg_gdev_mutex"><a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='m' data-ref="vbg_gdev_mutex"><a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='m' data-ref="vbg_gdev_mutex"><a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='m' data-ref="vbg_gdev_mutex">vbg_gdev_mutex</a></a></a></a></a></a></a></a></dfn>);</td></tr>
<tr><th id="28">28</th><td><i class="doc" data-doc="vbg_gdev">/** Global vbg_gdev pointer used by vbg_get/put_gdev. */</i></td></tr>
<tr><th id="29">29</th><td><em>static</em> <b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="tu decl def" id="vbg_gdev" title='vbg_gdev' data-type='struct vbg_dev *' data-ref="vbg_gdev">vbg_gdev</dfn>;</td></tr>
<tr><th id="30">30</th><td></td></tr>
<tr><th id="31">31</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vbg_misc_device_open" title='vbg_misc_device_open' data-type='int vbg_misc_device_open(struct inode * inode, struct file * filp)' data-ref="vbg_misc_device_open">vbg_misc_device_open</dfn>(<b>struct</b> <a class="type" href="../../../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col1 decl" id="1inode" title='inode' data-type='struct inode *' data-ref="1inode">inode</dfn>, <b>struct</b> <a class="type" href="../../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col2 decl" id="2filp" title='filp' data-type='struct file *' data-ref="2filp">filp</dfn>)</td></tr>
<tr><th id="32">32</th><td>{</td></tr>
<tr><th id="33">33</th><td>	<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_session" title='vbg_session' data-ref="vbg_session">vbg_session</a> *<dfn class="local col3 decl" id="3session" title='session' data-type='struct vbg_session *' data-ref="3session">session</dfn>;</td></tr>
<tr><th id="34">34</th><td>	<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="local col4 decl" id="4gdev" title='gdev' data-type='struct vbg_dev *' data-ref="4gdev">gdev</dfn>;</td></tr>
<tr><th id="35">35</th><td></td></tr>
<tr><th id="36">36</th><td>	<i>/* misc_open sets filp-&gt;private_data to our misc device */</i></td></tr>
<tr><th id="37">37</th><td>	<a class="local col4 ref" href="#4gdev" title='gdev' data-ref="4gdev">gdev</a> = <a class="macro" href="../../../include/linux/kernel.h.html#962" title="({ void *__mptr = (void *)(filp-&gt;private_data); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(filp-&gt;private_data)), typeof(((struct vbg_dev *)0)-&gt;misc_device)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(filp-&gt;private_data)), typeof(void)))); extern void __compiletime_assert_37(void) ; if (__cond) __compiletime_assert_37(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vbg_dev *)(__mptr - __builtin_offsetof(struct vbg_dev, misc_device))); })" data-ref="_M/container_of">container_of</a>(<a class="local col2 ref" href="#2filp" title='filp' data-ref="2filp">filp</a>-&gt;<a class="ref field" href="../../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>, <b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a>, <a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device" title='vbg_dev::misc_device' data-ref="vbg_dev::misc_device">misc_device</a>);</td></tr>
<tr><th id="38">38</th><td></td></tr>
<tr><th id="39">39</th><td>	<a class="local col3 ref" href="#3session" title='session' data-ref="3session">session</a> = <a class="ref fn" href="vboxguest_core.h.html#vbg_core_open_session" title='vbg_core_open_session' data-ref="vbg_core_open_session">vbg_core_open_session</a>(<a class="local col4 ref" href="#4gdev" title='gdev' data-ref="4gdev">gdev</a>, <a class="enum" href="../../../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>);</td></tr>
<tr><th id="40">40</th><td>	<b>if</b> (<a class="ref fn" href="../../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="local col3 ref" href="#3session" title='session' data-ref="3session">session</a>))</td></tr>
<tr><th id="41">41</th><td>		<b>return</b> <a class="ref fn" href="../../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR">PTR_ERR</a>(<a class="local col3 ref" href="#3session" title='session' data-ref="3session">session</a>);</td></tr>
<tr><th id="42">42</th><td></td></tr>
<tr><th id="43">43</th><td>	<a class="local col2 ref" href="#2filp" title='filp' data-ref="2filp">filp</a>-&gt;<a class="ref field" href="../../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a> = <a class="local col3 ref" href="#3session" title='session' data-ref="3session">session</a>;</td></tr>
<tr><th id="44">44</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="45">45</th><td>}</td></tr>
<tr><th id="46">46</th><td></td></tr>
<tr><th id="47">47</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vbg_misc_device_user_open" title='vbg_misc_device_user_open' data-type='int vbg_misc_device_user_open(struct inode * inode, struct file * filp)' data-ref="vbg_misc_device_user_open">vbg_misc_device_user_open</dfn>(<b>struct</b> <a class="type" href="../../../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col5 decl" id="5inode" title='inode' data-type='struct inode *' data-ref="5inode">inode</dfn>, <b>struct</b> <a class="type" href="../../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col6 decl" id="6filp" title='filp' data-type='struct file *' data-ref="6filp">filp</dfn>)</td></tr>
<tr><th id="48">48</th><td>{</td></tr>
<tr><th id="49">49</th><td>	<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_session" title='vbg_session' data-ref="vbg_session">vbg_session</a> *<dfn class="local col7 decl" id="7session" title='session' data-type='struct vbg_session *' data-ref="7session">session</dfn>;</td></tr>
<tr><th id="50">50</th><td>	<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="local col8 decl" id="8gdev" title='gdev' data-type='struct vbg_dev *' data-ref="8gdev">gdev</dfn>;</td></tr>
<tr><th id="51">51</th><td></td></tr>
<tr><th id="52">52</th><td>	<i>/* misc_open sets filp-&gt;private_data to our misc device */</i></td></tr>
<tr><th id="53">53</th><td>	<a class="local col8 ref" href="#8gdev" title='gdev' data-ref="8gdev">gdev</a> = <a class="macro" href="../../../include/linux/kernel.h.html#962" title="({ void *__mptr = (void *)(filp-&gt;private_data); do { bool __cond = !(!(!__builtin_types_compatible_p(typeof(*(filp-&gt;private_data)), typeof(((struct vbg_dev *)0)-&gt;misc_device_user)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(filp-&gt;private_data)), typeof(void)))); extern void __compiletime_assert_54(void) ; if (__cond) __compiletime_assert_54(); do { ((void)sizeof(char[1 - 2 * __cond])); } while (0); } while (0); ((struct vbg_dev *)(__mptr - __builtin_offsetof(struct vbg_dev, misc_device_user))); })" data-ref="_M/container_of">container_of</a>(<a class="local col6 ref" href="#6filp" title='filp' data-ref="6filp">filp</a>-&gt;<a class="ref field" href="../../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>, <b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a>,</td></tr>
<tr><th id="54">54</th><td>			    <a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device_user" title='vbg_dev::misc_device_user' data-ref="vbg_dev::misc_device_user">misc_device_user</a>);</td></tr>
<tr><th id="55">55</th><td></td></tr>
<tr><th id="56">56</th><td>	<a class="local col7 ref" href="#7session" title='session' data-ref="7session">session</a> = <a class="ref fn" href="vboxguest_core.h.html#vbg_core_open_session" title='vbg_core_open_session' data-ref="vbg_core_open_session">vbg_core_open_session</a>(<a class="local col8 ref" href="#8gdev" title='gdev' data-ref="8gdev">gdev</a>, <a class="enum" href="../../../include/linux/stddef.h.html#false" title='false' data-ref="false">false</a>);</td></tr>
<tr><th id="57">57</th><td>	<b>if</b> (<a class="ref fn" href="../../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR">IS_ERR</a>(<a class="local col7 ref" href="#7session" title='session' data-ref="7session">session</a>))</td></tr>
<tr><th id="58">58</th><td>		<b>return</b> <a class="ref fn" href="../../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR">PTR_ERR</a>(<a class="local col7 ref" href="#7session" title='session' data-ref="7session">session</a>);</td></tr>
<tr><th id="59">59</th><td></td></tr>
<tr><th id="60">60</th><td>	<a class="local col6 ref" href="#6filp" title='filp' data-ref="6filp">filp</a>-&gt;<a class="ref field" href="../../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a> = <a class="local col7 ref" href="#7session" title='session' data-ref="7session">session</a>;</td></tr>
<tr><th id="61">61</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="62">62</th><td>}</td></tr>
<tr><th id="63">63</th><td></td></tr>
<tr><th id="64">64</th><td><i class="doc" data-doc="vbg_misc_device_close">/**</i></td></tr>
<tr><th id="65">65</th><td><i class="doc" data-doc="vbg_misc_device_close"> * Close device.</i></td></tr>
<tr><th id="66">66</th><td><i class="doc" data-doc="vbg_misc_device_close"> * Return: 0 on success, negated errno on failure.</i></td></tr>
<tr><th id="67">67</th><td><i class="doc" data-doc="vbg_misc_device_close"> *<span class="command"> @inode</span>:		Pointer to inode info structure.</i></td></tr>
<tr><th id="68">68</th><td><i class="doc" data-doc="vbg_misc_device_close"> *<span class="command"> @filp</span>:		Associated file pointer.</i></td></tr>
<tr><th id="69">69</th><td><i class="doc" data-doc="vbg_misc_device_close"> */</i></td></tr>
<tr><th id="70">70</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vbg_misc_device_close" title='vbg_misc_device_close' data-type='int vbg_misc_device_close(struct inode * inode, struct file * filp)' data-ref="vbg_misc_device_close">vbg_misc_device_close</dfn>(<b>struct</b> <a class="type" href="../../../include/linux/fs.h.html#inode" title='inode' data-ref="inode">inode</a> *<dfn class="local col9 decl" id="9inode" title='inode' data-type='struct inode *' data-ref="9inode">inode</dfn>, <b>struct</b> <a class="type" href="../../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col0 decl" id="10filp" title='filp' data-type='struct file *' data-ref="10filp">filp</dfn>)</td></tr>
<tr><th id="71">71</th><td>{</td></tr>
<tr><th id="72">72</th><td>	<a class="ref fn" href="vboxguest_core.h.html#vbg_core_close_session" title='vbg_core_close_session' data-ref="vbg_core_close_session">vbg_core_close_session</a>(<a class="local col0 ref" href="#10filp" title='filp' data-ref="10filp">filp</a>-&gt;<a class="ref field" href="../../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>);</td></tr>
<tr><th id="73">73</th><td>	<a class="local col0 ref" href="#10filp" title='filp' data-ref="10filp">filp</a>-&gt;<a class="ref field" href="../../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a> = <a class="macro" href="../../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="74">74</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="75">75</th><td>}</td></tr>
<tr><th id="76">76</th><td></td></tr>
<tr><th id="77">77</th><td><i class="doc" data-doc="vbg_misc_device_ioctl">/**</i></td></tr>
<tr><th id="78">78</th><td><i class="doc" data-doc="vbg_misc_device_ioctl"> * Device I/O Control entry point.</i></td></tr>
<tr><th id="79">79</th><td><i class="doc" data-doc="vbg_misc_device_ioctl"> * Return: 0 on success, negated errno on failure.</i></td></tr>
<tr><th id="80">80</th><td><i class="doc" data-doc="vbg_misc_device_ioctl"> *<span class="command"> @filp</span>:		Associated file pointer.</i></td></tr>
<tr><th id="81">81</th><td><i class="doc" data-doc="vbg_misc_device_ioctl"> * <span class="command">@req</span>:<span class="verb">		The request specified to ioctl().</span></i></td></tr>
<tr><th id="82">82</th><td><i class="doc" data-doc="vbg_misc_device_ioctl"> * <span class="command">@arg</span>:		The argument specified to ioctl().</i></td></tr>
<tr><th id="83">83</th><td><i class="doc" data-doc="vbg_misc_device_ioctl"> */</i></td></tr>
<tr><th id="84">84</th><td><em>static</em> <em>long</em> <dfn class="tu decl def fn" id="vbg_misc_device_ioctl" title='vbg_misc_device_ioctl' data-type='long vbg_misc_device_ioctl(struct file * filp, unsigned int req, unsigned long arg)' data-ref="vbg_misc_device_ioctl">vbg_misc_device_ioctl</dfn>(<b>struct</b> <a class="type" href="../../../include/linux/fs.h.html#file" title='file' data-ref="file">file</a> *<dfn class="local col1 decl" id="11filp" title='filp' data-type='struct file *' data-ref="11filp">filp</dfn>, <em>unsigned</em> <em>int</em> <dfn class="local col2 decl" id="12req" title='req' data-type='unsigned int' data-ref="12req">req</dfn>,</td></tr>
<tr><th id="85">85</th><td>				  <em>unsigned</em> <em>long</em> <dfn class="local col3 decl" id="13arg" title='arg' data-type='unsigned long' data-ref="13arg">arg</dfn>)</td></tr>
<tr><th id="86">86</th><td>{</td></tr>
<tr><th id="87">87</th><td>	<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_session" title='vbg_session' data-ref="vbg_session">vbg_session</a> *<dfn class="local col4 decl" id="14session" title='session' data-type='struct vbg_session *' data-ref="14session">session</dfn> = <a class="local col1 ref" href="#11filp" title='filp' data-ref="11filp">filp</a>-&gt;<a class="ref field" href="../../../include/linux/fs.h.html#file::private_data" title='file::private_data' data-ref="file::private_data">private_data</a>;</td></tr>
<tr><th id="88">88</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#size_t" title='size_t' data-type='__kernel_size_t' data-ref="size_t">size_t</a> <dfn class="local col5 decl" id="15returned_size" title='returned_size' data-type='size_t' data-ref="15returned_size">returned_size</dfn>, <dfn class="local col6 decl" id="16size" title='size' data-type='size_t' data-ref="16size">size</dfn>;</td></tr>
<tr><th id="89">89</th><td>	<b>struct</b> <a class="type" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr" title='vbg_ioctl_hdr' data-ref="vbg_ioctl_hdr">vbg_ioctl_hdr</a> <dfn class="local col7 decl" id="17hdr" title='hdr' data-type='struct vbg_ioctl_hdr' data-ref="17hdr">hdr</dfn>;</td></tr>
<tr><th id="90">90</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool">bool</a> <dfn class="local col8 decl" id="18is_vmmdev_req" title='is_vmmdev_req' data-type='bool' data-ref="18is_vmmdev_req">is_vmmdev_req</dfn>;</td></tr>
<tr><th id="91">91</th><td>	<em>int</em> <dfn class="local col9 decl" id="19ret" title='ret' data-type='int' data-ref="19ret">ret</dfn> = <var>0</var>;</td></tr>
<tr><th id="92">92</th><td>	<em>void</em> *<dfn class="local col0 decl" id="20buf" title='buf' data-type='void *' data-ref="20buf">buf</dfn>;</td></tr>
<tr><th id="93">93</th><td></td></tr>
<tr><th id="94">94</th><td>	<b>if</b> (<a class="ref fn" href="../../../include/linux/uaccess.h.html#copy_from_user" title='copy_from_user' data-ref="copy_from_user">copy_from_user</a>(&amp;<a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>, (<em>void</em> *)<a class="local col3 ref" href="#13arg" title='arg' data-ref="13arg">arg</a>, <b>sizeof</b>(<a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>)))</td></tr>
<tr><th id="95">95</th><td>		<b>return</b> -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="96">96</th><td></td></tr>
<tr><th id="97">97</th><td>	<b>if</b> (<a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>.<a class="ref field" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr::version" title='vbg_ioctl_hdr::version' data-ref="vbg_ioctl_hdr::version">version</a> != <a class="macro" href="../../../include/uapi/linux/vboxguest.h.html#17" title="0x10001" data-ref="_M/VBG_IOCTL_HDR_VERSION">VBG_IOCTL_HDR_VERSION</a>)</td></tr>
<tr><th id="98">98</th><td>		<b>return</b> -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="99">99</th><td></td></tr>
<tr><th id="100">100</th><td>	<b>if</b> (<a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>.<a class="ref field" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr::size_in" title='vbg_ioctl_hdr::size_in' data-ref="vbg_ioctl_hdr::size_in">size_in</a> &lt; <b>sizeof</b>(<a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>) ||</td></tr>
<tr><th id="101">101</th><td>	    (<a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>.<a class="ref field" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr::size_out" title='vbg_ioctl_hdr::size_out' data-ref="vbg_ioctl_hdr::size_out">size_out</a> &amp;&amp; <a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>.<a class="ref field" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr::size_out" title='vbg_ioctl_hdr::size_out' data-ref="vbg_ioctl_hdr::size_out">size_out</a> &lt; <b>sizeof</b>(<a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>)))</td></tr>
<tr><th id="102">102</th><td>		<b>return</b> -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="103">103</th><td></td></tr>
<tr><th id="104">104</th><td>	<a class="local col6 ref" href="#16size" title='size' data-ref="16size">size</a> = <a class="macro" href="../../../include/linux/kernel.h.html#852" title="__builtin_choose_expr(((!!(sizeof((typeof(hdr.size_in) *)1 == (typeof(hdr.size_out) *)1))) &amp;&amp; ((sizeof(int) == sizeof(*(8 ? ((void *)((long)(hdr.size_in) * 0l)) : (int *)8))) &amp;&amp; (sizeof(int) == sizeof(*(8 ? ((void *)((long)(hdr.size_out) * 0l)) : (int *)8))))), ((hdr.size_in) &gt; (hdr.size_out) ? (hdr.size_in) : (hdr.size_out)), ({ typeof(hdr.size_in) __UNIQUE_ID___x60 = (hdr.size_in); typeof(hdr.size_out) __UNIQUE_ID___y61 = (hdr.size_out); ((__UNIQUE_ID___x60) &gt; (__UNIQUE_ID___y61) ? (__UNIQUE_ID___x60) : (__UNIQUE_ID___y61)); }))" data-ref="_M/max">max</a>(<a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>.<a class="ref field" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr::size_in" title='vbg_ioctl_hdr::size_in' data-ref="vbg_ioctl_hdr::size_in">size_in</a>, <a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>.<a class="ref field" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr::size_out" title='vbg_ioctl_hdr::size_out' data-ref="vbg_ioctl_hdr::size_out">size_out</a>);</td></tr>
<tr><th id="105">105</th><td>	<b>if</b> (<a class="macro" href="../../../include/uapi/asm-generic/ioctl.h.html#97" title="(((req) &gt;&gt; ((0+8)+8)) &amp; ((1 &lt;&lt; 14)-1))" data-ref="_M/_IOC_SIZE">_IOC_SIZE</a>(<a class="local col2 ref" href="#12req" title='req' data-ref="12req">req</a>) &amp;&amp; <a class="macro" href="../../../include/uapi/asm-generic/ioctl.h.html#97" title="(((req) &gt;&gt; ((0+8)+8)) &amp; ((1 &lt;&lt; 14)-1))" data-ref="_M/_IOC_SIZE">_IOC_SIZE</a>(<a class="local col2 ref" href="#12req" title='req' data-ref="12req">req</a>) != <a class="local col6 ref" href="#16size" title='size' data-ref="16size">size</a>)</td></tr>
<tr><th id="106">106</th><td>		<b>return</b> -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="107">107</th><td>	<b>if</b> (<a class="local col6 ref" href="#16size" title='size' data-ref="16size">size</a> &gt; <a class="macro" href="../../../include/linux/sizes.h.html#39" title="0x01000000" data-ref="_M/SZ_16M">SZ_16M</a>)</td></tr>
<tr><th id="108">108</th><td>		<b>return</b> -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#11" title="7" data-ref="_M/E2BIG">E2BIG</a>;</td></tr>
<tr><th id="109">109</th><td></td></tr>
<tr><th id="110">110</th><td>	<i>/*</i></td></tr>
<tr><th id="111">111</th><td><i>	 * IOCTL_VMMDEV_REQUEST needs the buffer to be below 4G to avoid</i></td></tr>
<tr><th id="112">112</th><td><i>	 * the need for a bounce-buffer and another copy later on.</i></td></tr>
<tr><th id="113">113</th><td><i>	 */</i></td></tr>
<tr><th id="114">114</th><td>	<a class="local col8 ref" href="#18is_vmmdev_req" title='is_vmmdev_req' data-ref="18is_vmmdev_req">is_vmmdev_req</a> = (<a class="local col2 ref" href="#12req" title='req' data-ref="12req">req</a> &amp; ~<a class="macro" href="../../../include/uapi/asm-generic/ioctl.h.html#104" title="(((1 &lt;&lt; 14)-1) &lt;&lt; ((0+8)+8))" data-ref="_M/IOCSIZE_MASK">IOCSIZE_MASK</a>) == <a class="macro" href="../../../include/uapi/linux/vboxguest.h.html#102" title="(((2U | 1U) &lt;&lt; (((0+8)+8)+14)) | ((&apos;V&apos;) &lt;&lt; (0+8)) | ((2) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VBG_IOCTL_VMMDEV_REQUEST">VBG_IOCTL_VMMDEV_REQUEST</a>(<var>0</var>) ||</td></tr>
<tr><th id="115">115</th><td>			 <a class="local col2 ref" href="#12req" title='req' data-ref="12req">req</a> == <a class="macro" href="../../../include/uapi/linux/vboxguest.h.html#106" title="(((2U | 1U) &lt;&lt; (((0+8)+8)+14)) | ((&apos;V&apos;) &lt;&lt; (0+8)) | ((3) &lt;&lt; 0) | ((0) &lt;&lt; ((0+8)+8)))" data-ref="_M/VBG_IOCTL_VMMDEV_REQUEST_BIG">VBG_IOCTL_VMMDEV_REQUEST_BIG</a>;</td></tr>
<tr><th id="116">116</th><td></td></tr>
<tr><th id="117">117</th><td>	<b>if</b> (<a class="local col8 ref" href="#18is_vmmdev_req" title='is_vmmdev_req' data-ref="18is_vmmdev_req">is_vmmdev_req</a>)</td></tr>
<tr><th id="118">118</th><td>		<a class="local col0 ref" href="#20buf" title='buf' data-ref="20buf">buf</a> = <a class="ref fn" href="vboxguest_core.h.html#vbg_req_alloc" title='vbg_req_alloc' data-ref="vbg_req_alloc">vbg_req_alloc</a>(<a class="local col6 ref" href="#16size" title='size' data-ref="16size">size</a>, <a class="macro" href="../../../include/uapi/linux/vboxguest.h.html#19" title="0" data-ref="_M/VBG_IOCTL_HDR_TYPE_DEFAULT">VBG_IOCTL_HDR_TYPE_DEFAULT</a>);</td></tr>
<tr><th id="119">119</th><td>	<b>else</b></td></tr>
<tr><th id="120">120</th><td>		<a class="local col0 ref" href="#20buf" title='buf' data-ref="20buf">buf</a> = <a class="ref fn" href="../../../include/linux/slab.h.html#kmalloc" title='kmalloc' data-ref="kmalloc">kmalloc</a>(<a class="local col6 ref" href="#16size" title='size' data-ref="16size">size</a>, <a class="macro" href="../../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x200000u|0x400000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="121">121</th><td>	<b>if</b> (!<a class="local col0 ref" href="#20buf" title='buf' data-ref="20buf">buf</a>)</td></tr>
<tr><th id="122">122</th><td>		<b>return</b> -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="123">123</th><td></td></tr>
<tr><th id="124">124</th><td>	*((<b>struct</b> <a class="type" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr" title='vbg_ioctl_hdr' data-ref="vbg_ioctl_hdr">vbg_ioctl_hdr</a> *)<a class="local col0 ref" href="#20buf" title='buf' data-ref="20buf">buf</a>) = <a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>;</td></tr>
<tr><th id="125">125</th><td>	<b>if</b> (<a class="ref fn" href="../../../include/linux/uaccess.h.html#copy_from_user" title='copy_from_user' data-ref="copy_from_user">copy_from_user</a>(<a class="local col0 ref" href="#20buf" title='buf' data-ref="20buf">buf</a> + <b>sizeof</b>(<a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>), (<em>void</em> *)<a class="local col3 ref" href="#13arg" title='arg' data-ref="13arg">arg</a> + <b>sizeof</b>(<a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>),</td></tr>
<tr><th id="126">126</th><td>			   <a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>.<a class="ref field" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr::size_in" title='vbg_ioctl_hdr::size_in' data-ref="vbg_ioctl_hdr::size_in">size_in</a> - <b>sizeof</b>(<a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>))) {</td></tr>
<tr><th id="127">127</th><td>		<a class="local col9 ref" href="#19ret" title='ret' data-ref="19ret">ret</a> = -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="128">128</th><td>		<b>goto</b> <a class="lbl" href="#21out" data-ref="21out">out</a>;</td></tr>
<tr><th id="129">129</th><td>	}</td></tr>
<tr><th id="130">130</th><td>	<b>if</b> (<a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>.<a class="ref field" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr::size_in" title='vbg_ioctl_hdr::size_in' data-ref="vbg_ioctl_hdr::size_in">size_in</a> &lt; <a class="local col6 ref" href="#16size" title='size' data-ref="16size">size</a>)</td></tr>
<tr><th id="131">131</th><td>		<a class="ref fn" href="../../../arch/x86/include/asm/string_64.h.html#memset" title='memset' data-ref="memset">memset</a>(<a class="local col0 ref" href="#20buf" title='buf' data-ref="20buf">buf</a> + <a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>.<a class="ref field" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr::size_in" title='vbg_ioctl_hdr::size_in' data-ref="vbg_ioctl_hdr::size_in">size_in</a>, <var>0</var>, <a class="local col6 ref" href="#16size" title='size' data-ref="16size">size</a> -  <a class="local col7 ref" href="#17hdr" title='hdr' data-ref="17hdr">hdr</a>.<a class="ref field" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr::size_in" title='vbg_ioctl_hdr::size_in' data-ref="vbg_ioctl_hdr::size_in">size_in</a>);</td></tr>
<tr><th id="132">132</th><td></td></tr>
<tr><th id="133">133</th><td>	<a class="local col9 ref" href="#19ret" title='ret' data-ref="19ret">ret</a> = <a class="ref fn" href="vboxguest_core.h.html#vbg_core_ioctl" title='vbg_core_ioctl' data-ref="vbg_core_ioctl">vbg_core_ioctl</a>(<a class="local col4 ref" href="#14session" title='session' data-ref="14session">session</a>, <a class="local col2 ref" href="#12req" title='req' data-ref="12req">req</a>, <a class="local col0 ref" href="#20buf" title='buf' data-ref="20buf">buf</a>);</td></tr>
<tr><th id="134">134</th><td>	<b>if</b> (<a class="local col9 ref" href="#19ret" title='ret' data-ref="19ret">ret</a>)</td></tr>
<tr><th id="135">135</th><td>		<b>goto</b> <a class="lbl" href="#21out" data-ref="21out">out</a>;</td></tr>
<tr><th id="136">136</th><td></td></tr>
<tr><th id="137">137</th><td>	<a class="local col5 ref" href="#15returned_size" title='returned_size' data-ref="15returned_size">returned_size</a> = ((<b>struct</b> <a class="type" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr" title='vbg_ioctl_hdr' data-ref="vbg_ioctl_hdr">vbg_ioctl_hdr</a> *)<a class="local col0 ref" href="#20buf" title='buf' data-ref="20buf">buf</a>)-&gt;<a class="ref field" href="../../../include/uapi/linux/vboxguest.h.html#vbg_ioctl_hdr::size_out" title='vbg_ioctl_hdr::size_out' data-ref="vbg_ioctl_hdr::size_out">size_out</a>;</td></tr>
<tr><th id="138">138</th><td>	<b>if</b> (<a class="local col5 ref" href="#15returned_size" title='returned_size' data-ref="15returned_size">returned_size</a> &gt; <a class="local col6 ref" href="#16size" title='size' data-ref="16size">size</a>) {</td></tr>
<tr><th id="139">139</th><td>		<a class="macro" href="../../../include/linux/vbox_utils.h.html#24" title="pr_debug" data-ref="_M/vbg_debug">vbg_debug</a>(<q>"%s: too much output data %zu &gt; %zu\n"</q>,</td></tr>
<tr><th id="140">140</th><td>			  <b>__func__</b>, <a class="local col5 ref" href="#15returned_size" title='returned_size' data-ref="15returned_size">returned_size</a>, <a class="local col6 ref" href="#16size" title='size' data-ref="16size">size</a>);</td></tr>
<tr><th id="141">141</th><td>		<a class="local col5 ref" href="#15returned_size" title='returned_size' data-ref="15returned_size">returned_size</a> = <a class="local col6 ref" href="#16size" title='size' data-ref="16size">size</a>;</td></tr>
<tr><th id="142">142</th><td>	}</td></tr>
<tr><th id="143">143</th><td>	<b>if</b> (<a class="ref fn" href="../../../include/linux/uaccess.h.html#copy_to_user" title='copy_to_user' data-ref="copy_to_user">copy_to_user</a>((<em>void</em> *)<a class="local col3 ref" href="#13arg" title='arg' data-ref="13arg">arg</a>, <a class="local col0 ref" href="#20buf" title='buf' data-ref="20buf">buf</a>, <a class="local col5 ref" href="#15returned_size" title='returned_size' data-ref="15returned_size">returned_size</a>) != <var>0</var>)</td></tr>
<tr><th id="144">144</th><td>		<a class="local col9 ref" href="#19ret" title='ret' data-ref="19ret">ret</a> = -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#18" title="14" data-ref="_M/EFAULT">EFAULT</a>;</td></tr>
<tr><th id="145">145</th><td></td></tr>
<tr><th id="146">146</th><td><dfn class="lbl" id="21out" data-ref="21out">out</dfn>:</td></tr>
<tr><th id="147">147</th><td>	<b>if</b> (<a class="local col8 ref" href="#18is_vmmdev_req" title='is_vmmdev_req' data-ref="18is_vmmdev_req">is_vmmdev_req</a>)</td></tr>
<tr><th id="148">148</th><td>		<a class="ref fn" href="vboxguest_core.h.html#vbg_req_free" title='vbg_req_free' data-ref="vbg_req_free">vbg_req_free</a>(<a class="local col0 ref" href="#20buf" title='buf' data-ref="20buf">buf</a>, <a class="local col6 ref" href="#16size" title='size' data-ref="16size">size</a>);</td></tr>
<tr><th id="149">149</th><td>	<b>else</b></td></tr>
<tr><th id="150">150</th><td>		<a class="ref fn" href="../../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree">kfree</a>(<a class="local col0 ref" href="#20buf" title='buf' data-ref="20buf">buf</a>);</td></tr>
<tr><th id="151">151</th><td></td></tr>
<tr><th id="152">152</th><td>	<b>return</b> <a class="local col9 ref" href="#19ret" title='ret' data-ref="19ret">ret</a>;</td></tr>
<tr><th id="153">153</th><td>}</td></tr>
<tr><th id="154">154</th><td></td></tr>
<tr><th id="155">155</th><td><i class="doc" data-doc="vbg_misc_device_fops">/** The file_operations structures. */</i></td></tr>
<tr><th id="156">156</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="../../../include/linux/fs.h.html#file_operations" title='file_operations' data-ref="file_operations">file_operations</a> <dfn class="tu decl def" id="vbg_misc_device_fops" title='vbg_misc_device_fops' data-type='const struct file_operations' data-ref="vbg_misc_device_fops">vbg_misc_device_fops</dfn> = {</td></tr>
<tr><th id="157">157</th><td>	.<a class="ref field" href="../../../include/linux/fs.h.html#file_operations::owner" title='file_operations::owner' data-ref="file_operations::owner">owner</a>			= <a class="macro" href="../../../include/linux/export.h.html#31" title="((struct module *)0)" data-ref="_M/THIS_MODULE">THIS_MODULE</a>,</td></tr>
<tr><th id="158">158</th><td>	.<a class="ref field" href="../../../include/linux/fs.h.html#file_operations::open" title='file_operations::open' data-ref="file_operations::open">open</a>			= <a class="tu ref fn" href="#vbg_misc_device_open" title='vbg_misc_device_open' data-ref="vbg_misc_device_open">vbg_misc_device_open</a>,</td></tr>
<tr><th id="159">159</th><td>	.<a class="ref field" href="../../../include/linux/fs.h.html#file_operations::release" title='file_operations::release' data-ref="file_operations::release">release</a>		= <a class="tu ref fn" href="#vbg_misc_device_close" title='vbg_misc_device_close' data-ref="vbg_misc_device_close">vbg_misc_device_close</a>,</td></tr>
<tr><th id="160">160</th><td>	.<a class="ref field" href="../../../include/linux/fs.h.html#file_operations::unlocked_ioctl" title='file_operations::unlocked_ioctl' data-ref="file_operations::unlocked_ioctl">unlocked_ioctl</a>		= <a class="tu ref fn" href="#vbg_misc_device_ioctl" title='vbg_misc_device_ioctl' data-ref="vbg_misc_device_ioctl">vbg_misc_device_ioctl</a>,</td></tr>
<tr><th id="161">161</th><td><u>#<span data-ppcond="161">ifdef</span> <a class="macro" href="../../../include/generated/autoconf.h.html#96" data-ref="_M/CONFIG_COMPAT">CONFIG_COMPAT</a></u></td></tr>
<tr><th id="162">162</th><td>	.<a class="ref field" href="../../../include/linux/fs.h.html#file_operations::compat_ioctl" title='file_operations::compat_ioctl' data-ref="file_operations::compat_ioctl">compat_ioctl</a>		= <a class="tu ref fn" href="#vbg_misc_device_ioctl" title='vbg_misc_device_ioctl' data-ref="vbg_misc_device_ioctl">vbg_misc_device_ioctl</a>,</td></tr>
<tr><th id="163">163</th><td><u>#<span data-ppcond="161">endif</span></u></td></tr>
<tr><th id="164">164</th><td>};</td></tr>
<tr><th id="165">165</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="../../../include/linux/fs.h.html#file_operations" title='file_operations' data-ref="file_operations">file_operations</a> <dfn class="tu decl def" id="vbg_misc_device_user_fops" title='vbg_misc_device_user_fops' data-type='const struct file_operations' data-ref="vbg_misc_device_user_fops">vbg_misc_device_user_fops</dfn> = {</td></tr>
<tr><th id="166">166</th><td>	.<a class="ref field" href="../../../include/linux/fs.h.html#file_operations::owner" title='file_operations::owner' data-ref="file_operations::owner">owner</a>			= <a class="macro" href="../../../include/linux/export.h.html#31" title="((struct module *)0)" data-ref="_M/THIS_MODULE">THIS_MODULE</a>,</td></tr>
<tr><th id="167">167</th><td>	.<a class="ref field" href="../../../include/linux/fs.h.html#file_operations::open" title='file_operations::open' data-ref="file_operations::open">open</a>			= <a class="tu ref fn" href="#vbg_misc_device_user_open" title='vbg_misc_device_user_open' data-ref="vbg_misc_device_user_open">vbg_misc_device_user_open</a>,</td></tr>
<tr><th id="168">168</th><td>	.<a class="ref field" href="../../../include/linux/fs.h.html#file_operations::release" title='file_operations::release' data-ref="file_operations::release">release</a>		= <a class="tu ref fn" href="#vbg_misc_device_close" title='vbg_misc_device_close' data-ref="vbg_misc_device_close">vbg_misc_device_close</a>,</td></tr>
<tr><th id="169">169</th><td>	.<a class="ref field" href="../../../include/linux/fs.h.html#file_operations::unlocked_ioctl" title='file_operations::unlocked_ioctl' data-ref="file_operations::unlocked_ioctl">unlocked_ioctl</a>		= <a class="tu ref fn" href="#vbg_misc_device_ioctl" title='vbg_misc_device_ioctl' data-ref="vbg_misc_device_ioctl">vbg_misc_device_ioctl</a>,</td></tr>
<tr><th id="170">170</th><td><u>#<span data-ppcond="170">ifdef</span> <a class="macro" href="../../../include/generated/autoconf.h.html#96" data-ref="_M/CONFIG_COMPAT">CONFIG_COMPAT</a></u></td></tr>
<tr><th id="171">171</th><td>	.<a class="ref field" href="../../../include/linux/fs.h.html#file_operations::compat_ioctl" title='file_operations::compat_ioctl' data-ref="file_operations::compat_ioctl">compat_ioctl</a>		= <a class="tu ref fn" href="#vbg_misc_device_ioctl" title='vbg_misc_device_ioctl' data-ref="vbg_misc_device_ioctl">vbg_misc_device_ioctl</a>,</td></tr>
<tr><th id="172">172</th><td><u>#<span data-ppcond="170">endif</span></u></td></tr>
<tr><th id="173">173</th><td>};</td></tr>
<tr><th id="174">174</th><td></td></tr>
<tr><th id="175">175</th><td><i class="doc" data-doc="vbg_input_open">/**</i></td></tr>
<tr><th id="176">176</th><td><i class="doc" data-doc="vbg_input_open"> * Called when the input device is first opened.</i></td></tr>
<tr><th id="177">177</th><td><i class="doc" data-doc="vbg_input_open"> *</i></td></tr>
<tr><th id="178">178</th><td><i class="doc" data-doc="vbg_input_open"> * Sets up absolute mouse reporting.</i></td></tr>
<tr><th id="179">179</th><td><i class="doc" data-doc="vbg_input_open"> */</i></td></tr>
<tr><th id="180">180</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vbg_input_open" title='vbg_input_open' data-type='int vbg_input_open(struct input_dev * input)' data-ref="vbg_input_open">vbg_input_open</dfn>(<b>struct</b> <a class="type" href="../../../include/linux/input.h.html#input_dev" title='input_dev' data-ref="input_dev">input_dev</a> *<dfn class="local col2 decl" id="22input" title='input' data-type='struct input_dev *' data-ref="22input">input</dfn>)</td></tr>
<tr><th id="181">181</th><td>{</td></tr>
<tr><th id="182">182</th><td>	<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="local col3 decl" id="23gdev" title='gdev' data-type='struct vbg_dev *' data-ref="23gdev">gdev</dfn> = <a class="ref fn" href="../../../include/linux/input.h.html#input_get_drvdata" title='input_get_drvdata' data-ref="input_get_drvdata">input_get_drvdata</a>(<a class="local col2 ref" href="#22input" title='input' data-ref="22input">input</a>);</td></tr>
<tr><th id="183">183</th><td>	<a class="typedef" href="../../../include/asm-generic/int-ll64.h.html#u32" title='u32' data-type='__u32' data-ref="u32">u32</a> <dfn class="local col4 decl" id="24feat" title='feat' data-type='u32' data-ref="24feat">feat</dfn> = <a class="macro" href="vmmdev.h.html#124" title="(1UL &lt;&lt; (0))" data-ref="_M/VMMDEV_MOUSE_GUEST_CAN_ABSOLUTE">VMMDEV_MOUSE_GUEST_CAN_ABSOLUTE</a> | <a class="macro" href="vmmdev.h.html#142" title="(1UL &lt;&lt; (4))" data-ref="_M/VMMDEV_MOUSE_NEW_PROTOCOL">VMMDEV_MOUSE_NEW_PROTOCOL</a>;</td></tr>
<tr><th id="184">184</th><td>	<em>int</em> <dfn class="local col5 decl" id="25ret" title='ret' data-type='int' data-ref="25ret">ret</dfn>;</td></tr>
<tr><th id="185">185</th><td></td></tr>
<tr><th id="186">186</th><td>	<a class="local col5 ref" href="#25ret" title='ret' data-ref="25ret">ret</a> = <a class="ref fn" href="vboxguest_core.h.html#vbg_core_set_mouse_status" title='vbg_core_set_mouse_status' data-ref="vbg_core_set_mouse_status">vbg_core_set_mouse_status</a>(<a class="local col3 ref" href="#23gdev" title='gdev' data-ref="23gdev">gdev</a>, <a class="local col4 ref" href="#24feat" title='feat' data-ref="24feat">feat</a>);</td></tr>
<tr><th id="187">187</th><td>	<b>if</b> (<a class="local col5 ref" href="#25ret" title='ret' data-ref="25ret">ret</a>)</td></tr>
<tr><th id="188">188</th><td>		<b>return</b> <a class="local col5 ref" href="#25ret" title='ret' data-ref="25ret">ret</a>;</td></tr>
<tr><th id="189">189</th><td></td></tr>
<tr><th id="190">190</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="191">191</th><td>}</td></tr>
<tr><th id="192">192</th><td></td></tr>
<tr><th id="193">193</th><td><i class="doc" data-doc="vbg_input_close">/**</i></td></tr>
<tr><th id="194">194</th><td><i class="doc" data-doc="vbg_input_close"> * Called if all open handles to the input device are closed.</i></td></tr>
<tr><th id="195">195</th><td><i class="doc" data-doc="vbg_input_close"> *</i></td></tr>
<tr><th id="196">196</th><td><i class="doc" data-doc="vbg_input_close"> * Disables absolute reporting.</i></td></tr>
<tr><th id="197">197</th><td><i class="doc" data-doc="vbg_input_close"> */</i></td></tr>
<tr><th id="198">198</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vbg_input_close" title='vbg_input_close' data-type='void vbg_input_close(struct input_dev * input)' data-ref="vbg_input_close">vbg_input_close</dfn>(<b>struct</b> <a class="type" href="../../../include/linux/input.h.html#input_dev" title='input_dev' data-ref="input_dev">input_dev</a> *<dfn class="local col6 decl" id="26input" title='input' data-type='struct input_dev *' data-ref="26input">input</dfn>)</td></tr>
<tr><th id="199">199</th><td>{</td></tr>
<tr><th id="200">200</th><td>	<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="local col7 decl" id="27gdev" title='gdev' data-type='struct vbg_dev *' data-ref="27gdev">gdev</dfn> = <a class="ref fn" href="../../../include/linux/input.h.html#input_get_drvdata" title='input_get_drvdata' data-ref="input_get_drvdata">input_get_drvdata</a>(<a class="local col6 ref" href="#26input" title='input' data-ref="26input">input</a>);</td></tr>
<tr><th id="201">201</th><td></td></tr>
<tr><th id="202">202</th><td>	<a class="ref fn" href="vboxguest_core.h.html#vbg_core_set_mouse_status" title='vbg_core_set_mouse_status' data-ref="vbg_core_set_mouse_status">vbg_core_set_mouse_status</a>(<a class="local col7 ref" href="#27gdev" title='gdev' data-ref="27gdev">gdev</a>, <var>0</var>);</td></tr>
<tr><th id="203">203</th><td>}</td></tr>
<tr><th id="204">204</th><td></td></tr>
<tr><th id="205">205</th><td><i class="doc" data-doc="vbg_create_input_device">/**</i></td></tr>
<tr><th id="206">206</th><td><i class="doc" data-doc="vbg_create_input_device"> * Creates the kernel input device.</i></td></tr>
<tr><th id="207">207</th><td><i class="doc" data-doc="vbg_create_input_device"> *</i></td></tr>
<tr><th id="208">208</th><td><i class="doc" data-doc="vbg_create_input_device"> * Return: 0 on success, negated errno on failure.</i></td></tr>
<tr><th id="209">209</th><td><i class="doc" data-doc="vbg_create_input_device"> */</i></td></tr>
<tr><th id="210">210</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vbg_create_input_device" title='vbg_create_input_device' data-type='int vbg_create_input_device(struct vbg_dev * gdev)' data-ref="vbg_create_input_device">vbg_create_input_device</dfn>(<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="local col8 decl" id="28gdev" title='gdev' data-type='struct vbg_dev *' data-ref="28gdev">gdev</dfn>)</td></tr>
<tr><th id="211">211</th><td>{</td></tr>
<tr><th id="212">212</th><td>	<b>struct</b> <a class="type" href="../../../include/linux/input.h.html#input_dev" title='input_dev' data-ref="input_dev">input_dev</a> *<dfn class="local col9 decl" id="29input" title='input' data-type='struct input_dev *' data-ref="29input">input</dfn>;</td></tr>
<tr><th id="213">213</th><td></td></tr>
<tr><th id="214">214</th><td>	<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a> = <a class="ref fn" href="../../../include/linux/input.h.html#devm_input_allocate_device" title='devm_input_allocate_device' data-ref="devm_input_allocate_device">devm_input_allocate_device</a>(<a class="local col8 ref" href="#28gdev" title='gdev' data-ref="28gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::dev" title='vbg_dev::dev' data-ref="vbg_dev::dev">dev</a>);</td></tr>
<tr><th id="215">215</th><td>	<b>if</b> (!<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>)</td></tr>
<tr><th id="216">216</th><td>		<b>return</b> -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="217">217</th><td></td></tr>
<tr><th id="218">218</th><td>	<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>-&gt;<a class="ref field" href="../../../include/linux/input.h.html#input_dev::id" title='input_dev::id' data-ref="input_dev::id">id</a>.<a class="ref field" href="../../../include/uapi/linux/input.h.html#input_id::bustype" title='input_id::bustype' data-ref="input_id::bustype">bustype</a> = <a class="macro" href="../../../include/uapi/linux/input.h.html#246" title="0x01" data-ref="_M/BUS_PCI">BUS_PCI</a>;</td></tr>
<tr><th id="219">219</th><td>	<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>-&gt;<a class="ref field" href="../../../include/linux/input.h.html#input_dev::id" title='input_dev::id' data-ref="input_dev::id">id</a>.<a class="ref field" href="../../../include/uapi/linux/input.h.html#input_id::vendor" title='input_id::vendor' data-ref="input_id::vendor">vendor</a> = <a class="macro" href="#22" title="0x80ee" data-ref="_M/VBOX_VENDORID">VBOX_VENDORID</a>;</td></tr>
<tr><th id="220">220</th><td>	<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>-&gt;<a class="ref field" href="../../../include/linux/input.h.html#input_dev::id" title='input_dev::id' data-ref="input_dev::id">id</a>.<a class="ref field" href="../../../include/uapi/linux/input.h.html#input_id::product" title='input_id::product' data-ref="input_id::product">product</a> = <a class="macro" href="#24" title="0xcafe" data-ref="_M/VMMDEV_DEVICEID">VMMDEV_DEVICEID</a>;</td></tr>
<tr><th id="221">221</th><td>	<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>-&gt;<a class="ref field" href="../../../include/linux/input.h.html#input_dev::open" title='input_dev::open' data-ref="input_dev::open">open</a> = <a class="tu ref fn" href="#vbg_input_open" title='vbg_input_open' data-use='r' data-ref="vbg_input_open">vbg_input_open</a>;</td></tr>
<tr><th id="222">222</th><td>	<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>-&gt;<a class="ref field" href="../../../include/linux/input.h.html#input_dev::close" title='input_dev::close' data-ref="input_dev::close">close</a> = <a class="tu ref fn" href="#vbg_input_close" title='vbg_input_close' data-use='r' data-ref="vbg_input_close">vbg_input_close</a>;</td></tr>
<tr><th id="223">223</th><td>	<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>-&gt;<a class="ref field" href="../../../include/linux/input.h.html#input_dev::dev" title='input_dev::dev' data-ref="input_dev::dev">dev</a>.<a class="ref field" href="../../../include/linux/device.h.html#device::parent" title='device::parent' data-ref="device::parent">parent</a> = <a class="local col8 ref" href="#28gdev" title='gdev' data-ref="28gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::dev" title='vbg_dev::dev' data-ref="vbg_dev::dev">dev</a>;</td></tr>
<tr><th id="224">224</th><td>	<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>-&gt;<a class="ref field" href="../../../include/linux/input.h.html#input_dev::name" title='input_dev::name' data-ref="input_dev::name">name</a> = <q>"VirtualBox mouse integration"</q>;</td></tr>
<tr><th id="225">225</th><td></td></tr>
<tr><th id="226">226</th><td>	<a class="ref fn" href="../../../include/linux/input.h.html#input_set_abs_params" title='input_set_abs_params' data-ref="input_set_abs_params">input_set_abs_params</a>(<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>, <a class="macro" href="../../../include/uapi/linux/input-event-codes.h.html#718" title="0x00" data-ref="_M/ABS_X">ABS_X</a>, <a class="macro" href="vmmdev.h.html#155" title="0" data-ref="_M/VMMDEV_MOUSE_RANGE_MIN">VMMDEV_MOUSE_RANGE_MIN</a>,</td></tr>
<tr><th id="227">227</th><td>			     <a class="macro" href="vmmdev.h.html#157" title="0xFFFF" data-ref="_M/VMMDEV_MOUSE_RANGE_MAX">VMMDEV_MOUSE_RANGE_MAX</a>, <var>0</var>, <var>0</var>);</td></tr>
<tr><th id="228">228</th><td>	<a class="ref fn" href="../../../include/linux/input.h.html#input_set_abs_params" title='input_set_abs_params' data-ref="input_set_abs_params">input_set_abs_params</a>(<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>, <a class="macro" href="../../../include/uapi/linux/input-event-codes.h.html#719" title="0x01" data-ref="_M/ABS_Y">ABS_Y</a>, <a class="macro" href="vmmdev.h.html#155" title="0" data-ref="_M/VMMDEV_MOUSE_RANGE_MIN">VMMDEV_MOUSE_RANGE_MIN</a>,</td></tr>
<tr><th id="229">229</th><td>			     <a class="macro" href="vmmdev.h.html#157" title="0xFFFF" data-ref="_M/VMMDEV_MOUSE_RANGE_MAX">VMMDEV_MOUSE_RANGE_MAX</a>, <var>0</var>, <var>0</var>);</td></tr>
<tr><th id="230">230</th><td>	<a class="ref fn" href="../../../include/linux/input.h.html#input_set_capability" title='input_set_capability' data-ref="input_set_capability">input_set_capability</a>(<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>, <a class="macro" href="../../../include/uapi/linux/input-event-codes.h.html#39" title="0x01" data-ref="_M/EV_KEY">EV_KEY</a>, <a class="macro" href="../../../include/uapi/linux/input-event-codes.h.html#354" title="0x110" data-ref="_M/BTN_MOUSE">BTN_MOUSE</a>);</td></tr>
<tr><th id="231">231</th><td>	<a class="ref fn" href="../../../include/linux/input.h.html#input_set_drvdata" title='input_set_drvdata' data-ref="input_set_drvdata">input_set_drvdata</a>(<a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>, <a class="local col8 ref" href="#28gdev" title='gdev' data-ref="28gdev">gdev</a>);</td></tr>
<tr><th id="232">232</th><td></td></tr>
<tr><th id="233">233</th><td>	<a class="local col8 ref" href="#28gdev" title='gdev' data-ref="28gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::input" title='vbg_dev::input' data-ref="vbg_dev::input">input</a> = <a class="local col9 ref" href="#29input" title='input' data-ref="29input">input</a>;</td></tr>
<tr><th id="234">234</th><td></td></tr>
<tr><th id="235">235</th><td>	<b>return</b> <a class="ref fn" href="../../../include/linux/input.h.html#input_register_device" title='input_register_device' data-ref="input_register_device">input_register_device</a>(<a class="local col8 ref" href="#28gdev" title='gdev' data-ref="28gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::input" title='vbg_dev::input' data-ref="vbg_dev::input">input</a>);</td></tr>
<tr><th id="236">236</th><td>}</td></tr>
<tr><th id="237">237</th><td></td></tr>
<tr><th id="238">238</th><td><em>static</em> <a class="typedef" href="../../../include/linux/types.h.html#ssize_t" title='ssize_t' data-type='__kernel_ssize_t' data-ref="ssize_t">ssize_t</a> <dfn class="tu decl def fn" id="host_version_show" title='host_version_show' data-type='ssize_t host_version_show(struct device * dev, struct device_attribute * attr, char * buf)' data-ref="host_version_show">host_version_show</dfn>(<b>struct</b> <a class="type" href="../../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col0 decl" id="30dev" title='dev' data-type='struct device *' data-ref="30dev">dev</dfn>,</td></tr>
<tr><th id="239">239</th><td>				 <b>struct</b> <a class="type" href="../../../include/linux/device.h.html#device_attribute" title='device_attribute' data-ref="device_attribute">device_attribute</a> *<dfn class="local col1 decl" id="31attr" title='attr' data-type='struct device_attribute *' data-ref="31attr">attr</dfn>, <em>char</em> *<dfn class="local col2 decl" id="32buf" title='buf' data-type='char *' data-ref="32buf">buf</dfn>)</td></tr>
<tr><th id="240">240</th><td>{</td></tr>
<tr><th id="241">241</th><td>	<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="local col3 decl" id="33gdev" title='gdev' data-type='struct vbg_dev *' data-ref="33gdev">gdev</dfn> = <a class="ref fn" href="../../../include/linux/device.h.html#dev_get_drvdata" title='dev_get_drvdata' data-ref="dev_get_drvdata">dev_get_drvdata</a>(<a class="local col0 ref" href="#30dev" title='dev' data-ref="30dev">dev</a>);</td></tr>
<tr><th id="242">242</th><td></td></tr>
<tr><th id="243">243</th><td>	<b>return</b> <a class="ref fn" href="../../../include/linux/kernel.h.html#sprintf" title='sprintf' data-ref="sprintf">sprintf</a>(<a class="local col2 ref" href="#32buf" title='buf' data-ref="32buf">buf</a>, <q>"%s\n"</q>, <a class="local col3 ref" href="#33gdev" title='gdev' data-ref="33gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::host_version" title='vbg_dev::host_version' data-ref="vbg_dev::host_version">host_version</a>);</td></tr>
<tr><th id="244">244</th><td>}</td></tr>
<tr><th id="245">245</th><td></td></tr>
<tr><th id="246">246</th><td><em>static</em> <a class="typedef" href="../../../include/linux/types.h.html#ssize_t" title='ssize_t' data-type='__kernel_ssize_t' data-ref="ssize_t">ssize_t</a> <dfn class="tu decl def fn" id="host_features_show" title='host_features_show' data-type='ssize_t host_features_show(struct device * dev, struct device_attribute * attr, char * buf)' data-ref="host_features_show">host_features_show</dfn>(<b>struct</b> <a class="type" href="../../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col4 decl" id="34dev" title='dev' data-type='struct device *' data-ref="34dev">dev</dfn>,</td></tr>
<tr><th id="247">247</th><td>				 <b>struct</b> <a class="type" href="../../../include/linux/device.h.html#device_attribute" title='device_attribute' data-ref="device_attribute">device_attribute</a> *<dfn class="local col5 decl" id="35attr" title='attr' data-type='struct device_attribute *' data-ref="35attr">attr</dfn>, <em>char</em> *<dfn class="local col6 decl" id="36buf" title='buf' data-type='char *' data-ref="36buf">buf</dfn>)</td></tr>
<tr><th id="248">248</th><td>{</td></tr>
<tr><th id="249">249</th><td>	<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="local col7 decl" id="37gdev" title='gdev' data-type='struct vbg_dev *' data-ref="37gdev">gdev</dfn> = <a class="ref fn" href="../../../include/linux/device.h.html#dev_get_drvdata" title='dev_get_drvdata' data-ref="dev_get_drvdata">dev_get_drvdata</a>(<a class="local col4 ref" href="#34dev" title='dev' data-ref="34dev">dev</a>);</td></tr>
<tr><th id="250">250</th><td></td></tr>
<tr><th id="251">251</th><td>	<b>return</b> <a class="ref fn" href="../../../include/linux/kernel.h.html#sprintf" title='sprintf' data-ref="sprintf">sprintf</a>(<a class="local col6 ref" href="#36buf" title='buf' data-ref="36buf">buf</a>, <q>"%#x\n"</q>, <a class="local col7 ref" href="#37gdev" title='gdev' data-ref="37gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::host_features" title='vbg_dev::host_features' data-ref="vbg_dev::host_features">host_features</a>);</td></tr>
<tr><th id="252">252</th><td>}</td></tr>
<tr><th id="253">253</th><td></td></tr>
<tr><th id="254">254</th><td><em>static</em> <a class="macro" href="../../../include/linux/device.h.html#590" title="struct device_attribute dev_attr_host_version = { .attr = { .name = &quot;host_version&quot;, .mode = 0444 }, .show = host_version_show, }" data-ref="_M/DEVICE_ATTR_RO">DEVICE_ATTR_RO</a>(host_version);</td></tr>
<tr><th id="255">255</th><td><em>static</em> <a class="macro" href="../../../include/linux/device.h.html#590" title="struct device_attribute dev_attr_host_features = { .attr = { .name = &quot;host_features&quot;, .mode = 0444 }, .show = host_features_show, }" data-ref="_M/DEVICE_ATTR_RO">DEVICE_ATTR_RO</a>(host_features);</td></tr>
<tr><th id="256">256</th><td></td></tr>
<tr><th id="257">257</th><td><i class="doc" data-doc="vbg_pci_probe">/**</i></td></tr>
<tr><th id="258">258</th><td><i class="doc" data-doc="vbg_pci_probe"> * Does the PCI detection and init of the device.</i></td></tr>
<tr><th id="259">259</th><td><i class="doc" data-doc="vbg_pci_probe"> *</i></td></tr>
<tr><th id="260">260</th><td><i class="doc" data-doc="vbg_pci_probe"> * Return: 0 on success, negated errno on failure.</i></td></tr>
<tr><th id="261">261</th><td><i class="doc" data-doc="vbg_pci_probe"> */</i></td></tr>
<tr><th id="262">262</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vbg_pci_probe" title='vbg_pci_probe' data-type='int vbg_pci_probe(struct pci_dev * pci, const struct pci_device_id * id)' data-ref="vbg_pci_probe">vbg_pci_probe</dfn>(<b>struct</b> <a class="type" href="../../../include/linux/pci.h.html#pci_dev" title='pci_dev' data-ref="pci_dev">pci_dev</a> *<dfn class="local col8 decl" id="38pci" title='pci' data-type='struct pci_dev *' data-ref="38pci">pci</dfn>, <em>const</em> <b>struct</b> <a class="type" href="../../../include/linux/mod_devicetable.h.html#pci_device_id" title='pci_device_id' data-ref="pci_device_id">pci_device_id</a> *<dfn class="local col9 decl" id="39id" title='id' data-type='const struct pci_device_id *' data-ref="39id">id</dfn>)</td></tr>
<tr><th id="263">263</th><td>{</td></tr>
<tr><th id="264">264</th><td>	<b>struct</b> <a class="type" href="../../../include/linux/device.h.html#device" title='device' data-ref="device">device</a> *<dfn class="local col0 decl" id="40dev" title='dev' data-type='struct device *' data-ref="40dev">dev</dfn> = &amp;<a class="local col8 ref" href="#38pci" title='pci' data-ref="38pci">pci</a>-&gt;<a class="ref field" href="../../../include/linux/pci.h.html#pci_dev::dev" title='pci_dev::dev' data-ref="pci_dev::dev">dev</a>;</td></tr>
<tr><th id="265">265</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#resource_size_t" title='resource_size_t' data-type='phys_addr_t' data-ref="resource_size_t">resource_size_t</a> <dfn class="local col1 decl" id="41io" title='io' data-type='resource_size_t' data-ref="41io">io</dfn>, <dfn class="local col2 decl" id="42io_len" title='io_len' data-type='resource_size_t' data-ref="42io_len">io_len</dfn>, <dfn class="local col3 decl" id="43mmio" title='mmio' data-type='resource_size_t' data-ref="43mmio">mmio</dfn>, <dfn class="local col4 decl" id="44mmio_len" title='mmio_len' data-type='resource_size_t' data-ref="44mmio_len">mmio_len</dfn>;</td></tr>
<tr><th id="266">266</th><td>	<b>struct</b> <a class="type" href="vmmdev.h.html#vmmdev_memory" title='vmmdev_memory' data-ref="vmmdev_memory">vmmdev_memory</a> *<dfn class="local col5 decl" id="45vmmdev" title='vmmdev' data-type='struct vmmdev_memory *' data-ref="45vmmdev">vmmdev</dfn>;</td></tr>
<tr><th id="267">267</th><td>	<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="local col6 decl" id="46gdev" title='gdev' data-type='struct vbg_dev *' data-ref="46gdev">gdev</dfn>;</td></tr>
<tr><th id="268">268</th><td>	<em>int</em> <dfn class="local col7 decl" id="47ret" title='ret' data-type='int' data-ref="47ret">ret</dfn>;</td></tr>
<tr><th id="269">269</th><td></td></tr>
<tr><th id="270">270</th><td>	<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a> = <a class="ref fn" href="../../../include/linux/device.h.html#devm_kzalloc" title='devm_kzalloc' data-ref="devm_kzalloc">devm_kzalloc</a>(<a class="local col0 ref" href="#40dev" title='dev' data-ref="40dev">dev</a>, <b>sizeof</b>(*<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>), <a class="macro" href="../../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x200000u|0x400000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="271">271</th><td>	<b>if</b> (!<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>)</td></tr>
<tr><th id="272">272</th><td>		<b>return</b> -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="273">273</th><td></td></tr>
<tr><th id="274">274</th><td>	<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a> = <a class="ref fn" href="../../../include/linux/pci.h.html#pci_enable_device" title='pci_enable_device' data-ref="pci_enable_device">pci_enable_device</a>(<a class="local col8 ref" href="#38pci" title='pci' data-ref="38pci">pci</a>);</td></tr>
<tr><th id="275">275</th><td>	<b>if</b> (<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a> != <var>0</var>) {</td></tr>
<tr><th id="276">276</th><td>		<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_err" title='vbg_err' data-ref="vbg_err">vbg_err</a>(<q>"vboxguest: Error enabling device: %d\n"</q>, <a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>);</td></tr>
<tr><th id="277">277</th><td>		<b>return</b> <a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>;</td></tr>
<tr><th id="278">278</th><td>	}</td></tr>
<tr><th id="279">279</th><td></td></tr>
<tr><th id="280">280</th><td>	<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a> = -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#23" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="281">281</th><td></td></tr>
<tr><th id="282">282</th><td>	<a class="local col1 ref" href="#41io" title='io' data-ref="41io">io</a> = <a class="macro" href="../../../include/linux/pci.h.html#1736" title="((pci)-&gt;resource[(0)].start)" data-ref="_M/pci_resource_start">pci_resource_start</a>(<a class="local col8 ref" href="#38pci" title='pci' data-ref="38pci">pci</a>, <var>0</var>);</td></tr>
<tr><th id="283">283</th><td>	<a class="local col2 ref" href="#42io_len" title='io_len' data-ref="42io_len">io_len</a> = <a class="macro" href="../../../include/linux/pci.h.html#1739" title="(((((pci))-&gt;resource[((0))].start) == 0 &amp;&amp; (((pci))-&gt;resource[((0))].end) == (((pci))-&gt;resource[((0))].start)) ? 0 : ((((pci))-&gt;resource[((0))].end) - (((pci))-&gt;resource[((0))].start) + 1))" data-ref="_M/pci_resource_len">pci_resource_len</a>(<a class="local col8 ref" href="#38pci" title='pci' data-ref="38pci">pci</a>, <var>0</var>);</td></tr>
<tr><th id="284">284</th><td>	<b>if</b> (!<a class="local col1 ref" href="#41io" title='io' data-ref="41io">io</a> || !<a class="local col2 ref" href="#42io_len" title='io_len' data-ref="42io_len">io_len</a>) {</td></tr>
<tr><th id="285">285</th><td>		<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_err" title='vbg_err' data-ref="vbg_err">vbg_err</a>(<q>"vboxguest: Error IO-port resource (0) is missing\n"</q>);</td></tr>
<tr><th id="286">286</th><td>		<b>goto</b> <a class="lbl" href="#48err_disable_pcidev" data-ref="48err_disable_pcidev">err_disable_pcidev</a>;</td></tr>
<tr><th id="287">287</th><td>	}</td></tr>
<tr><th id="288">288</th><td>	<b>if</b> (<a class="macro" href="../../../include/linux/ioport.h.html#251" title="__devm_request_region(dev, &amp;ioport_resource, (io), (io_len), (&quot;vboxguest&quot;))" data-ref="_M/devm_request_region">devm_request_region</a>(<a class="local col0 ref" href="#40dev" title='dev' data-ref="40dev">dev</a>, <a class="local col1 ref" href="#41io" title='io' data-ref="41io">io</a>, <a class="local col2 ref" href="#42io_len" title='io_len' data-ref="42io_len">io_len</a>, <a class="macro" href="#18" title="&quot;vboxguest&quot;" data-ref="_M/DEVICE_NAME">DEVICE_NAME</a>) == <a class="macro" href="../../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="289">289</th><td>		<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_err" title='vbg_err' data-ref="vbg_err">vbg_err</a>(<q>"vboxguest: Error could not claim IO resource\n"</q>);</td></tr>
<tr><th id="290">290</th><td>		<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a> = -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#20" title="16" data-ref="_M/EBUSY">EBUSY</a>;</td></tr>
<tr><th id="291">291</th><td>		<b>goto</b> <a class="lbl" href="#48err_disable_pcidev" data-ref="48err_disable_pcidev">err_disable_pcidev</a>;</td></tr>
<tr><th id="292">292</th><td>	}</td></tr>
<tr><th id="293">293</th><td></td></tr>
<tr><th id="294">294</th><td>	<a class="local col3 ref" href="#43mmio" title='mmio' data-ref="43mmio">mmio</a> = <a class="macro" href="../../../include/linux/pci.h.html#1736" title="((pci)-&gt;resource[(1)].start)" data-ref="_M/pci_resource_start">pci_resource_start</a>(<a class="local col8 ref" href="#38pci" title='pci' data-ref="38pci">pci</a>, <var>1</var>);</td></tr>
<tr><th id="295">295</th><td>	<a class="local col4 ref" href="#44mmio_len" title='mmio_len' data-ref="44mmio_len">mmio_len</a> = <a class="macro" href="../../../include/linux/pci.h.html#1739" title="(((((pci))-&gt;resource[((1))].start) == 0 &amp;&amp; (((pci))-&gt;resource[((1))].end) == (((pci))-&gt;resource[((1))].start)) ? 0 : ((((pci))-&gt;resource[((1))].end) - (((pci))-&gt;resource[((1))].start) + 1))" data-ref="_M/pci_resource_len">pci_resource_len</a>(<a class="local col8 ref" href="#38pci" title='pci' data-ref="38pci">pci</a>, <var>1</var>);</td></tr>
<tr><th id="296">296</th><td>	<b>if</b> (!<a class="local col3 ref" href="#43mmio" title='mmio' data-ref="43mmio">mmio</a> || !<a class="local col4 ref" href="#44mmio_len" title='mmio_len' data-ref="44mmio_len">mmio_len</a>) {</td></tr>
<tr><th id="297">297</th><td>		<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_err" title='vbg_err' data-ref="vbg_err">vbg_err</a>(<q>"vboxguest: Error MMIO resource (1) is missing\n"</q>);</td></tr>
<tr><th id="298">298</th><td>		<b>goto</b> <a class="lbl" href="#48err_disable_pcidev" data-ref="48err_disable_pcidev">err_disable_pcidev</a>;</td></tr>
<tr><th id="299">299</th><td>	}</td></tr>
<tr><th id="300">300</th><td></td></tr>
<tr><th id="301">301</th><td>	<b>if</b> (<a class="macro" href="../../../include/linux/ioport.h.html#253" title="__devm_request_region(dev, &amp;iomem_resource, (mmio), (mmio_len), (&quot;vboxguest&quot;))" data-ref="_M/devm_request_mem_region">devm_request_mem_region</a>(<a class="local col0 ref" href="#40dev" title='dev' data-ref="40dev">dev</a>, <a class="local col3 ref" href="#43mmio" title='mmio' data-ref="43mmio">mmio</a>, <a class="local col4 ref" href="#44mmio_len" title='mmio_len' data-ref="44mmio_len">mmio_len</a>, <a class="macro" href="#18" title="&quot;vboxguest&quot;" data-ref="_M/DEVICE_NAME">DEVICE_NAME</a>) == <a class="macro" href="../../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="302">302</th><td>		<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_err" title='vbg_err' data-ref="vbg_err">vbg_err</a>(<q>"vboxguest: Error could not claim MMIO resource\n"</q>);</td></tr>
<tr><th id="303">303</th><td>		<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a> = -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#20" title="16" data-ref="_M/EBUSY">EBUSY</a>;</td></tr>
<tr><th id="304">304</th><td>		<b>goto</b> <a class="lbl" href="#48err_disable_pcidev" data-ref="48err_disable_pcidev">err_disable_pcidev</a>;</td></tr>
<tr><th id="305">305</th><td>	}</td></tr>
<tr><th id="306">306</th><td></td></tr>
<tr><th id="307">307</th><td>	<a class="local col5 ref" href="#45vmmdev" title='vmmdev' data-ref="45vmmdev">vmmdev</a> = <a class="ref fn" href="../../../include/linux/io.h.html#devm_ioremap" title='devm_ioremap' data-ref="devm_ioremap">devm_ioremap</a>(<a class="local col0 ref" href="#40dev" title='dev' data-ref="40dev">dev</a>, <a class="local col3 ref" href="#43mmio" title='mmio' data-ref="43mmio">mmio</a>, <a class="local col4 ref" href="#44mmio_len" title='mmio_len' data-ref="44mmio_len">mmio_len</a>);</td></tr>
<tr><th id="308">308</th><td>	<b>if</b> (!<a class="local col5 ref" href="#45vmmdev" title='vmmdev' data-ref="45vmmdev">vmmdev</a>) {</td></tr>
<tr><th id="309">309</th><td>		<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_err" title='vbg_err' data-ref="vbg_err">vbg_err</a>(<q>"vboxguest: Error ioremap failed; MMIO addr=%pap size=%pap\n"</q>,</td></tr>
<tr><th id="310">310</th><td>			&amp;<a class="local col3 ref" href="#43mmio" title='mmio' data-ref="43mmio">mmio</a>, &amp;<a class="local col4 ref" href="#44mmio_len" title='mmio_len' data-ref="44mmio_len">mmio_len</a>);</td></tr>
<tr><th id="311">311</th><td>		<b>goto</b> <a class="lbl" href="#48err_disable_pcidev" data-ref="48err_disable_pcidev">err_disable_pcidev</a>;</td></tr>
<tr><th id="312">312</th><td>	}</td></tr>
<tr><th id="313">313</th><td></td></tr>
<tr><th id="314">314</th><td>	<i>/* Validate MMIO region version and size. */</i></td></tr>
<tr><th id="315">315</th><td>	<b>if</b> (<a class="local col5 ref" href="#45vmmdev" title='vmmdev' data-ref="45vmmdev">vmmdev</a>-&gt;<a class="ref field" href="vmmdev.h.html#vmmdev_memory::version" title='vmmdev_memory::version' data-ref="vmmdev_memory::version">version</a> != <a class="macro" href="vmmdev.h.html#47" title="(1)" data-ref="_M/VMMDEV_MEMORY_VERSION">VMMDEV_MEMORY_VERSION</a> ||</td></tr>
<tr><th id="316">316</th><td>	    <a class="local col5 ref" href="#45vmmdev" title='vmmdev' data-ref="45vmmdev">vmmdev</a>-&gt;<a class="ref field" href="vmmdev.h.html#vmmdev_memory::size" title='vmmdev_memory::size' data-ref="vmmdev_memory::size">size</a> &lt; <var>32</var> || <a class="local col5 ref" href="#45vmmdev" title='vmmdev' data-ref="45vmmdev">vmmdev</a>-&gt;<a class="ref field" href="vmmdev.h.html#vmmdev_memory::size" title='vmmdev_memory::size' data-ref="vmmdev_memory::size">size</a> &gt; <a class="local col4 ref" href="#44mmio_len" title='mmio_len' data-ref="44mmio_len">mmio_len</a>) {</td></tr>
<tr><th id="317">317</th><td>		<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_err" title='vbg_err' data-ref="vbg_err">vbg_err</a>(<q>"vboxguest: Bogus VMMDev memory; version=%08x (expected %08x) size=%d (expected &lt;= %d)\n"</q>,</td></tr>
<tr><th id="318">318</th><td>			<a class="local col5 ref" href="#45vmmdev" title='vmmdev' data-ref="45vmmdev">vmmdev</a>-&gt;<a class="ref field" href="vmmdev.h.html#vmmdev_memory::version" title='vmmdev_memory::version' data-ref="vmmdev_memory::version">version</a>, <a class="macro" href="vmmdev.h.html#47" title="(1)" data-ref="_M/VMMDEV_MEMORY_VERSION">VMMDEV_MEMORY_VERSION</a>,</td></tr>
<tr><th id="319">319</th><td>			<a class="local col5 ref" href="#45vmmdev" title='vmmdev' data-ref="45vmmdev">vmmdev</a>-&gt;<a class="ref field" href="vmmdev.h.html#vmmdev_memory::size" title='vmmdev_memory::size' data-ref="vmmdev_memory::size">size</a>, (<em>int</em>)<a class="local col4 ref" href="#44mmio_len" title='mmio_len' data-ref="44mmio_len">mmio_len</a>);</td></tr>
<tr><th id="320">320</th><td>		<b>goto</b> <a class="lbl" href="#48err_disable_pcidev" data-ref="48err_disable_pcidev">err_disable_pcidev</a>;</td></tr>
<tr><th id="321">321</th><td>	}</td></tr>
<tr><th id="322">322</th><td></td></tr>
<tr><th id="323">323</th><td>	<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::io_port" title='vbg_dev::io_port' data-ref="vbg_dev::io_port">io_port</a> = <a class="local col1 ref" href="#41io" title='io' data-ref="41io">io</a>;</td></tr>
<tr><th id="324">324</th><td>	<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::mmio" title='vbg_dev::mmio' data-ref="vbg_dev::mmio">mmio</a> = <a class="local col5 ref" href="#45vmmdev" title='vmmdev' data-ref="45vmmdev">vmmdev</a>;</td></tr>
<tr><th id="325">325</th><td>	<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::dev" title='vbg_dev::dev' data-ref="vbg_dev::dev">dev</a> = <a class="local col0 ref" href="#40dev" title='dev' data-ref="40dev">dev</a>;</td></tr>
<tr><th id="326">326</th><td>	<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device" title='vbg_dev::misc_device' data-ref="vbg_dev::misc_device">misc_device</a>.<a class="ref field" href="../../../include/linux/miscdevice.h.html#miscdevice::minor" title='miscdevice::minor' data-ref="miscdevice::minor">minor</a> = <a class="macro" href="../../../include/linux/miscdevice.h.html#60" title="255" data-ref="_M/MISC_DYNAMIC_MINOR">MISC_DYNAMIC_MINOR</a>;</td></tr>
<tr><th id="327">327</th><td>	<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device" title='vbg_dev::misc_device' data-ref="vbg_dev::misc_device">misc_device</a>.<a class="ref field" href="../../../include/linux/miscdevice.h.html#miscdevice::name" title='miscdevice::name' data-ref="miscdevice::name">name</a> = <a class="macro" href="#18" title="&quot;vboxguest&quot;" data-ref="_M/DEVICE_NAME">DEVICE_NAME</a>;</td></tr>
<tr><th id="328">328</th><td>	<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device" title='vbg_dev::misc_device' data-ref="vbg_dev::misc_device">misc_device</a>.<a class="ref field" href="../../../include/linux/miscdevice.h.html#miscdevice::fops" title='miscdevice::fops' data-ref="miscdevice::fops">fops</a> = &amp;<a class="tu ref" href="#vbg_misc_device_fops" title='vbg_misc_device_fops' data-use='a' data-ref="vbg_misc_device_fops">vbg_misc_device_fops</a>;</td></tr>
<tr><th id="329">329</th><td>	<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device_user" title='vbg_dev::misc_device_user' data-ref="vbg_dev::misc_device_user">misc_device_user</a>.<a class="ref field" href="../../../include/linux/miscdevice.h.html#miscdevice::minor" title='miscdevice::minor' data-ref="miscdevice::minor">minor</a> = <a class="macro" href="../../../include/linux/miscdevice.h.html#60" title="255" data-ref="_M/MISC_DYNAMIC_MINOR">MISC_DYNAMIC_MINOR</a>;</td></tr>
<tr><th id="330">330</th><td>	<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device_user" title='vbg_dev::misc_device_user' data-ref="vbg_dev::misc_device_user">misc_device_user</a>.<a class="ref field" href="../../../include/linux/miscdevice.h.html#miscdevice::name" title='miscdevice::name' data-ref="miscdevice::name">name</a> = <a class="macro" href="#20" title="&quot;vboxuser&quot;" data-ref="_M/DEVICE_NAME_USER">DEVICE_NAME_USER</a>;</td></tr>
<tr><th id="331">331</th><td>	<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device_user" title='vbg_dev::misc_device_user' data-ref="vbg_dev::misc_device_user">misc_device_user</a>.<a class="ref field" href="../../../include/linux/miscdevice.h.html#miscdevice::fops" title='miscdevice::fops' data-ref="miscdevice::fops">fops</a> = &amp;<a class="tu ref" href="#vbg_misc_device_user_fops" title='vbg_misc_device_user_fops' data-use='a' data-ref="vbg_misc_device_user_fops">vbg_misc_device_user_fops</a>;</td></tr>
<tr><th id="332">332</th><td></td></tr>
<tr><th id="333">333</th><td>	<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a> = <a class="ref fn" href="vboxguest_core.h.html#vbg_core_init" title='vbg_core_init' data-ref="vbg_core_init">vbg_core_init</a>(<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>, <a class="macro" href="vmmdev.h.html#68" title="(1UL &lt;&lt; (9))" data-ref="_M/VMMDEV_EVENT_MOUSE_POSITION_CHANGED">VMMDEV_EVENT_MOUSE_POSITION_CHANGED</a>);</td></tr>
<tr><th id="334">334</th><td>	<b>if</b> (<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>)</td></tr>
<tr><th id="335">335</th><td>		<b>goto</b> <a class="lbl" href="#48err_disable_pcidev" data-ref="48err_disable_pcidev">err_disable_pcidev</a>;</td></tr>
<tr><th id="336">336</th><td></td></tr>
<tr><th id="337">337</th><td>	<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a> = <a class="tu ref fn" href="#vbg_create_input_device" title='vbg_create_input_device' data-use='c' data-ref="vbg_create_input_device">vbg_create_input_device</a>(<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>);</td></tr>
<tr><th id="338">338</th><td>	<b>if</b> (<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>) {</td></tr>
<tr><th id="339">339</th><td>		<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_err" title='vbg_err' data-ref="vbg_err">vbg_err</a>(<q>"vboxguest: Error creating input device: %d\n"</q>, <a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>);</td></tr>
<tr><th id="340">340</th><td>		<b>goto</b> <a class="lbl" href="#49err_vbg_core_exit" data-ref="49err_vbg_core_exit">err_vbg_core_exit</a>;</td></tr>
<tr><th id="341">341</th><td>	}</td></tr>
<tr><th id="342">342</th><td></td></tr>
<tr><th id="343">343</th><td>	<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a> = <a class="ref fn" href="../../../include/linux/interrupt.h.html#devm_request_irq" title='devm_request_irq' data-ref="devm_request_irq">devm_request_irq</a>(<a class="local col0 ref" href="#40dev" title='dev' data-ref="40dev">dev</a>, <a class="local col8 ref" href="#38pci" title='pci' data-ref="38pci">pci</a>-&gt;<a class="ref field" href="../../../include/linux/pci.h.html#pci_dev::irq" title='pci_dev::irq' data-ref="pci_dev::irq">irq</a>, <a class="ref fn" href="vboxguest_core.h.html#vbg_core_isr" title='vbg_core_isr' data-ref="vbg_core_isr">vbg_core_isr</a>, <a class="macro" href="../../../include/linux/interrupt.h.html#65" title="0x00000080" data-ref="_M/IRQF_SHARED">IRQF_SHARED</a>,</td></tr>
<tr><th id="344">344</th><td>			       <a class="macro" href="#18" title="&quot;vboxguest&quot;" data-ref="_M/DEVICE_NAME">DEVICE_NAME</a>, <a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>);</td></tr>
<tr><th id="345">345</th><td>	<b>if</b> (<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>) {</td></tr>
<tr><th id="346">346</th><td>		<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_err" title='vbg_err' data-ref="vbg_err">vbg_err</a>(<q>"vboxguest: Error requesting irq: %d\n"</q>, <a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>);</td></tr>
<tr><th id="347">347</th><td>		<b>goto</b> <a class="lbl" href="#49err_vbg_core_exit" data-ref="49err_vbg_core_exit">err_vbg_core_exit</a>;</td></tr>
<tr><th id="348">348</th><td>	}</td></tr>
<tr><th id="349">349</th><td></td></tr>
<tr><th id="350">350</th><td>	<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a> = <a class="ref fn" href="../../../include/linux/miscdevice.h.html#misc_register" title='misc_register' data-ref="misc_register">misc_register</a>(&amp;<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device" title='vbg_dev::misc_device' data-ref="vbg_dev::misc_device">misc_device</a>);</td></tr>
<tr><th id="351">351</th><td>	<b>if</b> (<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>) {</td></tr>
<tr><th id="352">352</th><td>		<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_err" title='vbg_err' data-ref="vbg_err">vbg_err</a>(<q>"vboxguest: Error misc_register %s failed: %d\n"</q>,</td></tr>
<tr><th id="353">353</th><td>			<a class="macro" href="#18" title="&quot;vboxguest&quot;" data-ref="_M/DEVICE_NAME">DEVICE_NAME</a>, <a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>);</td></tr>
<tr><th id="354">354</th><td>		<b>goto</b> <a class="lbl" href="#49err_vbg_core_exit" data-ref="49err_vbg_core_exit">err_vbg_core_exit</a>;</td></tr>
<tr><th id="355">355</th><td>	}</td></tr>
<tr><th id="356">356</th><td></td></tr>
<tr><th id="357">357</th><td>	<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a> = <a class="ref fn" href="../../../include/linux/miscdevice.h.html#misc_register" title='misc_register' data-ref="misc_register">misc_register</a>(&amp;<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device_user" title='vbg_dev::misc_device_user' data-ref="vbg_dev::misc_device_user">misc_device_user</a>);</td></tr>
<tr><th id="358">358</th><td>	<b>if</b> (<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>) {</td></tr>
<tr><th id="359">359</th><td>		<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_err" title='vbg_err' data-ref="vbg_err">vbg_err</a>(<q>"vboxguest: Error misc_register %s failed: %d\n"</q>,</td></tr>
<tr><th id="360">360</th><td>			<a class="macro" href="#20" title="&quot;vboxuser&quot;" data-ref="_M/DEVICE_NAME_USER">DEVICE_NAME_USER</a>, <a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>);</td></tr>
<tr><th id="361">361</th><td>		<b>goto</b> <a class="lbl" href="#50err_unregister_misc_device" data-ref="50err_unregister_misc_device">err_unregister_misc_device</a>;</td></tr>
<tr><th id="362">362</th><td>	}</td></tr>
<tr><th id="363">363</th><td></td></tr>
<tr><th id="364">364</th><td>	<a class="ref fn" href="../../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='a' data-ref="vbg_gdev_mutex">vbg_gdev_mutex</a>);</td></tr>
<tr><th id="365">365</th><td>	<b>if</b> (!<a class="tu ref" href="#vbg_gdev" title='vbg_gdev' data-use='r' data-ref="vbg_gdev">vbg_gdev</a>)</td></tr>
<tr><th id="366">366</th><td>		<a class="tu ref" href="#vbg_gdev" title='vbg_gdev' data-use='w' data-ref="vbg_gdev">vbg_gdev</a> = <a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>;</td></tr>
<tr><th id="367">367</th><td>	<b>else</b></td></tr>
<tr><th id="368">368</th><td>		<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a> = -<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#20" title="16" data-ref="_M/EBUSY">EBUSY</a>;</td></tr>
<tr><th id="369">369</th><td>	<a class="ref fn" href="../../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='a' data-ref="vbg_gdev_mutex">vbg_gdev_mutex</a>);</td></tr>
<tr><th id="370">370</th><td></td></tr>
<tr><th id="371">371</th><td>	<b>if</b> (<a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>) {</td></tr>
<tr><th id="372">372</th><td>		<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_err" title='vbg_err' data-ref="vbg_err">vbg_err</a>(<q>"vboxguest: Error more then 1 vbox guest pci device\n"</q>);</td></tr>
<tr><th id="373">373</th><td>		<b>goto</b> <a class="lbl" href="#51err_unregister_misc_device_user" data-ref="51err_unregister_misc_device_user">err_unregister_misc_device_user</a>;</td></tr>
<tr><th id="374">374</th><td>	}</td></tr>
<tr><th id="375">375</th><td></td></tr>
<tr><th id="376">376</th><td>	<a class="ref fn" href="../../../include/linux/pci.h.html#pci_set_drvdata" title='pci_set_drvdata' data-ref="pci_set_drvdata">pci_set_drvdata</a>(<a class="local col8 ref" href="#38pci" title='pci' data-ref="38pci">pci</a>, <a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>);</td></tr>
<tr><th id="377">377</th><td>	<a class="ref fn" href="../../../include/linux/device.h.html#device_create_file" title='device_create_file' data-ref="device_create_file">device_create_file</a>(<a class="local col0 ref" href="#40dev" title='dev' data-ref="40dev">dev</a>, &amp;<a class="tu ref" href="#254" title='dev_attr_host_version' data-use='a' data-ref="dev_attr_host_version">dev_attr_host_version</a>);</td></tr>
<tr><th id="378">378</th><td>	<a class="ref fn" href="../../../include/linux/device.h.html#device_create_file" title='device_create_file' data-ref="device_create_file">device_create_file</a>(<a class="local col0 ref" href="#40dev" title='dev' data-ref="40dev">dev</a>, &amp;<a class="tu ref" href="#255" title='dev_attr_host_features' data-use='a' data-ref="dev_attr_host_features">dev_attr_host_features</a>);</td></tr>
<tr><th id="379">379</th><td></td></tr>
<tr><th id="380">380</th><td>	<a class="ref fn" href="../../../include/linux/vbox_utils.h.html#vbg_info" title='vbg_info' data-ref="vbg_info">vbg_info</a>(<q>"vboxguest: misc device minor %d, IRQ %d, I/O port %x, MMIO at %pap (size %pap)\n"</q>,</td></tr>
<tr><th id="381">381</th><td>		 <a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device" title='vbg_dev::misc_device' data-ref="vbg_dev::misc_device">misc_device</a>.<a class="ref field" href="../../../include/linux/miscdevice.h.html#miscdevice::minor" title='miscdevice::minor' data-ref="miscdevice::minor">minor</a>, <a class="local col8 ref" href="#38pci" title='pci' data-ref="38pci">pci</a>-&gt;<a class="ref field" href="../../../include/linux/pci.h.html#pci_dev::irq" title='pci_dev::irq' data-ref="pci_dev::irq">irq</a>, <a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::io_port" title='vbg_dev::io_port' data-ref="vbg_dev::io_port">io_port</a>,</td></tr>
<tr><th id="382">382</th><td>		 &amp;<a class="local col3 ref" href="#43mmio" title='mmio' data-ref="43mmio">mmio</a>, &amp;<a class="local col4 ref" href="#44mmio_len" title='mmio_len' data-ref="44mmio_len">mmio_len</a>);</td></tr>
<tr><th id="383">383</th><td></td></tr>
<tr><th id="384">384</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="385">385</th><td></td></tr>
<tr><th id="386">386</th><td><dfn class="lbl" id="51err_unregister_misc_device_user" data-ref="51err_unregister_misc_device_user">err_unregister_misc_device_user</dfn>:</td></tr>
<tr><th id="387">387</th><td>	<a class="ref fn" href="../../../include/linux/miscdevice.h.html#misc_deregister" title='misc_deregister' data-ref="misc_deregister">misc_deregister</a>(&amp;<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device_user" title='vbg_dev::misc_device_user' data-ref="vbg_dev::misc_device_user">misc_device_user</a>);</td></tr>
<tr><th id="388">388</th><td><dfn class="lbl" id="50err_unregister_misc_device" data-ref="50err_unregister_misc_device">err_unregister_misc_device</dfn>:</td></tr>
<tr><th id="389">389</th><td>	<a class="ref fn" href="../../../include/linux/miscdevice.h.html#misc_deregister" title='misc_deregister' data-ref="misc_deregister">misc_deregister</a>(&amp;<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device" title='vbg_dev::misc_device' data-ref="vbg_dev::misc_device">misc_device</a>);</td></tr>
<tr><th id="390">390</th><td><dfn class="lbl" id="49err_vbg_core_exit" data-ref="49err_vbg_core_exit">err_vbg_core_exit</dfn>:</td></tr>
<tr><th id="391">391</th><td>	<a class="ref fn" href="vboxguest_core.h.html#vbg_core_exit" title='vbg_core_exit' data-ref="vbg_core_exit">vbg_core_exit</a>(<a class="local col6 ref" href="#46gdev" title='gdev' data-ref="46gdev">gdev</a>);</td></tr>
<tr><th id="392">392</th><td><dfn class="lbl" id="48err_disable_pcidev" data-ref="48err_disable_pcidev">err_disable_pcidev</dfn>:</td></tr>
<tr><th id="393">393</th><td>	<a class="ref fn" href="../../../include/linux/pci.h.html#pci_disable_device" title='pci_disable_device' data-ref="pci_disable_device">pci_disable_device</a>(<a class="local col8 ref" href="#38pci" title='pci' data-ref="38pci">pci</a>);</td></tr>
<tr><th id="394">394</th><td></td></tr>
<tr><th id="395">395</th><td>	<b>return</b> <a class="local col7 ref" href="#47ret" title='ret' data-ref="47ret">ret</a>;</td></tr>
<tr><th id="396">396</th><td>}</td></tr>
<tr><th id="397">397</th><td></td></tr>
<tr><th id="398">398</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="vbg_pci_remove" title='vbg_pci_remove' data-type='void vbg_pci_remove(struct pci_dev * pci)' data-ref="vbg_pci_remove">vbg_pci_remove</dfn>(<b>struct</b> <a class="type" href="../../../include/linux/pci.h.html#pci_dev" title='pci_dev' data-ref="pci_dev">pci_dev</a> *<dfn class="local col2 decl" id="52pci" title='pci' data-type='struct pci_dev *' data-ref="52pci">pci</dfn>)</td></tr>
<tr><th id="399">399</th><td>{</td></tr>
<tr><th id="400">400</th><td>	<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="local col3 decl" id="53gdev" title='gdev' data-type='struct vbg_dev *' data-ref="53gdev">gdev</dfn> = <a class="ref fn" href="../../../include/linux/pci.h.html#pci_get_drvdata" title='pci_get_drvdata' data-ref="pci_get_drvdata">pci_get_drvdata</a>(<a class="local col2 ref" href="#52pci" title='pci' data-ref="52pci">pci</a>);</td></tr>
<tr><th id="401">401</th><td></td></tr>
<tr><th id="402">402</th><td>	<a class="ref fn" href="../../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='a' data-ref="vbg_gdev_mutex">vbg_gdev_mutex</a>);</td></tr>
<tr><th id="403">403</th><td>	<a class="tu ref" href="#vbg_gdev" title='vbg_gdev' data-use='w' data-ref="vbg_gdev">vbg_gdev</a> = <a class="macro" href="../../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="404">404</th><td>	<a class="ref fn" href="../../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='a' data-ref="vbg_gdev_mutex">vbg_gdev_mutex</a>);</td></tr>
<tr><th id="405">405</th><td></td></tr>
<tr><th id="406">406</th><td>	<a class="ref fn" href="../../../include/linux/device.h.html#device_remove_file" title='device_remove_file' data-ref="device_remove_file">device_remove_file</a>(<a class="local col3 ref" href="#53gdev" title='gdev' data-ref="53gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::dev" title='vbg_dev::dev' data-ref="vbg_dev::dev">dev</a>, &amp;<a class="tu ref" href="#255" title='dev_attr_host_features' data-use='a' data-ref="dev_attr_host_features">dev_attr_host_features</a>);</td></tr>
<tr><th id="407">407</th><td>	<a class="ref fn" href="../../../include/linux/device.h.html#device_remove_file" title='device_remove_file' data-ref="device_remove_file">device_remove_file</a>(<a class="local col3 ref" href="#53gdev" title='gdev' data-ref="53gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::dev" title='vbg_dev::dev' data-ref="vbg_dev::dev">dev</a>, &amp;<a class="tu ref" href="#254" title='dev_attr_host_version' data-use='a' data-ref="dev_attr_host_version">dev_attr_host_version</a>);</td></tr>
<tr><th id="408">408</th><td>	<a class="ref fn" href="../../../include/linux/miscdevice.h.html#misc_deregister" title='misc_deregister' data-ref="misc_deregister">misc_deregister</a>(&amp;<a class="local col3 ref" href="#53gdev" title='gdev' data-ref="53gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device_user" title='vbg_dev::misc_device_user' data-ref="vbg_dev::misc_device_user">misc_device_user</a>);</td></tr>
<tr><th id="409">409</th><td>	<a class="ref fn" href="../../../include/linux/miscdevice.h.html#misc_deregister" title='misc_deregister' data-ref="misc_deregister">misc_deregister</a>(&amp;<a class="local col3 ref" href="#53gdev" title='gdev' data-ref="53gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::misc_device" title='vbg_dev::misc_device' data-ref="vbg_dev::misc_device">misc_device</a>);</td></tr>
<tr><th id="410">410</th><td>	<a class="ref fn" href="vboxguest_core.h.html#vbg_core_exit" title='vbg_core_exit' data-ref="vbg_core_exit">vbg_core_exit</a>(<a class="local col3 ref" href="#53gdev" title='gdev' data-ref="53gdev">gdev</a>);</td></tr>
<tr><th id="411">411</th><td>	<a class="ref fn" href="../../../include/linux/pci.h.html#pci_disable_device" title='pci_disable_device' data-ref="pci_disable_device">pci_disable_device</a>(<a class="local col2 ref" href="#52pci" title='pci' data-ref="52pci">pci</a>);</td></tr>
<tr><th id="412">412</th><td>}</td></tr>
<tr><th id="413">413</th><td></td></tr>
<tr><th id="414">414</th><td><b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="decl def fn" id="vbg_get_gdev" title='vbg_get_gdev' data-ref="vbg_get_gdev">vbg_get_gdev</dfn>(<em>void</em>)</td></tr>
<tr><th id="415">415</th><td>{</td></tr>
<tr><th id="416">416</th><td>	<a class="ref fn" href="../../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='a' data-ref="vbg_gdev_mutex">vbg_gdev_mutex</a>);</td></tr>
<tr><th id="417">417</th><td></td></tr>
<tr><th id="418">418</th><td>	<i>/*</i></td></tr>
<tr><th id="419">419</th><td><i>	 * Note on success we keep the mutex locked until vbg_put_gdev(),</i></td></tr>
<tr><th id="420">420</th><td><i>	 * this stops vbg_pci_remove from removing the device from underneath</i></td></tr>
<tr><th id="421">421</th><td><i>	 * vboxsf. vboxsf will only hold a reference for a short while.</i></td></tr>
<tr><th id="422">422</th><td><i>	 */</i></td></tr>
<tr><th id="423">423</th><td>	<b>if</b> (<a class="tu ref" href="#vbg_gdev" title='vbg_gdev' data-use='r' data-ref="vbg_gdev">vbg_gdev</a>)</td></tr>
<tr><th id="424">424</th><td>		<b>return</b> <a class="tu ref" href="#vbg_gdev" title='vbg_gdev' data-use='r' data-ref="vbg_gdev">vbg_gdev</a>;</td></tr>
<tr><th id="425">425</th><td></td></tr>
<tr><th id="426">426</th><td>	<a class="ref fn" href="../../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='a' data-ref="vbg_gdev_mutex">vbg_gdev_mutex</a>);</td></tr>
<tr><th id="427">427</th><td>	<b>return</b> <a class="ref fn" href="../../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../../include/uapi/asm-generic/errno-base.h.html#23" title="19" data-ref="_M/ENODEV">ENODEV</a>);</td></tr>
<tr><th id="428">428</th><td>}</td></tr>
<tr><th id="429">429</th><td><a class="macro" href="../../../include/linux/export.h.html#97" title="extern typeof(vbg_get_gdev) vbg_get_gdev; static const char __kstrtab_vbg_get_gdev[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vbg_get_gdev&quot;; static const struct kernel_symbol __ksymtab_vbg_get_gdev __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vbg_get_gdev&quot;), used)) = { (unsigned long)&amp;vbg_get_gdev, __kstrtab_vbg_get_gdev }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vbg_get_gdev" title='vbg_get_gdev' data-ref="vbg_get_gdev"><a class="ref fn" href="#vbg_get_gdev" title='vbg_get_gdev' data-ref="vbg_get_gdev"><a class="ref fn" href="#vbg_get_gdev" title='vbg_get_gdev' data-ref="vbg_get_gdev"><a class="ref fn" href="#vbg_get_gdev" title='vbg_get_gdev' data-ref="vbg_get_gdev">vbg_get_gdev</a></a></a></a>);</td></tr>
<tr><th id="430">430</th><td></td></tr>
<tr><th id="431">431</th><td><em>void</em> <dfn class="decl def fn" id="vbg_put_gdev" title='vbg_put_gdev' data-ref="vbg_put_gdev">vbg_put_gdev</dfn>(<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="local col4 decl" id="54gdev" title='gdev' data-type='struct vbg_dev *' data-ref="54gdev">gdev</dfn>)</td></tr>
<tr><th id="432">432</th><td>{</td></tr>
<tr><th id="433">433</th><td>	<a class="macro" href="../../../include/asm-generic/bug.h.html#111" title="({ int __ret_warn_on = !!(gdev != vbg_gdev); if (__builtin_expect(!!(__ret_warn_on), 0)) do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/tempdban/kernel/stable/drivers/virt/vboxguest/vboxguest_linux.c&quot;), &quot;i&quot; (433), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (64)); }); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="local col4 ref" href="#54gdev" title='gdev' data-ref="54gdev">gdev</a> != <a class="tu ref" href="#vbg_gdev" title='vbg_gdev' data-use='r' data-ref="vbg_gdev">vbg_gdev</a>);</td></tr>
<tr><th id="434">434</th><td>	<a class="ref fn" href="../../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#27" title='vbg_gdev_mutex' data-use='a' data-ref="vbg_gdev_mutex">vbg_gdev_mutex</a>);</td></tr>
<tr><th id="435">435</th><td>}</td></tr>
<tr><th id="436">436</th><td><a class="macro" href="../../../include/linux/export.h.html#97" title="extern typeof(vbg_put_gdev) vbg_put_gdev; static const char __kstrtab_vbg_put_gdev[] __attribute__((section(&quot;__ksymtab_strings&quot;), aligned(1))) = &quot;vbg_put_gdev&quot;; static const struct kernel_symbol __ksymtab_vbg_put_gdev __attribute__((__used__)) __attribute__((section(&quot;___ksymtab&quot; &quot;&quot; &quot;+&quot; &quot;vbg_put_gdev&quot;), used)) = { (unsigned long)&amp;vbg_put_gdev, __kstrtab_vbg_put_gdev }" data-ref="_M/EXPORT_SYMBOL">EXPORT_SYMBOL</a>(<a class="decl fn" href="#vbg_put_gdev" title='vbg_put_gdev' data-ref="vbg_put_gdev"><a class="ref fn" href="#vbg_put_gdev" title='vbg_put_gdev' data-ref="vbg_put_gdev"><a class="ref fn" href="#vbg_put_gdev" title='vbg_put_gdev' data-ref="vbg_put_gdev"><a class="ref fn" href="#vbg_put_gdev" title='vbg_put_gdev' data-ref="vbg_put_gdev">vbg_put_gdev</a></a></a></a>);</td></tr>
<tr><th id="437">437</th><td></td></tr>
<tr><th id="438">438</th><td><i class="doc">/**</i></td></tr>
<tr><th id="439">439</th><td><i class="doc"> * Callback for mouse events.</i></td></tr>
<tr><th id="440">440</th><td><i class="doc"> *</i></td></tr>
<tr><th id="441">441</th><td><i class="doc"> * This is called at the end of the ISR, after leaving the event spinlock, if</i></td></tr>
<tr><th id="442">442</th><td><i class="doc"> * VMMDEV_EVENT_MOUSE_POSITION_CHANGED was raised by the host.</i></td></tr>
<tr><th id="443">443</th><td><i class="doc"> *</i></td></tr>
<tr><th id="444">444</th><td><i class="doc"> *<span class="command"> @gdev</span>:		The device extension.</i></td></tr>
<tr><th id="445">445</th><td><i class="doc"> */</i></td></tr>
<tr><th id="446">446</th><td><em>void</em> <dfn class="decl def fn" id="vbg_linux_mouse_event" title='vbg_linux_mouse_event' data-ref="vbg_linux_mouse_event">vbg_linux_mouse_event</dfn>(<b>struct</b> <a class="type" href="vboxguest_core.h.html#vbg_dev" title='vbg_dev' data-ref="vbg_dev">vbg_dev</a> *<dfn class="local col5 decl" id="55gdev" title='gdev' data-type='struct vbg_dev *' data-ref="55gdev">gdev</dfn>)</td></tr>
<tr><th id="447">447</th><td>{</td></tr>
<tr><th id="448">448</th><td>	<em>int</em> <dfn class="local col6 decl" id="56rc" title='rc' data-type='int' data-ref="56rc">rc</dfn>;</td></tr>
<tr><th id="449">449</th><td></td></tr>
<tr><th id="450">450</th><td>	<i>/* Report events to the kernel input device */</i></td></tr>
<tr><th id="451">451</th><td>	<a class="local col5 ref" href="#55gdev" title='gdev' data-ref="55gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::mouse_status_req" title='vbg_dev::mouse_status_req' data-ref="vbg_dev::mouse_status_req">mouse_status_req</a>-&gt;<a class="ref field" href="vmmdev.h.html#vmmdev_mouse_status::mouse_features" title='vmmdev_mouse_status::mouse_features' data-ref="vmmdev_mouse_status::mouse_features">mouse_features</a> = <var>0</var>;</td></tr>
<tr><th id="452">452</th><td>	<a class="local col5 ref" href="#55gdev" title='gdev' data-ref="55gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::mouse_status_req" title='vbg_dev::mouse_status_req' data-ref="vbg_dev::mouse_status_req">mouse_status_req</a>-&gt;<a class="ref field" href="vmmdev.h.html#vmmdev_mouse_status::pointer_pos_x" title='vmmdev_mouse_status::pointer_pos_x' data-ref="vmmdev_mouse_status::pointer_pos_x">pointer_pos_x</a> = <var>0</var>;</td></tr>
<tr><th id="453">453</th><td>	<a class="local col5 ref" href="#55gdev" title='gdev' data-ref="55gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::mouse_status_req" title='vbg_dev::mouse_status_req' data-ref="vbg_dev::mouse_status_req">mouse_status_req</a>-&gt;<a class="ref field" href="vmmdev.h.html#vmmdev_mouse_status::pointer_pos_y" title='vmmdev_mouse_status::pointer_pos_y' data-ref="vmmdev_mouse_status::pointer_pos_y">pointer_pos_y</a> = <var>0</var>;</td></tr>
<tr><th id="454">454</th><td>	<a class="local col6 ref" href="#56rc" title='rc' data-ref="56rc">rc</a> = <a class="ref fn" href="vboxguest_core.h.html#vbg_req_perform" title='vbg_req_perform' data-ref="vbg_req_perform">vbg_req_perform</a>(<a class="local col5 ref" href="#55gdev" title='gdev' data-ref="55gdev">gdev</a>, <a class="local col5 ref" href="#55gdev" title='gdev' data-ref="55gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::mouse_status_req" title='vbg_dev::mouse_status_req' data-ref="vbg_dev::mouse_status_req">mouse_status_req</a>);</td></tr>
<tr><th id="455">455</th><td>	<b>if</b> (<a class="local col6 ref" href="#56rc" title='rc' data-ref="56rc">rc</a> &gt;= <var>0</var>) {</td></tr>
<tr><th id="456">456</th><td>		<a class="ref fn" href="../../../include/linux/input.h.html#input_report_abs" title='input_report_abs' data-ref="input_report_abs">input_report_abs</a>(<a class="local col5 ref" href="#55gdev" title='gdev' data-ref="55gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::input" title='vbg_dev::input' data-ref="vbg_dev::input">input</a>, <a class="macro" href="../../../include/uapi/linux/input-event-codes.h.html#718" title="0x00" data-ref="_M/ABS_X">ABS_X</a>,</td></tr>
<tr><th id="457">457</th><td>				 <a class="local col5 ref" href="#55gdev" title='gdev' data-ref="55gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::mouse_status_req" title='vbg_dev::mouse_status_req' data-ref="vbg_dev::mouse_status_req">mouse_status_req</a>-&gt;<a class="ref field" href="vmmdev.h.html#vmmdev_mouse_status::pointer_pos_x" title='vmmdev_mouse_status::pointer_pos_x' data-ref="vmmdev_mouse_status::pointer_pos_x">pointer_pos_x</a>);</td></tr>
<tr><th id="458">458</th><td>		<a class="ref fn" href="../../../include/linux/input.h.html#input_report_abs" title='input_report_abs' data-ref="input_report_abs">input_report_abs</a>(<a class="local col5 ref" href="#55gdev" title='gdev' data-ref="55gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::input" title='vbg_dev::input' data-ref="vbg_dev::input">input</a>, <a class="macro" href="../../../include/uapi/linux/input-event-codes.h.html#719" title="0x01" data-ref="_M/ABS_Y">ABS_Y</a>,</td></tr>
<tr><th id="459">459</th><td>				 <a class="local col5 ref" href="#55gdev" title='gdev' data-ref="55gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::mouse_status_req" title='vbg_dev::mouse_status_req' data-ref="vbg_dev::mouse_status_req">mouse_status_req</a>-&gt;<a class="ref field" href="vmmdev.h.html#vmmdev_mouse_status::pointer_pos_y" title='vmmdev_mouse_status::pointer_pos_y' data-ref="vmmdev_mouse_status::pointer_pos_y">pointer_pos_y</a>);</td></tr>
<tr><th id="460">460</th><td>		<a class="ref fn" href="../../../include/linux/input.h.html#input_sync" title='input_sync' data-ref="input_sync">input_sync</a>(<a class="local col5 ref" href="#55gdev" title='gdev' data-ref="55gdev">gdev</a>-&gt;<a class="ref field" href="vboxguest_core.h.html#vbg_dev::input" title='vbg_dev::input' data-ref="vbg_dev::input">input</a>);</td></tr>
<tr><th id="461">461</th><td>	}</td></tr>
<tr><th id="462">462</th><td>}</td></tr>
<tr><th id="463">463</th><td></td></tr>
<tr><th id="464">464</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="../../../include/linux/mod_devicetable.h.html#pci_device_id" title='pci_device_id' data-ref="pci_device_id">pci_device_id</a> <dfn class="tu decl def" id="vbg_pci_ids" title='vbg_pci_ids' data-type='const struct pci_device_id [2]' data-ref="vbg_pci_ids">vbg_pci_ids</dfn>[] = {</td></tr>
<tr><th id="465">465</th><td>	{ .<a class="ref field" href="../../../include/linux/mod_devicetable.h.html#pci_device_id::vendor" title='pci_device_id::vendor' data-ref="pci_device_id::vendor">vendor</a> = <a class="macro" href="#22" title="0x80ee" data-ref="_M/VBOX_VENDORID">VBOX_VENDORID</a>, .<a class="ref field" href="../../../include/linux/mod_devicetable.h.html#pci_device_id::device" title='pci_device_id::device' data-ref="pci_device_id::device">device</a> = <a class="macro" href="#24" title="0xcafe" data-ref="_M/VMMDEV_DEVICEID">VMMDEV_DEVICEID</a> },</td></tr>
<tr><th id="466">466</th><td>	{}</td></tr>
<tr><th id="467">467</th><td>};</td></tr>
<tr><th id="468">468</th><td><a class="macro" href="../../../include/linux/module.h.html#216" title="" data-ref="_M/MODULE_DEVICE_TABLE">MODULE_DEVICE_TABLE</a>(pci,  vbg_pci_ids);</td></tr>
<tr><th id="469">469</th><td></td></tr>
<tr><th id="470">470</th><td><em>static</em> <b>struct</b> <a class="type" href="../../../include/linux/pci.h.html#pci_driver" title='pci_driver' data-ref="pci_driver">pci_driver</a> <dfn class="tu decl def" id="vbg_pci_driver" title='vbg_pci_driver' data-type='struct pci_driver' data-ref="vbg_pci_driver">vbg_pci_driver</dfn> = {</td></tr>
<tr><th id="471">471</th><td>	.<a class="ref field" href="../../../include/linux/pci.h.html#pci_driver::name" title='pci_driver::name' data-ref="pci_driver::name">name</a>		= <a class="macro" href="#18" title="&quot;vboxguest&quot;" data-ref="_M/DEVICE_NAME">DEVICE_NAME</a>,</td></tr>
<tr><th id="472">472</th><td>	.<a class="ref field" href="../../../include/linux/pci.h.html#pci_driver::id_table" title='pci_driver::id_table' data-ref="pci_driver::id_table">id_table</a>	= <a class="tu ref" href="#vbg_pci_ids" title='vbg_pci_ids' data-ref="vbg_pci_ids">vbg_pci_ids</a>,</td></tr>
<tr><th id="473">473</th><td>	.<a class="ref field" href="../../../include/linux/pci.h.html#pci_driver::probe" title='pci_driver::probe' data-ref="pci_driver::probe">probe</a>		= <a class="tu ref fn" href="#vbg_pci_probe" title='vbg_pci_probe' data-ref="vbg_pci_probe">vbg_pci_probe</a>,</td></tr>
<tr><th id="474">474</th><td>	.<a class="ref field" href="../../../include/linux/pci.h.html#pci_driver::remove" title='pci_driver::remove' data-ref="pci_driver::remove">remove</a>		= <a class="tu ref fn" href="#vbg_pci_remove" title='vbg_pci_remove' data-ref="vbg_pci_remove">vbg_pci_remove</a>,</td></tr>
<tr><th id="475">475</th><td>};</td></tr>
<tr><th id="476">476</th><td></td></tr>
<tr><th id="477">477</th><td><a class="macro" href="../../../include/linux/pci.h.html#1277" title="static int __attribute__ ((__section__(&quot;.init.text&quot;))) vbg_pci_driver_init(void) { return __pci_register_driver(&amp;(vbg_pci_driver), ((struct module *)0), &quot;vboxguest&quot;); } static initcall_t __initcall_vbg_pci_driver_init6 __attribute__((__used__)) __attribute__((__section__(&quot;.initcall&quot; &quot;6&quot; &quot;.init&quot;))) = vbg_pci_driver_init;;; static void __attribute__ ((__section__(&quot;.exit.text&quot;))) __attribute__((__used__)) __attribute__((no_instrument_function)) vbg_pci_driver_exit(void) { pci_unregister_driver(&amp;(vbg_pci_driver)); } static exitcall_t __exitcall_vbg_pci_driver_exit __attribute__((__used__)) __attribute__ ((__section__(&quot;.exitcall.exit&quot;))) = vbg_pci_driver_exit;;" data-ref="_M/module_pci_driver">module_pci_driver</a>(<a class="tu ref" href="#vbg_pci_driver" title='vbg_pci_driver' data-use='a' data-ref="vbg_pci_driver">vbg_pci_driver</a>);</td></tr>
<tr><th id="478">478</th><td></td></tr>
<tr><th id="479">479</th><td><a class="macro" href="../../../include/linux/module.h.html#205" title="struct __UNIQUE_ID_author66 {}" data-ref="_M/MODULE_AUTHOR">MODULE_AUTHOR</a>(<q>"Oracle Corporation"</q>);</td></tr>
<tr><th id="480">480</th><td><a class="macro" href="../../../include/linux/module.h.html#208" title="struct __UNIQUE_ID_description68 {}" data-ref="_M/MODULE_DESCRIPTION">MODULE_DESCRIPTION</a>(<q>"Oracle VM VirtualBox Guest Additions for Linux Module"</q>);</td></tr>
<tr><th id="481">481</th><td><a class="macro" href="../../../include/linux/module.h.html#199" title="struct __UNIQUE_ID_license70 {}" data-ref="_M/MODULE_LICENSE">MODULE_LICENSE</a>(<q>"GPL"</q>);</td></tr>
<tr><th id="482">482</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2018-Oct-01</em> from project linux-4.18.y revision <em>linux-4.18.y</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
