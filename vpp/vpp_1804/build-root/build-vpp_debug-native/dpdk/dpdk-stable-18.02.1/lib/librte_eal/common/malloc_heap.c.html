<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>malloc_heap.c source code [vpp_1804/build-root/build-vpp_debug-native/dpdk/dpdk-stable-18.02.1/lib/librte_eal/common/malloc_heap.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../../../../../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../../../../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../../../../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../../../../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'vpp_1804/build-root/build-vpp_debug-native/dpdk/dpdk-stable-18.02.1/lib/librte_eal/common/malloc_heap.c'; var root_path = '../../../../../../../..'; var data_path = '../../../../../../../../../data';</script>
<script src='../../../../../../../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../../../../../..'>vpp_1804</a>/<a href='../../../../../..'>build-root</a>/<a href='../../../../..'>build-vpp_debug-native</a>/<a href='../../../..'>dpdk</a>/<a href='../../..'>dpdk-stable-18.02.1</a>/<a href='../..'>lib</a>/<a href='..'>librte_eal</a>/<a href='./'>common</a>/<a href='malloc_heap.c.html'>malloc_heap.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/* SPDX-License-Identifier: BSD-3-Clause</i></td></tr>
<tr><th id="2">2</th><td><i> * Copyright(c) 2010-2014 Intel Corporation</i></td></tr>
<tr><th id="3">3</th><td><i> */</i></td></tr>
<tr><th id="4">4</th><td><u>#include &lt;stdint.h&gt;</u></td></tr>
<tr><th id="5">5</th><td><u>#include &lt;stddef.h&gt;</u></td></tr>
<tr><th id="6">6</th><td><u>#include <a href="../../../../../../../../include/stdlib.h.html">&lt;stdlib.h&gt;</a></u></td></tr>
<tr><th id="7">7</th><td><u>#include <a href="../../../../../../../../include/stdio.h.html">&lt;stdio.h&gt;</a></u></td></tr>
<tr><th id="8">8</th><td><u>#include &lt;stdarg.h&gt;</u></td></tr>
<tr><th id="9">9</th><td><u>#include <a href="../../../../../../../../include/errno.h.html">&lt;errno.h&gt;</a></u></td></tr>
<tr><th id="10">10</th><td><u>#include <a href="../../../../../../../../include/sys/queue.h.html">&lt;sys/queue.h&gt;</a></u></td></tr>
<tr><th id="11">11</th><td></td></tr>
<tr><th id="12">12</th><td><u>#include <a href="include/rte_memory.h.html">&lt;rte_memory.h&gt;</a></u></td></tr>
<tr><th id="13">13</th><td><u>#include <a href="include/rte_eal.h.html">&lt;rte_eal.h&gt;</a></u></td></tr>
<tr><th id="14">14</th><td><u>#include <a href="include/rte_eal_memconfig.h.html">&lt;rte_eal_memconfig.h&gt;</a></u></td></tr>
<tr><th id="15">15</th><td><u>#include <a href="include/rte_launch.h.html">&lt;rte_launch.h&gt;</a></u></td></tr>
<tr><th id="16">16</th><td><u>#include <a href="include/rte_per_lcore.h.html">&lt;rte_per_lcore.h&gt;</a></u></td></tr>
<tr><th id="17">17</th><td><u>#include <a href="include/rte_lcore.h.html">&lt;rte_lcore.h&gt;</a></u></td></tr>
<tr><th id="18">18</th><td><u>#include <a href="include/rte_common.h.html">&lt;rte_common.h&gt;</a></u></td></tr>
<tr><th id="19">19</th><td><u>#include <a href="include/rte_string_fns.h.html">&lt;rte_string_fns.h&gt;</a></u></td></tr>
<tr><th id="20">20</th><td><u>#include <a href="include/arch/x86/rte_spinlock.h.html">&lt;rte_spinlock.h&gt;</a></u></td></tr>
<tr><th id="21">21</th><td><u>#include <a href="include/arch/x86/rte_memcpy.h.html">&lt;rte_memcpy.h&gt;</a></u></td></tr>
<tr><th id="22">22</th><td><u>#include <a href="include/arch/x86/rte_atomic.h.html">&lt;rte_atomic.h&gt;</a></u></td></tr>
<tr><th id="23">23</th><td></td></tr>
<tr><th id="24">24</th><td><u>#include <a href="malloc_elem.h.html">"malloc_elem.h"</a></u></td></tr>
<tr><th id="25">25</th><td><u>#include <a href="malloc_heap.h.html">"malloc_heap.h"</a></u></td></tr>
<tr><th id="26">26</th><td></td></tr>
<tr><th id="27">27</th><td><em>static</em> <em>unsigned</em></td></tr>
<tr><th id="28">28</th><td><dfn class="tu decl def fn" id="check_hugepage_sz" title='check_hugepage_sz' data-type='unsigned int check_hugepage_sz(unsigned int flags, uint64_t hugepage_sz)' data-ref="check_hugepage_sz">check_hugepage_sz</dfn>(<em>unsigned</em> <dfn class="local col1 decl" id="1flags" title='flags' data-type='unsigned int' data-ref="1flags">flags</dfn>, <a class="typedef" href="../../../../../../../../include/stdint.h.html#uint64_t" title='uint64_t' data-type='unsigned long' data-ref="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="2hugepage_sz" title='hugepage_sz' data-type='uint64_t' data-ref="2hugepage_sz">hugepage_sz</dfn>)</td></tr>
<tr><th id="29">29</th><td>{</td></tr>
<tr><th id="30">30</th><td>	<em>unsigned</em> <dfn class="local col3 decl" id="3check_flag" title='check_flag' data-type='unsigned int' data-ref="3check_flag">check_flag</dfn> = <var>0</var>;</td></tr>
<tr><th id="31">31</th><td></td></tr>
<tr><th id="32">32</th><td>	<b>if</b> (!(<a class="local col1 ref" href="#1flags" title='flags' data-ref="1flags">flags</a> &amp; ~<a class="macro" href="include/rte_memzone.h.html#41" title="0x00000004" data-ref="_M/RTE_MEMZONE_SIZE_HINT_ONLY">RTE_MEMZONE_SIZE_HINT_ONLY</a>))</td></tr>
<tr><th id="33">33</th><td>		<b>return</b> <var>1</var>;</td></tr>
<tr><th id="34">34</th><td></td></tr>
<tr><th id="35">35</th><td>	<b>switch</b> (<a class="local col2 ref" href="#2hugepage_sz" title='hugepage_sz' data-ref="2hugepage_sz">hugepage_sz</a>) {</td></tr>
<tr><th id="36">36</th><td>	<b>case</b> <a class="enum" href="include/rte_memory.h.html#RTE_PGSIZE_256K" title='RTE_PGSIZE_256K' data-ref="RTE_PGSIZE_256K">RTE_PGSIZE_256K</a>:</td></tr>
<tr><th id="37">37</th><td>		<a class="local col3 ref" href="#3check_flag" title='check_flag' data-ref="3check_flag">check_flag</a> = <a class="macro" href="include/rte_memzone.h.html#37" title="0x00010000" data-ref="_M/RTE_MEMZONE_256KB">RTE_MEMZONE_256KB</a>;</td></tr>
<tr><th id="38">38</th><td>		<b>break</b>;</td></tr>
<tr><th id="39">39</th><td>	<b>case</b> <a class="enum" href="include/rte_memory.h.html#RTE_PGSIZE_2M" title='RTE_PGSIZE_2M' data-ref="RTE_PGSIZE_2M">RTE_PGSIZE_2M</a>:</td></tr>
<tr><th id="40">40</th><td>		<a class="local col3 ref" href="#3check_flag" title='check_flag' data-ref="3check_flag">check_flag</a> = <a class="macro" href="include/rte_memzone.h.html#33" title="0x00000001" data-ref="_M/RTE_MEMZONE_2MB">RTE_MEMZONE_2MB</a>;</td></tr>
<tr><th id="41">41</th><td>		<b>break</b>;</td></tr>
<tr><th id="42">42</th><td>	<b>case</b> <a class="enum" href="include/rte_memory.h.html#RTE_PGSIZE_16M" title='RTE_PGSIZE_16M' data-ref="RTE_PGSIZE_16M">RTE_PGSIZE_16M</a>:</td></tr>
<tr><th id="43">43</th><td>		<a class="local col3 ref" href="#3check_flag" title='check_flag' data-ref="3check_flag">check_flag</a> = <a class="macro" href="include/rte_memzone.h.html#35" title="0x00000100" data-ref="_M/RTE_MEMZONE_16MB">RTE_MEMZONE_16MB</a>;</td></tr>
<tr><th id="44">44</th><td>		<b>break</b>;</td></tr>
<tr><th id="45">45</th><td>	<b>case</b> <a class="enum" href="include/rte_memory.h.html#RTE_PGSIZE_256M" title='RTE_PGSIZE_256M' data-ref="RTE_PGSIZE_256M">RTE_PGSIZE_256M</a>:</td></tr>
<tr><th id="46">46</th><td>		<a class="local col3 ref" href="#3check_flag" title='check_flag' data-ref="3check_flag">check_flag</a> = <a class="macro" href="include/rte_memzone.h.html#38" title="0x00020000" data-ref="_M/RTE_MEMZONE_256MB">RTE_MEMZONE_256MB</a>;</td></tr>
<tr><th id="47">47</th><td>		<b>break</b>;</td></tr>
<tr><th id="48">48</th><td>	<b>case</b> <a class="enum" href="include/rte_memory.h.html#RTE_PGSIZE_512M" title='RTE_PGSIZE_512M' data-ref="RTE_PGSIZE_512M">RTE_PGSIZE_512M</a>:</td></tr>
<tr><th id="49">49</th><td>		<a class="local col3 ref" href="#3check_flag" title='check_flag' data-ref="3check_flag">check_flag</a> = <a class="macro" href="include/rte_memzone.h.html#39" title="0x00040000" data-ref="_M/RTE_MEMZONE_512MB">RTE_MEMZONE_512MB</a>;</td></tr>
<tr><th id="50">50</th><td>		<b>break</b>;</td></tr>
<tr><th id="51">51</th><td>	<b>case</b> <a class="enum" href="include/rte_memory.h.html#RTE_PGSIZE_1G" title='RTE_PGSIZE_1G' data-ref="RTE_PGSIZE_1G">RTE_PGSIZE_1G</a>:</td></tr>
<tr><th id="52">52</th><td>		<a class="local col3 ref" href="#3check_flag" title='check_flag' data-ref="3check_flag">check_flag</a> = <a class="macro" href="include/rte_memzone.h.html#34" title="0x00000002" data-ref="_M/RTE_MEMZONE_1GB">RTE_MEMZONE_1GB</a>;</td></tr>
<tr><th id="53">53</th><td>		<b>break</b>;</td></tr>
<tr><th id="54">54</th><td>	<b>case</b> <a class="enum" href="include/rte_memory.h.html#RTE_PGSIZE_4G" title='RTE_PGSIZE_4G' data-ref="RTE_PGSIZE_4G">RTE_PGSIZE_4G</a>:</td></tr>
<tr><th id="55">55</th><td>		<a class="local col3 ref" href="#3check_flag" title='check_flag' data-ref="3check_flag">check_flag</a> = <a class="macro" href="include/rte_memzone.h.html#40" title="0x00080000" data-ref="_M/RTE_MEMZONE_4GB">RTE_MEMZONE_4GB</a>;</td></tr>
<tr><th id="56">56</th><td>		<b>break</b>;</td></tr>
<tr><th id="57">57</th><td>	<b>case</b> <a class="enum" href="include/rte_memory.h.html#RTE_PGSIZE_16G" title='RTE_PGSIZE_16G' data-ref="RTE_PGSIZE_16G">RTE_PGSIZE_16G</a>:</td></tr>
<tr><th id="58">58</th><td>		<a class="local col3 ref" href="#3check_flag" title='check_flag' data-ref="3check_flag">check_flag</a> = <a class="macro" href="include/rte_memzone.h.html#36" title="0x00000200" data-ref="_M/RTE_MEMZONE_16GB">RTE_MEMZONE_16GB</a>;</td></tr>
<tr><th id="59">59</th><td>	}</td></tr>
<tr><th id="60">60</th><td></td></tr>
<tr><th id="61">61</th><td>	<b>return</b> <a class="local col3 ref" href="#3check_flag" title='check_flag' data-ref="3check_flag">check_flag</a> &amp; <a class="local col1 ref" href="#1flags" title='flags' data-ref="1flags">flags</a>;</td></tr>
<tr><th id="62">62</th><td>}</td></tr>
<tr><th id="63">63</th><td></td></tr>
<tr><th id="64">64</th><td><i  data-doc="malloc_heap_add_memseg">/*</i></td></tr>
<tr><th id="65">65</th><td><i  data-doc="malloc_heap_add_memseg"> * Expand the heap with a memseg.</i></td></tr>
<tr><th id="66">66</th><td><i  data-doc="malloc_heap_add_memseg"> * This reserves the zone and sets a dummy malloc_elem header at the end</i></td></tr>
<tr><th id="67">67</th><td><i  data-doc="malloc_heap_add_memseg"> * to prevent overflow. The rest of the zone is added to free list as a single</i></td></tr>
<tr><th id="68">68</th><td><i  data-doc="malloc_heap_add_memseg"> * large free block</i></td></tr>
<tr><th id="69">69</th><td><i  data-doc="malloc_heap_add_memseg"> */</i></td></tr>
<tr><th id="70">70</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="71">71</th><td><dfn class="tu decl def fn" id="malloc_heap_add_memseg" title='malloc_heap_add_memseg' data-type='void malloc_heap_add_memseg(struct malloc_heap * heap, struct rte_memseg * ms)' data-ref="malloc_heap_add_memseg">malloc_heap_add_memseg</dfn>(<b>struct</b> <a class="type" href="include/rte_malloc_heap.h.html#malloc_heap" title='malloc_heap' data-ref="malloc_heap">malloc_heap</a> *<dfn class="local col4 decl" id="4heap" title='heap' data-type='struct malloc_heap *' data-ref="4heap">heap</dfn>, <b>struct</b> <a class="type" href="include/rte_memory.h.html#rte_memseg" title='rte_memseg' data-ref="rte_memseg">rte_memseg</a> *<dfn class="local col5 decl" id="5ms" title='ms' data-type='struct rte_memseg *' data-ref="5ms">ms</dfn>)</td></tr>
<tr><th id="72">72</th><td>{</td></tr>
<tr><th id="73">73</th><td>	<i>/* allocate the memory block headers, one at end, one at start */</i></td></tr>
<tr><th id="74">74</th><td>	<b>struct</b> <a class="type" href="malloc_elem.h.html#malloc_elem" title='malloc_elem' data-ref="malloc_elem">malloc_elem</a> *<dfn class="local col6 decl" id="6start_elem" title='start_elem' data-type='struct malloc_elem *' data-ref="6start_elem">start_elem</dfn> = (<b>struct</b> <a class="type" href="malloc_elem.h.html#malloc_elem" title='malloc_elem' data-ref="malloc_elem">malloc_elem</a> *)<a class="local col5 ref" href="#5ms" title='ms' data-ref="5ms">ms</a>-&gt;<a class="ref field" href="include/rte_memory.h.html#rte_memseg::(anonymous)::addr" title='rte_memseg::(anonymous union)::addr' data-ref="rte_memseg::(anonymous)::addr">addr</a>;</td></tr>
<tr><th id="75">75</th><td>	<b>struct</b> <a class="type" href="malloc_elem.h.html#malloc_elem" title='malloc_elem' data-ref="malloc_elem">malloc_elem</a> *<dfn class="local col7 decl" id="7end_elem" title='end_elem' data-type='struct malloc_elem *' data-ref="7end_elem">end_elem</dfn> = <a class="macro" href="include/rte_common.h.html#122" title="((void*)((uintptr_t)(ms-&gt;addr) + (ms-&gt;len - (MALLOC_ELEM_HEADER_LEN + MALLOC_ELEM_TRAILER_LEN))))" data-ref="_M/RTE_PTR_ADD">RTE_PTR_ADD</a>(<a class="local col5 ref" href="#5ms" title='ms' data-ref="5ms">ms</a>-&gt;<a class="ref field" href="include/rte_memory.h.html#rte_memseg::(anonymous)::addr" title='rte_memseg::(anonymous union)::addr' data-ref="rte_memseg::(anonymous)::addr">addr</a>,</td></tr>
<tr><th id="76">76</th><td>			<a class="local col5 ref" href="#5ms" title='ms' data-ref="5ms">ms</a>-&gt;<a class="ref field" href="include/rte_memory.h.html#rte_memseg::len" title='rte_memseg::len' data-ref="rte_memseg::len">len</a> - <a class="macro" href="malloc_elem.h.html#86" title="(MALLOC_ELEM_HEADER_LEN + MALLOC_ELEM_TRAILER_LEN)" data-ref="_M/MALLOC_ELEM_OVERHEAD">MALLOC_ELEM_OVERHEAD</a>);</td></tr>
<tr><th id="77">77</th><td>	<a class="local col7 ref" href="#7end_elem" title='end_elem' data-ref="7end_elem">end_elem</a> = <a class="macro" href="include/rte_common.h.html#145" title="((__typeof__(end_elem))(__typeof__((uintptr_t)end_elem))(((uintptr_t)end_elem) &amp; (~((__typeof__((uintptr_t)end_elem))((64) - 1)))))" data-ref="_M/RTE_PTR_ALIGN_FLOOR">RTE_PTR_ALIGN_FLOOR</a>(<a class="local col7 ref" href="#7end_elem" title='end_elem' data-ref="7end_elem">end_elem</a>, <a class="macro" href="../../../x86_64-native-linuxapp-gcc/include/rte_config.h.html#18" title="64" data-ref="_M/RTE_CACHE_LINE_SIZE">RTE_CACHE_LINE_SIZE</a>);</td></tr>
<tr><th id="78">78</th><td>	<em>const</em> <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col8 decl" id="8elem_size" title='elem_size' data-type='const size_t' data-ref="8elem_size">elem_size</dfn> = (<a class="typedef" href="../../../../../../../../include/stdint.h.html#uintptr_t" title='uintptr_t' data-type='unsigned long' data-ref="uintptr_t">uintptr_t</a>)<a class="local col7 ref" href="#7end_elem" title='end_elem' data-ref="7end_elem">end_elem</a> - (<a class="typedef" href="../../../../../../../../include/stdint.h.html#uintptr_t" title='uintptr_t' data-type='unsigned long' data-ref="uintptr_t">uintptr_t</a>)<a class="local col6 ref" href="#6start_elem" title='start_elem' data-ref="6start_elem">start_elem</a>;</td></tr>
<tr><th id="79">79</th><td></td></tr>
<tr><th id="80">80</th><td>	<a class="ref fn" href="malloc_elem.h.html#malloc_elem_init" title='malloc_elem_init' data-ref="malloc_elem_init">malloc_elem_init</a>(<a class="local col6 ref" href="#6start_elem" title='start_elem' data-ref="6start_elem">start_elem</a>, <a class="local col4 ref" href="#4heap" title='heap' data-ref="4heap">heap</a>, <a class="local col5 ref" href="#5ms" title='ms' data-ref="5ms">ms</a>, <a class="local col8 ref" href="#8elem_size" title='elem_size' data-ref="8elem_size">elem_size</a>);</td></tr>
<tr><th id="81">81</th><td>	<a class="ref fn" href="malloc_elem.h.html#malloc_elem_mkend" title='malloc_elem_mkend' data-ref="malloc_elem_mkend">malloc_elem_mkend</a>(<a class="local col7 ref" href="#7end_elem" title='end_elem' data-ref="7end_elem">end_elem</a>, <a class="local col6 ref" href="#6start_elem" title='start_elem' data-ref="6start_elem">start_elem</a>);</td></tr>
<tr><th id="82">82</th><td>	<a class="ref fn" href="malloc_elem.h.html#malloc_elem_free_list_insert" title='malloc_elem_free_list_insert' data-ref="malloc_elem_free_list_insert">malloc_elem_free_list_insert</a>(<a class="local col6 ref" href="#6start_elem" title='start_elem' data-ref="6start_elem">start_elem</a>);</td></tr>
<tr><th id="83">83</th><td></td></tr>
<tr><th id="84">84</th><td>	<a class="local col4 ref" href="#4heap" title='heap' data-ref="4heap">heap</a>-&gt;<a class="ref field" href="include/rte_malloc_heap.h.html#malloc_heap::total_size" title='malloc_heap::total_size' data-ref="malloc_heap::total_size">total_size</a> += <a class="local col8 ref" href="#8elem_size" title='elem_size' data-ref="8elem_size">elem_size</a>;</td></tr>
<tr><th id="85">85</th><td>}</td></tr>
<tr><th id="86">86</th><td></td></tr>
<tr><th id="87">87</th><td><i  data-doc="find_suitable_element">/*</i></td></tr>
<tr><th id="88">88</th><td><i  data-doc="find_suitable_element"> * Iterates through the freelist for a heap to find a free element</i></td></tr>
<tr><th id="89">89</th><td><i  data-doc="find_suitable_element"> * which can store data of the required size and with the requested alignment.</i></td></tr>
<tr><th id="90">90</th><td><i  data-doc="find_suitable_element"> * If size is 0, find the biggest available elem.</i></td></tr>
<tr><th id="91">91</th><td><i  data-doc="find_suitable_element"> * Returns null on failure, or pointer to element on success.</i></td></tr>
<tr><th id="92">92</th><td><i  data-doc="find_suitable_element"> */</i></td></tr>
<tr><th id="93">93</th><td><em>static</em> <b>struct</b> <a class="type" href="malloc_elem.h.html#malloc_elem" title='malloc_elem' data-ref="malloc_elem">malloc_elem</a> *</td></tr>
<tr><th id="94">94</th><td><dfn class="tu decl def fn" id="find_suitable_element" title='find_suitable_element' data-type='struct malloc_elem * find_suitable_element(struct malloc_heap * heap, size_t size, unsigned int flags, size_t align, size_t bound)' data-ref="find_suitable_element">find_suitable_element</dfn>(<b>struct</b> <a class="type" href="include/rte_malloc_heap.h.html#malloc_heap" title='malloc_heap' data-ref="malloc_heap">malloc_heap</a> *<dfn class="local col9 decl" id="9heap" title='heap' data-type='struct malloc_heap *' data-ref="9heap">heap</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col0 decl" id="10size" title='size' data-type='size_t' data-ref="10size">size</dfn>,</td></tr>
<tr><th id="95">95</th><td>		<em>unsigned</em> <dfn class="local col1 decl" id="11flags" title='flags' data-type='unsigned int' data-ref="11flags">flags</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col2 decl" id="12align" title='align' data-type='size_t' data-ref="12align">align</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col3 decl" id="13bound" title='bound' data-type='size_t' data-ref="13bound">bound</dfn>)</td></tr>
<tr><th id="96">96</th><td>{</td></tr>
<tr><th id="97">97</th><td>	<span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col4 decl" id="14idx" title='idx' data-type='size_t' data-ref="14idx">idx</dfn>;</td></tr>
<tr><th id="98">98</th><td>	<b>struct</b> <a class="type" href="malloc_elem.h.html#malloc_elem" title='malloc_elem' data-ref="malloc_elem">malloc_elem</a> *<dfn class="local col5 decl" id="15elem" title='elem' data-type='struct malloc_elem *' data-ref="15elem">elem</dfn>, *<dfn class="local col6 decl" id="16alt_elem" title='alt_elem' data-type='struct malloc_elem *' data-ref="16alt_elem">alt_elem</dfn> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="99">99</th><td></td></tr>
<tr><th id="100">100</th><td>	<b>for</b> (<a class="local col4 ref" href="#14idx" title='idx' data-ref="14idx">idx</a> = <a class="ref fn" href="malloc_elem.h.html#malloc_elem_free_list_index" title='malloc_elem_free_list_index' data-ref="malloc_elem_free_list_index">malloc_elem_free_list_index</a>(<a class="local col0 ref" href="#10size" title='size' data-ref="10size">size</a>);</td></tr>
<tr><th id="101">101</th><td>			<a class="local col4 ref" href="#14idx" title='idx' data-ref="14idx">idx</a> &lt; <a class="macro" href="include/rte_malloc_heap.h.html#14" title="13" data-ref="_M/RTE_HEAP_NUM_FREELISTS">RTE_HEAP_NUM_FREELISTS</a>; <a class="local col4 ref" href="#14idx" title='idx' data-ref="14idx">idx</a>++) {</td></tr>
<tr><th id="102">102</th><td>		<b>for</b> (<a class="local col5 ref" href="#15elem" title='elem' data-ref="15elem">elem</a> = <a class="macro" href="../../../../../../../../include/sys/queue.h.html#143" title="((&amp;heap-&gt;free_head[idx])-&gt;lh_first)" data-ref="_M/LIST_FIRST">LIST_FIRST</a>(&amp;<a class="local col9 ref" href="#9heap" title='heap' data-ref="9heap">heap</a>-&gt;<a class="ref field" href="include/rte_malloc_heap.h.html#malloc_heap::free_head" title='malloc_heap::free_head' data-ref="malloc_heap::free_head">free_head</a>[<a class="local col4 ref" href="#14idx" title='idx' data-ref="14idx">idx</a>]);</td></tr>
<tr><th id="103">103</th><td>				!!<a class="local col5 ref" href="#15elem" title='elem' data-ref="15elem">elem</a>; <a class="local col5 ref" href="#15elem" title='elem' data-ref="15elem">elem</a> = <a class="macro" href="../../../../../../../../include/sys/queue.h.html#144" title="((elem)-&gt;free_list.le_next)" data-ref="_M/LIST_NEXT">LIST_NEXT</a>(<a class="local col5 ref" href="#15elem" title='elem' data-ref="15elem">elem</a>, <a class="ref field" href="malloc_elem.h.html#malloc_elem::free_list" title='malloc_elem::free_list' data-ref="malloc_elem::free_list">free_list</a>)) {</td></tr>
<tr><th id="104">104</th><td>			<b>if</b> (<a class="ref fn" href="malloc_elem.h.html#malloc_elem_can_hold" title='malloc_elem_can_hold' data-ref="malloc_elem_can_hold">malloc_elem_can_hold</a>(<a class="local col5 ref" href="#15elem" title='elem' data-ref="15elem">elem</a>, <a class="local col0 ref" href="#10size" title='size' data-ref="10size">size</a>, <a class="local col2 ref" href="#12align" title='align' data-ref="12align">align</a>, <a class="local col3 ref" href="#13bound" title='bound' data-ref="13bound">bound</a>)) {</td></tr>
<tr><th id="105">105</th><td>				<b>if</b> (<a class="tu ref fn" href="#check_hugepage_sz" title='check_hugepage_sz' data-use='c' data-ref="check_hugepage_sz">check_hugepage_sz</a>(<a class="local col1 ref" href="#11flags" title='flags' data-ref="11flags">flags</a>, <a class="local col5 ref" href="#15elem" title='elem' data-ref="15elem">elem</a>-&gt;<a class="ref field" href="malloc_elem.h.html#malloc_elem::ms" title='malloc_elem::ms' data-ref="malloc_elem::ms">ms</a>-&gt;<a class="ref field" href="include/rte_memory.h.html#rte_memseg::hugepage_sz" title='rte_memseg::hugepage_sz' data-ref="rte_memseg::hugepage_sz">hugepage_sz</a>))</td></tr>
<tr><th id="106">106</th><td>					<b>return</b> <a class="local col5 ref" href="#15elem" title='elem' data-ref="15elem">elem</a>;</td></tr>
<tr><th id="107">107</th><td>				<b>if</b> (<a class="local col6 ref" href="#16alt_elem" title='alt_elem' data-ref="16alt_elem">alt_elem</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="108">108</th><td>					<a class="local col6 ref" href="#16alt_elem" title='alt_elem' data-ref="16alt_elem">alt_elem</a> = <a class="local col5 ref" href="#15elem" title='elem' data-ref="15elem">elem</a>;</td></tr>
<tr><th id="109">109</th><td>			}</td></tr>
<tr><th id="110">110</th><td>		}</td></tr>
<tr><th id="111">111</th><td>	}</td></tr>
<tr><th id="112">112</th><td></td></tr>
<tr><th id="113">113</th><td>	<b>if</b> ((<a class="local col6 ref" href="#16alt_elem" title='alt_elem' data-ref="16alt_elem">alt_elem</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) &amp;&amp; (<a class="local col1 ref" href="#11flags" title='flags' data-ref="11flags">flags</a> &amp; <a class="macro" href="include/rte_memzone.h.html#41" title="0x00000004" data-ref="_M/RTE_MEMZONE_SIZE_HINT_ONLY">RTE_MEMZONE_SIZE_HINT_ONLY</a>))</td></tr>
<tr><th id="114">114</th><td>		<b>return</b> <a class="local col6 ref" href="#16alt_elem" title='alt_elem' data-ref="16alt_elem">alt_elem</a>;</td></tr>
<tr><th id="115">115</th><td></td></tr>
<tr><th id="116">116</th><td>	<b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="117">117</th><td>}</td></tr>
<tr><th id="118">118</th><td></td></tr>
<tr><th id="119">119</th><td><i>/*</i></td></tr>
<tr><th id="120">120</th><td><i> * Main function to allocate a block of memory from the heap.</i></td></tr>
<tr><th id="121">121</th><td><i> * It locks the free list, scans it, and adds a new memseg if the</i></td></tr>
<tr><th id="122">122</th><td><i> * scan fails. Once the new memseg is added, it re-scans and should return</i></td></tr>
<tr><th id="123">123</th><td><i> * the new element after releasing the lock.</i></td></tr>
<tr><th id="124">124</th><td><i> */</i></td></tr>
<tr><th id="125">125</th><td><em>void</em> *</td></tr>
<tr><th id="126">126</th><td><dfn class="decl def fn" id="malloc_heap_alloc" title='malloc_heap_alloc' data-ref="malloc_heap_alloc">malloc_heap_alloc</dfn>(<b>struct</b> <a class="type" href="include/rte_malloc_heap.h.html#malloc_heap" title='malloc_heap' data-ref="malloc_heap">malloc_heap</a> *<dfn class="local col7 decl" id="17heap" title='heap' data-type='struct malloc_heap *' data-ref="17heap">heap</dfn>,</td></tr>
<tr><th id="127">127</th><td>		<em>const</em> <em>char</em> *<dfn class="local col8 decl" id="18type" title='type' data-type='const char *' data-ref="18type">type</dfn> <b>__attribute__</b>((unused)), <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col9 decl" id="19size" title='size' data-type='size_t' data-ref="19size">size</dfn>, <em>unsigned</em> <dfn class="local col0 decl" id="20flags" title='flags' data-type='unsigned int' data-ref="20flags">flags</dfn>,</td></tr>
<tr><th id="128">128</th><td>		<span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col1 decl" id="21align" title='align' data-type='size_t' data-ref="21align">align</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col2 decl" id="22bound" title='bound' data-type='size_t' data-ref="22bound">bound</dfn>)</td></tr>
<tr><th id="129">129</th><td>{</td></tr>
<tr><th id="130">130</th><td>	<b>struct</b> <a class="type" href="malloc_elem.h.html#malloc_elem" title='malloc_elem' data-ref="malloc_elem">malloc_elem</a> *<dfn class="local col3 decl" id="23elem" title='elem' data-type='struct malloc_elem *' data-ref="23elem">elem</dfn>;</td></tr>
<tr><th id="131">131</th><td></td></tr>
<tr><th id="132">132</th><td>	<a class="local col9 ref" href="#19size" title='size' data-ref="19size">size</a> = <a class="macro" href="include/rte_memory.h.html#42" title="(64 * ((size + 64 - 1) / 64))" data-ref="_M/RTE_CACHE_LINE_ROUNDUP">RTE_CACHE_LINE_ROUNDUP</a>(<a class="local col9 ref" href="#19size" title='size' data-ref="19size">size</a>);</td></tr>
<tr><th id="133">133</th><td>	<a class="local col1 ref" href="#21align" title='align' data-ref="21align">align</a> = <a class="macro" href="include/rte_memory.h.html#42" title="(64 * ((align + 64 - 1) / 64))" data-ref="_M/RTE_CACHE_LINE_ROUNDUP">RTE_CACHE_LINE_ROUNDUP</a>(<a class="local col1 ref" href="#21align" title='align' data-ref="21align">align</a>);</td></tr>
<tr><th id="134">134</th><td></td></tr>
<tr><th id="135">135</th><td>	<a class="ref fn" href="include/generic/rte_spinlock.h.html#rte_spinlock_lock" title='rte_spinlock_lock' data-ref="rte_spinlock_lock">rte_spinlock_lock</a>(&amp;<a class="local col7 ref" href="#17heap" title='heap' data-ref="17heap">heap</a>-&gt;<a class="ref field" href="include/rte_malloc_heap.h.html#malloc_heap::lock" title='malloc_heap::lock' data-ref="malloc_heap::lock">lock</a>);</td></tr>
<tr><th id="136">136</th><td></td></tr>
<tr><th id="137">137</th><td>	<a class="local col3 ref" href="#23elem" title='elem' data-ref="23elem">elem</a> = <a class="tu ref fn" href="#find_suitable_element" title='find_suitable_element' data-use='c' data-ref="find_suitable_element">find_suitable_element</a>(<a class="local col7 ref" href="#17heap" title='heap' data-ref="17heap">heap</a>, <a class="local col9 ref" href="#19size" title='size' data-ref="19size">size</a>, <a class="local col0 ref" href="#20flags" title='flags' data-ref="20flags">flags</a>, <a class="local col1 ref" href="#21align" title='align' data-ref="21align">align</a>, <a class="local col2 ref" href="#22bound" title='bound' data-ref="22bound">bound</a>);</td></tr>
<tr><th id="138">138</th><td>	<b>if</b> (<a class="local col3 ref" href="#23elem" title='elem' data-ref="23elem">elem</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="139">139</th><td>		<a class="local col3 ref" href="#23elem" title='elem' data-ref="23elem">elem</a> = <a class="ref fn" href="malloc_elem.h.html#malloc_elem_alloc" title='malloc_elem_alloc' data-ref="malloc_elem_alloc">malloc_elem_alloc</a>(<a class="local col3 ref" href="#23elem" title='elem' data-ref="23elem">elem</a>, <a class="local col9 ref" href="#19size" title='size' data-ref="19size">size</a>, <a class="local col1 ref" href="#21align" title='align' data-ref="21align">align</a>, <a class="local col2 ref" href="#22bound" title='bound' data-ref="22bound">bound</a>);</td></tr>
<tr><th id="140">140</th><td>		<i>/* increase heap's count of allocated elements */</i></td></tr>
<tr><th id="141">141</th><td>		<a class="local col7 ref" href="#17heap" title='heap' data-ref="17heap">heap</a>-&gt;<a class="ref field" href="include/rte_malloc_heap.h.html#malloc_heap::alloc_count" title='malloc_heap::alloc_count' data-ref="malloc_heap::alloc_count">alloc_count</a>++;</td></tr>
<tr><th id="142">142</th><td>	}</td></tr>
<tr><th id="143">143</th><td>	<a class="ref fn" href="include/generic/rte_spinlock.h.html#rte_spinlock_unlock" title='rte_spinlock_unlock' data-ref="rte_spinlock_unlock">rte_spinlock_unlock</a>(&amp;<a class="local col7 ref" href="#17heap" title='heap' data-ref="17heap">heap</a>-&gt;<a class="ref field" href="include/rte_malloc_heap.h.html#malloc_heap::lock" title='malloc_heap::lock' data-ref="malloc_heap::lock">lock</a>);</td></tr>
<tr><th id="144">144</th><td></td></tr>
<tr><th id="145">145</th><td>	<b>return</b> <a class="local col3 ref" href="#23elem" title='elem' data-ref="23elem">elem</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> ? <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> : (<em>void</em> *)(&amp;<a class="local col3 ref" href="#23elem" title='elem' data-ref="23elem">elem</a>[<var>1</var>]);</td></tr>
<tr><th id="146">146</th><td>}</td></tr>
<tr><th id="147">147</th><td></td></tr>
<tr><th id="148">148</th><td><i>/*</i></td></tr>
<tr><th id="149">149</th><td><i> * Function to retrieve data for heap on given socket</i></td></tr>
<tr><th id="150">150</th><td><i> */</i></td></tr>
<tr><th id="151">151</th><td><em>int</em></td></tr>
<tr><th id="152">152</th><td><dfn class="decl def fn" id="malloc_heap_get_stats" title='malloc_heap_get_stats' data-ref="malloc_heap_get_stats">malloc_heap_get_stats</dfn>(<b>struct</b> <a class="type" href="include/rte_malloc_heap.h.html#malloc_heap" title='malloc_heap' data-ref="malloc_heap">malloc_heap</a> *<dfn class="local col4 decl" id="24heap" title='heap' data-type='struct malloc_heap *' data-ref="24heap">heap</dfn>,</td></tr>
<tr><th id="153">153</th><td>		<b>struct</b> <a class="type" href="include/rte_malloc.h.html#rte_malloc_socket_stats" title='rte_malloc_socket_stats' data-ref="rte_malloc_socket_stats">rte_malloc_socket_stats</a> *<dfn class="local col5 decl" id="25socket_stats" title='socket_stats' data-type='struct rte_malloc_socket_stats *' data-ref="25socket_stats">socket_stats</dfn>)</td></tr>
<tr><th id="154">154</th><td>{</td></tr>
<tr><th id="155">155</th><td>	<span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col6 decl" id="26idx" title='idx' data-type='size_t' data-ref="26idx">idx</dfn>;</td></tr>
<tr><th id="156">156</th><td>	<b>struct</b> <a class="type" href="malloc_elem.h.html#malloc_elem" title='malloc_elem' data-ref="malloc_elem">malloc_elem</a> *<dfn class="local col7 decl" id="27elem" title='elem' data-type='struct malloc_elem *' data-ref="27elem">elem</dfn>;</td></tr>
<tr><th id="157">157</th><td></td></tr>
<tr><th id="158">158</th><td>	<a class="ref fn" href="include/generic/rte_spinlock.h.html#rte_spinlock_lock" title='rte_spinlock_lock' data-ref="rte_spinlock_lock">rte_spinlock_lock</a>(&amp;<a class="local col4 ref" href="#24heap" title='heap' data-ref="24heap">heap</a>-&gt;<a class="ref field" href="include/rte_malloc_heap.h.html#malloc_heap::lock" title='malloc_heap::lock' data-ref="malloc_heap::lock">lock</a>);</td></tr>
<tr><th id="159">159</th><td></td></tr>
<tr><th id="160">160</th><td>	<i>/* Initialise variables for heap */</i></td></tr>
<tr><th id="161">161</th><td>	<a class="local col5 ref" href="#25socket_stats" title='socket_stats' data-ref="25socket_stats">socket_stats</a>-&gt;<a class="ref field" href="include/rte_malloc.h.html#rte_malloc_socket_stats::free_count" title='rte_malloc_socket_stats::free_count' data-ref="rte_malloc_socket_stats::free_count">free_count</a> = <var>0</var>;</td></tr>
<tr><th id="162">162</th><td>	<a class="local col5 ref" href="#25socket_stats" title='socket_stats' data-ref="25socket_stats">socket_stats</a>-&gt;<a class="ref field" href="include/rte_malloc.h.html#rte_malloc_socket_stats::heap_freesz_bytes" title='rte_malloc_socket_stats::heap_freesz_bytes' data-ref="rte_malloc_socket_stats::heap_freesz_bytes">heap_freesz_bytes</a> = <var>0</var>;</td></tr>
<tr><th id="163">163</th><td>	<a class="local col5 ref" href="#25socket_stats" title='socket_stats' data-ref="25socket_stats">socket_stats</a>-&gt;<a class="ref field" href="include/rte_malloc.h.html#rte_malloc_socket_stats::greatest_free_size" title='rte_malloc_socket_stats::greatest_free_size' data-ref="rte_malloc_socket_stats::greatest_free_size">greatest_free_size</a> = <var>0</var>;</td></tr>
<tr><th id="164">164</th><td></td></tr>
<tr><th id="165">165</th><td>	<i>/* Iterate through free list */</i></td></tr>
<tr><th id="166">166</th><td>	<b>for</b> (<a class="local col6 ref" href="#26idx" title='idx' data-ref="26idx">idx</a> = <var>0</var>; <a class="local col6 ref" href="#26idx" title='idx' data-ref="26idx">idx</a> &lt; <a class="macro" href="include/rte_malloc_heap.h.html#14" title="13" data-ref="_M/RTE_HEAP_NUM_FREELISTS">RTE_HEAP_NUM_FREELISTS</a>; <a class="local col6 ref" href="#26idx" title='idx' data-ref="26idx">idx</a>++) {</td></tr>
<tr><th id="167">167</th><td>		<b>for</b> (<a class="local col7 ref" href="#27elem" title='elem' data-ref="27elem">elem</a> = <a class="macro" href="../../../../../../../../include/sys/queue.h.html#143" title="((&amp;heap-&gt;free_head[idx])-&gt;lh_first)" data-ref="_M/LIST_FIRST">LIST_FIRST</a>(&amp;<a class="local col4 ref" href="#24heap" title='heap' data-ref="24heap">heap</a>-&gt;<a class="ref field" href="include/rte_malloc_heap.h.html#malloc_heap::free_head" title='malloc_heap::free_head' data-ref="malloc_heap::free_head">free_head</a>[<a class="local col6 ref" href="#26idx" title='idx' data-ref="26idx">idx</a>]);</td></tr>
<tr><th id="168">168</th><td>			!!<a class="local col7 ref" href="#27elem" title='elem' data-ref="27elem">elem</a>; <a class="local col7 ref" href="#27elem" title='elem' data-ref="27elem">elem</a> = <a class="macro" href="../../../../../../../../include/sys/queue.h.html#144" title="((elem)-&gt;free_list.le_next)" data-ref="_M/LIST_NEXT">LIST_NEXT</a>(<a class="local col7 ref" href="#27elem" title='elem' data-ref="27elem">elem</a>, <a class="ref field" href="malloc_elem.h.html#malloc_elem::free_list" title='malloc_elem::free_list' data-ref="malloc_elem::free_list">free_list</a>))</td></tr>
<tr><th id="169">169</th><td>		{</td></tr>
<tr><th id="170">170</th><td>			<a class="local col5 ref" href="#25socket_stats" title='socket_stats' data-ref="25socket_stats">socket_stats</a>-&gt;<a class="ref field" href="include/rte_malloc.h.html#rte_malloc_socket_stats::free_count" title='rte_malloc_socket_stats::free_count' data-ref="rte_malloc_socket_stats::free_count">free_count</a>++;</td></tr>
<tr><th id="171">171</th><td>			<a class="local col5 ref" href="#25socket_stats" title='socket_stats' data-ref="25socket_stats">socket_stats</a>-&gt;<a class="ref field" href="include/rte_malloc.h.html#rte_malloc_socket_stats::heap_freesz_bytes" title='rte_malloc_socket_stats::heap_freesz_bytes' data-ref="rte_malloc_socket_stats::heap_freesz_bytes">heap_freesz_bytes</a> += <a class="local col7 ref" href="#27elem" title='elem' data-ref="27elem">elem</a>-&gt;<a class="ref field" href="malloc_elem.h.html#malloc_elem::size" title='malloc_elem::size' data-ref="malloc_elem::size">size</a>;</td></tr>
<tr><th id="172">172</th><td>			<b>if</b> (<a class="local col7 ref" href="#27elem" title='elem' data-ref="27elem">elem</a>-&gt;<a class="ref field" href="malloc_elem.h.html#malloc_elem::size" title='malloc_elem::size' data-ref="malloc_elem::size">size</a> &gt; <a class="local col5 ref" href="#25socket_stats" title='socket_stats' data-ref="25socket_stats">socket_stats</a>-&gt;<a class="ref field" href="include/rte_malloc.h.html#rte_malloc_socket_stats::greatest_free_size" title='rte_malloc_socket_stats::greatest_free_size' data-ref="rte_malloc_socket_stats::greatest_free_size">greatest_free_size</a>)</td></tr>
<tr><th id="173">173</th><td>				<a class="local col5 ref" href="#25socket_stats" title='socket_stats' data-ref="25socket_stats">socket_stats</a>-&gt;<a class="ref field" href="include/rte_malloc.h.html#rte_malloc_socket_stats::greatest_free_size" title='rte_malloc_socket_stats::greatest_free_size' data-ref="rte_malloc_socket_stats::greatest_free_size">greatest_free_size</a> = <a class="local col7 ref" href="#27elem" title='elem' data-ref="27elem">elem</a>-&gt;<a class="ref field" href="malloc_elem.h.html#malloc_elem::size" title='malloc_elem::size' data-ref="malloc_elem::size">size</a>;</td></tr>
<tr><th id="174">174</th><td>		}</td></tr>
<tr><th id="175">175</th><td>	}</td></tr>
<tr><th id="176">176</th><td>	<i>/* Get stats on overall heap and allocated memory on this heap */</i></td></tr>
<tr><th id="177">177</th><td>	<a class="local col5 ref" href="#25socket_stats" title='socket_stats' data-ref="25socket_stats">socket_stats</a>-&gt;<a class="ref field" href="include/rte_malloc.h.html#rte_malloc_socket_stats::heap_totalsz_bytes" title='rte_malloc_socket_stats::heap_totalsz_bytes' data-ref="rte_malloc_socket_stats::heap_totalsz_bytes">heap_totalsz_bytes</a> = <a class="local col4 ref" href="#24heap" title='heap' data-ref="24heap">heap</a>-&gt;<a class="ref field" href="include/rte_malloc_heap.h.html#malloc_heap::total_size" title='malloc_heap::total_size' data-ref="malloc_heap::total_size">total_size</a>;</td></tr>
<tr><th id="178">178</th><td>	<a class="local col5 ref" href="#25socket_stats" title='socket_stats' data-ref="25socket_stats">socket_stats</a>-&gt;<a class="ref field" href="include/rte_malloc.h.html#rte_malloc_socket_stats::heap_allocsz_bytes" title='rte_malloc_socket_stats::heap_allocsz_bytes' data-ref="rte_malloc_socket_stats::heap_allocsz_bytes">heap_allocsz_bytes</a> = (<a class="local col5 ref" href="#25socket_stats" title='socket_stats' data-ref="25socket_stats">socket_stats</a>-&gt;<a class="ref field" href="include/rte_malloc.h.html#rte_malloc_socket_stats::heap_totalsz_bytes" title='rte_malloc_socket_stats::heap_totalsz_bytes' data-ref="rte_malloc_socket_stats::heap_totalsz_bytes">heap_totalsz_bytes</a> -</td></tr>
<tr><th id="179">179</th><td>			<a class="local col5 ref" href="#25socket_stats" title='socket_stats' data-ref="25socket_stats">socket_stats</a>-&gt;<a class="ref field" href="include/rte_malloc.h.html#rte_malloc_socket_stats::heap_freesz_bytes" title='rte_malloc_socket_stats::heap_freesz_bytes' data-ref="rte_malloc_socket_stats::heap_freesz_bytes">heap_freesz_bytes</a>);</td></tr>
<tr><th id="180">180</th><td>	<a class="local col5 ref" href="#25socket_stats" title='socket_stats' data-ref="25socket_stats">socket_stats</a>-&gt;<a class="ref field" href="include/rte_malloc.h.html#rte_malloc_socket_stats::alloc_count" title='rte_malloc_socket_stats::alloc_count' data-ref="rte_malloc_socket_stats::alloc_count">alloc_count</a> = <a class="local col4 ref" href="#24heap" title='heap' data-ref="24heap">heap</a>-&gt;<a class="ref field" href="include/rte_malloc_heap.h.html#malloc_heap::alloc_count" title='malloc_heap::alloc_count' data-ref="malloc_heap::alloc_count">alloc_count</a>;</td></tr>
<tr><th id="181">181</th><td></td></tr>
<tr><th id="182">182</th><td>	<a class="ref fn" href="include/generic/rte_spinlock.h.html#rte_spinlock_unlock" title='rte_spinlock_unlock' data-ref="rte_spinlock_unlock">rte_spinlock_unlock</a>(&amp;<a class="local col4 ref" href="#24heap" title='heap' data-ref="24heap">heap</a>-&gt;<a class="ref field" href="include/rte_malloc_heap.h.html#malloc_heap::lock" title='malloc_heap::lock' data-ref="malloc_heap::lock">lock</a>);</td></tr>
<tr><th id="183">183</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="184">184</th><td>}</td></tr>
<tr><th id="185">185</th><td></td></tr>
<tr><th id="186">186</th><td><em>int</em></td></tr>
<tr><th id="187">187</th><td><dfn class="decl def fn" id="rte_eal_malloc_heap_init" title='rte_eal_malloc_heap_init' data-ref="rte_eal_malloc_heap_init">rte_eal_malloc_heap_init</dfn>(<em>void</em>)</td></tr>
<tr><th id="188">188</th><td>{</td></tr>
<tr><th id="189">189</th><td>	<b>struct</b> <a class="type" href="include/rte_eal_memconfig.h.html#rte_mem_config" title='rte_mem_config' data-ref="rte_mem_config">rte_mem_config</a> *<dfn class="local col8 decl" id="28mcfg" title='mcfg' data-type='struct rte_mem_config *' data-ref="28mcfg">mcfg</dfn> = <a class="ref fn" href="include/rte_eal.h.html#rte_eal_get_configuration" title='rte_eal_get_configuration' data-ref="rte_eal_get_configuration">rte_eal_get_configuration</a>()-&gt;<a class="ref field" href="include/rte_eal.h.html#rte_config::mem_config" title='rte_config::mem_config' data-ref="rte_config::mem_config">mem_config</a>;</td></tr>
<tr><th id="190">190</th><td>	<em>unsigned</em> <dfn class="local col9 decl" id="29ms_cnt" title='ms_cnt' data-type='unsigned int' data-ref="29ms_cnt">ms_cnt</dfn>;</td></tr>
<tr><th id="191">191</th><td>	<b>struct</b> <a class="type" href="include/rte_memory.h.html#rte_memseg" title='rte_memseg' data-ref="rte_memseg">rte_memseg</a> *<dfn class="local col0 decl" id="30ms" title='ms' data-type='struct rte_memseg *' data-ref="30ms">ms</dfn>;</td></tr>
<tr><th id="192">192</th><td></td></tr>
<tr><th id="193">193</th><td>	<b>if</b> (<a class="local col8 ref" href="#28mcfg" title='mcfg' data-ref="28mcfg">mcfg</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="194">194</th><td>		<b>return</b> -<var>1</var>;</td></tr>
<tr><th id="195">195</th><td></td></tr>
<tr><th id="196">196</th><td>	<b>for</b> (<a class="local col0 ref" href="#30ms" title='ms' data-ref="30ms">ms</a> = &amp;<a class="local col8 ref" href="#28mcfg" title='mcfg' data-ref="28mcfg">mcfg</a>-&gt;<a class="ref field" href="include/rte_eal_memconfig.h.html#rte_mem_config::memseg" title='rte_mem_config::memseg' data-ref="rte_mem_config::memseg">memseg</a>[<var>0</var>], <a class="local col9 ref" href="#29ms_cnt" title='ms_cnt' data-ref="29ms_cnt">ms_cnt</a> = <var>0</var>;</td></tr>
<tr><th id="197">197</th><td>			(<a class="local col9 ref" href="#29ms_cnt" title='ms_cnt' data-ref="29ms_cnt">ms_cnt</a> &lt; <a class="macro" href="../../../x86_64-native-linuxapp-gcc/include/rte_config.h.html#26" title="256" data-ref="_M/RTE_MAX_MEMSEG">RTE_MAX_MEMSEG</a>) &amp;&amp; (<a class="local col0 ref" href="#30ms" title='ms' data-ref="30ms">ms</a>-&gt;<a class="ref field" href="include/rte_memory.h.html#rte_memseg::len" title='rte_memseg::len' data-ref="rte_memseg::len">len</a> &gt; <var>0</var>);</td></tr>
<tr><th id="198">198</th><td>			<a class="local col9 ref" href="#29ms_cnt" title='ms_cnt' data-ref="29ms_cnt">ms_cnt</a>++, <a class="local col0 ref" href="#30ms" title='ms' data-ref="30ms">ms</a>++) {</td></tr>
<tr><th id="199">199</th><td>		<a class="tu ref fn" href="#malloc_heap_add_memseg" title='malloc_heap_add_memseg' data-use='c' data-ref="malloc_heap_add_memseg">malloc_heap_add_memseg</a>(&amp;<a class="local col8 ref" href="#28mcfg" title='mcfg' data-ref="28mcfg">mcfg</a>-&gt;<a class="ref field" href="include/rte_eal_memconfig.h.html#rte_mem_config::malloc_heaps" title='rte_mem_config::malloc_heaps' data-ref="rte_mem_config::malloc_heaps">malloc_heaps</a>[<a class="local col0 ref" href="#30ms" title='ms' data-ref="30ms">ms</a>-&gt;<a class="ref field" href="include/rte_memory.h.html#rte_memseg::socket_id" title='rte_memseg::socket_id' data-ref="rte_memseg::socket_id">socket_id</a>], <a class="local col0 ref" href="#30ms" title='ms' data-ref="30ms">ms</a>);</td></tr>
<tr><th id="200">200</th><td>	}</td></tr>
<tr><th id="201">201</th><td></td></tr>
<tr><th id="202">202</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="203">203</th><td>}</td></tr>
<tr><th id="204">204</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2018-Jul-30</em> from project vpp_1804 revision <em>18.05</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
